{"id":"../src/surface/buffer-management/buffer-manager-base.ts","dependencies":[{"name":"/Users/diniden/Desktop/VoidRay/fiesta/tsconfig.json","includedInParent":true,"mtime":1570670525118},{"name":"/Users/diniden/Desktop/VoidRay/fiesta/package.json","includedInParent":true,"mtime":1570672381660}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction isBufferLocation(val) {\n  return val && val.buffer && val.buffer.value;\n}\n\nexports.isBufferLocation = isBufferLocation;\n\nfunction isBufferLocationGroup(val) {\n  return val && val.propertyToBufferLocation;\n}\n\nexports.isBufferLocationGroup = isBufferLocationGroup;\n\nvar BufferManagerBase = function () {\n  function BufferManagerBase(layer, scene) {\n    this.layer = layer;\n    this.scene = scene;\n  }\n\n  BufferManagerBase.prototype.changesProcessed = function () {\n    delete this.changeListContext;\n  };\n\n  BufferManagerBase.prototype.incomingChangeList = function (changes) {\n    this.changeListContext = changes;\n  };\n\n  return BufferManagerBase;\n}();\n\nexports.BufferManagerBase = BufferManagerBase;"},"sourceMaps":{"js":{"mappings":[{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":8,"column":0},"generated":{"line":7,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":8,"column":16},"generated":{"line":7,"column":9}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":8,"column":0},"generated":{"line":7,"column":25}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":8,"column":33},"generated":{"line":7,"column":26}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":8,"column":0},"generated":{"line":7,"column":29}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":8,"column":41},"generated":{"line":7,"column":31}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":9,"column":2},"generated":{"line":8,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":9,"column":9},"generated":{"line":8,"column":9}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":9,"column":12},"generated":{"line":8,"column":12}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":9,"column":16},"generated":{"line":8,"column":16}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":9,"column":19},"generated":{"line":8,"column":19}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":9,"column":20},"generated":{"line":8,"column":20}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":9,"column":9},"generated":{"line":8,"column":26}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":9,"column":30},"generated":{"line":8,"column":30}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":9,"column":33},"generated":{"line":8,"column":33}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":9,"column":34},"generated":{"line":8,"column":34}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":9,"column":30},"generated":{"line":8,"column":40}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":9,"column":41},"generated":{"line":8,"column":41}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":9,"column":2},"generated":{"line":8,"column":46}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":10,"column":1},"generated":{"line":9,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":8,"column":0},"generated":{"line":11,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":8,"column":0},"generated":{"line":11,"column":7}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":8,"column":0},"generated":{"line":11,"column":8}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":8,"column":0},"generated":{"line":11,"column":24}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":8,"column":0},"generated":{"line":11,"column":27}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":8,"column":0},"generated":{"line":11,"column":43}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":12,"column":0},"generated":{"line":13,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":12,"column":16},"generated":{"line":13,"column":9}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":12,"column":0},"generated":{"line":13,"column":30}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":13,"column":2},"generated":{"line":13,"column":31}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":12,"column":0},"generated":{"line":13,"column":34}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":13,"column":10},"generated":{"line":13,"column":36}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":15,"column":2},"generated":{"line":14,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":15,"column":9},"generated":{"line":14,"column":9}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":15,"column":12},"generated":{"line":14,"column":12}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":15,"column":16},"generated":{"line":14,"column":16}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":15,"column":19},"generated":{"line":14,"column":19}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":15,"column":20},"generated":{"line":14,"column":20}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":15,"column":2},"generated":{"line":14,"column":44}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":16,"column":1},"generated":{"line":15,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":12,"column":0},"generated":{"line":17,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":12,"column":0},"generated":{"line":17,"column":7}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":12,"column":0},"generated":{"line":17,"column":8}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":12,"column":0},"generated":{"line":17,"column":29}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":12,"column":0},"generated":{"line":17,"column":32}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":12,"column":0},"generated":{"line":17,"column":53}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":70,"column":0},"generated":{"line":19,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":70,"column":0},"generated":{"line":19,"column":4}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":70,"column":0},"generated":{"line":19,"column":21}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":70,"column":0},"generated":{"line":19,"column":24}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":70,"column":0},"generated":{"line":19,"column":36}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":84,"column":2},"generated":{"line":20,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":84,"column":2},"generated":{"line":20,"column":11}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":84,"column":2},"generated":{"line":20,"column":28}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":84,"column":14},"generated":{"line":20,"column":29}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":84,"column":2},"generated":{"line":20,"column":34}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":84,"column":36},"generated":{"line":20,"column":36}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":84,"column":2},"generated":{"line":20,"column":41}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":84,"column":53},"generated":{"line":20,"column":43}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":85,"column":4},"generated":{"line":21,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":85,"column":9},"generated":{"line":21,"column":9}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":85,"column":4},"generated":{"line":21,"column":14}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":85,"column":17},"generated":{"line":21,"column":17}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":85,"column":4},"generated":{"line":21,"column":22}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":86,"column":4},"generated":{"line":22,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":86,"column":9},"generated":{"line":22,"column":9}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":86,"column":4},"generated":{"line":22,"column":14}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":86,"column":17},"generated":{"line":22,"column":17}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":86,"column":4},"generated":{"line":22,"column":22}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":87,"column":3},"generated":{"line":23,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":97,"column":2},"generated":{"line":25,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":97,"column":2},"generated":{"line":25,"column":2}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":97,"column":2},"generated":{"line":25,"column":19}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":97,"column":2},"generated":{"line":25,"column":20}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":97,"column":2},"generated":{"line":25,"column":29}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":97,"column":2},"generated":{"line":25,"column":30}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":97,"column":2},"generated":{"line":25,"column":46}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":97,"column":2},"generated":{"line":25,"column":49}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":97,"column":2},"generated":{"line":25,"column":61}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":98,"column":4},"generated":{"line":26,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":98,"column":11},"generated":{"line":26,"column":11}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":98,"column":16},"generated":{"line":26,"column":16}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":98,"column":4},"generated":{"line":26,"column":33}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":99,"column":3},"generated":{"line":27,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":97,"column":2},"generated":{"line":27,"column":3}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":140,"column":2},"generated":{"line":29,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":140,"column":2},"generated":{"line":29,"column":2}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":140,"column":2},"generated":{"line":29,"column":19}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":140,"column":2},"generated":{"line":29,"column":20}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":140,"column":2},"generated":{"line":29,"column":29}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":140,"column":2},"generated":{"line":29,"column":30}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":140,"column":2},"generated":{"line":29,"column":48}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":140,"column":2},"generated":{"line":29,"column":51}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":140,"column":21},"generated":{"line":29,"column":61}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":140,"column":2},"generated":{"line":29,"column":68}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":140,"column":47},"generated":{"line":29,"column":70}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":141,"column":4},"generated":{"line":30,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":141,"column":9},"generated":{"line":30,"column":9}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":141,"column":4},"generated":{"line":30,"column":26}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":141,"column":29},"generated":{"line":30,"column":29}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":141,"column":4},"generated":{"line":30,"column":36}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":142,"column":3},"generated":{"line":31,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":140,"column":2},"generated":{"line":31,"column":3}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":160,"column":0},"generated":{"line":33,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":160,"column":0},"generated":{"line":33,"column":9}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":160,"column":0},"generated":{"line":33,"column":26}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":70,"column":0},"generated":{"line":34,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":70,"column":0},"generated":{"line":34,"column":1}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":70,"column":0},"generated":{"line":34,"column":3}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":70,"column":22},"generated":{"line":36,"column":0}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":70,"column":22},"generated":{"line":36,"column":7}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":70,"column":22},"generated":{"line":36,"column":8}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":70,"column":22},"generated":{"line":36,"column":25}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":70,"column":22},"generated":{"line":36,"column":28}},{"source":"../src/surface/buffer-management/buffer-manager-base.ts","name":null,"original":{"line":70,"column":22},"generated":{"line":36,"column":45}}],"sources":{"../src/surface/buffer-management/buffer-manager-base.ts":"import { Instance } from '../../instance-provider/instance';\nimport { InstanceDiff } from '../../instance-provider/instance-provider';\nimport { Vec2, Vec4 } from '../../math';\nimport { IInstanceAttributeInternal } from '../../types';\nimport { Layer } from '../layer';\nimport { LayerScene } from '../layer-scene';\n\nexport function isBufferLocation(val: any): val is IBufferLocation {\n  return val && val.buffer && val.buffer.value;\n}\n\nexport function isBufferLocationGroup(\n  val: any\n): val is IBufferLocationGroup<IBufferLocation> {\n  return val && val.propertyToBufferLocation;\n}\n\n/**\n * This defines a base information object that explains where in a buffer a value\n * is represented.\n */\nexport interface IBufferLocation {\n  /** This is the parent attribute of this location */\n  attribute: IInstanceAttributeInternal<Instance>;\n  /** For some buffer strategies, there is a concept of block that is used to tightly pack attributes together. */\n  block?: number;\n  /**\n   * This is the generic buffer object interface for accessing the actual buffer.\n   */\n  buffer: {\n    value: Float32Array | Uint8Array | Vec4[];\n  };\n  /**\n   * If the attribute has child attributes (attributes auto generated as a consequence of the attributes settings)\n   * then the children's buffer locations can be found here.\n   */\n  childLocations?: IBufferLocation[];\n  /**\n   * This is the instance index indicative of the instance positioning within the buffer.\n   * Keep in mind: This does NOT correlate to a lookup for an Instance object but rather for\n   * the instancing concept designed for GL Buffers.\n   */\n  instanceIndex: number;\n  /**\n   * This is the range within the buffer values should be injected for this location.\n   */\n  range: Vec2;\n}\n\n/**\n * Each instance that comes in can be associated with a group of buffer locations. A buffer location for each\n * instance attribute used in updates. So a grouping is several buffer locations that are keyed by\n * the instance's property's UIDs.\n */\nexport interface IBufferLocationGroup<T extends IBufferLocation> {\n  /** This is the instance index WITHIN THE BUFFERS. This does NOT have relevance to Instance type objects */\n  instanceIndex: number;\n  /** This is a map of property UIDs to an associated buffer location */\n  propertyToBufferLocation: { [key: number]: T };\n}\n\n/**\n * Layers manage instances and those instances require a form of binding to their associated buffers.\n * The buffers have to be intelligently created and managed in this tieing to maximize performance.\n * One can not have a buffer for every instance in most cases, so the buffer manager has to get instances\n * to cooperate sharing a buffer in whatever strategy possible that best suits the hardware and it's limitations.\n *\n * This provides a uniform interface between instances and their corresponding buffer.\n */\nexport abstract class BufferManagerBase<\n  T extends Instance,\n  U extends IBufferLocation\n> {\n  /** This is the list of changes in effect while this manager is processing requests */\n  changeListContext: InstanceDiff<T>[];\n  /** The layer this manager glues Instances to Buffers */\n  layer: Layer<T, any>;\n  /** The scene the layer is injecting elements into */\n  scene: LayerScene;\n\n  /**\n   * Base constructor. A manager always needs to be associated with it's layer and it's scene.\n   */\n  constructor(layer: Layer<T, any>, scene: LayerScene) {\n    this.layer = layer;\n    this.scene = scene;\n  }\n\n  /**\n   * This adds an instance to the manager and thus ties the instance to an IBuffer location\n   */\n  add: (instance: T) => U | IBufferLocationGroup<U> | undefined;\n\n  /**\n   * This allows a manager to clean up any contextual information it may have stored while processing changes.\n   */\n  changesProcessed() {\n    delete this.changeListContext;\n  }\n\n  /**\n   * Destroy all elements that consume GPU resources or consumes otherwise unreleaseable resources.\n   */\n  abstract destroy(): void;\n\n  /**\n   * Retrieves the buffer locations for the instance provided\n   */\n  abstract getBufferLocations(\n    instance: T\n  ): U | IBufferLocationGroup<U> | undefined;\n\n  /**\n   * This retrieves the property ID for the active attribute. This is necessary to prevent\n   * the need for lookups to find the active attribute.\n   */\n  abstract getActiveAttributePropertyId(): number;\n\n  /**\n   * This returns how many instances this buffer manager has grown to accommodate.\n   */\n  abstract getInstanceCount(): number;\n\n  /**\n   * This should provide a minimum property id list that represents a set of properties that if triggered\n   * for update, would cause all of the attributes to be updated for the layer.\n   */\n  abstract getUpdateAllPropertyIdList(): number[];\n\n  /**\n   * This will be called with the changes that WILL be processed. This allows this manager to make extra judgement calls on\n   * how it will process the changes and let's it optimize itself before changes are actually processed. An example optimization:\n   *\n   * The manager is receiving add requests. The manager receives an add request that triggers a resize of the buffer. Ideally,\n   * the buffer should perform a single resize operation to accommodate ALL add requests getting ready to stream in plus the\n   * current size of of the buffer. With this method, the changes will be available to the manager and let the manager make this\n   * important decision instead of reflexively grow the buffer as requests stream in, which can cause a large number of costly\n   * resize operations.\n   */\n  incomingChangeList(changes: InstanceDiff<T>[]) {\n    this.changeListContext = changes;\n  }\n\n  /**\n   * This method checks to see if this buffer manager has linked an instance to a buffer\n   * location managed by this object.\n   */\n  abstract managesInstance(instance: T): boolean;\n\n  /**\n   * Disassociates an instance with it's buffer location and makes the instance\n   * in the buffer no longer drawable.\n   */\n  remove: (instance: T) => T;\n\n  /**\n   * Removes the manager from the scene it applied itself to.\n   */\n  abstract removeFromScene(): void;\n}\n"},"lineCount":null}},"error":null,"hash":"82e27670f9fcddf401bea3ab157cf47b","cacheData":{"env":{}}}