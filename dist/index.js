!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("three"),require("bowser")):"function"==typeof define&&define.amd?define(["three","bowser"],t):"object"==typeof exports?exports.voidgl=t(require("three"),require("bowser")):e.voidgl=t(e.three,e.bowser)}(window,function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=115)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR"}(t.InstanceBlockIndex||(t.InstanceBlockIndex={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR",e[e.ATLAS=99]="ATLAS"}(t.InstanceAttributeSize||(t.InstanceAttributeSize={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR",e[e.MATRIX3=9]="MATRIX3",e[e.MATRIX4=16]="MATRIX4",e[e.ATLAS=99]="ATLAS"}(t.UniformSize||(t.UniformSize={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR"}(t.VertexAttributeSize||(t.VertexAttributeSize={})),function(e){e[e.VERTEX=0]="VERTEX",e[e.FRAGMENT=1]="FRAGMENT",e[e.ALL=2]="ALL"}(t.ShaderInjectionTarget||(t.ShaderInjectionTarget={})),function(e){e[e.NONE=0]="NONE",e[e.ALL=1]="ALL",e[e.SINGLE=2]="SINGLE"}(t.PickType||(t.PickType={})),function(e){e[e.CHANGE=0]="CHANGE",e[e.INSERT=1]="INSERT",e[e.REMOVE=2]="REMOVE"}(t.InstanceDiffType||(t.InstanceDiffType={}))},function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.x=0,this.y=0,this.width=0,this.height=0,this.x=e.x||e.left||0,this.y=e.y||e.top||0,this.height=e.height||e.bottom-this.y||0,this.width=e.width||e.right-this.x||0}return Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mid",{get:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),e.emptyBounds=function(){return new e({height:0,width:0,x:0,y:0})},e.prototype.containsPoint=function(e){return!(e.x<this.x||e.y<this.y||e.x>this.right||e.y>this.bottom)},e.prototype.encapsulate=function(t){return t instanceof e?(t.x<this.x&&(this.width+=Math.abs(t.x-this.x),this.x=t.x),t.y<this.y&&(this.height+=Math.abs(t.y-this.y),this.y=t.y),this.right<t.right&&(this.width+=t.right-this.right),this.bottom<t.bottom&&(this.height+=t.bottom-this.bottom),!0):(t.x<this.x&&(this.width+=this.x-t.x,this.x=t.x),t.x>this.right&&(this.width+=t.x-this.x),t.y<this.y&&(this.height+=this.y-t.y,this.y=t.y),t.y>this.bottom&&(this.height+=t.y-this.y),!0)},e.prototype.fits=function(e){return this.width===e.width&&this.height===e.height?1:this.width>=e.width&&this.height>=e.height?2:0},e.prototype.hitBounds=function(e){return!(this.right<e.x||this.x>e.right||this.bottom<e.y||this.y>e.height)},e.prototype.isInside=function(e){return this.x>=e.x&&this.right<=e.right&&this.y>=e.y&&this.bottom<=e.bottom},e.prototype.toString=function(){return"{x: "+this.x+" y:"+this.y+" w:"+this.width+" h:"+this.height+"}"},e}();t.Bounds=r},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(111)),r(n(110))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.BottomLeft=0]="BottomLeft",e[e.BottomMiddle=1]="BottomMiddle",e[e.BottomRight=2]="BottomRight",e[e.Custom=3]="Custom",e[e.Middle=4]="Middle",e[e.MiddleLeft=5]="MiddleLeft",e[e.MiddleRight=6]="MiddleRight",e[e.TopLeft=7]="TopLeft",e[e.TopMiddle=8]="TopMiddle",e[e.TopRight=9]="TopRight"}(t.AnchorType||(t.AnchorType={})),function(e){e[e.ALWAYS=1]="ALWAYS",e[e.BOUND_MAX=2]="BOUND_MAX",e[e.NEVER=3]="NEVER"}(t.ScaleType||(t.ScaleType={}))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(0),s=n(8),c=n(10),u=n(99),l=n(98),h=function(e){function t(n){var r=e.call(this,n)||this;r.depth=0,r.instanceById=new Map,r.instanceVertexCount=0,r.props=Object.assign({},t.defaultProps||{},n);var i=r.props.picking,o=void 0===i?a.PickType.NONE:i;if(o===a.PickType.ALL){var c=r.getInstancePickingMethods();r.picking={currentPickMode:a.PickType.NONE,hitTest:c.hitTest,quadTree:new s.TrackedQuadTree(0,1,0,1,c.boundsAccessor),type:a.PickType.ALL}}else o===a.PickType.SINGLE?r.picking={currentPickMode:a.PickType.NONE,type:a.PickType.SINGLE,uidToInstance:new Map}:r.picking={currentPickMode:a.PickType.NONE,type:a.PickType.NONE};return r.diffManager=new u.InstanceDiffManager(r),r.diffProcessor=r.diffManager.getDiffProcessor(),r.interactions=new l.LayerInteractionHandler(r),r}return i(t,e),t.prototype.destroy=function(){this.uniformManager.destroy()},t.prototype.didUpdateProps=function(){},t.prototype.draw=function(){for(var e,t,n,r,i,o=this.props.data.changeList,a=this.diffProcessor,s=this.diffManager,c=0,u=o.length;c<u;++c)r=(n=o[c])[0],i=this.uniformManager.getUniforms(r),a[n[1]](s,r,i);this.props.data.resolve();for(c=0,u=this.uniforms.length;c<u;++c)e=this.uniforms[c],t=e.update(e),e.materialUniforms.forEach(function(e){return e.value=t})},t.prototype.getInstancePickingMethods=function(){throw new Error("When picking is set to PickType.ALL, the layer MUST have this method implemented; otherwise, the layer is incompatible with this picking mode.")},t.prototype.getModelType=function(){return{drawMode:o.TrianglesDrawMode,modelType:o.Mesh}},t.prototype.getMaterialOptions=function(){return{}},t.prototype.initShader=function(){return{fs:n(97),instanceAttributes:[],uniforms:[],vertexAttributes:[],vertexCount:0,vs:n(96)}},t.prototype.makeInstanceAttribute=function(e,t,n,r,i,o){return{atlas:o,block:e,blockIndex:t,name:n,size:r,update:i}},t.prototype.makeUniform=function(e,t,n,r,i){return{name:e,qualifier:i,shaderInjection:r,size:t,update:n}},t.prototype.willUpdateInstances=function(e){},t.prototype.willUpdateProps=function(e){},t.prototype.didUpdate=function(){this.props.data.resolve()},t.defaultProps={},t}(c.IdentifyByKey);t.Layer=h},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(2)),r(n(100))},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),o=0,a=function(){function e(t){this._uid=e.newUID,this._id=t.id,this.active=t.active}return Object.defineProperty(e,"newUID",{get:function(){return o=++o%16777215},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),r([i.observable],e.prototype,"active",void 0),e}();t.Instance=a},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(19)),r(n(7)),r(n(109)),r(n(18)),r(n(108)),r(n(40)),r(n(17)),r(n(39)),r(n(38))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(35)),r(n(77)),r(n(33)),r(n(32)),r(n(31)),r(n(76)),r(n(14)),r(n(30))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.key=e.key}return Object.defineProperty(e.prototype,"id",{get:function(){return this.key},enumerable:!0,configurable:!0}),e}();t.IdentifyByKey=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateLayerModel=function(e,t,n){var r=e.getModelType(),i=new r.modelType(t,n);return Boolean(i.isMesh)&&(i.drawMode=r.drawMode),i}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(47),a=n(2),s=n(10),c=n(17);function u(e){return"left"in e}!function(e){e[e.COLOR=1]="COLOR",e[e.DEPTH=2]="DEPTH",e[e.STENCIL=4]="STENCIL"}(t.ClearFlags||(t.ClearFlags={}));var l=function(e){function t(t){var n=e.call(this,t)||this;return n.depth=0,n.pixelRatio=window.devicePixelRatio,Object.assign(n,t),n}return i(t,e),t.prototype.screenToPixelSpace=function(e,t){var n=t||{x:0,y:0};return n.x=e.x*this.pixelRatio,n.y=e.y*this.pixelRatio,n},t.prototype.pixelSpaceToScreen=function(e,t){var n=t||{x:0,y:0};return n.x=e.x/this.pixelRatio,n.y=e.y/this.pixelRatio,n},t.prototype.screenToView=function(e,t){var n=this.screenToPixelSpace(e,t);return n.x=n.x-this.viewBounds.x,n.y=n.y-this.viewBounds.y,n},t.prototype.viewToScreen=function(e,t){var n={x:0,y:0};return n.x=e.x+this.viewBounds.x,n.y=e.y+this.viewBounds.y,this.pixelSpaceToScreen(n,t)},t.prototype.screenToWorld=function(e,t){var n=this.pixelSpaceToScreen(this.screenToView(e)),r=t||{x:0,y:0};return r.x=(n.x-this.camera.offset[0]*this.camera.scale[0])/this.camera.scale[0],r.y=(n.y-this.camera.offset[1]*this.camera.scale[1])/this.camera.scale[1],this.viewCamera.type===c.ViewCameraType.CUSTOM&&console.warn("Custom View Camera projections not supported yet"),r},t.prototype.worldToScreen=function(e,t){var n={x:0,y:0};return n.x=(e.x*this.camera.scale[0]+this.camera.offset[0]*this.camera.scale[0])*this.pixelRatio,n.y=(e.y*this.camera.scale[1]+this.camera.offset[1]*this.camera.scale[1])*this.pixelRatio,this.viewCamera.type===c.ViewCameraType.CUSTOM&&console.warn("Custom View Camera projections not supported yet"),this.viewToScreen(n,t)},t.prototype.viewToWorld=function(e,t){var n=t||{x:0,y:0},r=this.pixelSpaceToScreen(e);return n.x=(r.x-this.camera.offset[0]*this.camera.scale[0])/this.camera.scale[0],n.y=(r.y-this.camera.offset[1]*this.camera.scale[1])/this.camera.scale[1],this.viewCamera.type===c.ViewCameraType.CUSTOM&&console.warn("Custom View Camera projections not supported yet"),n},t.prototype.worldToView=function(e,t){var n=t||{x:0,y:0};return n.x=e.x*this.camera.scale[0]+this.camera.offset[0]*this.camera.scale[0],n.y=e.y*this.camera.scale[1]+this.camera.offset[1]*this.camera.scale[1],this.viewCamera.type===c.ViewCameraType.CUSTOM&&console.warn("Custom View Camera projections not supported yet"),n},t.prototype.fitViewtoViewport=function(e){if(this.viewCamera.type===c.ViewCameraType.CONTROLLED&&u(this.viewCamera.baseCamera)){var t=o.getAbsolutePositionBounds(this.viewport,e,this.pixelRatio),n=t.width,r=t.height,i={bottom:-r/2,far:1e7,left:-n/2,near:-100,right:n/2,top:r/2},s=this.viewCamera.baseCamera;Object.assign(s,i),s.position.set(-t.width/2*1,t.height/2*1,s.position.z),s.scale.set(1,-1,1),s.updateMatrix(),s.updateMatrixWorld(!0),s.updateProjectionMatrix(),this.viewBounds=t,this.viewBounds.data=this,this.screenBounds=new a.Bounds({height:this.viewBounds.height/this.pixelRatio,width:this.viewBounds.width/this.pixelRatio,x:this.viewBounds.x/this.pixelRatio,y:this.viewBounds.y/this.pixelRatio})}else u(this.viewCamera.baseCamera)||console.warn("Fit to viewport does not support non-orthographic cameras as a default behavior.")},t.DEFAULT_VIEW_ID="__default__",t}(s.IdentifyByKey);t.View=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1);function a(e,t){return e.depth-t.depth}var s=function(e){function t(t){var n=e.call(this,t)||this;return n.container=new o.Scene,n.pickingContainer=new o.Scene,n.layers=[],n.sortIsDirty=!1,n.viewById=new Map,n.container.frustumCulled=!1,n.container.autoUpdate=!1,n}return i(t,e),t.prototype.addLayer=function(e){this.layers.push(e),this.sortIsDirty=!0},t.prototype.addView=function(e){this.viewById.set(e.id,e)},t.prototype.destroy=function(){this.container=null},t.prototype.removeLayer=function(e){if(this.layers){var t=this.layers.indexOf(e);if(t>=0)return void this.layers.splice(t,1)}console.warn("Could not remove a layer from the scene as the layer was not a part of the scene to start. Scene:",this.id,"Layer:",e.id)},t.prototype.sortLayers=function(){this.sortIsDirty&&this.layers.sort(a)},t.DEFAULT_SCENE_ID="__default__",t}(n(10).IdentifyByKey);t.Scene=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this)||this;return n.label=t,n}return i(t,e),t}(n(15).BaseAtlasResource);t.LabelAtlasResource=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.sampleScale=1}}();t.BaseAtlasResource=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.SCREEN_CURVE=1]="SCREEN_CURVE"}(t.EdgeScaleType||(t.EdgeScaleType={})),function(e){e[e.LINE=0]="LINE",e[e.BEZIER=1]="BEZIER",e[e.BEZIER2=2]="BEZIER2"}(t.EdgeType||(t.EdgeType={})),function(e){e[e.ALL=0]="ALL",e[e.PASS_Y=1]="PASS_Y",e[e.PASS_X=2]="PASS_X"}(t.EdgeBroadphase||(t.EdgeBroadphase={}))},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.CONTROLLED=0]="CONTROLLED",e[e.CUSTOM=1]="CUSTOM"}(r=t.ViewCameraType||(t.ViewCameraType={}));var i=function(){return function(){this.type=r.CONTROLLED}}();t.ViewCamera=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shaderTemplate=function(e,t,n){var r=new Map,i=new Map,o=new Map,a=new Map,s=e.replace(/\$\{(\w+)\}/g,function(e,n){return a.set(n,(a.get(n)||0)+1),n in t?(r.set(n,(r.get(n)||0)+1),t[n]):(i.set(n,(i.get(n)||0)+1),"")});Object.keys(t).forEach(function(e){r.get(e)||o.set(e,(o.get(e)||0)+1)});var c={resolvedShaderOptions:r,shader:s,shaderProvidedOptions:a,unresolvedProvidedOptions:o,unresolvedShaderOptions:i};return n&&n.values.forEach(function(e){c.unresolvedProvidedOptions.get(e)?console.error(n.name+": Could not resolve all the required inputs. Input:",e):c.unresolvedShaderOptions.get(e)?console.error(n.name+": A required option was not provided in the options parameter. Option:",e):c.resolvedShaderOptions.get(e)||console.error(n.name+": A required option was not provided in the options parameter. Option:",e)}),c}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=0;function i(e,t){e&&t&&e.splice.apply(e,[0,t.length].concat(t))}var o=function(){function e(e){this._id=r++,this.offset=[0,0,0],this.scale=[1,1,1],e&&(i(this.offset,e.offset),i(this.scale,e.scale))}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.position=function(e){this.offset=e.slice(0)},e}();t.ChartCamera=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.getProjection=function(e){return this.mouseManager.getView(e)},e.prototype.getView=function(e){return this.mouseManager&&this.mouseManager.getView(e)||null},e.prototype.getViewScreenBounds=function(e){var t=this.mouseManager.getView(e);return t?t.screenBounds:null},e.prototype.setMouseManager=function(e){this.mouseManager=e},e}();t.EventManager=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(38),i=n(46);function o(e,t){return t.data.depth-e.data.depth}var a=function(){function e(e,t,n,r){var i=this;this.eventCleanup=[],this._waitingForRender=!0,this.getViewsUnderMouse=function(e){var t=i.quadTree.query(e);return t.sort(o),t},this.resize=function(){i._waitingForRender=!0},this.context=e,this.setViews(t),this.setControllers(n),this.addContextListeners(r)}return Object.defineProperty(e.prototype,"waitingForRender",{get:function(){return this._waitingForRender},set:function(e){this._waitingForRender=e,e||(this.quadTree=new i.QuadTree(0,0,0,0),this.quadTree.addAll(this.views.map(function(e){return e.bounds}).filter(Boolean)))},enumerable:!0,configurable:!0}),e.prototype.addContextListeners=function(e){var t=this,n=this.context,i=null,o=null;if(e){var a=function(e){var a=r.eventElementPosition(e,n),s=t.makeInteraction(a,o,i),c=t.makeWheel(e);t.controllers.forEach(function(e){e.handleWheel(s,c)}),e.stopPropagation(),e.preventDefault()};"onwheel"in n&&(n.onwheel=a),"addEventListener"in n&&(n.addEventListener("DOMMouseScroll",a),this.eventCleanup.push(["DOMMouseScroll",a]))}n.onmouseleave=function(e){if(!t.waitingForRender){var a=r.eventElementPosition(e,n),s=t.makeInteraction(a,o,i);t.controllers.forEach(function(e){e.handleMouseOut(s)})}},n.onmousemove=function(e){if(!t.waitingForRender){var a=r.eventElementPosition(e,n),s=t.makeInteraction(a,o,i);t.controllers.forEach(function(e){e.handleMouseMove(s)})}},n.onmousedown=function(e){if(!t.waitingForRender){o=r.eventElementPosition(e,n);var a=t.getViewsUnderMouse(o),s=!0,c=Date.now();if(!(a.length<=0)){i=a[0].data;var u=t.makeInteraction(o,o,i),l=o;t.controllers.forEach(function(t){t.handleMouseDown(u,e.button)}),e.stopPropagation(),document.onmousemove=function(e){var a=r.eventElementPosition(e,n),c=t.makeInteraction(a,o,i),u={x:a.x-l.x,y:a.y-l.y},h=t.makeDrag(a,o,l,u);l=a,t.controllers.forEach(function(e){e.handleDrag(c,h)}),s=!1},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null,document.onmouseover=null},document.onmouseover=function(e){var a=r.eventElementPosition(e,n),s=t.makeInteraction(a,o,i);t.controllers.forEach(function(e){e.handleMouseOver(s)}),e.stopPropagation()},n.onmouseup=function(e){var a=r.eventElementPosition(e,n),u=t.makeInteraction(a,o,i);t.controllers.forEach(function(t){t.handleMouseUp(u,e.button)}),s&&Date.now()-c<1e3&&t.controllers.forEach(function(t){t.handleClick(u,e.button)})},n.onselectstart=function(){return!1}}}},this.addTouchContextListeners()},e.prototype.addTouchContextListeners=function(){var e=this.context;e.ontouchstart=function(e){},e.ontouchend=function(e){},e.ontouchmove=function(e){},e.ontouchcancel=function(e){}},e.prototype.getView=function(e){for(var t=0,n=this.views;t<n.length;t++){var r=n[t];if(r.view.id===e)return r.view}return null},e.prototype.makeDrag=function(e,t,n,r){return{screen:{current:e,delta:r,previous:n,start:t}}},e.prototype.makeInteraction=function(e,t,n){var r=this.getViewsUnderMouse(e);return{screen:{mouse:e},start:t&&n&&{mouse:n.view.screenToView(e),view:n.view},target:{mouse:r[0]&&r[0].data.view.screenToView(e),view:r[0]&&r[0].data.view},viewsUnderMouse:r.map(function(t){return{mouse:t.data.view.screenToView(e),view:t.data.view}})}},e.prototype.makeWheel=function(e){var t=r.normalizeWheel(e);return{wheel:[t.x,t.y]}},e.prototype.setControllers=function(e){this.controllers=e;for(var t=0,n=this.controllers;t<n.length;t++){n[t].setMouseManager(this)}},e.prototype.setViews=function(e){this.views=e},e.prototype.destroy=function(){var e=this;this.quadTree=null,this.context.onmousedown=null,this.context.onmousemove=null,this.context.onmouseleave=null,this.context.onmousewheel=null,this.eventCleanup.forEach(function(t){e.context.removeEventListener(t[0],t[1])})},e}();t.MouseEventManager=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);function i(e){return Object.assign({},e,{materialAttribute:null})}function o(e){return Object.assign({},e,{materialUniforms:[]})}function a(e,t){return e.atlas&&!t.atlas?-1:1}t.injectShaderIO=function(e,t){var n=[],s=new Map;t.instanceAttributes.forEach(function(e){if(e.atlas){e.size=r.InstanceAttributeSize.FOUR,e.blockIndex=r.InstanceBlockIndex.ONE;var t=e.atlas.shaderInjection||r.ShaderInjectionTarget.FRAGMENT,i=s.get(e.atlas.name);i?s.set(e.atlas.name,[i[0]||t===r.ShaderInjectionTarget.VERTEX||t===r.ShaderInjectionTarget.ALL,i[1]||t===r.ShaderInjectionTarget.FRAGMENT||t===r.ShaderInjectionTarget.ALL]):(n.push(e),s.set(e.atlas.name,[t===r.ShaderInjectionTarget.VERTEX||t===r.ShaderInjectionTarget.ALL,t===r.ShaderInjectionTarget.FRAGMENT||t===r.ShaderInjectionTarget.ALL]))}});var c,u,l,h,d=n.map(function(t){var n=s.get(t.atlas.name),i=n[0]&&n[1]&&r.ShaderInjectionTarget.ALL||n[0]&&!n[1]&&r.ShaderInjectionTarget.VERTEX||!n[0]&&n[1]&&r.ShaderInjectionTarget.FRAGMENT;return{name:t.atlas.name,shaderInjection:i,size:r.UniformSize.ATLAS,update:function(){return e.resource.getAtlasTexture(t.atlas.key)}}}).concat([{name:"projection",size:r.UniformSize.MATRIX4,update:function(){return e.view.viewCamera.baseCamera.projectionMatrix.elements}},{name:"modelView",size:r.UniformSize.MATRIX4,update:function(){return e.view.viewCamera.baseCamera.matrix.elements}},{name:"cameraOffset",size:r.UniformSize.THREE,update:function(){return e.view.camera.offset}},{name:"cameraScale",size:r.UniformSize.THREE,update:function(){return e.view.camera.scale}},{name:"viewSize",size:r.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:r.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]),p=(c=t.instanceAttributes,u=new Map,l=null,h=0,c.forEach(function(e){var t=e.block,n=e.blockIndex,r=e.size,i=u.get(t);h=Math.max(t,h),i||(i=new Map,u.set(t,i));for(var o=n,a=n+r;o<a;++o)i.set(o,!0)}),u.forEach(function(e,t){e.get(1)||(l=[t,r.InstanceBlockIndex.ONE]),e.get(2)||(l=[t,r.InstanceBlockIndex.TWO]),e.get(3)||(l=[t,r.InstanceBlockIndex.THREE]),e.get(4)||(l=[t,r.InstanceBlockIndex.FOUR])}),l||(l=[h+1,0]),l),f=[{block:p[0],blockIndex:p[1],name:"_active",size:r.InstanceAttributeSize.ONE,update:function(e){return[e.active?1:0]}}];if(e.picking.type===r.PickType.SINGLE){d.push({name:"pickingActive",shaderInjection:r.ShaderInjectionTarget.ALL,size:r.UniformSize.ONE,update:function(){return[e.picking.currentPickMode===r.PickType.SINGLE?1:0]}});var y=function(e){var t=new Map;e.forEach(function(e){t.set(e.block,!0)});for(var n=0;t.get(n);)n++;return n}(t.instanceAttributes.concat(f));f.push({block:y,blockIndex:r.InstanceBlockIndex.ONE,name:"_pickingColor",size:r.InstanceAttributeSize.FOUR,update:function(e){var t=16777215-e.uid;return[(t>>16)/255,((65280&t)>>8)/255,(255&t)/255,1]}})}e.activeAttribute=f[0];var v=[{name:"instance",size:r.VertexAttributeSize.ONE,update:function(){return[0]}}].concat(t.vertexAttributes).map(i),g=d.concat(t.uniforms).map(o);return{instanceAttributes:f.concat(t.instanceAttributes).sort(a),uniforms:g,vertexAttributes:v}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,o=n(1),a=n(0),s=((r={})[a.UniformSize.ONE]="f",r[a.UniformSize.TWO]="v2",r[a.UniformSize.THREE]="v3",r[a.UniformSize.FOUR]="v4",r[a.UniformSize.MATRIX3]="Matrix3fv",r[a.UniformSize.MATRIX4]="Matrix4fv",r),c=((i={})[a.UniformSize.ONE]=[0],i[a.UniformSize.TWO]=[0,0],i[a.UniformSize.THREE]=[0,0,0],i[a.UniformSize.FOUR]=[0,0,0,0],i[a.UniformSize.MATRIX3]=[0,0,0,0,0,0,0,0,0],i[a.UniformSize.MATRIX4]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i);function u(e){return{type:s[e.size],value:c[e.size]}}t.generateLayerMaterial=function(e,t,n,r,i){var a=e.getMaterialOptions();a.vertexShader=t,a.fragmentShader=n,a.uniforms={};for(var s=0,c=r.length;s<c;++s){var l=r[s],h=u(l);a.uniforms[l.name]=h}for(s=0,c=i.length;s<c;++s){var d=i[s];a.uniforms[d.name]={type:d.type,value:d.value}}return new o.RawShaderMaterial(a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);t.generateLayerGeometry=function(e,t,n){for(var i=[],o=0,a=t.length;o<a;++o){var s=t[o];i.push(new Float32Array(s.size*n*e))}var c,u,l,h,d,p=t.length;for(o=0,a=n;o<a;++o)for(var f=0;f<p;++f)if(u=t[f],c=i[f],l=u.update(o),d=l,Array.isArray(d[0]))h=!0;else for(var y=o*u.size,v=y+u.size,g=0;y<v;++y,++g)c[y]=l[g];for(h&&console.warn("A vertex buffer updating method should not use arrays of arrays of numbers."),o=0,a=t.length;o<a;++o)for(var m=t[o].size*n,b=(f=1,e);f<b;++f)i[o].copyWithin(m*f,0,m);var w=i[0];for(o=0,a=e;o<a;++o){var x=o*n;for(f=0;f<n;++f)w[f+x]=o}var _=new r.BufferGeometry;for(o=0,a=t.length;o<a;++o){var T=t[o],S=new r.BufferAttribute(i[o],T.size);T.materialAttribute=S,_.addAttribute(T.name,S)}return _}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.emptyBounds=function(){return new t({height:0,width:0,x:0,y:0})},t}(n(2).Bounds);t.DataBounds=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(19),o=n(17),a=n(13),s=n(12);t.generateDefaultScene=function(e){var t=e.canvas.height,n=e.canvas.width,c={aspectRatio:n/t,bottom:-t/2,far:1e7,left:-n/2,near:-100,right:n/2,top:t/2,viewSize:t},u=new o.ViewCamera;u.baseCamera=new r.OrthographicCamera(c.left,c.right,c.top,c.bottom,c.near,c.far),u.baseCamera.scale.set(1,-1,1),u.baseCamera.position.set(0,0,-300),u.baseCamera.updateMatrixWorld(!0),u.baseCamera.updateMatrix(),u.baseCamera instanceof r.OrthographicCamera&&u.baseCamera.updateProjectionMatrix();var l=new i.ChartCamera,h={bottom:0,left:0,right:0,top:0},d=new s.View({camera:l,key:s.View.DEFAULT_VIEW_ID,viewCamera:u,viewport:h}),p=new a.Scene({key:a.Scene.DEFAULT_SCENE_ID,views:[]});return p.addView(d),{camera:l,scene:p,view:d,viewCamera:u,viewport:h}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="u";t.makeInstanceUniformNameArray=function(){return"instanceData"},t.makeInstanceUniformNameTree=function(e){return""+r+e.toString(31)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.templateVars={attributeFragments:"attributeFragments",attributes:"attributes",blocksPerInstance:"blocksPerInstance",instanceBlockCount:"instanceBlockCount",instanceDataBinaryTree:"instanceDataBinaryTree",instanceDataRetrieval:"instanceDataRetrieval",instanceDestructuring:"instanceDestructuring",instanceFragments:"instanceFragments",instanceUniformDeclarations:"instanceUniformDeclarations",layerUniforms:"layerUniforms",picking:"picking",projectionMethods:"projectionMethods",shader:"shader",shaderInput:"shaderInput",vertexAttributes:"vertexAttributes"}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(75)),r(n(72))},function(e,t,n){"use strict";var r,i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=Math.floor,s=Math.max,c=Math.min,u=function(){function e(){}return e.awaitContext=function(){return i(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return r?[3,2]:(this.getContext(),[4,new Promise(function(e){return setTimeout(e,10)})]);case 1:return e.sent(),[3,0];case 2:return[2]}})})},e.calculateLabelSize=function(e,t,n){n&&this.calculateTrucatedText(e);var i=e.label,o=t||e.sampleScale||1;this.drawLabel(i,e.truncatedText,r,o);var a=this.measureContents(r),s=a.minX,c=a.minY,u=a.maxX,l=a.maxY;e.rasterization=e.rasterization||{texture:{height:0,width:0},world:{height:0,width:0}},n?(e.rasterization.texture={height:l-c,width:u-s},e.rasterization.canvas=this.createCroppedCanvas(e,c,s),this.calculateLabelSize(e,1,!1)):e.rasterization.world={height:l-c,width:u-s}},e.calculateTrucatedText=function(e){var t=e.label,n=t.maxWidth;if(n){this.drawLabel(t,t.text,r,1);var i=this.measureContents(r);if(i.maxX-i.minX<=n)e.truncatedText=t.text;else{for(var o=t.text,s=0,c=o.length,u=a((c-s)/2),l=0;c>s&&0!==u&&l++<50;){this.drawLabel(t,o.substr(0,u)+"...",r,1);var h=this.measureContents(r),d=h.minX;h.maxX-d<=n?s=u:c=u;var p=a((c-s)/2)+s;if(p===u)break;u=p}e.truncatedText=0===u?"...":o.substr(0,u)+"..."}}else e.truncatedText=t.text},e.createCroppedCanvas=function(e,t,n){var i=document.createElement("canvas"),o=i.getContext("2d");if(o){var a=e.rasterization.texture;i.width=a.width,i.height=a.height,o.imageSmoothingEnabled=!1,o.drawImage(r.canvas,n,t,a.width,a.height,0,0,a.width,a.height)}else console.warn("Could not create a canvas 2d context to generate a label's cropped image.");return i},e.drawLabel=function(e,t,n,r){var i=this.getLabelRasterizationFontSize(e,r);n.fillStyle="white",n.font=this.makeCSSFont(e,r),n.canvas.width=n.measureText(e.text).width+i,n.canvas.height=2*i,n.fillStyle="white",n.font=this.makeCSSFont(e,r),n.fillText(t,i/2,i/4+i)},e.getContext=function(){return r||(r=document.createElement("canvas").getContext("2d")),r},e.getLabelRasterizationFontSize=function(e,t){return e.fontSize*t},e.makeCSSFont=function(e,t){return e.fontWeight+" "+this.getLabelRasterizationFontSize(e,t)+"px "+e.fontFamily},e.measureContents=function(e){for(var t=e.canvas,n=t.width,r=t.height,i=e.getImageData(0,0,n,r).data,o=Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER,h=0;h<n;++h)for(var d=0;d<r;++d){i[d*(4*n)+4*h]>0&&(o=c(o,d),a=c(a,h),u=s(u,h),l=s(l,d))}return l+=2,u+=2,a-=1,o=s(o-=1,0),{minX:a=s(a,0),minY:o,maxX:u,maxY:l}},e.render=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this.awaitContext()];case 1:return t.sent(),e.label.fontSize>50?(console.warn("Labels only support font sizes up to 50"),[2,e]):(this.calculateLabelSize(e,e.sampleScale,!0),[2,e])}})})},e.renderSync=function(e){return this.getContext(),r?e.label.fontSize>50?(console.warn("Labels only support font sizes up to 50"),e):(this.calculateLabelSize(e,e.sampleScale,!0),e):(console.warn("Can not render a label synchronously without the canvas context being ready."),e)},e}();t.LabelRasterizer=u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this)||this;return n.image=t,n}return i(t,e),t}(n(15).BaseAtlasResource);t.ImageAtlasResource=o},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.awaitContext=function(e){return r(this,void 0,void 0,function(){var t,n;return i(this,function(r){switch(r.label){case 0:t=e.getContext("2d"),n=0,r.label=1;case 1:return!Boolean(t)&&n<100?[4,new Promise(function(e){return setTimeout(e,10)})]:[3,4];case 2:r.sent(),r.label=3;case 3:return t=e.getContext("2d"),++n,[3,1];case 4:return[2]}})})},e.makeCSS=function(e){return"rgba("+Math.floor(256*e.r)+", "+Math.floor(256*e.g)+", "+Math.floor(256*e.b)+", "+e.opacity+")"},e.render=function(e){return r(this,void 0,void 0,function(){var t,n;return i(this,function(r){switch(r.label){case 0:return t=document.createElement("canvas"),n=t.getContext("2d"),[4,this.awaitContext(t)];case 1:return r.sent(),n?(t.width=2,t.height=2,n.imageSmoothingEnabled=!1,n.fillStyle=this.makeCSS(e.color),n.fillRect(0,0,2,2),e.rasterization.canvas=t):console.warn("Could not create a canvas 2d context to generate a color for rasterization."),[2,e]}})})},e}();t.ColorRasterizer=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this)||this;return n.color=t,n}return i(t,e),t}(n(15).BaseAtlasResource);t.ColorAtlasResource=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.aspectRatio=1,this.atlasReferenceID="",this.atlasTexture=null,this.atlasTL={x:0,y:0},this.atlasTR={x:0,y:0},this.atlasBL={x:0,y:0},this.atlasBR={x:0,y:0},this.widthOnAtlas=0,this.heightOnAtlas=0,this.isValid=!1,this.pixelWidth=0,this.pixelHeight=0}}();t.SubTexture=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(10),s=n(78),c=n(34);!function(e){e[e._2=2]="_2",e[e._4=4]="_4",e[e._8=8]="_8",e[e._16=16]="_16",e[e._32=32]="_32",e[e._64=64]="_64",e[e._128=128]="_128",e[e._256=256]="_256",e[e._512=512]="_512",e[e._1024=1024]="_1024",e[e._2048=2048]="_2048",e[e._4096=4096]="_4096"}(t.AtlasSize||(t.AtlasSize={}));var u=function(e){function t(t){var n=e.call(this,t)||this;n.validResources=new Map;var r=document.createElement("canvas");return n.width=r.width=t.width,n.height=r.height=t.height,n.textureSettings=t.textureSettings,n.packing=new s.PackNode(0,0,t.width,t.height),n.updateTexture(r),n}return i(t,e),t.prototype.invalidateResource=function(e){var t={x:0,y:0};e.texture.aspectRatio=1,e.texture.atlasBL=t,e.texture.atlasBR=t,e.texture.atlasTL=t,e.texture.atlasTR=t,e.texture.atlasReferenceID="",e.texture.pixelWidth=0,e.texture.pixelHeight=0,e.texture.isValid=!1},t.prototype.setManager=function(e){this.manager=e},t.prototype.registerResource=function(e){if(void 0===this.validResources.get(e)){if(!e.texture||!e.texture.isValid)return e.texture||(e.texture=new c.SubTexture),e.texture.isValid=!0,this.validResources.set(e,!0),!0;console.warn("Atlas Error:",this.id,"Attempted to add a resource to an Atlas that is already a valid resource on another atlas.","Consider Creating a new resource to be loaded into this particular atlas.","Resource:",e)}else console.warn("Atlas Error:",this.id,"A resource was trying to be added to the atlas that has already been added before.","Consider creating a new resource to indicate what you want loaded to the atlas","Resource:",e);return!1},t.prototype.removeResource=function(e){this.validResources.get(e)?(this.validResources.set(e,!1),this.invalidateResource(e)):console.warn("Atlas Error:",this.id,"Attempted to remove a resource that does not exist on this atlas.","or the resource was already considered invalidated on this atlas.","Resource:",e)},t.prototype.updateTexture=function(e){if(this.texture){var t=this.texture.image;this.texture.dispose(),this.texture=new o.Texture(t)}else this.texture=new o.Texture(e);this.texture.generateMipmaps=!0,this.texture.premultiplyAlpha=!0,this.textureSettings&&Object.assign(this.texture,this.textureSettings),this.texture.needsUpdate=!0},t.prototype.destroy=function(){var e=this;this.texture.dispose(),this.validResources.forEach(function(t,n){e.invalidateResource(n)})},t}(a.IdentifyByKey);t.Atlas=u},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(82)),r(n(79))},function(e,t,n){(function(r){function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(105)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(o=++i)}),e.splice(o,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(106))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(107),o=n(1),a=n(37)("CommunicationsView:Mouse"),s=1/30,c=-.25,u=100,l=[0,0,0,0],h=.02,d=.1,p=.18,f=.7;t.normalizeWheel=r,i.firefox?(a("Using mouse wheel for firefox"),t.normalizeWheel=r=function(e){var t,n=e,r=0;return Math.sign(l[0])!==Math.sign(r)&&l.splice(0,l.length,0,0,0,0),t=n.deltaX*u,r=n.deltaY*u*h+l[0]*d+l[1]*p+l[2]*f,l.unshift(r),l.pop(),new o.Vector2(-t,-r)}):i.msie&&+i.version>=11?(a("Using mouse wheel for IE 11"),t.normalizeWheel=r=function(e){var t=e,n=t.deltaX;void 0===n&&(n=void 0!==t.wheelDeltaX?t.wheelDeltaX*s:0);var r=t.deltaY;return void 0===r&&(r=void 0!==t.wheelDeltaY?t.wheelDeltaY*s:(t.wheelDelta||-t.detail)*c),new o.Vector2(-n,-r)}):i.msedge?(a("Using mouse wheel for MS EDGE"),t.normalizeWheel=r=function(e){var t=e,n=t.deltaX,r=t.deltaY;void 0===n&&(n=void 0!==t.wheelDeltaX?t.wheelDeltaX*s:0),void 0===r&&(r=void 0!==t.wheelDeltaY?t.wheelDeltaY*s:t.wheelDelta||-t.detail);var i=new o.Vector2(n,-r);return i.multiplyScalar(.25),i}):(a("Using mouse wheel for Chrome"),t.normalizeWheel=r=function(e){var t=e;return new o.Vector2(t.deltaX,-t.deltaY)}),t.eventElementPosition=function(e,t){var n=0,r=0,i=0,o=0,a=t||e.nativeEvent&&e.nativeEvent.target||e.target;if(e||(e=window.event),e.pageX||e.pageY?(n=e.pageX,r=e.pageY):(e.clientX||e.clientY)&&(n=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),a.offsetParent)do{i+=a.offsetLeft,o+=a.offsetTop,a=a.offsetParent}while(a);return{x:n-i,y:r-o}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProgramInfo=function(e,t){for(var n={attributeCount:0,attributes:new Array,uniformCount:0,uniforms:new Array},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o={35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT"},a={35664:1,35665:1,35666:1,35667:1,35668:1,35669:1,35670:1,35671:1,35672:1,35673:1,35674:1,35675:3,35676:4,35678:1,35680:1,5120:1,5121:1,5122:1,5123:1,5124:1,5125:1,5126:1},s=0;s<r;++s){var c=e.getActiveUniform(t,s);c.typeName=o[c.type],n.uniforms.push(c),n.uniformCount+=c.size,c.size=c.size*a[c.type]}for(s=0;s<i;s++){var u=e.getActiveAttrib(t,s);u.typeName=o[u.type],n.attributes.push(u),n.attributeCount+=u.size}return n};var r,i=function(){function e(){}return e.MAX_VERTEX_UNIFORMS=0,e.MAX_FRAGMENT_UNIFORMS=0,e.MAX_ATTRIBUTES=0,e.WEBGL_SUPPORTED=!1,e.MAX_TEXTURE_SIZE=0,e}();t.WebGLStat=i,(r=function(){try{var e=document.createElement("canvas");return window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(e){return!1}}())&&(i.WEBGL_SUPPORTED=!0,i.MAX_VERTEX_UNIFORMS=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),i.MAX_FRAGMENT_UNIFORMS=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),i.MAX_ATTRIBUTES=r.getParameter(r.MAX_VERTEX_ATTRIBS),i.MAX_TEXTURE_SIZE=r.getParameter(r.MAX_TEXTURE_SIZE))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Math.sqrt;function i(e,t){return[e[0]+t[0],e[1]+t[1]]}function o(e,t){return[e[0]*t,e[1]*t]}function a(e,t){return[e[0]-t[0],e[1]-t[1]]}function s(e,t){return e[0]*t[0]+e[1]*t[1]}function c(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function u(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function l(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}function h(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function d(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3]]}function p(e,t){return[e[0]*t,e[1]*t,e[2]*t,e[3]*t]}function f(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3]]}function y(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}t.add2=i,t.scale2=o,t.subtract2=a,t.multiply2=function(e,t){return[e[0]*t[0],e[1]*t[1]]},t.dot2=s,t.linear2=function(e,t,n){return o(i(a(t,e),e),n)},t.length2=function(e){return r(s(e,e))},t.add3=c,t.scale3=u,t.subtract3=l,t.multiply3=function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2]]},t.linear3=function(e,t,n){return u(c(l(t,e),e),n)},t.length3=function(e){return r(h(e,e))},t.dot3=h,t.add4=d,t.scale4=p,t.subtract4=f,t.multiply4=function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3]]},t.dot4=y,t.linear4=function(e,t,n){return p(d(f(t,e),e),n)},t.length4=function(e){return r(y(e,e))}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.GATHER_OBSERVABLES=0]="GATHER_OBSERVABLES",e[e.BROADCAST=1]="BROADCAST"}(r=t.ObservableManagerMode||(t.ObservableManagerMode={}));var i=function(){function e(){}return e.mode=r.BROADCAST,e}();t.ObservableManager=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(14);function a(e){return e?[e.atlasTL.x,e.atlasTL.y,e.atlasBR.x,e.atlasBR.y]:[0,0,0,0]}var s=function(){function e(e){this.targetAtlas="",this.requestQueue=new Map,this.requestLookup=new Map,this.atlasManager=e.atlasManager}return e.prototype.dequeueRequests=function(){return r(this,void 0,void 0,function(){var e,t,n,r,o,a,s,c;return i(this,function(u){switch(u.label){case 0:e=!1,t=function(t,r){var o,a;return i(this,function(i){switch(i.label){case 0:return r.length>0?(e=!0,o=r.slice(0),r.length=0,[4,n.atlasManager.updateAtlas(t,o)]):[3,2];case 1:i.sent(),(a=n.requestLookup.get(t))&&o.forEach(function(e){var t=a.get(e);if(a.delete(e),t)for(var n=0,r=t;n<r.length;n++){var i=r[n],o=i[0],s=i[1];o.uniformManager.getUniforms(s)&&(s.active=!0)}}),i.label=2;case 2:return[2]}})},n=this,r=0,o=Array.from(this.requestQueue.entries()),u.label=1;case 1:return r<o.length?(a=o[r],s=a[0],c=a[1],[5,t(s,c)]):[3,4];case 2:u.sent(),u.label=3;case 3:return r++,[3,1];case 4:return[2,e]}})})},e.prototype.destroy=function(){this.atlasManager.destroy()},e.prototype.getAtlasTexture=function(e){var t=this.atlasManager.getAtlasTexture(e);return t?t.texture:null},e.prototype.request=function(e,t,n){var r=n.texture;if(r)return a(r);if(n instanceof o.LabelAtlasResource&&!n.label.text)return a(r);var i=this.requestLookup.get(this.targetAtlas);if(i){var s=i.get(n);if(s)return s.push([e,t]),t.active=!1,a(r)}else i=new Map,this.requestLookup.set(this.targetAtlas,i);t.active=!1;var c=this.requestQueue.get(this.targetAtlas);return c||(c=[],this.requestQueue.set(this.targetAtlas,c)),c.push(n),i.set(n,[[e,t]]),a(r)},e.prototype.setTargetAtlas=function(e){this.targetAtlas=e},e}();t.AtlasResourceManager=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=function(e){function t(t){var n=e.call(this)||this;return n.isOver=new Map,n.surface=t,n.sceneViews=t.sceneViews,n}return i(t,e),t.prototype.getSceneViewsUnderMouse=function(e){for(var t=new Map,n=0,r=this.sceneViews;n<r.length;n++){var i=r[n];t.set(i.view.id,i)}return e.viewsUnderMouse.map(function(e){return t.get(e.view.id)})},t.prototype.getMouseByViewId=function(e){for(var t=new Map,n=0,r=e.viewsUnderMouse;n<r.length;n++){var i=r[n];t.set(i.view.id,i.mouse)}return t},t.prototype.handleClick=function(e,t){this.handleInteraction(e,function(e,n,r){return e.interactions.handleMouseClick(n,r,t)})},t.prototype.handleDrag=function(e,t){this.handleInteraction(e,function(e,t,n){return e.interactions.handleMouseDrag(t,n)})},t.prototype.handleInteraction=function(e,t){for(var n=this.getSceneViewsUnderMouse(e),r=this.getMouseByViewId(e),i=0,o=n;i<o.length;i++){var a=o[i];this.handleSceneView(a,r,t)}return n},t.prototype.handleMouseDown=function(e,t){this.handleInteraction(e,function(e,n,r){return e.interactions.handleMouseDown(n,r,t)})},t.prototype.handleMouseUp=function(e,t){this.handleInteraction(e,function(e,n,r){return e.interactions.handleMouseUp(n,r,t)})},t.prototype.handleMouseOver=function(e){},t.prototype.handleMouseOut=function(e){var t=this,n=this.getMouseByViewId(e),r=e.screen.mouse;this.isOver.forEach(function(e,i){n.set(i.view.id,i.view.screenToView(r)),t.handleSceneView(i,n,function(e,t,n){return e.interactions.handleMouseOut(t,n)})}),this.isOver.clear()},t.prototype.handleMouseMove=function(e){var t=this;this.surface&&this.surface.updateColorPickRange([e.screen.mouse.x,e.screen.mouse.y],e.viewsUnderMouse.map(function(e){return e.view}));var n=this.handleInteraction(e,function(e,t,n){return e.interactions.handleMouseMove(t,n)}),r=this.getMouseByViewId(e),i=e.screen.mouse,o=new Map;n.forEach(function(e){return o.set(e,!0)}),o.forEach(function(e,n){t.isOver.get(n)||t.handleSceneView(n,r,function(e,t,n){return e.interactions.handleMouseOver(t,n)})}),this.isOver.forEach(function(e,n){o.get(n)||(r.set(n.view.id,n.view.screenToView(i)),t.handleSceneView(n,r,function(e,t,n){return e.interactions.handleMouseOut(t,n)}))}),this.isOver=o},t.prototype.handleSceneView=function(e,t,n){for(var r=e.view,i=t.get(r.id),a=0,s=e.scene.layers;a<s.length;a++){var c=s[a];c.picking&&c.picking.type!==o.PickType.NONE&&n(c,r,i)}},t.prototype.handleWheel=function(e){},t}(n(20).EventManager);t.LayerMouseEvents=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(11),o=n(0),a=n(27),s=function(){function e(e,t){this.buffers=[],this.availableClusters=[],this.instanceToCluster=new Map,this.clusterToBuffer=new Map,this.layer=e;var n=0;e.instanceAttributes.forEach(function(e){n=Math.max(e.block,n)}),this.uniformBlocksPerInstance=n+1,this.scene=t}return e.prototype.add=function(e){this.availableClusters.length<=0&&this.makeNewBuffer();var t=this.availableClusters.pop();return t?this.instanceToCluster.set(e.uid,t):console.warn("No valid cluster available for instance added to uniform manager."),t},e.prototype.destroy=function(){this.buffers.forEach(function(e){e.geometry.dispose(),e.material.dispose()})},e.prototype.getUniforms=function(e){return this.instanceToCluster.get(e.uid)},e.prototype.remove=function(e){var t=this.instanceToCluster.get(e.uid);return t&&(this.instanceToCluster.delete(e.uid),this.availableClusters.push(t)),t},e.prototype.removeFromScene=function(){var e=this;this.buffers.forEach(function(t,n){e.scene.container.remove(t.model),t.pickModel&&e.scene.pickingContainer.remove(t.pickModel)}),this.scene=null},e.prototype.setScene=function(e){var t=this;this.buffers.forEach(function(e,n){t.scene.container.add(e.model),e.pickModel&&t.scene.pickingContainer.add(e.pickModel)}),this.scene=e},e.prototype.makeNewBuffer=function(){var e=new r.BufferGeometry;this.layer.vertexAttributes.forEach(function(t){e.addAttribute(t.name,t.materialAttribute)}),e.drawRange.start=0,e.drawRange.count=this.layer.maxInstancesPerBuffer*this.layer.instanceVertexCount;var t=this.layer.material.clone(),n=i.generateLayerModel(this.layer,e,t);n.frustumCulled=!1;var s={activeInstances:[],clusters:[],firstInstance:0,geometry:e,lastInstance:0,material:t,model:n,pickModel:this.layer.picking.type===o.PickType.SINGLE&&n.clone()};this.buffers.push(s);var c=0,u=a.makeInstanceUniformNameArray(),l=t.uniforms[u];l.value=l.value.map(function(){return new r.Vector4(0,0,0,0)});for(var h=0,d=this.layer.maxInstancesPerBuffer;h<d;++h){var p={instanceIndex:h,uniform:l,uniformRange:[c,0]};c+=this.uniformBlocksPerInstance,p.uniformRange[1]=c,s.clusters.push(p),this.availableClusters.push(p),this.clusterToBuffer.set(p,s)}for(h=0,d=this.layer.uniforms.length;h<d;++h){var f=this.layer.uniforms[h];f.materialUniforms.push(t.uniforms[f.name])}this.scene&&(this.scene.container.add(s.model),s.pickModel&&this.scene.pickingContainer.add(s.pickModel))},e}();t.InstanceUniformManager=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.analyzeColorPickingRendering=function(e,t,n,r){for(var i={allColors:[],colorData:t,dataHeight:r,dataWidth:n,mouse:e,nearestColor:0},o=new Map,a=0,s=[],c=n/2,u=r/2,l=0,h=Number.MAX_SAFE_INTEGER,d=0;d<r;++d){var p=[];s.push(p);for(var f=0;f<n;++f){var y=t[a],v=t[a+1],g=t[a+2];a+=4;var m=y<<16|v<<8|g;if(o.set(m,!0),p.push(m),0!==m){var b=f-c,w=d-u,x=b*b+w*w;x<h&&(h=x,l=m)}}}return i.allColors=Array.from(o.keys()),i.nearestColor=l,i}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2);t.filterQuery=function(e,t){var n=[];return t.forEach(function(t){e.find(function(e){return t instanceof e})&&n.push(t)}),n};var a=function(){function e(e,t){var n=e.mid;this.TL=new s(e.x,n.x,e.y,n.y,t),this.TR=new s(n.x,e.right,e.y,n.y,t),this.BL=new s(e.x,n.x,n.y,e.bottom,t),this.BR=new s(n.x,e.right,n.y,e.bottom,t)}return e.prototype.destroy=function(){this.TL.destroy(),this.TR.destroy(),this.BL.destroy(),this.BR.destroy(),delete this.TL,delete this.TR,delete this.BL,delete this.BR},e}();t.Quadrants=a;var s=function(){function e(e,t,n,r,i){this.children=[],this.depth=0,arguments.length>=4?this.bounds=new o.Bounds({height:n-r,width:t-e,x:e,y:n}):this.bounds=new o.Bounds({height:1,width:1,x:0,y:0}),this.depth=i||0}return e.prototype.destroy=function(){delete this.children,delete this.bounds,this.nodes&&(this.nodes.destroy(),delete this.nodes)},e.prototype.add=function(e,t){return e.isInside(this.bounds)?this.doAdd(e):(this.cover(e),this.add(e,t))},e.prototype.addAll=function(e,t){var n=this;t=t||[];var r=Number.MAX_VALUE,i=Number.MAX_VALUE,a=-Number.MAX_VALUE,s=-Number.MAX_VALUE;e.forEach(function(e){e.x<r&&(r=e.x),e.right>a&&(a=e.right),e.bottom>s&&(s=e.bottom),e.y<i&&(i=e.y)}),this.cover(new o.Bounds({height:s-i,width:a-r,x:r,y:i})),e.forEach(function(e,t){return n.doAdd(e)})},e.prototype.cover=function(e){var t=this;if(!e.isInside(this.bounds)){this.bounds.encapsulate(e),this.bounds.x-=1,this.bounds.y-=1,this.bounds.width+=2,this.bounds.height+=4;var n=this.gatherChildren([]);this.nodes&&(this.nodes.destroy(),delete this.nodes),n.forEach(function(e,n){return t.doAdd(e)})}},e.prototype.doAdd=function(e){return this.nodes?e.isInside(this.nodes.TL.bounds)?this.nodes.TL.doAdd(e):e.isInside(this.nodes.TR.bounds)?this.nodes.TR.doAdd(e):e.isInside(this.nodes.BL.bounds)?this.nodes.BL.doAdd(e):e.isInside(this.nodes.BR.bounds)?this.nodes.BR.doAdd(e):(this.children.push(e),!0):e.isInside(this.bounds)?(this.children.push(e),this.children.length>5&&this.depth<10&&this.split(),!0):(isNaN(e.width+e.height+e.x+e.y)?console.error("Child did not fit into bounds because a dimension is NaN",e):0===e.area&&console.error("Child did not fit into bounds because the area is zero",e),!0)},e.prototype.gatherChildren=function(e){return e=e.concat(this.children),this.nodes&&(this.nodes.TL.gatherChildren(e),this.nodes.TR.gatherChildren(e),this.nodes.BL.gatherChildren(e),this.nodes.BR.gatherChildren(e)),e},e.prototype.query=function(e,t){return e instanceof o.Bounds?e.hitBounds(this.bounds)?this.queryBounds(e,[],t):[]:this.bounds.containsPoint(e)?this.queryPoint(e,[],t):[]},e.prototype.queryBounds=function(e,t,n){return this.children.forEach(function(n,r){n.hitBounds(e)&&t.push(n)}),n&&n(this),this.nodes&&(e.hitBounds(this.nodes.TL.bounds)&&this.nodes.TL.queryBounds(e,t,n),e.hitBounds(this.nodes.TR.bounds)&&this.nodes.TR.queryBounds(e,t,n),e.hitBounds(this.nodes.BL.bounds)&&this.nodes.BL.queryBounds(e,t,n),e.hitBounds(this.nodes.BR.bounds)&&this.nodes.BR.queryBounds(e,t,n)),t},e.prototype.queryPoint=function(e,t,n){return this.children.forEach(function(n,r){n.containsPoint(e)&&t.push(n)}),n&&n(this),this.nodes&&(this.nodes.TL.bounds.containsPoint(e)&&this.nodes.TL.queryPoint(e,t,n),this.nodes.TR.bounds.containsPoint(e)&&this.nodes.TR.queryPoint(e,t,n),this.nodes.BL.bounds.containsPoint(e)&&this.nodes.BL.queryPoint(e,t,n),this.nodes.BR.bounds.containsPoint(e)&&this.nodes.BR.queryPoint(e,t,n)),t},e.prototype.split=function(){var e=this.gatherChildren([]);for(this.nodes=new a(this.bounds,this.depth+1),this.children=[];e.length>0;){var t=e.pop();t&&this.doAdd(t)}},e.prototype.visit=function(e){var t=Boolean(e(this));this.nodes&&!t&&(this.nodes.TL.visit(e),this.nodes.TR.visit(e),this.nodes.BL.visit(e),this.nodes.BR.visit(e))},e}();t.Node=s;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(s);t.QuadTree=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25);function i(e,t,n){var r=""+e,i=parseFloat(r);return isNaN(i)?0:r.indexOf("%")>-1?i/100*t:i*n}t.getAbsolutePositionBounds=function(e,t,n){0!==t.width&&0!==t.height||console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are non-zero.","item:",e,"reference:",t.toString());var o,a,s=r.DataBounds.emptyBounds();if(e.width)s.width=i(e.width,t.width,n),"left"in e?s.x=i(e.left,t.width,n):"right"in e&&(s.x=t.width-i(e.right,t.width,n)-s.width);else{var c=i(e.left,t.width,n);(o=t.width-i(e.right,t.width,n)-c)<0&&console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are greater than zero.","item:",e,"reference:",t.toString()),s.x=c,s.width=o}if(e.height)s.height=i(e.height,t.height,n),"top"in e?s.y=i(e.top,t.height,n):"bottom"in e&&(s.y=t.height-i(e.bottom,t.height,n)-s.height);else{var u=i(e.top,t.height,n);a=t.height-i(e.bottom,t.height,n)-u,o<0&&console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are greater than zero.","item:",e,"reference:",t.toString()),s.y=u,s.height=a}return(0===s.width||0===s.height||isNaN(s.x+s.y+s.width+s.height))&&(s.x=0,s.y=0,s.width=t.width,s.height=t.height),s}},function(e,t){e.exports="// This portion is where the shader assigns the picking color that gets passed to the fragment shader\n  _picking_color_pass_ = _pickingColor;\n"},function(e,t){e.exports="lowp vec4 setColor(vec4 color) {\n  gl_FragColor = color;\n  return gl_FragColor;\n}\n"},function(e,t){e.exports="precision lowp float;\n\n// This contains the method required to be used on a fragment shader when a layer desires to use\n// PickType.SINGLE (color picking).\nvarying vec4 _picking_color_pass_;\n\nvec4 setColor(vec4 color) {\n  gl_FragColor = mix(color, _picking_color_pass_, pickingActive);\n\n  if (color.a == 0.0) {\n    discard;\n  }\n\n  return gl_FragColor;\n}\n"},function(e,t){e.exports="// This is the varying auto generated for the fragment shader that is needed in the vertex shader to pass the\n// color for the instance through to the fragment shader\nvarying vec4 _picking_color_pass_;\n"},function(e,t){e.exports="// These are projection methods utilizing the simpler camera breakdown approach\n\nvec3 cameraSpace(vec3 world) {\n  return (world + cameraOffset) * cameraScale;\n}\n\nvec3 cameraSpaceSize(vec3 worldSize) {\n  return worldSize * cameraScale;\n}\n\nvec4 clipSpace(vec3 world) {\n  return vec4(((projection * modelView) * vec4(cameraSpace(world), 1.0)).xyz, 1.0);\n}\n\nvec4 clipSpaceSize(vec3 worldSize) {\n  return vec4(((projection * modelView) * vec4(cameraSpaceSize(worldSize), 0.0)).xyz, 1.0);\n}\n"},function(e,t){e.exports="// When instancing is enabled, it causes a major list of uniforms to be generated\n// it also generates a massive search tree to retrieve the correct unforms in question.\n${instanceUniformDeclarations}\n\n// This is the uniforms provided by the system along with the uniforms created by the layer\n${layerUniforms}\n\n// This is the attributes generated for vertex attributes\n${vertexAttributes}\n\n// This is the methods and set up needed to retrieve a block of data for an instance\n${instanceDataRetrieval}\n"},function(e,t){e.exports="// This is the injected dereferencing of the instance attributes\n  int instanceIndex = int(instance);\n  ${instanceDestructuring}\n\n  // This is a special injected instance attribute. It lets the system\n  // control specific instances ability to draw, which allows the backend\n  // system greater control on how it optimizes draw calls and it's buffers.\n  if (_active == 0.0) {\n    gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Quick exit to prevent any geometry from arising from the instance\n    return;\n  }\n\n  ${picking}\n"},function(e,t){e.exports="precision highp float;\n\n// This is the fragment shader generated by the system\n${layerUniforms}\n\n${picking}\n\n// --------------- The fragment shader provided by the layer ------------------\n${shader}\n"},function(e,t){e.exports="// This is the vertex shader generated by the system\n${shaderInput}\n${projectionMethods}\n${picking}\n// --------------- Vertex shader provided by the layer -----------------\n${shader}\n"},function(e,t){e.exports="int instanceSize = ${instanceBlockCount};\n\nvec4 getBlock(int index, int instanceIndex) {\n  return instanceData[(instanceSize * instanceIndex) + index];\n}\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(0),o=n(27),a=n(18),s=n(28),c=n(57),u=["x","y","z","w"],l={1:"float",2:"vec2",3:"vec3",4:"vec4",9:"mat3",16:"mat4",99:"vec4"};t.makeUniformArrayDeclaration=function(e){return{fragment:"uniform vec4 "+o.makeInstanceUniformNameArray()+"["+e+"];",materialUniforms:[{name:o.makeInstanceUniformNameArray(),type:"4fv",value:new Array(e).fill(0).map(function(){return new r.Vector4(0,0,0,0)})}]}},t.makeInstanceRetrievalArray=function(e){var t={};t[s.templateVars.instanceBlockCount]=""+e;var n={name:"makeInstanceRetrievalArray",values:[s.templateVars.instanceBlockCount]};return a.shaderTemplate(c,t,n).shader},t.makeInstanceDestructuringArray=function(e,t){for(var n="",r=0;r<t;++r)n+="  vec4 block"+r+" = getBlock("+r+", instanceIndex);\n";return e.forEach(function(e){var t,r,o=e.block;e.size===i.InstanceAttributeSize.FOUR?n+="  "+l[e.size]+" "+e.name+" = block"+o+";\n":e.atlas?n+="  "+l[i.InstanceAttributeSize.ATLAS]+" "+e.name+" = block"+o+";\n":n+="  "+l[e.size]+" "+e.name+" = block"+o+"."+(t=e.blockIndex,r=e.size,u.slice(t,t+r).join(""))+";\n"}),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(18),o=n(39),a=n(28),s=n(58),c=n(56),u=n(55),l=n(54),h=n(53),d=n(52),p=4,f={1:"float",2:"vec2",3:"vec3",4:"vec4",9:"mat3",16:"mat4",99:"sampler2D"};function y(e,t){var n="",i=t||r.ShaderInjectionTarget.VERTEX;return e.forEach(function(e){e.shaderInjection=e.shaderInjection||r.ShaderInjectionTarget.VERTEX,e.shaderInjection!==i&&e.shaderInjection!==r.ShaderInjectionTarget.ALL||(n+="uniform "+(e.qualifier||"")+(e.qualifier?" ":"")+f[e.size]+" "+e.name+";\n")}),n}t.injectFragments=function(e,t,v,g,m){var b=function(e,t,n,c){var u={},l=function(e,t,n,r){var i=o.WebGLStat.MAX_VERTEX_UNIFORMS-function(e){for(var t=0,n=0,r=e.length;n<r;++n)t+=Math.ceil(e[n].size/4);return t}(r),c=n.slice(0).sort(function(e,t){return e.block-t.block}),u=c[0].block,l=0,h=new Map,d=new Map;c.forEach(function(t){t.block!==u&&(u=t.block,l++);var n=t.size,r=h.get(l)||0,i=r+n;if(i>p)console.error("An instance attribute was specified that over fills the maximum allowed useage for a block.","\nSource Layer: "+e.id,"\nMax Allowed per block "+p,"\nAttribute: "+t.name+" Block Specified: "+t.block,"\nTotal blocks used with this attribute: "+i);else{h.set(l,i),t.blockIndex=r;var o=d.get(l)||new Map;if(t.blockIndex+n>p)console.error("An instance attribute was specified that would fill indices greater than the block allows.","\nMax index per block "+p,"\nAttribute: "+t.name+" Block Index: "+t.blockIndex+" Size: "+t.size+" Block Index + Size: "+(t.blockIndex+t.size));else{for(var a=t.blockIndex;a<t.blockIndex+n;++a)if(o.get(a))return void console.error("An instance attribute was specified who's block index overaps another attributes useage","\nMax index per block "+p,"\nAttribute: "+t.name+" Block Index: "+t.blockIndex+" Size: "+t.size+" Block Index + Size: "+(t.blockIndex+t.size));t.block=l}}});var f=l+1,y=Math.floor(i/f);return{materialUniforms:function(e,t,n,r){for(var i=[],o=0;o<t;++o)i.push(o);var c=function(e,t){var n="",r=new Map,i=0;t.forEach(function(e){var t=r.get(e.block)||new Map;t.set(e.qualifier,!0),i=Math.max(i,e.block)});var o=new Map;r.forEach(function(e,t){var n=Array.from(e.keys());o.set(t,n.join(" ")+" ")});var a=s.makeUniformArrayDeclaration(e);return n+=a.fragment,{fragment:n+="\n",materialUniforms:a.materialUniforms}}(t*n,r);return e[a.templateVars.instanceUniformDeclarations]=c.fragment,e[a.templateVars.instanceBlockCount]=""+n,e[a.templateVars.instanceDataRetrieval]=s.makeInstanceRetrievalArray(n),{materialUniforms:c.materialUniforms}}(t,y,f,c).materialUniforms,metrics:{blocksPerInstance:f,maxInstancesPerBuffer:y}}}(e,u,n,c),d=((v={})[a.templateVars.layerUniforms]=y(c,r.ShaderInjectionTarget.VERTEX),v[a.templateVars.vertexAttributes]=function(e){var t="";return e.forEach(function(e){t+="attribute "+f[e.size]+" "+(e.qualifier||"")+(e.qualifier?" ":"")+e.name+";\n"}),t}(t),v);Object.assign(u,d);var v,g={name:"shader input",values:[a.templateVars.instanceDataRetrieval,a.templateVars.instanceUniformDeclarations,a.templateVars.layerUniforms,a.templateVars.vertexAttributes]};return{fragment:i.shaderTemplate(h,u,g).shader,materialUniforms:l.materialUniforms,metrics:l.metrics}}(e,v,g,m),w=((_={})[a.templateVars.projectionMethods]=i.shaderTemplate(d,{},{name:"projection methods",values:[]}).shader,_[a.templateVars.picking]=function(e){return e.picking.type===r.PickType.SINGLE?n(51):""}(e),_[a.templateVars.shaderInput]=b.fragment,_[a.templateVars.shader]=function(e,t,o,c,u){var h,d=((h={})[a.templateVars.attributes]=function(e,t,o){var c={};c[a.templateVars.blocksPerInstance]=""+o,c[a.templateVars.instanceDestructuring]=function(e,t){return s.makeInstanceDestructuringArray(e,t)}(t,o),c[a.templateVars.picking]=function(e){return e.picking.type===r.PickType.SINGLE?n(48):""}(e);var u={name:"instance attributes fragment",values:[a.templateVars.instanceDestructuring]};return e.picking.type===r.PickType.SINGLE&&u.values.push(a.templateVars.picking),i.shaderTemplate(l,c,u).shader}(e,o,u),h),p={name:"layer vertex shader",values:[a.templateVars.attributes]};return i.shaderTemplate(t.vs,d,p).shader}(e,t,g,b.metrics.maxInstancesPerBuffer,b.metrics.blocksPerInstance),_),x={name:"vertex shader composition",values:[a.templateVars.projectionMethods,a.templateVars.shaderInput,a.templateVars.shader]};e.picking.type===r.PickType.SINGLE&&x.values.push(a.templateVars.picking);var _,T,S=i.shaderTemplate(c,w,x);return(T={})[a.templateVars.layerUniforms]=y(m,r.ShaderInjectionTarget.FRAGMENT),T[a.templateVars.shader]=function(e){return i.shaderTemplate(e.fs,{},{name:"layer fragment shader",values:[]}).shader}(t),T[a.templateVars.picking]=function(e){return e.picking.type===r.PickType.SINGLE?n(50):n(49)}(e),w=T,x={name:"fragment shader composition",values:[a.templateVars.layerUniforms,a.templateVars.shader]},e.picking.type===r.PickType.SINGLE&&x.values.push(a.templateVars.picking),{fs:i.shaderTemplate(u,w,x).shader,materialUniforms:b.materialUniforms,maxInstancesPerBuffer:b.metrics.maxInstancesPerBuffer,vs:S.shader}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(1),s=n(36),c=n(29),u=n(2),l=n(59),h=n(26),d=n(24),p=n(23),f=n(11),y=n(22),v=n(21),g=n(13),m=n(12),b=n(0),w=n(45),x=n(25),_=n(44),T=n(43),S=n(9),O=n(42),E=new o.Color(1,1,1);function I(e){return Boolean(e.getContext)}t.createLayer=function(e,t){return[e,t]};var M=function(){function e(){this.atlasManager=new S.AtlasManager,this.currentViewport=new Map,this.layers=new Map,this.pixelRatio=window.devicePixelRatio,this.scenes=new Map,this.sceneViews=[],this.willDisposeLayer=new Map,this.isBufferingAtlas=!1}return Object.defineProperty(e.prototype,"gl",{get:function(){return this.context},enumerable:!0,configurable:!0}),e.prototype.addLayer=function(e){return e.id?this.layers.get(e.id)?(console.warn("All layer's ids must be unique per layer manager"),e):(this.layers.set(e.id,e),this.initLayer(e),e):(console.warn("All layers must have an id"),e)},e.prototype.destroy=function(){this.layers.forEach(function(e){return e.destroy()}),this.resourceManager.destroy(),this.mouseManager.destroy(),this.sceneViews.forEach(function(e){return e.scene.destroy()}),this.renderer.dispose(),this.pickingRenderer.dispose(),this.currentViewport.clear(),c.LabelInstance.destroy(),s.ImageInstance.destroy()},e.prototype.draw=function(){return r(this,void 0,void 0,function(){var e,t,n,r,o,a,s,c,l,h,d,p,f,y,v,g,_,T,S,O,E;return i(this,function(i){switch(i.label){case 0:if(!this.gl)return[2];for(e=Array.from(this.scenes.values()),t=0,n=e.length;t<n;++t)for(r=e[t],o=Array.from(r.viewById.values()),a=r.layers,r.sortLayers(),s=0,c=o.length;s<c;++s){for(l=o[s],h=[],l.fitViewtoViewport(new u.Bounds({height:this.context.canvas.height,width:this.context.canvas.width,x:0,y:0})),T=0,S=a.length;T<S;++T)(O=a[T]).view=l,O.draw(),O.picking.type===b.PickType.SINGLE&&h.push(O);if(this.drawSceneView(r.container,l),h.length>0&&this.updateColorPick&&(d=this.updateColorPick.mouse,p=this.updateColorPick.views,l.id!==this.defaultSceneElements.view.id&&p.indexOf(l)>-1)){for(l.pixelRatio=1,f=l.clearFlags.slice(0),l.clearFlags=[m.ClearFlags.COLOR,m.ClearFlags.DEPTH],l.fitViewtoViewport(new u.Bounds({height:this.context.canvas.height/this.pixelRatio,width:this.context.canvas.width/this.pixelRatio,x:0,y:0})),T=0,S=h.length;T<S;++T)(O=h[T]).picking.currentPickMode=b.PickType.SINGLE,O.draw(),O.picking.currentPickMode=b.PickType.NONE;for(this.drawSceneView(r.pickingContainer,l,this.pickingRenderer,this.pickingTarget),y=5,v=5,g=new Uint8Array(y*v*4),this.pickingRenderer.readRenderTargetPixels(this.pickingTarget,d[0]-l.screenBounds.x-y/2,l.screenBounds.height-(d[1]-l.screenBounds.y)-v/2,y,v,g),_=w.analyzeColorPickingRendering(d,g,y,v),T=0,S=h.length;T<S;++T)(O=h[T]).picking.type===b.PickType.SINGLE&&(O.interactions.colorPicking=_);l.pixelRatio=this.pixelRatio,l.clearFlags=f,l.fitViewtoViewport(new u.Bounds({height:this.context.canvas.height,width:this.context.canvas.width,x:0,y:0}))}}return this.mouseManager.waitingForRender&&(this.sceneViews.forEach(function(e){e.bounds=new x.DataBounds(e.view.screenBounds),e.bounds.data=e}),this.mouseManager.waitingForRender=!1),this.isBufferingAtlas?[3,2]:(this.isBufferingAtlas=!0,[4,this.resourceManager.dequeueRequests()]);case 1:E=i.sent(),this.isBufferingAtlas=!1,E&&this.draw(),i.label=2;case 2:return delete this.updateColorPick,[2]}})})},e.prototype.drawSceneView=function(e,t,n,r){n=n||this.renderer;var i={x:t.viewBounds.left,y:t.viewBounds.top},o=t.viewBounds,a=n.getSize(),s=n.getPixelRatio();a.width*=s,a.height*=s;var c=t.background,u=n.getContext();r||(u.enable(u.SCISSOR_TEST),u.scissor(i.x,a.height-i.y-o.height,o.width,o.height),t.background&&u.clearColor(c[0],c[1],c[2],c[3])),t.clearFlags?r?(r.setSize(o.width,o.height),n.setRenderTarget(r),n.clear(t.clearFlags.indexOf(m.ClearFlags.COLOR)>-1,t.clearFlags.indexOf(m.ClearFlags.DEPTH)>-1,t.clearFlags.indexOf(m.ClearFlags.STENCIL)>-1)):n.getContext().clear((t.clearFlags.indexOf(m.ClearFlags.COLOR)>-1?u.COLOR_BUFFER_BIT:0)|(t.clearFlags.indexOf(m.ClearFlags.DEPTH)>-1?u.DEPTH_BUFFER_BIT:0)|(t.clearFlags.indexOf(m.ClearFlags.STENCIL)>-1?u.STENCIL_BUFFER_BIT:0)):r?(r.setSize(o.width,o.height),n.setRenderTarget(r),n.clear(!0,!0)):u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT),n.setViewport(i.x/s,i.y/s,o.width,o.height),n.render(e,t.viewCamera.baseCamera,r)},e.prototype.getViewSize=function(e){for(var t=0,n=this.sceneViews;t<n.length;t++){var r=n[t];if(r.view.id===e)return r.view.screenBounds}return null},e.prototype.getViewWorldBounds=function(e){for(var t=0,n=this.sceneViews;t<n.length;t++){var r=n[t];if(r.view.id===e){var i=r.view;if(i.screenBounds){var o=i.viewToWorld({x:0,y:0}),a=i.screenToWorld({x:i.screenBounds.right,y:i.screenBounds.bottom});return new u.Bounds({bottom:a.y,left:o.x,right:a.x,top:o.y})}return null}}return null},e.prototype.init=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.pixelRatio=e.pixelRatio||this.pixelRatio,this.setContext(e.context),this.gl?(this.initGL(e),this.initMouseManager(e),[4,this.initResources(e)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2,this]}})})},e.prototype.initGL=function(e){var t=this;if(this.context){var n=this.context.canvas,r=n.width,i=n.height;this.renderer=new o.WebGLRenderer({alpha:e.background&&e.background[3]<1,antialias:!0,canvas:n,preserveDrawingBuffer:!0}),this.pickingRenderer=new o.WebGLRenderer({alpha:!1,antialias:!1,preserveDrawingBuffer:!0}),this.renderer.autoClear=!1,this.renderer.setFaceCulling(o.CullFaceNone),this.setRendererSize(r,i),this.renderer.setPixelRatio(this.pixelRatio),e.background?this.renderer.setClearColor(new o.Color(e.background[0],e.background[1],e.background[2]),e.background[3]):this.renderer.setClearColor(E),this.pickingRenderer.autoClear=!1,this.pickingRenderer.setFaceCulling(o.CullFaceNone),this.pickingRenderer.setPixelRatio(1),this.pickingRenderer.setClearColor(new o.Color(0,0,0),1),this.defaultSceneElements=h.generateDefaultScene(this.context),this.defaultSceneElements.view.background=e.background,this.scenes.set(this.defaultSceneElements.scene.id,this.defaultSceneElements.scene);var a=0;this.sceneViews.push({depth:++a,scene:this.defaultSceneElements.scene,view:this.defaultSceneElements.view}),this.context.enable(this.context.SCISSOR_TEST),e.scenes&&e.scenes.forEach(function(e){var n=new g.Scene(e);0===e.views.length&&(n.addView(t.defaultSceneElements.view),t.sceneViews.push({depth:++a,scene:n,view:t.defaultSceneElements.view})),e.views.forEach(function(e){var r=new m.View(e);r.camera=r.camera||t.defaultSceneElements.camera,r.viewCamera=r.viewCamera||t.defaultSceneElements.viewCamera,r.viewport=r.viewport||t.defaultSceneElements.viewport,r.pixelRatio=t.pixelRatio,n.addView(r);for(var i=0,o=t.sceneViews;i<o.length;i++){o[i].view.id===r.id&&console.warn("You can NOT have two views with the same id. Please use unique identifiers for every view generated.")}t.sceneViews.push({depth:++a,scene:n,view:r})}),t.scenes.set(e.key,n)})}else console.error("Can not initialize Layer Surface as a valid GL context was not established.")},e.prototype.initLayer=function(e){e.resource=this.resourceManager;var t=this.addLayerToScene(e),n=e.initShader();n.instanceAttributes=n.instanceAttributes.filter(Boolean),n.vertexAttributes=n.vertexAttributes.filter(Boolean),n.uniforms=n.uniforms.filter(Boolean);var r=y.injectShaderIO(e,n),i=r.vertexAttributes,o=r.instanceAttributes,a=r.uniforms,s=l.injectFragments(e,n,i,o,a),c=d.generateLayerGeometry(s.maxInstancesPerBuffer,i,n.vertexCount),u=p.generateLayerMaterial(e,s.vs,s.fs,a,s.materialUniforms),h=f.generateLayerModel(e,c,u);return e.geometry=c,e.instanceAttributes=o,e.instanceVertexCount=n.vertexCount,e.material=u,e.maxInstancesPerBuffer=s.maxInstancesPerBuffer,e.model=h,e.uniforms=a,e.vertexAttributes=i,e.uniformManager=new _.InstanceUniformManager(e,t),e},e.prototype.initMouseManager=function(e){var t=[new T.LayerMouseEvents(this)].concat(e.eventManagers||[]);this.mouseManager=new v.MouseEventManager(this.context.canvas,this.sceneViews,t,e.handlesWheelEvents)},e.prototype.initResources=function(e){return r(this,void 0,void 0,function(){var t,n,r;return i(this,function(i){switch(i.label){case 0:if(!e.atlasResources)return[3,4];t=0,n=e.atlasResources,i.label=1;case 1:return t<n.length?(r=n[t],[4,this.atlasManager.createAtlas(r)]):[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return this.resourceManager=new O.AtlasResourceManager({atlasManager:this.atlasManager}),[2]}})})},e.prototype.addLayerToScene=function(e){var t=this.scenes.get(e.props.scene);return t||(t=this.defaultSceneElements.scene,e.props.scene&&console.warn("Layer specified a scene that is not within the layer surface manager. Layer will be added to the default scene.")),t.addLayer(e),t},e.prototype.removeLayer=function(e){return this.layers.get(e&&e.id)?(e.uniformManager.removeFromScene(),e.destroy(),this.layers.delete(e.id),e):(console.warn("Tried to remove a layer that is not in the manager.",e),e)},e.prototype.render=function(e){var t=this;this.gl&&(e&&e.length>0&&e.forEach(function(e){var n=e[0],r=e[1],i=t.layers.get(r.key);i?(i.willUpdateProps(r),Object.assign(i.props,r),i.didUpdateProps()):t.addLayer(new n(Object.assign({},n.defaultProps,r))),t.willDisposeLayer.set(r.key,!1)}),this.willDisposeLayer.forEach(function(e,n){e&&t.removeLayer(t.layers.get(n))}),this.willDisposeLayer.clear(),this.layers.forEach(function(e,n){t.willDisposeLayer.set(n,!0)}))},e.prototype.fitContainer=function(e){var t=this.context.canvas.parentElement;if(t){var n=this.context.canvas;n.className="",n.setAttribute("style",""),t.style.position="relative",n.style.position="absolute",n.style.left="0xp",n.style.top="0xp",n.style.width="100%",n.style.height="100%",n.setAttribute("width",""),n.setAttribute("height","");var r=t.getBoundingClientRect(),i=n.getBoundingClientRect();this.resize(i.width||100,r.height||100)}},e.prototype.resize=function(e,t,n){var r=this;this.pixelRatio=n||this.pixelRatio,this.sceneViews.forEach(function(e){return e.view.pixelRatio=r.pixelRatio}),this.setRendererSize(e,t),this.renderer.setPixelRatio(this.pixelRatio),this.pickingRenderer.setPixelRatio(1),this.mouseManager.resize()},e.prototype.setContext=function(e){if(e)if(Boolean(e.canvas))this.context=e;else if(I(e))this.context=e.getContext("webgl")||e.getContext("experimental-webgl"),this.context||console.warn("A valid GL context was not found for the context provided to the surface. This surface will not be able to operate.");else if(function(e){return Boolean(e.substr)}(e)){var t=document.getElementById(e);I(t)&&this.setContext(t)}},e.prototype.setRendererSize=function(e,t){e=e||100,t=t||100,this.renderer.setSize(e,t),this.pickingRenderer.setSize(e,t),this.pickingTarget||(this.pickingTarget=new a.WebGLRenderTarget(e,t,{magFilter:o.LinearFilter,minFilter:o.LinearFilter,stencilBuffer:!1})),this.pickingTarget.setSize(e,t)},e.prototype.updateColorPickRange=function(e,t){this.updateColorPick={mouse:e,views:t}},e}();t.LayerSurface=M},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(60)),r(n(20)),r(n(26)),r(n(24)),r(n(23)),r(n(11)),r(n(22)),r(n(5)),r(n(21)),r(n(13)),r(n(9)),r(n(12))},function(e,t){e.exports="precision highp float;\n\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float borderSize;\nvarying vec2 pointCoord;\n\nvoid main() {\n  ${attributes}\n\n  vertexColor = color * color.a;\n  float size = radius * scaleFactor;\n  borderSize = mix(\n    (thickness + 1.5) / size,\n    ((thickness * pixelRatio) / size),\n    float(pixelRatio > 1.0)\n  );\n  edgeSharpness = mix(0.8, 0.01, min((size * 3.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\n  pointCoord = (position.xy + vec2(1.0, 1.0)) / 2.0;\n\n  // Center within clip space\n  vec4 clipCenter = clipSpace(vec3(center, depth));\n  // Center in screen space\n  vec2 screenCenter = (clipCenter.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\n  // Position in screen space\n  vec2 vertex = (position.xy * size) + screenCenter;\n  // Position back to clip space\n  gl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), clipCenter.zw);\n}\n"},function(e,t){e.exports="precision highp float;\n\n${picking}\n\n/** This is the color of the ring */\nvarying vec4 vertexColor;\n/**\n * This is how sharp the ring renders. For tiny rings, it's best to have\n * less sharpness to better convey the shape of a circle. A good starter setting:\n * edgeSharpness = mix(0.8, 0.01, min(gl_PointSize / 45.0, 1.0));\n */\nvarying float edgeSharpness;\n/**\n * This should be a value that sets the thickness of the ring in normal space\n * relative to the PointSize\n */\nvarying float borderSize;\n/**\n * Since this is now a quad instead of a point sprite, this provides what gl_PointCoord\n * used to provide.\n */\nvarying vec2 pointCoord;\n\nfloat circle(vec2 coord, float radius){\n  vec2 dist = coord - vec2(0.5);\n\n  return 1.0 - smoothstep(\n    radius - (radius * edgeSharpness),\n    radius + (radius * 0.01),\n    dot(dist, dist) * 4.0\n  );\n}\n\nvoid main() {\n  float outer_step_factor = circle(pointCoord, 1.0);\n  float inner_step_factor = circle(pointCoord, 1.0 - borderSize);\n\n  setColor(mix(\n    mix(                        // Select the outer color outside of the inner radius\n      vec4(0.0, 0.0, 0.0, 0.0),    // Select invisible outside of inner and outer radius\n      vertexColor,                  // Select outer color outside of inner, but inside outer\n      outer_step_factor\n    ),\n    vec4(0.0, 0.0, 0.0, 0.0),                 // Select inner color inside inner\n    inner_step_factor\n  ));\n}\n"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(6),s=n(5),c=n(0),u=Math.max,l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getInstancePickingMethods=function(){return{boundsAccessor:function(e){return new a.Bounds({height:2*e.radius,width:2*e.radius,x:e.x-e.radius,y:e.y-e.radius})},hitTest:function(e,t,n){var r=e.radius/u.apply(void 0,n.camera.scale),i=[t.x-e.x,t.y-e.y];return i[0]*i[0]+i[1]*i[1]<r*r}}},t.prototype.initShader=function(){var e=this.props.scaleFactor||function(){return 1},t={0:1,1:1,2:-1,3:1,4:-1,5:-1},r={0:-1,1:-1,2:-1,3:1,4:1,5:1};return{fs:n(63),instanceAttributes:[{block:0,blockIndex:c.InstanceBlockIndex.ONE,name:"center",size:c.InstanceAttributeSize.TWO,update:function(e){return[e.x,e.y]}},{block:0,blockIndex:c.InstanceBlockIndex.THREE,name:"radius",size:c.InstanceAttributeSize.ONE,update:function(e){return[e.radius]}},{block:0,blockIndex:c.InstanceBlockIndex.FOUR,name:"depth",size:c.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{block:1,blockIndex:c.InstanceBlockIndex.ONE,name:"color",size:c.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{block:2,blockIndex:c.InstanceBlockIndex.ONE,name:"thickness",size:c.InstanceAttributeSize.ONE,update:function(e){return[e.thickness]}}],uniforms:[{name:"scaleFactor",size:c.UniformSize.ONE,update:function(t){return[e()]}}],vertexAttributes:[{name:"position",size:c.VertexAttributeSize.THREE,update:function(e){return[t[e],r[e],0]}}],vertexCount:6,vs:n(62)}},t.prototype.getModelType=function(){return{drawMode:o.TriangleStripDrawMode,modelType:o.Mesh}},t.prototype.getMaterialOptions=function(){return{premultipliedAlpha:!0,transparent:!0}},t}(s.Layer);t.RingLayer=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),s=function(e){function t(t){var n=e.call(this,t)||this;return n.color=[1,1,1,1],n.depth=0,n.radius=0,n.thickness=1,n.x=0,n.y=0,n.color=t.color||[1,1,1,1],n.depth=t.depth||0,n.radius=t.radius,n.thickness=t.thickness||n.thickness,n.x=t.x,n.y=t.y,n}return i(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerRadius",{get:function(){return this.radius-this.thickness},enumerable:!0,configurable:!0}),o([a.observable],t.prototype,"color",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"radius",void 0),o([a.observable],t.prototype,"thickness",void 0),o([a.observable],t.prototype,"x",void 0),o([a.observable],t.prototype,"y",void 0),t}(n(8).Instance);t.RingInstance=s},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(65)),r(n(64))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(3),c=n(7),u=n(4),l=((a={})[u.AnchorType.TopLeft]=function(e,t){e.x=-e.padding,e.y=-e.padding},a[u.AnchorType.TopMiddle]=function(e,t){e.x=t.width/2,e.y=-e.padding},a[u.AnchorType.TopRight]=function(e,t){e.x=t.width+e.padding,e.y=-e.padding},a[u.AnchorType.MiddleLeft]=function(e,t){e.x=-e.padding,e.y=t.height/2},a[u.AnchorType.Middle]=function(e,t){e.x=t.width/2,e.y=t.height/2},a[u.AnchorType.MiddleRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height/2},a[u.AnchorType.BottomLeft]=function(e,t){e.x=-e.padding,e.y=t.height+e.padding},a[u.AnchorType.BottomMiddle]=function(e,t){e.x=t.width/2,e.y=t.height+e.padding},a[u.AnchorType.BottomRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height+e.padding},a[u.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},a),h=function(e){function t(t){var n=e.call(this,t)||this;return n.color=[0,0,0,1],n.depth=0,n.height=1,n.scaling=u.ScaleType.BOUND_MAX,n.width=1,n.x=0,n.y=0,n._anchor={padding:0,type:u.AnchorType.TopLeft,x:0,y:0},n.depth=t.depth||n.depth,n.color=t.color||n.color,n.scaling=t.scaling||n.scaling,n.x=t.x||n.x,n.y=t.y||n.y,n.width=t.width||1,n.height=t.height||1,t.anchor&&n.setAnchor(t.anchor),n}return i(t,e),Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},enumerable:!0,configurable:!0}),t.prototype.setAnchor=function(e){var t={padding:e.padding||0,type:e.type,x:e.x||0,y:e.y||0};l[t.type](t,this),this._anchor=t},o([s.observable],t.prototype,"color",void 0),o([s.observable],t.prototype,"depth",void 0),o([s.observable],t.prototype,"height",void 0),o([s.observable],t.prototype,"scaling",void 0),o([s.observable],t.prototype,"width",void 0),o([s.observable],t.prototype,"x",void 0),o([s.observable],t.prototype,"y",void 0),o([s.observable],t.prototype,"_anchor",void 0),t}(c.Instance);t.RectangleInstance=h},function(e,t){e.exports="precision highp float;\n\nvarying vec4 vertexColor;\n\nvoid main() {\n  ${attributes}\n\n  // Figure out the size of the image as it'd show on the screen\n  vec3 screenSize = cameraSpaceSize(vec3(size, 1.0));\n  // Do the test for when the image is larger on the screen than the font size\n  bool largerOnScreen = screenSize.y > size.y;\n  // Determines if a scale mode should be used or not for the vertex\n  float useScaleMode = float(\n    (\n      scaling == 3.0 ||                  // NEVER mode - keep the image the same size always\n      (largerOnScreen && scaling == 2.0) // BOUND_MAX mode - only if we're larger than the font size do we scale down\n    ) &&\n    scaling != 1.0                       // ALWAYS mode - the image stays completely in world space allowing it to scale freely\n  );\n  // If zooms are unequal, assume one is filtered to be 1.0\n  float unequalZooms = float((cameraScale.x > cameraScale.y || cameraScale.y > cameraScale.x) && useScaleMode != 0.0);\n  // Destructure threejs's bug with the position requirement\n  float normal = position.x;\n  float side = position.y;\n  // Get the location of the anchor in world space\n  vec2 worldAnchor = location + anchor;\n  // Apply the image's tint as a tint to the image\n  vertexColor = color * color.a;\n\n  // Correct aspect ratio.\n  size = mix(\n    size,\n    (size * cameraScale.yx),\n    unequalZooms\n  );\n\n  vec2 adjustedAnchor = mix(\n    anchor,\n    (anchor * cameraScale.yx),\n    unequalZooms\n  );\n\n  vec2 vertex = vec2(side, float(normal == 1.0)) * size + location - adjustedAnchor;\n\n  // See how scaled the size on screen will be from the actual height of the image\n  float imageScreenScale = mix(\n    screenSize.y / size.y,\n    screenSize.x / size.x,\n    float((cameraScale.x < 1.0) || (cameraScale.x > 1.0))\n  );\n\n  // If our screen rendering is larger than the size the image is supposed to be, then we automagically\n  // scale down our image to stay the correct size, centered on the anchor point\n  vec2 anchorToVertex = vertex - location;\n\n  // We now choose between keeping the same image size or keeping it in world space\n  vertex = mix(\n    // This option keeps the image size in world space\n    vertex,\n    // This option counters the scaling of the image on the screen keeping it a static size\n    (anchorToVertex / imageScreenScale) + location,\n    // This is the flag determining if a scale mode should be applied to the vertex\n    useScaleMode\n  );\n\n  gl_Position = clipSpace(vec3(vertex, depth));\n}\n"},function(e,t){e.exports="precision highp float;\n\n${picking}\nvarying vec4 vertexColor;\n\nvoid main() {\n  setColor(vertexColor);\n}\n"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(6),s=n(5),c=n(0),u=n(4),l=Math.min,h=Math.max,d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getInstancePickingMethods=function(){return{boundsAccessor:function(e){var t=[e.x-e.anchor.x,e.y-e.anchor.y];return new a.Bounds({height:e.height,width:e.width,x:t[0],y:t[1]})},hitTest:function(e,t,n){var r=h.apply(void 0,n.camera.scale),i=l.apply(void 0,n.camera.scale);if(e.scaling===u.ScaleType.ALWAYS)return!0;if(e.scaling===u.ScaleType.BOUND_MAX){if(i<=1&&r<=1)return!0;var o=[e.x-e.anchor.x/r,e.y-e.anchor.y/r];return new a.Bounds({height:e.height/r,width:e.width/r,x:o[0],y:o[1]}).containsPoint(t)}if(e.scaling===u.ScaleType.NEVER){o=n.worldToScreen({x:e.x-e.anchor.x/n.camera.scale[0],y:e.y-e.anchor.y/n.camera.scale[1]});var s=n.worldToScreen(t);return new a.Bounds({height:e.height,width:e.width,x:o.x,y:o.y}).containsPoint(s)}return!0}}},t.prototype.initShader=function(){var e={0:1,1:1,2:-1,3:1,4:-1,5:-1},t={0:0,1:0,2:0,3:1,4:1,5:1};return{fs:n(69),instanceAttributes:[{block:0,blockIndex:c.InstanceBlockIndex.ONE,name:"location",size:c.InstanceAttributeSize.TWO,update:function(e){return[e.x,e.y]}},{block:0,blockIndex:c.InstanceBlockIndex.THREE,name:"anchor",size:c.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x,e.anchor.y]}},{block:1,blockIndex:c.InstanceBlockIndex.ONE,name:"size",size:c.InstanceAttributeSize.TWO,update:function(e){return[e.width,e.height]}},{block:1,blockIndex:c.InstanceBlockIndex.THREE,name:"depth",size:c.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{block:1,blockIndex:c.InstanceBlockIndex.FOUR,name:"scaling",size:c.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{block:3,blockIndex:c.InstanceBlockIndex.ONE,name:"color",size:c.InstanceAttributeSize.FOUR,update:function(e){return e.color}}],uniforms:[{name:"scaleFactor",size:c.UniformSize.ONE,update:function(e){return[1]}}],vertexAttributes:[{name:"position",size:c.VertexAttributeSize.THREE,update:function(n){return[e[n],t[n],0]}}],vertexCount:6,vs:n(68)}},t.prototype.getModelType=function(){return{drawMode:o.TriangleStripDrawMode,modelType:o.Mesh}},t.prototype.getMaterialOptions=function(){return{blending:o.CustomBlending,blendSrc:o.OneFactor,premultipliedAlpha:!0,transparent:!0}},t}(s.Layer);t.RectangleLayer=d},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(70)),r(n(67))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(3),c=n(9),u=n(7),l=n(4),h=new Map,d=((a={})[l.AnchorType.TopLeft]=function(e,t){e.x=-e.padding,e.y=-e.padding},a[l.AnchorType.TopMiddle]=function(e,t){e.x=t.width/2,e.y=-e.padding},a[l.AnchorType.TopRight]=function(e,t){e.x=t.width+e.padding,e.y=-e.padding},a[l.AnchorType.MiddleLeft]=function(e,t){e.x=-e.padding,e.y=t.height/2},a[l.AnchorType.Middle]=function(e,t){e.x=t.width/2,e.y=t.height/2},a[l.AnchorType.MiddleRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height/2},a[l.AnchorType.BottomLeft]=function(e,t){e.x=-e.padding,e.y=t.height+e.padding},a[l.AnchorType.BottomMiddle]=function(e,t){e.x=t.width/2,e.y=t.height+e.padding},a[l.AnchorType.BottomRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height+e.padding},a[l.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},a),p=function(e){function t(t){var n=e.call(this,t)||this;n.color=[0,0,0,1],n.depth=0,n.scaling=l.ScaleType.BOUND_MAX,n.scale=1,n.x=0,n.y=0,n._cssFont="",n._fontFamily="Arial",n._fontSize=12,n._fontStyle="normal",n._fontWeight=400,n._maxWidth=0,n._text="",n._width=0,n._height=0,n._isDestroyed=!1,n._anchor={padding:0,type:l.AnchorType.TopLeft,x:0,y:0},n.depth=t.depth||n.depth,n.color=t.color||n.color,n.scaling=t.scaling||n.scaling,n.scale=t.scale||n.scale,n.x=t.x||n.x,n.y=t.y||n.y,n._fontFamily=t.fontFamily||n._fontFamily,n._fontSize=t.fontSize||n._fontSize,n._fontStyle=t.fontStyle||n._fontStyle,n._fontWeight=t.fontWeight||n._fontWeight,n._maxWidth=t.maxWidth||0,n._text=t.text||n._text,n._cssFont=c.LabelRasterizer.makeCSSFont(n,1);var r,i=n._cssFont+"_"+n._maxWidth,o=h.get(n._text);return o?(r=o.get(i))&&r.references++:o=new Map,r||(r={references:1,resource:new c.LabelAtlasResource(n)},t.rasterization&&(r.resource.sampleScale=t.rasterization.scale||1),r.resource.sampleScale=r.resource.sampleScale||1,c.LabelRasterizer.renderSync(r.resource),h.set(n._text,o),o.set(i,r)),n._rasterization=r,n._width=r.resource.rasterization.world.width,n._height=r.resource.rasterization.world.height,t.anchor&&n.setAnchor(t.anchor),n}return i(t,e),t.destroy=function(){h.clear()},Object.defineProperty(t.prototype,"cssFont",{get:function(){return this._cssFont},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDestroyed",{get:function(){return this._isDestroyed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontFamily},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxWidth",{get:function(){return this._maxWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resource",{get:function(){return this._rasterization.resource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"truncatedText",{get:function(){return this._rasterization.resource.truncatedText||this.text},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,this._rasterization.references--,0===this._rasterization.references&&this._rasterization.resource)},Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},enumerable:!0,configurable:!0}),t.prototype.setAnchor=function(e){var t={padding:e.padding||0,type:e.type,x:e.x||0,y:e.y||0};d[t.type](t,this),this._anchor=t},o([s.observable],t.prototype,"color",void 0),o([s.observable],t.prototype,"depth",void 0),o([s.observable],t.prototype,"scaling",void 0),o([s.observable],t.prototype,"scale",void 0),o([s.observable],t.prototype,"x",void 0),o([s.observable],t.prototype,"y",void 0),o([s.observable],t.prototype,"_anchor",void 0),t}(u.Instance);t.LabelInstance=p},function(e,t){e.exports="precision highp float;\n\nvarying vec4 vertexColor;\nvarying vec2 texCoord;\n\nvoid main() {\n  ${attributes}\n\n  // Determine final screen size of label\n  vec3 screenSize = cameraSpaceSize(vec3(size * scale, 1.0));\n\n  // Test whether the label is larger on the screen than the font size\n  bool largerOnScreen = screenSize.y > size.y || screenSize.x > size.x;\n\n  // Determines if a scale mode should be used or not for the vertex\n  float useScaleMode = float(\n    (\n      scaling == 3.0 ||                  // NEVER mode - keep the image the same size always\n      (largerOnScreen && scaling == 2.0) // BOUND_MAX mode - only if we're larger than the font size do we scale down\n    ) &&\n    scaling != 1.0                       // ALWAYS mode - the image stays completely in world space allowing it to scale freely\n  );\n\n  // Correct aspect ratio.  Sufficient fix for most applications.\n  // Will need another solution in the case of:\n  //  (cameraScale y != cameraScale.x) && (cameraScale.x != 1 && cameraScale.y != 1)\n\n  // If zooms are unequal, assume one is filtered to be 1.0\n  float unequalZooms = float(cameraScale.x != cameraScale.y);\n\n  size = mix(\n    size,\n    (size * cameraScale.yx),\n    unequalZooms\n  );\n\n  // Destructure threejs's bug with the position requirement\n  float normal = position.x;\n  float side = position.y;\n\n  vec2 scaledAnchor = anchor * scale;\n\n  // Get the location of the anchor in world space\n  vec2 worldAnchor = location + scaledAnchor;\n\n  vec2 adjustedAnchor = mix(\n    scaledAnchor,\n    (scaledAnchor * cameraScale.yx),\n    unequalZooms\n  );\n\n  // Get the position of the current vertex\n  vec2 vertex = vec2(side, float(normal == 1.0)) * scale * size + location - adjustedAnchor;\n\n  // See how scaled the size on screen will be from the actual height of the label\n  float labelScreenScale = mix(\n    screenSize.y / size.y,\n    screenSize.x / size.x,\n    float((cameraScale.x < 1.0) || (cameraScale.x > 1.0))\n  );\n\n  // If our screen rendering is larger than the size the label is supposed to be, then we automagically\n  // scale down our label to stay the correct size, centered on the anchor point\n  vec2 anchorToVertex = vertex - location;\n\n  // We now choose between keeping the same image size or keeping it in world space\n  vertex = mix(\n    // This option keeps the image size in world space\n    vertex,\n    // This option counters the scaling of the image on the screen keeping it a static size\n    (anchorToVertex / labelScreenScale) + location,\n    // This is the flag determining if a scale mode should be applied to the vertex\n    useScaleMode\n  );\n\n  // --Texture and Color\n  // Get the tex coord from our inject texture info\n  texCoord = texture.xy + ((texture.zw - texture.xy) * vec2(side, float(normal == -1.0)));\n  // Apply the label's color as a tint to the label (all labels are rendered white to the base texture)\n  vertexColor = color;\n\n  gl_Position = clipSpace(vec3(vertex, depth));\n}\n"},function(e,t){e.exports="precision highp float;\n\n${picking}\nvarying vec4 vertexColor;\nvarying vec2 texCoord;\n\nvoid main() {\n  gl_FragColor = texture2D(labelAtlas, texCoord) * vertexColor;\n  setColor(gl_FragColor * gl_FragColor.a);\n}\n"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(6),s=n(5),c=n(0),u=n(4),l=Math.max,h=Math.min,d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getInstancePickingMethods=function(){return{boundsAccessor:function(e){var t=[e.x-e.anchor.x,e.y-e.anchor.y];return new a.Bounds({height:e.height,width:e.width,x:t[0],y:t[1]})},hitTest:function(e,t,n){var r=l.apply(void 0,n.camera.scale),i=h.apply(void 0,n.camera.scale);if(e.scaling===u.ScaleType.ALWAYS)return!0;if(e.scaling===u.ScaleType.BOUND_MAX){if(i<=1&&r<=1)return!0;var o=n.worldToScreen({x:e.x-e.anchor.x/n.camera.scale[0],y:e.y-e.anchor.y/n.camera.scale[1]}),s=n.worldToScreen(t);return new a.Bounds({height:e.height,width:e.width,x:o.x,y:o.y}).containsPoint(s)}if(e.scaling===u.ScaleType.NEVER){o=n.worldToScreen({x:e.x-e.anchor.x/n.camera.scale[0],y:e.y-e.anchor.y/n.camera.scale[1]}),s=n.worldToScreen(t);return new a.Bounds({height:e.height,width:e.width,x:o.x,y:o.y}).containsPoint(s)}return!0}}},t.prototype.initShader=function(){var e=this,t={0:1,1:1,2:-1,3:1,4:-1,5:-1},r={0:0,1:0,2:0,3:1,4:1,5:1};return{fs:n(74),instanceAttributes:[{block:0,blockIndex:c.InstanceBlockIndex.ONE,name:"location",size:c.InstanceAttributeSize.TWO,update:function(e){return[e.x,e.y]}},{block:0,blockIndex:c.InstanceBlockIndex.THREE,name:"anchor",size:c.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x,e.anchor.y]}},{block:1,blockIndex:c.InstanceBlockIndex.ONE,name:"size",size:c.InstanceAttributeSize.TWO,update:function(e){return[e.width,e.height]}},{block:1,blockIndex:c.InstanceBlockIndex.THREE,name:"depth",size:c.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{block:1,blockIndex:c.InstanceBlockIndex.FOUR,name:"scaling",size:c.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{atlas:{key:this.props.atlas,name:"labelAtlas"},block:2,name:"texture",update:function(t){return e.resource.request(e,t,t.resource)}},{block:3,blockIndex:c.InstanceBlockIndex.ONE,name:"color",size:c.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{block:4,blockIndex:c.InstanceBlockIndex.ONE,name:"scale",size:c.InstanceAttributeSize.ONE,update:function(e){return[e.scale]}}],uniforms:[{name:"scaleFactor",size:c.UniformSize.ONE,update:function(e){return[1]}}],vertexAttributes:[{name:"position",size:c.VertexAttributeSize.THREE,update:function(e){return[t[e],r[e],0]}}],vertexCount:6,vs:n(73)}},t.prototype.getModelType=function(){return{drawMode:o.TriangleStripDrawMode,modelType:o.Mesh}},t.prototype.getMaterialOptions=function(){return{blending:o.CustomBlending,blendSrc:o.OneFactor,premultipliedAlpha:!0,transparent:!0}},t}(s.Layer);t.LabelLayer=d},function(e,t,n){"use strict";var r,i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.awaitContext=function(){return i(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return r?[3,2]:(this.getContext(),[4,new Promise(function(e){return setTimeout(e,10)})]);case 1:return e.sent(),[3,0];case 2:return[2]}})})},e.getContext=function(){return r||(r=document.createElement("canvas").getContext("2d")),r},e.calculateImageSize=function(e,t){var n=e.image.element;0!==n.width&&0!==n.height?(r.canvas.width=100,r.canvas.height=100,r.drawImage(n,0,0),e.rasterization=e.rasterization||{texture:{height:0,width:0},world:{height:0,width:0}},e.rasterization.texture={height:n.height*e.sampleScale,width:n.width*e.sampleScale},e.rasterization.world={height:n.height,width:n.width},e.rasterization.image=n):console.warn("Images provided shoud have valid dimensions! Please ensure the image is loaded first.")},e.render=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this.awaitContext()];case 1:return t.sent(),this.calculateImageSize(e,e.sampleScale),[2,e]}})})},e.renderSync=function(e){return this.getContext(),r?(this.calculateImageSize(e,e.sampleScale),e):(console.warn("Can not render a image synchronously without the canvas context being ready."),e)},e}();t.ImageRasterizer=a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(35),s=n(33),c=n(32),u=n(31),l=n(14),h=n(30),d=n(34),p=n(37)("webgl-surface:Atlas"),f={aspectRatio:0,atlasBL:{x:0,y:0},atlasBR:{x:0,y:0},atlasReferenceID:"",atlasTexture:null,atlasTL:{x:0,y:0},atlasTR:{x:0,y:0},heightOnAtlas:0,isValid:!1,pixelHeight:0,pixelWidth:0,widthOnAtlas:0};var y=function(){function e(){this.allAtlas=new Map}return e.prototype.createAtlas=function(e,t){return r(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return(n=new a.Atlas(e)).setManager(this),this.allAtlas.set(n.id,n),t?[4,this.updateAtlas(n.id,t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return p("Atlas Created-> %o",n),[2,n]}})})},e.prototype.destroy=function(){this.allAtlas.forEach(function(e){return e.destroy()})},e.prototype.destroyAtlas=function(e){var t=this.allAtlas.get(e);t&&t.destroy()},e.prototype.setDefaultImage=function(e,t){return e=Object.assign(e,f,{atlasReferenceID:t})},e.prototype.draw=function(e,t){return r(this,void 0,void 0,function(){var n,r,a,s,c,u,l,h,d,f,y,v,g,m,b,w,x,_,T;return i(this,function(i){switch(i.label){case 0:return n=e.texture.image,r=e.id,e.registerResource(t)?[4,this.loadImage(t)]:(console.warn("Could not draw resource to the atlas as the resource was not properly registered to the atlas first",e,t),[2,Promise.resolve(!1)]);case 1:return(a=i.sent())&&(S=t.texture,O=!1,S&&S.isValid&&S.pixelWidth&&S.pixelHeight&&(O=!0),O)?(s=t.rasterization,c=t.texture,u=new o.Bounds({left:0,right:s.texture.width,top:0,bottom:s.texture.height}),(l={first:c,second:u}).second.width+=1,l.second.height+=1,h=e.packing,(d=h.insert(l))?(p("Atlas location determined: %o",d),d.nodeImage=c,f=d.nodeDimensions.x/e.width,y=d.nodeDimensions.y/e.height,v=d.nodeDimensions.width/e.width,g=d.nodeDimensions.height/e.height,m=1/e.width,b=new o.Bounds({bottom:1-y,left:f,right:f+v,top:1-(y+g)}),w=b.bottom,x=b.y,_=b.x,T=b.x+b.width-m,c.atlasReferenceID=r,c.atlasTL={x:_,y:x},c.atlasBR={x:T,y:w},c.atlasBL={x:_,y:w},c.atlasTR={x:T,y:x},c.widthOnAtlas=Math.abs(c.atlasTR.x-c.atlasTL.x),c.heightOnAtlas=Math.abs(c.atlasTR.y-c.atlasBR.y),c.pixelWidth=s.texture.width,c.pixelHeight=s.texture.height,n.getContext("2d").drawImage(a,d.nodeDimensions.x,d.nodeDimensions.y),[2,!0]):(console.error("Could not fit resource into atlas",t),t.texture=this.setDefaultImage(t.texture,r),[2,!1])):(console.error("Could not load resource:",t),t.texture=this.setDefaultImage(t.texture,r),[2,!1])}var S,O})})},e.prototype.getAtlasTexture=function(e){return this.allAtlas.get(e)},e.prototype.loadImage=function(e){return r(this,void 0,void 0,function(){var t,n,r;return i(this,function(i){switch(i.label){case 0:return n=e.texture||new d.SubTexture,e.texture=n,e instanceof u.ImageAtlasResource?e.image.element?0!==e.image.element.width&&0!==e.image.element.height?(r=e.image.element,n.pixelWidth=r.width,n.pixelHeight=r.height,n.aspectRatio=r.width/r.height,[2,r]):[4,new Promise(function(t,r){var i=e.image.element;i.onload=function(){n.pixelWidth=i.width,n.pixelHeight=i.height,n.aspectRatio=i.width/i.height,t(i)},i.onerror=function(){t(null)}})]:[3,2]:[3,4];case 1:return[2,i.sent()];case 2:e.image.path&&(t=e.image.path),i.label=3;case 3:return[3,10];case 4:return e instanceof l.LabelAtlasResource?e.rasterization.canvas?[3,6]:[4,h.LabelRasterizer.render(e)]:[3,7];case 5:i.sent(),i.label=6;case 6:return e.rasterization.canvas?(p("Rasterized label %o",e.rasterization),t=e.rasterization.canvas.toDataURL("image/png")):console.warn("The label was not able to be rasterized"),[3,10];case 7:return e instanceof s.ColorAtlasResource?e.rasterization.canvas?[3,9]:[4,c.ColorRasterizer.render(e)]:[3,10];case 8:i.sent(),i.label=9;case 9:e.rasterization.canvas?(p("Rasterized color %o",e.rasterization),t=e.rasterization.canvas.toDataURL("image/png")):console.warn("The color was not able to be rasterized"),i.label=10;case 10:return t?[4,new Promise(function(e,r){var i=new Image;i.onload=function(){n.pixelWidth=i.width,n.pixelHeight=i.height,n.aspectRatio=i.width/i.height,e(i)},i.onerror=function(){e(null)},i.src=t})]:[3,12];case 11:return[2,i.sent()];case 12:return[2,null]}})})},e.prototype.updateAtlas=function(e,t){return r(this,void 0,void 0,function(){var n,r,o,a;return i(this,function(i){switch(i.label){case 0:if(!(n=this.allAtlas.get(e)))return[3,5];r=0,o=t,i.label=1;case 1:return r<o.length?(a=o[r],[4,this.draw(n,a)]):[3,4];case 2:i.sent(),i.label=3;case 3:return r++,[3,1];case 4:return n.updateTexture(),[3,6];case 5:console.warn("Can not update non-existing atlas:",e,"These resources will not be loaded:",t),i.label=6;case 6:return[2]}})})},e}();t.AtlasManager=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=function(){function e(e,t,n,i){this.child=[null,null],this.isLeaf=!0,this.nodeImage=null,this.nodeDimensions=new r.Bounds({height:i,width:n,x:e,y:t})}return e.prototype.destroy=function(){var e=this.child[0],t=this.child[1];this.nodeImage=null,e&&e.destroy(),t&&t.destroy(),this.child[0]=null,this.child[1]=null},e.prototype.hasChild=function(){var e=this.child[0],t=this.child[1];return e&&!e.nodeImage?!e.isLeaf:!(!t||t.nodeImage)&&!t.isLeaf},e.prototype.insert=function(t){var n=this.child[0],r=this.child[1];if(!this.isLeaf&&n&&r){var i=n.insert(t);return null!==i?i:r.insert(t)}if(this.nodeImage)return null;var o=this.nodeDimensions.fits(t.second);if(0===o)return null;if(1===o)return this;this.isLeaf=!1;var a=t.second.width,s=t.second.height,c=this.nodeDimensions.width-a,u=this.nodeDimensions.height-t.second.height;return c>u?(this.child[0]=new e(this.nodeDimensions.x,this.nodeDimensions.y,a,this.nodeDimensions.height),this.child[1]=new e(this.nodeDimensions.x+a,this.nodeDimensions.y,c,this.nodeDimensions.height)):(this.child[0]=new e(this.nodeDimensions.x,this.nodeDimensions.y,this.nodeDimensions.width,s),this.child[1]=new e(this.nodeDimensions.x,this.nodeDimensions.y+s,this.nodeDimensions.width,u)),this.child[0].insert(t)},e.prototype.remove=function(e){if(this.isLeaf)return this.nodeImage===e&&(this.nodeImage=null,e.atlasReferenceID=null,e.pixelWidth=0,!0);var t=this.child[0].remove(e);return!!t||(t=this.child[1].remove(e),this.child[0].hasChild()||this.child[1].hasChild()||(this.child[0]=null,this.child[1]=null),t)},e}();t.PackNode=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(3),c=n(9),u=n(7),l=n(4),h=Math.max,d=new Map,p=((a={})[l.AnchorType.TopLeft]=function(e,t){e.x=-e.padding,e.y=-e.padding},a[l.AnchorType.TopMiddle]=function(e,t){e.x=t.width/2,e.y=-e.padding},a[l.AnchorType.TopRight]=function(e,t){e.x=t.width+e.padding,e.y=-e.padding},a[l.AnchorType.MiddleLeft]=function(e,t){e.x=-e.padding,e.y=t.height/2},a[l.AnchorType.Middle]=function(e,t){e.x=t.width/2,e.y=t.height/2},a[l.AnchorType.MiddleRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height/2},a[l.AnchorType.BottomLeft]=function(e,t){e.x=-e.padding,e.y=t.height+e.padding},a[l.AnchorType.BottomMiddle]=function(e,t){e.x=t.width/2,e.y=t.height+e.padding},a[l.AnchorType.BottomRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height+e.padding},a[l.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},a),f=function(e){function t(t){var n=e.call(this,t)||this;n.tint=[0,0,0,1],n.depth=0,n.height=1,n.scaling=l.ScaleType.BOUND_MAX,n.width=1,n.x=0,n.y=0,n._sourceWidth=0,n._sourceHeight=0,n._isDestroyed=!1,n._anchor={padding:0,type:l.AnchorType.TopLeft,x:0,y:0},n.depth=t.depth||n.depth,n.tint=t.tint||n.tint,n.scaling=t.scaling||n.scaling,n.x=t.x||n.x,n.y=t.y||n.y,n._element=t.element;var r=d.get(n._path||n._element);return r&&r.references++,r||((r={references:1,resource:new c.ImageAtlasResource(n)}).resource.sampleScale=r.resource.sampleScale||1,c.ImageRasterizer.renderSync(r.resource),d.set(n._path||n._element,r)),n._rasterization=r,n._sourceWidth=r.resource.rasterization.world.width,n._sourceHeight=r.resource.rasterization.world.height,n.width=t.width||n._sourceWidth||1,n.height=t.height||n._sourceHeight||1,t.anchor&&n.setAnchor(t.anchor),n}return i(t,e),t.destroy=function(){d.clear()},Object.defineProperty(t.prototype,"size",{get:function(){return h(this.width,this.height)},set:function(e){var t=this.width/this.height;this.width=e*t,this.height=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDestroyed",{get:function(){return this._isDestroyed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resource",{get:function(){return this._rasterization.resource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sourceWidth",{get:function(){return this._sourceWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sourceHeight",{get:function(){return this._sourceHeight},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,this._rasterization.references--,0===this._rasterization.references&&(this._rasterization.resource,console.warn("The destroy method still needs completion")))},Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},enumerable:!0,configurable:!0}),t.prototype.setAnchor=function(e){var t={padding:e.padding||0,type:e.type,x:e.x||0,y:e.y||0};p[t.type](t,this),this._anchor=t},o([s.observable],t.prototype,"tint",void 0),o([s.observable],t.prototype,"depth",void 0),o([s.observable],t.prototype,"height",void 0),o([s.observable],t.prototype,"scaling",void 0),o([s.observable],t.prototype,"width",void 0),o([s.observable],t.prototype,"x",void 0),o([s.observable],t.prototype,"y",void 0),o([s.observable],t.prototype,"_anchor",void 0),t}(u.Instance);t.ImageInstance=f},function(e,t){e.exports="precision highp float;\n\nvarying vec4 vertexColor;\nvarying vec2 texCoord;\n\nvoid main() {\n  ${attributes}\n\n  // Figure out the size of the image as it'd show on the screen\n  vec3 screenSize = cameraSpaceSize(vec3(size, 1.0));\n  // Do the test for when the image is larger on the screen than the font size\n  bool largerOnScreen = screenSize.y > size.y;\n\n  // Determines if a scale mode should be used or not for the vertex\n  float useScaleMode = float(\n    (\n      scaling == 3.0 ||                  // NEVER mode - keep the image the same size always\n      (largerOnScreen && scaling == 2.0) // BOUND_MAX mode - only if we're larger than the font size do we scale down\n    ) &&\n    scaling != 1.0                       // ALWAYS mode - the image stays completely in world space allowing it to scale freely\n  );\n  // If zooms are unequal, assume one is filtered to be 1.0\n  float unequalZooms = float(cameraScale.x != cameraScale.y);\n\n  // Destructure threejs's bug with the position requirement\n  float normal = position.x;\n  float side = position.y;\n\n  // Get the location of the anchor in world space\n  vec2 worldAnchor = location + anchor;\n\n  // Get the tex coord from our inject texture info\n  texCoord = texture.xy + ((texture.zw - texture.xy) * vec2(side, float(normal == -1.0)));\n  // Apply the image's tint as a tint to the image\n  vertexColor = tint;\n\n  // Correct aspect ratio.\n  size = mix(\n    size,\n    (size * cameraScale.yx),\n    unequalZooms\n  );\n\n  vec2 adjustedAnchor = mix(\n    anchor,\n    (anchor * cameraScale.yx),\n    unequalZooms\n  );\n\n  vec2 vertex = vec2(side, float(normal == 1.0)) * size + location - adjustedAnchor;\n\n  // See how scaled the size on screen will be from the actual height of the image\n  float imageScreenScale = mix(\n    screenSize.y / size.y,\n    screenSize.x / size.x,\n    float((cameraScale.x < 1.0) || (cameraScale.x > 1.0))\n  );\n\n  // If our screen rendering is larger than the size the image is supposed to be, then we automagically\n  // scale down our image to stay the correct size, centered on the anchor point\n  vec2 anchorToVertex = vertex - location;\n\n  // We now choose between keeping the same image size or keeping it in world space\n  vertex = mix(\n    // This option keeps the image size in world space\n    vertex,\n    // This option counters the scaling of the image on the screen keeping it a static size\n    (anchorToVertex / imageScreenScale) + location,\n    // This is the flag determining if a scale mode should be applied to the vertex\n    useScaleMode\n  );\n\n  gl_Position = clipSpace(vec3(vertex, depth));\n}\n"},function(e,t){e.exports="precision highp float;\n\n${picking}\nvarying vec4 vertexColor;\nvarying vec2 texCoord;\n\nvoid main() {\n  gl_FragColor = texture2D(imageAtlas, texCoord) * vertexColor;\n  setColor(gl_FragColor * gl_FragColor.a);\n}\n"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(6),s=n(5),c=n(0),u=n(4),l=Math.min,h=Math.max,d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getInstancePickingMethods=function(){return{boundsAccessor:function(e){var t=[e.x-e.anchor.x,e.y-e.anchor.y];return new a.Bounds({height:e.height,width:e.width,x:t[0],y:t[1]})},hitTest:function(e,t,n){var r=h.apply(void 0,n.camera.scale),i=l.apply(void 0,n.camera.scale);if(e.scaling===u.ScaleType.ALWAYS)return!0;if(e.scaling===u.ScaleType.BOUND_MAX){if(i<=1&&r<=1)return!0;var o=n.worldToScreen({x:e.x-e.anchor.x/n.camera.scale[0],y:e.y-e.anchor.y/n.camera.scale[1]}),s=n.worldToScreen(t);return new a.Bounds({height:e.height,width:e.width,x:o.x,y:o.y}).containsPoint(s)}if(e.scaling===u.ScaleType.NEVER){o=n.worldToScreen({x:e.x-e.anchor.x/n.camera.scale[0],y:e.y-e.anchor.y/n.camera.scale[1]}),s=n.worldToScreen(t);return new a.Bounds({height:e.height,width:e.width,x:o.x,y:o.y}).containsPoint(s)}return!0}}},t.prototype.initShader=function(){var e=this,t={0:1,1:1,2:-1,3:1,4:-1,5:-1},r={0:0,1:0,2:0,3:1,4:1,5:1};return{fs:n(81),instanceAttributes:[{block:0,blockIndex:c.InstanceBlockIndex.ONE,name:"location",size:c.InstanceAttributeSize.TWO,update:function(e){return[e.x,e.y]}},{block:0,blockIndex:c.InstanceBlockIndex.THREE,name:"anchor",size:c.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x,e.anchor.y]}},{block:1,blockIndex:c.InstanceBlockIndex.ONE,name:"size",size:c.InstanceAttributeSize.TWO,update:function(e){return[e.width,e.height]}},{block:1,blockIndex:c.InstanceBlockIndex.THREE,name:"depth",size:c.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{block:1,blockIndex:c.InstanceBlockIndex.FOUR,name:"scaling",size:c.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{atlas:{key:this.props.atlas,name:"imageAtlas"},block:2,name:"texture",update:function(t){return e.resource.request(e,t,t.resource)}},{block:3,blockIndex:c.InstanceBlockIndex.ONE,name:"tint",size:c.InstanceAttributeSize.FOUR,update:function(e){return e.tint}}],uniforms:[{name:"scaleFactor",size:c.UniformSize.ONE,update:function(e){return[1]}}],vertexAttributes:[{name:"position",size:c.VertexAttributeSize.THREE,update:function(e){return[t[e],r[e],0]}}],vertexCount:6,vs:n(80)}},t.prototype.getModelType=function(){return{drawMode:o.TriangleStripDrawMode,modelType:o.Mesh}},t.prototype.getMaterialOptions=function(){return{blending:o.CustomBlending,blendSrc:o.OneFactor,premultipliedAlpha:!0,transparent:!0}},t}(s.Layer);t.ImageLayer=d},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),s=function(e){function t(t){var n=e.call(this,t)||this;return n.colorStart=[1,1,1,1],n.colorEnd=[1,1,1,1],n.control=[[0,0],[0,0]],n.depth=0,n.end=[0,0],n.start=[0,0],n.widthStart=1,n.widthEnd=1,n.colorStart=t.colorStart||n.colorStart,n.colorEnd=t.colorEnd||n.colorEnd,n.control=t.control||n.control,n.depth=t.depth||n.depth,n.end=t.end||n.end,n.widthStart=t.widthStart||n.widthStart,n.widthEnd=t.widthEnd||n.widthEnd,n.start=t.start||n.start,n}return i(t,e),Object.defineProperty(t.prototype,"length",{get:function(){var e=[this.end[0]-this.start[0],this.end[1]-this.start[1]];return Math.sqrt(e[0]*e[0]+e[1]*e[1])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"midpoint",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"perpendicular",{get:function(){var e=this.length;return[(this.end[1]-this.start[1])/e,-(this.end[0]-this.start[0])/e]},enumerable:!0,configurable:!0}),t.prototype.setEdgeWidth=function(e){e&&(this.widthEnd=e,this.widthStart=e)},t.prototype.setColor=function(e){this.colorStart=e,this.colorEnd=e},o([a.observable],t.prototype,"colorStart",void 0),o([a.observable],t.prototype,"colorEnd",void 0),o([a.observable],t.prototype,"control",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"end",void 0),o([a.observable],t.prototype,"start",void 0),o([a.observable],t.prototype,"widthStart",void 0),o([a.observable],t.prototype,"widthEnd",void 0),t}(n(7).Instance);t.EdgeInstance=s},function(e,t){e.exports="precision highp float;\n\n${picking}\nvarying vec4 vertexColor;\n\nvoid main() {\n  setColor(vertexColor);\n}\n"},function(e,t){e.exports="/**\n  This vertex shader calculates edges based in world space to make an edge based on\n  bezier curves with 0, 1, and 2 control points.\n**/\nprecision highp float;\n\nvarying vec4 vertexColor;\n\n// Interpolation type injection\n${interpolation}\n\nvoid main() {\n  ${attributes}\n\n  // Destructure threejs's bug with the position requirement\n  float normal = position.x;\n  float interpolationTime = position.y;\n  float interpolationIncrement = 1.0 / position.z;\n\n  // Convert our world points to screen space\n  vec4 startClip = clipSpace(vec3(start, depth));\n  vec4 endClip = clipSpace(vec3(end, depth));\n  vec2 startScreen = (startClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\n  vec2 endScreen = (endClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\n  // Controls for this mode are screen space deltas from the end points\n  vec2 control1 = startScreen + vec2(control.x, -control.y) * scaleFactor;\n  vec2 control2 = endScreen + vec2(control.z, -control.w) * scaleFactor;\n\n  // Get the position of the current vertex\n  vec2 currentPosition = interpolation(interpolationTime, startScreen, endScreen, control1, control2);\n  // Calculate the next and previous segment's location on the line\n  vec2 prePosition = interpolation(interpolationTime - interpolationIncrement, startScreen, endScreen, control1, control2);\n  vec2 nextPosition = interpolation(interpolationTime + interpolationIncrement, startScreen, endScreen, control1, control2);\n\n  vec2 preLine = prePosition - currentPosition;\n  vec2 nextLine = nextPosition - currentPosition;\n\n  // Get a spliced nromal at the joining of two segments to make a crisper curve\n  vec2 currentNormal = mix(\n    // Pick this value if we're at the beginning of the line\n    normalize(vec2(preLine.y, -preLine.x)),\n    mix(\n      // Pick this value when we're between the ends\n      normalize(vec2(preLine.y, -preLine.x) + vec2(-nextLine.y, nextLine.x)),\n      // Pick this value if we're at the end of the line\n      normalize(vec2(-nextLine.y, nextLine.x)),\n      float(position.x >= 1.0)\n    ),\n    float(position.x > 0.0)\n  );\n\n  // Get the thickness based on the side we're on\n  float lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;\n  // Start on the calculated line and push out by the normal's value\n  vec2 vertex = currentPosition + currentNormal * (-normal * lineThickness * scaleFactor);\n  // Get the color based on where we are on the line\n  vertexColor = mix(colorStart, colorEnd, interpolationTime);\n  vertexColor *= vertexColor.a;\n\n  gl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), startClip.zw);\n  gl_PointSize = 5.0;\n}\n"},function(e,t){e.exports="precision highp float;\n\n/**\n  This vertex shader calculates edges whose curve and width is in screen space where the curve is\n  bezier curves with 0, 1, and 2 control points.\n**/\nvarying vec4 vertexColor;\n\n// Interpolation type injection\n${interpolation}\n\nvoid main() {\n  ${attributes}\n\n  // Destructure threejs's bug with the position requirement\n  float normal = position.x;\n  float interpolationTime = position.y;\n  float interpolationIncrement = 1.0 / position.z;\n  // Get the position of the current vertex\n  vec2 currentPosition = interpolation(interpolationTime, start, end, control.xy, control.zw);\n  // Calculate the next and previous segment's location on the line\n  vec2 prePosition = interpolation(interpolationTime - interpolationIncrement, start, end, control.xy, control.zw);\n  vec2 nextPosition = interpolation(interpolationTime + interpolationIncrement, start, end, control.xy, control.zw);\n\n  vec2 preLine = prePosition - currentPosition;\n  vec2 nextLine = nextPosition - currentPosition;\n\n  // Get a spliced nromal at the joining of two segments to make a crisper curve\n  vec2 currentNormal = mix(\n    // Pick this value if we're at the beginning of the line\n    normalize(vec2(preLine.y, -preLine.x)),\n    mix(\n      // Pick this value when we're between the ends\n      normalize(vec2(preLine.y, -preLine.x) + vec2(-nextLine.y, nextLine.x)),\n      // Pick this value if we're at the end of the line\n      normalize(vec2(-nextLine.y, nextLine.x)),\n      float(position.x >= 1.0)\n    ),\n    float(position.x > 0.0)\n  );\n\n  // Get the thickness based on the side we're on\n  float lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;\n  // Start on the calculated line and push out by the normal's value\n  vec2 vertex = currentPosition + currentNormal * (normal * lineThickness);\n  // Get the color based on where we are on the line\n  vertexColor = mix(colorStart, colorEnd, interpolationTime);\n  vertexColor *= vertexColor.a;\n\n  gl_Position = clipSpace(vec3(vertex, depth));\n  gl_PointSize = 5.0;\n}\n"},function(e,t){e.exports="/**\n * Makes a linear interpolation between two points\n *\n * @param {vec2} s The start point\n * @param {vec2} e The end point\n * @param {vec2} c The bezier control point\n * @param {float} t The interpolation value [0, 1]\n *\n * @returns {vec2} A point interpolated between the two provided points\n */\nvec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\n  float t1 = 1.0 - t;\n  return pow(t1, 3.0) * p1 + 3.0 * t * pow(t1, 2.0) * c1 + 3.0 * pow(t, 2.0) * t1 * c2 + pow(t, 3.0) * p2;\n}\n"},function(e,t){e.exports="/**\n * Makes a linear interpolation between two points\n *\n * @param {vec2} s The start point\n * @param {vec2} e The end point\n * @param {vec2} c The bezier control point\n * @param {float} t The interpolation value [0, 1]\n *\n * @returns {vec2} A point interpolated between the two provided points\n */\nvec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\n  return (1.0 - t) * (1.0 - t) * p1 + 2.0 * t * (1.0 - t) * c1 + t * t * p2;\n}\n"},function(e,t){e.exports="/**\n * Makes a linear interpolation between two points\n *\n * @param {vec2} s The start point\n * @param {vec2} e The end point\n * @param {vec2} c The bezier control point\n * @param {float} t The interpolation value [0, 1]\n *\n * @returns {vec2} A point interpolated between the two provided points\n */\nvec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\n  return p1 + (p2 - p1) * t;\n}\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(40),o=n(16),a=Math.pow;var s=((l={})[o.EdgeType.LINE]=function(e,t,n,r,o){return i.add2(i.scale2(i.subtract2(n,t),e),t)},l[o.EdgeType.BEZIER]=function(e,t,n,r,i){return[(1-e)*(1-e)*t[0]+2*e*(1-e)*r[0]+e*e*n[0],(1-e)*(1-e)*t[1]+2*e*(1-e)*r[1]+e*e*n[1]]},l[o.EdgeType.BEZIER2]=function(e,t,n,r,i){var o=1-e;return[a(o,3)*t[0]+3*e*a(o,2)*r[0]+3*a(e,2)*o*i[0]+a(e,3)*n[0],a(o,3)*t[1]+3*e*a(o,2)*r[1]+3*a(e,2)*o*i[1]+a(e,3)*n[1]]},l);function c(e){return{x:e[0],y:e[1]}}function u(e){return[e.x,e.y]}var l,h=50;t.edgePicking=function(e){var t=e.broadphase,n=e.minPickDistance,a=void 0===n?0:n,l=e.scaleType,d=e.type,p=s[e.type],f=function(n){var i=n.widthStart/2+a,s=n.widthEnd/2+a,c=new r.Bounds({height:n.widthStart,width:n.widthStart,x:n.start[0]-i,y:n.start[1]-i});return c.encapsulate(new r.Bounds({height:n.widthEnd,width:n.widthEnd,x:n.end[0]-s,y:n.end[1]-s})),e.type===o.EdgeType.BEZIER?c.encapsulate({x:n.control[0][0],y:n.control[0][1]}):e.type===o.EdgeType.BEZIER2&&(c.encapsulate({x:n.control[0][0],y:n.control[0][1]}),c.encapsulate({x:n.control[1][0],y:n.control[1][1]})),t===o.EdgeBroadphase.PASS_X&&(c.x=Number.MIN_SAFE_INTEGER/2,c.width=Number.MAX_SAFE_INTEGER),t===o.EdgeBroadphase.PASS_Y&&(c.y=Number.MIN_SAFE_INTEGER/2,c.height=Number.MAX_SAFE_INTEGER),c};return l===o.EdgeScaleType.SCREEN_CURVE?{boundsAccessor:f,hitTest:function(e,t,n){var r,s,l=[(t=n.worldToScreen(t)).x,t.y],f=0,y=Number.MAX_VALUE,v=0,g=Number.MAX_VALUE,m=n.worldToScreen(c(e.start)),b=n.worldToScreen(c(e.end));d===o.EdgeType.BEZIER?r=i.add2(u(m),e.control[0]):d===o.EdgeType.BEZIER2&&(r=i.add2(u(m),e.control[0]),s=i.add2(u(b),e.control[1]));var w=u(m),x=u(b);r=e.control.length>0?r:[0,0],s=e.control.length>1?s:[0,0];for(var _=0;_<h;++_){var T=p(_/h,w,x,r,s),S=i.length2(i.subtract2(l,T));S<y?(v=f,g=y,f=_,y=S):S<g&&(v=_,y=S)}var O=f/h,E=(e.widthEnd-e.widthStart)*O+e.widthStart;if(f===v)return!1;var I=p(f/h,w,x,r,s),M=p(v/h,w,x,r,s);return y=function(e,t,n){var r=i.subtract2(e,n),o=i.subtract2(t,e),a=[o[1],-o[0]];return Math.abs(i.dot2(r,a))/i.length2(o)}(I,M,l),!(i.dot2(i.subtract2(M,I),i.subtract2(l,I))<0)&&y<E/2+a}}:{boundsAccessor:f,hitTest:function(e,t,n){for(var r=[t.x,t.y],o=0,a=Number.MAX_VALUE,s=0;s<h;++s){var c=p(s/h,e.start,e.end,e.control.length>0?e.control[0]:[0,0],e.control.length>1?e.control[1]:[0,0]),u=i.length2(i.subtract2(r,c));u<a&&(o=s,a=u)}var l=o/h;return a<((e.widthEnd-e.widthStart)*l+e.widthStart)/2}}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(5),s=n(0),c=n(8),u=n(90),l=n(16);var h,d=((h={})[l.EdgeType.LINE]=n(89),h[l.EdgeType.BEZIER]=n(88),h[l.EdgeType.BEZIER2]=n(87),h),p=n(86),f=n(85),y=n(84),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getInstancePickingMethods=function(){return u.edgePicking(this.props)},t.prototype.initShader=function(){for(var e=this.props,t=e.scaleFactor,n=void 0===t?function(){return 1}:t,r=e.type,i=e.scaleType,o=void 0===i?l.EdgeScaleType.NONE:i,a=r===l.EdgeType.LINE?2:50,u=((m={0:1})[2*a+2]=-1,m),h=((b={0:0})[2*a+2]=1,b),v=1,g=0;g<2*a;++g)u[g+1]=v,h[g+1]=Math.floor(g/2)/(a-1),v*=-1;var m,b,w=c.shaderTemplate(o===l.EdgeScaleType.NONE?p:f,{attributes:"${attributes}",interpolation:d[r]},{name:"Edge Layer",values:["interpolation"]});return{fs:y,instanceAttributes:[{block:0,blockIndex:s.InstanceBlockIndex.ONE,name:"start",size:s.InstanceAttributeSize.TWO,update:function(e){return e.start}},{block:0,blockIndex:s.InstanceBlockIndex.THREE,name:"end",size:s.InstanceAttributeSize.TWO,update:function(e){return e.end}},{block:1,blockIndex:s.InstanceBlockIndex.ONE,name:"widthStart",size:s.InstanceAttributeSize.ONE,update:function(e){return[e.widthStart]}},{block:1,blockIndex:s.InstanceBlockIndex.TWO,name:"widthEnd",size:s.InstanceAttributeSize.ONE,update:function(e){return[e.widthEnd]}},{block:1,blockIndex:s.InstanceBlockIndex.THREE,name:"depth",size:s.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{block:2,blockIndex:s.InstanceBlockIndex.ONE,name:"colorStart",size:s.InstanceAttributeSize.FOUR,update:function(e){return e.colorStart}},{block:3,blockIndex:s.InstanceBlockIndex.ONE,name:"colorEnd",size:s.InstanceAttributeSize.FOUR,update:function(e){return e.colorEnd}},r===l.EdgeType.LINE?{block:4,blockIndex:s.InstanceBlockIndex.ONE,name:"control",size:s.InstanceAttributeSize.FOUR,update:function(e){return[0,0,0,0]}}:null,r===l.EdgeType.BEZIER?{block:4,blockIndex:s.InstanceBlockIndex.ONE,name:"control",size:s.InstanceAttributeSize.FOUR,update:function(e){return[e.control[0][0],e.control[0][1],0,0]}}:null,r===l.EdgeType.BEZIER2?{block:4,blockIndex:s.InstanceBlockIndex.ONE,name:"control",size:s.InstanceAttributeSize.FOUR,update:function(e){return[(t=e.control)[0][0],t[0][1],t[1][0],t[1][1]];var t}}:null],uniforms:[{name:"scaleFactor",size:s.UniformSize.ONE,update:function(e){return[n()]}}],vertexAttributes:[{name:"position",size:s.VertexAttributeSize.THREE,update:function(e){return[u[e],h[e],2*a]}}],vertexCount:2*a+2,vs:w.shader}},t.prototype.getModelType=function(){return{drawMode:o.TriangleStripDrawMode,modelType:o.Mesh}},t.prototype.getMaterialOptions=function(){return{premultipliedAlpha:!0,transparent:!0}},t.defaultProps={broadphase:l.EdgeBroadphase.ALL,data:null,key:"none",scaleType:l.EdgeScaleType.NONE,type:l.EdgeType.LINE},t}(a.Layer);t.EdgeLayer=v},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(91)),r(n(83)),r(n(16))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),s=function(e){function t(t){var n=e.call(this,t)||this;return n.color=[1,1,1,1],n.depth=0,n.radius=0,n.x=0,n.y=0,n.color=t.color||n.color,n.radius=t.radius||n.radius,n.x=t.x||n.x,n.y=t.y||n.y,n.depth=t.depth||n.depth,n}return i(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),o([a.observable],t.prototype,"color",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"radius",void 0),o([a.observable],t.prototype,"x",void 0),o([a.observable],t.prototype,"y",void 0),t}(n(7).Instance);t.CircleInstance=s},function(e,t){e.exports="precision highp float;\n\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nvarying vec2 pointCoord;\n\nvoid main() {\n  ${attributes}\n\n  vertexColor = color * color.a;\n  float size = radius * scaleFactor;\n  edgeSharpness = mix(0.8, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\n  edgeSharpnessBase = mix(0.1, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\n  pointCoord = (position.xy + vec2(1.0, 1.0)) / 2.0;\n\n  // Center within clip space\n  vec4 clipCenter = clipSpace(vec3(center, depth));\n  // Center in screen space\n  vec2 screenCenter = (clipCenter.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\n  // Position in screen space\n  vec2 vertex = (position.xy * size) + screenCenter;\n  // Position back to clip space\n  gl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), clipCenter.zw);\n}\n"},function(e,t){e.exports="precision highp float;\n\n${picking}\n\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nvarying vec2 pointCoord;\n\nfloat circle(vec2 coord, float radius){\n  vec2 dist = coord - vec2(0.5);\n\n  return 1.0 - smoothstep(\n    radius - (radius * edgeSharpness),\n    radius + (radius * edgeSharpnessBase),\n    dot(dist, dist) * 4.0\n  );\n}\n\nvoid main() {\n  float step_factor = circle(pointCoord.xy, 1.0);\n\n  setColor(mix(\n    vec4(0.0, 0.0, 0.0, 0.0),\n    vertexColor,\n    step_factor\n  ));\n}\n"},function(e,t){e.exports="void main() {\n  gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n}"},function(e,t){e.exports=""},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(e){this.isMouseOver=new Map,this.isMouseDown=new Map,this.layer=e}return e.prototype.getColorPickInstance=function(){return this.colorPicking?this.layer.diffManager.colorPicking.uidToInstance.get(16777215-this.colorPicking.nearestColor):null},e.prototype.handleMouseOver=function(e,t){},e.prototype.handleMouseDown=function(e,t,n){var i=this;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var o=this.layer.props.onMouseDown;if(o){var a,s,c=e.viewToWorld(t),u=void 0,l=[];if(this.layer.picking.type===r.PickType.ALL)a=this.layer.picking.hitTest,u=function(t){return s(t).filter(function(t){return a(t,c,e)})},l=(s=this.layer.picking.quadTree.query.bind(this.layer.picking.quadTree))(c).filter(function(t){return a(t,c,e)});else if(this.layer.picking.type===r.PickType.SINGLE){var h=this.getColorPickInstance();h&&l.push(h)}o({button:n,instances:l,layer:this.layer.id,projection:e,querySpace:u,screen:[t.x,t.y],world:[c.x,c.y]}),this.isMouseDown.clear(),l.forEach(function(e){return i.isMouseDown.set(e,!0)})}}},e.prototype.handleMouseOut=function(e,t){if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var n=this.layer.props.onMouseOut;if(n){var i,o,a=e.viewToWorld(t),s=void 0;this.layer.picking.type===r.PickType.ALL&&(i=this.layer.picking.hitTest,o=this.layer.picking.quadTree.query.bind(this.layer.picking.quadTree),s=function(t){return o(t).filter(function(t){return i(t,a,e)})}),n({instances:Array.from(this.isMouseOver.keys()),layer:this.layer.id,projection:e,querySpace:s,screen:[t.x,t.y],world:[a.x,a.y]})}}this.isMouseOver.clear(),this.isMouseDown.clear()},e.prototype.handleMouseUp=function(e,t,n){if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var i=this.layer.props.onMouseUp;if(i){var o,a,s=e.viewToWorld(t),c=void 0,u=[];if(this.layer.picking.type===r.PickType.ALL)o=this.layer.picking.hitTest,c=function(t){return a(t).filter(function(t){return o(t,s,e)})},u=(a=this.layer.picking.quadTree.query.bind(this.layer.picking.quadTree))(s).filter(function(t){return o(t,s,e)});else if(this.layer.picking.type===r.PickType.SINGLE){var l=this.getColorPickInstance();l&&u.push(l)}i({button:n,instances:u,layer:this.layer.id,projection:e,querySpace:c,screen:[t.x,t.y],world:[s.x,s.y]})}}},e.prototype.handleMouseMove=function(e,t){var n=this,i=this.layer.props,o=i.onMouseOver,a=i.onMouseMove,s=i.onMouseOut;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE&&(o||a||s)){var c,u,l=void 0,h=e.viewToWorld(t),d=void 0,p=[];if(this.layer.picking.type===r.PickType.ALL)c=this.layer.picking.hitTest,d=function(t){return u(t).filter(function(t){return c(t,h,e)})},p=(u=this.layer.picking.quadTree.query.bind(this.layer.picking.quadTree))(h).filter(function(t){return c(t,h,e)});else if(this.layer.picking.type===r.PickType.SINGLE){var f=this.getColorPickInstance();f&&p.push(f)}if(o){var y=p.filter(function(e){return!n.isMouseOver.get(e)});l={instances:y,layer:this.layer.id,projection:e,querySpace:d,screen:[t.x,t.y],world:[h.x,h.y]},y.length>0&&o(l)}a&&a(l={instances:p,layer:this.layer.id,projection:e,querySpace:d,screen:[t.x,t.y],world:[h.x,h.y]});var v=new Map;if(p.forEach(function(e){return v.set(e,!0)}),s){var g=Array.from(this.isMouseOver.keys()).filter(function(e){return!v.get(e)});l={instances:g,layer:this.layer.id,projection:e,querySpace:d,screen:[t.x,t.y],world:[h.x,h.y]},g.length>0&&s(l)}this.isMouseOver=v}},e.prototype.handleMouseClick=function(e,t,n){if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var i=this.layer.props.onMouseClick;if(i){var o,a,s=e.viewToWorld(t),c=void 0,u=[];if(this.layer.picking.type===r.PickType.ALL)o=this.layer.picking.hitTest,c=function(t){return a(t).filter(function(t){return o(t,s,e)})},u=(a=this.layer.picking.quadTree.query.bind(this.layer.picking.quadTree))(s).filter(function(t){return o(t,s,e)});else if(this.layer.picking.type===r.PickType.SINGLE){var l=this.getColorPickInstance();l&&u.push(l)}i({button:n,instances:u,layer:this.layer.id,projection:e,querySpace:c,screen:[t.x,t.y],world:[s.x,s.y]})}}},e.prototype.handleMouseDrag=function(e,t){},e}();t.LayerInteractionHandler=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=["x","y","z","w"],o=function(){function e(e){this.layer=e}return e.prototype.getDiffProcessor=function(){if(this.layer.picking){if(this.layer.picking.type===r.PickType.ALL)return this.quadPicking=this.layer.picking,[this.changeInstanceQuad,this.addInstanceQuad,this.removeInstanceQuad];if(this.layer.picking.type===r.PickType.SINGLE)return this.colorPicking=this.layer.picking,this.colorPicking.uidToInstance=new Map,[this.changeInstanceColorPick,this.addInstanceColorPick,this.removeInstanceColorPick]}return[this.changeInstance,this.addInstance,this.removeInstance]},e.prototype.addInstance=function(e,t,n){if(n)e.changeInstance(e,t,n);else{var r=e.layer.uniformManager.add(t);t.active=!0,e.updateInstance(t,r)}},e.prototype.addInstanceQuad=function(e,t,n){if(n)e.changeInstanceQuad(e,t,n);else{var r=e.layer.uniformManager.add(t);t.active=!0,e.updateInstance(t,r),e.quadPicking.quadTree.remove(t),e.quadPicking.quadTree.add(t)}},e.prototype.addInstanceColorPick=function(e,t,n){if(n)e.changeInstanceColorPick(e,t,n);else{var r=e.layer.uniformManager.add(t);t.active=!0,e.updateInstance(t,r),e.colorPicking.uidToInstance.set(t.uid,t)}},e.prototype.changeInstance=function(e,t,n){n?e.updateInstance(t,n):e.addInstance(e,t,n)},e.prototype.changeInstanceQuad=function(e,t,n){n?(e.updateInstance(t,n),e.quadPicking.quadTree.remove(t),e.quadPicking.quadTree.add(t)):e.addInstanceQuad(e,t,n)},e.prototype.changeInstanceColorPick=function(e,t,n){n?e.updateInstance(t,n):e.addInstanceColorPick(e,t,n)},e.prototype.removeInstance=function(e,t,n){n&&(t.active=!1,e.updateInstance(t,n),e.layer.uniformManager.remove(t))},e.prototype.removeInstanceQuad=function(e,t,n){n&&(t.active=!1,e.updateInstance(t,n),e.layer.uniformManager.remove(t),e.quadPicking.quadTree.remove(t))},e.prototype.removeInstanceColorPick=function(e,t,n){n&&(t.active=!1,e.updateInstance(t,n),e.layer.uniformManager.remove(t),e.colorPicking.uidToInstance.delete(t.uid))},e.prototype.updateInstance=function(e,t){if(e.active){for(var n=t.uniform,r=t.uniformRange[0],o=n.value,a=void 0,s=void 0,c=void 0,u=void 0,l=void 0,h=void 0,d=0,p=this.layer.instanceAttributes.length;d<p;++d)for(s=(a=this.layer.instanceAttributes[d]).update(e),c=o[r+a.block],a.atlas&&this.layer.resource.setTargetAtlas(a.atlas.key),l=u=a.blockIndex,h=s.length+u;l<h;++l)c[i[l]]=s[l-u];n.value=o}else{n=t.uniform,r=t.uniformRange[0],o=n.value,a=void 0,s=void 0,c=void 0,u=void 0;s=(a=this.layer.activeAttribute).update(e),c=o[r+a.block],a.atlas&&this.layer.resource.setTargetAtlas(a.atlas.key);for(l=u=a.blockIndex,h=s.length+u;l<h;++l)c[i[l]]=s[l-u];n.value=o}},e}();t.InstanceDiffManager=o},function(e,t,n){"use strict";function r(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.add=function(e,t,n){return n?(n.x=e.x+t.x,n.y=e.y+t.y,n):{x:e.x+t.x,y:e.y+t.y}},e.getClosest=function(e,t){var n,i=Number.MAX_VALUE,o=null;return t.forEach(function(t){(n=r(t,e))<i&&(i=n,o=t)}),o},e.getClosestIndex=function(e,t){var n,i=Number.MAX_VALUE,o=0;return t.forEach(function(t,a){(n=r(t,e))<i&&(i=n,o=a)}),o},e.subtract=function(e,t,n){void 0===n&&(n=!1);var r=t.x-e.x,i=t.y-e.y;if(n){var o=Math.sqrt(r*r+i*i);r/=o,i/=o}return{x:r,y:i}},e.getDistance=function(e,t,n){return void 0===n&&(n=!1),n?r(e,t):Math.sqrt(r(e,t))},e.getMidpoint=function(t,n){var r=e.subtract(t,n);return{x:r.x/2+t.x,y:r.y/2+t.y}},e.make=function(e,t){return{x:e,y:t}},e.scale=function(e,t,n){return n?(n.x=e.x*t,n.y=e.y*t,n):{x:e.x*t,y:e.y*t}},e.zero=function(){return{x:0,y:0}},e}();t.Point=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(6),s=n(5),c=n(0),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getInstancePickingMethods=function(){var e=this;return{boundsAccessor:function(e){return new a.Bounds({height:2*e.radius,width:2*e.radius,x:e.x-e.radius,y:e.y-e.radius})},hitTest:function(t,n,r){var i=r.worldToScreen(t),o=r.worldToScreen(n),a=t.radius*e.props.scaleFactor(),s=[o.x-i.x,o.y-i.y];return s[0]*s[0]+s[1]*s[1]<a*a}}},t.prototype.initShader=function(){var e=this.props.scaleFactor||function(){return 1},t={0:1,1:1,2:-1,3:1,4:-1,5:-1},r={0:-1,1:-1,2:-1,3:1,4:1,5:1};return{fs:n(95),instanceAttributes:[{block:0,blockIndex:c.InstanceBlockIndex.ONE,name:"center",size:c.InstanceAttributeSize.TWO,update:function(e){return[e.x,e.y]}},{block:0,blockIndex:c.InstanceBlockIndex.THREE,name:"radius",size:c.InstanceAttributeSize.ONE,update:function(e){return[e.radius]}},{block:0,blockIndex:c.InstanceBlockIndex.FOUR,name:"depth",size:c.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{block:1,blockIndex:c.InstanceBlockIndex.ONE,name:"color",size:c.InstanceAttributeSize.FOUR,update:function(e){return e.color}}],uniforms:[{name:"scaleFactor",size:c.UniformSize.ONE,update:function(t){return[e()]}}],vertexAttributes:[{name:"position",size:c.VertexAttributeSize.THREE,update:function(e){return[t[e],r[e],0]}}],vertexCount:6,vs:n(94)}},t.prototype.getModelType=function(){return{drawMode:o.TriangleStripDrawMode,modelType:o.Mesh}},t.prototype.getMaterialOptions=function(){return{premultipliedAlpha:!0,transparent:!0}},t.defaultProps={data:null,fadeOutOversized:-1,key:"",scaleFactor:function(){return 1}},t}(s.Layer);t.CircleLayer=u},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(101)),r(n(93))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(102)),r(n(92)),r(n(36)),r(n(29)),r(n(71)),r(n(66)),r(n(4))},function(e,t){var n=1e3,r=60*n,i=60*r,o=24*i,a=365.25*o;function s(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var c,u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return s*a;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(e);if("number"===u&&!1===isNaN(e))return t.long?s(c=e,o,"day")||s(c,i,"hour")||s(c,r,"minute")||s(c,n,"second")||c+" ms":function(e){if(e>=o)return Math.round(e/o)+"d";if(e>=i)return Math.round(e/i)+"h";if(e>=r)return Math.round(e/r)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){function r(e){var n;function r(){if(r.enabled){var e=r,i=+new Date,o=i-(n||i);e.diff=o,e.prev=n,e.curr=i,n=i;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var i=t.formatters[r];if("function"==typeof i){var o=a[c];n=i.call(e,o),a.splice(c,1),c--}return n}),t.formatArgs.call(e,a),(r.log||t.log||console.log.bind(console)).apply(e,a)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=i,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(104),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c,u=[],l=!1,h=-1;function d(){l&&c&&(l=!1,c.length?u=c.concat(u):h=-1,u.length&&p())}function p(){if(!l){var e=s(d);l=!0;for(var t=u.length;t;){for(c=u,u=[];++h<t;)c&&c[h].run();h=-1,t=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function y(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||l||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,n){e.exports=t},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=function(){function e(e,t,n,r,i){var o=e.mid;this.TL=new s(e.x,o.x,e.y,o.y,n,t),this.TR=new s(o.x,e.right,e.y,o.y,n,t),this.BL=new s(e.x,o.x,o.y,e.bottom,n,t),this.BR=new s(o.x,e.right,o.y,e.bottom,n,t),this.TL.childToNode=r,this.TR.childToNode=r,this.BL.childToNode=r,this.BR.childToNode=r,this.TL.childToBounds=i,this.TR.childToBounds=i,this.BL.childToBounds=i,this.BR.childToBounds=i}return e.prototype.destroy=function(){this.TL.destroy(),this.TR.destroy(),this.BL.destroy(),this.BR.destroy(),delete this.TL,delete this.TR,delete this.BL,delete this.BR},e}();t.Quadrants=a;var s=function(){function e(e,t,n,r,i,a){void 0===a&&(a=0),this.children=[],this.depth=0,this.nodes=null,arguments.length>=4?this.bounds=new o.Bounds({left:e,right:t,top:n,bottom:r}):this.bounds=new o.Bounds({left:0,right:1,top:1,bottom:0}),this.depth=a,this.getBounds=i,0===this.depth&&(this.nullBounded=[],this.childToNode=new Map,this.childToBounds=new Map)}return e.prototype.destroy=function(){delete this.children,delete this.bounds,this.nodes&&(this.nodes.destroy(),this.nodes=null)},e.prototype.add=function(e){var t=this.childToBounds.get(e);return t||(t=this.getBounds(e),this.childToBounds.set(e,t)),!t||t.isInside(this.bounds)?this.doAdd(e,t):(this.cover(t),this.add(e))},e.prototype.addAll=function(e){var t=this,n=Number.MAX_VALUE,r=Number.MAX_VALUE,i=-Number.MAX_VALUE,a=-Number.MAX_VALUE;e.forEach(function(e){var o=t.getBounds(e);t.childToBounds.set(e,o),o&&(o.x<n&&(n=o.x),o.right>i&&(i=o.right),o.bottom>a&&(a=o.bottom),o.y<r&&(r=o.y))}),n!==Number.MAX_VALUE&&r!==Number.MAX_VALUE&&i!==-Number.MAX_VALUE&&a!==-Number.MAX_VALUE&&this.cover(new o.Bounds({left:n,right:i,bottom:a,top:r})),e.forEach(function(e,n){return t.doAdd(e,t.childToBounds.get(e)||null,!0)})},e.prototype.cover=function(e){var t=this;if(!e.isInside(this.bounds)){this.bounds.encapsulate(e),this.bounds.x-=1,this.bounds.y-=1,this.bounds.width+=2,this.bounds.height+=2;var n=this.gatherChildren([]);this.children=[],this.nodes&&(this.nodes.destroy(),this.nodes=null),this.childToNode.clear(),n.forEach(function(e,n){return t.doAdd(e,t.childToBounds.get(e)||null)})}},e.prototype.doAdd=function(e,t,n){return t||0!==this.depth?t?this.nodes?t.isInside(this.nodes.TL.bounds)?this.nodes.TL.doAdd(e,t,n):t.isInside(this.nodes.TR.bounds)?this.nodes.TR.doAdd(e,t,n):t.isInside(this.nodes.BL.bounds)?this.nodes.BL.doAdd(e,t,n):t.isInside(this.nodes.BR.bounds)?this.nodes.BR.doAdd(e,t,n):(this.children.push(e),this.childToNode.set(e,this),!0):t.isInside(this.bounds)?(this.children.push(e),this.childToNode.set(e,this),this.children.length>5&&this.depth<10&&this.split(),!0):(isNaN(t.width+t.height+t.x+t.y)?console.error("Child did not fit into bounds because a dimension is NaN",e,t):0===t.area?console.error("Child did not fit into bounds because the area is zero",e,t):console.error("Child did not get insertted.","Parent:",this.bounds.toString(),"Child:",t.toString(),"Inside Checks:",t.x>=this.bounds.x,t.right<=this.bounds.right,t.y>=this.bounds.y,t.bottom<=this.bounds.bottom),!0):(console.warn("A null bounds was added to a Quad Tree node below the top node, which is invalid."),!1):(this.nullBounded.push(e),this.childToNode.set(e,this),!0)},e.prototype.doRemove=function(e){var t=this.children.indexOf(e);t>-1&&(this.children.splice(t,1),this.childToNode.delete(e),this.childToBounds.delete(e))},e.prototype.gatherChildren=function(e){return this.children.forEach(function(t){return e.push(t)}),this.nodes&&(this.nodes.TL.gatherChildren(e),this.nodes.TR.gatherChildren(e),this.nodes.BL.gatherChildren(e),this.nodes.BR.gatherChildren(e)),e},e.prototype.query=function(e,t){var n=[];return 0===this.depth&&(n=this.nullBounded.slice(0)),e instanceof o.Bounds&&e.hitBounds(this.bounds)?this.queryBounds(e,n,t):this.bounds.containsPoint(e)?this.queryPoint(e,n,t):n},e.prototype.queryBounds=function(e,t,n){var r=this;return this.children.forEach(function(n){var i=r.childToBounds.get(n);i&&i.hitBounds(e)&&t.push(n)}),n&&n(this),this.nodes&&(e.hitBounds(this.nodes.TL.bounds)&&this.nodes.TL.queryBounds(e,t,n),e.hitBounds(this.nodes.TR.bounds)&&this.nodes.TR.queryBounds(e,t,n),e.hitBounds(this.nodes.BL.bounds)&&this.nodes.BL.queryBounds(e,t,n),e.hitBounds(this.nodes.BR.bounds)&&this.nodes.BR.queryBounds(e,t,n)),t},e.prototype.queryPoint=function(e,t,n){var r=this;return this.children.forEach(function(n){var i=r.childToBounds.get(n);i&&i.containsPoint(e)&&t.push(n)}),n&&n(this),this.nodes&&(this.nodes.TL.bounds.containsPoint(e)&&this.nodes.TL.queryPoint(e,t,n),this.nodes.TR.bounds.containsPoint(e)&&this.nodes.TR.queryPoint(e,t,n),this.nodes.BL.bounds.containsPoint(e)&&this.nodes.BL.queryPoint(e,t,n),this.nodes.BR.bounds.containsPoint(e)&&this.nodes.BR.queryPoint(e,t,n)),t},e.prototype.remove=function(e){if(this.childToNode){var t=this.childToNode.get(e);if(t&&0===t.depth){var n=t.nullBounded.indexOf(e);if(n>-1)return t.nullBounded.splice(n),this.childToNode.delete(e),void this.childToBounds.delete(e)}t&&t.doRemove(e)}},e.prototype.split=function(){var e=this.gatherChildren([]);this.nodes=new a(this.bounds,this.depth+1,this.getBounds,this.childToNode,this.childToBounds),this.children=[];for(var t=0,n=e.length;t<n;++t){var r=e[t];this.doAdd(r,this.childToBounds.get(r)||null,!0)}},e.prototype.visit=function(e){var t=Boolean(e(this));this.nodes&&!t&&(this.nodes.TL.visit(e),this.nodes.TR.visit(e),this.nodes.BL.visit(e),this.nodes.BR.visit(e))},e}();t.Node=s;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(s);t.TrackedQuadTree=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this)||this;return n.offsetFilter=function(e){return e},n.scaleFilter=function(e){return e},Object.assign(n,t),n}return i(t,e),Object.defineProperty(t.prototype,"offset",{get:function(){return this.offsetFilter(this.base.offset)},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.scaleFilter(this.base.scale)},set:function(e){},enumerable:!0,configurable:!0}),t}(n(19).ChartCamera);t.ReferenceCamera=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(41);var o=function(){function e(){this.cleanObservation=new Map,this.instanceChanges=new Map,this.allowChanges=!0}return Object.defineProperty(e.prototype,"changeList",{get:function(){return this.allowChanges=!1,Array.from(this.instanceChanges.entries())},enumerable:!0,configurable:!0}),e.prototype.add=function(e){if(this.cleanObservation.get(e))return e;if(this.allowChanges){i.ObservableManager.mode=i.ObservableManagerMode.GATHER_OBSERVABLES,i.ObservableManager.observer=this;var t=void 0;e.$$register&&(t=e.$$register),this.cleanObservation.set(e,t),this.instanceChanges.set(e,r.InstanceDiffType.INSERT),i.ObservableManager.mode=i.ObservableManagerMode.BROADCAST}return e},e.prototype.clear=function(){for(var e=0,t=Array.from(this.cleanObservation.keys());e<t.length;e++){var n=t[e];this.remove(n)}},e.prototype.destroy=function(){var e=this;Array.from(this.cleanObservation.keys()).forEach(function(t){return e.remove(t)}),this.cleanObservation.clear(),this.instanceChanges.clear()},e.prototype.instanceUpdated=function(e){this.allowChanges&&this.instanceChanges.set(e,r.InstanceDiffType.CHANGE)},e.prototype.remove=function(e){return this.allowChanges&&(e.$$dispose,this.cleanObservation.delete(e),this.instanceChanges.set(e,r.InstanceDiffType.REMOVE)),!1},e.prototype.resolve=function(){this.allowChanges=!0,this.instanceChanges.clear()},e}();t.InstanceProvider=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(41),i="$$";t.observable=function(e,t){var n="_$"+t;Object.defineProperty(e,"$$dispose",{configurable:!0,enumerable:!1,get:function(){this[i]=null}}),Object.defineProperty(e,"$$register",{configurable:!0,enumerable:!1,get:function(){var e=this;return r.ObservableManager.mode===r.ObservableManagerMode.GATHER_OBSERVABLES?(this[i]=r.ObservableManager.observer,function(){return e[i]=null}):null}}),Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return this[n]},set:function(e){this[n]=e;var t=this[i];t&&t.instanceUpdated(this)}})}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(2),s=n(20),c=n(8);!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_MIDDLE=1]="TOP_MIDDLE",e[e.TOP_RIGHT=2]="TOP_RIGHT",e[e.MIDDLE_LEFT=3]="MIDDLE_LEFT",e[e.MIDDLE=4]="MIDDLE",e[e.MIDDLE_RIGHT=5]="MIDDLE_RIGHT",e[e.BOTTOM_LEFT=6]="BOTTOM_LEFT",e[e.BOTTOM_MIDDLE=7]="BOTTOM_MIDDLE",e[e.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(o=t.CameraBoundsAnchor||(t.CameraBoundsAnchor={}));var u=Math.max,l=Math.min,h=function(e){function t(t){var n=e.call(this)||this;return n.isPanning=!1,n.panFilter=function(e,t,n){return e},n.scaleFilter=function(e,t,n){return e},n.onRangeChanged=function(e,t){},n.startViewDidStart=!1,n.applyBounds=function(){if(n.bounds&&n.camera){var e=n.getView(n.bounds.view);n.applyScaleBounds(),e&&(n.camera.offset[0]=n.boundsHorizontalOffset(e),n.camera.offset[1]=n.boundsVerticalOffset(e))}},n.applyScaleBounds=function(){n.camera&&n.bounds&&(n.bounds.scaleMin&&(n.camera.scale=[u(n.camera.scale[0],n.bounds.scaleMin[0]),u(n.camera.scale[1],n.bounds.scaleMin[1]),u(n.camera.scale[2],n.bounds.scaleMin[2])]),n.bounds.scaleMax&&(n.camera.scale=[l(n.camera.scale[0],n.bounds.scaleMax[0]),l(n.camera.scale[1],n.bounds.scaleMax[1]),l(n.camera.scale[2],n.bounds.scaleMax[2])]))},n.setBounds(t.bounds),n.camera=t.camera,n.scaleFactor=t.scaleFactor||1e3,n.ignoreCoverViews=t.ignoreCoverViews||!1,t.startView&&(n.startViews=Array.isArray(t.startView)?t.startView:[t.startView]),n.panFilter=t.panFilter||n.panFilter,n.scaleFilter=t.scaleFilter||n.scaleFilter,n.onRangeChanged=t.onRangeChanged||n.onRangeChanged,n}return i(t,e),t.prototype.anchoredByBoundsHorizontal=function(e){switch(this.bounds.anchor){case o.TOP_LEFT:case o.MIDDLE_LEFT:case o.BOTTOM_LEFT:return-(this.bounds.worldBounds.left-this.bounds.screenPadding.left/this.camera.scale[0]);case o.TOP_MIDDLE:case o.MIDDLE:case o.BOTTOM_MIDDLE:return-(this.bounds.worldBounds.right-this.bounds.worldBounds.width/2-(e.screenBounds.width+this.bounds.screenPadding.right)/this.camera.scale[0]*.5);case o.TOP_RIGHT:case o.MIDDLE_RIGHT:case o.BOTTOM_RIGHT:return-(this.bounds.worldBounds.right-(e.screenBounds.width-this.bounds.screenPadding.right)/this.camera.scale[0])}},t.prototype.anchoredByBoundsVertical=function(e){switch(this.bounds.anchor){case o.TOP_LEFT:case o.TOP_MIDDLE:case o.TOP_RIGHT:return-this.bounds.worldBounds.top- -this.bounds.screenPadding.top/this.scale[1];case o.MIDDLE_LEFT:case o.MIDDLE:case o.MIDDLE_RIGHT:return-(this.bounds.worldBounds.bottom-this.bounds.worldBounds.height/2)+.5*(e.screenBounds.height-this.bounds.screenPadding.bottom)/this.scale[1];case o.BOTTOM_LEFT:case o.BOTTOM_MIDDLE:case o.BOTTOM_RIGHT:return-(this.bounds.worldBounds.bottom-(e.screenBounds.height-this.bounds.screenPadding.bottom)/this.scale[1])}},t.prototype.boundsHorizontalOffset=function(e){var t=e.worldToScreen({x:this.bounds.worldBounds.left,y:this.bounds.worldBounds.top}),n=e.worldToScreen({x:this.bounds.worldBounds.right,y:this.bounds.worldBounds.bottom});return n.x-t.x+this.bounds.screenPadding.left+this.bounds.screenPadding.right-e.screenBounds.width<0?this.anchoredByBoundsHorizontal(e):n.x<e.screenBounds.right-this.bounds.screenPadding.right?-this.bounds.worldBounds.right+(e.screenBounds.width-this.bounds.screenPadding.right)/this.camera.scale[0]:t.x>e.screenBounds.left+this.bounds.screenPadding.left?-this.bounds.worldBounds.left+this.bounds.screenPadding.left/this.camera.scale[0]:this.camera.offset[0]},t.prototype.boundsVerticalOffset=function(e){var t=e.worldToScreen({x:this.bounds.worldBounds.left,y:this.bounds.worldBounds.top}),n=e.worldToScreen({x:this.bounds.worldBounds.right,y:this.bounds.worldBounds.bottom});return n.y-t.y+this.bounds.screenPadding.top+this.bounds.screenPadding.bottom-e.screenBounds.height<0?this.anchoredByBoundsVertical(e):t.y>e.screenBounds.top-this.bounds.screenPadding.top?-(this.bounds.worldBounds.top-this.bounds.screenPadding.top/this.camera.scale[1]):n.y<e.screenBounds.bottom+this.bounds.screenPadding.bottom?-(this.bounds.worldBounds.bottom+(-e.screenBounds.height+this.bounds.screenPadding.bottom)/this.camera.scale[1]):this.camera.offset[1]},t.prototype.canStart=function(e){return!this.startViews||0===this.startViews.length||this.startViews&&this.startViews.indexOf(e)>-1||this.startViewDidStart&&this.ignoreCoverViews},t.prototype.findCoveredStartView=function(e){var t=this,n=e.viewsUnderMouse.find(function(e){return t.startViews.indexOf(e.view.id)>-1});this.startViewDidStart=Boolean(n),n&&(this.coveredStartView=n.view)},t.prototype.getTargetView=function(e){return this.startViews&&!this.ignoreCoverViews?e.target.view:this.coveredStartView},t.prototype.handleMouseDown=function(e,t){this.findCoveredStartView(e),this.isPanning=this.canStart(e.start.view.id)},t.prototype.handleMouseUp=function(e){this.startViewDidStart=!1,this.isPanning=!1},t.prototype.handleDrag=function(e,t){if(this.canStart(e.start.view.id)){var n=[t.screen.delta.x/this.camera.scale[0],t.screen.delta.y/this.camera.scale[1],0];this.panFilter&&(n=this.panFilter(n,e.start.view,e.viewsUnderMouse.map(function(e){return e.view}))),this.camera.offset[0]+=n[0],this.camera.offset[1]+=n[1],this.applyBounds(),this.onRangeChanged(this.camera,e.start.view),this.applyBounds()}},t.prototype.handleWheel=function(e,t){if(this.findCoveredStartView(e),this.canStart(e.target.view.id)){var n=this.getTargetView(e),r=n.screenToWorld(e.screen.mouse),i=this.camera.scale[0]||1,o=this.camera.scale[1]||1,a=[t.wheel[1]/this.scaleFactor*i,t.wheel[1]/this.scaleFactor*o,1];this.scaleFilter&&(a=this.scaleFilter(a,n,e.viewsUnderMouse.map(function(e){return e.view}))),this.camera.scale[0]=i+a[0],this.camera.scale[1]=o+a[1],this.applyScaleBounds();var s=n.screenToWorld(e.screen.mouse);this.camera.offset[0]-=r.x-s.x,this.camera.offset[1]-=r.y-s.y,this.applyBounds(),this.onRangeChanged(this.camera,n),this.applyBounds()}},t.prototype.handleMouseOut=function(e){},t.prototype.handleClick=function(e){},t.prototype.handleMouseMove=function(e){},t.prototype.handleMouseOver=function(e){},t.prototype.getRange=function(e){var t=this.getProjection(e),n=this.getViewScreenBounds(e);if(t&&n){var r=t.screenToWorld(n),i=t.screenToWorld({x:n.right,y:n.bottom});return new a.Bounds({height:i.y-r.y,width:i.x-r.x,x:r.x,y:r.y})}return new a.Bounds({x:0,y:0,width:1,height:1})},Object.defineProperty(t.prototype,"pan",{get:function(){return this.camera.offset},enumerable:!0,configurable:!0}),t.prototype.setBounds=function(e){this.bounds=e,this.applyBounds()},Object.defineProperty(t.prototype,"scale",{get:function(){return this.camera.scale},enumerable:!0,configurable:!0}),t.prototype.setRange=function(e,t){var n=this.getProjection(t),r=this.getViewScreenBounds(t),i=this.getView(t);if(n&&r&&i){var o=c.subtract3([r.width/e.width,r.height/e.height,1],this.camera.scale);this.camera.scale=c.add3(this.camera.scale,this.scaleFilter(o,i,[i]));var a=c.subtract3([-e.x,-e.y,0],this.camera.offset);this.camera.offset=c.add3(this.camera.offset,this.scaleFilter(a,i,[i])),this.applyBounds(),this.onRangeChanged(this.camera,i),this.applyBounds()}},t}(s.EventManager);t.BasicCameraController=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(112))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(113)),r(n(103)),r(n(3)),r(n(6)),r(n(61)),r(n(0)),r(n(8))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(114))}])});
//# sourceMappingURL=index.js.map