!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["network-bubble-chart"]=t():e["network-bubble-chart"]=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=100)}([function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR"}(t.InstanceBlockIndex||(t.InstanceBlockIndex={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR",e[e.MAT4X4=16]="MAT4X4",e[e.ATLAS=99]="ATLAS"}(i=t.InstanceAttributeSize||(t.InstanceAttributeSize={})),t.instanceAttributeSizeFloatCount=((r={})[i.ONE]=1,r[i.TWO]=2,r[i.THREE]=3,r[i.FOUR]=4,r[i.MAT4X4]=16,r[i.ATLAS]=4,r),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR",e[e.MATRIX3=9]="MATRIX3",e[e.MATRIX4=16]="MATRIX4",e[e.VEC4_ARRAY=98]="VEC4_ARRAY",e[e.ATLAS=99]="ATLAS"}(t.UniformSize||(t.UniformSize={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR"}(t.VertexAttributeSize||(t.VertexAttributeSize={})),function(e){e[e._2=2]="_2",e[e._4=4]="_4",e[e._8=8]="_8",e[e._16=16]="_16",e[e._32=32]="_32",e[e._64=64]="_64",e[e._128=128]="_128",e[e._256=256]="_256",e[e._512=512]="_512",e[e._1024=1024]="_1024",e[e._2048=2048]="_2048",e[e._4096=4096]="_4096"}(t.TextureSize||(t.TextureSize={})),function(e){e[e.ATLAS=0]="ATLAS",e[e.FONT=1]="FONT"}(t.ResourceType||(t.ResourceType={})),function(e){e[e.zyx=0]="zyx",e[e.zyz=1]="zyz",e[e.zxy=2]="zxy",e[e.zxz=3]="zxz",e[e.yxz=4]="yxz",e[e.yxy=5]="yxy",e[e.yzx=6]="yzx",e[e.yzy=7]="yzy",e[e.xyz=8]="xyz",e[e.xyx=9]="xyx",e[e.xzy=10]="xzy",e[e.xzx=11]="xzx"}(t.EulerOrder||(t.EulerOrder={})),t.isInstanceAttributeVector=function(e){return void 0!==e.size&&e.size<=4},t.isResourceAttribute=function(e){return Boolean(e&&e.resource)},function(e){e[e.VERTEX=1]="VERTEX",e[e.FRAGMENT=2]="FRAGMENT",e[e.ALL=3]="ALL"}(t.ShaderInjectionTarget||(t.ShaderInjectionTarget={})),t.NOOP=function(){},t.whiteSpaceRegEx=/\s/g,t.whiteSpaceCharRegEx=/\s/,t.isWhiteSpace=t.whiteSpaceCharRegEx.test.bind(t.whiteSpaceCharRegEx),t.newLineRegEx=/\r\n|\n|\r/g,t.newLineCharRegEx=/\r\n|\n|\r/,t.isNewline=t.newLineCharRegEx.test.bind(t.newLineCharRegEx),t.createMaterialOptions=function(e){return e},function(e){e[e.NONE=0]="NONE",e[e.SINGLE=1]="SINGLE"}(t.PickType||(t.PickType={})),function(e){e[e.CHANGE=0]="CHANGE",e[e.INSERT=1]="INSERT",e[e.REMOVE=2]="REMOVE"}(t.InstanceDiffType||(t.InstanceDiffType={})),function(e){e[e.NO_WEBGL_CONTEXT=0]="NO_WEBGL_CONTEXT"}(t.SurfaceErrorType||(t.SurfaceErrorType={})),function(e){e[e.UNIFORM=0]="UNIFORM",e[e.INSTANCE_ATTRIBUTE=1]="INSTANCE_ATTRIBUTE",e[e.INSTANCE_ATTRIBUTE_PACKING=2]="INSTANCE_ATTRIBUTE_PACKING"}(t.LayerBufferType||(t.LayerBufferType={}))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(13)),r(n(58)),r(n(115)),r(n(44)),r(n(116)),r(n(117)),r(n(64)),r(n(59)),r(n(45)),r(n(60)),r(n(43)),r(n(28)),r(n(118)),r(n(9)),r(n(119))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(18)),r(n(50)),r(n(10)),r(n(146))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Math.sqrt,i=Math.max,o=Math.min,a=Math.floor,s=Math.ceil,c=Math.abs,u=Math.acos,l=Math.sin;function h(e,t){return(e=e||[])[0]=t,e}function d(e,t,n){return h(n,e[0]+t[0])}function f(e,t){return h(t,s(e[0]))}function p(e,t){return e[0]===t[0]}function g(e,t){return h(t,e[0])}function v(e,t,n){return h(n,0)}function y(e,t,n){return h(n,e[0]/t[0])}function m(e){return h(e,0)}function b(e,t){t=t||[];for(var n=0,r=e.length;n<r;++n)t.push(e[n][0]);return t}function w(e,t){return h(t,a(e[0]))}function x(e,t){return h(t,1/e[0])}function T(e,t,n){return h(n,e[0]*t)}function _(e,t,n){return h(n,e[0]-t[0])}function E(e,t,n){return h(n,i(e[0],t[0]))}function A(e,t,n){return h(n,o(e[0],t[0]))}function M(e,t,n){return h(n,e[0]*t[0])}function S(e,t){return h(t,1)}function O(e,t){return e[0]*t[0]}function I(e,t,n,r){return d(T(_(t,e),n),e,r)}function P(e){return r(O(e,e))}function R(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(n=n||[],(t=Array.isArray(e)?e.slice(0,1):[e]).length<1)for(var i=0,o=n.length;i<o&&t.length<1;++i){var a=n[i];Array.isArray(a)?t.push.apply(t,a.slice(0,1-t.length)):t.push(a)}for(;t.length<1;)t.push(0);return t}function L(e,t,n){return(e=e||[])[0]=t,e[1]=n,e}function C(e,t,n){return L(n,e[0]+t[0],e[1]+t[1])}function N(e,t){return L(t,s(e[0]),s(e[1]))}function D(e,t){return L(t,e[0],e[1])}function B(e,t,n){return L(n,0,0)}function z(e,t){return e[0]===t[0]&&e[1]===t[1]}function k(e,t,n){return L(n,e[0]/t[0],e[1]/t[1])}function j(e){return L(e,0,0)}function F(e,t){t=t||[];for(var n=0,r=e.length;n<r;++n){var i=e[n];t.push(i[0]),t.push(i[1])}return t}function U(e,t){return L(t,a(e[0]),a(e[1]))}function V(e,t){return L(t,1/e[0],1/e[1])}function G(e,t,n){return L(n,i(e[0],t[0]),i(e[1],t[1]))}function W(e,t,n){return L(n,o(e[0],t[0]),o(e[1],t[1]))}function H(e,t,n){return L(n,e[0]*t,e[1]*t)}function q(e,t,n){return L(n,e[0]-t[0],e[1]-t[1])}function X(e,t,n){return L(n,e[0]*t[0],e[1]*t[1])}function Q(e,t){var n=$(e);return L(t,e[0]/n,e[1]/n)}function Y(e,t){return e[0]*t[0]+e[1]*t[1]}function K(e,t,n,r){return C(H(q(t,e),n),e,r)}function $(e){return r(Y(e,e))}function Z(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(n=n||[],(t=Array.isArray(e)?e.slice(0,2):[e]).length<2)for(var i=0,o=n.length;i<o&&t.length<2;++i){var a=n[i];Array.isArray(a)?t.push.apply(t,a.slice(0,2-t.length)):t.push(a)}for(;t.length<2;)t.push(0);return t}function J(e,t,n,r){return(e=e||[])[0]=t,e[1]=n,e[2]=r,e}function ee(e,t,n){return J(n,e[0]+t[0],e[1]+t[1],e[2]+t[2])}function te(e,t){return J(t,s(e[0]),s(e[1]),s(e[2]))}function ne(e,t){return J(t,e[0],e[1],e[2])}function re(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function ie(e,t,n){return J(n,e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0])}function oe(e,t,n){return J(n,e[0]/t[0],e[1]/t[1],e[2]/t[2])}function ae(e){return J(e,0,0,0)}function se(e,t){t=t||[];for(var n=0,r=e.length;n<r;++n){var i=e[n];t.push(i[0]),t.push(i[1]),t.push(i[2])}return t}function ce(e,t){return J(t,a(e[0]),a(e[1]),a(e[2]))}function ue(e,t){return J(t,1/e[0],1/e[1],1/e[2])}function le(e,t,n){return J(n,e[0]*t,e[1]*t,e[2]*t)}function he(e,t,n){return J(n,e[0]-t[0],e[1]-t[1],e[2]-t[2])}function de(e,t,n){return J(n,e[0]*t[0],e[1]*t[1],e[2]*t[2])}function fe(e,t,n,r){return ee(le(he(t,e),n),e,r)}function pe(e){return r(me(e,e))}function ge(e,t,n){return J(n,i(e[0],t[0]),i(e[1],t[1]),i(e[2],t[2]))}function ve(e,t,n){return J(n,o(e[0],t[0]),o(e[1],t[1]),o(e[2],t[2]))}function ye(e,t){var n=pe(e);return J(t,e[0]/n,e[1]/n,e[2]/n)}function me(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function be(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(n=n||[],(t=Array.isArray(e)?e.slice(0,3):[e]).length<3)for(var i=0,o=n.length;i<o&&t.length<3;++i){var a=n[i];Array.isArray(a)?t.push.apply(t,a.slice(0,3-t.length)):t.push(a)}for(;t.length<3;)t.push(0);return t}function we(e,t,n,r,i){return(e=e||[])[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function xe(e,t,n){return we(n,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3])}function Te(e,t){return we(t,s(e[0]),s(e[1]),s(e[2]),s(e[3]))}function _e(e,t){return we(t,e[0],e[1],e[2],e[3])}function Ee(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Ae(e,t,n){return we(n,0,0,0,1)}function Me(e,t,n){return we(n,e[0]/t[0],e[1]/t[1],e[2]/t[2],e[3]/t[3])}function Se(e){return we(e,0,0,0,0)}function Oe(e,t){t=t||[];for(var n=0,r=e.length;n<r;++n){var i=e[n];t.push(i[0]),t.push(i[1]),t.push(i[2]),t.push(i[3])}return t}function Ie(e,t){return we(t,a(e[0]),a(e[1]),a(e[2]),a(e[3]))}function Pe(e,t){return we(t,1/e[0],1/e[1],1/e[2],1/e[3])}function Re(e,t,n){return we(n,e[0]*t,e[1]*t,e[2]*t,e[3]*t)}function Le(e,t,n){return we(n,e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Ce(e,t,n){return we(n,e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3])}function Ne(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function De(e,t,n,r){return xe(Re(Le(t,e),n),e,r)}function Be(e){return r(Ne(e,e))}function ze(e,t,n){return we(n,i(e[0],t[0]),i(e[1],t[1]),i(e[2],t[2]),i(e[3],t[3]))}function ke(e,t,n){return we(n,o(e[0],t[0]),o(e[1],t[1]),o(e[2],t[2]),o(e[3],t[3]))}function je(e,t){var n=Be(e);return we(t,e[0]/n,e[1]/n,e[2]/n,e[3]/n)}function Fe(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(n=n||[],(t=Array.isArray(e)?e.slice(0,4):[e]).length<4)for(var i=0,o=n.length;i<o&&t.length<4;++i){var a=n[i];Array.isArray(a)?t.push.apply(t,a.slice(0,4-t.length)):t.push(a)}for(;t.length<4;)t.push(0);return t}function Ue(e,t,n,r){r=r||[0,0,0,0];var i,o,a,s,c,h=[0,0,0,0];return(o=e[1]*t[1]+e[2]*t[2]+e[3]*t[3]+e[0]*t[0])<0?(o=-o,h[0]=-t[1],h[1]=-t[2],h[2]=-t[3],h[3]=-t[0]):(h[0]=t[1],h[1]=t[2],h[2]=t[3],h[3]=t[0]),1-o>1e-7?(i=u(o),a=l(i),s=l((1-n)*i)/a,c=l(n*i)/a):(s=1-n,c=n),r[1]=s*e[1]+c*h[0],r[2]=s*e[2]+c*h[1],r[3]=s*e[3]+c*h[2],r[0]=s*e[0]+c*h[3],r}t.isVec1=function(e){return e&&Array.isArray(e)&&1===e.length},t.isVec2=function(e){return e&&Array.isArray(e)&&2===e.length},t.isVec3=function(e){return e&&Array.isArray(e)&&3===e.length},t.isVec4=function(e){return e&&Array.isArray(e)&&4===e.length},t.apply1=h,t.add1=d,t.ceil1=f,t.compare1=p,t.fuzzyCompare1=function(e,t,n){return c(e[0]-t[0])<=n},t.copy1=g,t.cross1=v,t.divide1=y,t.empty1=m,t.flatten1=b,t.floor1=w,t.inverse1=x,t.scale1=T,t.subtract1=_,t.max1=E,t.min1=A,t.multiply1=M,t.normalize1=S,t.dot1=O,t.linear1=I,t.length1=P,t.vec1=R,t.apply2=L,t.add2=C,t.ceil2=N,t.copy2=D,t.cross2=B,t.compare2=z,t.fuzzyCompare2=function(e,t,n){return c(e[0]-t[0])<=n&&c(e[1]-t[1])<=n},t.divide2=k,t.empty2=j,t.flatten2=F,t.floor2=U,t.inverse2=V,t.max2=G,t.min2=W,t.scale2=H,t.subtract2=q,t.multiply2=X,t.normalize2=Q,t.dot2=Y,t.linear2=K,t.length2=$,t.vec2=Z,t.apply3=J,t.add3=ee,t.ceil3=te,t.copy3=ne,t.compare3=re,t.fuzzyCompare3=function(e,t,n){return c(e[0]-t[0])<=n&&c(e[1]-t[1])<=n&&c(e[2]-t[2])<=n},t.cross3=ie,t.divide3=oe,t.empty3=ae,t.flatten3=se,t.floor3=ce,t.inverse3=ue,t.scale3=le,t.subtract3=he,t.multiply3=de,t.linear3=fe,t.length3=pe,t.max3=ge,t.min3=ve,t.normalize3=ye,t.dot3=me,t.vec3=be,t.up3=function(e,t,n){return ye(ie(ie(e,t,n=n||[0,0,0]),e,n),n)},t.right3=function(e,t,n){return ye(ie(e,t,n=n||[0,0,0]),n)},t.left3=function(e,t,n){return ye(ie(t,e,n=n||[0,0,0]),n)},t.down3=function(e,t,n){return ye(ie(e,ie(e,t,n=n||[0,0,0]),n),n)},t.apply4=we,t.add4=xe,t.add4by3=function(e,t,n){return we(n,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3])},t.ceil4=Te,t.copy4=_e,t.compare4=Ee,t.fuzzyCompare4=function(e,t,n){return c(e[0]-t[0])<=n&&c(e[1]-t[1])<=n&&c(e[2]-t[2])<=n&&c(e[3]-t[3])<=n},t.cross4=Ae,t.divide4=Me,t.empty4=Se,t.flatten4=Oe,t.floor4=Ie,t.inverse4=Pe,t.scale4=Re,t.subtract4=Le,t.multiply4=Ce,t.dot4=Ne,t.linear4=De,t.length4=Be,t.max4=ze,t.min4=ke,t.normalize4=je,t.vec4=Fe,t.color4FromHex3=function(e,t){return we(t=t||[0,0,0,0],((16711680&e)>>16)/255,((65280&e)>>8)/255,(255&e)/255,1)},t.color4FromHex4=function(e,t){return we(t=t||[0,0,0,0],((4278190080&e)>>24)/255,((16711680&e)>>16)/255,((65280&e)>>8)/255,(255&e)/255)},t.slerpQuat=Ue,t.vec1Methods={add:d,ceil:f,copy:g,compare:p,cross:v,divide:y,dot:O,empty:m,flatten:b,floor:w,inverse:x,length:P,linear:I,max:E,min:A,multiply:M,normalize:S,scale:T,subtract:_,vec:R},t.vec2Methods={add:C,ceil:N,copy:D,compare:z,cross:B,divide:k,dot:Y,empty:j,flatten:F,floor:U,inverse:V,length:$,linear:K,max:G,min:W,multiply:X,normalize:Q,scale:H,subtract:q,vec:Z},t.vec3Methods={add:ee,ceil:te,copy:ne,compare:re,cross:ie,divide:oe,dot:me,empty:ae,flatten:se,floor:ce,inverse:ue,length:pe,linear:fe,max:ge,min:ve,multiply:de,normalize:ye,scale:le,subtract:he,vec:be},t.vec4Methods={add:xe,ceil:Te,copy:_e,compare:Ee,cross:Ae,divide:Me,dot:Ne,empty:Se,flatten:Oe,floor:Ie,inverse:Pe,length:Be,linear:De,max:ze,min:ke,multiply:Ce,normalize:je,scale:Re,subtract:Le,vec:Fe,slerpQuat:Ue},t.VecMath=function(e){return 1===e.length?t.vec1Methods:2===e.length?t.vec2Methods:3===e.length?t.vec3Methods:t.vec4Methods},t.toString1=function(e){return"["+e[0]+"]"},t.toString2=function(e){return"["+e[0]+", "+e[1]+"]"},t.toString3=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"},t.toString4=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"}},function(e,t,n){(function(r){function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(106)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))})),e.splice(o,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(105))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.baseShaderModules=function(t){var n=e.prototype.baseShaderModules.call(this,t);return n.vs.push("world2D"),n},t}(n(15).Layer);t.Layer2D=o},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(121)),r(n(122)),r(n(46)),r(n(65)),r(n(12)),r(n(66)),r(n(123)),r(n(124)),r(n(67)),r(n(56)),r(n(22)),r(n(31)),r(n(68)),r(n(23))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Math.min,i=Math.max,o=function(){function e(e){this.x=0,this.y=0,this.width=0,this.height=0,this.x=e.x||e.left||0,this.y=e.y||e.top||0,this.height=e.height||(e.bottom||0)-this.y||0,this.width=e.width||(e.right||0)-this.x||0}return Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mid",{get:function(){return[this.x+this.width/2,this.y+this.height/2]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),e.emptyBounds=function(){return new e({height:0,width:0,x:0,y:0})},e.prototype.containsPoint=function(e){return!(e[0]<this.x||e[1]<this.y||e[0]>this.right||e[1]>this.bottom)},e.prototype.encapsulate=function(t){return t instanceof e?(t.x<this.x&&(this.width+=Math.abs(t.x-this.x),this.x=t.x),t.y<this.y&&(this.height+=Math.abs(t.y-this.y),this.y=t.y),this.right<t.right&&(this.width+=t.right-this.right),this.bottom<t.bottom&&(this.height+=t.bottom-this.bottom),!0):(t[0]<this.x&&(this.width+=this.x-t[0],this.x=t[0]),t[0]>this.right&&(this.width+=t[0]-this.x),t[1]<this.y&&(this.height+=this.y-t[1],this.y=t[1]),t[1]>this.bottom&&(this.height+=t[1]-this.y),!0)},e.prototype.encapsulateAll=function(t){if(!(t.length<=0)){var n=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;if(t[0]instanceof e)for(var c=t,u=0,l=c.length;u<l;++u){var h=c[u];n=r(n,h.left),o=i(o,h.right),a=r(a,h.top),s=i(s,h.bottom)}else{var d=t;for(u=0,l=d.length;u<l;++u){var f=d[u],p=f[0],g=f[1];n=r(n,p),o=i(o,p),a=r(a,g),s=i(s,g)}}this.x=Math.min(this.x,n),this.y=Math.min(this.y,a),this.width=Math.max(this.width,o-n),this.height=Math.max(this.height,s-a)}},e.prototype.fits=function(e){return this.width===e.width&&this.height===e.height?1:this.width>=e.width&&this.height>=e.height?2:0},e.prototype.hitBounds=function(e){return!(this.right<e.x||this.x>e.right||this.bottom<e.y||this.y>e.bottom)},e.prototype.isInside=function(e){return this.x>=e.x&&this.right<=e.right&&this.y>=e.y&&this.bottom<=e.bottom},Object.defineProperty(e.prototype,"location",{get:function(){return[this.x,this.y]},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"{x: "+this.x+" y:"+this.y+" w:"+this.width+" h:"+this.height+"}"},e}();t.Bounds=o},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(61)),r(n(62)),r(n(63))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=1;t.uid=function(){return++r};var i=0;t.colorUID=function(){return++i%16777215}},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var i=n(77),o=n(18),a=0,s=function(){function e(t){this.changes={},this._easing=new Map,this.observableStorage=[],this._uid=e.newUID,this.reactivate=!1,this._id=t.id||"",this.active=t.active||this.active}return Object.defineProperty(e,"newUID",{get:function(){return a=++a%16777215},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"active",{get:function(){return this._active},set:function(e){this._active=e,this.reactivate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"observableDisposer",{get:function(){var e=this;return function(){return delete e._observer}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"observer",{get:function(){return this._observer||null},set:function(e){var t=this._observer;t&&t!==e&&(this._easing.clear(),t.remove(this)),this._observer=e},enumerable:!0,configurable:!0}),e.prototype.clearEasing=function(){this._easing.clear(),delete this.easingId},Object.defineProperty(e.prototype,"easing",{get:function(){return this._easing},enumerable:!0,configurable:!0}),e.prototype.getEasing=function(e){if(this.easingId){var t=this.easingId["_"+e+"_end"];if(t){var n=this._easing.get(t);if(n instanceof i.EasingProps)return n}}},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),e.prototype.resourceTrigger=function(){console.warn("resourceTrigger called on an instance that did not override resourceTrigger. resourceTrigger MUST be overridden for instances","that utilize a resource. The observable that is tied to committing the resource should be 'triggered' in this method.")},r([o.observable],e.prototype,"_active",void 0),r([o.observable],e.prototype,"_uid",void 0),e}();t.Instance=s},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0}),r(n(41)),r(n(39)),r(n(26)),r(n(55)),r(n(3)),r(n(37)),r(n(104));var o=i(n(26)),a=i(n(55)),s=i(n(3));t.MatrixMath=o,t.VectorMath=s,t.QuaternionMath=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){!function(e){!function(e){e[e.RGBA4=0]="RGBA4",e[e.RGB565=1]="RGB565",e[e.RGB5_A1=2]="RGB5_A1"}(e.ColorBufferFormat||(e.ColorBufferFormat={})),function(e){e[e.DEPTH_COMPONENT16=0]="DEPTH_COMPONENT16",e[e.DEPTH_STENCIL=1]="DEPTH_STENCIL"}(e.DepthBufferFormat||(e.DepthBufferFormat={})),function(e){e[e.STENCIL_INDEX8=0]="STENCIL_INDEX8"}(e.StencilBufferFormat||(e.StencilBufferFormat={}))}(e.RenderTarget||(e.RenderTarget={})),function(e){!function(e){e[e.NoBlending=0]="NoBlending",e[e.NormalBlending=1]="NormalBlending",e[e.AdditiveBlending=2]="AdditiveBlending",e[e.SubtractiveBlending=3]="SubtractiveBlending",e[e.MultiplyBlending=4]="MultiplyBlending"}(e.Blending||(e.Blending={})),function(e){e[e.Zero=0]="Zero",e[e.One=1]="One",e[e.SrcColor=2]="SrcColor",e[e.OneMinusSrcColor=3]="OneMinusSrcColor",e[e.SrcAlpha=4]="SrcAlpha",e[e.OneMinusSrcAlpha=5]="OneMinusSrcAlpha",e[e.DstAlpha=6]="DstAlpha",e[e.OneMinusDstAlpha=7]="OneMinusDstAlpha",e[e.DstColor=8]="DstColor",e[e.OneMinusDstColor=9]="OneMinusDstColor"}(e.BlendingDstFactor||(e.BlendingDstFactor={})),function(e){e[e.Zero=0]="Zero",e[e.One=1]="One",e[e.SrcColor=2]="SrcColor",e[e.OneMinusSrcColor=3]="OneMinusSrcColor",e[e.SrcAlpha=4]="SrcAlpha",e[e.OneMinusSrcAlpha=5]="OneMinusSrcAlpha",e[e.DstAlpha=6]="DstAlpha",e[e.OneMinusDstAlpha=7]="OneMinusDstAlpha",e[e.DstColor=8]="DstColor",e[e.OneMinusDstColor=9]="OneMinusDstColor",e[e.SrcAlphaSaturate=10]="SrcAlphaSaturate"}(e.BlendingSrcFactor||(e.BlendingSrcFactor={})),function(e){e[e.Add=0]="Add",e[e.Subtract=1]="Subtract",e[e.ReverseSubtract=2]="ReverseSubtract"}(e.BlendingEquations||(e.BlendingEquations={})),function(e){e[e.NEVER=0]="NEVER",e[e.LESS=1]="LESS",e[e.EQUAL=2]="EQUAL",e[e.LESS_OR_EQUAL=3]="LESS_OR_EQUAL",e[e.GREATER=4]="GREATER",e[e.NOTEQUAL=5]="NOTEQUAL",e[e.GREATER_OR_EQUAL=6]="GREATER_OR_EQUAL",e[e.ALWAYS=7]="ALWAYS"}(e.DepthFunctions||(e.DepthFunctions={})),function(e){e[e.NONE=0]="NONE",e[e.CW=1]="CW",e[e.CCW=2]="CCW",e[e.BOTH=3]="BOTH"}(e.CullSide||(e.CullSide={}))}(e.Material||(e.Material={})),function(e){!function(e){e[e.LINE_LOOP=0]="LINE_LOOP",e[e.LINE_STRIP=1]="LINE_STRIP",e[e.LINES=2]="LINES",e[e.POINTS=3]="POINTS",e[e.TRIANGLE_FAN=4]="TRIANGLE_FAN",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLES=6]="TRIANGLES"}(e.DrawMode||(e.DrawMode={}))}(e.Model||(e.Model={})),function(e){!function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.CUBE_MAP=1]="CUBE_MAP"}(e.TextureBindingTarget||(e.TextureBindingTarget={})),function(e){e[e.REPEAT=0]="REPEAT",e[e.CLAMP_TO_EDGE=1]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"}(e.Wrapping||(e.Wrapping={})),function(e){e[e.Nearest=0]="Nearest",e[e.NearestMipMapNearest=1]="NearestMipMapNearest",e[e.NearestMipMapLinear=2]="NearestMipMapLinear",e[e.Linear=3]="Linear",e[e.LinearMipMapNearest=4]="LinearMipMapNearest",e[e.LinearMipMapLinear=5]="LinearMipMapLinear"}(e.TextureMinFilter||(e.TextureMinFilter={})),function(e){e[e.Nearest=0]="Nearest",e[e.Linear=1]="Linear"}(e.TextureMagFilter||(e.TextureMagFilter={})),function(e){e[e.UnsignedByte=0]="UnsignedByte",e[e.UnsignedShort_5_6_5=1]="UnsignedShort_5_6_5",e[e.UnsignedShort_4_4_4_4=2]="UnsignedShort_4_4_4_4",e[e.UnsignedShort_5_5_5_1=3]="UnsignedShort_5_5_5_1",e[e.UnsignedShort=4]="UnsignedShort",e[e.UnsignedInt=5]="UnsignedInt",e[e.UnsignedInt_24_8=6]="UnsignedInt_24_8",e[e.Byte=7]="Byte",e[e.Short=8]="Short",e[e.Int=9]="Int",e[e.Float=10]="Float",e[e.HalfFloat=11]="HalfFloat",e[e.UnsignedInt_2_10_10_10_REV=12]="UnsignedInt_2_10_10_10_REV",e[e.UnsignedInt_10F_11F_11F_REV=13]="UnsignedInt_10F_11F_11F_REV",e[e.UnsignedInt_5_9_9_9_REV=14]="UnsignedInt_5_9_9_9_REV",e[e.Float32UnsignedInt_24_8_REV=15]="Float32UnsignedInt_24_8_REV"}(e.SourcePixelFormat||(e.SourcePixelFormat={})),function(e){e[e.Alpha=0]="Alpha",e[e.DepthComponent=1]="DepthComponent",e[e.DepthStencil=2]="DepthStencil",e[e.Luminance=3]="Luminance",e[e.LuminanceAlpha=4]="LuminanceAlpha",e[e.RGB=5]="RGB",e[e.RGBA=6]="RGBA",e[e.RGBE=7]="RGBE"}(e.TexelDataType||(e.TexelDataType={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.FOUR=4]="FOUR",e[e.EIGHT=8]="EIGHT"}(e.PackAlignment||(e.PackAlignment={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.FOUR=4]="FOUR",e[e.EIGHT=8]="EIGHT"}(e.UnpackAlignment||(e.UnpackAlignment={}))}(e.Texture||(e.Texture={})),function(e){!function(e){e[e.ALPHA=0]="ALPHA",e[e.RGB=1]="RGB",e[e.RGBA=2]="RGBA"}(e.ReadFilter||(e.ReadFilter={})),function(e){e[e.UNSIGNED_BYTE=0]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT_5_6_5=1]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=2]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=3]="UNSIGNED_SHORT_5_5_5_1",e[e.FLOAT=4]="FLOAT"}(e.ReadTargetArrayFormat||(e.ReadTargetArrayFormat={}))}(e.Renderer||(e.Renderer={}))}(t.GLSettings||(t.GLSettings={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(40),o=n(26),a=n(9);function s(e){return e.projectionOptions.type===r.ORTHOGRAPHIC&&"left"in e.projectionOptions}function c(e){return e.projectionOptions.type===r.PERSPECTIVE&&"fov"in e.projectionOptions}!function(e){e[e.PERSPECTIVE=0]="PERSPECTIVE",e[e.ORTHOGRAPHIC=1]="ORTHOGRAPHIC"}(r=t.CameraProjectionType||(t.CameraProjectionType={})),t.isOrthographic=s,t.isPerspective=c;var u=function(){function e(e){this._id=a.uid(),this.animationEndTime=0,this.needsViewDrawn=!0,this.needsBroadcast=!1,this.viewChangeViewId="",this.transform=new i.Transform,this._projection=o.identity4(),this._needsUpdate=!0,this._viewProjection=o.identity4(),this._projectionOptions=e,this._needsUpdate=!0,this.onChange=e.onViewChange,this.update()}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.broadcast=function(e){this.onChange&&this.onChange(this,e)},e.makeOrthographic=function(){return new e({left:-100,right:100,top:-100,bottom:100,near:-100,far:1e5,type:r.ORTHOGRAPHIC})},e.makePerspective=function(t){return new e(Object.assign({type:r.PERSPECTIVE,far:1e4,near:1,fov:90*Math.PI/180,height:1e3,width:1e3},t))},Object.defineProperty(e.prototype,"projectionType",{get:function(){return this._projectionOptions.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projection",{get:function(){return this.update(),this._projection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this.transform.viewMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsUpdate",{get:function(){return this._needsUpdate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(e){this._needsUpdate=!0,this.transform.position=e},enumerable:!0,configurable:!0}),e.prototype.lookAt=function(e,t){this._needsUpdate=!0,this.transform.lookAt(e,t)},Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(e){this._needsUpdate=!0,this.transform.scale=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionOptions",{get:function(){return this._projectionOptions},set:function(e){this._projectionOptions=e,this._needsUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjection",{get:function(){return(this.transform.changed||this._needsUpdate)&&this.update(!0),this._viewProjection},enumerable:!0,configurable:!0}),e.prototype.resolve=function(){this._needsUpdate=!1,this.needsViewDrawn=!1,this.needsBroadcast=!1},e.prototype.update=function(e){(this._needsUpdate||e)&&(this.updateProjection(),this._needsUpdate=!1)},e.prototype.updateProjection=function(){s(this)?o.orthographic4x4(this.projectionOptions.left,this.projectionOptions.right,this.projectionOptions.bottom,this.projectionOptions.top,this.projectionOptions.near,this.projectionOptions.far,this._projection):c(this)&&o.perspective4x4(this.projectionOptions.fov,this.projectionOptions.width,this.projectionOptions.height,this.projectionOptions.near,this.projectionOptions.far,this._projection),o.multiply4x4(this._projection,this.transform.viewMatrix,this._viewProjection)},e}();t.Camera=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.BottomLeft=0]="BottomLeft",e[e.BottomMiddle=1]="BottomMiddle",e[e.BottomRight=2]="BottomRight",e[e.Custom=3]="Custom",e[e.Middle=4]="Middle",e[e.MiddleLeft=5]="MiddleLeft",e[e.MiddleRight=6]="MiddleRight",e[e.TopLeft=7]="TopLeft",e[e.TopMiddle=8]="TopMiddle",e[e.TopRight=9]="TopRight"}(t.AnchorType||(t.AnchorType={})),function(e){e[e.ALWAYS=1]="ALWAYS",e[e.BOUND_MAX=2]="BOUND_MAX",e[e.NEVER=3]="NEVER"}(t.ScaleMode||(t.ScaleMode={}))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(120)),r(n(57)),r(n(78)),r(n(79)),r(n(25)),r(n(80)),r(n(19)),r(n(42)),r(n(38))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(32)),r(n(125)),r(n(126)),r(n(130))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(1);t.subTextureIOValue=function(e){return e?[e.atlasTL[0],e.atlasTL[1],e.atlasBR[0],e.atlasBR[1]]:[0,0,0,0]};var o=function(){function e(e){this._uid=i.uid(),this.aspectRatio=1,this.atlasTL=[0,0],this.atlasTR=[0,0],this.atlasBL=[0,0],this.atlasBR=[0,0],this.heightOnAtlas=0,this.isValid=!1,this.pixelWidth=0,this.pixelHeight=0,this.texture=null,this.widthOnAtlas=0,Object.assign(this,e)}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),e.fromRegion=function(t,n){if(!t.data)return null;var i=n.x/t.data.width,o=n.y/t.data.height,a=n.width/t.data.width,s=n.height/t.data.height,c=new r.Bounds({bottom:o+s,left:i,right:i+a,top:o}),u=c.bottom,l=c.y,h=c.x,d=c.x+c.width,f=new e;return f.atlasTL=[h,l],f.atlasBR=[d,u],f.atlasBL=[h,u],f.atlasTR=[d,l],f},e.prototype.update=function(){this.texture&&this.source&&this.atlasRegion&&this.texture.update(this.source,this.atlasRegion)},e.prototype.toString=function(){return JSON.stringify({atlas:{TL:this.atlasTL,TR:this.atlasTR,BL:this.atlasBL,BR:this.atlasBR},width:this.pixelWidth,height:this.pixelHeight},null,2)},e}();t.SubTexture=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=function(){function e(){}return e.setObservableMonitor=function(t){e.gatherIds=t,e.observableIds=[]},e.getObservableMonitorIds=function(t){var n=e.observableIds.slice(0);return t&&(e.observableIds=[]),n},e.gatherIds=!1,e.observableIds=[],e.observableNamesToUID=new Map,e}();t.ObservableMonitoring=i,t.observable=function(e,t){var n=i.observableNamesToUID.get(t)||0;n||(n=r.uid(),i.observableNamesToUID.set(t,n)),Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return i.gatherIds&&i.observableIds.push(n),this.observableStorage[n]},set:function(e){this.observableStorage[n]=e,this.changes[n]=n,this.observer&&this.observer.instanceUpdated(this)}})}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(23),a=n(18),s=n(141),c=n(0),u=n(1),l=n(21),h=n(144),d=n(148),f=n(151),p=n(78),g=n(79),v=n(25),y=n(4)("performance");t.createAttribute=function(e){return e},t.createUniform=function(e){return e},t.createVertex=function(e){return e},t.createLayer=function(e,t){return{get key(){return t.key||""},init:[e,Object.assign(t,{key:t.key||""})]}};var m=function(e){function t(n,r,i){var o=e.call(this,i)||this;return o.animationEndTime=0,o.depth=0,o.instanceAttributes=[],o.instanceVertexCount=0,o.lastFrameTime=0,o.needsViewDrawn=!1,o.uniforms=[],o._uid=u.uid(),o.vertexAttributes=[],o.willRebuildLayer=!1,o.surface=n,o.scene=r,o.props=Object.assign({},t.defaultProps||{},i),o}return i(t,e),Object.defineProperty(t.prototype,"bufferManager",{get:function(){return this._bufferManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),t.prototype.init=function(){var e=this.props.picking;(void 0===e?c.PickType.NONE:e)===c.PickType.SINGLE?this.picking={currentPickMode:c.PickType.NONE,type:c.PickType.SINGLE,uidToInstance:new Map}:this.picking={currentPickMode:c.PickType.NONE,type:c.PickType.NONE},this.resource=this.surface.resourceManager;var t=this.initShader();if(this.interactions=new f.LayerInteractionHandler(this),!t)return this.picking.type=c.PickType.NONE,y("Shell layer initialized. Nothing will be rendered for this layer",this.id),!0;if(!t.fs||!t.vs)return console.warn("Layer needs to specify the fragment and vertex shaders:",this.id),!1;t.instanceAttributes=(t.instanceAttributes||[]).filter(Boolean),t.vertexAttributes=(t.vertexAttributes||[]).filter(Boolean),t.uniforms=(t.uniforms||[]).filter(Boolean);var n=(new s.ShaderProcessor).process(this,t,this.surface.getIOExpanders(),this.surface.getIOSorting());if(!n)return console.warn("The shader processor did not produce metrics for the layer."),!1;var r=n.vertexAttributes,i=n.instanceAttributes,o=n.uniforms,a=p.generateLayerGeometry(this,n.maxInstancesPerBuffer,r,t.vertexCount),u=g.generateLayerMaterial(this,n.vs,n.fs,o,n.materialUniforms),l=v.generateLayerModel(a,u,t.drawMode);return this.geometry=a,this.instanceAttributes=i,this.instanceVertexCount=t.vertexCount,this.material=u,this.maxInstancesPerBuffer=n.maxInstancesPerBuffer,this.model=l,this.uniforms=o,this.vertexAttributes=r,this.makeLayerBufferManager(this.surface.gl,this.scene),this.props.printShader&&(console.warn("A Layer requested its shader be debugged. Do not leave this active for production:","Layer:",this.props.key,"Shader Metrics",n),console.warn("\n\nVERTEX SHADER\n--------------\n\n",n.vs),console.warn("\n\nFRAGMENT SHADER\n--------------\n\n",n.fs)),!0},t.prototype.baseShaderModules=function(e){var t=[],n=[];return t.push("instancing"),this.picking.type===c.PickType.SINGLE?(t.push("picking"),n.push("picking")):(t.push("no-picking"),n.push("no-picking")),(e.instanceAttributes||[]).find((function(e){return Boolean(e&&e.easing)}))&&t.push("frame"),{fs:n,vs:t}},t.prototype.childLayers=function(){return[]},t.prototype.destroy=function(){this.bufferManager&&(this.bufferManager.scene&&this.bufferManager.scene.removeLayer(this),this.bufferManager.removeFromScene(),this.bufferManager.destroy())},t.prototype.didUpdateProps=function(){},t.prototype.draw=function(){var e,t,n,r=this.props.data.changeList;r.length>0&&(this.needsViewDrawn=!0);var i=this.diffManager,o=i.processing,a=i.processor;a.incomingChangeList(r),this.bufferManager.incomingChangeList(r);for(var s=0,c=r.length;s<c;++s)t=(e=r[s])[0],n=this.bufferManager.getBufferLocations(t),o[e[1]](a,t,Object.values(e[2]),n),t.changes={};a.commit(),this.bufferManager.changesProcessed(),this.props.data.resolve(this.id),this.updateUniforms()},t.prototype.getInstanceObservableIds=function(e,t){for(var n={},r=0,i=t.length;r<i;++r){a.ObservableMonitoring.setObservableMonitor(!0),e[t[r]];var o=a.ObservableMonitoring.getObservableMonitorIds(!0);void 0!==o[0]&&(n[t[r]]=o[0])}return a.ObservableMonitoring.setObservableMonitor(!1),n},t.prototype.getMaterialOptions=function(){return{}},t.prototype.initShader=function(){return{fs:"${import: no-op}",instanceAttributes:[],uniforms:[],vertexAttributes:[],vertexCount:0,vs:"${import: no-op}"}},t.prototype.managesInstance=function(e){return this.bufferManager&&this.bufferManager.managesInstance(e)},t.prototype.getLayerBufferType=function(e,t,n){var r=c.LayerBufferType.UNIFORM,i=0;if(void 0!==this.bufferType)return this.bufferType;if(o.WebGLStat.HARDWARE_INSTANCING){for(var a=0,s=t.length;a<s;++a){var u=t[a];i+=Math.ceil(u.size/4)}for(a=0,s=n.length;a<s;++a){u=n[a];i+=Math.ceil(c.instanceAttributeSizeFloatCount[u.size||1]/4)}if(i>o.WebGLStat.MAX_VERTEX_ATTRIBUTES){i=0;for(a=0,s=n.length;a<s;++a){u=n[a];i=Math.max(i,u.block||0)}for(a=0,s=t.length;a<s;++a){u=t[a];i+=Math.ceil(u.size/4)}i<o.WebGLStat.MAX_VERTEX_ATTRIBUTES&&(r=c.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING,y("Performance Issue (Moderate):\n            Layer %o is utilizing too many vertex attributes and is now using vertex packing.\n            Max Vertex units %o\n            Used Vertex units %o\n            Instance Attributes %o\n            Vertex Attributes %o",this.id,o.WebGLStat.MAX_VERTEX_ATTRIBUTES,i,n,t))}else r=c.LayerBufferType.INSTANCE_ATTRIBUTE}return r===c.LayerBufferType.UNIFORM&&(y("Performance Issue (High):\n        Layer %o is utilizing too many vertex attributes and is now using a uniform buffer.\n        Max Vertex units %o\n        Used Vertex units %o\n        Instance Attributes %o\n        Vertex Attributes %o",this.id,o.WebGLStat.MAX_VERTEX_ATTRIBUTES,i,n,t),r=c.LayerBufferType.UNIFORM),this.setBufferType(r),r},t.prototype.makeLayerBufferManager=function(e,t){switch(this.getLayerBufferType(e,this.vertexAttributes,this.instanceAttributes)){case c.LayerBufferType.INSTANCE_ATTRIBUTE:this.setBufferManager(new h.InstanceAttributeBufferManager(this,t));break;case c.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING:this.setBufferManager(new h.InstanceAttributePackingBufferManager(this,t));break;default:this.setBufferManager(new h.UniformBufferManager(this,t))}},t.prototype.rebuildLayer=function(){if(this.willRebuildLayer=!0,this.children)for(var e=0,t=this.children.length;e<t;++e){this.children[e].rebuildLayer()}},t.prototype.resolveChanges=function(e){var t=this.props.data.changeList;t.length>0&&(this.needsViewDrawn=!0),e||this.props.data.resolve(this.id);for(var n=0,r=t.length;n<r;++n)t[n][0].changes={};return t},t.prototype.setBufferManager=function(e){this._bufferManager?console.warn("You can not change a layer's buffer strategy once it has been instantiated."):(this._bufferManager=e,this.diffManager=new d.InstanceDiffManager(this,e),this.diffManager.makeProcessor())},t.prototype.setBufferType=function(e){void 0===this._bufferType?this._bufferType=e:console.warn("You can not change a layers buffer strategy once it has been instantiated.")},t.prototype.shouldDrawView=function(e,t){for(var n in t)if(t[n]!==e[n])return!0;return!1},t.prototype.updateUniforms=function(){for(var e,t,n=0,r=this.uniforms.length;n<r;++n)e=this.uniforms[n],t=e.update(e),e.materialUniforms.forEach((function(e){return e.value=t}))},t.prototype.willUpdateProps=function(e){e.picking!==this.props.picking&&this.rebuildLayer()},t.defaultProps={},t}(l.IdentifyByKey);t.Layer=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBufferLocation=function(e){return e&&e.buffer&&e.buffer.value},t.isBufferLocationGroup=function(e){return e&&e.propertyToBufferLocation};var r=function(){function e(e,t){this.layer=e,this.scene=t}return e.prototype.changesProcessed=function(){delete this.changeListContext},e.prototype.incomingChangeList=function(e){this.changeListContext=e},e}();t.BufferManagerBase=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this._key=e.key}return Object.defineProperty(e.prototype,"id",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),e}();t.IdentifyByKey=o;var a=function(e){function t(t){var n=e.call(this,t)||this;return n.data=t.data,n}return i(t,e),t}(o);t.IdentifiableData=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(12),o=function(){function e(e){this._uid=r.uid(),this._flipY=!1,this._format=i.GLSettings.Texture.TexelDataType.RGBA,this._generateMipmaps=!1,this._magFilter=i.GLSettings.Texture.TextureMagFilter.Linear,this._minFilter=i.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear,this.needsDataUpload=!1,this.needsPartialDataUpload=!1,this.needsSettingsUpdate=!1,this._packAlignment=i.GLSettings.Texture.PackAlignment.FOUR,this._premultiplyAlpha=!1,this._type=i.GLSettings.Texture.SourcePixelFormat.UnsignedByte,this._unpackAlignment=i.GLSettings.Texture.UnpackAlignment.FOUR,this._updateRegions=[],this._wrapHorizontal=i.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE,this._wrapVertical=i.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE,this.anisotropy=e.anisotropy||this.anisotropy,this.data=e.data||this.data,this.flipY=e.flipY||this.flipY,this.format=e.format||this.format,this.generateMipMaps=e.generateMipMaps||this.generateMipMaps,this.magFilter=e.magFilter||this.magFilter,this.minFilter=e.minFilter||this.minFilter,this.packAlignment=e.packAlignment||this.packAlignment,this.premultiplyAlpha=e.premultiplyAlpha||this.premultiplyAlpha,this.type=e.type||this.type,this.unpackAlignment=e.unpackAlignment||this.unpackAlignment,this.wrapHorizontal=e.wrapHorizontal||this.wrapHorizontal,this.wrapVertical=e.wrapVertical||this.wrapVertical}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anisotropy",{get:function(){return this._anisotropy},set:function(e){this.needsSettingsUpdate=!0,this._anisotropy=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this.needsDataUpload=!0,this._data=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flipY",{get:function(){return this._flipY},set:function(e){this.needsDataUpload=!0,this._flipY=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"format",{get:function(){return this._format},set:function(e){this.needsDataUpload=!0,this._format=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"generateMipMaps",{get:function(){return this._generateMipmaps},set:function(e){this.needsSettingsUpdate=!0,this._generateMipmaps=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"magFilter",{get:function(){return this._magFilter},set:function(e){this.needsSettingsUpdate=!0,this._magFilter=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minFilter",{get:function(){return this._minFilter},set:function(e){this.needsSettingsUpdate=!0,this._minFilter=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"packAlignment",{get:function(){return this._packAlignment},set:function(e){this.needsSettingsUpdate=!0,this._packAlignment=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"premultiplyAlpha",{get:function(){return this._premultiplyAlpha},set:function(e){this.needsSettingsUpdate=!0,this._premultiplyAlpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){this.needsDataUpload=!0,this._type=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unpackAlignment",{get:function(){return this._unpackAlignment},set:function(e){this.needsSettingsUpdate=!0,this._unpackAlignment=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updateRegions",{get:function(){return this._updateRegions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wrapHorizontal",{get:function(){return this._wrapHorizontal},set:function(e){this.needsSettingsUpdate=!0,this._wrapHorizontal=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wrapVertical",{get:function(){return this._wrapVertical},set:function(e){this.needsSettingsUpdate=!0,this._wrapVertical=e},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.gl&&this.gl.proxy.disposeTexture(this),delete this._data},e.prototype.resolve=function(){this.needsDataUpload=!1,this.needsPartialDataUpload=!1,this.needsSettingsUpdate=!1,this._updateRegions=[]},e.prototype.update=function(e,t){this.needsPartialDataUpload=!0,this._updateRegions.push([e,t])},e}();t.Texture=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProgramInfo=function(e,t){for(var n={attributeCount:0,attributes:new Array,uniformCount:0,uniforms:new Array},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o={35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT"},a={35664:1,35665:1,35666:1,35667:1,35668:1,35669:1,35670:1,35671:1,35672:1,35673:1,35674:1,35675:3,35676:4,35678:1,35680:1,5120:1,5121:1,5122:1,5123:1,5124:1,5125:1,5126:1},s=0;s<r;++s){var c=e.getActiveUniform(t,s);c.typeName=o[c.type],n.uniforms.push(c),n.uniformCount+=c.size,c.size=c.size*a[c.type]}for(s=0;s<i;s++){var u=e.getActiveAttrib(t,s);u.typeName=o[u.type],n.attributes.push(u),n.attributeCount+=u.size}return n};var r,i=function(){function e(){}return e.MAX_VERTEX_UNIFORMS=0,e.MAX_FRAGMENT_UNIFORMS=0,e.MAX_VERTEX_ATTRIBUTES=0,e.WEBGL_SUPPORTED=!1,e.MAX_TEXTURE_SIZE=0,e.HARDWARE_INSTANCING=!1,e.HARDWARE_INSTANCING_ANGLE=!1,e}();t.WebGLStat=i,(r=function(){try{var e=document.createElement("canvas");return window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(e){return!1}}())&&(i.WEBGL_SUPPORTED=!0,i.MAX_VERTEX_UNIFORMS=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),i.MAX_FRAGMENT_UNIFORMS=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),i.MAX_VERTEX_ATTRIBUTES=r.getParameter(r.MAX_VERTEX_ATTRIBS),i.MAX_TEXTURE_SIZE=r.getParameter(r.MAX_TEXTURE_SIZE),i.HARDWARE_INSTANCING_ANGLE=Boolean(r.getExtension("ANGLE_instanced_arrays")),i.HARDWARE_INSTANCING=i.HARDWARE_INSTANCING_ANGLE)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=function(){function e(e,t,n,i){this.child=[null,null],this.isLeaf=!0,this.data=null,this.bounds=new r.Bounds({height:i,width:n,x:e,y:t})}return e.prototype.destroy=function(){var e=this.child[0],t=this.child[1];this.data=null,e&&e.destroy(),t&&t.destroy(),this.child[0]=null,this.child[1]=null},e.prototype.hasChild=function(){var e=this.child[0],t=this.child[1];return e&&!e.data?!e.isLeaf:!(!t||t.data)&&!t.isLeaf},e.prototype.insert=function(t){var n=this.child[0],r=this.child[1];if(!this.isLeaf&&n&&r){var i=n.insert(t);return null!==i?i:r.insert(t)}if(this.data)return null;var o=this.bounds.fits(t.bounds);if(0===o)return null;if(1===o)return this.data=t.data,this;this.isLeaf=!1;var a=t.bounds.width,s=t.bounds.height,c=this.bounds.width-a,u=this.bounds.height-t.bounds.height;return c>u?(n=this.child[0]=new e(this.bounds.x,this.bounds.y,a,this.bounds.height),r=this.child[1]=new e(this.bounds.x+a,this.bounds.y,c,this.bounds.height)):(n=this.child[0]=new e(this.bounds.x,this.bounds.y,this.bounds.width,s),r=this.child[1]=new e(this.bounds.x,this.bounds.y+s,this.bounds.width,u)),n.insert(t)},e.prototype.remove=function(e){var t=this.child[0],n=this.child[1];if(n&&t&&!this.isLeaf){var r=t.remove(e);return!!r||(r=n.remove(e),t.hasChild()||n.hasChild()||(this.child[0]=null,this.child[1]=null),r)}return this.data===e&&(this.data=null,!0)},e.applyToSubTexture=function(t,n,i,o,a){if(i){o=o||{top:0,left:0,bottom:0,right:0};var s,c=n instanceof e?n.bounds:n,u=(c.x+o.left)/t.bounds.width,l=(c.y+o.top)/t.bounds.height,h=(c.width-o.left-o.right)/t.bounds.width,d=(c.height-o.top-o.bottom)/t.bounds.height,f=(s=a?new r.Bounds({bottom:1-l,left:u,right:u+h,top:1-(l+d)}):new r.Bounds({top:1-l,left:u,right:u+h,bottom:1-(l+d)})).bottom,p=s.y,g=s.x,v=s.x+s.width;i.atlasTL=[g,p],i.atlasBR=[v,f],i.atlasBL=[g,f],i.atlasTR=[v,p],i.widthOnAtlas=Math.abs(i.atlasTR[0]-i.atlasTL[0]),i.heightOnAtlas=Math.abs(i.atlasTR[1]-i.atlasBR[1]),i.pixelWidth=h*t.bounds.width,i.pixelHeight=d*t.bounds.height}},e}();t.PackNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6);t.generateLayerModel=function(e,t,n){var i=new r.Model(e,t);return i.drawMode=n||r.GLSettings.Model.DrawMode.TRIANGLE_STRIP,i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=Math.cos,o=Math.sin,a=Math.tan;function s(e,t,n,r,i){return(e=e||[])[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function c(e,t,n,r,i,o,a,s,c,u){return(e=e||[])[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=c,e[8]=u,e}function u(e,t,n,r,i,o,a,s,c,u,l,h,d,f,p,g,v){return(e=e||[])[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=c,e[8]=u,e[9]=l,e[10]=h,e[11]=d,e[12]=f,e[13]=p,e[14]=g,e[15]=v,e}t.M200=0,t.M201=1,t.M210=2,t.M211=3,t.M300=0,t.M301=1,t.M302=2,t.M310=3,t.M311=4,t.M312=5,t.M320=6,t.M321=7,t.M322=8,t.M400=0,t.M401=1,t.M402=2,t.M403=3,t.M410=4,t.M411=5,t.M412=6,t.M413=7,t.M420=8,t.M421=9,t.M422=10,t.M423=11,t.M430=12,t.M431=13,t.M432=14,t.M433=15,t.apply2x2=s,t.apply3x3=c,t.apply4x4=u;var l=m(),h=m(),d=m(),f=m();function p(e){return e[3]*e[0]-e[1]*e[2]}function g(e){return e[0]*e[4]*e[8]-e[0]*e[5]*e[7]+e[1]*e[5]*e[6]-e[1]*e[3]*e[8]+e[2]*e[3]*e[7]-e[2]*e[4]*e[6]}function v(e){return c(l,e[5],e[6],e[7],e[9],e[10],e[11],e[13],e[14],e[15]),c(h,e[4],e[6],e[7],e[8],e[10],e[11],e[12],e[14],e[15]),c(d,e[4],e[5],e[7],e[8],e[9],e[11],e[12],e[13],e[15]),c(d,e[4],e[5],e[6],e[8],e[9],e[10],e[12],e[13],e[14]),e[0]*g(l)-e[1]*g(h)+e[2]*g(d)-e[3]*g(f)}function y(e){return s(e,1,0,0,1)}function m(e){return c(e,1,0,0,0,1,0,0,0,1)}function b(e){return u(e,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}function w(e,t,n){return u(n,t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15])}function x(e,n,i){return r.apply4(i,e[t.M400]*n[0]+e[t.M410]*n[1]+e[t.M420]*n[2]+e[t.M430]*n[3],e[t.M401]*n[0]+e[t.M411]*n[1]+e[t.M421]*n[2]+e[t.M431]*n[3],e[t.M402]*n[0]+e[t.M412]*n[1]+e[t.M422]*n[2]+e[t.M432]*n[3],e[t.M403]*n[0]+e[t.M413]*n[1]+e[t.M423]*n[2]+e[t.M433]*n[3])}function T(e,t,n,r){if(e){if(t){if(n){var a=i(e),s=i(t),c=i(n),l=o(e),h=o(t);return u(r,s*c,s*(d=o(n)),-h,0,l*h*c-a*d,l*h*d+a*c,l*s,0,a*h*c+l*d,a*h*d-l*c,a*s,0,0,0,0,1)}a=i(e),s=i(t),l=o(e);return u(r,s,0,-(h=o(t)),0,l*h,a,l*s,0,a*h,-l,a*s,0,0,0,0,1)}if(n){a=i(e),c=i(n),l=o(e);return u(r,c,d=o(n),0,0,-a*d,a*c,l,0,l*d,-l*c,a,0,0,0,0,1)}return u(r,1,0,0,0,0,a=i(e),l=o(e),0,0,-l,a,0,0,0,0,1)}if(t){if(n){s=i(t),c=i(n),h=o(t);return u(r,s*c,s*(d=o(n)),-h,0,-d,c,0,0,h*c,h*d,s,0,0,0,0,1)}return u(r,s=i(t),0,-(h=o(t)),0,0,1,0,0,h,0,s,0,0,0,0,1)}var d;return n?u(r,c=i(n),d=o(n),0,0,-d,c,0,0,0,0,1,0,0,0,0,1):b(r)}function _(e,t,n,r){return u(r,e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1)}function E(e,t,n,r){return u(r,1,0,0,0,0,1,0,0,0,0,1,0,e,t,n,1)}function A(e,t,n,r,i,o,a){return u(a=a||b(),2*e/(r-n),0,0,0,0,2*e/(i-o),0,0,(r+n)/(r-n),(i+o)/(i-o),-(t+e)/(t-e),-1,0,0,-2*t*e/(t-e),0)}function M(e,t,n,i,o){return x(e,t,o=o||[0,0,0,0]),r.apply4(o,.5*(o[0]/o[3]+1)*n,.5*(o[1]/o[3]+1)*i,o[2]/o[3],1)}t.determinant2x2=p,t.determinant3x3=g,t.determinant4x4=v,t.affineInverse2x2=function(e,t){var n=p(e);return 0===n?null:s(t,e[3]/n,-e[1]/n,-e[2]/n,e[0]/n)},t.affineInverse3x3=function(e,t){var n=g(e);if(0===n)return null;var r=p([e[4],e[5],e[7],e[8]]),i=p([e[3],e[5],e[6],e[8]]),o=p([e[3],e[4],e[6],e[7]]),a=p([e[1],e[2],e[7],e[8]]),s=p([e[0],e[2],e[6],e[8]]),u=p([e[0],e[1],e[6],e[7]]);return c(t,r/n,-a/n,p([e[1],e[2],e[4],e[5]])/n,-i/n,s/n,p([e[0],e[2],e[3],e[5]])/n,o/n,-u/n,p([e[0],e[1],e[3],e[4]])/n)},t.affineInverse4x4=function(e,t){var n=v(e);if(0===n)return null;var r=p([e[0],e[1],e[4],e[5]]),i=p([e[0],e[2],e[4],e[6]]),o=p([e[0],e[3],e[4],e[7]]),a=p([e[1],e[2],e[5],e[6]]),s=p([e[1],e[3],e[5],e[7]]),c=p([e[2],e[3],e[6],e[7]]),l=p([e[10],e[11],e[14],e[15]]),h=p([e[9],e[11],e[13],e[15]]),d=p([e[9],e[10],e[13],e[14]]),f=p([e[8],e[11],e[12],e[15]]),g=p([e[8],e[10],e[12],e[14]]),y=p([e[8],e[9],e[12],e[13]]);return u(t,(e[5]*l-e[6]*h+e[7]*d)/n,(-e[1]*l+e[2]*h-e[3]*d)/n,(e[12]*c-e[13]*s+e[14]*a)/n,(-e[9]*c+e[10]*s-e[11]*a)/n,(-e[4]*l+e[6]*f-e[7]*g)/n,(e[0]*l-e[2]*f+e[3]*g)/n,(-e[12]*c+e[14]*o-e[15]*i)/n,(e[8]*c-e[10]*o+e[11]*i)/n,(e[4]*h-e[5]*f+e[7]*y)/n,(-e[0]*h+e[1]*f-e[3]*y)/n,(e[12]*s-e[13]*o+e[15]*r)/n,(-e[8]*s+e[9]*o-e[11]*r)/n,(-e[4]*d+e[5]*g-e[6]*y)/n,(e[0]*d-e[1]*g+e[2]*y)/n,(-e[12]*a+e[13]*i-e[14]*r)/n,(e[8]*a-e[9]*i+e[10]*r)/n)},t.multiplyScalar2x2=function(e,t,n){return s(n,e[0]*t,e[1]*t,e[2]*t,e[3]*t)},t.multiplyScalar3x3=function(e,t,n){return c(n,e[0]*t,e[1]*t,e[2]*t,e[3]*t,e[4]*t,e[5]*t,e[6]*t,e[7]*t,e[8]*t)},t.multiplyScalar4x4=function(e,t,n){return u(n,e[0]*t,e[1]*t,e[2]*t,e[3]*t,e[4]*t,e[5]*t,e[6]*t,e[7]*t,e[8]*t,e[9]*t,e[10]*t,e[11]*t,e[12]*t,e[13]*t,e[14]*t,e[15]*t)},t.identity2=y,t.identity3=m,t.identity4=b,t.multiply2x2=function(e,n,r){return s(r,n[t.M200]*e[t.M200]+n[t.M201]*e[t.M210],n[t.M200]*e[t.M201]+n[t.M201]*e[t.M211],n[t.M210]*e[t.M200]+n[t.M211]*e[t.M210],n[t.M210]*e[t.M201]+n[t.M211]*e[t.M211])},t.multiply3x3=function(e,t,n){return c(n,t[0]*e[0]+t[1]*e[3]+t[2]*e[6],t[0]*e[1]+t[1]*e[4]+t[2]*e[7],t[0]*e[2]+t[1]*e[5]+t[2]*e[8],t[3]*e[0]+t[4]*e[3]+t[5]*e[6],t[3]*e[1]+t[4]*e[4]+t[5]*e[7],t[3]*e[2]+t[4]*e[5]+t[5]*e[8],t[6]*e[0]+t[7]*e[3]+t[8]*e[6],t[6]*e[1]+t[7]*e[4]+t[8]*e[7],t[6]*e[2]+t[7]*e[5]+t[8]*e[8])},t.multiply4x4=w,t.concat4x4=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(t.length<=0)return b();e=e||b(),u.call.apply(u,[null,e].concat(t[t.length-1]));for(var r=t.length-2;r>=0;--r){var i=t[r];w(i,e,e)}return e},t.add2x2=function(e,t,n){return s(n,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3])},t.add3x3=function(e,t,n){return c(n,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3],e[4]+t[4],e[5]+t[5],e[6]+t[6],e[7]+t[7],e[8]+t[8])},t.add4x4=function(e,t,n){return u(n,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3],e[4]+t[4],e[5]+t[5],e[6]+t[6],e[7]+t[7],e[8]+t[8],e[9]+t[9],e[10]+t[10],e[11]+t[11],e[12]+t[12],e[13]+t[13],e[14]+t[14],e[15]+t[15])},t.subtract2x2=function(e,t,n){return s(n,e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])},t.subtract3x3=function(e,t,n){return c(n,e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3],e[4]-t[4],e[5]-t[5],e[6]-t[6],e[7]-t[7],e[8]-t[8])},t.subtract4x4=function(e,t,n){return u(n,e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3],e[4]-t[4],e[5]-t[5],e[6]-t[6],e[7]-t[7],e[8]-t[8],e[9]-t[9],e[10]-t[10],e[11]-t[11],e[12]-t[12],e[13]-t[13],e[14]-t[14],e[15]-t[15])},t.Hadamard2x2=function(e,t,n){return s(n,e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3])},t.Hadamard3x3=function(e,t,n){return c(n,e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3],e[4]*t[4],e[5]*t[5],e[6]*t[6],e[7]*t[7],e[8]*t[8])},t.Hadamard4x4=function(e,t,n){return u(n,e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3],e[4]*t[4],e[5]*t[5],e[6]*t[6],e[7]*t[7],e[8]*t[8],e[9]*t[9],e[10]*t[10],e[11]*t[11],e[12]*t[12],e[13]*t[13],e[14]*t[14],e[15]*t[15])},t.transpose2x2=function(e,t){return s(t,e[0],e[2],e[1],e[3])},t.transpose3x3=function(e,t){return c(t,e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])},t.transpose4x4=function(e,t){return u(t,e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},t.shearX2x2=function(e,t){return(e>=Math.PI/2||e<=-Math.PI/2)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),s(t=t||y(),1,0,a(e),1)},t.shearY2x2=function(e,t){return(e>=Math.PI/2||e<=-Math.PI/2)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),s(t=t||y(),1,a(e),0,1)},t.shearX4x4=function(e,t){(e>=Math.PI/2||e<=-Math.PI/2)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),t=t||b();var n=a(e);return u(t,1,n,n,0,n,1,0,0,n,0,1,0,0,0,0,1)},t.shearY4x4=function(e,t){(e>=Math.PI/2||e<=-Math.PI/2)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),t=t||b();var n=a(e);return u(t,1,n,0,0,n,1,n,0,0,n,1,0,0,0,0,1)},t.shearZ4x4=function(e,t){(e>=Math.PI/2||e<=-Math.PI/2)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),t=t||b();var n=a(e);return u(t,1,0,n,0,0,1,n,0,n,n,1,0,0,0,0,1)},t.transform2=function(e,n,i){return r.apply2(i,e[t.M200]*n[0]+e[t.M210]*n[1],e[t.M201]*n[0]+e[t.M211]*n[1])},t.transform3=function(e,n,i){return r.apply3(i,e[t.M300]*n[0]+e[t.M310]*n[1]+e[t.M320]*n[2],e[t.M301]*n[0]+e[t.M311]*n[1]+e[t.M321]*n[2],e[t.M302]*n[0]+e[t.M312]*n[1]+e[t.M322]*n[2])},t.transform3as4=function(e,n,i){return r.apply4(i,e[t.M400]*n[0]+e[t.M410]*n[1]+e[t.M420]*n[2]+1*e[t.M430],e[t.M401]*n[0]+e[t.M411]*n[1]+e[t.M421]*n[2]+1*e[t.M431],e[t.M402]*n[0]+e[t.M412]*n[1]+e[t.M422]*n[2]+1*e[t.M432],e[t.M403]*n[0]+e[t.M413]*n[1]+e[t.M423]*n[2]+1*e[t.M433])},t.transform4=x,t.toString2x2=function(e){return"Matrix: [\n  "+e[0]+", "+e[1]+",\n  "+e[2]+", "+e[3]+",\n]"},t.toString3x3=function(e){return"Matrix: [\n  "+e[0]+", "+e[1]+", "+e[2]+",\n  "+e[3]+", "+e[4]+", "+e[5]+",\n  "+e[6]+", "+e[7]+", "+e[8]+",\n]"},t.toString4x4=function(e){return"Matrix: [\n  "+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+",\n  "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+",\n  "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+",\n  "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+",\n]"},t.rotation4x4=T,t.rotation4x4by3=function(e,t){return T(e[0],e[1],e[2],t)},t.scale4x4by3=function(e,t){return _(e[0],e[1],e[2],t)},t.scale4x4=_,t.translation4x4by3=function(e,t){return E(e[0],e[1],e[2],t)},t.translation4x4=E,t.perspectiveFrustum4x4=A,t.perspective4x4=function(e,t,n,r,i,o){var s=n/t,c=a(e/2)*r,u=s*c;return A(r,i,-c,c,u,-u,o)},t.perspectiveFOVY4x4=function(e,t,n,r,i,o){var s=t/n,c=a(e/2)*r,u=s*c;return A(r,i,-u,u,c,-c,o)},t.orthographic4x4=function(e,t,n,r,i,o,a){return u(a,2/(t-e),0,0,0,0,2/(r-n),0,0,0,0,-1/(o-i),0,(t+e)/(e-t),(r+n)/(n-r),-i/(i-o),1)},t.projectToScreen=M,t.project3As4ToScreen=function(e,t,n,r,i){return M(e,[t[0],t[1],t[2],1],n,r,i)},t.compare2x2=function(e,t){return Math.abs(e[0]-t[0])<=1e-7&&Math.abs(e[1]-t[1])<=1e-7&&Math.abs(e[2]-t[2])<=1e-7&&Math.abs(e[3]-t[3])<=1e-7},t.compare3x3=function(e,t){return Math.abs(e[0]-t[0])<=1e-7&&Math.abs(e[1]-t[1])<=1e-7&&Math.abs(e[2]-t[2])<=1e-7&&Math.abs(e[3]-t[3])<=1e-7&&Math.abs(e[4]-t[4])<=1e-7&&Math.abs(e[5]-t[5])<=1e-7&&Math.abs(e[6]-t[6])<=1e-7&&Math.abs(e[7]-t[7])<=1e-7&&Math.abs(e[8]-t[8])<=1e-7},t.compare4x4=function(e,t){return Math.abs(e[0]-t[0])<=1e-7&&Math.abs(e[1]-t[1])<=1e-7&&Math.abs(e[2]-t[2])<=1e-7&&Math.abs(e[3]-t[3])<=1e-7&&Math.abs(e[4]-t[4])<=1e-7&&Math.abs(e[5]-t[5])<=1e-7&&Math.abs(e[6]-t[6])<=1e-7&&Math.abs(e[7]-t[7])<=1e-7&&Math.abs(e[8]-t[8])<=1e-7&&Math.abs(e[9]-t[9])<=1e-7&&Math.abs(e[10]-t[10])<=1e-7&&Math.abs(e[11]-t[11])<=1e-7&&Math.abs(e[12]-t[12])<=1e-7&&Math.abs(e[13]-t[13])<=1e-7&&Math.abs(e[14]-t[14])<=1e-7&&Math.abs(e[15]-t[15])<=1e-7}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(113),r(n(14)),r(n(86)),r(n(156))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shaderTemplate=function(e){var t=e.shader,n=e.options,r=e.required,i=e.onError,o=e.onToken,a=e.onMain,s=new Map,c=new Map,u=new Map,l=new Map,h=t.replace(/\$\{([^\}]*)\}/g,(function(e,t){var r="";return l.set(t,(l.get(t)||0)+1),t in n?(s.set(t,(s.get(t)||0)+1),r=n[t]):c.set(t,(c.get(t)||0)+1),o&&(r=o(t,r)),r}));Object.keys(n).forEach((function(e){s.get(e)||u.set(e,(u.get(e)||0)+1)}));var d={resolvedShaderOptions:s,shader:h,shaderProvidedOptions:l,unresolvedProvidedOptions:u,unresolvedShaderOptions:c};if(r&&r.values.forEach((function(e){if(d.unresolvedProvidedOptions.get(e)){var t=r.name+": Could not resolve all the required inputs. Input: "+e;i?i(t):console.error(t)}else if(d.unresolvedShaderOptions.get(e)){t=r.name+": A required option was not provided in the options parameter. Option: "+e;i?i(t):console.error(t)}else if(!d.resolvedShaderOptions.get(e)){t=r.name+": A required option was not provided in the options parameter. Option: "+e;i?i(t):console.error(t)}})),a){var f=d.shader,p=f.match(/void((.+)|\s)(main(\s+)\(\)|main\(\))(((.+)(\s*)\{)|(\s*)\{)/gm);if(p&&p.length>0){var g=f.indexOf(p[0]);if(g<0)a(null);else{for(var v=f.substr(g+p[0].length),y=!1,m=!1,b=1,w=0,x=-1,T=0,_=v.length;T<_;++T){var E=v[T],A=v[T+1];switch(E){case"/":switch(A){case"*":y||m||(y=!0,T++);break;case"/":y||m||(m=!0,T++)}break;case"*":"/"===A&&(m||(y=!1,T++));break;case"\n":case"\r":y||(m=!1);break;case"{":y||m||b++;break;case"}":y||m||w++,b===w&&(x=T)}if(-1!==x)break}if(-1!==x){var M=a(v.substr(0,x));d.shader="string"==typeof M?f.substr(0,g+p[0].length)+M+f.substr(g+p[0].length+x):f.substr(0,g)+M.header+f.substr(g,p[0].length)+M.main+f.substr(g+p[0].length+x)}else a(null)}}}return d}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(13),a=n(30),s=function(e){function t(t){var n=e.call(this,{left:-100,right:100,top:-100,bottom:100,near:-100,far:1e5,type:o.CameraProjectionType.ORTHOGRAPHIC})||this;return n.control2D=new a.Control2D(n,t),n}return i(t,e),Object.defineProperty(t.prototype,"scale2D",{get:function(){return this.control2D.scale},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offset",{get:function(){return this.control2D.offset},enumerable:!0,configurable:!0}),t}(o.Camera);t.Camera2D=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(41),i=n(3),o=n(9),a=r.AutoEasingMethod.immediate(0),s=function(){function e(e,t){this._id=o.uid(),this.animation=r.AutoEasingMethod.immediate(0),this.animationEndTime=0,this.offsetBroadcastTime=0,this.scaleBroadcastTime=0,this._offset=[0,0,0],this.startOffset=[0,0,0],this.startOffsetTime=0,this.offsetEndTime=0,this._scale=[1,1,1],this.startScale=[1,1,1],this.startScaleTime=0,this.scaleEndTime=0,this._needsViewDrawn=!0,this.needsBroadcast=!1,this.camera=e,t&&(this._offset=i.copy3(t.offset||this._offset),this._scale=i.copy3(t.scale||this._scale))}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.broadcast=function(e){this.offset,this.scale,this.needsBroadcast&&(this.needsBroadcast=!1,this.onViewChange&&this.onViewChange(this.camera,e))},e.prototype.centerOn=function(e,t){var n=this.surface.getViewSize(e);if(n){var r=[n.width/2,n.height/2,0],o=i.subtract3(t,i.divide3(r,this._scale)),s=this.animation;this.setOffset(i.copy3(this.offset)),this.animation=a,this.setOffset(i.scale3(o,-1)),this.animation=s}},e.prototype.getCurrentTime=function(){return this.surface?this.surface.frameMetrics.currentTime:0},e.prototype.getOffset=function(){return this._offset},e.prototype.getScale=function(){return this._scale},Object.defineProperty(e.prototype,"needsViewDrawn",{get:function(){return this._needsViewDrawn},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){var e=this.getCurrentTime();return this.onViewChange&&this.offsetBroadcastTime<this.offsetEndTime&&(this.offsetBroadcastTime=e,this.needsBroadcast=!0),this.animation.cpu(this.startOffset,this._offset,(e-this.startOffsetTime)/this.animation.duration)},enumerable:!0,configurable:!0}),e.prototype.setId=function(e){this._id=e,this._needsViewDrawn=!0},e.prototype.setOffset=function(e){this.startOffset=i.copy3(this.offset),this._offset=i.copy3(e),this.startOffsetTime=this.getCurrentTime(),this.offsetEndTime=this.startOffsetTime+this.animation.duration,this.updateEndTime(),this._needsViewDrawn=!0,this.onViewChange&&(this.offsetBroadcastTime=this.startOffsetTime,this.needsBroadcast=!0)},Object.defineProperty(e.prototype,"scale",{get:function(){var e=this.getCurrentTime();return this.onViewChange&&this.scaleBroadcastTime<this.scaleEndTime&&(this.scaleBroadcastTime=e,this.needsBroadcast=!0),this.animation.cpu(this.startScale,this._scale,(e-this.startScaleTime)/this.animation.duration)},enumerable:!0,configurable:!0}),e.prototype.setViewChangeHandler=function(e){this.onViewChange=e},e.prototype.setScale=function(e){this.startScale=i.copy3(this.scale),this._scale=i.copy3(e),this.startScaleTime=this.getCurrentTime(),this.scaleEndTime=this.startScaleTime+this.animation.duration,this.updateEndTime(),this._needsViewDrawn=!0,this.onViewChange&&(this.scaleBroadcastTime=this.startScaleTime,this.needsBroadcast=!0)},e.prototype.resolve=function(){this._needsViewDrawn=!1,this.needsBroadcast=!1},e.prototype.update=function(){this._needsViewDrawn=!0},e.prototype.updateEndTime=function(){this.animationEndTime=Math.max(this.scaleEndTime,this.offsetEndTime)},e}();t.Control2D=s},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.FLOAT=0]="FLOAT",e[e.VEC2=1]="VEC2",e[e.VEC3=2]="VEC3",e[e.VEC4=3]="VEC4",e[e.VEC4_ARRAY=4]="VEC4_ARRAY",e[e.FLOAT_ARRAY=5]="FLOAT_ARRAY",e[e.MATRIX3x3=6]="MATRIX3x3",e[e.MATRIX4x4=7]="MATRIX4x4",e[e.TEXTURE=8]="TEXTURE"}(r=t.MaterialUniformType||(t.MaterialUniformType={})),t.isUniformVec2=function(e){return e.type===r.VEC2},t.isUniformVec3=function(e){return e.type===r.VEC3},t.isUniformVec4=function(e){return e.type===r.VEC4},t.isUniformVec4Array=function(e){return e.type===r.VEC4_ARRAY},t.isUniformMat3=function(e){return e.type===r.MATRIX3x3},t.isUniformMat4=function(e){return e.type===r.MATRIX4x4},t.isUniformTexture=function(e){return e.type===r.TEXTURE},t.isUniformFloat=function(e){return e.type===r.FLOAT}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){}return e.prototype.getIOExpansion=function(){return[]},e.prototype.setAttributeContext=function(e){},e}();t.BaseResourceManager=s;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resources=new Map,t}return i(t,e),t.prototype.dequeueRequests=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2,!1]}))}))},t.prototype.destroy=function(){},t.prototype.destroyResource=function(e){this.resources.delete(e.key)},t.prototype.getResource=function(e){return this.resources.get(e)||{key:"",type:-1}},t.prototype.initResource=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){return this.resources.set(e.key,e),[2]}))}))},t.prototype.request=function(e,t,n){return[0,0,0,0]},t.prototype.updateResource=function(e){},t}(s);t.InvalidResourceManager=c,t.INVALID_RESOURCE_MANAGER=new c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.expand=function(e,t,n,r){return{instanceAttributes:[],uniforms:[],vertexAttributes:[]}},t.prototype.validate=function(e,t,n,r){return!0},t.prototype.processHeaderInjection=function(e,t,n,r,i,o,a){return{injection:""}},t.prototype.processAttributeDestructuring=function(e,t,n,r,i,o){return""},t}(n(61).BaseShaderIOInjection);t.BaseIOExpansion=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(214),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(8))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return Object.defineProperty(e.prototype,"surface",{get:function(){return this.userInputManager.surface},enumerable:!0,configurable:!0}),e.prototype.getProjection=function(e){var t=this.userInputManager.getView(e);return t?t.projection:null},e.prototype.getView=function(e){return this.userInputManager&&this.userInputManager.getView(e)||null},e.prototype.getViewScreenBounds=function(e){var t=this.userInputManager.getView(e);return t?t.screenBounds:null},e.prototype.setUserInputManager=function(e){this.userInputManager=e},e}();t.EventManager=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this)||this;return Object.assign(n,t),n}return i(t,e),t.prototype.handleMouseDown=function(e){},t.prototype.handleMouseUp=function(e){},t.prototype.handleMouseOver=function(e){},t.prototype.handleMouseOut=function(e){},t.prototype.handleMouseMove=function(e){},t.prototype.handleClick=function(e){},t.prototype.handleDrag=function(e){},t.prototype.handleWheel=function(e){},t.prototype.handleTouchCancelled=function(e){},t.prototype.handleTouchDown=function(e){},t.prototype.handleTouchUp=function(e){},t.prototype.handleTouchOut=function(e){},t.prototype.handleTouchDrag=function(e){},t.prototype.handleTap=function(e){},t.prototype.handleDoubleTap=function(e){},t.prototype.handleLongTouch=function(e){},t.prototype.handleLongTap=function(e){},t.prototype.handlePinch=function(e){},t.prototype.handleSpread=function(e){},t.prototype.handleTouchRotate=function(e){},t.prototype.handleSwipe=function(e){},t}(n(35).EventManager);t.SimpleEventHandler=o},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(54)),r(n(7))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(39),a=n(7),s=n(13),c=n(21),u=n(42);!function(e){e[e.COLOR=1]="COLOR",e[e.DEPTH=2]="DEPTH",e[e.STENCIL=4]="STENCIL"}(t.ClearFlags||(t.ClearFlags={})),t.createView=function(e,t){return{get key(){return t.key||""},init:[e,Object.assign(t,{key:t.key||"",viewport:t.viewport||{left:0,right:0,top:0,bottom:0}})]}};var l=function(e){function t(n,r){var i=e.call(this,r)||this;return i.animationEndTime=0,i.depth=0,i.lastFrameTime=0,i.needsDraw=!1,i.optimizeRendering=!1,i.pixelRatio=1,i.scene=n,i.props=Object.assign({},t.defaultProps||{},r),i}return i(t,e),Object.defineProperty(t.prototype,"screenBounds",{get:function(){return this.projection.screenBounds},set:function(e){this.projection.screenBounds=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewBounds",{get:function(){return this.projection.viewBounds},set:function(e){this.projection.viewBounds=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clearFlags",{get:function(){return this.props.clearFlags||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"order",{get:function(){return this.props.order||0},enumerable:!0,configurable:!0}),t.prototype.shouldDrawView=function(e,t){for(var n in t)if(t[n]!==e[n])return!0;return!1},t.prototype.willUpdateProps=function(e){},t.prototype.didUpdateProps=function(){},t.defaultProps={key:"",camera:s.Camera.makeOrthographic(),viewport:{left:0,right:0,top:0,bottom:0}},t}(c.IdentifyByKey);t.View=l;var h=function(e){function t(){var t=e.call(this,new u.LayerScene(void 0,{key:"error",layers:[],views:[]}),{key:"error",viewport:{},camera:s.Camera.makeOrthographic()})||this;return t.projection=new o.SimpleProjection,t.screenBounds=new a.Bounds({x:0,y:0,width:100,height:100}),t}return i(t,e),t.prototype.screenToWorld=function(e,t){return[0,0]},t.prototype.worldToScreen=function(e,t){return[0,0]},t.prototype.viewToWorld=function(e,t){return[0,0]},t.prototype.worldToView=function(e,t){return[0,0]},t.prototype.fitViewtoViewport=function(e,t){this.screenBounds=e},t}(l);t.NoView=h},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),a=n(3),s=function(){function e(){this._uid=o.uid(),this.id="",this.pixelRatio=1}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),e.prototype.screenToRenderSpace=function(e,t){return t=this.screenToView(e,t),a.apply2(t,e[0]*this.pixelRatio,e[1]*this.pixelRatio)},e.prototype.renderSpaceToScreen=function(e,t){return t=t||[0,0],a.apply2(t,e[0]/this.pixelRatio-this.screenBounds.x,e[1]/this.pixelRatio-this.screenBounds.y)},e.prototype.screenToView=function(e,t){return t=t||[0,0],a.apply2(t,e[0]-this.screenBounds.x,e[1]-this.screenBounds.y)},e.prototype.viewToScreen=function(e,t){return t=t||[0,0],a.apply2(t,e[0]+this.screenBounds.x,e[1]+this.screenBounds.y)},e}();t.BaseProjection=s;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.screenToWorld=function(e,t){return e},t.prototype.worldToScreen=function(e,t){return e},t.prototype.viewToWorld=function(e,t){return e},t.prototype.worldToView=function(e,t){return e},t}(s);t.SimpleProjection=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=function(){function e(){this._changed=!1,this.needsUpdate=!1,this.hasViewMatrix=!1,this._matrix=r.identity4(),this._rotation=r.oneQuat(),this.rotationMatrix=r.identity4(),this.needsRotationUpdate=!1,this._scale=[1,1,1],this.scaleMatrix=r.identity4(),this.needsScaleUpdate=!1,this._translation=[0,0,0],this.translationMatrix=r.identity4(),this.needsTranslationUpdate=!1}return Object.defineProperty(e.prototype,"changed",{get:function(){return this._changed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"matrix",{get:function(){return this.update(),this._matrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this.hasViewMatrix=!0,this._viewMatrix||(this.needsUpdate=!0),this.update(),this._viewMatrix?this._viewMatrix:r.identity4()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this.needsUpdate=!0,this.needsRotationUpdate=!0,this._changed=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale=e,this.needsUpdate=!0,this.needsScaleUpdate=!0,this._changed=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this._translation},set:function(e){this._translation=e,this.needsUpdate=!0,this.needsTranslationUpdate=!0,this._changed=!0},enumerable:!0,configurable:!0}),e.prototype.lookAt=function(e,t){this.rotation=r.lookAtQuat(r.subtract3(e,this._translation),t)},e.prototype.resolve=function(){this._changed=!1},e.prototype.update=function(){if(this.needsUpdate){var e=this.scaleMatrix;this.needsScaleUpdate&&(this.needsScaleUpdate=!1,r.scale4x4by3(this._scale,e));var t=this.rotationMatrix;this.needsRotationUpdate&&(this.needsRotationUpdate=!1,r.matrix4x4FromUnitQuatModel(this._rotation,t));var n=this.translationMatrix;this.needsTranslationUpdate&&(this.needsTranslationUpdate=!1,r.translation4x4by3(this._translation,n)),r.multiply4x4(n,r.multiply4x4(t,e,this._matrix),this._matrix),this.hasViewMatrix&&(this._viewMatrix||(this._viewMatrix=r.identity4()),r.concat4x4(this._viewMatrix,r.matrix4x4FromUnitQuatView(this._rotation),r.translation4x4by3(r.scale3(this._translation,-1)),r.scale4x4by3(r.inverse3(this._scale)))),this.needsUpdate=!1}},e}();t.Transform=i,t.IdentityTransform=new i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(9),o=n(3),a=Math.min,s=Math.max,c=Math.pow,u=Math.round,l=Math.sin,h=Math.PI,d=u(1e3*h)/1e3;function f(e,t,n){return a(s(e,t),n)}!function(e){e[e.NONE=1]="NONE",e[e.CONTINUOUS=4]="CONTINUOUS",e[e.REPEAT=2]="REPEAT",e[e.REFLECT=3]="REFLECT"}(r=t.AutoEasingLoopStyle||(t.AutoEasingLoopStyle={}));var p="\n${easingMethod} {\n  float p = 0.3;\n  float time = pow(2.0, -10.0 * t) * sin((t - p / 4.0) * (2.0 * "+d+") / p) + 1.0;\n  return (end - start) * time + start;\n}\n",g="\n${easingMethod} {\n  float time = t * t * t - t * 1.05 * sin(t * "+d+");\n  return (end - start) * time + start;\n}\n",v="\n${easingMethod} {\n  ${T} direction = end - start;\n  return start + direction * 0.5 + direction * sin(t * "+d+" * 2.0) * 0.5;\n}\n",y="\n${easingMethod} {\n  float p = 0.3;\n  float time = pow(2.0, -10.0 * t) * sin((t - p / 4.0) * (2.0 * "+d+") / p) + 1.0;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",m="\n${easingMethod} {\n  float time = t * t * t - t * 1.05 * sin(t * "+d+");\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",b=function(){function e(e,t,n,o){this.uid=i.uid(),this.delay=0,this.duration=500,this.loop=r.NONE,this.cpu=e,this.gpu=t,this.duration=n||500,this.methodName=o||"easingMethod"}return e.immediate=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){return(0,o.VecMath(e).copy)(t,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  return end;\n}\n",loop:n,methodName:"immediate"}},e.linear=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=o.VecMath(e),a=i.add,s=i.scale,c=i.subtract;return n=f(n,0,1),a(s(c(t,e),n),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  return (end - start) * t + start;\n}\n",loop:n,methodName:"linear"}},e.easeInQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=f(n,0,1))*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInQuad"}},e.easeOutQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=f(n,0,1))*(2-n),a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * (2.0 - t);\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeOutQuad"}},e.easeInOutQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=f(n,0,1))<.5?2*n*n:(4-2*n)*n-1,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t < 0.5 ? 2.0 * t * t : -1.0 + (4.0 - 2.0 * t) * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInOutQuad"}},e.easeInCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=f(n,0,1))*n*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInCubic"}},e.easeOutCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){n=f(n,0,1);var i=--n*n*n+1,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t1 * t1 * t1 + 1.0;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeOutCubic"}},e.easeInOutCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=f(n,0,1))<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t < 0.5 ? 4.0 * t * t * t : (t - 1.0) * (2.0 * t - 2.0) * (2.0 * t - 2.0) + 1.0;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInOutCubic"}},e.easeInQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=f(n,0,1))*n*n*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInQuart"}},e.easeOutQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){n=f(n,0,1);var i=1- --n*n*n*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = 1.0 - t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeOutQuart"}},e.easeInOutQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=f(n,0,1))<.5?8*n*n*n*n:1-8*--n*n*n*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t < 0.5 ? 8.0 * t * t * t * t : 1.0 - 8.0 * t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInOutQuart"}},e.easeInQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=f(n,0,1))*n*n*n*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t * t * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInQuint"}},e.easeOutQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){n=f(n,0,1);var i=1+--n*n*n*n*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = 1.0 + t1 * t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeOutQuint"}},e.easeInOutQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=f(n,0,1))<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t < 0.5 ? 16.0 * t * t * t * t * t : 1.0 + 16.0 * t1 * t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInOutQuint"}},e.easeOutElastic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){n=f(n,0,1);var i=c(2,-10*n)*l(2*h*(n-.075)/.3)+1,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:p,loop:n,methodName:"easeOutElastic"}},e.easeBackIn=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=f(n,0,1))*n*n-1.05*n*l(n*h),a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:g,loop:n,methodName:"easeBackIn"}},e.easeBackOut=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=f(n,0,1))-1,a=i*i*(2.7*i+1.7)+1,s=o.VecMath(e);return(0,s.add)((0,s.scale)((0,s.subtract)(t,e),a),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float a = 1.7;\n  float time = (t1 * t1 * ((a + 1.0) * t1 + a) + 1.0);\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeBackOut"}},e.easeBackInOut=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=2.5925,a=(n=f(n,0,1))/.5,s=a-2,c=a<1?.5*(a*a*(i+1)*a-i):.5*(s*s*((i+1)*s+i)+2),u=o.VecMath(e);return(0,u.add)((0,u.scale)((0,u.subtract)(t,e),c),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float a = 1.4;\n  float a1 = a * 1.525;\n  float t1 = t / 0.5;\n  float t2 = t1 - 2.0;\n  float time =\n    (t1 < 1.0) ? 0.5 * (t1 * t1 * (a1 + 1.0) * t1 - a1) :\n    0.5 * (t2 * t2 * ((a1 + 1.0) * t2 + a1) + 2.0)\n  ;\n\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeBackInOut"}},e.continuousSinusoidal=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.CONTINUOUS),{uid:i.uid(),cpu:function(e,t,n,r){var i=o.VecMath(e),a=i.add,s=i.scale,c=i.subtract;n=f(n,0,1);var u=s(c(t,e),.5);return a(a(e,u),s(u,1*l(n*h*2)),r)},delay:t,duration:e,gpu:v,loop:n,methodName:"repeatingSinusoidal",validation:{ignoreEndValueCheck:!0,ignoreOverTimeCheck:!0}}},e.slerpQuatLinear=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}n=f(n,0,1);var a=o.VecMath(e),s=a.slerpQuat,c=a.vec;return s?s(e,t,n,r):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - t, t),\n    vec2(sin((1.0 - t) * omega) / sinom, sin(t * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatLinear"}},e.slerpQuatInQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=f(n,0,1))*n,s=o.VecMath(e),c=s.slerpQuat,u=s.vec;return c?c(e,t,a,r):u(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatInQuad"}},e.slerpQuatOutQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=f(n,0,1))*(2-n),s=o.VecMath(e),c=s.slerpQuat,u=s.vec;return c?c(e,t,a,r):u(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * (2.0 - t);\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatOutQuad"}},e.slerpQuatInOutQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=f(n,0,1))<.5?2*n*n:(4-2*n)*n-1,s=o.VecMath(e),c=s.slerpQuat,u=s.vec;return c?c(e,t,a,r):u(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t < 0.5 ? 2.0 * t * t : -1.0 + (4.0 - 2.0 * t) * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatInOutQuad"}},e.slerpQuatInCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=f(n,0,1))*n*n,s=o.VecMath(e),c=s.slerpQuat,u=s.vec;return c?c(e,t,a,r):u(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatInCubic"}},e.slerpQuatOutCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}n=f(n,0,1);var a=--n*n*n+1,s=o.VecMath(e),c=s.slerpQuat,u=s.vec;return c?c(e,t,a,r):u(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t1 * t1 * t1 + 1.0;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatOutCubic"}},e.slerpQuatInOutCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=f(n,0,1))<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,s=o.VecMath(e),c=s.slerpQuat,u=s.vec;return c?c(e,t,a,r):u(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t < 0.5 ? 4.0 * t * t * t : (t - 1.0) * (2.0 * t - 2.0) * (2.0 * t - 2.0) + 1.0;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatInOutCubic"}},e.slerpQuatInQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=f(n,0,1))*n*n*n,s=o.VecMath(e),c=s.slerpQuat,u=s.vec;return c?c(e,t,a,r):u(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatInQuart"}},e.slerpQuatOutQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}n=f(n,0,1);var a=1- --n*n*n*n,s=o.VecMath(e),c=s.slerpQuat,u=s.vec;return c?c(e,t,a,r):u(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = 1.0 - t1 * t1 * t1 * t1;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatOutQuart"}},e.slerpQuatInOutQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=f(n,0,1))<.5?8*n*n*n*n:1-8*--n*n*n*n,s=o.VecMath(e),c=s.slerpQuat,u=s.vec;return c?c(e,t,a,r):u(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t < 0.5 ? 8.0 * t * t * t * t : 1.0 - 8.0 * t1 * t1 * t1 * t1;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatInOutQuart"}},e.slerpQuatInQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=f(n,0,1))*n*n*n*n,s=o.VecMath(e),c=s.slerpQuat,u=s.vec;return c?c(e,t,a,r):u(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t * t * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatInQuint"}},e.slerpQuatOutQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}n=f(n,0,1);var a=1+--n*n*n*n*n,s=o.VecMath(e),c=s.slerpQuat,u=s.vec;return c?c(e,t,a,r):u(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = 1.0 + t1 * t1 * t1 * t1 * t1;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatOutQuint"}},e.slerpQuatInOutQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=f(n,0,1))<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,s=o.VecMath(e),c=s.slerpQuat,u=s.vec;return c?c(e,t,a,r):u(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t < 0.5 ? 16.0 * t * t * t * t * t : 1.0 + 16.0 * t1 * t1 * t1 * t1 * t1;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatInOutQuint"}},e.slerpQuatOutElastic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}n=f(n,0,1);var a=c(2,-10*n)*l(2*h*(n-.075)/.3)+1,s=o.VecMath(e),u=s.slerpQuat,d=s.vec;return u?u(e,t,a,r):d(1,0,0,0)},delay:t,duration:e,gpu:y,loop:n,methodName:"slerpQuatOutElastic"}},e.slerpQuatBackIn=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=f(n,0,1))*n*n-1.05*n*l(n*h),s=o.VecMath(e),c=s.slerpQuat,u=s.vec;return c?c(e,t,a,r):u(1,0,0,0)},delay:t,duration:e,gpu:m,loop:n,methodName:"slerpQuatBackIn"}},e.slerpQuatBackOut=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=f(n,0,1))-1,s=a*a*(2.7*a+1.7)+1,c=o.VecMath(e),u=c.slerpQuat,l=c.vec;return u?u(e,t,s,r):l(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float a = 1.7;\n  float time = (t1 * t1 * ((a + 1.0) * t1 + a) + 1.0);\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatBackOut"}},e.slerpQuatBackInOut=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=2.5925,s=(n=f(n,0,1))/.5,c=s-2,u=s<1?.5*(s*s*(a+1)*s-a):.5*(c*c*((a+1)*c+a)+2),l=o.VecMath(e),h=l.slerpQuat,d=l.vec;return h?h(e,t,u,r):d(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float a = 1.4;\n  float a1 = a * 1.525;\n  float t1 = t / 0.5;\n  float t2 = t1 - 2.0;\n  float time =\n    (t1 < 1.0) ? 0.5 * (t1 * t1 * (a1 + 1.0) * t1 - a1) :\n    0.5 * (t2 * t2 * ((a1 + 1.0) * t2 + a1) + 2.0)\n  ;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end;\n}\n",loop:n,methodName:"slerpQuatBackInOut"}},e}();t.AutoEasingMethod=b},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(56),c=n(21),u=n(43),l=n(57),h=n(4)("performance"),d=function(e){function t(t,n){var r=e.call(this,n)||this;return r.container=new s.Scene,r.surface=t,r.init(n),r}return i(t,e),Object.defineProperty(t.prototype,"layers",{get:function(){return this.layerDiffs.items},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"views",{get:function(){return this.viewDiffs.items},enumerable:!0,configurable:!0}),t.prototype.init=function(e){var t=this;if(this.surface&&this.surface.gl){this.container=new s.Scene;var n=l.generateDefaultElements(this.surface.gl);this.layerDiffs=new u.ReactiveDiff({buildItem:function(e){return o(t,void 0,void 0,(function(){var t,n,r,i,o,s;return a(this,(function(a){if(h("Building layer",e.key),!this.surface)return[2,null];if(t=e.init[0],n=e.init[1],(r=new t(this.surface,this,Object.assign({},t.defaultProps,n))).order=e.init[1].order||Number.MAX_SAFE_INTEGER,r.initializer=e,r.props.data.sync(),r.parent=n.parent,n.parent&&(n.parent.children?n.parent.children.push(r):n.parent.children=[r]),!r.init())return console.warn("Error initializing layer:",n.key,"A layer was unable to be added to the surface. See previous warnings (if any) to determine why they could not be instantiated"),[2,null];for(i=r.childLayers(),o=0,s=i.length;o<s;++o)i[o].init[1].order=r.order+.01*o;return this.layerDiffs.inline(i),[2,r]}))}))},destroyItem:function(e,n){return o(t,void 0,void 0,(function(){return a(this,(function(t){return h("Destroying layer",e.key),n.destroy(),[2,!0]}))}))},updateItem:function(e,n){return o(t,void 0,void 0,(function(){var t,r,i;return a(this,(function(o){return t=e.init[1],n.willUpdateProps(t),n.order=t.order,t.data!==n.props.data&&t.data.sync(),n.shouldDrawView(n.props,t)&&(n.needsViewDrawn=!0),Object.assign(n.props,t),n.initializer.init[1]=n.props,n.didUpdateProps(),t.parent&&n.parent&&n.parent!==t.parent&&(r=n.parent.children||[],(i=r.indexOf(n)||-1)>-1&&r.splice(i,1)),n.parent=t.parent,n.willRebuildLayer?(this.layerDiffs.rebuild(),n.willRebuildLayer=!1):this.layerDiffs.inline(n.childLayers()),[2]}))}))}}),this.viewDiffs=new u.ReactiveDiff({buildItem:function(e){return o(t,void 0,void 0,(function(){var t;return a(this,(function(r){return this.surface?((t=new e.init[0](this,e.init[1])).props.camera=t.props.camera||n.camera,t.pixelRatio=this.surface.pixelRatio,this.surface.mouseManager.waitingForRender=!0,[2,t]):[2,null]}))}))},destroyItem:function(e,n){return o(t,void 0,void 0,(function(){return a(this,(function(e){return[2,!0]}))}))},updateItem:function(e,n){return o(t,void 0,void 0,(function(){var t;return a(this,(function(r){return t=e.init[1],n.willUpdateProps(t),n.shouldDrawView(n.props,t)&&(n.needsDraw=!0),Object.assign(n.props,t),n.didUpdateProps(),this.surface&&(this.surface.mouseManager.waitingForRender=!0),[2]}))}))}}),this.update(e)}},t.prototype.destroy=function(){delete this.container,this.layerDiffs.destroy(),this.viewDiffs.destroy()},t.prototype.removeLayer=function(e){if(this.layers){var t=this.layers.indexOf(e);if(t>=0)return void this.layers.splice(t,1)}},t.prototype.update=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.order=e.order,[4,this.viewDiffs.diff(e.views)];case 1:return t.sent(),[4,this.layerDiffs.diff(e.layers)];case 2:return t.sent(),[2]}}))}))},t.DEFAULT_SCENE_ID="__default__",t}(c.IdentifyByKey);t.LayerScene=d},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){var t=this;this.willDispose=new Set,this.keyToItem=new Map,this.keyToInitializer=new Map,this.currentInitalizerIndex=0,this.currentInitializers=[],this._items=[],this.inlineDeferred=function(e){t.deferredInlining=e},this.inlineImmediate=function(e){var n;if(e.length>0&&t.currentInitializers&&t.currentItem){(n=t.currentInitializers).splice.apply(n,[t.currentInitalizerIndex+1,0].concat(e));for(var r=0,i=e.length;r<i;++r){e[r].parent=t.currentItem}}},this.inline=this.inlineImmediate,this.options=e}return Object.defineProperty(e.prototype,"items",{get:function(){return this._items.slice(0)},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,o;return i(this,(function(i){switch(i.label){case 0:for(e=[],t=0,n=this.currentInitializers.length;t<n;++t)r=this.currentInitializers[t],(o=this.keyToItem.get(r.key))&&e.push(this.options.destroyItem(r,o));return[4,Promise.all(e)];case 1:return i.sent(),[2]}}))}))},e.prototype.diff=function(e){return r(this,void 0,void 0,(function(){var t,n,o,a,s=this;return i(this,(function(c){switch(c.label){case 0:t=e.slice(0),this.currentInitializers=t,this._items=[],n=0,c.label=1;case 1:return n<t.length?(o=t[n],this.currentInitalizerIndex=n,this.currentInitializer=o,this.willDispose.has(o.key)?(a=this.keyToItem.get(o.key)||null)?(this.currentItem=a,[4,this.options.updateItem(o,a)]):[3,3]:[3,6]):[3,9];case 2:return c.sent(),[3,5];case 3:return[4,this.options.buildItem(o)];case 4:a=c.sent(),c.label=5;case 5:return a&&(this.keyToInitializer.set(o.key,o),this.willDispose.delete(o.key),this._items.push(a)),[3,8];case 6:return this.inline=this.inlineDeferred,[4,this.options.buildItem(o)];case 7:a=c.sent(),this.inline=this.inlineImmediate,a&&(this.currentItem=a,this.deferredInlining&&(this.inline(this.deferredInlining),delete this.deferredInlining),this.keyToItem.set(o.key,a),this.keyToInitializer.set(o.key,o),this._items.push(a)),c.label=8;case 8:return delete this.currentItem,n++,[3,1];case 9:return this.willDispose.forEach((function(e){return r(s,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t=this.keyToItem.get(e),n=this.keyToInitializer.get(e),t&&n?[4,this.options.destroyItem(n,t)]:[2];case 1:return r.sent()&&(this.keyToItem.delete(e),this.keyToInitializer.delete(e)),[2]}}))}))})),this.willDispose.clear(),this.keyToInitializer.forEach((function(e){s.willDispose.add(e.key)})),this.currentInitializers=[],delete this.currentItem,delete this.currentInitializer,[2]}}))}))},e.prototype.getByKey=function(e){return this.keyToItem.get(e)},e.prototype.rebuild=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.currentItem&&this.currentInitializer?(this.keyToItem.delete(this.currentItem.id),this.keyToInitializer.delete(this.currentItem.id),this.options.destroyItem(this.currentInitializer,this.currentItem),[4,this.options.buildItem(this.currentInitializer)]):[2];case 1:return(e=t.sent())&&(this.keyToItem.set(this.currentItem.id,e),this.keyToInitializer.set(this.currentItem.id,this.currentInitializer)),[2]}}))}))},e}();t.ReactiveDiff=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),i=function(){function e(){}return e.transparentShapeBlending={blending:{blendDst:r.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:r.GLSettings.Material.BlendingEquations.Add,blendSrc:r.GLSettings.Material.BlendingSrcFactor.SrcAlpha},culling:r.GLSettings.Material.CullSide.NONE},e.transparentImageBlending={blending:{blendSrc:r.GLSettings.Material.BlendingSrcFactor.One,blendDst:r.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:r.GLSettings.Material.BlendingEquations.Add},culling:r.GLSettings.Material.CullSide.NONE},e}();t.CommonMaterialOptions=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){var e=this;this.promise=new Promise((function(t,n){return e.resolver=t,e.rejector=n}))}return e.prototype.resolve=function(e){this.resolver(e)},e.prototype.reject=function(e){this.rejector(e)},e}();t.PromiseResolver=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12);t.drawMode=function(e,t){switch(t){case r.GLSettings.Model.DrawMode.LINES:return e.LINES;case r.GLSettings.Model.DrawMode.LINE_LOOP:return e.LINE_LOOP;case r.GLSettings.Model.DrawMode.LINE_STRIP:return e.LINE_STRIP;case r.GLSettings.Model.DrawMode.POINTS:return e.POINTS;case r.GLSettings.Model.DrawMode.TRIANGLES:return e.TRIANGLES;case r.GLSettings.Model.DrawMode.TRIANGLE_FAN:return e.TRIANGLE_FAN;case r.GLSettings.Model.DrawMode.TRIANGLE_STRIP:return e.TRIANGLE_STRIP;default:return e.TRIANGLES}},t.texelFormat=function(e,t){switch(t){case r.GLSettings.Texture.TexelDataType.Alpha:return e.ALPHA;case r.GLSettings.Texture.TexelDataType.DepthComponent:return e.DEPTH_COMPONENT;case r.GLSettings.Texture.TexelDataType.DepthStencil:return e.DEPTH_STENCIL;case r.GLSettings.Texture.TexelDataType.Luminance:return e.LUMINANCE;case r.GLSettings.Texture.TexelDataType.LuminanceAlpha:return e.LUMINANCE_ALPHA;case r.GLSettings.Texture.TexelDataType.RGB:return e.RGB;case r.GLSettings.Texture.TexelDataType.RGBA:return e.RGBA;default:return console.warn("An Unsupported texel format was provided",t),e.RGBA}},t.inputImageFormat=function(e,t){switch(t){case r.GLSettings.Texture.SourcePixelFormat.Byte:return e.BYTE;case r.GLSettings.Texture.SourcePixelFormat.Float:return e.FLOAT;case r.GLSettings.Texture.SourcePixelFormat.HalfFloat:return console.warn("Unsupported HALF_FLOAT"),e.BYTE;case r.GLSettings.Texture.SourcePixelFormat.Int:return e.INT;case r.GLSettings.Texture.SourcePixelFormat.Short:return e.SHORT;case r.GLSettings.Texture.SourcePixelFormat.UnsignedByte:return e.UNSIGNED_BYTE;case r.GLSettings.Texture.SourcePixelFormat.UnsignedInt:return e.UNSIGNED_INT;case r.GLSettings.Texture.SourcePixelFormat.UnsignedShort:return e.UNSIGNED_SHORT;case r.GLSettings.Texture.SourcePixelFormat.UnsignedShort_4_4_4_4:return e.UNSIGNED_SHORT_4_4_4_4;case r.GLSettings.Texture.SourcePixelFormat.UnsignedShort_5_5_5_1:return e.UNSIGNED_SHORT_5_5_5_1;case r.GLSettings.Texture.SourcePixelFormat.UnsignedShort_5_6_5:return e.UNSIGNED_SHORT_5_6_5;default:return console.warn("An Unsupported input image format was provided",t),e.BYTE}},t.magFilter=function(e,t,n){if(!n)return e.LINEAR;switch(t){case r.GLSettings.Texture.TextureMagFilter.Linear:return e.LINEAR;case r.GLSettings.Texture.TextureMagFilter.Nearest:return e.NEAREST}},t.minFilter=function(e,t,n,i){if(!n)return e.LINEAR;switch(t){case r.GLSettings.Texture.TextureMinFilter.Linear:return e.LINEAR;case r.GLSettings.Texture.TextureMinFilter.Nearest:return e.NEAREST;case r.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear:return i?e.LINEAR_MIPMAP_LINEAR:e.LINEAR;case r.GLSettings.Texture.TextureMinFilter.LinearMipMapNearest:return i?e.LINEAR_MIPMAP_NEAREST:e.LINEAR;case r.GLSettings.Texture.TextureMinFilter.NearestMipMapLinear:return i?e.NEAREST_MIPMAP_LINEAR:e.NEAREST;case r.GLSettings.Texture.TextureMinFilter.NearestMipMapNearest:return i?e.NEAREST_MIPMAP_NEAREST:e.NEAREST;default:return e.LINEAR}},t.colorBufferFormat=function(e,t){switch(t){case r.GLSettings.RenderTarget.ColorBufferFormat.RGB565:return e.RGB565;case r.GLSettings.RenderTarget.ColorBufferFormat.RGB5_A1:return e.RGB5_A1;case r.GLSettings.RenderTarget.ColorBufferFormat.RGBA4:default:return e.RGBA4}},t.depthBufferFormat=function(e,t){switch(t){case r.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT16:return e.DEPTH_COMPONENT16;case r.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_STENCIL:return e.DEPTH_STENCIL;default:return e.DEPTH_COMPONENT16}},t.stencilBufferFormat=function(e,t){switch(t){case r.GLSettings.RenderTarget.StencilBufferFormat.STENCIL_INDEX8:default:return e.STENCIL_INDEX8}},t.wrapMode=function(e,t){switch(t){case r.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE:return e.CLAMP_TO_EDGE;case r.GLSettings.Texture.Wrapping.MIRRORED_REPEAT:return e.MIRRORED_REPEAT;case r.GLSettings.Texture.Wrapping.REPEAT:return e.REPEAT}},t.indexToColorAttachment=function(e,t,n,r){if(r)return e.COLOR_ATTACHMENT0;var i=t.drawBuffers;if(i instanceof WebGL2RenderingContext)switch(n){case 0:return i.COLOR_ATTACHMENT0;case 1:return i.COLOR_ATTACHMENT1;case 2:return i.COLOR_ATTACHMENT2;case 3:return i.COLOR_ATTACHMENT3;case 4:return i.COLOR_ATTACHMENT4;case 5:return i.COLOR_ATTACHMENT5;case 6:return i.COLOR_ATTACHMENT6;case 7:return i.COLOR_ATTACHMENT7;case 8:return i.COLOR_ATTACHMENT8;case 9:return i.COLOR_ATTACHMENT9;case 10:return i.COLOR_ATTACHMENT10;case 11:return i.COLOR_ATTACHMENT11;case 12:return i.COLOR_ATTACHMENT12;case 13:return i.COLOR_ATTACHMENT13;case 14:return i.COLOR_ATTACHMENT14;case 15:return i.COLOR_ATTACHMENT15}else if(i)switch(n){case 0:return i.COLOR_ATTACHMENT0_WEBGL;case 1:return i.COLOR_ATTACHMENT1_WEBGL;case 2:return i.COLOR_ATTACHMENT2_WEBGL;case 3:return i.COLOR_ATTACHMENT3_WEBGL;case 4:return i.COLOR_ATTACHMENT4_WEBGL;case 5:return i.COLOR_ATTACHMENT5_WEBGL;case 6:return i.COLOR_ATTACHMENT6_WEBGL;case 7:return i.COLOR_ATTACHMENT7_WEBGL;case 8:return i.COLOR_ATTACHMENT8_WEBGL;case 9:return i.COLOR_ATTACHMENT9_WEBGL;case 10:return i.COLOR_ATTACHMENT10_WEBGL;case 11:return i.COLOR_ATTACHMENT11_WEBGL;case 12:return i.COLOR_ATTACHMENT12_WEBGL;case 13:return i.COLOR_ATTACHMENT13_WEBGL;case 14:return i.COLOR_ATTACHMENT14_WEBGL;case 15:return i.COLOR_ATTACHMENT15_WEBGL}return e.COLOR_ATTACHMENT0},t.indexToTextureUnit=function(e,t){return e.TEXTURE0+t},t.textureUnitToIndex=function(e,t){return t-e.TEXTURE0}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),a=n(33),s=n(0),c=new o.Texture({data:{width:2,height:2,buffer:new Uint8Array(16)}});var u=function(e){function t(t,n){var r=e.call(this)||this;return r.manager=n,r.resourceType=t,r}return i(t,e),t.prototype.expand=function(e,t,n,r){var i=this,o=this.manager,a=[],u=new Map;t.forEach((function(e){if(r=e,o=i.manager.router,c=i.resourceType,r&&r.resource&&o.getResourceType(r.resource.key())===c&&void 0!==r.resource.name&&void 0!==r.resource.key){void 0===e.size&&(e.size=s.InstanceAttributeSize.FOUR);var t=e.resource.shaderInjection||s.ShaderInjectionTarget.FRAGMENT,n=u.get(e.resource.name);n?u.set(e.resource.name,[n[0]||t===s.ShaderInjectionTarget.VERTEX||t===s.ShaderInjectionTarget.ALL,n[1]||t===s.ShaderInjectionTarget.FRAGMENT||t===s.ShaderInjectionTarget.ALL]):(a.push(e),u.set(e.resource.name,[t===s.ShaderInjectionTarget.VERTEX||t===s.ShaderInjectionTarget.ALL,t===s.ShaderInjectionTarget.FRAGMENT||t===s.ShaderInjectionTarget.ALL]))}var r,o,c}));var l=a.map((function(e){var t=s.ShaderInjectionTarget.FRAGMENT;if(e.resource){var n=u.get(e.resource.name);n&&(t=n[0]&&n[1]&&s.ShaderInjectionTarget.ALL||n[0]&&!n[1]&&s.ShaderInjectionTarget.VERTEX||!n[0]&&n[1]&&s.ShaderInjectionTarget.FRAGMENT||t)}return[{name:e.resource.name,shaderInjection:t,size:s.UniformSize.ATLAS,update:function(){var t=o.getResource(e.resource.key());return t&&t.texture||c}},{name:e.resource.name+"_size",shaderInjection:t,size:s.UniformSize.TWO,update:function(){var t=o.getResource(e.resource.key());if(t){var n=t.texture;if(n&&n.data){var r=n.data;return[r.width||1,r.height||1]}}return[1,1]}}]})),h=[];return l.forEach((function(e){return e.forEach((function(e){return h.push(e)}))})),{instanceAttributes:[],vertexAttributes:[],uniforms:h}},t.prototype.validate=function(e,t,n,r){var i=!1;return t.forEach((function(e){e.easing&&e.resource&&(console.warn("An instance attribute can not have both easing and resource properties. Undefined behavior will occur."),console.warn(e),i=!0)})),!i},t.prototype.processHeaderInjection=function(e,t,n,r,i,o,a){for(var c=0,u=a.length;c<u;++c){var l=a[c],h=l.shaderInjection||s.ShaderInjectionTarget.VERTEX;l.size===s.UniformSize.ATLAS&&h===e&&this.setDeclaration(t,l.name,"uniform sampler2D "+l.name+";\n","TextureIOExpansion")}return{injection:""}},t}(a.BaseIOExpansion);t.TextureIOExpansion=u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(22),s=n(0),c=n(21),u=n(24),l=n(17),h=n(4)("performance");t.createAtlas=function(e){return o({key:"",type:s.ResourceType.ATLAS},e)},t.isAtlasResource=function(e){return e&&e.type===s.ResourceType.ATLAS};var d=function(e){function t(t){var n=e.call(this,t)||this;n.resourceReferences=new Map,n.type=s.ResourceType.ATLAS;var r=document.createElement("canvas");return n.width=r.width=t.width,n.height=r.height=t.height,n.textureSettings=t.textureSettings,n.packing=new u.PackNode(0,0,t.width,t.height),n.createTexture(r),n}return i(t,e),t.prototype.createTexture=function(e){var t;this.texture||(t=this.textureSettings?o({generateMipMaps:!0,premultiplyAlpha:!0},this.textureSettings):{generateMipMaps:!0,premultiplyAlpha:!0},this.texture=new a.Texture(o({data:e},t)))},t.prototype.destroy=function(){var e=this;this.texture.dispose(),this.resourceReferences.forEach((function(t){e.invalidateTexture(t.subtexture)}))},t.prototype.invalidateTexture=function(e){var t=[0,0];e.aspectRatio=1,e.atlasBL=t,e.atlasBR=t,e.atlasTL=t,e.atlasTR=t,e.isValid=!1,e.texture=null,e.pixelHeight=0,e.pixelWidth=0,delete e.source,e.video&&(e.video.monitor.destroy(),delete e.video)},t.prototype.resolveResources=function(){var e=this,t=[];this.resourceReferences.forEach((function(n,r){n.count<=0&&n.subtexture&&(h("A subtexture on an atlas has been invalidated as it is deemed no longer used: %o",n.subtexture),e.invalidateTexture(n.subtexture),t.push(r))}));for(var n=0,r=t.length;n<r;++n)this.resourceReferences.delete(t[n])},t.prototype.stopUsingResource=function(e){(this.resourceReferences.get(e.source)||{subtexture:e.texture||new l.SubTexture,count:0}).count--},t.prototype.useResource=function(e){(this.resourceReferences.get(e.source)||{subtexture:e.texture,count:0}).count++},t}(c.IdentifyByKey);t.Atlas=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uniformBufferInstanceBufferName="instanceData",t.activeAttributeName="_active",t.TO_RADIANS=Math.PI/180,t.TO_DEGREES=180/Math.PI},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(9),o=function(){function e(e){if(this._uid=i.uid(),this.cleanObservation=new Map,this.instanceChanges=new Map,this.allowChanges=!0,this.resolveContext="",e)for(var t=0,n=e.length;t<n;++t){var r=e[t];this.add(r)}}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changeList",{get:function(){this.allowChanges=!1;var e=[];return this.instanceChanges.forEach((function(t){return e.push(t)})),e},enumerable:!0,configurable:!0}),e.prototype.add=function(e){if(this.cleanObservation.get(e.uid))return e;if(this.allowChanges){e.observer=this;var t=e.observableDisposer;this.cleanObservation.set(e.uid,[e,t]),this.instanceChanges.set(e.uid,[e,r.InstanceDiffType.INSERT,e.changes])}return e},e.prototype.clear=function(){var e=this;this.cleanObservation.forEach((function(t){e.remove(t[0])}))},e.prototype.destroy=function(){this.cleanObservation.forEach((function(e){e[1]()})),this.cleanObservation.clear(),this.instanceChanges.clear()},e.prototype.instanceUpdated=function(e){this.allowChanges&&this.instanceChanges.set(e.uid,[e,r.InstanceDiffType.CHANGE,e.changes])},e.prototype.remove=function(e){if(this.allowChanges){var t=this.cleanObservation.get(e.uid);t&&(t[1](),this.cleanObservation.delete(e.uid),this.instanceChanges.set(e.uid,[e,r.InstanceDiffType.REMOVE,{}]))}return!1},e.prototype.resolve=function(e){if(this.allowChanges=!0,this.instanceChanges.clear(),this.resolveContext&&this.resolveContext!==e)throw new Error("An instance provider has been issued to two layers. This is not a suppported feature yet and can cause issues.");this.resolveContext=e},e.prototype.sync=function(){var e=this,t=[];this.cleanObservation.forEach((function(n){var i=n[0];e.instanceChanges.set(i.uid,[i,r.InstanceDiffType.INSERT,t])}))},e}();t.InstanceProvider=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(49),a=n(6),s=n(31),c=n(1),u=n(25),l=n(20);t.isUniformBufferLocation=function(e){return e&&e.buffer&&e.buffer.value&&e.type===s.MaterialUniformType.VEC4_ARRAY};var h=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.buffers=[],r.availableClusters=[],r.instanceToCluster={},r.clusterToBuffer=new Map,r.add=function(e){r.availableClusters.length<=0&&r.makeNewBuffer();var t=r.availableClusters.pop();return t?r.instanceToCluster[e.uid]=t:console.warn("No valid cluster available for instance added to uniform manager."),t},r.remove=function(e){var t=this.instanceToCluster[e.uid];return t&&(delete this.instanceToCluster[e.uid],this.availableClusters.push(t)),e};var i=0;return t.instanceAttributes.forEach((function(e){i=Math.max(e.block||0,i)})),r.uniformBlocksPerInstance=i+1,r}return i(t,e),t.prototype.destroy=function(){this.buffers.forEach((function(e){e.geometry.dispose(),e.material.dispose()}))},t.prototype.getBufferLocations=function(e){return this.instanceToCluster[e.uid]},t.prototype.getActiveAttributePropertyId=function(){return-1},t.prototype.getInstanceCount=function(){return-1},t.prototype.getUpdateAllPropertyIdList=function(){return[]},t.prototype.managesInstance=function(e){return void 0===this.instanceToCluster[e.uid]},t.prototype.removeFromScene=function(){var e=this.scene;if(e.container){for(var t=0,n=this.buffers.length;t<n;++t){var r=this.buffers[t];e.container.remove(r.model)}delete this.scene}},t.prototype.setScene=function(e){if(e.container){for(var t=0,n=this.buffers.length;t<n;++t){var r=this.buffers[t];e.container.add(r.model)}this.scene=e}else console.warn("Can not set a scene that has an undefined container.")},t.prototype.makeNewBuffer=function(){var e=new a.Geometry;this.layer.vertexAttributes.forEach((function(t){t.materialAttribute&&e.addAttribute(t.name,t.materialAttribute)}));var t=this.layer.material.clone(),n=u.generateLayerModel(e,t,this.layer.model.drawMode);n.vertexDrawRange=[0,this.layer.maxInstancesPerBuffer*this.layer.instanceVertexCount];var r={activeInstances:[],clusters:[],firstInstance:0,geometry:e,lastInstance:0,material:t,model:n};this.buffers.push(r);var i=0,l=o.uniformBufferInstanceBufferName,h=t.uniforms[l];if(s.isUniformVec4Array(h)){h.value=h.value.map((function(){return[0,0,0,0]}));for(var d=Object.assign({},this.layer.instanceAttributes[0],{bufferAttribute:new a.Attribute(new Float32Array(1),1),uid:c.uid()}),f=0,p=this.layer.maxInstancesPerBuffer;f<p;++f){var g={attribute:d,buffer:h,instanceIndex:f,range:[i,0]};i+=this.uniformBlocksPerInstance,g.range[1]=i,r.clusters.push(g),this.availableClusters.push(g),this.clusterToBuffer.set(g,r)}for(f=0,p=this.layer.uniforms.length;f<p;++f){var v=this.layer.uniforms[f];v.materialUniforms.push(t.uniforms[v.name])}this.scene&&this.scene.container&&this.scene.container.add(r.model)}else console.warn("Material is utilizing an invalid uniform type for Uniform Buffer Management. Buffering will not be possible.")},t}(l.BufferManagerBase);t.UniformBufferManager=h},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=n(10),c=n(0),u=n(14),l=function(e){function t(t){var n=e.call(this,t)||this;return n.color=[0,0,0,1],n.depth=0,n.fontSize=12,n.maxScale=1,n.maxWidth=0,n.origin=[0,0],n.scale=1,n.text="",n.letterSpacing=0,n.preload=!1,n.glyphs=[],n.size=[0,0],n.truncatedText="",n.anchor={padding:0,paddingDirection:[0,0],type:u.AnchorType.TopLeft,x:0,y:0},n.anchor=t.anchor||n.anchor,n.color=t.color||n.color,n.depth=t.depth||n.depth,n.fontSize=t.fontSize||n.fontSize,n.maxScale=t.maxScale||n.maxScale,n.maxWidth=t.maxWidth||0,n.onReady=t.onReady,n.origin=t.origin,n.preload=t.preload||!1,n.scale=t.scale||n.scale,n.text=t.text||n.text,n.letterSpacing=t.letterSpacing||n.letterSpacing,t.anchor&&n.setAnchor(t.anchor),n}return i(t,e),t.prototype.getWidth=function(){return this.size[0]},t.prototype.setAnchor=function(e){var t={padding:e.padding||0,paddingDirection:e.paddingDirection,type:e.type,x:e.x||0,y:e.y||0};this.anchor=t},t.prototype.subTextGlyphs=function(e){var t=[],n=this.text.indexOf(e);if(n<0)return t;for(var r=0,i=0,o=Math.min(this.text.length,n+e.length);i<o;++i)c.isWhiteSpace(this.text[i])||(r++,i>=n&&t.push(this.glyphs[r]));return t},t.prototype.resourceTrigger=function(){},o([a.observable],t.prototype,"color",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"fontSize",void 0),o([a.observable],t.prototype,"maxScale",void 0),o([a.observable],t.prototype,"maxWidth",void 0),o([a.observable],t.prototype,"origin",void 0),o([a.observable],t.prototype,"scale",void 0),o([a.observable],t.prototype,"text",void 0),o([a.observable],t.prototype,"letterSpacing",void 0),o([a.observable],t.prototype,"anchor",void 0),t}(s.Instance);t.LabelInstance=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(37),i=n(3),o=n(38),a=n(58),s=n(59),c=n(60),u=new o.NoView;function l(e,t){return t.d&&e.d?t.d.depth-e.d.depth:0}function h(e,t){return e.touch.identifier-t.touch.identifier}u.fitViewtoViewport(new r.Bounds({x:0,y:0,width:100,height:100}),new r.Bounds({x:0,y:0,width:100,height:100}));var d=function(){function e(e,t,n,r){var i=this;this.eventCleanup=[],this._waitingForRender=!0,this.getViewsUnderPosition=function(e){var t=i.quadTree.query(e);return t.sort(l),t},this.resize=function(){i._waitingForRender=!0},this.context=e,this.surface=t,this.setControllers(n),this.addContextListeners(r)}return Object.defineProperty(e.prototype,"waitingForRender",{get:function(){return this._waitingForRender},set:function(e){if(this._waitingForRender=e,!e){this.quadTree=new c.QuadTree(0,0,0,0);for(var t=this.scenes,n=[],r=0,i=t.length;r<i;++r)for(var o=t[r],a=0,s=o.views.length;a<s;++a){var u=o.views[a];n.push(u.screenBounds)}this.quadTree.addAll(n)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scenes",{get:function(){return this.surface&&this.surface.sceneDiffs?this.surface.sceneDiffs.items:[]},enumerable:!0,configurable:!0}),e.prototype.addContextListeners=function(e){this.addMouseContextListeners(e),this.addTouchContextListeners()},e.prototype.addMouseContextListeners=function(e){var t,n=this,r=this.context,o=!1;if(e){var a=function(e){var i=s.eventElementPosition(e,r),o=n.getViewsUnderPosition(i);if(!(o.length<=0)){t={canClick:!1,currentPosition:i,deltaPosition:[0,0],previousPosition:i,start:i,startTime:Date.now(),startView:o[0].d,event:e,wheel:n.makeWheel(e),button:-1};var a=n.makeMouseInteraction(t);n.controllers.forEach((function(e){e.handleWheel(a)})),e.stopPropagation(),e.preventDefault()}};"onwheel"in r&&(r.onwheel=a),"addEventListener"in r&&(r.addEventListener("DOMMouseScroll",a),this.eventCleanup.push(["DOMMouseScroll",a]))}r.onmouseleave=function(e){if(!n.waitingForRender&&t){var o=s.eventElementPosition(e,r);t.deltaPosition=i.subtract2(o,t.currentPosition),t.previousPosition=t.currentPosition,t.currentPosition=o;var a=n.makeMouseInteraction(t);n.controllers.forEach((function(e){e.handleMouseOut(a)}))}},r.onmousemove=function(e){if(!n.waitingForRender){var a=s.eventElementPosition(e,r);if(!t){var c=n.getViewsUnderPosition(a);t={canClick:!1,currentPosition:a,deltaPosition:[0,0],previousPosition:a,start:a,startTime:Date.now(),startView:c[0].d,event:e,wheel:n.makeWheel(),button:-1}}t.deltaPosition=i.subtract2(a,t.currentPosition),t.previousPosition=t.currentPosition,t.currentPosition=a,t.canClick=!1;var u=n.makeMouseInteraction(t);n.controllers.forEach((function(e){e.handleMouseMove(u)})),o=!0}},r.onmousedown=function(e){if(!n.waitingForRender){var a=s.eventElementPosition(e,r),c=n.getViewsUnderPosition(a);if(!(c.length<=0)){t={canClick:!0,currentPosition:a,deltaPosition:[0,0],previousPosition:a,start:a,startTime:Date.now(),startView:c[0].d,event:e,wheel:n.makeWheel(),button:e.button};var u=n.makeMouseInteraction(t);n.controllers.forEach((function(e){e.handleMouseDown(u)})),e.stopPropagation(),document.onmousemove=function(e){if(t){if(!o){var a=s.eventElementPosition(e,r);t.deltaPosition=i.subtract2(a,t.currentPosition),t.previousPosition=t.currentPosition,t.currentPosition=a,t.canClick=!1}var c=n.makeMouseInteraction(t);n.controllers.forEach((function(e){e.handleDrag(c)})),e.preventDefault(),e.stopPropagation(),o=!1}},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null,document.onmouseover=null,t=void 0},document.onmouseover=function(e){if(t){var o=s.eventElementPosition(e,r);t.deltaPosition=i.subtract2(o,t.currentPosition),t.previousPosition=t.currentPosition,t.currentPosition=o;var a=n.makeMouseInteraction(t);n.controllers.forEach((function(e){e.handleMouseOver(a)})),e.stopPropagation()}},r.onmouseup=function(e){if(t){var o=s.eventElementPosition(e,r);t.deltaPosition=i.subtract2(o,t.currentPosition),t.previousPosition=t.currentPosition,t.currentPosition=o,t.button=e.button;var a=n.makeMouseInteraction(t);n.controllers.forEach((function(e){e.handleMouseUp(a)})),t.canClick&&Date.now()-t.startTime<1e3&&n.controllers.forEach((function(e){e.handleClick(a)})),t=void 0}};var l=r;void 0!==l.onselectstart?l.onselectstart=function(){return!1}:r.addEventListener("selectstart",(function(){e.preventDefault()}))}}}},e.prototype.addTouchContextListeners=function(){var e=this,t=this.context,n=new Map,r=new Map;function o(e){return e.map((function(e){return e.touch}))}function c(e){return e.reduce((function(e,t){return t.touch.startTime>e.touch.startTime?t:e}),e[0])}var u={center:function(t){return t.length<=0?[0,0]:e.getTouchCenter(o(t))},centerDelta:function(t){if(t.length<=0)return[0,0];var n=o(t),r=e.getTouchCenter(n,(function(e){return e.previousPosition})),a=e.getTouchCenter(n);return i.subtract2(a,r)},centerStart:function(t){if(t.length<=0)return[0,0];var n=c(t).touch;return e.getTouchCenter(o(t),(function(e){return e===n?e.start:e.startRelative.get(n)||[0,0]}))},id:function(e){return o(e).sort(h).map((function(e){return e.touch.identifier})).join("_")},rotation:function(t){if(t.length<=0)return 0;var n=o(t),r=e.getTouchCenter(n);return e.getAverageAngle(n,r)},rotationDelta:function(t){if(t.length<=0)return 0;var n=o(t),r=e.getTouchCenter(n,(function(e){return e.previousPosition})),i=e.getAverageAngle(n,r,(function(e){return e.previousPosition})),a=e.getTouchCenter(n);return e.getAverageAngle(n,a)-i},rotationStart:function(t){if(t.length<=0)return 0;var n=c(t).touch,r=o(t),i=e.getTouchCenter(r,(function(e){return e===n?e.start:e.startRelative.get(n)||[0,0]}));return e.getAverageAngle(r,i,(function(e){return e===n?e.start:e.startRelative.get(n)||[0,0]}))},spread:function(t){if(t.length<=0)return 0;var n=o(t),r=e.getTouchCenter(n);return e.getAverageDistance(n,r)},spreadDelta:function(t){if(t.length<=0)return 0;var n=o(t),r=e.getTouchCenter(n,(function(e){return e.previousPosition})),i=e.getAverageDistance(n,r,(function(e){return e.previousPosition})),a=e.getTouchCenter(n);return e.getAverageDistance(n,a)-i},spreadStart:function(t){if(t.length<=0)return 0;var n=c(t).touch,r=o(t),i=e.getTouchCenter(r,(function(e){return e===n?e.start:e.startRelative.get(n)||[0,0]}));return e.getAverageDistance(r,i,(function(e){return e===n?e.start:e.startRelative.get(n)||[0,0]}))}};t.ontouchstart=function(t){t.preventDefault(),t.stopPropagation();for(var i=e.getTouches(t),o=[],c=[],h=0,p=i.length;h<p;++h){var g=i[h],v=n.get(g.identifier);if(v)o.push(v);else{var y=s.eventElementPosition(g),m=e.getViewsUnderPosition(y);if(m.length<=0)continue;var b=m[0].d,w={canTap:!0,currentPosition:y,deltaPosition:[0,0],startTime:Date.now(),start:y,startView:b,previousPosition:y,startRelative:new Map,touch:g};n.set(g.identifier,w),c.push(w)}}if(c.length>0){var x=c.concat(o),T=[];for(h=0,p=c.length;h<p;++h){for(var _=c[h],E=0,A=x.length;E<A;++E){_!==(g=x[E])&&g.startRelative.set(_,g.currentPosition)}var M=e.makeSingleTouchInteraction(_);T.push(M),r.set(_.touch.identifier,M)}var S={touches:T,allTouches:x.map((function(e){return r.get(e.touch.identifier)})).filter(a.isDefined),multitouch:u};e.controllers.forEach((function(e){e.handleTouchDown(S)}))}document.ontouchend=function(e){l.call(document,e),document.ontouchend=null,document.ontouchcancel=null,document.ontouchmove=null},document.ontouchcancel=function(e){f.call(document,e),document.ontouchend=null,document.ontouchcancel=null,document.ontouchmove=null},document.ontouchmove=d};var l=t.ontouchend=function(t){t.stopPropagation(),t.preventDefault();for(var i=e.getTouches(t,"changed"),o=Array.from(r.values()),a=[],s=function(t,s){var c=i[t],l=n.get(c.identifier);if(!l)return"continue";if(l.canTap&&Date.now()-l.startTime<200){var h={touches:[e.makeSingleTouchInteraction(l)],allTouches:o,multitouch:u};e.controllers.forEach((function(e){e.handleTap(h)}))}a.push(l),n.delete(c.identifier),r.delete(c.identifier)},c=0,l=i.length;c<l;++c)s(c);if(a.length>0){var h={touches:a.map((function(t){return e.makeSingleTouchInteraction(t)})),allTouches:o,multitouch:u};e.controllers.forEach((function(e){e.handleTouchUp(h)}))}},d=t.ontouchmove=function(t){t.stopPropagation(),t.preventDefault();for(var o=e.getTouches(t),c=[],l=[],h=0,d=o.length;h<d;++h){var f=o[h],p=n.get(f.identifier);if(p){var g=s.eventElementPosition(f),v=i.subtract2(g,p.currentPosition);if(i.length2(v)<=0){l.push(p),Object.assign(p,{currentPosition:g,deltaPosition:v,previousPosition:p.currentPosition,touch:f});continue}c.push(p),Object.assign(p,{canTap:!1,currentPosition:g,deltaPosition:v,previousPosition:p.currentPosition,touch:f})}}if(c.length>0){var y=c.concat(l),m={touches:c.map((function(t){return e.makeSingleTouchInteraction(t)})),allTouches:y.map((function(e){return r.get(e.touch.identifier)})).filter(a.isDefined),multitouch:u};e.controllers.forEach((function(e){e.handleTouchDrag(m)}))}},f=t.ontouchcancel=function(t){t.stopPropagation(),t.preventDefault();for(var i=e.getTouches(t,"changed"),o=Array.from(r.values()),a=[],s=0,c=i.length;s<c;++s){var l=i[s],h=n.get(l.identifier);h&&(a.push(h),n.delete(l.identifier),r.delete(l.identifier))}if(a.length>0){var d={touches:a.map((function(t){return e.makeSingleTouchInteraction(t)})),allTouches:o,multitouch:u};e.controllers.forEach((function(e){e.handleTouchCancelled(d)}))}}},e.prototype.getAverageDistance=function(e,t,n){var r=0;if(e.length<=0)return r;n||(n=function(e){return e.currentPosition});for(var o=0,a=e.length;o<a;++o){var s=e[o];r+=i.length2(i.subtract2(n(s),t))}return r/e.length},e.prototype.getAverageAngle=function(e,t,n){var r=0;if(e.length<=0)return r;n||(n=function(e){return e.currentPosition});for(var o=0,a=e.length;o<a;++o){var s=e[o],c=i.subtract2(n(s),t),u=Math.atan2(c[1],c[0]);u<0&&(u+=2*Math.PI),r+=u}return r/e.length},e.prototype.getTouchCenter=function(e,t){var n=[0,0];if(e.length<=0)return n;t||(t=function(e){return e.currentPosition});for(var r=0,o=e.length;r<o;++r){var a=t(e[r]);n=i.add2(n,a)}return i.scale2(n,1/e.length)},e.prototype.getTouches=function(e,t){var n=new Map;if(e.touches&&e.touches.length>0&&(!t||"touches"===t))for(var r=0,i=e.touches.length;r<i;++r){(o=e.touches.item(r))&&n.set(o.identifier,o)}if(e.changedTouches&&e.changedTouches.length>0&&(!t||"changed"===t))for(r=0,i=e.changedTouches.length;r<i;++r){(o=e.changedTouches.item(r))&&n.set(o.identifier,o)}if(e.targetTouches&&e.targetTouches.length>0&&(!t||"target"===t))for(r=0,i=e.targetTouches.length;r<i;++r){var o;(o=e.targetTouches.item(r))&&n.set(o.identifier,o)}return Array.from(n.values())},e.prototype.getView=function(e){for(var t=this.scenes,n=0,r=t.length;n<r;++n){var i=t[n].viewDiffs.getByKey(e);if(i)return i}return null},e.prototype.makeMouseInteraction=function(e){var t=this.getViewsUnderPosition(e.currentPosition),n=t[0]&&t[0].d;n||(n=u);var r=this.getViewsUnderPosition(e.start),i=e.startView;return i||(i=u),{mouse:e,screen:{position:e.currentPosition},start:{position:i.projection.screenToView(e.start),view:i,views:r.map((function(t){return t.d||(t.d=u),{position:t.d.projection.screenToView(e.start),view:t.d}}))},target:{position:n.projection.screenToView(e.currentPosition),view:n,views:t.map((function(t){return t.d||(t.d=u),{position:t.d.projection.screenToView(e.currentPosition),view:t.d}}))}}},e.prototype.makeSingleTouchInteraction=function(e){var t=e.currentPosition,n=this.getViewsUnderPosition(t),r=n[0]&&n[0].d;r||(r=u);var i=e.startView;return i||(i=u),{touch:e,screen:{position:t},start:{position:i.projection.screenToView(e.start),view:i,views:this.getViewsUnderPosition(e.start).map((function(t){return t.d||(t.d=u),{position:t.d.projection.screenToView(e.start),view:t.d}}))},target:{position:r.projection.screenToView(t),view:r,views:n.map((function(e){return e.d||(e.d=u),{position:e.d.projection.screenToView(t),view:e.d}}))}}},e.prototype.makeMultiTouchInteractions=function(e,t){e.sort(h);for(var n=this.allTouchCombinations(e),r=0,i=n.length;r<i;++r){var o=n[r],a=o.map((function(e){return e.touch.identifier})).join("_"),s=t.get(a);if(!s){var c=this.getTouchCenter(o);s={touches:o,averageSpreadDelta:0,startCenter:c,currentCenter:c,currentRotation:this.getAverageAngle(o,c),centerDelta:[0,0],rotationDelta:0},t.set(a,s)}}},e.prototype.updateMultiTouchInteractions=function(e,t){e.sort(h);for(var n=this.allTouchCombinations(e),r=0,o=n.length;r<o;++r){var a=n[r],s=a.map((function(e){return e.touch.identifier})).join("_"),c=t.get(s);if(c){var u=this.getTouchCenter(a),l=this.getAverageAngle(a,u);c.centerDelta=i.subtract2(u,c.currentCenter),c.currentCenter=u,c.rotationDelta=l-c.currentRotation,c.currentRotation=l}}},e.prototype.allTouchCombinations=function(e){for(var t=[],n=e.length,r=1<<n,i=1;i<r;i++){for(var o=[],a=0;a<n;a++)i&1<<a&&o.push(e[a]);t.push(o)}return t},e.prototype.makeWheel=function(e){if(!e)return{delta:[0,0]};var t=s.normalizeWheel(e);return{delta:[t.pixelX,t.pixelY]}},e.prototype.setControllers=function(e){this.controllers=e;for(var t=0,n=this.controllers;t<n.length;t++){n[t].setUserInputManager(this)}},e.prototype.destroy=function(){var e=this;delete this.quadTree,this.context.onmousedown=null,this.context.onmousemove=null,this.context.onmouseleave=null;var t=this.context;t.onmousewheel&&(t.onmousewheel=null),this.eventCleanup.forEach((function(t){e.context.removeEventListener(t[0],t[1])}))},e}();t.UserInputEventManager=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7);function i(e,t,n){var r=""+e,i=parseFloat(r);return isNaN(i)?0:r.indexOf("%")>-1?i/100*t:i*n}t.getAbsolutePositionBounds=function(e,t,n){0!==t.width&&0!==t.height||console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are non-zero.","item:",e,"reference:",t.toString());var o,a,s=r.Bounds.emptyBounds();if(e.width)s.width=i(e.width,t.width,n),void 0!==e.left?s.x=i(e.left,t.width,n):void 0!==e.right&&(s.x=t.width-i(e.right,t.width,n)-s.width);else{var c=i(e.left||0,t.width,n);(o=t.width-i(e.right||0,t.width,n)-c)<0&&console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are greater than zero.","item:",e,"reference:",t.toString()),s.x=c,s.width=o}if(e.height)s.height=i(e.height,t.height,n),void 0!==e.top?s.y=i(e.top,t.height,n):void 0!==e.bottom&&(s.y=t.height-i(e.bottom,t.height,n)-s.height);else{var u=i(e.top||0,t.height,n);(void 0===(a=t.height-i(e.bottom||0,t.height,n)-u)||a<0)&&console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are greater than zero.","item:",e,"reference:",t.toString()),s.y=u,s.height=a}return(0===s.width||0===s.height||isNaN(s.x+s.y+s.width+s.height))&&(s.x=0,s.y=0,s.width=t.width,s.height=t.height),s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(26),o=n(3),a=Math.cos,s=Math.sin,c=Math.sqrt,u=Math.exp,l=Math.acos,h=Math.atan2,d=Math.PI;function f(e,t,n){return e>n?n:e<t?t:e}function p(e){return e?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):[0,0,0,0]}function g(e,t,n){return(n=n||p())[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function v(e){var t=e[0],n=e[1],r=e[2],i=e[3];return c(t*t+n*n+r*r+i*i)}function y(e,t,n){n=n||p();var i=e[0],o=e[1],a=e[2],s=Math.cos,c=Math.sin,u=s(i/2),l=s(o/2),h=s(a/2),d=c(i/2),f=c(o/2),g=c(a/2);switch(t){case r.EulerOrder.xyz:n[1]=d*l*h+u*f*g,n[2]=u*f*h-d*l*g,n[3]=u*l*g+d*f*h,n[0]=u*l*h-d*f*g;break;case r.EulerOrder.yxz:n[0]=u*l*h+d*f*g,n[1]=d*l*h+u*f*g,n[2]=u*f*h-d*l*g,n[3]=u*l*g-d*f*h;break;case r.EulerOrder.zxy:n[0]=u*l*h-d*f*g,n[1]=d*l*h-u*f*g,n[2]=u*f*h+d*l*g,n[3]=u*l*g+d*f*h;break;case r.EulerOrder.zyx:n[0]=u*l*h+d*f*g,n[1]=d*l*h-u*f*g,n[2]=u*f*h+d*l*g,n[3]=u*l*g-d*f*h;break;case r.EulerOrder.yzx:n[0]=u*l*h-d*f*g,n[1]=d*l*h+u*f*g,n[2]=u*f*h+d*l*g,n[3]=u*l*g-d*f*h;break;case r.EulerOrder.xzy:n[0]=u*l*h+d*f*g,n[1]=d*l*h-u*f*g,n[2]=u*f*h-d*l*g,n[3]=u*l*g+d*f*h}return n}function m(e,t,n,r,i,o){o[0]=h(e,t),o[1]=l(n),o[2]=h(r,i)}function b(e,t,n){n=n||[0,0,0];var i=e[0],o=e[1],a=e[2],s=e[3],c=w(e),u=c[0],l=c[4],h=c[8],d=c[1],p=c[5],g=c[9],v=c[2],y=c[6],b=c[10];switch(t){case r.EulerOrder.zyx:n[1]=Math.asin(-f(v,-1,1)),Math.abs(v)<.99999?(n[0]=Math.atan2(y,b),n[2]=Math.atan2(d,u)):(n[0]=0,n[2]=Math.atan2(-l,p));break;case r.EulerOrder.zyz:m(2*a*s+2*i*o,2*i*a-2*o*s,s*s-a*a-o*o+i*i,2*a*s-2*i*o,2*o*s+2*i*a,n);break;case r.EulerOrder.zxy:n[0]=Math.asin(f(y,-1,1)),Math.abs(y)<.99999?(n[1]=Math.atan2(-v,b),n[2]=Math.atan2(-l,p)):(n[1]=0,n[2]=Math.atan2(d,u));break;case r.EulerOrder.zxz:m(2*o*s-2*i*a,2*a*s+2*i*o,s*s-a*a-o*o+i*i,2*o*s+2*i*a,2*i*o-2*a*s,n);break;case r.EulerOrder.yxz:n[0]=Math.asin(-f(g,-1,1)),Math.abs(g)<.9999?(n[1]=Math.atan2(h,b),n[2]=Math.atan2(d,p)):(n[1]=Math.atan2(-v,u),n[2]=0);break;case r.EulerOrder.yxy:m(2*o*a+2*i*s,2*i*o-2*a*s,a*a-s*s+i*i-o*o,2*o*a-2*i*s,2*a*s+2*i*o,n);break;case r.EulerOrder.yzx:n[2]=Math.asin(f(d,-1,1)),Math.abs(d)<.99999?(n[0]=Math.atan2(-g,p),n[1]=Math.atan2(-v,u)):(n[0]=0,n[1]=Math.atan2(h,b));break;case r.EulerOrder.yzy:m(2*a*s-2*i*o,2*o*a+2*i*s,a*a-s*s+i*i-o*o,2*a*s+2*i*o,2*i*s-2*o*a,n);break;case r.EulerOrder.xyz:n[1]=Math.asin(f(h,-1,1)),Math.abs(h)<.99999?(n[0]=Math.atan2(-g,b),n[2]=Math.atan2(-l,u)):(n[0]=Math.atan2(y,p),n[2]=0);break;case r.EulerOrder.xyx:m(2*o*a-2*i*s,2*o*s+2*i*a,o*o+i*i-s*s-a*a,2*o*a+2*i*s,2*i*a-2*o*s,n);break;case r.EulerOrder.xzy:n[2]=Math.asin(-f(l,-1,1)),Math.abs(l)<.99999?(n[0]=Math.atan2(y,p),n[1]=Math.atan2(h,u)):(n[0]=Math.atan2(-g,b),n[1]=0);break;case r.EulerOrder.xzx:m(2*o*s+2*i*a,2*i*s-2*o*a,o*o+i*i-s*s-a*a,2*o*s-2*i*a,2*o*a+2*i*s,n);break;default:console.warn("Invalid Euler rotation order.")}return n}function w(e,t){var n,r,o,a,s,c,u,l,h,d,f,p;return t=t||i.identity4(),d=e[1]+e[1],f=e[2]+e[2],p=e[3]+e[3],a=e[1]*d,u=e[1]*f,l=e[1]*p,s=e[2]*f,c=e[2]*p,h=e[3]*p,n=e[0]*d,r=e[0]*f,o=e[0]*p,t[i.M400]=1-(s+h),t[i.M410]=u-o,t[i.M420]=l+r,t[i.M430]=0,t[i.M401]=u+o,t[i.M411]=1-(a+h),t[i.M421]=c-n,t[i.M431]=0,t[i.M402]=l-r,t[i.M412]=c+n,t[i.M422]=1-(a+s),t[i.M432]=0,t[i.M403]=0,t[i.M413]=0,t[i.M423]=0,t[i.M433]=1,t}t.clamp=f,t.zeroQuat=p,t.addQuat=function(e,t,n){return(n=n||p())[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},t.multiplyQuat=function(e,t,n){n=n||p();var r=e[0],i=t[0],o=e[1],a=t[1],s=e[2],c=t[2],u=e[3],l=t[3];return n[0]=r*i-o*a-s*c-u*l,n[1]=r*a+o*i+s*l-u*c,n[2]=r*c-o*l+s*i+u*a,n[3]=r*l+o*c-s*a+u*i,n},t.divideQuat=function(e,t,n){n=n||p();var r=e[0],i=e[1],o=e[2],a=e[3],s=t[0],c=t[1],u=t[2],l=t[3],h=s*s+c*c+u*u+l*l;if(0===h)n[0]=0,n[1]=0,n[2]=0,n[3]=0;else{var d=1/h;n[0]=(r*s+i*c+o*u+a*l)*d,n[1]=(i*s-r*c-o*l+a*u)*d,n[2]=(o*s-r*u-a*c+i*l)*d,n[3]=(a*s-r*l-i*u+o*c)*d}return n},t.exponentQuat=function(e,t){t=t||p();var n=e[0],r=e[1],i=e[2],o=e[3],l=c(r*r+i*i+o*o),h=u(n),d=h/l*s(l);return 0===l?(t[0]=u(n),t[1]=0,t[2]=0,t[3]=0):(t[0]=h*a(l),t[1]=r*d,t[2]=i*d,t[3]=o*d),t},t.scaleQuat=g,t.conjugateQuat=function(e,t){return(t=t||p())[0]=e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},t.inverseQuat=function(e,t){t=t||p();var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;if(0===a)t[0]=0,t[1]=0,t[2]=0,t[3]=0;else{var s=1/a;t[0]=n*s,t[1]=-r*s,t[2]=-i*s,t[3]=-o*s}return t},t.lengthQuat=v,t.normalizeQuat=function(e,t){return t=t||p(),0===v(e)?[0,0,0,0]:g(e,1/v(e),t)},t.realQuat=function(e){return e[0]},t.imaginaryQuat=function(e){return[e[1],e[2],e[3]]},t.dotQuat=function(e,t){return o.dot4(e,t)},t.fromEulerAxisAngleToQuat=function(e,t,n){n=n||p();var r=e[0],i=e[1],o=e[2],u=1/c(r*r+i*i+o*o),l=s(t/2);return n[0]=a(t/2),n[1]=l*r*u,n[2]=l*i*u,n[3]=l*o*u,n},t.fromOrderedEulerToQuat=y,t.toEulerXYZfromOrderedEuler=function(e,t,n){return n=n||[0,0,0],b(y(e,t),r.EulerOrder.xyz,n),n},t.toEulerFromQuat=function(e,t){return b(e,r.EulerOrder.zyx,t)},t.toOrderedEulerFromQuat=b,t.toOrderedEulerFromQuat2=function(e,t,n){n=n||[0,0,0];var i=w(e),o=i[0],a=i[4],s=i[8],c=i[1],u=i[5],l=i[9],h=i[2],d=i[6],p=i[10];switch(t){case r.EulerOrder.xyz:n[1]=Math.asin(f(s,-1,1)),Math.abs(s)<.99999?(n[0]=Math.atan2(-l,p),n[2]=Math.atan2(-a,o)):(n[0]=Math.atan2(d,u),n[2]=0);break;case r.EulerOrder.yxz:n[0]=Math.asin(-f(l,-1,1)),Math.abs(l)<.9999?(n[1]=Math.atan2(s,p),n[2]=Math.atan2(c,u)):(n[1]=Math.atan2(-h,o),n[2]=0);break;case r.EulerOrder.zxy:n[0]=Math.asin(f(d,-1,1)),Math.abs(d)<.99999?(n[1]=Math.atan2(-h,p),n[2]=Math.atan2(-a,u)):(n[1]=0,n[2]=Math.atan2(c,o));break;case r.EulerOrder.zyx:n[1]=Math.asin(-f(h,-1,1)),Math.abs(h)<.99999?(n[0]=Math.atan2(d,p),n[2]=Math.atan2(c,o)):(n[0]=0,n[2]=Math.atan2(-a,u));break;case r.EulerOrder.yzx:n[2]=Math.asin(f(c,-1,1)),Math.abs(c)<.99999?(n[0]=Math.atan2(-l,u),n[1]=Math.atan2(-h,o)):(n[0]=0,n[1]=Math.atan2(s,p));break;case r.EulerOrder.xzy:n[2]=Math.asin(-f(a,-1,1)),Math.abs(a)<.99999?(n[0]=Math.atan2(d,u),n[1]=Math.atan2(s,o)):(n[0]=Math.atan2(-l,p),n[1]=0)}},t.angleQuat=function(e){var t=e[0];if(t<-1||t>1)return 0;var n=2*l(t);return n>d?n-2*d:n},t.axisQuat=function(e){var t=e[1],n=e[2],r=e[3];if(0===c(t*t+n*n+r*r))return[0,0,0];var i=1/c(t*t+n*n+r*r);return[t*i,n*i,r*i]},t.matrix4x4FromUnitQuatModel=function(e,t){var n,r,o,a,s,c,u,l,h,d,f,p;return t=t||i.identity4(),d=e[1]+e[1],f=e[2]+e[2],p=e[3]+e[3],a=e[1]*d,u=e[1]*f,l=e[1]*p,s=e[2]*f,c=e[2]*p,h=e[3]*p,n=e[0]*d,r=e[0]*f,o=e[0]*p,t[i.M400]=1-(s+h),t[i.M401]=u-o,t[i.M402]=l+r,t[i.M403]=0,t[i.M410]=u+o,t[i.M411]=1-(a+h),t[i.M412]=c-n,t[i.M413]=0,t[i.M420]=l-r,t[i.M421]=c+n,t[i.M422]=1-(a+s),t[i.M423]=0,t[i.M430]=0,t[i.M431]=0,t[i.M432]=0,t[i.M433]=1,t},t.matrix4x4FromUnitQuatView=w,t.eulerToQuat=function(e,t){var n,r,i,o,c,u,l,h;t=t||p();var d=e[0],f=e[1],g=e[2];return n=a(d/2),r=a(f/2),i=a(g/2),o=s(d/2),l=r*i,h=(c=s(f/2))*(u=s(g/2)),t[0]=n*l+o*h,t[1]=o*l-n*h,t[2]=n*c*i+o*r*u,t[3]=n*r*u-o*c*i,t},t.lookAtQuat=function(e,t,n){n=n||p();var r=[-(e=o.normalize3(e))[0],-e[1],-e[2]],i=o.normalize3(o.cross3(t,r)),a=o.normalize3(o.cross3(r,i)),s=i[0],u=i[1],l=i[2],h=a[0],d=a[1],f=a[2],g=r[0],v=r[1],y=r[2],m=s+d+y;if(m>0){var b=2*c(m+1);return n[0]=.25*b,n[1]=(v-f)/b,n[2]=(l-g)/b,n[3]=(h-u)/b,n}if(s>d&&s>y){var w=2*c(1+s-d-y);return n[0]=(v-f)/w,n[1]=.25*w,n[2]=(u+h)/w,n[3]=(l+g)/w,n}if(d>y){var x=2*c(1+d-s-y);return n[0]=(l-g)/x,n[1]=(h+u)/x,n[2]=.25*x,n[3]=(v+f)/x,n}var T=2*c(1+y-s-d);return n[0]=(h-u)/T,n[1]=(g+l)/T,n[2]=(v+f)/T,n[3]=.25*T,n},t.matrix3x3ToQuaternion=function(e,t){t=t||p();var n=e[0],r=e[3],i=e[6],o=e[1],a=e[4],s=e[7],u=e[2],l=e[5],h=e[8],d=n+a+h;if(d>0){var f=2*c(d+1);return t[0]=.25*f,t[1]=(l-s)/f,t[2]=(i-u)/f,t[3]=(o-r)/f,t}if(n>a&&n>h){var g=2*c(1+n-a-h);return t[0]=(l-s)/g,t[1]=.25*g,t[2]=(r+o)/g,t[3]=(i+u)/g,t}if(a>h){var v=2*c(1+a-n-h);return t[0]=(i-u)/v,t[1]=(o+r)/v,t[2]=.25*v,t[3]=(l+s)/v,t}var y=2*c(1+h-n-a);return t[0]=(o-r)/y,t[1]=(u+i)/y,t[2]=(l+s)/y,t[3]=.25*y,t},t.matrix4x4ToQuaternion=function(e,t){t=t||p();var n=e[0],r=e[4],i=e[8],o=e[1],a=e[5],s=e[9],u=e[2],l=e[6],h=e[10],d=n+a+h;if(d>0){var f=2*c(d+1);return t[0]=.25*f,t[1]=(l-s)/f,t[2]=(i-u)/f,t[3]=(o-r)/f,t}if(n>a&&n>h){var g=2*c(1+n-a-h);return t[0]=(l-s)/g,t[1]=.25*g,t[2]=(r+o)/g,t[3]=(i+u)/g,t}if(a>h){var v=2*c(1+a-n-h);return t[0]=(i-u)/v,t[1]=(o+r)/v,t[2]=.25*v,t[3]=(l+s)/v,t}var y=2*c(1+h-n-a);return t[0]=(o-r)/y,t[1]=(u+i)/y,t[2]=(l+s)/y,t[3]=.25*y,t},t.lookAtMatrix=function(e,t,n){n=n||i.identity4();var r=[-(e=o.normalize3(e))[0],-e[1],-e[2]],a=o.normalize3(o.cross3(t,r)),s=o.normalize3(o.cross3(r,a));return n[0]=a[0],n[1]=s[0],n[2]=r[0],n[3]=0,n[4]=a[1],n[5]=s[1],n[6]=r[1],n[7]=0,n[8]=a[2],n[9]=s[2],n[10]=r[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},t.slerpUnitQuat=function(e,t,n,r){r=r||p();var i,o,a,c,u,h=[0,0,0,0];return(o=e[1]*t[1]+e[2]*t[2]+e[3]*t[3]+e[0]*t[0])<0?(o=-o,h[0]=-t[1],h[1]=-t[2],h[2]=-t[3],h[3]=-t[0]):(h[0]=t[1],h[1]=t[2],h[2]=t[3],h[3]=t[0]),1-o>1e-7?(i=l(o),a=s(i),c=s((1-n)*i)/a,u=s(n*i)/a):(c=1-n,u=n),r[1]=c*e[1]+u*h[0],r[2]=c*e[2]+u*h[1],r[3]=c*e[3]+u*h[2],r[0]=c*e[0]+u*h[3],r},t.oneQuat=function(){return[1,0,0,0]},t.iQuat=function(){return[0,1,0,0]},t.jQuat=function(){return[0,0,1,0]},t.kQuat=function(){return[0,0,0,1]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.models=new Set}return e.prototype.add=function(e){this.models.add(e)},e.prototype.remove=function(e){this.models.delete(e)},e}();t.Scene=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13);t.generateDefaultElements=function(e){var t=e.canvas.height,n=e.canvas.width,i={aspectRatio:n/t,bottom:-t/2,far:1e7,left:-n/2,near:-100,right:n/2,top:t/2,viewSize:t},o=new r.Camera({type:r.CameraProjectionType.ORTHOGRAPHIC,left:i.left,right:i.right,top:i.top,bottom:i.bottom,near:i.near,far:i.far});return o.scale=[1,-1,1],o.position=[0,0,-300],o.update(),{camera:o,viewport:{bottom:0,left:0,right:0,top:0}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDefined=function(e){return Boolean(e)},t.touchesHasStartView=function(e){return Array.isArray(e)?function(t){return e.indexOf(t.start.view.id)>=0}:function(t){return t.start.view.id===e}},t.touchesContainsStartView=function(e){return Array.isArray(e)?function(t){return t.start.views.find((function(t){return e.indexOf(t.view.id)>=0}))}:function(t){return t.start.views.find((function(t){return t.view.id===e}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(108);t.normalizeWheel=r.normalizeWheel,t.eventElementPosition=function(e,t){var n=0,r=0,i=0,o=0,a=t||e.nativeEvent&&e.nativeEvent.target||e.target;if(e||(e=window.event),e.pageX||e.pageY)n=e.pageX,r=e.pageY;else if(e.clientX||e.clientY){var s=0,c=0;document.documentElement&&(s=document.documentElement.scrollLeft,c=document.documentElement.scrollTop),n=e.clientX+document.body.scrollLeft+s,r=e.clientY+document.body.scrollTop+c}if(a.offsetParent)do{i+=a.offsetLeft,o+=a.offsetTop,a=a.offsetParent}while(a);return[n-i,r-o]}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=n(3);t.filterQuery=function(e,t){var n=[];return t.forEach((function(t){e.find((function(e){return t instanceof e}))&&n.push(t)})),n};var s=function(){function e(e,t){var n=e.mid;this.TL=new c(e.x,n[0],e.y,n[1],t),this.TR=new c(n[0],e.right,e.y,n[1],t),this.BL=new c(e.x,n[0],n[1],e.bottom,t),this.BR=new c(n[0],e.right,n[1],e.bottom,t)}return e.prototype.destroy=function(){this.TL.destroy(),this.TR.destroy(),this.BL.destroy(),this.BR.destroy(),delete this.TL,delete this.TR,delete this.BL,delete this.BR},e}();t.QuadTreeQuadrants=s;var c=function(){function e(e,t,n,r,i){this.children=[],this.depth=0,arguments.length>=4?this.bounds=new o.Bounds({left:e,right:t,top:n,bottom:r}):this.bounds=new o.Bounds({left:0,right:1,top:0,bottom:1}),this.depth=i||0}return e.prototype.destroy=function(){delete this.children,delete this.bounds,this.nodes&&(this.nodes.destroy(),delete this.nodes)},e.prototype.add=function(e,t){return e.isInside(this.bounds)?this.doAdd(e):(this.cover(e),this.add(e,t))},e.prototype.addAll=function(e){for(var t=this,n=Number.MAX_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,a=Number.MIN_SAFE_INTEGER,s=Math.min,c=Math.max,u=0,l=e.length;u<l;++u){var h=e[u];n=s(n,h.x),i=c(h.right,i),r=s(r,h.y),a=c(a,h.bottom)}this.cover(new o.Bounds({left:n,right:i,top:r,bottom:a})),e.forEach((function(e){return t.doAdd(e)}))},e.prototype.cover=function(e){var t=this;if(!e.isInside(this.bounds)){this.bounds.encapsulate(e),this.bounds.x-=1,this.bounds.y-=1,this.bounds.width+=2,this.bounds.height+=2;var n=this.gatherChildren([]);this.nodes&&(this.nodes.destroy(),delete this.nodes),n.forEach((function(e){return t.doAdd(e)}))}},e.prototype.doAdd=function(e){return this.nodes?e.isInside(this.nodes.TL.bounds)?this.nodes.TL.doAdd(e):e.isInside(this.nodes.TR.bounds)?this.nodes.TR.doAdd(e):e.isInside(this.nodes.BL.bounds)?this.nodes.BL.doAdd(e):e.isInside(this.nodes.BR.bounds)?this.nodes.BR.doAdd(e):(this.children.push(e),!0):e.isInside(this.bounds)?(this.children.push(e),this.children.length>5&&this.depth<10&&this.split(),!0):(isNaN(e.width+e.height+e.x+e.y)?console.error("Child did not fit into bounds because a dimension is NaN",e):0===e.area&&console.error("Child did not fit into bounds because the area is zero",e),!0)},e.prototype.gatherChildren=function(e,t){t&&t(this);for(var n=0,r=this.children.length;n<r;++n)e.push(this.children[n]);return this.nodes&&(this.nodes.TL.gatherChildren(e,t),this.nodes.TR.gatherChildren(e,t),this.nodes.BL.gatherChildren(e,t),this.nodes.BR.gatherChildren(e,t)),e},e.prototype.query=function(e,t){return e instanceof o.Bounds?e.hitBounds(this.bounds)?this.queryBounds(e,[],t):[]:a.isVec2(e)&&this.bounds.containsPoint(e)?this.queryPoint(e,[],t):[]},e.prototype.queryBounds=function(e,t,n){return this.bounds.isInside(e)?(this.gatherChildren(t,n),t):(this.children.forEach((function(n){n.hitBounds(e)&&t.push(n)})),n&&n(this),this.nodes&&(e.hitBounds(this.nodes.TL.bounds)&&this.nodes.TL.queryBounds(e,t,n),e.hitBounds(this.nodes.TR.bounds)&&this.nodes.TR.queryBounds(e,t,n),e.hitBounds(this.nodes.BL.bounds)&&this.nodes.BL.queryBounds(e,t,n),e.hitBounds(this.nodes.BR.bounds)&&this.nodes.BR.queryBounds(e,t,n)),t)},e.prototype.queryPoint=function(e,t,n){return this.children.forEach((function(n){n.containsPoint(e)&&t.push(n)})),n&&n(this),this.nodes&&(this.nodes.TL.bounds.containsPoint(e)&&this.nodes.TL.queryPoint(e,t,n),this.nodes.TR.bounds.containsPoint(e)&&this.nodes.TR.queryPoint(e,t,n),this.nodes.BL.bounds.containsPoint(e)&&this.nodes.BL.queryPoint(e,t,n),this.nodes.BR.bounds.containsPoint(e)&&this.nodes.BR.queryPoint(e,t,n)),t},e.prototype.split=function(){var e=[];this.gatherChildren(e),this.nodes=new s(this.bounds,this.depth+1),this.children=[];for(var t=0,n=e.length;t<n;++t){var r=e[t];r&&this.doAdd(r)}},e.prototype.visit=function(e){var t=Boolean(e(this));this.nodes&&!t&&(this.nodes.TL.visit(e),this.nodes.TR.visit(e),this.nodes.BL.visit(e),this.nodes.BR.visit(e))},e}();t.QuadTreeNode=c;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(c);t.QuadTree=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4)("performance"),i=function(){function e(){}return e.prototype.setDeclaration=function(e,t,n,i){e.get(t)&&r("%s: Overriding declaration %s\nSetting new value: %s",i||"Expand IO Declarations",t,n),e.set(t,n)},e}();t.BaseShaderIOInjection=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="Once a ShaderModuleUnit has been registered, you CAN NOT modify it! Module ID:",i=function(){function e(e){this._dependents=null,Object.assign(this,e)}return Object.defineProperty(e.prototype,"content",{get:function(){return this._content},set:function(e){this._isLocked?console.warn(r,this._moduleId):this._content=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compatibility",{get:function(){return this._compatibility},set:function(e){this._isLocked?console.warn(r,this._moduleId):this._compatibility=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dependents",{get:function(){return this._dependents},set:function(e){this._isLocked&&null!==this._dependents?console.warn(r,this._moduleId):this._dependents=e},enumerable:!0,configurable:!0}),e.prototype.isLocked=function(){return this._isLocked},Object.defineProperty(e.prototype,"moduleId",{get:function(){return this._moduleId},set:function(e){this._isLocked?console.warn(r,this._moduleId):this._moduleId=e},enumerable:!0,configurable:!0}),e.prototype.applyAnalyzedContent=function(e){this._isLocked&&null!==this.dependents?console.warn(r,this._moduleId):this._content=e},e.prototype.lock=function(){this._isLocked=!0},e}();t.ShaderModuleUnit=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(1),o=n(62),a=n(4)("performance"),s=n(4)("shader-module-vs"),c=n(4)("shader-module-fs");function u(e,t){return Boolean(e)&&(e.compatibility===t||e.compatibility===r.ShaderInjectionTarget.ALL)}var l=function(){function e(){}return e.register=function(t){if(!(t instanceof o.ShaderModuleUnit)){if(Array.isArray(t)){var n="";return t.forEach((function(t){var r=e.register(t);r&&(n+=r+"\n")})),n||null}return e.register(new o.ShaderModuleUnit(t))}var i=e.modules.get(t.moduleId);i||(i={},e.modules.set(t.moduleId,i));var s=i.fs,c=i.vs,l=u(t,r.ShaderInjectionTarget.FRAGMENT),h=u(t,r.ShaderInjectionTarget.VERTEX);if(s&&l){if(s.isFinal)return"Module ID: "+t.moduleId+" Can not override the module's existing Fragment registration as the exisitng module is marked as final";a("A Shader Module Unit has overridden an existing module for the Fragment Shader Module ID: %o",t.moduleId)}if(c&&h){if(c.isFinal)return"Module ID: "+t.moduleId+" Can not override the module's existing Vertex registration as the exisitng module is marked as final";a("A Shader Module Unit has overridden an existing module for the Vertex Shader Module ID: %o",t.moduleId)}return l&&(i.fs=t),h&&(i.vs=t),t.lock(),null},e.analyzeDependents=function(t){if(t.dependents&&t.isLocked)return[];var n=[],o=[],a=new Set,s=t.compatibility,c=t.moduleId,u=i.shaderTemplate({options:{},shader:t.content,onToken:function(t){var i=t.trim();if(0===i.indexOf("import")){var u=i.substr("import".length).trim();if(":"===u[0]){var l=!1,h=u.substr(":".length).trim().split(",");return 0===h[h.length-1].trim().length&&h.pop(),h.forEach((function(t){t=t.trim();var i=e.modules.get(t);i?(s!==r.ShaderInjectionTarget.FRAGMENT&&s!==r.ShaderInjectionTarget.ALL||(i.fs?(l=!0,a.has(t)||o.push(t)):n.push("Could not find requested target fragment module for Module ID: "+t+" requested by module: "+c)),s!==r.ShaderInjectionTarget.VERTEX&&s!==r.ShaderInjectionTarget.ALL||(i.vs?(l=!0,a.has(t)||o.push(t)):n.push("Could not find requested target vertex module for Module ID: "+t+" requested by module: "+c)),i.vs||i.fs||n.push("Could not find a vertex or fragment shader within exisitng module"),l||n.push("Error Processing module Module ID: "+t+" requested by module: "+c)):n.push("Could not find requested module: "+t+" requested by module: "+c)})),""}}return"${"+t+"}"}});return t.applyAnalyzedContent(u.shader),t.dependents=o,n},e.process=function(t,n,i,a){var u=new Set,l=new Set,h=[],d=[],f=i===r.ShaderInjectionTarget.VERTEX?s:c;f("Processing Shader for id %o:",t);var p=n;if(a){var g="";a.forEach((function(e){return g+="${import: "+e+"}\n"})),p=g+n}var v=new o.ShaderModuleUnit({content:p,compatibility:i,moduleId:'Layer "'+t+'" '+(i===r.ShaderInjectionTarget.ALL?"fs vs":i===r.ShaderInjectionTarget.VERTEX?"vs":"fs")});return{errors:d,shader:function t(n){var o=n.moduleId;if(!function(e){var t=e.moduleId;f("%o: %o",t,h.slice(0).reverse().join(" -> "));var n=h.indexOf(t);if(h.unshift(t),n>-1){var r=h.slice(0,n+2).reverse();return d.push("A Shader has detected a Circular dependency in import requests: "+r.join(" -> ")),h.shift(),!1}return!0}(n))return null;if(o&&l.has(o))return h.shift(),"";var a="";e.analyzeDependents(n).forEach((function(e){return d.push(e)}));var s=n.dependents;if(s&&s.length>0)for(var c=0,p=s.length;c<p;++c){var g=s[c],v=e.modules.get(g);if(v){var y=void 0;i!==r.ShaderInjectionTarget.FRAGMENT&&i!==r.ShaderInjectionTarget.ALL||(v.fs?(u.add(v.fs),y=t(v.fs)):d.push("Could not find requested target fragment module for Module ID: "+g+" requested by module: "+o)),i!==r.ShaderInjectionTarget.VERTEX&&i!==r.ShaderInjectionTarget.ALL||(v.vs?(u.add(v.vs),y=t(v.vs)):d.push("Could not find requested target vertex module for Module ID: "+g+" requested by module: "+o)),v.vs||v.fs||d.push("Could not find a vertex or fragment shader within exisitng module"),null===y&&d.push("Error Processing module Module ID: "+g+" requested by module: "+o),a+=y||""}else d.push("Could not find requested module: "+g+" requested by module: "+o)}return h.shift(),l.add(o||""),a.trim()+"\n\n"+n.content.trim()}(v),shaderModuleUnits:u}},e.modules=new Map,e}();t.ShaderModule=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(45),i=n(9),o=-1,a=[],s=[],c=[],u=new Map,l=function e(t){var n=!1;u.forEach((function(e){if(n=!0,-1!==e[1]){if(-1===e[2]&&(e[2]=t),t-e[2]>=e[1])for(e[0](t);t-e[2]>=e[1];)e[2]+=e[1]}else e[0](t)}));var r=s.slice();s=[];for(var i=0,l=r.length;i<l;++i){(h=r[i])&&(n=!0,h(t))}for(i=0,l=c.length;i<l;++i){var h;(h=c[i])&&(n=!0,h(t))}c=a.slice(0),a=[],c.length>0&&(n=!0),o=n?requestAnimationFrame(e):-1};requestAnimationFrame(l),t.nextFrame=function(e){var t=new r.PromiseResolver;return a.push((function(n){e&&e(n),t.resolve(n)})),-1===o&&(o=requestAnimationFrame(l)),t.promise},t.onFrame=function(e){var t=new r.PromiseResolver;return s.push((function(n){e&&e(n),t.resolve(n)})),-1===o&&(o=requestAnimationFrame(l)),t.promise},t.onAnimationLoop=function(e,t){var n=i.uid();return u.set(n,[e,t||-1,-1]),-1===o&&(o=requestAnimationFrame(l)),n},t.stopAnimationLoop=function(e){u.delete(e),-1===o&&(o=requestAnimationFrame(l))},t.stopAllFrameCommands=function(){u.clear(),s=[],a=[],c=[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(46),i=n(12),o=n(22),a=n(4)("performance");function s(e){return e&&e.buffer&&void 0!==e.buffer.byteOffset&&e.buffer.byteLength||null===e.buffer}function c(e){return 0==(e&e-1)}function u(e){return Boolean(e.gl&&e.gl.textureId&&e.gl.textureUnit>-1)}var l=function(){function e(e,t,n){this.debugContext="",this.fragmentShaders=new Map,this.vertexShaders=new Map,this.programs=new Map,this.gl=e,this.state=t,this.extensions=n}return e.addExtensions=function(e){var t=e.getExtension("ANGLE_instanced_arrays"),n=e.getExtension("WEBGL_draw_buffers"),r=e.getExtension("EXT_texture_filter_anisotropic"),i={maxAnistropicFilter:0};return t||e instanceof WebGL2RenderingContext||a("This device does not have hardware instancing. All buffering strategies will be utilizing compatibility modes."),n||e instanceof WebGL2RenderingContext||a("This device does not have hardware multi-render target capabilities. The system will have to fallback to multiple render passes to multiple FBOs to achieve the same result."),r?i.maxAnistropicFilter=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):a("This device does not have hardware anisotropic filtering for textures. This property will be ignored when setting texture settings."),{instancing:(e instanceof WebGL2RenderingContext?e:t)||void 0,drawBuffers:(e instanceof WebGL2RenderingContext?e:n)||void 0,anisotropicFiltering:r?{ext:r,stat:i}:void 0}},e.prototype.clear=function(e,t,n){var r=0;e&&(r|=this.gl.COLOR_BUFFER_BIT),t&&(r|=this.gl.DEPTH_BUFFER_BIT),n&&(r|=this.gl.STENCIL_BUFFER_BIT),this.gl.clear(r)},e.prototype.compileAttribute=function(e){if(!e.gl){var t=this.gl,n=t.createBuffer();return n?(this.state.bindVBO(n),t.bufferData(t.ARRAY_BUFFER,e.data,e.isDynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW),e.gl={bufferId:n,type:t.ARRAY_BUFFER},e.resolve(),!0):(console.warn(this.debugContext,"Could bot create WebGLBuffer. Printing any existing gl errors:"),void this.printError())}},e.prototype.compileGeometry=function(e){var t=this,n=!0;return e.attributes.forEach((function(e){n=Boolean(t.compileAttribute(e)&&n)})),n},e.prototype.compileMaterial=function(e){if(!e.gl){var t=this.fragmentShaders.get(e.fragmentShader)||null;if(!t){if(!(t=this.gl.createShader(this.gl.FRAGMENT_SHADER)))return console.warn(this.debugContext,"Could not create a Fragment WebGLShader. Printing GL Errors:"),void this.printError();if(this.gl.shaderSource(t,e.fragmentShader),this.gl.compileShader(t),this.gl.isContextLost()&&console.warn("Context was lost during compilation"),!this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS))return console.error(this.debugContext,"FRAGMENT SHADER COMPILER ERROR:",e.name),console.warn("Could not compile provided shader. Printing logs and errors:"),console.warn(this.lineFormatShader(e.fragmentShader)),console.warn("LOGS:"),console.warn(this.gl.getShaderInfoLog(t)),this.printError(),void this.gl.deleteShader(t)}var n=this.vertexShaders.get(e.vertexShader)||null;if(!n){if(!(n=this.gl.createShader(this.gl.VERTEX_SHADER)))return console.warn(this.debugContext,"Could not create a Vertex WebGLShader. Printing GL Errors:"),void this.printError();if(this.gl.shaderSource(n,e.vertexShader),this.gl.compileShader(n),this.gl.isContextLost()&&console.warn("Context was lost during compilation"),!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS))return console.error(this.debugContext,"VERTEX SHADER COMPILER ERROR",e.name),console.warn("Could not compile provided shader. Printing logs and errors:"),console.warn(this.lineFormatShader(e.vertexShader)),console.warn("LOGS:"),console.warn(this.gl.getShaderInfoLog(n)),this.printError(),void this.gl.deleteShader(n)}var r=this.programs.get(n);r||(r=new Map,this.programs.set(n,r));var i=r.get(t)||null;if(i)i.useCount++;else{var o=this.gl.createProgram();if(!o)return console.warn(this.debugContext,"Could not create a WebGLProgram. Printing GL Errors:"),void this.printError();if(i={useCount:1,program:o},this.gl.attachShader(o,n),this.gl.attachShader(o,t),this.gl.linkProgram(o),this.gl.validateProgram(o),!this.gl.getProgramParameter(o,this.gl.LINK_STATUS)||!this.gl.getProgramParameter(o,this.gl.VALIDATE_STATUS)){var a=this.gl.getProgramInfoLog(o);return console.warn(this.debugContext,"Could not compile WebGL program. \n\n",a),void this.gl.deleteProgram(o)}r.set(t,i)}e.gl={fsId:t,vsId:n,programId:i.program,proxy:this},this.state.useProgram(i.program);var s=this.state.currentProgram;if(!s)return!1;for(var c=this.gl.getProgramParameter(s,this.gl.ACTIVE_UNIFORMS),u=new Set,l=0;l<c;l++){var h=this.gl.getActiveUniform(s,l);h&&u.add(h.name)}var d=new Set;return Object.keys(e.uniforms).forEach((function(e){u.has(e)||d.add(e)})),d.forEach((function(t){delete e.uniforms[t]})),Object.keys(e.uniforms).length===u.size||(console.warn(this.debugContext,"A program is requesting a set of uniforms:",Array.from(u.values()),"but our material only provides",Object.keys(e.uniforms),"thus the expected rendering will be considered invalid."),!1)}},e.prototype.compileRenderTarget=function(e){var t=this;if(!e.gl){var n=this.gl,i=n.createFramebuffer();if(!i)return console.warn(this.debugContext,"Could not generate a frame buffer object. Printing GL errors:"),this.printError(),!1;this.state.bindFBO(i);var a={fboId:i,proxy:this};if(Array.isArray(e.buffers.color)){var s=[],c=!0;if(a.colorBufferId=s,e.buffers.color.forEach((function(i,a){if(c)if(i instanceof o.Texture)s.push(i),u(i)?n.framebufferTexture2D(n.FRAMEBUFFER,r.indexToColorAttachment(n,t.extensions,a,!0),n.TEXTURE_2D,i.gl.textureId,0):(console.warn(t.debugContext,"Attempted to compile render target whose target texture was not ready for use."),c=!1);else{var l=t.compileColorBuffer(i,e.width,e.height);l&&(s.push(l),n.framebufferRenderbuffer(n.FRAMEBUFFER,r.indexToColorAttachment(n,t.extensions,a,!0),n.RENDERBUFFER,l))}})),!c)return!1}else if(void 0!==e.buffers.color){var l;if((l=e.buffers.color)instanceof o.Texture){if(a.colorBufferId=l,!u(l))return console.warn(this.debugContext,"Attempted to compile render target whose target texture was not ready for use."),!1;n.framebufferTexture2D(n.FRAMEBUFFER,r.indexToColorAttachment(n,this.extensions,0,!0),n.TEXTURE_2D,l.gl.textureId,0)}else{var h;(h=this.compileColorBuffer(l,e.width,e.height))&&(a.colorBufferId=h,n.framebufferRenderbuffer(n.FRAMEBUFFER,r.indexToColorAttachment(n,this.extensions,0,!0),n.RENDERBUFFER,h))}}if(void 0!==e.buffers.depth)if((l=e.buffers.depth)instanceof o.Texture)a.depthBufferId=l,u(l)&&n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,l.gl.textureId,0);else(h=this.compileDepthBuffer(l,e.width,e.height))&&(a.depthBufferId=h,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,h));if(void 0!==e.buffers.stencil)if((l=e.buffers.stencil)instanceof o.Texture)a.stencilBufferId=l,u(l)&&n.framebufferTexture2D(n.FRAMEBUFFER,n.STENCIL_ATTACHMENT,n.TEXTURE_2D,l.gl.textureId,0);else(h=this.compileStencilBuffer(l,e.width,e.height))&&(a.stencilBufferId=h,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.STENCIL_ATTACHMENT,n.RENDERBUFFER,h));e.gl=a;var d=n.checkFramebufferStatus(n.FRAMEBUFFER),f=!1,p=!1,g="";switch(d){case n.FRAMEBUFFER_COMPLETE:e.setAsValid();break;case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:g="FRAMEBUFFER_INCOMPLETE_ATTACHMENT";break;case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:g="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";break;case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:g="FRAMEBUFFER_INCOMPLETE_DIMENSIONS";break;case n.FRAMEBUFFER_UNSUPPORTED:g="FRAMEBUFFER_UNSUPPORTED";break;default:f=!0}if(n instanceof WebGL2RenderingContext)switch(d){case n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:g="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE";break;case n.RENDERBUFFER_SAMPLES:g="RENDERBUFFER_SAMPLES";break;default:p=!0}return f&&p&&(console.warn(this.debugContext,"A framebuffer check failed to return a known result. This FBO for render target will be assumed failed"),console.warn("Result:",d,"Render Target:",e),g="UNKNOWN"),!g||(console.warn(this.debugContext,"When creating a new FrameBuffer Object, the check on the framebuffer failed. Printing Errors:"),console.warn(g),console.warn("FAILED RENDER TARGET:",e),delete e.gl,!1)}},e.prototype.compileDepthBuffer=function(e,t,n){var i=this.gl,o=i.createRenderbuffer();return o?(this.state.bindRBO(o),i.renderbufferStorage(i.RENDERBUFFER,r.depthBufferFormat(i,e),t,n),o):(console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),void this.printError())},e.prototype.compileStencilBuffer=function(e,t,n){var i=this.gl,o=i.createRenderbuffer();return o?(this.state.bindRBO(o),i.renderbufferStorage(i.RENDERBUFFER,r.stencilBufferFormat(i,e),t,n),o):(console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),void this.printError())},e.prototype.compileColorBuffer=function(e,t,n){var i=this.gl,o=i.createRenderbuffer();return o?(this.state.bindRBO(o),i.renderbufferStorage(i.RENDERBUFFER,r.colorBufferFormat(i,e),t,n),o):(console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),void this.printError())},e.prototype.compileTexture=function(e){if(e.gl&&!e.gl.textureId){if(!(e.gl.textureUnit<0)){this.state.setActiveTextureUnit(e.gl.textureUnit);var t=this.gl.createTexture();return t?(e.gl.textureId=t,e.needsDataUpload=!0,e.needsSettingsUpdate=!0,this.updateTextureData(e),this.updateTextureSettings(e),!0):(console.warn(this.debugContext,"Could not generate a texture object on the GPU. Printing any gl errors:"),void this.printError())}console.warn(this.debugContext,"A Texture object attempted to be compiled without an established Texture Unit.",e)}},e.prototype.draw=function(e){var t,n=[0,0];n=e.vertexDrawRange&&e.vertexDrawRange[0]>=0&&e.vertexDrawRange[1]>=0?[e.vertexDrawRange[0],e.vertexDrawRange[1]-e.vertexDrawRange[0]]:[0,e.vertexCount],e.drawInstances>=0&&e.geometry.isInstanced&&(t=this.extensions.instancing),t&&t instanceof WebGL2RenderingContext?t.drawArraysInstanced(r.drawMode(this.gl,e.drawMode),n[0],n[1],e.drawInstances):t?t.drawArraysInstancedANGLE(r.drawMode(this.gl,e.drawMode),n[0],n[1],e.drawInstances):this.gl.drawArrays(r.drawMode(this.gl,e.drawMode),n[0],n[1])},e.prototype.disposeMaterial=function(e){if(e.gl){var t=e.gl,n=t.vsId,r=t.fsId,i=t.programId,o=this.programs.get(n);o||(o=new Map,this.gl.deleteShader(n));var a=o.get(r);a||(a={useCount:0,program:i}),a.useCount--,a.useCount<1&&(this.gl.deleteProgram(a.program),o.delete(r),o.size<=0&&this.gl.deleteShader(n));var s=!1;this.programs.forEach((function(e){e.has(r)&&(s=!0)})),s||this.gl.deleteShader(r)}delete e.gl},e.prototype.disposeRenderBuffer=function(e){this.gl.deleteRenderbuffer(e)},e.prototype.disposeRenderTarget=function(e){var t=this;e.gl&&(Array.isArray(e.gl.colorBufferId)?e.gl.colorBufferId.forEach((function(n){n instanceof o.Texture&&!e.retainTextureTargets?t.disposeTexture(n):t.disposeRenderBuffer(n)})):e.gl.colorBufferId instanceof o.Texture&&!e.retainTextureTargets?this.disposeTexture(e.gl.colorBufferId):e.gl.colorBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.colorBufferId),e.gl.depthBufferId instanceof o.Texture&&!e.retainTextureTargets?this.disposeTexture(e.gl.depthBufferId):e.gl.depthBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.depthBufferId),e.gl.stencilBufferId instanceof o.Texture&&!e.retainTextureTargets?this.disposeTexture(e.gl.stencilBufferId):e.gl.stencilBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.stencilBufferId),delete e.gl)},e.prototype.disposeTexture=function(e){e.gl&&(this.gl.deleteTexture(e.gl.textureId),this.state.freeTextureUnit(e)),delete e.gl},e.getContext=function(t,n){for(var r=["webgl","experimental-webgl"],i=null,o={},s=0;s<r.length;++s){var c=r[s],u=t.getContext(c,n);if(u&&(u instanceof WebGLRenderingContext||u instanceof WebGL2RenderingContext)){a("Generated GL Context of version with attributes:",c,n),i=u,o=e.addExtensions(i);break}}return{context:i,extensions:o}},e.prototype.printError=function(){var e=this.gl.getError();switch(e){case this.gl.NO_ERROR:console.warn("GL Error: No Error");break;case this.gl.INVALID_ENUM:console.warn("GL Error: INVALID ENUM");break;case this.gl.INVALID_VALUE:console.warn("GL Error: INVALID_VALUE");break;case this.gl.INVALID_OPERATION:console.warn("GL Error: INVALID OPERATION");break;case this.gl.INVALID_FRAMEBUFFER_OPERATION:console.warn("GL Error: INVALID FRAMEBUFFER OPERATION");break;case this.gl.OUT_OF_MEMORY:console.warn("GL Error: OUT OF MEMORY");break;case this.gl.CONTEXT_LOST_WEBGL:console.warn("GL Error: CONTEXT LOST WEBGL");break;default:console.warn("GL Error: GL Context output an unrecognized error value:",e)}},e.prototype.lineFormatShader=function(e){var t=e.split("\n"),n=String(t.length).length+1;return"\n"+t.map((function(e,t){return""+Array(n-String(t+1).length).join(" ")+(t+1)+": "+e})).join("\n")},e.prototype.updateTexture=function(e){!e.gl||e.gl.textureUnit<0?console.warn(this.debugContext,"Can not update or compile a texture that does not have an established texture unit.",e):(this.compileTexture(e),this.updateTextureData(e),this.updateTexturePartialData(e),this.updateTextureSettings(e),e.resolve())},e.prototype.updateTextureData=function(e){if(e.needsDataUpload&&e.gl&&e.gl.textureId)if(e.gl.textureUnit<0)console.warn(this.debugContext,"A Texture object attempted to update it's data without an established Texture Unit.",e);else{var t=this.gl;this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,i.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D),e.needsSettingsUpdate=!0,this.updateTextureSettings(e),t instanceof WebGLRenderingContext&&(s(e.data)?(c(e.data.width)&&c(e.data.height)||a("Created a texture that is not using power of 2 dimensions."),t.texImage2D(t.TEXTURE_2D,0,r.texelFormat(t,e.format),e.data.width,e.data.height,0,r.texelFormat(t,e.format),r.inputImageFormat(t,e.type),e.data.buffer)):e.data&&(c(e.data.width)&&c(e.data.height)||a("Created a texture that is not using power of 2 dimensions. %o",e),t.texImage2D(t.TEXTURE_2D,0,r.texelFormat(t,e.format),r.texelFormat(t,e.format),r.inputImageFormat(t,e.type),e.data)),e.generateMipMaps&&t.generateMipmap(t.TEXTURE_2D)),e.data&&(e.data={width:e.data.width,height:e.data.height,buffer:null}),e.needsDataUpload=!1}},e.prototype.updateTexturePartialData=function(e){if(e.needsPartialDataUpload&&e.gl&&e.gl.textureId)if(e.gl.textureUnit<0)console.warn(this.debugContext,"A Texture object attempted to update it's data without an established Texture Unit.",e);else{var t=this.gl;this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,i.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D),e.updateRegions.forEach((function(n){var i=n[0],o=n[1];t instanceof WebGLRenderingContext&&(s(i)?t.texSubImage2D(t.TEXTURE_2D,0,o.x,o.y,i.width,i.height,r.texelFormat(t,e.format),r.inputImageFormat(t,e.type),i.buffer):i&&t.texSubImage2D(t.TEXTURE_2D,0,o.x,o.y,r.texelFormat(t,e.format),r.inputImageFormat(t,e.type),i),e.generateMipMaps&&t.generateMipmap(t.TEXTURE_2D))})),e.needsPartialDataUpload=!1}},e.prototype.updateTextureSettings=function(e){if(e.needsSettingsUpdate&&e.gl&&e.data&&e.gl.textureId)if(e.gl.textureUnit<0)console.warn(this.debugContext,"A Texture object attempted to update it's settings without an established Texture Unit.",e);else{var t=c(e.data.width)&&c(e.data.height),n=this.gl;if(this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,i.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,r.magFilter(n,e.magFilter,t)),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,r.minFilter(n,e.minFilter,t,e.generateMipMaps)),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,r.wrapMode(n,e.wrapHorizontal)),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,r.wrapMode(n,e.wrapVertical)),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e.flipY),this.extensions.anisotropicFiltering){var o=this.extensions.anisotropicFiltering,a=o.ext,s=o.stat;n.texParameterf(n.TEXTURE_2D,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.maxAnistropicFilter,Math.floor(e.anisotropy)))}e.needsSettingsUpdate=!1}},e.prototype.updateAttribute=function(e){if(!e.gl)return this.compileAttribute(e);if(!e.fullUpdate&&!e.needsUpdate)return!0;var t=this.gl;if(e.fullUpdate||e.updateRange.count<0||e.updateRange.offset<0)this.state.bindVBO(e.gl.bufferId),t.bufferData(t.ARRAY_BUFFER,e.data,e.isDynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW);else if(e.updateRange.count>0){this.state.bindVBO(e.gl.bufferId);var n=e.updateRange.offset;t.bufferSubData(t.ARRAY_BUFFER,4*n,e.data.subarray(n,n+e.updateRange.count))}return e.resolve(),!0},e.prototype.useAttribute=function(e,t,n){if(!this.state.currentProgram)return!1;if(!t.gl)return!1;t.gl.locations=t.gl.locations||new Map;var r=t.gl.locations.get(this.state.currentProgram);if(void 0===r&&(-1===(r=this.gl.getAttribLocation(this.state.currentProgram,e))&&a("WARN: An attribute is not being used with the current material: %o",e,t),t.gl.locations.set(this.state.currentProgram,r)),-1!==r){switch(this.state.bindVBO(t.gl.bufferId),t.size){case 1:case 2:case 3:case 4:this.state.willUseVertexAttributeArray(r),this.gl.vertexAttribPointer(r,t.size,this.gl.FLOAT,t.normalize,0,0),n.isInstanced&&t.isInstanced&&this.extensions.instancing?this.state.setVertexAttributeArrayDivisor(r,1):this.state.setVertexAttributeArrayDivisor(r,0);break;default:for(var i=Math.ceil(t.size/4),o=0;o<i;++o)this.state.willUseVertexAttributeArray(r+o);for(o=0;o<i;++o)this.gl.vertexAttribPointer(r+o,4,this.gl.FLOAT,t.normalize,4*i*4,16*o);for(o=0;o<i;++o)n.isInstanced&&t.isInstanced&&this.extensions.instancing?this.state.setVertexAttributeArrayDivisor(r+o,1):this.state.setVertexAttributeArrayDivisor(r+o,0)}return!0}},e}();t.GLProxy=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(46),o=n(12),a=n(67),s=n(31),c=n(4)("performance"),u=function(){function e(e,t){this.debugContext="",this._textureUnitToTexture=new Map,this._freeUnits=[],this._blendingEnabled=!0,this._blendDstFactor=o.GLSettings.Material.BlendingDstFactor.One,this._blendSrcFactor=o.GLSettings.Material.BlendingDstFactor.One,this._blendEquation=o.GLSettings.Material.BlendingEquations.Add,this._cullFace=o.GLSettings.Material.CullSide.NONE,this._colorMask=[!0,!0,!0,!0],this._clearColor=[0,0,0,1],this._depthFunc=o.GLSettings.Material.DepthFunctions.ALWAYS,this._depthTestEnabled=!0,this._depthMask=!0,this._ditheringEnabled=!0,this._boundFBO=null,this._boundRBO=null,this._boundVBO=null,this._boundTexture={id:null,unit:-1},this._currentProgram=null,this._scissorTestEnabled=!1,this._scissorBounds={x:0,y:0,width:1,height:1},this._activeTextureUnit=-1,this._textureWillBeUsed=new Map,this._viewport={x:0,y:0,width:100,height:100},this._enabledVertexAttributeArray=[],this._willUseVertexAttributeArray=[],this._vertexAttributeArrayDivisor=new Map,this.gl=e,this.extensions=t;for(var n=this.gl.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),r=0;r<n;++r)this._freeUnits.push(i.indexToTextureUnit(e,r));this._activeTextureUnit=e.TEXTURE0}return Object.defineProperty(e.prototype,"blendingEnabled",{get:function(){return this._blendingEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendDstFactor",{get:function(){return this._blendDstFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendSrcFactor",{get:function(){return this._blendSrcFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendEquation",{get:function(){return this._blendEquation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorMask",{get:function(){return this._colorMask},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clearColor",{get:function(){return this._clearColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTestEnabled",{get:function(){return this._depthTestEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ditheringEnabled",{get:function(){return this._ditheringEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundFBO",{get:function(){return this._boundFBO},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundRBO",{get:function(){return this._boundRBO},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundVBO",{get:function(){return this._boundVBO},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundTexture",{get:function(){return this._boundTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentProgram",{get:function(){return this._currentProgram},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scissorTestEnabled",{get:function(){return this._scissorTestEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scissorBounds",{get:function(){return this._scissorBounds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentUniforms",{get:function(){return this._currentUniforms},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeTextureUnit",{get:function(){return this._activeTextureUnit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureWillBeUsed",{get:function(){return this._textureWillBeUsed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabledVertexAttributeArray",{get:function(){return this._enabledVertexAttributeArray.slice(0).filter((function(e){return void 0!==e}))},enumerable:!0,configurable:!0}),e.prototype.bindVBO=function(e){this._boundVBO!==e&&(this._boundVBO=e,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e))},e.prototype.bindRBO=function(e){this._boundRBO!==e&&(this._boundRBO=e,this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,e))},e.prototype.bindFBO=function(e){this._boundFBO!==e&&(this._boundFBO=e,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e))},e.prototype.bindTexture=function(e,t){if(e.gl&&e.gl.textureId&&(!e||this._boundTexture.id!==e.gl.textureId||this._boundTexture.unit!==this._activeTextureUnit)){switch(this._boundTexture={id:e.gl.textureId,unit:this._activeTextureUnit},t){case o.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D:this.gl.bindTexture(this.gl.TEXTURE_2D,e.gl.textureId);break;case o.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D:this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,e.gl.textureId)}var n=this._textureUnitToTexture.get(this._activeTextureUnit);n&&n.gl&&(n.gl.textureUnit=-1),this._textureUnitToTexture.set(this._activeTextureUnit,e),e.gl.textureUnit=this._activeTextureUnit}},e.prototype.willUseVertexAttributeArray=function(e){this._willUseVertexAttributeArray[e]=e,void 0===this._enabledVertexAttributeArray[e]&&(this._enabledVertexAttributeArray[e]=e,this.gl.enableVertexAttribArray(e))},e.prototype.applyVertexAttributeArrays=function(){for(var e=0,t=this._enabledVertexAttributeArray.length;e<t;++e){var n=this._enabledVertexAttributeArray[e];if(void 0!==n){if(void 0!==this._willUseVertexAttributeArray[n])return;this.gl.disableVertexAttribArray(n),delete this._enabledVertexAttributeArray[n]}}this._willUseVertexAttributeArray=[]},e.prototype.setVertexAttributeArrayDivisor=function(e,t){this.extensions.instancing&&void 0!==this._enabledVertexAttributeArray[e]&&this._vertexAttributeArrayDivisor.get(e)!==t&&(this.extensions.instancing instanceof WebGL2RenderingContext?this.extensions.instancing.vertexAttribDivisor(e,t):this.extensions.instancing.vertexAttribDivisorANGLE(e,t),this._vertexAttributeArrayDivisor.set(e,t))},e.prototype.freeTextureUnit=function(e){e.gl&&e.gl.textureUnit>-1&&(this._freeUnits.unshift(e.gl.textureUnit),e.gl.textureUnit=-1)},e.prototype.setActiveTextureUnit=function(e){this._activeTextureUnit!==e&&(this._activeTextureUnit=e,this.gl.activeTexture(e))},e.prototype.setClearColor=function(e){r.compare4(e,this._clearColor)||(this._clearColor=r.copy4(e),this.applyClearColor())},e.prototype.setProxy=function(e){this.glProxy=e},e.prototype.setScissor=function(e){e?(this._scissorTestEnabled||(this._scissorTestEnabled=!0,this.gl.enable(this.gl.SCISSOR_TEST)),e.x===this._scissorBounds.x&&e.y===this._scissorBounds.y&&e.width===this._scissorBounds.width&&e.height===this._scissorBounds.height||(this._scissorBounds=e,this.applyScissorBounds())):this._scissorTestEnabled&&(this._scissorTestEnabled=!1,this.gl.disable(this.gl.SCISSOR_TEST))},e.prototype.setViewport=function(e,t,n,r){e===this._viewport.x&&t===this._viewport.y&&n===this._viewport.width&&r===this._viewport.height||(this._viewport={x:e,y:t,width:n,height:r},this.applyViewport())},e.prototype.useProgram=function(e){this._currentProgram!==e&&(this._currentProgram=e,this.gl.useProgram(this._currentProgram))},e.prototype.useMaterial=function(e){if(!e.gl){if(!this.glProxy.compileMaterial(e))return!1;if(!e.gl)return!1}return!!e.gl.programId&&(this.useProgram(e.gl.programId),this.syncMaterial(e),!0)},e.prototype.useRenderTarget=function(e){return e?!!e.gl&&(this.bindFBO(e.gl.fboId),!0):(this.bindFBO(null),!0)},e.prototype.syncMaterial=function(e){var t=this,n=this.gl,r=Boolean(e.depthWrite);this._depthMask!==r&&(this._depthMask=r,n.depthMask(this._depthMask)),this._depthTestEnabled!==e.depthTest&&(this._depthTestEnabled=e.depthTest,this._depthTestEnabled?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST)),this._depthFunc!==e.depthFunc&&(this._depthFunc=e.depthFunc,this.applyDepthFunc()),e.blending?(this._blendingEnabled||n.enable(n.BLEND),this._blendDstFactor===e.blending.blendDst&&this._blendSrcFactor===e.blending.blendSrc&&this._blendEquation===e.blending.blendEquation||(this._blendDstFactor=e.blending.blendDst||this._blendDstFactor,this._blendSrcFactor=e.blending.blendSrc||this._blendSrcFactor,this._blendEquation=e.blending.blendEquation||this._blendEquation,this.applyBlendFactors())):this._blendingEnabled&&n.disable(n.BLEND),this._cullFace!==e.culling&&(this._cullFace=e.culling,this.applyCullFace()),this._colorMask[0]===e.colorWrite[0]&&this._colorMask[1]===e.colorWrite[1]&&this._colorMask[2]===e.colorWrite[2]&&this._colorMask[3]===e.colorWrite[3]||(this._colorMask=e.colorWrite,this.applyColorMask()),this._ditheringEnabled!==e.dithering&&(this._ditheringEnabled=e.dithering,this._ditheringEnabled?n.enable(n.DITHER):n.disable(n.DITHER)),this._currentUniforms=e.uniforms;var i=!0;return!!this._currentProgram&&(Object.entries(e.uniforms).forEach((function(e){var n=e[0],r=e[1];if(t._currentProgram){r.gl||(r.gl=new Map);var o=r.gl.get(t._currentProgram);if(!o){var a=t.gl.getUniformLocation(t._currentProgram,n);if(!a)return console.warn(t.debugContext,"A Material specified a uniform "+n+", but none was found in the current program."),void(i=!1);o={location:a},r.gl.set(t._currentProgram,o)}t.uploadUniform(o.location,r)}})),i?!(this._textureWillBeUsed.size>0&&!this.applyUsedTextures()):(console.warn(e.vertexShader),console.warn(e.fragmentShader),!1))},e.prototype.uploadUniform=function(e,t){var n;switch(t.type){case s.MaterialUniformType.FLOAT:n=t.value,this.gl.uniform1f(e,n);break;case s.MaterialUniformType.VEC2:n=t.value,this.gl.uniform2f(e,n[0],n[1]);break;case s.MaterialUniformType.VEC3:n=t.value,this.gl.uniform3f(e,n[0],n[1],n[2]);break;case s.MaterialUniformType.VEC4:n=t.value,this.gl.uniform4f(e,n[0],n[1],n[2],n[3]);break;case s.MaterialUniformType.VEC4_ARRAY:n=t.value,this.gl.uniform4fv(e,r.flatten4(n));break;case s.MaterialUniformType.MATRIX3x3:n=t.value,this.gl.uniformMatrix3fv(e,!1,n);break;case s.MaterialUniformType.MATRIX4x4:n=t.value,this.gl.uniformMatrix4fv(e,!1,n);break;case s.MaterialUniformType.TEXTURE:n=t.value,this.willUseTextureUnit(n,e);break;default:console.warn(this.debugContext,"A uniform specified an unrecognized type. It will not sync with the GPU:",t)}},e.prototype.applyUsedTextures=function(){var e=this,t=this.assignTextureUnits(Array.from(this._textureWillBeUsed.keys()));t.forEach((function(t){t.gl?t.gl.textureUnit=e.gl.TEXTURE0:t.gl={textureId:null,textureUnit:e.gl.TEXTURE0,proxy:e.glProxy}}));var n=new Map,r=new Set;return this._textureWillBeUsed.forEach((function(e,t){e instanceof a.RenderTarget?r.add(e):n.set(t,e)})),r.forEach((function(n){n.getTextures().some((function(n){return!(t.indexOf(n)<0)||(e.glProxy.updateTexture(n),!1)}))?console.warn(e.debugContext,"A RenderTarget can not be used because all of it's textures could not be compiled."):e.glProxy.compileRenderTarget(n)})),n.forEach((function(n,r){t.indexOf(r)<0?(e.glProxy.updateTexture(r),n.forEach((function(t){e.uploadTextureToUniform(t,r)}))):n.forEach((function(t){e.gl.uniform1i(t,i.textureUnitToIndex(e.gl,0))}))})),this._textureWillBeUsed.clear(),!0},e.prototype.assignTextureUnits=function(e){var t=[],n=[];for(e.forEach((function(e){!e.gl||e.gl.textureUnit<0?t.push(e):n.push(e)}));this._freeUnits.length>0&&t.length>0;){if(o=t.shift())void 0!==(a=this._freeUnits.shift())?(o.gl?o.gl.textureUnit=a:o.gl={textureId:null,textureUnit:a,proxy:this.glProxy},n.push(o)):t.unshift(o)}if(t.length<=0)return t;c("WARNING: Too many textures in use are causing texture units to be swapped. Doing this occasionally is fine, but handling this on a frame loop can have serious performance concerns.");var r=new Map;this._textureUnitToTexture.forEach((function(e){e&&r.set(e,!1)})),n.forEach((function(e){r.set(e,!0)}));var i=[];if(r.forEach((function(e,t){e||i.push(t)})),0===i.length)return console.warn(this.debugContext,"There are too many textures being used for a single draw call. These textures will not be utilized on the GPU",t),t;for(;i.length>0&&t.length>0;){var o,a;if(o=t.shift())void 0===(a=i.shift())||!a.gl||a.gl.textureUnit<0?t.unshift(o):(o.gl?o.gl.textureUnit=a.gl.textureUnit:o.gl={textureId:null,textureUnit:a.gl.textureUnit,proxy:this.glProxy},n.push(o))}return t.length>0&&console.warn(this.debugContext,"There are too many textures being used for a single draw call. These textures will not be utilized on the GPU",t),t},e.prototype.uploadTextureToUniform=function(e,t){t.gl&&t.gl.textureUnit>=0?this.gl.uniform1i(e,i.textureUnitToIndex(this.gl,t.gl.textureUnit)):console.warn(this.debugContext,"Attempted to set a Texture Object to a uniform, but the Texture object did not have a valid texture unit.",t)},e.prototype.willUseTextureUnit=function(e,t){var n=this._textureWillBeUsed.get(e);t instanceof a.RenderTarget?n?n instanceof a.RenderTarget&&n!==t&&console.warn(this.debugContext,"A Texture is attempting to be used by two different render targets in a single draw."):this._textureWillBeUsed.set(e,t):n?n instanceof a.RenderTarget?console.warn(this.debugContext,"A texture in a single draw is attempting to attach to a uniform AND a render target which is invalid."):n.add(t):this._textureWillBeUsed.set(e,new Set([t]))},e.prototype.syncState=function(){var e=this.gl;this._blendingEnabled?e.enable(e.BLEND):e.disable(e.BLEND),this._ditheringEnabled?e.enable(e.DITHER):e.disable(e.DITHER),this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.setActiveTextureUnit(this._activeTextureUnit),this.applyClearColor(),this.applyCullFace(),this.applyBlendFactors(),this.applyBlendEquation(),this.applyColorMask(),this.applyDepthFunc(),this.applyScissorBounds(),this.applyViewport(),e.depthMask(this._depthMask)},e.prototype.applyClearColor=function(){this.gl.clearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3])},e.prototype.applyDepthFunc=function(){var e=this.gl;switch(this._depthFunc){case o.GLSettings.Material.DepthFunctions.ALWAYS:e.depthFunc(e.ALWAYS);break;case o.GLSettings.Material.DepthFunctions.EQUAL:e.depthFunc(e.EQUAL);break;case o.GLSettings.Material.DepthFunctions.GREATER:e.depthFunc(e.GREATER);break;case o.GLSettings.Material.DepthFunctions.GREATER_OR_EQUAL:e.depthFunc(e.GEQUAL);break;case o.GLSettings.Material.DepthFunctions.LESS:e.depthFunc(e.LESS);break;case o.GLSettings.Material.DepthFunctions.LESS_OR_EQUAL:e.depthFunc(e.LEQUAL);break;case o.GLSettings.Material.DepthFunctions.NEVER:e.depthFunc(e.NEVER);break;case o.GLSettings.Material.DepthFunctions.NOTEQUAL:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.ALWAYS)}},e.prototype.applyScissorBounds=function(){this.gl.scissor(this._scissorBounds.x,this._scissorBounds.y,this._scissorBounds.width,this._scissorBounds.height)},e.prototype.applyColorMask=function(){this.gl.colorMask(this.colorMask[0]||!1,this.colorMask[1]||!1,this.colorMask[2]||!1,this.colorMask[3]||!1)},e.prototype.applyBlendEquation=function(){var e=this.gl;switch(this._blendEquation){case o.GLSettings.Material.BlendingEquations.Add:e.blendEquation(e.FUNC_ADD);break;case o.GLSettings.Material.BlendingEquations.Subtract:e.blendEquation(e.FUNC_SUBTRACT);break;case o.GLSettings.Material.BlendingEquations.ReverseSubtract:e.blendEquation(e.FUNC_REVERSE_SUBTRACT)}},e.prototype.applyBlendFactors=function(){var e,t,n=this.gl;switch(this._blendDstFactor){case o.GLSettings.Material.BlendingDstFactor.DstAlpha:e=n.BLEND_DST_ALPHA;break;case o.GLSettings.Material.BlendingDstFactor.DstColor:e=n.BLEND_DST_RGB;break;case o.GLSettings.Material.BlendingDstFactor.One:e=n.ONE;break;case o.GLSettings.Material.BlendingDstFactor.OneMinusDstAlpha:e=n.ONE_MINUS_DST_ALPHA;break;case o.GLSettings.Material.BlendingDstFactor.OneMinusDstColor:e=n.ONE_MINUS_DST_COLOR;break;case o.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha:e=n.ONE_MINUS_SRC_ALPHA;break;case o.GLSettings.Material.BlendingDstFactor.OneMinusSrcColor:e=n.ONE_MINUS_SRC_COLOR;break;case o.GLSettings.Material.BlendingDstFactor.SrcAlpha:e=n.SRC_ALPHA;break;case o.GLSettings.Material.BlendingDstFactor.SrcColor:e=n.SRC_COLOR;break;case o.GLSettings.Material.BlendingDstFactor.Zero:e=n.ZERO;break;default:e=n.ONE}switch(this._blendSrcFactor){case o.GLSettings.Material.BlendingDstFactor.DstAlpha:t=n.BLEND_DST_ALPHA;break;case o.GLSettings.Material.BlendingDstFactor.DstColor:t=n.BLEND_DST_RGB;break;case o.GLSettings.Material.BlendingDstFactor.One:t=n.ONE;break;case o.GLSettings.Material.BlendingDstFactor.OneMinusDstAlpha:t=n.ONE_MINUS_DST_ALPHA;break;case o.GLSettings.Material.BlendingDstFactor.OneMinusDstColor:t=n.ONE_MINUS_DST_COLOR;break;case o.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha:t=n.ONE_MINUS_SRC_ALPHA;break;case o.GLSettings.Material.BlendingDstFactor.OneMinusSrcColor:t=n.ONE_MINUS_SRC_COLOR;break;case o.GLSettings.Material.BlendingDstFactor.SrcAlpha:t=n.SRC_ALPHA;break;case o.GLSettings.Material.BlendingDstFactor.SrcColor:t=n.SRC_COLOR;break;case o.GLSettings.Material.BlendingDstFactor.Zero:t=n.ZERO;break;case o.GLSettings.Material.BlendingSrcFactor.SrcAlphaSaturate:t=n.SRC_ALPHA_SATURATE;break;default:t=n.ONE}n.blendFunc(t,e)},e.prototype.applyCullFace=function(){var e=this.gl;switch(this._cullFace!==o.GLSettings.Material.CullSide.NONE&&e.enable(e.CULL_FACE),this._cullFace){case o.GLSettings.Material.CullSide.CW:e.frontFace(e.CW),e.cullFace(e.FRONT);break;case o.GLSettings.Material.CullSide.CCW:e.frontFace(e.CCW),e.cullFace(e.FRONT);break;case o.GLSettings.Material.CullSide.BOTH:e.frontFace(e.CW),e.cullFace(e.FRONT_AND_BACK);break;default:e.disable(e.CULL_FACE)}},e.prototype.applyViewport=function(){this.gl.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)},e}();t.GLState=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(22),o=function(){function e(e){this._uid=r.uid(),this._validFramebuffer=!1,this.retainTextureTargets=!1,this._splitRenderBuffers=null,this._buffers={color:Array.isArray(e.buffers.color)?e.buffers.color.slice(0):e.buffers.color,depth:e.buffers.depth,stencil:e.buffers.stencil},this._width=e.width||0,this._height=e.height||0,this.retainTextureTargets=e.retainTextureTargets||!1,this.getDimensions()}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffers",{get:function(){return{color:Array.isArray(this._buffers.color)?this._buffers.color.slice(0):this._buffers.color,depth:this._buffers.depth,stencil:this._buffers.stencil}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"validFramebuffer",{get:function(){return this._validFramebuffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"splitRenderBuffers",{get:function(){return this._splitRenderBuffers},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.gl&&this.gl.proxy.disposeRenderTarget(this)},e.prototype.getDimensions=function(){var e=this,t=[];if(this._buffers.color instanceof i.Texture&&t.push(this._buffers.color),Array.isArray(this._buffers.color)&&this._buffers.color.forEach((function(e){e instanceof i.Texture&&t.push(e)})),this._buffers.depth instanceof i.Texture&&t.push(this._buffers.depth),this._buffers.stencil instanceof i.Texture&&t.push(this._buffers.stencil),t.length>0&&t[0].data){var n=t[0].data,r=n.width,o=n.height;t.forEach((function(n){if(n.data){var i=n.data,a=i.width,s=i.height;a===r&&s===o||(console.warn("Texture applied to the render target is invalid as it does not match dimensions of all textures applied:",n,t,"The texture will be removed as a target for the render target"),e.removeTextureFromBuffer(n))}})),this._width=r,this._height=o}else this._width&&this._height||console.warn("A RenderTarget was not able to establish valid dimensions. This target had no texture buffers and did not specify valid width and height values.",this)},e.prototype.getTextures=function(){var e=[];return Array.isArray(this.buffers.color)?this.buffers.color.forEach((function(t){t instanceof i.Texture&&e.push(t)})):this.buffers.color instanceof i.Texture&&e.push(this.buffers.color),this.buffers.depth instanceof i.Texture&&e.push(this.buffers.depth),this.buffers.stencil instanceof i.Texture&&e.push(this.buffers.stencil),e},e.prototype.removeTextureFromBuffer=function(e){if(Array.isArray(this._buffers.color)){var t=this._buffers.color.indexOf(e);t>-1&&this._buffers.color.splice(t,1)}else this._buffers.color===e&&delete this._buffers.color;this._buffers.depth===e&&delete this._buffers.depth,this._buffers.stencil===e&&delete this._buffers.stencil},e.prototype.setSize=function(e,t){this.dispose(),this._width=e,this._height=t,this.getTextures().forEach((function(n){n.data={buffer:null,height:t,width:e}}))},e.prototype.setAsValid=function(){this._validFramebuffer=!0},e}();t.RenderTarget=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(65),i=n(66),o=n(23),a=function(){function e(e){this.state={clearMask:[!1,!1,!1],currentRenderTarget:null,displaySize:[1,1],pixelRatio:1,renderSize:[1,1]},this.options=Object.assign({alpha:!1,antialias:!1,preserveDrawingBuffer:!1},e),this.options.canvas||console.warn("WebGLRenderer ERROR: A canvas is REQUIRED as a parameter."),this.getContext()}return Object.defineProperty(e.prototype,"debugContext",{set:function(e){this.glProxy&&(this.glProxy.debugContext=e),this.glState&&(this.glState.debugContext=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gl",{get:function(){return this._gl},enumerable:!0,configurable:!0}),e.prototype.clear=function(e,t,n){var r=this.state.clearMask;this.state.clearMask=[r[0]||e||!1,r[1]||t||!1,r[2]||n||!1]},e.prototype.clearColor=function(e){e&&this.glState.setClearColor(e)},e.prototype.dispose=function(){},e.prototype.getContext=function(){if(this._gl)return this._gl;var e=r.GLProxy.getContext(this.options.canvas,{alpha:this.options.alpha||!1,antialias:this.options.antialias||!1,premultipliedAlpha:this.options.premultipliedAlpha||!1,preserveDrawingBuffer:this.options.preserveDrawingBuffer||!1});return e.context?(this._gl=e.context,this.glState=new i.GLState(e.context,e.extensions),this.glProxy=new r.GLProxy(e.context,this.glState,e.extensions),this.glState.setProxy(this.glProxy),this.glState.syncState()):this.options.onNoContext?this.options.onNoContext():console.warn("No context was able to be produced, and the handler onNoContext was not implemented for such cases."),this._gl},e.prototype.getDisplaySize=function(){return this.state.displaySize},e.prototype.getPixelRatio=function(){return this.state.pixelRatio},e.prototype.getRenderSize=function(){return this.state.renderSize},e.prototype.getFullViewport=function(){var e=this.state.currentRenderTarget;if(e)return{x:0,y:0,width:e.width,height:e.height};var t=this.getRenderSize();return{x:0,y:0,width:t[0],height:t[1]}},e.prototype.prepareAttribute=function(e,t,n){return this.glProxy.updateAttribute(t)?(this.glProxy.useAttribute(n,t,e),!0):(console.warn("Could not update attribute",t),!1)},e.prototype.render=function(e,t){var n=this;if(void 0===t&&(t=null),this.gl){this.setRenderTarget(t);var r=this.state.clearMask;if((r[0]||r[1]||r[2])&&(this.glProxy.clear(r[0],r[1],r[2]),this.state.clearMask=[!1,!1,!1]),!t||t.gl){var i=[];e.models.forEach((function(e){n.renderModel(e,i)})),i.forEach((function(t){e.remove(t)}))}else console.warn("FBO is not ready for drawing. Skipping the rendering of the scene and target:",{scene:e,target:t})}},e.prototype.renderModel=function(e,t){var n=e.geometry,r=e.material;if(this.glState.useMaterial(r)){var i=!0;n.attributes.forEach((function(e,t){i=this.prepareAttribute(n,e,t)&&i}),this),this.glState.applyVertexAttributeArrays(),i?this.glProxy.draw(e):(console.warn("Geometry was unable to update correctly, thus we are skipping the drawing of",e),t.push(e))}else console.warn("Could not utilize material. Skipping draw call for:",r,n),t.push(e)},e.prototype.readPixels=function(e,t,n,r,i){if(this.gl){var o=this.state.currentRenderTarget,a=!0;if(o&&(a=o.validFramebuffer),a)if(e=Math.max(0,e),t=Math.max(0,t),o){e+n>o.width&&(n=o.width-e),t+r>o.height&&(r=o.height-t);var s=o.height;this.gl.readPixels(e,s-t-r,n,r,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i)}else{var c=this.getRenderSize();s=c[1];e+n>c[0]&&(n=c[0]-e),t+r>c[1]&&(r=c[1]-t),this.gl.readPixels(e,s-t-r,n,r,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i)}else console.warn("Framebuffer is incomplete. Can not read pixels at this time.")}},e.prototype.setClearColor=function(e){this.glState.setClearColor(e)},e.prototype.setPixelRatio=function(e){var t=this.options.canvas,n=this.getDisplaySize();t.width=n[0]*e,t.height=n[1]*e,this.state.pixelRatio=e},e.prototype.setScissor=function(e,t){if(t=t||this.state.currentRenderTarget||void 0){var n=t.height;if(e){var r=e.x,i=e.y,o=e.width,a=e.height;this.glState.setScissor({x:r,y:n-i-a,width:o,height:a})}else this.glState.setScissor(null)}else{n=this.state.renderSize[1];if(e){r=e.x,i=e.y,o=e.width,a=e.height;this.glState.setScissor({x:r,y:n-i-a,width:o,height:a})}else this.glState.setScissor(null)}},e.prototype.setSize=function(e,t){var n=this.options.canvas,r=this.state.pixelRatio;n.width=Math.min(e*r,o.WebGLStat.MAX_TEXTURE_SIZE),n.height=Math.min(t*r,o.WebGLStat.MAX_TEXTURE_SIZE),n.style.width=e+"px",n.style.height=t+"px",this.state.renderSize=[n.width,n.height],this.state.displaySize=[e,t]},e.prototype.setRenderTarget=function(e){var t=this;this.state.currentRenderTarget!==e&&(!this.glState.useRenderTarget(e)&&e&&(e.getTextures().forEach((function(n){t.glState.willUseTextureUnit(n,e)})),this.glState.applyUsedTextures(),this.glProxy.compileRenderTarget(e)&&this.glState.useRenderTarget(e)),this.state.currentRenderTarget=e)},e.prototype.setViewport=function(e){var t=this.state.currentRenderTarget,n=e.x,r=e.y,i=e.width,o=e.height;if(t){var a=t.height;this.glState.setViewport(n,a-r-o,i,o)}else{a=this.state.renderSize[1];this.glState.setViewport(n,a-r-o,i,o)}},e}();t.WebGLRenderer=a},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(37),s=n(24),c=n(0),u=n(17),l=n(70),h=n(71),d=n(4)("performance");!function(e){e[e._16=16]="_16",e[e._32=32]="_32",e[e._64=64]="_64",e[e._128=128]="_128"}(t.FontGlyphRenderSize||(t.FontGlyphRenderSize={})),t.isFontResource=function(e){return e&&e.type===c.ResourceType.FONT},t.createFont=function(e){return r({key:"",type:c.ResourceType.FONT},e)};var f=function(){function e(){this.fontMaps=new Map,this.fontRenderer=new h.FontRenderer}return e.prototype.calculateMetrics=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,a,s,c;return o(this,(function(o){switch(o.label){case 0:if(d("Calculating metrics for requests"),!(n=this.fontMaps.get(e)))return[2];r=0,i=t.length,o.label=1;case 1:return r<i?(a=t[r],(s=a.metrics)?(s.layout=n.getStringLayout(s.text,s.fontSize,s.letterSpacing),s.maxWidth?(d("Calculating truncation for",s.text,s.maxWidth),c=s,[4,n.getTruncatedLayout(s.layout,s.truncation||"",s.maxWidth,s.fontSize,s.letterSpacing,this.fontRenderer)]):[3,3]):[3,3]):[3,4];case 2:c.layout=o.sent(),s.truncatedText=s.layout.text,o.label=3;case 3:return++r,[3,1];case 4:return[2]}}))}))},e.prototype.characterFilterToCharacters=function(e){for(var t=new Set,n="",r=0,i=e.length;r<i;++r){var o=e[r];t.has(o)||(t.add(o),n+=o)}return n},e.prototype.createFontMap=function(e){return i(this,void 0,void 0,(function(){var t,n,i,a;return o(this,(function(o){switch(o.label){case 0:return t=this.characterFilterToCharacters(e.characterFilter||""),i=e.fontSource,a=l.FontMapGlyphType.SDF,i&&(a=(s=i)&&void 0===s.type?l.FontMapGlyphType.BITMAP:i.type||a),n=new l.FontMap(r({},e,{glyphType:a})),[4,this.updateFontMapCharacters(t,n)];case 1:return o.sent(),this.fontMaps.set(e.key,n),[2,n]}var s}))}))},e.prototype.destroy=function(){this.fontMaps.forEach((function(e){return e.destroy()}))},e.prototype.destroyFontMap=function(e){var t=this.fontMaps.get(e);t&&t.destroy()},e.prototype.updateFontMap=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,a,s,c,u,l,h,d;return o(this,(function(o){switch(o.label){case 0:if(!(n=this.fontMaps.get(e)))return[2];for(r=[],i=new Set,h=0,d=t.length;h<d;++h)if((a=t[h]).character&&i.add(a.character),a.kerningPairs&&(r=r.concat(a.kerningPairs)),a.metrics&&a.metrics.truncation)for(s=a.metrics.truncation.replace(/\s/g,""),r.push(s),c=0,u=a.metrics.truncation.length;c<u;++c)i.add(s);for(h=0,d=r.length;h<d;++h)i.add(r[h]);return l="",i.forEach((function(e){return l+=e})),[4,this.updateFontMapCharacters(l,n)];case 1:return o.sent(),[4,this.updateKerningPairs(r,n)];case 2:for(o.sent(),h=0,d=t.length;h<d;++h)t[h].fontMap=n;return[2]}}))}))},e.prototype.updateKerningPairs=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return t?[4,this.fontRenderer.estimateKerning(e,t.fontString,t.fontSource.size,t.kerning,!t.spaceWidth)]:[2];case 1:return n=r.sent(),t.addKerning(n.pairs),t.spaceWidth=t.spaceWidth||n.spaceWidth,[2]}}))}))},e.prototype.updateFontMapCharacters=function(e,t){return i(this,void 0,void 0,(function(){var n,i,c,l,h,d,f,p;return o(this,(function(o){if(!t)return[2];if(n=t.texture,(i=t.findMissingCharacters(e)).length<=0)return[2];for(l in c=this.fontRenderer.makeBitmapGlyphs(i,t.fontString,t.fontSource.size))if(h=c[l],n.data){if(d=new a.Bounds({x:0,y:0,width:h.glyph.width,height:h.glyph.height}),f=new u.SubTexture,!(p=t.packing.insert({data:f,bounds:d})))return console.warn("Font map is full and could not pack in any more glyphs"),[2];s.PackNode.applyToSubTexture(t.packing,p,f,void 0,!0),n.update(h.glyph,r({},p.bounds,{y:t.packing.bounds.height-p.bounds.y-p.bounds.height})),f?t.registerGlyph(l,f):console.warn("Could not generate a subtexture for the font map registration.")}else console.warn("Can not update font map as the maps texture data is not defined.");return[2]}))}))},e.prototype.getPrerenderedImageData=function(e,t,n){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){switch(i.label){case 0:return r=[],n.forEach((function(n){var i=e.glyphs[n];if(i||(i=e.errorGlyph),!e.errorGlyph)return console.warn("The prerendered source provided did NOT provide a proper glyph for rendering when a glyph could not be located."),[];var o,a=new Image,s=new Promise((function(e){return o=e}));return a.onload=function(){var e=document.createElement("canvas"),n=e.getContext("2d");if(n){e.width=t,e.height=t,n.drawImage(a,0,0,t,t);var r=n.getImageData(0,0,t,t);o(r)}},a.onerror=function(){console.warn("There was an issue with loading the glyph data for character:",n),o(null)},a.src=e.glyphs[n],r.push(s),[]})),[4,Promise.all(r)];case 1:return[2,i.sent()]}}))}))},e}();t.FontManager=f},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var c,u=n(6),l=n(3),h=n(0),d=n(21),f=n(24),p=n(4)("performance");!function(e){e[e.BITMAP=0]="BITMAP",e[e.SDF=1]="SDF",e[e.MSDF=2]="MSDF"}(c=t.FontMapGlyphType||(t.FontMapGlyphType={}));var g=function(e){function t(t){var n=e.call(this,t)||this;n.dynamic=!1,n.glyphMap={},n.kerning={},n.spaceWidth=0,n.type=h.ResourceType.FONT,n.dynamic=t.dynamic||!1,n.fontSource=t.fontSource,t.characters&&t.characters.forEach((function(e){n.doRegisterGlyph(e[0],e[1])}));var r=t.fontMapSize?t.fontMapSize:[h.TextureSize._1024,h.TextureSize._1024];return n.makeGlyphTypeTextureSettings(t.glyphType),n.createTexture(r),n.packing=new f.PackNode(0,0,r[0],r[1]),n.addCachedKerning(),n}return i(t,e),Object.defineProperty(t.prototype,"fontString",{get:function(){return this.fontSource.size+"px "+this.fontSource.family},enumerable:!0,configurable:!0}),t.prototype.getKerningCacheName=function(){return"__deltav_kerning_cache_"+this.fontSource.family+"__"},t.prototype.addCachedKerning=function(){if(this.fontSource.localKerningCache){var e=localStorage.getItem(this.getKerningCacheName());if(e){p("Loading cached kerning items:",this.getKerningCacheName());try{var t=JSON.parse(e),n=0;for(var r in t){var i="string"==typeof r&&1===r.length;if(i){var o=t[r],a=this.kerning[r]||{};for(var s in this.kerning[r]=a,o)(i="string"==typeof r&&1===r.length)&&(a[s]=o[s],n++)}}p("Found kerning items in the cache!","Count:",n)}catch(e){}}}},t.prototype.addKerning=function(e){var t=!1;for(var n in e){var r=e[n],i=this.kerning[n]||{};for(var o in this.kerning[n]||(t=!0),this.kerning[n]=i,r)i[o]||(t=!0),i[o]=r[o]}if(t&&this.fontSource.localKerningCache)try{p("Storing kerning info in cache...");var a=JSON.stringify(this.kerning);localStorage.setItem(this.getKerningCacheName(),a)}catch(e){p("Could not cache kerning info")}},t.prototype.createTexture=function(e){var t;this.texture||(t=this.textureSettings?o({generateMipMaps:!0,premultiplyAlpha:!0},this.textureSettings):{generateMipMaps:!0,premultiplyAlpha:!0},this.texture=new u.Texture(o({data:{width:e[0],height:e[1],buffer:null}},t)))},t.prototype.destroy=function(){this.texture.dispose()},t.prototype.doRegisterGlyph=function(e,t){var n=e[0];this.glyphMap[n]?console.warn("A Glyph is already registered with a rendering"):this.glyphMap[n]=t},t.prototype.findMissingCharacters=function(e){for(var t=new Set,n="",r=0,i=e.length;r<i;++r){var o=e[r];this.glyphMap[o]||t.has(o)||(t.add(o),n+=o)}return n},t.prototype.getGlyphTexture=function(e){return this.glyphMap[e[0]]||null},t.prototype.getGlyphKerning=function(e,t){var n=this.kerning[e];return n&&n[t]||[0,0]},t.prototype.getGlyphWidth=function(e,t,n){var r=e.positions[t],i=e.positions[n];if(!t||!n)return 0;var o=this.glyphMap[e.glyphs[n]];return o?i[0]+o.pixelWidth-r[0]:0},t.prototype.getTruncatedLayout=function(e,t,n,r,i,o){return a(this,void 0,void 0,(function(){var a,c,u,l,d,f,p,g,v,y,m,b,w,x,T;return s(this,(function(s){switch(s.label){case 0:if(!(e.size[0]>n))return[3,5];for(a="",c=0,w=0,x=t.length;w<x;++w)c+=this.glyphMap[t[w]].pixelWidth;if(c>n)return[2,{fontScale:1,glyphs:"",positions:[],size:[0,0],text:""}];for(u=0,l=e.positions.length,d=0,f=0,p="";u!==l;){if(d=Math.floor((l-u)/2)+u,p=e.glyphs[d],(f=e.positions[d][0]+this.glyphMap[p].pixelWidth+c)>n)l=d;else{if(!(f<n))break;u=d}if(Math.abs(u-l)<=1){if(f<n)break;for(;f>n&&d>=0;)d--,f=e.positions[d][0]+this.glyphMap[p].pixelWidth+c;break}}if(!((f=e.positions[d][0]+this.glyphMap[p].pixelWidth+c)<n))return[3,3];for(g=0,v=0,w=0,x=e.text.length;w<x&&g<=d;++w)y=e.text[w],v++,h.isWhiteSpace(y)||g++;for(m=e.text[v-1],b=void 0,w=0,x=t.length;w<x;++w)if(!h.isWhiteSpace(t[w])){b=t[w];break}return m&&b&&!this.kerning[m][b]?[4,o.estimateKerning([m+b],this.fontString,this.fontSource.size,this.kerning,!1)]:[3,2];case 1:T=s.sent(),this.addKerning(T.pairs),s.label=2;case 2:return a=""+e.text.substr(0,v)+t,[3,4];case 3:a=t,s.label=4;case 4:return[2,this.getStringLayout(a,r,i)];case 5:return[2,e]}}))}))},t.prototype.getStringWidth=function(e,t,n){var r=e.text,i=0,o=r.length;if("string"==typeof t){var a=r.indexOf(t);if(a<0)return 0;o=(i=a)+t.length}else i=t;void 0!==n&&(o=n);for(var s=0,c=Math.min(r.length,i),u=Math.min(r.length,o);s<c;++s)h.isWhiteSpace(r[s])&&(i--,o--);for(;s<u;++s)h.isWhiteSpace(r[s])&&o--;var l=this.glyphMap[e.text[o]||""];return l?(e.positions[o]||[0,0])[0]-(e.positions[i]||[0,0])[0]+l.pixelWidth:0},t.prototype.getStringLayout=function(e,t,n){for(var r,i,o=[],a="",s=t/this.fontSource.size,c=Number.MAX_SAFE_INTEGER,u=0,d=0,f=[0,0],p=this.spaceWidth,g=0,v="",y=0,m=e.length;y<m;++y){var b=e[y];h.isWhiteSpace(b)?g++:(r=[0,0],v&&(r=this.kerning[v][b]||[0,0]),f=l.add2(l.add2(f,l.scale2(r,s)),[g*p*s+(0===y?0:n),0]),o.push([f[0],f[1]]),a+=b,i=this.glyphMap[b],c=Math.min(f[1],c),u=Math.max(f[1]+i.pixelHeight*s,u),v=b,d=f[0]+i.pixelWidth*s,g=0)}var w=[d,u-c];for(y=0,m=o.length;y<m;++y)(f=o[y])[1]-=c;return{fontScale:s,glyphs:a,positions:o,size:w,text:e}},t.prototype.makeGlyphTypeTextureSettings=function(e){switch(e){case c.BITMAP:this.textureSettings={magFilter:u.GLSettings.Texture.TextureMagFilter.Linear,minFilter:u.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear,format:u.GLSettings.Texture.TexelDataType.LuminanceAlpha};break;case c.SDF:this.textureSettings={magFilter:u.GLSettings.Texture.TextureMagFilter.Linear,minFilter:u.GLSettings.Texture.TextureMinFilter.Linear,format:u.GLSettings.Texture.TexelDataType.Luminance};break;case c.MSDF:this.textureSettings={magFilter:u.GLSettings.Texture.TextureMagFilter.Linear,minFilter:u.GLSettings.Texture.TextureMinFilter.Linear,format:u.GLSettings.Texture.TexelDataType.RGB}}},t.prototype.registerGlyph=function(e,t){this.dynamic?this.doRegisterGlyph(e,t):console.warn("Attempted to register a new glyph with a non-dynamic FontMap")},t.prototype.supportsKerning=function(e){for(var t=1,n=e.length;t<n;++t){var r=e[t],i=e[t-1];if(!this.kerning[i])return!1;if(!this.kerning[i][r])return!1}return!0},t}(d.IdentifyByKey);t.FontMap=g},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(23),a=n(11),s=n(72),c=n(128),u=n(4)("performance"),l=Math.floor;function h(e,t,n,h){return r(this,void 0,void 0,(function(){var r,d,f,p,g,v,y,m,b,w,x,T,_,E,A,M,S,O,I,P,R,L,C,N,D,B,z,k,j,F,U,V,G,W,H,q,X,Q,Y,K,$,Z,J,ee,te,ne,re,ie,oe,ae,se,ce,ue,le,he,de,fe,pe,ge,ve;return i(this,(function(i){switch(i.label){case 0:for(r="http://www.w3.org/2000/svg",d=o.WebGLStat.MAX_TEXTURE_SIZE/window.devicePixelRatio,p=1.3*t,g=l(d/(f=2*t)),(v=document.createElementNS(r,"svg")).setAttribute("width",d+"px"),v.style.font=e,v.style.position="relative",v.style.left="0px",v.style.top="0px",y=[],m=Math.floor(d/p),b=0,w=0,x=0,E=0;w<n.all.length;){for(z=document.createElementNS(r,"g"),T=z,b=Math.floor(y.length/m),z.setAttribute("transform","translate(0, "+(y.length-b*m)*p+")"),y.push(z),A=d,x=0;x<g&&w<n.all.length;x++)(L=document.createElementNS(r,"text")).setAttribute("x",""+x*f),L.setAttribute("dy","1em"),le=n.all[w],w++,M=le[0],S=le[1],N=document.createElementNS(r,"tspan"),B=document.createElementNS(r,"tspan"),N.setAttribute("fill","#ff0000"),B.setAttribute("fill","#0000ff"),N.textContent=M,B.textContent=S,L.appendChild(N),L.appendChild(B),z.appendChild(L),A-=f;A>=0?((L=document.createElementNS(r,"text")).setAttribute("width",A+"px"),z.appendChild(L),_=L):_=null,E=A}for(O=[],ce=0;ce<n.all.length;ce++)O.push([Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER]);return I=0,P=!1,h?(R="M",(L=document.createElementNS(r,"text")).setAttribute("dy","1em"),L.style.width=""+f,L.style.height=""+p,L.setAttribute("x",""+f*x),L.style.font=e,[4,s.renderGlyph(R,128,128,e)]):[3,2];case 1:(C=i.sent())&&(I=C.size[0],N=document.createElementNS(r,"tspan"),D=document.createElementNS(r,"tspan"),B=document.createElementNS(r,"tspan"),N.setAttribute("fill","#ff0000"),B.setAttribute("fill","#0000ff"),N.textContent=R,B.textContent=R,D.textContent=" ",L.appendChild(N),L.appendChild(D),L.appendChild(B),x<g&&T?(T.appendChild(L),E-=f,_&&(_.remove(),E>0&&(T.style.width=E+"px",T.appendChild(_)))):(z=document.createElement("g"),b=Math.floor(y.length/m),z.setAttribute("transform","translate(0, "+(y.length-b*m)*p+")"),(T=z).appendChild(L),y.push(z),_=document.createElementNS(r,"text"),z.appendChild(_)),O.push([Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER]),P=!0),i.label=2;case 2:k=y.length*p,j=Math.ceil(k/d),F=null,u("Rendering table canvas batches for font kerning analysis",n,y),ce=0,i.label=3;case 3:if(!(ce<j))return[3,8];for(U=y.splice(0,m),V=U.length*p,v.setAttribute("height",V+"px");v.lastElementChild;)v.lastElementChild.remove();for(G=0,W=U.length;G<W;++G)H=U[G],v.appendChild(H);return F?[3,5]:[4,c.svgToData(v)];case 4:return F=i.sent(),[3,7];case 5:return[4,c.svgToData(v)];case 6:if(!(q=i.sent()))return console.warn("Font Renderer: Could not generate image data for analyzing font kerning"),[3,7];(X=new Uint8ClampedArray(F.data.length+q.data.length)).set(F.data),X.set(q.data,F.data.length),F=new ImageData(X,d*window.devicePixelRatio,F.height+q.height),i.label=7;case 7:return++ce,[3,3];case 8:if(u("Analyzing rendered data",F),Q=f*window.devicePixelRatio,Y=p*window.devicePixelRatio,F){for(K=F.data,$=void 0,Z=void 0,J=void 0,ee=void 0,te=void 0,ne=void 0,re=0,ie=F.height;re<ie;re++)for(oe=0,ae=F.width;oe<ae;oe++)Z=K[($=4*(ae*re+oe))+0],J=K[$+1],ee=K[$+2],(ne=l(re/Y)*g+l(oe/Q))<O.length&&(te=O[ne],Z>0&&0===J&&0===ee&&(oe<te[0]&&(te[0]=oe),re<te[1]&&(te[1]=re)),0===Z&&0===J&&ee>0&&(oe<te[2]&&(te[2]=oe),re<te[3]&&(te[3]=re)));for(P&&(se=O.pop())&&(pe=[se[2]-se[0],0],ve=a.scale2(pe,1/window.devicePixelRatio),n.spaceWidth=Math.ceil(ve[0])-I),ce=0,ue=O.length;ce<ue;ce++)le=n.all[ce],he=le[0],de=le[1],fe=O[ce],pe=[fe[2]-fe[0],fe[3]-fe[1]],(ge=n.pairs[he])&&(ve=a.scale2(pe,1/window.devicePixelRatio),ge[de]=[Math.ceil(ve[0]),ve[1]])}else console.warn("html2canvas did not produce a valid canvas context to analyze");return u("Kerning rendering analysis complete",n.pairs),[2]}}))}))}function d(e,t,n){e=e.replace(/\s/g,"");for(var r=n&&n.all||[],i=n&&n.pairs||{},o=0;o<e.length-1;o++){var a=e[o],s=e[o+1],c=i[a];c||(c=i[a]={}),t[a]&&t[a][s]||c[s]||(c[s]=[0,0],r.push(""+a+s))}return{all:r,pairs:i,spaceWidth:0}}var f=function(){function e(){}return e.prototype.makeBitmapGlyphs=function(e,t,n){for(var r={},i=new Set,o=0,a=e.length;o<a;++o)i.add(e[o]);var c=Array.from(i.values());for(o=0,a=c.length;o<a;++o){var u=c[o],l=s.renderGlyph(u,2*n,2*n,t);l?r[u]={glyph:l.data,glyphIndex:o}:console.warn("Unable to render character",u,"to font map for rendering.")}return r},e.prototype.estimateKerning=function(e,t,n,o,a){return r(this,void 0,void 0,(function(){var r,s,c;return i(this,(function(i){switch(i.label){case 0:for(r={all:[],pairs:{},spaceWidth:0},u("Estimating Kerning for",e),s=0,c=e.length;s<c;++s)d(e[s],o,r);return r.all.length>0||a?[4,h(t,n,r,a)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2,r]}}))}))},e}();t.FontRenderer=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=Math.min,o=Math.max,a=document.createElement("canvas");t.renderGlyph=function(e,t,n,s){if(e=e[0],(a.width<t||a.height<n)&&(a.width=t,a.height=n),!r){var c=a.getContext("2d");if(!c)return null;r=c}r.clearRect(0,0,a.width,a.height),r.font=s,r.fillStyle="white",r.fillText(e,t/2,n/2);var u=function(e){for(var t=e.canvas,n=t.width,r=t.height,a=e.getImageData(0,0,n,r).data,s=!1,c=Number.MAX_SAFE_INTEGER,u=Number.MAX_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER,d=0;d<n;++d)for(var f=0;f<r;++f){a[f*(4*n)+4*d]>0&&(s=!0,c=i(c,f),u=i(u,d),l=o(l,d),h=o(h,f))}return s?(h+=2,l+=2,u-=1,c=o(c-=1,0),{minX:u=o(u,0),minY:c,maxX:l,maxY:h}):null}(r);if(!u)return{data:r.getImageData(0,0,1,1),size:[0,0]};var l=u.maxX-u.minX,h=u.maxY-u.minY;return{data:r.getImageData(u.minX,u.minY,l,h),size:[l,h]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.TEXCOORDS=0]="TEXCOORDS",e[e.IMAGE_SIZE=1]="IMAGE_SIZE"}(t.FontResourceRequestFetch||(t.FontResourceRequestFetch={}))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),s=n(7),c=n(75),u=n(131),l=n(48),h=n(24),d=n(17),f=n(4)("performance"),p=new d.SubTexture({aspectRatio:0,atlasBL:[0,0],atlasBR:[0,0],texture:null,atlasTL:[0,0],atlasTR:[0,0],heightOnAtlas:0,isValid:!1,pixelHeight:0,pixelWidth:0,widthOnAtlas:0});var g=function(){function e(){this.allAtlas=new Map}return e.prototype.createAtlas=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){return t=new l.Atlas(e),this.allAtlas.set(t.id,t),f("Atlas Created-> %o",t),[2,t]}))}))},e.prototype.destroy=function(){this.allAtlas.forEach((function(e){return e.destroy()}))},e.prototype.destroyAtlas=function(e){var t=this.allAtlas.get(e);t&&t.destroy()},e.prototype.setDefaultImage=function(e,t){return e=Object.assign(e,p,{atlasReferenceID:t})},e.prototype.draw=function(e,t){return i(this,void 0,Promise,(function(){var n,i,a,c,l,p,g;return o(this,(function(o){switch(o.label){case 0:return n=e.id,t.disposeResource?[2,!0]:e.resourceReferences.get(t.source)?[2,!0]:(t.texture=t.texture||new d.SubTexture,t.texture.isValid=!0,e.resourceReferences.set(t.source,{subtexture:t.texture,count:0}),[4,this.loadImage(t)]);case 1:if(i=o.sent(),a=t.texture,i&&((v=a)&&v.isValid&&v.pixelWidth&&v.pixelHeight)){if(c=new s.Bounds({bottom:a.pixelHeight,left:0,right:a.pixelWidth,top:0}),(l={data:a,bounds:c}).bounds.width+=1,l.bounds.height+=1,p=e.packing,!(g=p.insert(l))){if(!this.repackResources(e))return console.error("Repacking the atlas failed. Some resources may be in an undefined state. Consider making another atlas."),[2,!1];p=e.packing,g=p.insert(l)}return g?(g.data=a,h.PackNode.applyToSubTexture(p,g,a,{top:0,left:0,right:1,bottom:1}),a.texture=e.texture,a.source=i,a.atlasRegion=r({},g.bounds,{y:e.height-g.bounds.y-g.bounds.height}),e.texture.update(i,a.atlasRegion),i instanceof HTMLVideoElement&&(a.video={monitor:new u.VideoTextureMonitor(i,a)}),[2,!0]):(console.error("Could not fit resource into atlas",t),t.texture=this.setDefaultImage(a,n),[2,!1])}return a&&!a.isValid?f("Resource was invalidated during load:",t):console.error("Could not load resource:",t),t.texture&&(t.texture=this.setDefaultImage(t.texture,n)),[2,!1]}var v}))}))},e.prototype.getAtlasTexture=function(e){return this.allAtlas.get(e)},e.prototype.loadImage=function(e){return i(this,void 0,Promise,(function(){var t,n,r,i;return o(this,(function(o){switch(o.label){case 0:return t=e.texture||new d.SubTexture,n=e.source,e.texture=t,!1===e.texture.isValid?[2,null]:n instanceof HTMLImageElement?[4,new Promise((function(e){if(n instanceof HTMLImageElement){var r=n;if(r.width&&r.height)return c.ImageRasterizer.calculateImageSize(r),t.pixelWidth=r.width,t.pixelHeight=r.height,t.aspectRatio=r.width/r.height,void e(r);r?(r.onload=function(){t.pixelWidth=r.width,t.pixelHeight=r.height,t.aspectRatio=r.width/r.height,r.onload=null,e(r)},r.onerror=function(){r.onload=null,e(null)}):e(null)}}))]:[3,4];case 1:return(i=o.sent())&&void 0!==e.rasterizationScale&&1!==e.rasterizationScale?[4,c.ImageRasterizer.resizeImage(i,e.rasterizationScale||1)]:[3,3];case 2:i=o.sent(),o.label=3;case 3:return[2,i];case 4:return n instanceof HTMLVideoElement?0===n.videoHeight||0===n.videoWidth?(console.warn("Video requests to the atlas manager MUST have the video completely loaded and ready for loading","There are too many caveats to automate video loading at this low of a level to have it prepped properly for","use in the texture for all browsers. Consider handling video resources at the layer level to have them","prepped for use."),[2,null]):(t.pixelWidth=n.videoWidth,t.pixelHeight=n.videoHeight,t.aspectRatio=n.videoWidth/n.videoHeight,[2,n]):[3,5];case 5:return"string"!=typeof n?[3,9]:(r=n,[4,new Promise((function(e){var n=new Image;n.onload=function(){t.pixelWidth=n.width,t.pixelHeight=n.height,t.aspectRatio=n.width/n.height,n.onload=null,e(n)},n.onerror=function(){e(null)},n.src=r}))]);case 6:return(i=o.sent())&&void 0!==e.rasterizationScale&&1!==e.rasterizationScale?[4,c.ImageRasterizer.resizeImage(i,e.rasterizationScale||1)]:[3,8];case 7:i=o.sent(),o.label=8;case 8:return[3,12];case 9:return(i=n)&&void 0!==e.rasterizationScale&&1!==e.rasterizationScale?[4,c.ImageRasterizer.resizeImage(i,e.rasterizationScale||1)]:[3,11];case 10:i=o.sent(),o.label=11;case 11:return[2,i];case 12:return[2,null]}}))}))},e.prototype.repackResources=function(e){if(!this.renderer)return console.warn("Attempted to repack resources for an atlas, but no renderer has been specified for this manager yet."),!1;for(var t=[e.packing],n=[],r=0,i=new Map;r<t.length;){var o=t[r];r++,o.data&&o.data.texture&&(n.push(o),i.set(o.bounds,new s.Bounds(o.bounds))),o.child[0]&&t.push(o.child[0]),o.child[1]&&t.push(o.child[1])}if(n.sort((function(e,t){return Math.max(t.bounds.width,t.bounds.height)-Math.max(e.bounds.width,e.bounds.height)})),n.length<=0)return e.packing=new h.PackNode(0,0,e.width,e.height),!0;var c=new a.Texture(e.texture);c.data={buffer:new Uint8Array(e.width*e.height*4),width:e.width,height:e.height};for(var u=new h.PackNode(0,0,e.width,e.height),l=!1,f=0,p=n.length;f<p;++f){if((b=n[f]).data){b.bounds.x=0,b.bounds.y=0;var g=u.insert({bounds:b.bounds,data:b.data});g?h.PackNode.applyToSubTexture(u,g,b.data):(console.warn("When repacking the atlas, an existing node was unable to be repacked",b),l=!0)}else console.warn("Attempted to repack a node with no valid data.")}if(l)return!1;var v=new Float32Array(2*n.length*6),y=new Float32Array(2*n.length*6),m=new d.SubTexture;for(f=0,p=n.length;f<p;++f){var b=n[f],w=i.get(b.bounds),x=b.data;if(w&&x){h.PackNode.applyToSubTexture(u,w,m);var T=2*f*6;v[T]=2*x.atlasTL[0]-1,v[T+1]=2*x.atlasTL[1]-1,v[T+2]=2*x.atlasTR[0]-1,v[T+3]=2*x.atlasTR[1]-1,v[T+4]=2*x.atlasBL[0]-1,v[T+5]=2*x.atlasBL[1]-1,v[T+6]=2*x.atlasTR[0]-1,v[T+7]=2*x.atlasTR[1]-1,v[T+8]=2*x.atlasBR[0]-1,v[T+9]=2*x.atlasBR[1]-1,v[T+10]=2*x.atlasBL[0]-1,v[T+11]=2*x.atlasBL[1]-1,y[T]=m.atlasTL[0],y[T+1]=m.atlasTL[1],y[T+2]=m.atlasTR[0],y[T+3]=m.atlasTR[1],y[T+4]=m.atlasBL[0],y[T+5]=m.atlasBL[1],y[T+6]=m.atlasTR[0],y[T+7]=m.atlasTR[1],y[T+8]=m.atlasBR[0],y[T+9]=m.atlasBR[1],y[T+10]=m.atlasBL[0],y[T+11]=m.atlasBL[1],x.texture=c}else console.warn("While repacking there was an issue finding the previous bounds and the next texture to use",w,x)}var _=new a.Geometry,E=new a.Attribute(v,2),A=new a.Attribute(y,2);_.addAttribute("position",E),_.addAttribute("texCoord",A);var M=new a.Material({culling:a.GLSettings.Material.CullSide.NONE,uniforms:{texture:{type:a.MaterialUniformType.TEXTURE,value:e.texture}},fragmentShader:"\n        precision highp float;\n\n        uniform sampler2D texture;\n        varying vec2 _texCoord;\n\n        void main() {\n          gl_FragColor = texture2D(texture, _texCoord);\n        }\n      ",vertexShader:"\n        precision highp float;\n\n        attribute vec2 position;\n        attribute vec2 texCoord;\n        varying vec2 _texCoord;\n\n        void main() {\n          _texCoord = texCoord;\n          gl_Position = vec4(position, 0.0, 1.0);\n        }\n      "}),S=new a.Model(_,M);S.vertexCount=6*n.length,S.drawMode=a.GLSettings.Model.DrawMode.TRIANGLES;var O=new a.RenderTarget({buffers:{color:c},retainTextureTargets:!0}),I=new a.Scene;return I.add(S),this.renderer.setRenderTarget(O),this.renderer.setViewport(this.renderer.getFullViewport()),this.renderer.setScissor(this.renderer.getFullViewport()),this.renderer.render(I,O),M.dispose(),_.dispose(),O.dispose(),e.texture.dispose(),e.texture=c,e.packing=u,!0},e.prototype.updateAtlas=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,a,s;return o(this,(function(o){switch(o.label){case 0:if(!(n=this.allAtlas.get(e)))return[3,2];for(r=[],i=0,a=t.length;i<a;++i)(s=t[i]).disposeResource||r.push(this.draw(n,s));return[4,Promise.all(r)];case 1:for(o.sent(),i=0,a=t.length;i<a;++i)(s=t[i]).disposeResource?n.stopUsingResource(s):n.useResource(s);return n.resolveResources(),[3,3];case 2:console.warn("Can not update non-existing atlas:",e,"These resources will not be loaded:",t),o.label=3;case 3:return[2,n]}}))}))},e}();t.AtlasManager=g},function(e,t,n){"use strict";var r,i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.awaitContext=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return r?[3,2]:(this.getContext(),[4,new Promise((function(e){return setTimeout(e,10)}))]);case 1:return e.sent(),[3,0];case 2:return[2]}}))}))},e.getContext=function(){r||(r=document.createElement("canvas").getContext("2d"))},e.calculateImageSize=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.awaitContext()];case 1:return t.sent(),r?0===e.width||0===e.height?(console.warn("Images provided shoud have valid dimensions! Please ensure the image is loaded first."),[2]):(r.canvas.width=100,r.canvas.height=100,r.drawImage(e,0,0,1,1),[2,[e.width,e.height]]):(console.warn("The Image rasterizer was unable to establish a valid canvas context. Please ensure the system supports contexts and ensure the document is ready first."),[2])}}))}))},e.resizeImage=function(t,n){return i(this,void 0,void 0,(function(){var i;return o(this,(function(o){switch(o.label){case 0:return[4,this.awaitContext()];case 1:return o.sent(),r?0===t.width||0===t.height?(console.warn("Images provided shoud have valid dimensions! Please ensure the image is loaded first."),[2,t]):(r.canvas.width=Math.floor(t.width*n),r.canvas.height=Math.floor(t.height*n),t instanceof ImageData?r.putImageData(t,0,0,0,0,r.canvas.width,r.canvas.height):r.drawImage(t,0,0,r.canvas.width,r.canvas.height),(i=new Image).src=r.canvas.toDataURL("image/png"),[4,e.calculateImageSize(i)]):(console.warn("The Image rasterizer was unable to establish a valid canvas context. Please ensure the system supports contexts and ensure the document is ready first."),[2,t]);case 2:return o.sent(),[2,i]}}))}))},e}();t.ImageRasterizer=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=n(1),u=n(32),l=n(48),h=n(74),d=n(17),f=n(47),p=function(e){function t(t){var n=e.call(this)||this;return n.resources=new Map,n.requestQueue=new Map,n.requestLookup=new Map,n.atlasManager=t&&t.atlasManager||new h.AtlasManager,n}return i(t,e),Object.defineProperty(t.prototype,"webGLRenderer",{get:function(){return this._webGLRenderer},set:function(e){this._webGLRenderer=e,this.atlasManager.renderer=e},enumerable:!0,configurable:!0}),t.prototype.dequeueRequests=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,i,o,s,u,l;return a(this,(function(h){switch(h.label){case 0:e=!1,t=[],this.requestQueue.forEach((function(e,n){t.push([n,e])})),this.requestQueue.clear(),n=function(t,n){var i,o;return a(this,(function(a){switch(a.label){case 0:return n.length>0?(e=!0,i=n.slice(0),n.length=0,[4,r.atlasManager.updateAtlas(t,i)]):[3,2];case 1:a.sent(),(o=r.requestLookup.get(t))&&i.forEach((function(e){var t=o.get(e);if(o.delete(e),t&&!e.disposeResource){for(var n=0,r=t.length;n<r;++n){var i=t[n],a=i[0],s=i[1];a.managesInstance(s)&&(s.active=!0)}c.nextFrame((function(){for(var e=new Set,n=0,r=t.length;n<r;++n){var i=t[n][1];e.has(i)||(e.add(i),i.active=!0,i.resourceTrigger())}}))}})),a.label=2;case 2:return[2]}}))},r=this,i=0,o=t,h.label=1;case 1:return i<o.length?(s=o[i],u=s[0],l=s[1],[5,n(u,l)]):[3,4];case 2:h.sent(),h.label=3;case 3:return i++,[3,1];case 4:return[2,e]}}))}))},t.prototype.destroy=function(){this.atlasManager.destroy()},t.prototype.destroyResource=function(e){this.resources.get(e.key)&&(this.atlasManager.destroyAtlas(e.key),this.resources.delete(e.key))},t.prototype.getAtlasTexture=function(e){var t=this.atlasManager.getAtlasTexture(e);return t?t.texture:null},t.prototype.getResource=function(e){return this.resources.get(e)||null},t.prototype.getIOExpansion=function(){return[new f.TextureIOExpansion(s.ResourceType.ATLAS,this)]},t.prototype.initResource=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return l.isAtlasResource(e)?[4,this.atlasManager.createAtlas(e)]:[3,2];case 1:t=n.sent(),this.resources.set(e.key,t),n.label=2;case 2:return[2]}}))}))},t.prototype.request=function(e,t,n,r){var i=n.key||"",o=n.texture;if(o)return d.subTextureIOValue(o);var a=this.requestLookup.get(i);if(a){var s=a.get(n);if(s)return s.push([e,t]),t.active=!1,d.subTextureIOValue(o)}else a=new Map,this.requestLookup.set(i,a);n.disposeResource||(t.active=!1);var c=this.requestQueue.get(i);return c||(c=[],this.requestQueue.set(i,c)),c.push(n),a.set(n,[[e,t]]),d.subTextureIOValue(o)},t.prototype.updateResource=function(e){l.isAtlasResource(e)},t}(u.BaseResourceManager);t.AtlasResourceManager=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.delay=0,this.isManualStart=!1,this.isTimeSet=!1,Object.assign(this,e)}return e.prototype.setAutomatic=function(){this.isManualStart=!1,this.isTimeSet=!1},e.prototype.setStart=function(e){e&&(this.start.length!==e.length?console.warn("A manual easing adjustment provided an incompatible value for the easing type."):(this.start=e,this.isManualStart=!0))},e.prototype.setTiming=function(e,t){this.delay=void 0===e?this.delay:e,this.duration=void 0===t?this.duration:t,this.isTimeSet=!0},e}();t.EasingProps=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),i=n(0);t.generateLayerGeometry=function(e,t,n,o){var a=[];e.bufferType!==i.LayerBufferType.INSTANCE_ATTRIBUTE&&e.bufferType!==i.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING||(t=1);for(var s=0,c=n.length;s<c;++s){var u=n[s];a.push(new Float32Array(u.size*o*t))}var l,h,d,f,p=n.length,g=!1;for(s=0,c=o;s<c;++s)for(var v=0;v<p;++v)if(h=n[v],l=a[v],d=h.update(s),f=d,Array.isArray(f[0]))g=!0;else for(var y=s*h.size,m=y+h.size,b=0;y<m;++y,++b)l[y]=d[b];for(g&&console.warn("A vertex buffer updating method should not use arrays of arrays of numbers."),s=0,c=n.length;s<c;++s)for(var w=n[s].size*o,x=(v=1,t);v<x;++v)a[s].copyWithin(w*v,0,w);if(e.bufferType===i.LayerBufferType.UNIFORM){var T=a[0];for(s=0,c=t;s<c;++s){var _=s*o;for(v=0;v<o;++v)T[v+_]=s}}var E=new r.Geometry;for(s=0,c=n.length;s<c;++s){var A=n[s],M=new r.Attribute(a[s],A.size);A.materialAttribute=M,E.addAttribute(A.name,M)}return E}},function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(0),s=((r={})[a.UniformSize.ONE]=o.MaterialUniformType.FLOAT,r[a.UniformSize.TWO]=o.MaterialUniformType.VEC2,r[a.UniformSize.THREE]=o.MaterialUniformType.VEC3,r[a.UniformSize.FOUR]=o.MaterialUniformType.VEC4,r[a.UniformSize.MATRIX3]=o.MaterialUniformType.MATRIX3x3,r[a.UniformSize.MATRIX4]=o.MaterialUniformType.MATRIX4x4,r[a.UniformSize.ATLAS]=o.MaterialUniformType.TEXTURE,r),c=((i={})[a.UniformSize.ONE]=[0],i[a.UniformSize.TWO]=[0,0],i[a.UniformSize.THREE]=[0,0,0],i[a.UniformSize.FOUR]=[0,0,0,0],i[a.UniformSize.MATRIX3]=[0,0,0,0,0,0,0,0,0],i[a.UniformSize.MATRIX4]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i);function u(e){return{type:s[e.size],value:c[e.size]}}t.generateLayerMaterial=function(e,t,n,r,i){var a=e.getMaterialOptions();Object.assign(a,e.props.materialOptions||{}),a.vertexShader=t,a.fragmentShader=n,a.name=e.id,a.uniforms={};for(var s=0,c=r.length;s<c;++s){var l=r[s],h=u(l);a.uniforms[l.name]=h}for(s=0,c=i.length;s<c;++s){var d=i[s];a.uniforms[d.name]={type:d.type,value:d.value}}return new o.Material(a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(140);function i(e){return Boolean(e)}function o(e){return Boolean(e)}function a(e){return Boolean(e)}function s(e){return Object.assign({},e,{materialAttribute:null})}function c(e){return Object.assign({},e,{materialUniforms:[]})}t.injectShaderIO=function(e,t,n,u,l,h){!function(e,t,n){if(n){var r=t.instanceAttributes||[],i=t.uniforms||[],o=t.vertexAttributes||[];n.shaderModuleUnits.forEach((function(t){t.instanceAttributes&&(r=r.concat(t.instanceAttributes(e))),t.uniforms&&(i=i.concat(t.uniforms(e))),t.vertexAttributes&&(o=o.concat(t.vertexAttributes(e)))}));var a=new Set,s=new Set,c=new Set;i.filter((function(e){return!!e&&(a.has(e.name)?(console.warn("Included shader modules has introduced duplicate uniform names:",e.name,"One will be overridden thus causing a potential crash of the shader."),!1):(a.add(e.name),!0))})),r.filter((function(e){return!!e&&(s.has(e.name)?(console.warn("Included shader modules has introduced duplicate Instance Attribute names:",e.name,"One will be overridden thus causing a potential crash of the shader."),!1):(s.add(e.name),!0))})),o.filter((function(e){return!!e&&(c.has(e.name)?(console.warn("Included shader modules has introduced duplicate Vertex Attribute names:",e.name,"One will be overridden thus causing a potential crash of the shader."),!1):(c.add(e.name),!0))})),t.instanceAttributes=r,t.uniforms=i,t.vertexAttributes=o}}(t,n,h);for(var d=(n.instanceAttributes||[]).filter(i),f=(n.vertexAttributes||[]).filter(o),p=(n.uniforms||[]).filter(a),g=0,v=u.length;g<v;++g){var y=u[g];if(y.validate(t,d,f,p)){var m=y.expand(t,d,f,p);m.instanceAttributes.filter(i).forEach((function(e){return d.push(e)})),m.vertexAttributes.filter(o).forEach((function(e){return f.push(e)})),m.uniforms.filter(a).forEach((function(e){return p.push(e)}))}}!function(e,t,n,r){t.forEach((function(r){void 0===r.name&&console.warn("All instance attributes MUST have a name on Layer:",e.id),t.find((function(e){return e!==r&&e.name===r.name}))&&console.warn("An instance attribute can not have the same name used more than once:",r.name),n.find((function(e){return e.name===r.name}))&&console.warn("An instance attribute and a vertex attribute in a layer can not share the same name:",r.name),r.resource||void 0===r.size&&(console.warn("An instance attribute requires the size to be defined."),console.warn(r))}))}(t,d,f);var b=d.slice(0),w=(f||[]).map(s),x=p.map(c);return b.sort(l.sortInstanceAttributes),x.sort(l.sortUniforms),w.sort(l.sortVertexAttributes),r.packAttributes(b),t.getLayerBufferType(e,f,b),{instanceAttributes:b,uniforms:x,vertexAttributes:w}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};t.emitOnce=function(e,t){var n=r[e]||[t,-1,0];r[e]=n,n[2]++,clearTimeout(n[1]),n[1]=window.setTimeout((function(){t(n[2],e),delete r[e]}),1)},t.flushEmitOnce=function(){for(var e in r){var t=r[e];clearTimeout(t[1]),t[0](t[2],e)}r={}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(83),s=n(20),c=[],u=Math.min,l=Math.max;!function(e){e[e.PARTIAL=0]="PARTIAL",e[e.FULL=1]="FULL"}(o||(o={}));var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.diffMode=o.PARTIAL,t.bufferAttributeUpdateRange={},t.bufferAttributeWillUpdate={},t.updateInstance=t.updateInstancePartial,t}return i(t,e),t.prototype.addInstance=function(e,t,n,r){if(r)e.changeInstance(e,t,c,r);else{var i=e.layer.bufferManager.add(t);s.isBufferLocationGroup(i)&&(t.active=!0,t.easingId=e.layer.easingId,e.updateInstance(e.layer,t,c,i))}},t.prototype.changeInstance=function(e,t,n,r){r?e.updateInstance(e.layer,t,n,r):e.addInstance(e,t,c,r)},t.prototype.removeInstance=function(e,t,n,r){r&&(t.active=!1,t.clearEasing(),e.updateInstance(e.layer,t,c,r),e.layer.bufferManager.remove(t))},t.prototype.updateInstancePartial=function(e,t,n,r){var i,o,a,s,c,h,d=r.propertyToBufferLocation,f=this.bufferAttributeUpdateRange;if(t.active){(0===n.length||t.reactivate)&&(n=this.bufferManager.getUpdateAllPropertyIdList());for(var p=0,g=n.length;p<g;++p)if((i=d[n[p]])&&(h=(c=i.attribute).packUID||c.uid,o=c.update(t),i.buffer.value.set(o,i.range[0]),(a=f[h]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER])[0]=c,a[1]=u(i.range[0],a[1]),a[2]=l(i.range[1],a[2]),f[h]=a,i.childLocations))for(var v=0,y=(s=i.childLocations).length;v<y;++v)(i=s[v])&&(h=i.attribute.packUID||i.attribute.uid,o=i.attribute.update(t),i.buffer.value.set(o,i.range[0]),(a=f[h]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER])[0]=i.attribute,a[1]=u(i.range[0],a[1]),a[2]=l(i.range[1],a[2]),f[h]=a)}else h=(c=(i=d[this.bufferManager.getActiveAttributePropertyId()]).attribute).packUID||c.uid,o=c.update(t),i.buffer.value.set(o,i.range[0]),(a=f[h]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER])[0]=c,a[1]=u(i.range[0],a[1]),a[2]=l(i.range[1],a[2]),f[h]=a;t.reactivate=!1},t.prototype.updateInstanceFull=function(e,t,n,r){var i,o,a,s,c=r.propertyToBufferLocation,u=this.bufferAttributeWillUpdate;if(t.active){(0===n.length||t.reactivate)&&(n=this.bufferManager.getUpdateAllPropertyIdList());for(var l=0,h=n.length;l<h;++l)if((i=c[n[l]])&&(o=(s=i.attribute).update(t),i.buffer.value.set(o,i.range[0]),u[s.packUID||s.uid]=s,i.childLocations))for(var d=0,f=(a=i.childLocations).length;d<f;++d)(i=a[d])&&(o=(s=i.attribute).update(t),i.buffer.value.set(o,i.range[0]),u[s.packUID||s.uid]=s)}else o=(s=(i=c[this.bufferManager.getActiveAttributePropertyId()]).attribute).update(t),i.buffer.value.set(o,i.range[0]),u[s.packUID||s.uid]=s;t.reactivate=!1},t.prototype.commit=function(){if(this.diffMode===o.PARTIAL)for(var e=0,t=(r=Object.values(this.bufferAttributeUpdateRange)).length;e<t;++e){var n=r[e];n[0].bufferAttribute.updateRange={count:n[2]-n[1],offset:n[1]}}else{var r;for(e=0,t=(r=Object.values(this.bufferAttributeWillUpdate)).length;e<t;++e){r[e].bufferAttribute.updateRange={count:-1,offset:0}}}this.bufferAttributeUpdateRange={}},t.prototype.incomingChangeList=function(e){0===e.length?this.diffMode=o.PARTIAL:e.length>.7*this.bufferManager.getInstanceCount()?this.diffMode=o.FULL:this.diffMode=o.PARTIAL,this.diffMode===o.PARTIAL?this.updateInstance=this.updateInstancePartial:this.updateInstance=this.updateInstanceFull},t}(a.BaseDiffProcessor);t.InstanceAttributeDiffProcessor=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t){this.layer=e,this.bufferManager=t};t.BaseDiffProcessor=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(83),a=n(51),s=[],c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.addInstance=function(e,t,n,r){if(r)e.changeInstance(e,t,s,r);else{var i=e.layer.bufferManager.add(t);a.isUniformBufferLocation(i)&&(t.active=!0,t.easingId=e.layer.easingId,e.updateInstance(e.layer,t,i))}},t.prototype.changeInstance=function(e,t,n,r){r?e.updateInstance(e.layer,t,r):e.addInstance(e,t,s,r)},t.prototype.removeInstance=function(e,t,n,r){r&&(t.active=!1,t.clearEasing(),e.updateInstance(e.layer,t,r),e.layer.bufferManager.remove(t))},t.prototype.updateInstance=function(e,t,n){if(t.active){for(var r=n.buffer,i=n.range[0],o=r.value,a=void 0,s=void 0,c=void 0,u=void 0,l=void 0,h=void 0,d=0,f=e.instanceAttributes.length;d<f;++d)if(s=(a=e.instanceAttributes[d]).update(t),c=o[i+(a.block||0)],void 0!==(u=a.blockIndex))for(l=u,h=s.length+u;l<h;++l)c[l]=s[l-u];r.value=o}else{r=n.buffer,i=n.range[0],o=r.value,a=void 0,s=void 0,c=void 0,u=void 0;if(s=(a=e.activeAttribute).update(t),c=o[i+(a.block||0)],void 0!==(u=a.blockIndex))for(l=u,h=s.length+u;l<h;++l)c[l]=s[l-u];r.value=o}},t.prototype.commit=function(){},t.prototype.incomingChangeList=function(e){},t}(o.BaseDiffProcessor);t.UniformDiffProcessor=c},function(e,t){e.exports="vec3 cameraSpace(vec3 world) {\nreturn (world + cameraOffset) * cameraScale2D;\n}\nvec3 cameraSpaceSize(vec3 worldSize) {\nreturn worldSize * cameraScale2D;\n}\nvec4 clipSpace(vec3 world) {\nreturn (projection * view) * vec4(cameraSpace(world), 1.0);\n}\nvec4 clipSpaceSize(vec3 worldSize) {\nreturn (projection * view) * vec4(cameraSpaceSize(worldSize), 0.0);\n}"},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(152)),r(n(29)),r(n(30)),r(n(5)),r(n(153)),r(n(154))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.SCREEN_CURVE=1]="SCREEN_CURVE"}(t.EdgeScaleType||(t.EdgeScaleType={})),function(e){e[e.LINE=0]="LINE",e[e.BEZIER=1]="BEZIER",e[e.BEZIER2=2]="BEZIER2"}(t.EdgeType||(t.EdgeType={})),function(e){e[e.ALL=0]="ALL",e[e.PASS_Y=1]="PASS_Y",e[e.PASS_X=2]="PASS_X"}(t.EdgeBroadphase||(t.EdgeBroadphase={}))},function(e,t,n){"use strict";var r,i,o,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var c=n(50),u=n(3),l=n(16),h=n(19),d=n(0),f=n(1),p=n(14),g=n(5),v=n(89),y=n(90),m=((i={})[p.AnchorType.TopLeft]=function(e,t){e.x=0,e.y=0},i[p.AnchorType.TopMiddle]=function(e,t){e.x=t.size[0]/2,e.y=0},i[p.AnchorType.TopRight]=function(e,t){e.x=t.size[0],e.y=0},i[p.AnchorType.MiddleLeft]=function(e,t){e.x=0,e.y=t.size[1]/2},i[p.AnchorType.Middle]=function(e,t){e.x=t.size[0]/2,e.y=t.size[1]/2},i[p.AnchorType.MiddleRight]=function(e,t){e.x=t.size[0],e.y=t.size[1]/2},i[p.AnchorType.BottomLeft]=function(e,t){e.x=0,e.y=t.size[1]},i[p.AnchorType.BottomMiddle]=function(e,t){e.x=t.size[0]/2,e.y=t.size[1]},i[p.AnchorType.BottomRight]=function(e,t){e.x=t.size[0],e.y=t.size[1]},i[p.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},i),b=[[-1,-1],[0,-1],[1,-1],[-1,0],[0,0],[1,0],[-1,1],[0,1],[1,1]].map((function(e){var t=Math.sqrt(u.dot2(e,e));return u.scale2(e,1/-t)})),w=((o={})[p.AnchorType.TopLeft]=function(e){e.paddingDirection=u.scale2(b[0],e.padding)},o[p.AnchorType.TopMiddle]=function(e){e.paddingDirection=u.scale2(b[1],e.padding)},o[p.AnchorType.TopRight]=function(e){e.paddingDirection=u.scale2(b[2],e.padding)},o[p.AnchorType.MiddleLeft]=function(e){e.paddingDirection=u.scale2(b[3],e.padding)},o[p.AnchorType.Middle]=function(e){e.paddingDirection=[0,0]},o[p.AnchorType.MiddleRight]=function(e){e.paddingDirection=u.scale2(b[5],e.padding)},o[p.AnchorType.BottomLeft]=function(e){e.paddingDirection=u.scale2(b[6],e.padding)},o[p.AnchorType.BottomMiddle]=function(e){e.paddingDirection=u.scale2(b[7],e.padding)},o[p.AnchorType.BottomRight]=function(e){e.paddingDirection=u.scale2(b[8],e.padding)},o[p.AnchorType.Custom]=function(e){e.paddingDirection=e.paddingDirection},o);function x(e){if(e)return function(t){e(s({},t,{instances:t.instances.map((function(e){return e.parentLabel})).filter(f.isDefined)}))}}var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fullUpdate=!1,t.glyphProvider=new c.InstanceProvider,t.labelToGlyphs=new Map,t.labelToKerningRequest=new Map,t.labelWaitingOnGlyph=new Map,t.truncationWidth=-1,t.handleGlyphReady=function(e){if(e.parentLabel){var n=e.parentLabel,r=t.labelWaitingOnGlyph.get(e.parentLabel);if(r&&r.has(e)&&(r.delete(e),r.size<=0)){var i=n.onReady;i&&i(n)}}else delete e.onReady},t}return a(t,e),t.prototype.childLayers=function(){return[h.createLayer(this.props.customGlyphLayer||y.GlyphLayer,{animate:this.props.animate,data:this.glyphProvider,key:this.id+".glyphs",resourceKey:this.props.resourceKey,scaleMode:this.props.scaleMode||p.ScaleMode.BOUND_MAX,inTextArea:this.props.inTextArea,picking:this.props.picking,onMouseClick:x(this.props.onMouseClick),onMouseUp:x(this.props.onMouseUp),onMouseDown:x(this.props.onMouseDown),onMouseOut:x(this.props.onMouseOut),onMouseOver:x(this.props.onMouseOver),onMouseMove:x(this.props.onMouseMove),onMouseUpOutside:x(this.props.onMouseUpOutside),onTap:x(this.props.onTap),onTouchDown:x(this.props.onTouchDown),onTouchUp:x(this.props.onTouchUp),onTouchUpOutside:x(this.props.onTouchUpOutside),onTouchMove:x(this.props.onTouchMove),onTouchOut:x(this.props.onTouchOut),onTouchOver:x(this.props.onTouchOver),onTouchAllEnd:x(this.props.onTouchAllEnd),onTouchAllOut:x(this.props.onTouchAllOut)})]},t.prototype.draw=function(){var e=this.resolveChanges();if(!(e.length<=0)){if(!this.propertyIds){var t=e[0][0];this.propertyIds=this.getInstanceObservableIds(t,["text","active","anchor","color","origin","fontSize","maxWidth","maxScale","letterSpacing"])}for(var n=this.propertyIds,r=n.text,i=n.active,o=n.anchor,a=n.color,s=n.origin,c=n.fontSize,u=n.maxWidth,l=n.maxScale,h=n.letterSpacing,f=0,p=e.length;f<p;++f){var g=e[f],v=(t=g[0],g[1]),y=g[2];switch(v){case d.InstanceDiffType.CHANGE:if(!this.labelToGlyphs.get(t)){this.insert(t);continue}void 0!==y[r]?(this.invalidateRequest(t),this.layoutGlyphs(t)):void 0!==y[i]&&(t.active?(this.layoutGlyphs(t),this.showGlyphs(t)):this.hideGlyphs(t)),y[o]&&this.updateAnchor(t),void 0!==y[a]&&this.updateGlyphColors(t),void 0!==y[s]&&this.updateGlyphOrigins(t),void 0!==y[l]&&this.updateGlyphMaxScales(t),void 0!==y[c]&&(this.invalidateRequest(t),this.layoutGlyphs(t)),void 0!==y[u]&&(this.invalidateRequest(t),this.layoutGlyphs(t)),void 0!==y[h]&&(this.invalidateRequest(t),this.layoutGlyphs(t));break;case d.InstanceDiffType.INSERT:this.insert(t);break;case d.InstanceDiffType.REMOVE:var m=this.labelToGlyphs.get(t);if(m){for(var b=0,w=m.length;b<w;++b)this.glyphProvider.remove(m[b]);this.labelToGlyphs.delete(t),this.labelToKerningRequest.delete(t),this.labelWaitingOnGlyph.delete(t)}}}}},t.prototype.insert=function(e){e.preload?this.props.data.remove(e):this.labelToGlyphs.get(e)||this.labelToGlyphs.set(e,[]);this.layoutGlyphs(e)},t.prototype.hideGlyphs=function(e){var t=this.labelToGlyphs.get(e);if(t)for(var n=0,r=t.length;n<r;++n)this.glyphProvider.remove(t[n])},t.prototype.initShader=function(){return null},t.prototype.invalidateRequest=function(e){this.labelToKerningRequest.delete(e)},t.prototype.layoutGlyphs=function(e){if(this.updateKerning(e)&&e.active){var t=this.labelToKerningRequest.get(e);if(t&&t.fontMap){var n=t.metrics;if(n&&n.layout){var r=n.layout;this.updateGlyphs(e,r);var i=e.glyphs;e.size=r.size,m[e.anchor.type](e.anchor,e),w[e.anchor.type](e.anchor);for(var o=e.anchor,a=e.anchor.paddingDirection,s=0,c=Math.min(r.positions.length,i.length);s<c;++s){var l=r.positions[s],h=i[s];h.offset=l,h.fontScale=r.fontScale,h.anchor=[o.x||0,o.y||0],h.origin=u.copy2(e.origin),h.padding=a||[0,0],h.maxScale=e.maxScale}}}}},t.prototype.managesInstance=function(e){return Boolean(this.labelToGlyphs.get(e))},t.prototype.showGlyphs=function(e){var t=this.labelToGlyphs.get(e);if(t)for(var n=0,r=t.length;n<r;++n)this.glyphProvider.add(t[n])},t.prototype.updateAnchor=function(e){var t=e.glyphs;if(t){m[e.anchor.type](e.anchor,e),w[e.anchor.type](e.anchor);for(var n=e.anchor,r=e.anchor.paddingDirection,i=0,o=t.length;i<o;++i)t[i].anchor=[n.x||0,n.y||0],t[i].padding=r||[0,0]}},t.prototype.updateGlyphs=function(e,t){var n=this.labelToGlyphs.get(e);n||(n=[],this.labelToGlyphs.set(e,n));var r=this.labelWaitingOnGlyph.get(e);r||(r=new Set,this.labelWaitingOnGlyph.set(e,r));for(var i=0,o=Math.min(n.length,t.glyphs.length);i<o;++i){(c=n[i]).character!==t.glyphs[i]&&(c.character=t.glyphs[i],c.request&&c.request.fontMap&&c.request.fontMap.glyphMap[c.character]||r.add(c))}if(n.length<t.glyphs.length){var a=0;for(i=n.length,o=t.glyphs.length;i<o;++i,++a){var s=t.glyphs[i];(c=new v.GlyphInstance({character:s,color:e.color,origin:e.origin,maxScale:e.maxScale,onReady:this.handleGlyphReady})).parentLabel=e,n.push(c),e.active&&this.glyphProvider.add(c),r.add(c)}}else if(n.length>t.glyphs.length){for(i=t.glyphs.length,o=n.length;i<o;++i){var c=n[i];this.glyphProvider.remove(c)}for(;n.length>t.glyphs.length;)n.pop()}e.glyphs=n},t.prototype.updateGlyphColors=function(e){var t=e.glyphs;if(t)for(var n=0,r=t.length;n<r;++n)t[n].color=u.copy4(e.color)},t.prototype.updateGlyphOrigins=function(e){var t=e.glyphs;if(t)for(var n=e.origin,r=0,i=t.length;r<i;++r)t[r].origin=[n[0],n[1]]},t.prototype.updateGlyphMaxScales=function(e){var t=e.glyphs;if(t)for(var n=e.maxScale,r=0,i=t.length;r<i;++r)t[r].maxScale=n},t.prototype.updateKerning=function(e){var t=this.labelToKerningRequest.get(e),n=e.text;if(t){if(t.kerningPairs&&t.kerningPairs.indexOf(n)>-1)return Boolean(t.fontMap);if(!t.fontMap||t.fontMap.supportsKerning(n.replace(/\s/g,"")))return!0;this.labelToKerningRequest.delete(e),t=void 0}if(!t){var r={fontSize:e.fontSize,text:e.text,letterSpacing:e.letterSpacing};return e.maxWidth>0&&(r.maxWidth=e.maxWidth,r.truncation=this.props.truncation||"..."),t=l.fontRequest({key:this.props.resourceKey||"",character:"",kerningPairs:[n],metrics:r}),e.preload?(e.resourceTrigger=function(){e.onReady&&e.onReady(e)},this.resource.request(this,e,t)):(this.resource.request(this,e,t,{resource:{type:d.ResourceType.FONT,key:this.props.resourceKey||""}}),this.labelToKerningRequest.set(e,t)),!1}return!0},t.prototype.willUpdateProps=function(e){e.data!==this.props.data&&delete this.propertyIds,e.scaleMode!==this.props.scaleMode&&this.rebuildLayer(),e.resourceKey!==this.props.resourceKey&&(this.fullUpdate=!0)},t.defaultProps={key:"",data:new c.InstanceProvider},t}(g.Layer2D);t.LabelLayer=T},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=function(e){function t(t){var n=e.call(this,t)||this;return n.anchor=[0,0],n.character="a",n.color=[1,1,1,1],n.depth=0,n.fontScale=1,n.maxScale=1,n.offset=[0,0],n.origin=[0,0],n.padding=[0,0],n.origin=t.origin||n.origin,n.offset=t.offset||n.offset,n.character=t.character||n.character,n.color=t.color||n.color,n.maxScale=t.maxScale||n.maxScale,n.padding=t.padding||n.padding,n.anchor=t.anchor||n.anchor,n.onReady=t.onReady,n}return i(t,e),t.prototype.clone=function(){var e=new t(this);e.onReady=this.onReady,e.request=this.request},t.prototype.resourceTrigger=function(){this.offset=this.offset,this.origin=this.origin,this.character=this.character,this.color=this.color,this.onReady&&this.onReady(this)},o([a.observable],t.prototype,"anchor",void 0),o([a.observable],t.prototype,"character",void 0),o([a.observable],t.prototype,"color",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"fontScale",void 0),o([a.observable],t.prototype,"maxScale",void 0),o([a.observable],t.prototype,"offset",void 0),o([a.observable],t.prototype,"origin",void 0),o([a.observable],t.prototype,"padding",void 0),t}(a.Instance);t.GlyphInstance=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(16),s=n(0),c=n(1),u=n(14),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.glyphRequests={},t}return i(t,e),t.prototype.initShader=function(){var e,r,i=this,o=this.props.animate||{},c=o.anchor,l=o.color,h=o.offset,d=o.origin,f={0:[0,0],1:[0,0],2:[1,0],3:[0,1],4:[1,1],5:[1,1]},p={name:"texture",resource:{key:function(){return i.props.resourceKey||""},name:"fontMap"},update:function(e){var t=e.character;return e.request&&e.character===e.request.character||(i.glyphRequests[e.character]?e.request=i.glyphRequests[e.character]:(e.request=a.fontRequest({key:i.props.resourceKey||"",character:t}),i.glyphRequests[e.character]=e.request),e.request.fontMap&&e.onReady&&e.onReady(e)),e.request.fetch=a.FontResourceRequestFetch.TEXCOORDS,i.resource.request(i,e,e.request)}},g={name:"glyphSize",parentAttribute:p,resource:{key:function(){return i.props.resourceKey||""},name:"fontMap"},size:s.InstanceAttributeSize.TWO,update:function(e){var t=e.character;return e.request&&e.character===e.request.character||(i.glyphRequests[e.character]?e.request=i.glyphRequests[e.character]:(e.request=a.fontRequest({key:i.props.resourceKey||"",character:t}),i.glyphRequests[e.character]=e.request),e.request.fontMap&&e.onReady&&e.onReady(e)),e.request.fetch=a.FontResourceRequestFetch.IMAGE_SIZE,i.resource.request(i,e,e.request)}};switch(p.childAttributes=[g],this.props.scaleMode||u.ScaleMode.ALWAYS){case u.ScaleMode.BOUND_MAX:e=this.props.inTextArea?n(187):n(188),r=this.props.inTextArea?n(189):n(190);break;case u.ScaleMode.NEVER:e=this.props.inTextArea?n(191):n(192),r=this.props.inTextArea?n(193):n(194);break;case u.ScaleMode.ALWAYS:e=this.props.inTextArea?n(195):n(91),r=this.props.inTextArea?n(196):n(92);break;default:e=n(91),r=n(92)}return{fs:e,instanceAttributes:[{easing:l,name:t.attributeNames.color,size:s.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.depth,size:s.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:"fontScale",size:s.InstanceAttributeSize.ONE,update:function(e){return[e.fontScale]}},{easing:c,name:t.attributeNames.anchor,size:s.InstanceAttributeSize.TWO,update:function(e){return e.anchor}},{easing:d,name:t.attributeNames.origin,size:s.InstanceAttributeSize.TWO,update:function(e){return e.origin}},{easing:h,name:t.attributeNames.offset,size:s.InstanceAttributeSize.TWO,update:function(e){return e.offset}},{name:"padding",size:s.InstanceAttributeSize.TWO,update:function(e){return e.padding}},{name:"maxScale",size:s.InstanceAttributeSize.ONE,update:function(e){return[e.maxScale]}},g,p],uniforms:[],vertexAttributes:[{name:"normals",size:s.VertexAttributeSize.TWO,update:function(e){return f[e]}}],vertexCount:6,vs:r}},t.prototype.draw=function(){e.prototype.draw.call(this)},t.prototype.getMaterialOptions=function(){return Object.assign({},c.CommonMaterialOptions.transparentImageBlending,s.createMaterialOptions({depthTest:!1}))},t.prototype.willUpdateProps=function(e){e.resourceKey!==this.props.resourceKey&&(Object.values(this.glyphRequests).forEach((function(t){delete t.fontMap,t.key=e.resourceKey||""})),this.rebuildLayer())},t.defaultProps={key:"",data:new o.InstanceProvider,resourceKey:"No resource specified"},t.attributeNames={color:"color",depth:"depth",anchor:"anchor",origin:"origin",offset:"offset"},t}(n(5).Layer2D);t.GlyphLayer=l},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\nsetColor(texColor * vertexColor);\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 pushOut = normals * glyphSize * fontScale;\nvec3 position = vec3(origin + padding - anchor + offset + pushOut, depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a,s,c=n(18),u=n(52);!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.CENTERED=2]="CENTERED"}(a=t.TextAlignment||(t.TextAlignment={})),function(e){e[e.NONE=0]="NONE",e[e.CHARACTER=1]="CHARACTER",e[e.WORD=2]="WORD"}(s=t.WordWrap||(t.WordWrap={})),function(e){e[e.NEWLINE=0]="NEWLINE"}(t.NewLineCharacterMode||(t.NewLineCharacterMode={}));var l=function(e){function t(t){var n=e.call(this,t)||this;return n.maxHeight=0,n.lineHeight=0,n.wordWrap=s.NONE,n.alignment=a.LEFT,n.labels=[],n.newLabels=[],n.borders=[],n.padding=[0,0,0,0],n.borderWidth=6,n.hasBorder=!0,n.spaceWidth=0,n.color=t.color,n.origin=t.origin,n.oldOrigin=t.origin,n.text=t.text,n.fontSize=t.fontSize||n.fontSize,n.maxWidth=t.maxWidth||n.maxWidth,n.maxHeight=t.maxHeight||n.maxHeight,n.lineHeight=t.lineHeight||n.lineHeight,n.wordWrap=t.wordWrap||n.wordWrap,n.alignment=t.alignment||n.alignment,n.padding=t.padding||n.padding,n.borderWidth=t.borderWidth||n.borderWidth,n.hasBorder=void 0!==t.hasBorder?t.hasBorder:n.hasBorder,n.letterSpacing=t.letterSpacing||n.letterSpacing,n}return i(t,e),o([c.observable],t.prototype,"maxHeight",void 0),o([c.observable],t.prototype,"lineHeight",void 0),o([c.observable],t.prototype,"wordWrap",void 0),o([c.observable],t.prototype,"alignment",void 0),o([c.observable],t.prototype,"padding",void 0),o([c.observable],t.prototype,"borderWidth",void 0),o([c.observable],t.prototype,"hasBorder",void 0),t}(u.LabelInstance);t.TextAreaInstance=l},function(e,t,n){"use strict";var r,i,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),c=n(10),u=n(14),l=((i={})[u.AnchorType.TopLeft]=function(e,t){e.x=-e.padding,e.y=-e.padding},i[u.AnchorType.TopMiddle]=function(e,t){e.x=t.size[0]/2,e.y=-e.padding},i[u.AnchorType.TopRight]=function(e,t){e.x=t.size[0]+e.padding,e.y=-e.padding},i[u.AnchorType.MiddleLeft]=function(e,t){e.x=-e.padding,e.y=t.size[1]/2},i[u.AnchorType.Middle]=function(e,t){e.x=t.size[0]/2,e.y=t.size[1]/2},i[u.AnchorType.MiddleRight]=function(e,t){e.x=t.size[0]+e.padding,e.y=t.size[1]/2},i[u.AnchorType.BottomLeft]=function(e,t){e.x=-e.padding,e.y=t.size[1]+e.padding},i[u.AnchorType.BottomMiddle]=function(e,t){e.x=t.size[0]/2,e.y=t.size[1]+e.padding},i[u.AnchorType.BottomRight]=function(e,t){e.x=t.size[0]+e.padding,e.y=t.size[1]+e.padding},i[u.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},i),h=function(e){function t(t){var n=e.call(this,t)||this;return n.color=[0,0,0,1],n.depth=0,n.maxScale=1,n.scale=1,n.scaling=u.ScaleMode.BOUND_MAX,n.size=[1,1],n.position=[0,0],n._anchor={padding:0,type:u.AnchorType.TopLeft,x:0,y:0},n.depth=t.depth||n.depth,n.color=t.color||n.color,n.scaling=t.scaling||n.scaling,n.position=t.position||n.position,n.size=t.size||n.size,t.anchor&&n.setAnchor(t.anchor),n}return o(t,e),Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},enumerable:!0,configurable:!0}),t.prototype.setAnchor=function(e){var t={padding:e.padding||0,type:e.type,x:e.x||0,y:e.y||0};l[t.type](t,this),this._anchor=t},a([s.observable],t.prototype,"color",void 0),a([s.observable],t.prototype,"depth",void 0),a([s.observable],t.prototype,"maxScale",void 0),a([s.observable],t.prototype,"scale",void 0),a([s.observable],t.prototype,"scaling",void 0),a([s.observable],t.prototype,"size",void 0),a([s.observable],t.prototype,"position",void 0),a([s.observable],t.prototype,"_anchor",void 0),t}(c.Instance);t.RectangleInstance=h},function(e,t){e.exports="vec3 rgb2hsv(vec3 c) {\nvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\nvec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\nfloat d = q.x - min(q.w, q.y);\nfloat e = 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=n(15),s=n(13),c=n(97);var u=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.projection=new c.Projection3D,r.projection.camera=n.camera,r.projection.pixelRatio=r.pixelRatio,r}return i(t,e),t.prototype.fitViewtoViewport=function(e,t){if(s.isPerspective(this.props.camera)){var n={near:1,far:1e5,width:t.width,height:t.height},r=this.props.camera;r.projectionOptions=Object.assign(r.projectionOptions,n),r.update(),this.projection.pixelRatio=this.pixelRatio,this.projection.viewBounds=t,this.projection.viewBounds.d=this,this.projection.screenBounds=new o.Bounds({height:this.projection.viewBounds.height/this.pixelRatio,width:this.projection.viewBounds.width/this.pixelRatio,x:this.projection.viewBounds.x/this.pixelRatio,y:this.projection.viewBounds.y/this.pixelRatio}),this.projection.screenBounds.d=this}else this.props.camera.projectionType!==s.CameraProjectionType.ORTHOGRAPHIC&&console.warn("View3D does not support orthographic cameras yet.")},t.prototype.willUpdateProps=function(e){this.projection.camera=e.camera},t.defaultProps={key:"",camera:new s.Camera({type:s.CameraProjectionType.PERSPECTIVE,width:100,height:100,fov:Math.PI/2,far:1e5,near:1}),viewport:{left:0,right:0,bottom:0,top:0}},t}(a.View);t.View3D=u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),a=n(39),s=n(3),c=n(13),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.screenToWorld=function(e,t){return t=t||[0,0,0],this.viewToWorld(this.screenToView(e),t),t},t.prototype.worldToScreen=function(e,t){t=t||[0,0];var n=o.multiply4x4(this.camera.projection,this.camera.view),r=o.project3As4ToScreen(n,e,this.viewBounds.width,this.viewBounds.height);return s.apply2(t,r[0]/this.pixelRatio,r[1]/this.pixelRatio)},t.prototype.viewToWorld=function(e,t){t=t||[0,0,0];var n=this.viewBounds,r=n.width,i=n.height,a=this.camera.projectionOptions,u=s.scale2(e,this.pixelRatio),l=Math.tan;if(a.type===c.CameraProjectionType.PERSPECTIVE){var h=a.fov,d=a.near,f=i/r,p=l(h/2)*d,g=[((u[0]+.5)/r*2-1)*p,(1-(u[1]+.5)/i*2)*p*f,-1],v=o.transform4(this.camera.transform.matrix,s.vec4(g,1));s.apply3(t,v[0],v[1],v[2])}else console.warn("Projections with orthographic cameras and 3D contexts are not working yet");return t},t.prototype.worldToView=function(e,t){t=t||[0,0];var n=o.multiply4x4(this.camera.projection,this.camera.view),r=o.project3As4ToScreen(n,e,this.viewBounds.width,this.viewBounds.height);return s.apply2(t,r[0]/this.pixelRatio,r[1]/this.pixelRatio)},t}(a.BaseProjection);t.Projection3D=u},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(40)),r(n(256))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=function(e){function t(t){var n=e.call(this,t)||this;return n._position=[0,0,0],n._rotation=[1,0,0,0],n._scale=[1,1,1],n.transform=t.transform,n}return i(t,e),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},set:function(e){this._position!==e.position&&(this._position=e.position),this._rotation!==e.rotation&&(this._rotation=e.rotation),this.scale!==e.scale&&(this._scale=e.scale),this._transform=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),o([a.observable],t.prototype,"_transform",void 0),o([a.observable],t.prototype,"_position",void 0),o([a.observable],t.prototype,"_rotation",void 0),o([a.observable],t.prototype,"_scale",void 0),t}(a.Instance);t.Instance3D=s},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(101),r(n(102)),r(n(27)),r(n(211)),r(n(2)),r(n(15)),r(n(0)),r(n(1)),r(n(34)),r(n(16)),r(n(6)),r(n(265)),r(n(267)),r(n(11))},function(e,t){window.WebGL2RenderingContext=window.WebGL2RenderingContext||function(){}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(35)),r(n(36)),r(n(103)),r(n(53))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=-1]="NONE",e[e.LEFT=0]="LEFT",e[e.AUX=1]="AUX",e[e.RIGHT=2]="RIGHT",e[e.FOURTH=3]="FOURTH",e[e.FIFTH=4]="FIFTH"}(t.MouseButton||(t.MouseButton={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3);t.rayToLocation=function(e,t,n){return n=n||[0,0,0],r.add3(e[0],r.scale3(e[1],t),n)},t.rayFromPoints=function(e,t,n){return n=n||[[0,0,0],[0,0,0]],r.copy3(e,n[0]),r.normalize3(r.subtract3(t,e),n[1]),n}},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c,u=[],l=!1,h=-1;function d(){l&&c&&(l=!1,c.length?u=c.concat(u):h=-1,u.length&&f())}function f(){if(!l){var e=s(d);l=!0;for(var t=u.length;t;){for(c=u,u=[];++h<t;)c&&c[h].run();h=-1,t=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||l||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){function r(e){var n;function r(){if(r.enabled){var e=r,i=+new Date,o=i-(n||i);e.diff=o,e.prev=n,e.curr=i,n=i;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;c++;var i=t.formatters[r];if("function"==typeof i){var o=a[c];n=i.call(e,o),a.splice(c,1),c--}return n})),t.formatArgs.call(e,a);var u=r.log||t.log||console.log.bind(console);u.apply(e,a)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=i,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(107),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){var n=1e3,r=6e4,i=36e5,o=24*i;function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var s,c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*r;case"seconds":case"second":case"secs":case"sec":case"s":return a*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(e);if("number"===c&&!1===isNaN(e))return t.long?a(s=e,o,"day")||a(s,i,"hour")||a(s,r,"minute")||a(s,n,"second")||s+" ms":function(e){if(e>=o)return Math.round(e/o)+"d";if(e>=i)return Math.round(e/i)+"h";if(e>=r)return Math.round(e/r)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(109);t.normalizeWheel=r.normalizeWheel},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(110),i=n(111);function o(e){var t=0,n=0,r=0,i=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0),r=10*t,i=10*n,"deltaY"in e&&(i=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||i)&&e.deltaMode&&(1===e.deltaMode?(r*=40,i*=40):(r*=800,i*=800)),r&&!t&&(t=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:t,spinY:-n,pixelX:r,pixelY:-i}}t.normalizeWheel=o,o.getEventType=function(){return r.firefox()?"DOMMouseScroll":i("wheel")?"wheel":"mousewheel"}},function(e,t){var n,r,i,o,a,s,c,u,l,h,d,f,p,g,v,y=!1;function m(){if(!y){y=!0;var e=navigator.userAgent,t=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(e),m=/(Mac OS X)|(Windows)|(Linux)/.exec(e);if(f=/\b(iPhone|iP[ao]d)/.exec(e),p=/\b(iP[ao]d)/.exec(e),h=/Android/i.exec(e),g=/FBAN\/\w+;/i.exec(e),v=/Mobile/i.exec(e),d=!!/Win64/.exec(e),t){(n=t[1]?parseFloat(t[1]):t[5]?parseFloat(t[5]):NaN)&&document&&document.documentMode&&(n=document.documentMode);var b=/(?:Trident\/(\d+.\d+))/.exec(e);s=b?parseFloat(b[1])+4:n,r=t[2]?parseFloat(t[2]):NaN,i=t[3]?parseFloat(t[3]):NaN,(o=t[4]?parseFloat(t[4]):NaN)?(t=/(?:Chrome\/(\d+\.\d+))/.exec(e),a=t&&t[1]?parseFloat(t[1]):NaN):a=NaN}else n=r=i=a=o=NaN;if(m){if(m[1]){var w=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(e);c=!w||parseFloat(w[1].replace("_","."))}else c=!1;u=!!m[2],l=!!m[3]}else c=u=l=!1}}var b={ie:function(){return m()||n},ieCompatibilityMode:function(){return m()||s>n},ie64:function(){return b.ie()&&d},firefox:function(){return m()||r},opera:function(){return m()||i},webkit:function(){return m()||o},safari:function(){return b.webkit()},chrome:function(){return m()||a},windows:function(){return m()||u},osx:function(){return m()||c},linux:function(){return m()||l},iphone:function(){return m()||f},mobile:function(){return m()||f||p||h||v},nativeApp:function(){return m()||g},android:function(){return m()||h},ipad:function(){return m()||p}};e.exports=b},function(e,t,n){"use strict";var r,i=n(112);i.canUseDOM&&(r=document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("",""))
/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */,e.exports=function(e,t){if(!i.canUseDOM||t&&!("addEventListener"in document))return!1;var n="on"+e,o=n in document;if(!o){var a=document.createElement("div");a.setAttribute(n,"return;"),o="function"==typeof a[n]}return!o&&r&&"wheel"===e&&(o=document.implementation.hasFeature("Events.wheel","3.0")),o}},function(e,t,n){"use strict";var r=!("undefined"==typeof window||!window.document||!window.document.createElement),i={canUseDOM:r,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:r&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:r&&!!window.screen,isInWorker:!r};e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(114)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=n(0),o=n(29),a=n(5);r.ShaderModule.register([{moduleId:"world2D",content:n(85),compatibility:i.ShaderInjectionTarget.ALL,uniforms:function(e){return e instanceof a.Layer2D?[{name:"projection",size:i.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"view",size:i.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"cameraOffset",size:i.UniformSize.THREE,update:function(){return e.view.props.camera instanceof o.Camera2D?e.view.props.camera.control2D.offset:[0,0,0]}},{name:"cameraPosition",size:i.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:i.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraScale2D",size:i.UniformSize.THREE,update:function(){return e.view.props.camera instanceof o.Camera2D?e.view.props.camera.scale2D:[1,1,1]}},{name:"cameraRotation",size:i.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"viewSize",size:i.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:i.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]:(console.warn("A shader requested the module world2D; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}}])},function(e,t,n){"use strict";function r(e){return e&&e.constructor===Function}Object.defineProperty(t,"__esModule",{value:!0}),t.mapInjectDefault=function(e,t,n){var i=e.get(t);return void 0===i&&(i=r(n)?n():n,e.set(t,i)),i},t.mapGetWithDefault=function(e,t,n){var i=e.get(t);return void 0===i&&(i=r(n)?n():n),i}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(64),s=function(){function e(){}return e.all=function(e,t,n,s){return r(this,void 0,void 0,(function(){var r,c,u,l,h,d,f,p,g,v,y;return i(this,(function(i){for(r=o.NOOP,c=new Promise((function(e){return r=e})),u=0,l=0,h=n.length;l<h;++l)for(d=n[l],f=0,p=t.length;f<p;++f)g=t[f],(v=g.getEasing(d))&&(s&&s(v,g,f,l),u=Math.max((v.delay||0)+v.duration,u));return y=function(e){e<u?a.onFrame(y):r()},e?a.onFrame((function(e){u+=e,y(e)})):r(),[2,c]}))}))},e}();t.EasingUtil=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(28);t.extendShader=function(e,t){var n={vs:e.vs,fs:e.fs};return t.vs&&(n.vs=r.shaderTemplate({options:{},required:{name:"Shader Extension",values:[]},shader:e.vs,onToken:function(e){return"${"+e+"}"},onMain:function(e){return null===e?(console.warn("Could not extend the shader as the void main method could not be determined"),""):t.vs?{header:t.vs.header||"",main:t.vs.main?(t.vs.main.pre||"")+"\n"+e+"\n"+(t.vs.main.post||""):e}:e}}).shader),t.fs&&(n.fs=r.shaderTemplate({options:{},required:{name:"Shader Extension",values:[]},shader:e.fs,onToken:function(e){return"${"+e+"}"},onMain:function(e){return null===e?(console.warn("Could not extend the shader as the void main method could not be determined"),""):t.fs?{header:t.fs.header||"",main:t.fs.main?(t.fs.main.pre||"")+"\n"+e+"\n"+(t.fs.main.post||""):e}:e}}).shader),{fs:n.fs,instanceAttributes:(e.instanceAttributes||[]).concat(t.instanceAttributes||[]),uniforms:(e.uniforms||[]).concat(t.uniforms||[]),vertexAttributes:(e.vertexAttributes||[]).concat(t.vertexAttributes||[]),vertexCount:e.vertexCount,vs:n.vs}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shallowEqual=function(e,t){return e&&t?!Boolean(Object.keys(Object.assign({},e,t)).find((function(n){return e[n]!==t[n]}))):e===t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wait=function(e){return new Promise((function(t){return setTimeout(t,e)}))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(53),a=n(6),s=n(68),c=n(54),u=n(7),l=n(3),h=n(16),d=n(76),f=n(133),p=n(0),g=n(0),v=n(1),y=n(135),m=n(43),b=n(136),w=n(137),x=n(138),T=n(139),_=n(42),E=n(38);t.DEFAULT_IO_EXPANSION=[new x.BasicIOExpansion,new f.ActiveIOExpansion,new T.EasingIOExpansion],t.DEFAULT_RESOURCE_MANAGEMENT=[{type:p.ResourceType.ATLAS,manager:new d.AtlasResourceManager({})},{type:p.ResourceType.FONT,manager:new h.FontResourceManager}];var A=[0,0,0,0];function M(e,t){return(e.order||Number.MAX_SAFE_INTEGER)-(t.order||Number.MAX_SAFE_INTEGER)}var S=function(){function e(e){var t=this;this.frameMetrics={currentFrame:0,currentTime:0|Date.now(),frameDuration:1e3/60,previousTime:0|Date.now()},this.isBufferingResources=!1,this.ioExpanders=[],this.ioSorting=new b.BaseIOSorting,this.layers=new Map,this.pixelRatio=window.devicePixelRatio,this.viewDrawDependencies=new Map,this.resourceDiffs=new m.ReactiveDiff({buildItem:function(e){return r(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.resourceManager.initResource(e)];case 1:return t.sent(),[2,{id:e.key}]}}))}))},destroyItem:function(e,n){return r(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.resourceManager.destroyResource(e)];case 1:return t.sent(),[2,!0]}}))}))},updateItem:function(e,n){return r(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.resourceManager.updateResource(e)];case 1:return t.sent(),[2]}}))}))}}),this.sceneDiffs=new m.ReactiveDiff({buildItem:function(e){return r(t,void 0,void 0,(function(){return i(this,(function(t){return[2,new _.LayerScene(this,{key:e.key,views:e.views,layers:e.layers})]}))}))},destroyItem:function(e,n){return r(t,void 0,void 0,(function(){return i(this,(function(e){return n.destroy(),[2,!0]}))}))},updateItem:function(e,n){return r(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,n.update(e)];case 1:return t.sent(),[2]}}))}))}}),this.readyResolver=new v.PromiseResolver,this.ready=this.readyResolver.promise,e&&this.init(e)}return Object.defineProperty(e.prototype,"gl",{get:function(){return this.context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scenes",{get:function(){return this.sceneDiffs.items},enumerable:!0,configurable:!0}),e.prototype.getIOExpanders=function(){return this.ioExpanders},e.prototype.getIOSorting=function(){return this.ioSorting},e.prototype.analyzePickRendering=function(){if(this.queuedPicking){for(var e=0,t=this.queuedPicking.length;e<t;++e){var n=this.queuedPicking[e],r=n[1],i=n[2],o=n[3];if(!r.optimizeRendering){var a=new Uint8Array(100);this.renderer.readPixels(Math.floor(o[0]-2.5),Math.floor(o[1]-2.5),5,5,a);for(var s=y.analyzeColorPickingRendering([o[0]-r.screenBounds.x,o[1]-r.screenBounds.y],a,5,5),c=0,u=i.length;c<u;++c){var l=i[c];l.picking.type===g.PickType.SINGLE&&(l.interactions.colorPicking=s)}}}delete this.queuedPicking}},e.prototype.commit=function(e,t,n){return r(this,void 0,void 0,(function(){var r,o,a,s,l,h,d,f,p,v,y,m,b,w,x,T,_,E,A,S,O,I;return i(this,(function(i){if(!this.gl)return[2];for(r=!1,t&&this.frameMetrics.currentFrame++,this.frameMetrics.frameDuration=this.frameMetrics.currentTime-this.frameMetrics.previousTime,this.frameMetrics.previousTime=this.frameMetrics.currentTime,void 0===e?this.frameMetrics.currentTime=0|Date.now():(this.frameMetrics.previousTime===this.frameMetrics.currentTime&&(this.frameMetrics.previousTime=e),this.frameMetrics.currentTime=e),e=this.frameMetrics.currentTime,(o=this.sceneDiffs.items).sort(M),a={},s=new Map,x=0,T=o.length;x<T;++x){for(_=o[x],E=_.views,l=_.layers,h={},E.sort(M),l.sort(M),A=0,S=E.length;A<S;++A){for(O=E[A],d=[],f=new u.Bounds({height:this.context.canvas.height,width:this.context.canvas.width,x:0,y:0}),p=c.getAbsolutePositionBounds(O.props.viewport,f,this.pixelRatio),O.fitViewtoViewport(f,p),v=0,y=l.length;v<y;++v){(m=l[v]).view=O;try{m.draw(),m.needsViewDrawn&&(O.needsDraw=!0),h[m.id]=m,O.animationEndTime=Math.max(O.animationEndTime,m.animationEndTime,O.props.camera.animationEndTime),m.lastFrameTime=e}catch(e){a[m.id]||(a[m.id]=[m,e])}m.picking.type===g.PickType.SINGLE&&d.push(m)}O.needsDraw||e&&e<O.lastFrameTime||O.props.camera.needsViewDrawn,O.needsDraw=!0,r=!0,(b=this.viewDrawDependencies.get(O))&&b.forEach((function(e){e.needsDraw=!0})),s.set(O,d)}w=Object.values(h),l.length!==w.length&&_.layerDiffs.diff(w.map((function(e){return e.initializer})))}for(x=0,T=o.length;x<T;++x)if((_=o[x]).container)for(E=_.views,A=0,S=E.length;A<S;++A)O=E[A],n&&n(r,_,O,s.get(O)||[]);return(I=Object.values(a)).length>0&&(console.warn("Some layers errored during their draw update. These layers will be removed. They can be re-added if render() is called again:",I.map((function(e){return e[0].id}))),I.forEach((function(e){if(console.warn("Layer "+e[0].id+" removed for the following error:"),e[1]){var t=e[1].stack||e[1].message;if(console.error(t),t.indexOf("RangeError")>-1||t.indexOf("Source is too large")>-1){for(var n,r=e[0],i=r.bufferManager.changeListContext,o=0,a=function(e,t){var a=i[e][0];r.instanceAttributes.forEach((function(e){e.update(a).length!==e.size&&(n||(n=["Example instance returned the wrong sized value for an attribute:",a,e]),o++)}))},s=0,c=i.length;s<c;++s)a(s);n&&(console.error("The following output shows discovered issues related to the specified error"),console.error("Instances are returning too large IO for an attribute\n",n[0],n[1],n[2],"Total errors for too large IO values",o))}}}))),[2]}))}))},e.prototype.destroy=function(){this.layers.forEach((function(e){return e.destroy()})),this.resourceManager.destroy(),this.mouseManager.destroy(),this.sceneDiffs.destroy(),this.renderer.dispose(),this.pickingTarget.dispose(),delete this.context},e.prototype.draw=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,a,s,c,u,l,h,d,f,p=this;return i(this,(function(i){switch(i.label){case 0:if(!this.gl)return[2];for(this.analyzePickRendering(),t=[],h=0,d=this.sceneDiffs.items.length;h<d;++h)for(s=this.sceneDiffs.items[h],n=0,r=s.views.length;n<r;++n)(l=s.views[n]).props.camera.broadcast(l.id);return[4,this.commit(e,!0,(function(e,n,r,i){n.container&&(e&&p.drawSceneView(n.container,r),i.length>0&&p.updateColorPick&&t.push([n,r,i]))}))];case 1:return i.sent(),this.mouseManager.waitingForRender&&(this.mouseManager.waitingForRender=!1),this.isBufferingResources?[3,4]:(this.isBufferingResources=!0,[4,this.resourceManager.dequeueRequests()]);case 2:return o=i.sent(),this.isBufferingResources=!1,o?(a=this.draw,[4,v.onFrame()]):[3,4];case 3:a.apply(this,[i.sent()]),i.label=4;case 4:for(h=0,d=this.sceneDiffs.items.length;h<d;++h)for(s=this.sceneDiffs.items[h],c=0,u=s.views.length;c<u;++c)(l=s.views[c]).needsDraw=!1,l.props.camera.resolve();for(this.layers.forEach((function(e){e.needsViewDrawn=!1,e.props.data.resolveContext=""})),h=0,d=t.length;h<d;++h)f=t[h],this.drawPicking(f[0],f[1],f[2])&&f.length>0&&!f[1].optimizeRendering&&this.updateColorPick&&(this.queuedPicking||(this.queuedPicking=[]),this.queuedPicking.push([f[0],f[1],f[2],this.updateColorPick.position]));return delete this.updateColorPick,[2]}}))}))},e.prototype.drawPicking=function(e,t,n){if(!this.updateColorPick)return!1;if(!e.container)return!1;if(t.optimizeRendering)return!1;if(this.updateColorPick.views.indexOf(t)>-1){t.pixelRatio=1;var r=t.clearFlags.slice(0),i=t.props.background&&l.copy4(t.props.background);t.props.clearFlags=[E.ClearFlags.COLOR,E.ClearFlags.DEPTH],t.props.background=[0,0,0,0];var o=new u.Bounds({height:this.pickingTarget.height,width:this.pickingTarget.width,x:0,y:0}),a=c.getAbsolutePositionBounds(t.props.viewport,o,1);t.fitViewtoViewport(o,a);for(var s=0,h=n.length;s<h;++s){var d=n[s];d.picking.currentPickMode=g.PickType.SINGLE;try{d.updateUniforms()}catch(e){console.warn(e)}d.picking.currentPickMode=g.PickType.NONE}return this.drawSceneView(e.container,t,this.renderer,this.pickingTarget),t.pixelRatio=this.pixelRatio,t.props.clearFlags=r,t.props.background=i,o=new u.Bounds({height:this.context.canvas.height,width:this.context.canvas.width,x:0,y:0}),a=c.getAbsolutePositionBounds(t.props.viewport,o,this.pixelRatio),t.fitViewtoViewport(o,a),!0}return!1},e.prototype.drawSceneView=function(e,t,n,r){n=n||this.renderer;var i={x:t.viewBounds.left,y:t.viewBounds.top},o=t.viewBounds,a=t.props.background||A,s=t.clearFlags.indexOf(E.ClearFlags.COLOR)>-1;n.setRenderTarget(r||null),n.setScissor({x:i.x,y:i.y,width:o.width,height:o.height},r),s&&n.clearColor([a[0],a[1],a[2],a[3]]),n.setViewport({x:i.x,y:i.y,width:o.width,height:o.height}),t.clearFlags&&t.clearFlags.length>0?n.clear(s,t.clearFlags.indexOf(E.ClearFlags.DEPTH)>-1,t.clearFlags.indexOf(E.ClearFlags.STENCIL)>-1):n.clear(!1),n.render(e,r),t.lastFrameTime=this.frameMetrics.currentTime},e.prototype.gatherViewDrawDependencies=function(){if(this.sceneDiffs){this.viewDrawDependencies.clear();for(var e=this.sceneDiffs.items,t=0,n=e.length;t<n;t++)for(var r=0,i=(l=e[t]).views.length;r<i;++r){var o=l.views[r],a=new u.Bounds({height:this.context.canvas.height,width:this.context.canvas.width,x:0,y:0}),s=c.getAbsolutePositionBounds(o.props.viewport,a,this.pixelRatio);o.fitViewtoViewport(a,s)}for(t=0,n=e.length;t<n;t++){var l;for(r=0,i=(l=e[t]).views.length;r<i;++r){for(var h=l.views[r],d=[],f=0,p=e.length;f<p;f++)if(f!==t)for(var g=e[f],v=0,y=g.views.length;v<y;++v){var m=g.views[v];h.viewBounds.hitBounds(m.viewBounds)&&d.push(m)}this.viewDrawDependencies.set(h,d)}}}},e.prototype.getViewSize=function(e){for(var t=0,n=this.sceneDiffs.items.length;t<n;++t){var r=this.sceneDiffs.items[t].viewDiffs.getByKey(e);if(r)return r.screenBounds}return null},e.prototype.getViewWorldBounds=function(e){for(var t=0,n=this.sceneDiffs.items.length;t<n;++t){var r=this.sceneDiffs.items[t].viewDiffs.getByKey(e);if(r){if(r.screenBounds){var i=r.projection.viewToWorld([0,0]),o=r.projection.screenToWorld([r.screenBounds.right,r.screenBounds.bottom]);return new u.Bounds({bottom:o[1],left:i[0],right:o[0],top:i[1]})}return null}}return null},e.prototype.getProjections=function(e){for(var t=0,n=this.sceneDiffs.items.length;t<n;++t){var r=this.sceneDiffs.items[t].viewDiffs.getByKey(e);if(r)return r.projection}return null},e.prototype.init=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.context?[2,this]:(this.pixelRatio=e.pixelRatio||this.pixelRatio,this.pixelRatio<1&&(this.pixelRatio=1),(t=this.initGL(e))?(this.context=t,this.gl?(this.initMouseManager(e),[4,this.initResources(e)]):[3,3]):(this.readyResolver.reject({error:p.SurfaceErrorType.NO_WEBGL_CONTEXT,message:"Could not establish a webgl context. Surface is being destroyed to free resources."}),this.destroy(),[2,this]));case 1:return n.sent(),[4,this.initIOExpanders(e)];case 2:return n.sent(),[3,4];case 3:console.warn("Could not establish a GL context. Layer Surface will be unable to render"),n.label=4;case 4:return this.readyResolver.resolve(this),[2,this]}}))}))},e.prototype.initGL=function(e){var t=e.context;if(!t)return null;var n=t.width,r=t.height,i=!0,o=Object.assign({alpha:!1,antialias:!1,preserveDrawingBuffer:!1,premultiplyAlpha:!1},e.rendererOptions);return this.renderer=new s.WebGLRenderer({alpha:o.alpha,antialias:o.antialias,canvas:t,preserveDrawingBuffer:o.preserveDrawingBuffer,premultipliedAlpha:o.premultipliedAlpha,onNoContext:function(){i=!1}}),i&&this.renderer.gl?(this.context=this.renderer.gl,this.resourceManager&&this.resourceManager.setWebGLRenderer(this.renderer),this.pickingTarget=new a.RenderTarget({buffers:{color:new a.Texture({generateMipMaps:!1,data:{width:n,height:r,buffer:null}}),depth:a.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT16},width:n,height:r}),this.setRendererSize(n,r),this.renderer.setPixelRatio(this.pixelRatio),this.renderer.gl):null},e.prototype.initIOExpanders=function(e){Array.isArray(e.ioExpansion)||void 0===e.ioExpansion?this.ioExpanders=e.ioExpansion&&e.ioExpansion.slice(0)||t.DEFAULT_IO_EXPANSION&&t.DEFAULT_IO_EXPANSION.slice(0)||[]:e.ioExpansion instanceof Function&&(this.ioExpanders=e.ioExpansion(t.DEFAULT_IO_EXPANSION));var n=this.resourceManager.getIOExpansion();this.ioExpanders=this.ioExpanders.concat(n)},e.prototype.initMouseManager=function(e){var t=[new w.LayerMouseEvents].concat(e.eventManagers||[]);this.mouseManager=new o.UserInputEventManager(this.context.canvas,this,t,e.handlesWheelEvents)},e.prototype.initResources=function(e){return r(this,void 0,void 0,(function(){var n=this;return i(this,(function(r){return this.resourceManager=new h.ResourceRouter,this.resourceManager.setWebGLRenderer(this.renderer),(e.resourceManagers&&e.resourceManagers.slice(0)||t.DEFAULT_RESOURCE_MANAGEMENT&&t.DEFAULT_RESOURCE_MANAGEMENT.slice(0)||[]).forEach((function(e){n.resourceManager.setManager(e.type,e.manager)})),[2]}))}))},e.prototype.pipeline=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return e.resources?[4,this.resourceDiffs.diff(e.resources)]:[3,2];case 1:t.sent(),t.label=2;case 2:return e.scenes?[4,this.sceneDiffs.diff(e.scenes)]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.gatherViewDrawDependencies(),[2]}}))}))},e.prototype.fitContainer=function(e){var t=this.context.canvas.parentElement;if(t){var n=this.context.canvas;n.className="",n.setAttribute("style",""),t.style.position="relative",n.style.position="absolute",n.style.left="0xp",n.style.top="0xp",n.style.width="100%",n.style.height="100%",n.setAttribute("width",""),n.setAttribute("height","");var r=t.getBoundingClientRect(),i=n.getBoundingClientRect();this.resize(i.width||100,r.height||100)}},e.prototype.resize=function(e,t,n){if(this.pixelRatio=n||this.pixelRatio,this.pixelRatio<1&&(this.pixelRatio=1),this.sceneDiffs)for(var r=this.sceneDiffs.items,i=0,o=r.length;i<o;++i)for(var a=r[i],s=0,c=a.views.length;s<c;++s){a.views[s].pixelRatio=this.pixelRatio}this.setRendererSize(e,t),this.renderer.setPixelRatio(this.pixelRatio),this.mouseManager.resize(),this.gatherViewDrawDependencies()},e.prototype.setRendererSize=function(e,t){e=e||100,t=t||100,this.renderer.setSize(e,t),this.pickingTarget.setSize(e,t)},e.prototype.updateColorPickPosition=function(e,t){this.updateColorPick={position:e,views:t}},e}();t.Surface=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1),this._isInstanced=!1,this._fullUpdate=!1,this.normalize=!1,this._updateRange={count:-1,offset:-1},this.data=e,this.size=t,this._isDynamic=n,this._isInstanced=r}return Object.defineProperty(e.prototype,"isDynamic",{get:function(){return this._isDynamic},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInstanced",{get:function(){return this._isInstanced},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullUpdate",{get:function(){return this._fullUpdate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsUpdate",{get:function(){return this._needsUpdate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updateRange",{get:function(){return this._updateRange},set:function(e){this._updateRange=e,this._needsUpdate=!0},enumerable:!0,configurable:!0}),e.prototype.resolve=function(){this._needsUpdate=!1,this._fullUpdate=!1},e.prototype.setDynamic=function(e){this._isDynamic=e,this._needsUpdate=!0,this._fullUpdate=!0},e}();t.Attribute=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._attributes={},this.gl={},this.maxInstancedCount=0,this.isInstanced=!1}return Object.defineProperty(e.prototype,"attributes",{get:function(){return new Map(Object.entries(this._attributes))},enumerable:!0,configurable:!0}),e.prototype.addAttribute=function(e,t){var n,r=this;this._attributes[e]=t,this.isInstanced=!1,Object.values(this._attributes).forEach((function(e){var t=e.isInstanced?1:0;void 0===n&&(n=t),1==(n^t)&&(r.isInstanced=!0)}))},e.prototype.removeAttribute=function(e){delete this._attributes[e]},e.prototype.dispose=function(){},e}();t.Geometry=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),i=function(){function e(e){this.blending={blendDst:r.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:r.GLSettings.Material.BlendingEquations.Add,blendSrc:r.GLSettings.Material.BlendingSrcFactor.SrcAlpha},this.colorWrite=[!0,!0,!0,!0],this.culling=r.GLSettings.Material.CullSide.CCW,this.depthFunc=r.GLSettings.Material.DepthFunctions.LESS_OR_EQUAL,this.depthTest=!0,this.depthWrite=!0,this.dithering=!0,this.fragmentShader="",this.name="",this.uniforms={},this.vertexShader="",Object.assign(this,e),delete this.gl}return e.prototype.clone=function(){var t=new e(this);t.blending=Object.assign({},this.blending),t.polygonOffset=Object.assign({},this.polygonOffset),t.uniforms=Object.assign({},this.uniforms);var n=function(e){var n=t.uniforms[e];if(n.gl){var r=new Map;n.gl.forEach((function(e,t){r.set(t,Object.assign({},e))}))}};for(var r in t.uniforms)n(r);return t},e.prototype.dispose=function(){this.gl&&this.gl.proxy.disposeMaterial(this)},e}();t.Material=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),i=function(e,t){this.drawMode=r.GLSettings.Model.DrawMode.TRIANGLES,this.vertexDrawRange=[-1,-1],this.drawInstances=-1,this.vertexCount=0,this.geometry=e,this.material=t};t.Model=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(32),a=n(4)("performance"),s=function(){function e(){this.managers=new Map,this.resourceKeyToType=new Map}return e.prototype.dequeueRequests=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,o;return i(this,(function(i){switch(i.label){case 0:e=!1,t=Array.from(this.managers.values()),n=0,r=t.length,i.label=1;case 1:return n<r?[4,t[n].dequeueRequests()]:[3,4];case 2:o=i.sent(),e=e||o,i.label=3;case 3:return++n,[3,1];case 4:return[2,e]}}))}))},e.prototype.destroy=function(){this.managers.forEach((function(e){return e.destroy()})),this.resourceKeyToType.clear(),this.managers.clear(),delete this.webGLRenderer},e.prototype.destroyResource=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return(t=this.managers.get(e.type))?(this.resourceKeyToType.delete(e.key),[4,t.destroyResource(e)]):(console.warn("A Resource is trying to be destroyed but has no manager to facilitate the operation: "+e.type),[2]);case 1:return[2,n.sent()]}}))}))},e.prototype.getIOExpansion=function(){var e=[];return this.managers.forEach((function(t){e=e.concat(t.getIOExpansion())})),e},e.prototype.getManager=function(e){var t=this.managers.get(e);return t||(console.warn("A manager was requested that does not exist for type "+e),o.INVALID_RESOURCE_MANAGER)},e.prototype.getResourceType=function(e){return this.resourceKeyToType.get(e)},e.prototype.initResource=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return(t=this.managers.get(e.type))?this.resourceKeyToType.has(e.key)?(console.warn("Detected two resources with identical keys. The duplicate resource will not be generated:",e.key),[2]):(this.resourceKeyToType.set(e.key,e.type),[4,t.initResource(e)]):(console.warn("A Resource is trying to be created but has no manager to facilitate the operation: "+e.type),[2]);case 1:return[2,n.sent()]}}))}))},e.prototype.request=function(e,t,n,r){var i=this.managers.get(n.type);return i?i.request(e,t,n,r):(console.warn("A Layer is requesting a resource for which there is no manager set. Please make sure a Resource Manager is set for resource of type: "+n.type),[-1,-1,-1,-1])},e.prototype.setManager=function(e,t){this.managers.get(e)&&a("A manager was assigned to a resource type: "+e+" that overrides another manager already set to that type."),t.router=this,this.managers.set(e,t),t.webGLRenderer=this.webGLRenderer},e.prototype.setWebGLRenderer=function(e){this.webGLRenderer=e,this.managers.forEach((function(t){return t.webGLRenderer=e}))},e.prototype.updateResource=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return(t=this.managers.get(e.type))?[4,t.updateResource(e)]:(console.warn("A Resource is trying to be updated but has no manager to facilitate the operation: "+e.type),[2]);case 1:return[2,n.sent()]}}))}))},e}();t.ResourceRouter=s},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(127)),r(n(69)),r(n(70)),r(n(71)),r(n(129)),r(n(73)),r(n(72))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=Math.ceil,o=Math.max,a=Math.log2,s=Math.pow,c=Math.sqrt,u=[-1,-1];function l(e,t,n){void 0===n&&(n=!1);for(var i,a,s,u,l=n?-1:1,h=[],d=-1,f=0,p=e.length;f<p;++f){var g=e[f];h[f]=[];for(var v=0,y=g.length;v<y;++v)(i=g[v])===t?u=256:(a=[f,v],s=r.subtract2(i,a),u=c(r.dot2(s,s))),h[f][v]=u,d=o(u,d)}for(f=0,p=e.length;f<p;++f)for(v=0,y=(g=e[f]).length;v<y;++v)u=h[f][v],h[f][v]=u/d*255*l;return h}function h(e,t,n,r){for(var i,o=l(e,n,!0),a=l(t,n,!1),s=o.length,c=o,u=0,h=o.length;u<h;++u)for(var d=o[u],f=a[u],p=0,g=d.length;p<g;++p){var v=d[p],y=f[p];d[p]=v+y}for(u=0,h=c.length;u<h;++u)for(p=0,g=(d=c[u]).length;p<g;++p){i=i=d[p];var m=p*(4*s)+4*u;r[m]=i,r[m+1]=i,r[m+2]=i,r[m+3]=255}}function d(e,t){for(var n,i,o,a,c,l,h,d,f,p=e.length,g=e[0].length,v=function(e){for(var t=[],n=0,r=e.length;n<r;++n)t[n]=[];return t}(e),y=e,m=0;m<t;++m){var b=v;v=y,y=b;var w=s(2,t-m-1);for(h=0;h<p;++h)for(d=0;d<g;++d){for(n=[h,d],o=[(v[h-w]||[])[d-w]||u,(v[h]||[])[d-w]||u,(v[h+w]||[])[d-w]||u,(v[h-w]||[])[d]||u,(v[h]||[])[d]||u,(v[h+w]||[])[d]||u,(v[h-w]||[])[d+w]||u,(v[h]||[])[d+w]||u,(v[h+w]||[])[d+w]||u],c=0,a=Number.MAX_VALUE,f=0;f<9;++f){var x=o[f];x!==u&&(i=r.subtract2(x,n),(l=r.dot2(i,i))<a&&(a=l,c=f))}y[h][d]=o[c]}}return y}t.convertToSDF=function(e,t){void 0===t&&(t=h);var n=e.width,r=e.height,s=e.getContext("2d");if(s){var c=s.getImageData(0,0,n,r).data,l=o(n,r),f=i(a(l)),p=function(e,t){for(var n=e.width,r=e.height,i=[],o=[],a=0;a<n;++a){i[a]=[],o[a]=[];for(var s=0;s<r;++s){t[s*(4*n)+4*a+3]?(i[a][s]=[a,s],o[a][s]=u):(i[a][s]=u,o[a][s]=[a,s])}}return{seed:i,inverse:o}}(e,c),g=d(p.seed,f),v=d(p.inverse,f),y=new ImageData(n,r);t(g,v,u,y.data),s.putImageData(y,0,0)}},t.makeFontSDF=function(e){}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=document.createElement("img"),s=document.createElement("canvas");t.svgToData=function(e){return r(this,void 0,void 0,(function(){var t,n,r,c,u,l;return i(this,(function(i){switch(i.label){case 0:return t=new o.PromiseResolver,a&&s?(n=(new XMLSerializer).serializeToString(e),r=btoa(n),"data:image/svg+xml;base64,",c="data:image/svg+xml;base64,"+r,u=!1,l=function(){if(!u){u=!0,s.width=a.width*window.devicePixelRatio,s.height=a.height*window.devicePixelRatio;var e=s.getContext("2d");e?(e.clearRect(0,0,s.width,s.height),e.mozImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1,e.drawImage(a,0,0,a.width*window.devicePixelRatio,a.height*window.devicePixelRatio),t.resolve(e.getImageData(0,0,s.width,s.height)),a.src="",s.width=0,s.height=0,s.style.position="absolute",s.style.top="0px",s.style.zIndex="9999"):t.resolve(null)}},a.onload=l,a.src=c,a.width>0&&a.height>0&&l(),[4,t.promise]):[2,null];case 1:return[2,i.sent()]}}))}))}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(17),u=n(0),l=n(1),h=n(32),d=n(47),f=n(69),p=n(73),g=n(4)("performance");t.fontRequest=function(e){return o({type:u.ResourceType.FONT},e)};var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.requestLookup=new Map,t.requestQueue=new Map,t.resourceLookup=new Map,t.fontManager=new f.FontManager,t}return i(t,e),t.prototype.dequeueRequests=function(){return a(this,void 0,Promise,(function(){var e,t,n,r,i,o;return s(this,(function(a){switch(a.label){case 0:e=!1,t=[],this.requestQueue.forEach((function(e,n){t.push([n,e])})),this.requestQueue.clear(),n=function(n,i){var o,a,c,u,h;return s(this,(function(i){switch(i.label){case 0:return o=t[n],a=o[0],(c=o[1]).length>0?(e=!0,u=c.slice(0),c.length=0,g("Processing requests for resource '%s'",a),[4,r.fontManager.updateFontMap(a,u)]):[3,3];case 1:return i.sent(),[4,r.fontManager.calculateMetrics(a,u)];case 2:i.sent(),(h=r.requestLookup.get(a))?(u.forEach((function(e){var t=h.get(e);if(h.delete(e),t){for(var n=0,r=t.length;n<r;++n){var i=t[n],o=i[0],a=i[1];o.managesInstance(a)&&(a.active=!0)}l.nextFrame((function(){for(var e=new Set,n=0,r=t.length;n<r;++n){var i=t[n][1];e.has(i)||(e.add(i),i.resourceTrigger())}}))}})),g("All requests for resource '%s' are processed",a)):g("There were no Font requests waiting for completion for resource",a),i.label=3;case 3:return[2]}}))},r=this,i=0,o=t.length,a.label=1;case 1:return i<o?[5,n(i,o)]:[3,4];case 2:a.sent(),a.label=3;case 3:return++i,[3,1];case 4:return[2,e]}}))}))},t.prototype.destroy=function(){this.fontManager.destroy()},t.prototype.destroyResource=function(e){var t=this.resourceLookup.get(e.key);t&&(this.fontManager.destroyFontMap(t.id),this.resourceLookup.delete(e.key))},t.prototype.getResource=function(e){return this.resourceLookup.get(e)||null},t.prototype.getIOExpansion=function(){return[new d.TextureIOExpansion(u.ResourceType.FONT,this)]},t.prototype.initResource=function(e){return a(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return f.isFontResource(e)?[4,this.fontManager.createFontMap(e)]:[3,2];case 1:(t=n.sent())&&this.resourceLookup.set(e.key,t),g("Font map created->",t),n.label=2;case 2:return[2]}}))}))},t.prototype.request=function(e,t,n,r){var i=n,o=i.fontMap,a=null;if(o)return i.character&&(a=o.getGlyphTexture(i.character)),a?i.fetch===p.FontResourceRequestFetch.IMAGE_SIZE?[a.pixelWidth,a.pixelHeight]:c.subTextureIOValue(a):i.fetch===p.FontResourceRequestFetch.IMAGE_SIZE?[0,0]:c.subTextureIOValue(null);var s=n.key,u=this.requestLookup.get(s);if(u){var l=u.get(i);if(l)return l.push([e,t]),t.active=!1,i.fetch===p.FontResourceRequestFetch.IMAGE_SIZE?[0,0]:c.subTextureIOValue(a)}else u=new Map,this.requestLookup.set(s,u);t.active=!1;var h=this.requestQueue.get(s);return h||(h=[],this.requestQueue.set(s,h)),h.push(i),u.set(i,[[e,t]]),i.fetch?[0,0]:c.subTextureIOValue(a)},t.prototype.updateResource=function(e){if(f.isFontResource(e)){var t=this.resourceLookup.get(e.key);t&&(l.shallowEqual(e.fontSource,t.fontSource)||g("Font resources currently do not update. To update their properties simply destroy and recreate for now."))}},t}(h.BaseResourceManager);t.FontResourceManager=v},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(74)),r(n(76)),r(n(132)),r(n(48)),r(n(75)),r(n(24)),r(n(17)),r(n(47))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=function(){function e(e,t){var n=this;this.video=e,this.subTexture=t,this.isDestroyed=!1,this.renderedTime=-1,this.previousTime=-1,this.playedFrames=0,this.caughtFrames=0,this.timeFrame=0,this.doUpdate=function(){Math.abs(n.video.currentTime-n.renderedTime)<.015||(n.renderedTime=n.video.currentTime,n.subTexture.update())},this.loop=function(e){n.doUpdate(),n.isDestroyed||o.onFrame(n.loop)},this.addEventListeners()}return e.prototype.addEventListeners=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.isDestroyed?[2]:(e=this.loop,[4,o.onFrame()]);case 1:return e.apply(this,[t.sent()]),[2]}}))}))},e.prototype.destroy=function(){this.video.pause(),this.isDestroyed=!0,this.removeEventListeners()},e.prototype.removeEventListeners=function(){},e}();t.VideoTextureMonitor=a},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=new Image;t.atlasRequest=function(e){return r({type:i.ResourceType.ATLAS,source:o},e)}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(49),a=n(33),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.processAttributeDestructuring=function(e,t,r,i,a,s){return a.find((function(e){return e.name===o.activeAttributeName}))?(this.setDeclaration(t,"__active_attribute_handler__",n(134),"ActiveIOExpansion"),""):""},t}(a.BaseIOExpansion);t.ActiveIOExpansion=s},function(e,t){e.exports="if (_active == 0.0) {\ngl_Position = vec4(0.0, 0.0, 0.0, 1.0);\nreturn;\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.analyzeColorPickingRendering=function(e,t,n,r){for(var i={allColors:[],colorData:t,dataHeight:r,dataWidth:n,mouse:e,nearestColor:0,nearestColorBytes:[0,0,0,0]},o=new Map,a=0,s=[],c=n/2,u=r/2,l=0,h=[0,0,0,0],d=Number.MAX_SAFE_INTEGER,f=0;f<r;++f){var p=[];s.push(p);for(var g=0;g<n;++g){var v=t[a],y=t[a+1],m=t[a+2];a+=4;var b=v<<16|y<<8|m;if(o.set(b,!0),p.push(b),0!==b){var w=g-c,x=f-u,T=w*w+x*x;T<d&&(d=T,l=b,h=[v,y,m,255])}}}return i.allColors=Array.from(o.keys()),i.nearestColor=l,i.nearestColorBytes=h,i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.sortInstanceAttributes=function(e,t){return e.resource&&!t.resource?-1:e.easing&&!t.easing?-1:1},e.prototype.sortVertexAttributes=function(e,t){return 1},e.prototype.sortUniforms=function(e,t){return 1},e}();t.BaseIOSorting=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(36),c=n(0),u=n(1),l=function(e){function t(){var t=e.call(this,{})||this;return t.isOver=new Set,t.isTouchOver=new Map,t}return i(t,e),Object.defineProperty(t.prototype,"scenes",{get:function(){return this.surface&&this.surface.sceneDiffs?this.surface.sceneDiffs.items:[]},enumerable:!0,configurable:!0}),t.prototype.getSceneViewsUnderMouse=function(e){for(var t=new Map,n=0,r=this.scenes.length;n<r;++n)for(var i=this.scenes[n],o=0,a=i.views.length;o<a;++o){var s=i.views[o];t.set(s.id,s)}return e.target.views.map((function(e){return t.get(e.view.id)})).filter(u.isDefined)},t.prototype.handleClick=function(e){this.handleInteraction(e,(function(t,n){t.interactions.handleMouseClick(n,e)}))},t.prototype.handleTap=function(e){var t=this;e.touches.forEach((function(n){t.handleInteraction(n,(function(t,r){t.interactions.handleTap(r,e,n)}))}))},t.prototype.handleDrag=function(e){this.handleInteraction(e,(function(t,n){t.interactions.handleMouseDrag(n,e)}))},t.prototype.handleMouseDown=function(e){this.handleInteraction(e,(function(t,n){return t.interactions.handleMouseDown(n,e)}))},t.prototype.handleTouchDown=function(e){return o(this,void 0,void 0,(function(){var t,n=this;return a(this,(function(r){switch(r.label){case 0:return t=[],e.touches.forEach((function(e){e.target.views.forEach((function(e){return t.push(e.view)}))})),this.surface&&this.surface.updateColorPickPosition(e.touches[0].screen.position,t),[4,u.nextFrame()];case 1:return r.sent(),e.touches.forEach((function(t){n.handleInteraction(t,(function(n,r){return n.interactions.handleTouchDown(r,e,t)}))})),[2]}}))}))},t.prototype.handleMouseUp=function(e){this.handleInteraction(e,(function(t,n){return t.interactions.handleMouseUp(n,e)}))},t.prototype.handleTouchUp=function(e){var t=this;e.touches.forEach((function(n){t.handleInteraction(n,(function(t,r){return t.interactions.handleTouchUp(r,e,n)}))}))},t.prototype.handleMouseOut=function(e){var t=this;this.isOver.forEach((function(n){t.handleView(n,(function(t,n){return t.interactions.handleMouseOut(n,e)}))})),this.isOver.clear()},t.prototype.handleTouchOut=function(e){var t=this;e.touches.forEach((function(n){u.mapGetWithDefault(t.isTouchOver,n.touch.touch.identifier,new Set).forEach((function(r){t.handleView(r,(function(t,r){return t.interactions.handleTouchOut(r,e,n)}))})),t.isOver.clear()}))},t.prototype.handleMouseMove=function(e){var t=this;this.surface&&this.surface.updateColorPickPosition(e.screen.position,e.target.views.map((function(e){return e.view})));var n=this.handleInteraction(e,(function(t,n){return t.interactions.handleMouseMove(n,e)})),r=new Set;n.forEach((function(e){return r.add(e)})),this.isOver.forEach((function(n){r.has(n)||t.handleView(n,(function(t,n){return t.interactions.handleMouseOut(n,e)}))})),r.forEach((function(n){t.isOver.has(n)||t.handleView(n,(function(t,n){return t.interactions.handleMouseOver(n,e)}))})),this.isOver=r},t.prototype.handleTouchDrag=function(e){var t=this;e.touches.forEach((function(n){t.surface&&t.surface.updateColorPickPosition(n.screen.position,n.target.views.map((function(e){return e.view})));var r=t.handleInteraction(n,(function(t,r){return t.interactions.handleTouchMove(r,e,n)})),i=new Set;r.forEach((function(e){return i.add(e)}));var o=u.mapInjectDefault(t.isTouchOver,n.touch.touch.identifier,new Set);o.forEach((function(r){i.has(r)||t.handleView(r,(function(t,r){return t.interactions.handleTouchOut(r,e,n)}))})),i.forEach((function(r){o.has(r)||t.handleView(r,(function(t,r){return t.interactions.handleTouchOver(r,e,n)}))})),t.isTouchOver.set(n.touch.touch.identifier,i)}))},t.prototype.handleInteraction=function(e,t){for(var n=this.getSceneViewsUnderMouse(e),r=0,i=n.length;r<i;++r){var o=n[r];this.handleView(o,t)}return n},t.prototype.handleView=function(e,t){for(var n=0,r=e.scene.layers.length;n<r;++n){var i=e.scene.layers[n];i.picking&&i.picking.type!==c.PickType.NONE&&t(i,e.projection)}},t}(s.SimpleEventHandler);t.LayerMouseEvents=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(49),s=n(31),c=n(33),u=n(0),l="BasicIOExpansion",h=["x","y","z","w"],d={1:"float",2:"vec2",3:"vec3",4:"vec4",9:"mat3",16:"mat4",99:"vec4"};var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.generateUniformAttributePacking=function(e,t){return this.setDeclaration(e,a.uniformBufferInstanceBufferName,"\n// Instance Attributes as a packed Uniform Buffer\nuniform vec4 "+a.uniformBufferInstanceBufferName+"["+t.totalInstanceUniformBlocks+"];\n",l),this.setDeclaration(e,"instanceSize","int instanceSize = "+t.totalInstanceUniformBlocks+";",l),this.setDeclaration(e,"getBlock","vec4 getBlock(int index, int instanceIndex) { return "+a.uniformBufferInstanceBufferName+"[(instanceSize * instanceIndex) + index]; }",l),{injection:"",material:{uniforms:[{name:a.uniformBufferInstanceBufferName,type:s.MaterialUniformType.VEC4_ARRAY,value:new Array(t.totalInstanceUniformBlocks).fill(0).map((function(){return[0,0,0,0]}))}]}}},t.prototype.processAttributeDestructuring=function(e,t,n,r,i,o){var a="",s=i.slice(0);switch(e.bufferType){case u.LayerBufferType.INSTANCE_ATTRIBUTE:a=this.processDestructuringInstanceAttribute(t,s);break;case u.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING:a=this.processDestructuringInstanceAttributePacking(t,s);break;case u.LayerBufferType.UNIFORM:a=this.processDestructuringUniformBuffer(t,s,n.blocksPerInstance)}return e.picking.type===u.PickType.SINGLE&&(a+="\n// This portion is where the shader assigns the picking color that gets passed to the fragment shader\n_picking_color_pass_ = _pickingColor;\n"),a},t.prototype.processDestructuringInstanceAttribute=function(e,t){return""},t.prototype.processDestructuringInstanceAttributePacking=function(e,t){var n="";return n+=this.processDestructureBlocks(e,t)},t.prototype.processDestructuringUniformBuffer=function(e,t,n){this.setDeclaration(e,"instanceIndex","int instanceIndex = int(instance);",l);for(var r=0;r<n;++r)this.setDeclaration(e,"block"+r,"  vec4 block"+r+" = getBlock("+r+", instanceIndex);\n",l);return this.processDestructureBlocks(e,t)},t.prototype.processDestructureBlocks=function(e,t){var n=this;return t.forEach((function(t){var r,i,o=t.block||0;t.size===u.InstanceAttributeSize.MAT4X4?n.setDeclaration(e,t.name,"  "+d[t.size]+" "+t.name+" = mat4(block"+o+", block"+(o+1)+", block"+(o+2)+", block"+(o+3)+");\n",l):t.size===u.InstanceAttributeSize.FOUR?n.setDeclaration(e,t.name,"  "+d[t.size]+" "+t.name+" = block"+o+";\n",l):n.setDeclaration(e,t.name,"  "+d[t.size||1]+" "+t.name+" = block"+o+"."+(r=t.blockIndex||0,i=t.size||1,h.slice(r,r+i).join(""))+";\n",l)})),""},t.prototype.processHeaderInjection=function(e,t,n,r,i,a,s){var c={injection:""};e===u.ShaderInjectionTarget.VERTEX&&(c=this.processAttributeHeader(t,n,r,i,a));var l=this.processUniformHeader(t,s,e);return o({},c,{injection:c.injection+l})},t.prototype.processAttributeHeader=function(e,t,n,r,i){var o=void 0,a="// Shader input\n";if(t.bufferType===u.LayerBufferType.UNIFORM&&i.length>0){var s=this.generateUniformAttributePacking(e,n);o=s.material,a+=s.injection}return a+=this.processVertexAttributes(e,r),t.bufferType===u.LayerBufferType.INSTANCE_ATTRIBUTE&&i.length>0&&(a+=this.processInstanceAttributeBufferStrategy(e,i)),t.bufferType===u.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING&&i.length>0&&(a+=this.processInstanceAttributePackingBufferStrategy(e,n.instanceMaxBlock)),{injection:a,material:o}},t.prototype.processUniformHeader=function(e,t,n){var r=this,i=n||u.ShaderInjectionTarget.VERTEX;return t.forEach((function(t){t.shaderInjection=t.shaderInjection||u.ShaderInjectionTarget.VERTEX,t.shaderInjection!==i&&t.shaderInjection!==u.ShaderInjectionTarget.ALL||r.setDeclaration(e,t.name,"uniform "+(t.qualifier||"")+(t.qualifier?" ":"")+d[t.size]+" "+t.name+";\n",l)})),""},t.prototype.processInstanceAttributeBufferStrategy=function(e,t){var n=this;return t.forEach((function(t){n.setDeclaration(e,t.name,"attribute "+d[t.size||1]+" "+(t.qualifier||"")+(t.qualifier?" ":"")+" "+t.name+";\n",l)})),""},t.prototype.processInstanceAttributePackingBufferStrategy=function(e,t){for(var n=0,r=t+1;n<r;++n)this.setDeclaration(e,"block"+n,"attribute "+d[u.InstanceAttributeSize.FOUR]+" block"+n+";\n",l);return""},t.prototype.processVertexAttributes=function(e,t){var n=this;return t.forEach((function(t){n.setDeclaration(e,t.name,"attribute "+d[t.size]+" "+(t.qualifier||"")+(t.qualifier?" ":"")+t.name+";\n",l)})),""},t}(c.BaseIOExpansion);t.BasicIOExpansion=f},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(41),a=n(3),s=n(0),c=n(77),u=n(28),l=n(33),h="EasingIOExpansion",d=Math.abs,f=Math.max,p={duration:0,start:[0],end:[0],startTime:0},g={1:"float",2:"vec2",3:"vec3",4:"vec4",9:"mat3",16:"mat4",99:"vec4"},v="easingMethod",y="T";var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.baseAttributeName=new Map,t}return i(t,e),t.prototype.expand=function(e,t,n,r){for(var i,u=new Set,l=[],h=[],g=0,v=t;g<v.length;g++){var y=v[g];i=y,Boolean(i)&&i.easing&&void 0!==i.size&&i.size<=4&&l.push(y)}var m={};e.easingId=m;for(var b=function(t,n){var r=l[t],i=r.easing,g=i.cpu,v=i.loop,y=i.uid,b=r.name,x=r.size,T=r.update,_=y;w.baseAttributeName.set(r,r.name),r.name="_"+r.name+"_end",m[r.name]=_,u.has(_)&&console.error("Undefined behavior occurs if you reuse an IAutoEasingMethod. Please ensure you are using uid() from the util to give the IAutoEasingMethod its uid, or just use the default provided methods"),u.add(_);var E,A,M,S,O,I,P,R,L,C,N,D={values:p};r.update=function(t){if(L=e.surface.frameMetrics,A=r.easing.delay,M=r.easing.duration,P=T(t),R=L.currentTime,C=t.easing.get(_),N&&C?t.reactivate&&(N.copy(P,C.end),N.copy(P,C.end),C.startTime=R):(N=a.VecMath(P),C=new c.EasingProps({duration:M,end:N.copy(P),start:N.copy(P),startTime:R}),t.easing.set(_,C)),S=M,E=A,(O=C).isTimeSet&&(S=O.duration||M,E=O.delay||0),!O.isManualStart){switch(I=1,v){case o.AutoEasingLoopStyle.CONTINUOUS:I=(R-O.startTime)/S;break;case o.AutoEasingLoopStyle.REPEAT:I=(R-O.startTime)/S%1;break;case o.AutoEasingLoopStyle.REFLECT:var n=(R-O.startTime)/S;I=2*d(n/2%1-.5);break;case o.AutoEasingLoopStyle.NONE:default:I=(R-O.startTime)/S}O.start=g(O.start,O.end,I,O.start)}return O.startTime=R+E,N.copy(P,O.end),D.values=O,e.animationEndTime=f(e.animationEndTime,O.startTime+S+L.frameDuration),P},r.childAttributes=r.childAttributes||[];var B={name:"_"+b+"_start",parentAttribute:r,size:x,update:function(e){return D.values.start}};r.childAttributes.push(B),h.push(B);var z={name:"_"+b+"_start_time",parentAttribute:r,size:s.InstanceAttributeSize.ONE,update:function(e){return[D.values.startTime]}};r.childAttributes.push(z),h.push(z);var k={name:"_"+b+"_duration",parentAttribute:r,size:s.InstanceAttributeSize.ONE,update:function(e){return[D.values.duration]}};r.childAttributes.push(k),h.push(k)},w=this,x=0,T=l.length;x<T;++x)b(x);return{instanceAttributes:h,vertexAttributes:[],uniforms:[]}},t.prototype.validate=function(e,t,n,r){var i=!1;return t.forEach((function(e){e.easing&&e.resource&&(console.warn("An instance attribute can not have both easing and resource properties. Undefined behavior will occur."),console.warn(e),i=!0),e.easing&&void 0===e.size&&console.warn("An Instance Attribute with easing MUST have a size declared")})),!i},t.prototype.processAttributeDestructuring=function(e,t,n,r,i,a){for(var s=0,c=i.length;s<c;++s){var u=i[s];if(u.easing&&u.size){var l=this.baseAttributeName.get(u);if(l){this.baseAttributeName.delete(u);var d="_"+l+"_time",f="_"+l+"_duration",p="_"+l+"_start_time";switch(u.easing.loop){case o.AutoEasingLoopStyle.CONTINUOUS:this.setDeclaration(t,d,"  float "+d+" = (currentTime - "+p+") / "+f+";\n",h);break;case o.AutoEasingLoopStyle.REPEAT:this.setDeclaration(t,d,"  float "+d+" = clamp(fract((currentTime - "+p+") / "+f+"), 0.0, 1.0);\n",h);break;case o.AutoEasingLoopStyle.REFLECT:var v="_"+l+"_timePassed",y="_"+l+"_pingPong";this.setDeclaration(t,v,"  float "+v+" = (currentTime - "+p+") / "+f+";\n",h),this.setDeclaration(t,y,"  float "+y+" = abs((fract("+v+" / 2.0)) - 0.5) * 2.0;\n",h),this.setDeclaration(t,d,"  float "+d+" = clamp("+y+", 0.0, 1.0);\n",h);break;case o.AutoEasingLoopStyle.NONE:default:this.setDeclaration(t,d,"  float "+d+" = clamp((currentTime - "+p+") / "+f+", 0.0, 1.0);\n",h)}this.setDeclaration(t,l,"  "+g[u.size]+" "+l+" = "+u.easing.methodName+"(_"+l+"_start, _"+l+"_end, _"+l+"_time);\n",h)}else console.warn("Could not determine a base name for an easing attribute.")}}return""},t.prototype.processHeaderInjection=function(e,t,n,r,i,o,a){var c=this,l={injection:""};if(e!==s.ShaderInjectionTarget.VERTEX)return l;var d=new Map;if(l.injection="// Auto Easing Methods specified by the layer\n",o.forEach((function(e){if(e.easing&&e.size){var t=d.get(e.easing.methodName);t||(t=new Map,d.set(e.easing.methodName,t)),t.set(e.size,e.easing.gpu)}})),0===d.size)return l.injection="",l;var f={name:"Easing Method Generation",values:[v]};return d.forEach((function(e,n){e.forEach((function(e,r){var i,o=g[r],a=((i={})[v]=o+" "+n+"("+o+" start, "+o+" end, float t)",i[y]=""+o,i),s=u.shaderTemplate({options:a,required:f,shader:e});c.setDeclaration(t,o+" "+n,s.shader+"\n",h)}))})),l},t}(l.BaseIOExpansion);t.EasingIOExpansion=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=n(0),o=function(){function e(e){this.index=0,this.available=4,this.index=e}return e.prototype.setAttribute=function(e){return(e.size||0)<=this.available&&(e.block=this.index,e.blockIndex=4-this.available,this.available-=e.size||0,!0)},e}();t.packAttributes=function(e){!function(e){e.forEach((function(e){if(e.resource&&void 0===e.size&&(e.size=i.InstanceAttributeSize.FOUR),!e.size)try{var t=e.update(new r.Instance({}));t.length>0&&t.length<=i.InstanceAttributeSize.FOUR&&(e.size=t.length)}catch(t){console.warn("The system could not determine the size of the provided attribute. Please provide the size of the attribute:",e)}}))}(e);var t=[];e.forEach((function(e){if(e.size&&e.size===i.InstanceAttributeSize.MAT4X4){e.block=t.length,e.blockIndex=0;for(var n=0;n<4;++n){(r=new o(t.length)).available=0,r.index=0,t.push(r)}}else{if(!t.find((function(t){return!!t.setAttribute(e)&&Boolean(t)}))){var r=new o(t.length);t.push(r),r.setAttribute(e)||console.warn("There was a problem packing an attribute into a block. No block would accommodate it:",e)}}}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(80),i=n(0),o=n(28),a=n(142),s=n(143),c=n(63),u=function(){function e(){this.metricsProcessing=new s.MetricsProcessing}return e.prototype.process=function(e,t,n,s){var c;try{var u=this.processImports(e,t);if(!u)return null;var l=r.injectShaderIO(e.surface.gl,e,t,n,s,u),h=l.vertexAttributes,d=l.instanceAttributes,f=l.uniforms;e.getLayerBufferType(e.surface.gl,h,d),this.metricsProcessing.process(d,f);for(var p="",g="",v="",y={uniforms:[]},m=new Map,b=new Map,w=new Map,x=0,T=n.length;x<T;++x){var _=n[x],E=_.processHeaderInjection(i.ShaderInjectionTarget.VERTEX,m,e,this.metricsProcessing,h,d,f);p+=E.injection,E.material&&(y.uniforms=y.uniforms.concat(E.material.uniforms||[]));var A=_.processHeaderInjection(i.ShaderInjectionTarget.FRAGMENT,b,e,this.metricsProcessing,h,d,f);g+=A.injection,A.material&&(y.uniforms=y.uniforms.concat(A.material.uniforms||[])),v+=_.processAttributeDestructuring(e,w,this.metricsProcessing,h,d,f)}var M="";m.forEach((function(e){M+=e})),p=M+p,M="",b.forEach((function(e){M+=e})),g=M+g,M="",w.forEach((function(e){M+=e})),v=M+v;var S="precision highp float;\n\n"+p+u.vs,O="precision highp float;\n\n"+g+u.fs,I=((c={})[a.templateVars.attributes]=v,c),P=!1,R=o.shaderTemplate({options:I,required:void 0,shader:S,onToken:function(e,t){return e===a.templateVars.attributes&&(P=!0),t},onMain:function(e){return P?e||"":null===e?(console.warn("The body of void main() could not be determined."),""):v+"\n"+e}});return I={},{fs:o.shaderTemplate({options:I,required:void 0,shader:O}).shader.trim(),materialUniforms:y.uniforms,maxInstancesPerBuffer:this.metricsProcessing.maxInstancesPerUniformBuffer,modules:Array.from(u.shaderModuleUnits),vs:R.shader.trim(),vertexAttributes:h,instanceAttributes:d,uniforms:f}}catch(t){return console.warn("An unknown error occurred while processing the shaders for layer:",e.id),console.warn("Error:"),console.warn(t&&(t.stack||t.message)),null}},e.prototype.processImports=function(e,t){var n=new Set,r=e.baseShaderModules(t);e.props.baseShaderModules&&(r=e.props.baseShaderModules(t,r));var o=c.ShaderModule.process(e.id,t.vs,i.ShaderInjectionTarget.VERTEX,r.vs);if(o.errors.length>0)return console.warn.apply(console,["Error processing imports for the vertex shader of layer:",e.id,"Errors"].concat(o.errors.reverse())),null;var a=c.ShaderModule.process(e.id,t.fs,i.ShaderInjectionTarget.FRAGMENT,r.fs);return a.errors.length>0?(console.warn.apply(console,["Error processing imports for the fragment shader of layer:",e.id,"Errors"].concat(a.errors.reverse())),null):(o.shaderModuleUnits.forEach((function(e){return n.add(e)})),a.shaderModuleUnits.forEach((function(e){return n.add(e)})),{fs:a.shader||"",vs:o.shader||"",shaderModuleUnits:n})},e}();t.ShaderProcessor=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.templateVars={attributes:"attributes",easingMethod:"easingMethod",extend:"extend",extendHeader:"extendHeader",T:"T"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(23),i=function(){function e(){}return e.calculateUniformBlockUseage=function(e){for(var t=0,n=0,r=e.length;n<r;++n)t+=Math.ceil(e[n].size/4);return t},e.prototype.process=function(t,n){var i=this;this.instanceMaxBlock=0,t.forEach((function(e){i.instanceMaxBlock=Math.max(i.instanceMaxBlock,e.block||0)})),this.blocksPerInstance=this.instanceMaxBlock+1,this.maxUniforms=r.WebGLStat.MAX_VERTEX_UNIFORMS,this.maxUniformsForInstancing=this.maxUniforms-e.calculateUniformBlockUseage(n),this.maxInstancesPerUniformBuffer=Math.floor(this.maxUniformsForInstancing/this.blocksPerInstance),this.totalInstanceUniformBlocks=this.maxInstancesPerUniformBuffer*this.blocksPerInstance},e}();t.MetricsProcessing=i},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(20)),r(n(145)),r(n(147)),r(n(51))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(2),s=n(0),c=n(81),u=n(9),l=n(25),h=n(20),d=n(4)("performance"),f=Math.max;t.isInstanceAttributeBufferLocation=function(e){return Boolean(e&&e.buffer&&e.buffer.value)};var p=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.allBufferLocations={},r.availableLocations=[],r.currentInstancedCount=0,r.instanceToBufferLocation={},r.maxInstancedCount=0,r.attributeToPropertyIds=new Map,r.updateAllPropertyIdList=[],r.activePropertyId=-1,r.currentAvailableLocation=-1,r.remove=function(e){var t=r.instanceToBufferLocation[e.uid];return t&&(delete r.instanceToBufferLocation[e.uid],r.availableLocations.push(t)),e},r.add=r.doAddWithRegistration,r}return i(t,e),t.prototype.changesProcessed=function(){e.prototype.changesProcessed.call(this),this.availableLocations.splice(0,this.currentAvailableLocation+1),this.currentAvailableLocation=-1},t.prototype.doAddWithRegistration=function(e){var t=this;this.layer.instanceAttributes.forEach((function(n){if(!n.parentAttribute){a.ObservableMonitoring.setObservableMonitor(!0),n.update(e);var r=a.ObservableMonitoring.getObservableMonitorIds(!0);t.attributeToPropertyIds.set(n,r),n===t.layer.activeAttribute&&(t.activePropertyId=r[0])}})),a.ObservableMonitoring.setObservableMonitor(!1),this.makeUpdateAllPropertyIdList();var n=this.resizeBuffer();return this.gatherLocationsIntoGroups(n.newLocations,n.growth),this.add=this.doAdd,this.doAdd(e)},t.prototype.doAdd=function(e){if(this.availableLocations.length<=0||this.currentAvailableLocation>=this.availableLocations.length-1){var t=this.resizeBuffer();this.gatherLocationsIntoGroups(t.newLocations,t.growth)}var n=this.availableLocations[++this.currentAvailableLocation];return n&&this.geometry?(this.instanceToBufferLocation[e.uid]=n,this.currentInstancedCount=this.geometry.maxInstancedCount=f(this.currentInstancedCount,n.instanceIndex+1),this.model&&(this.model.vertexDrawRange=[0,this.layer.instanceVertexCount],this.model.drawInstances=this.currentInstancedCount,0===this.layer.instanceVertexCount&&(this.model.vertexDrawRange[1]=this.model.drawInstances))):console.error("Add Error: Instance Attribute Buffer Manager failed to pair an instance with a buffer location"),n},t.prototype.destroy=function(){this.geometry&&this.geometry.dispose(),this.material&&this.material.dispose(),this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model)},t.prototype.getBufferLocations=function(e){return this.instanceToBufferLocation[e.uid]},t.prototype.getActiveAttributePropertyId=function(){return this.activePropertyId},t.prototype.getUpdateAllPropertyIdList=function(){return this.updateAllPropertyIdList},t.prototype.managesInstance=function(e){return void 0!==this.instanceToBufferLocation[e.uid]},t.prototype.makeUpdateAllPropertyIdList=function(){var e={};this.attributeToPropertyIds.forEach((function(t){e[t[0]]=t[0]})),this.updateAllPropertyIdList=Object.values(e).filter(Boolean)},t.prototype.removeFromScene=function(){this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model),delete this.scene},t.prototype.resizeBuffer=function(){var e=0,t=new Map;if(this.changeListContext){e=1e3;for(var n=0,r=this.changeListContext.length;n<r;++n){var i=this.changeListContext[n];switch(i[1]){case s.InstanceDiffType.CHANGE:case s.InstanceDiffType.INSERT:this.instanceToBufferLocation[i[0].uid]||e++}}}if(d("BEGIN: Resizing unpacked attribute buffer by %d instances",e),this.geometry){this.geometry.dispose(),this.geometry=new o.Geometry;for(var a=this.maxInstancedCount,c=0,h=this.layer.vertexAttributes;c<h.length;c++){(T=h[c]).materialAttribute&&this.geometry.addAttribute(T.name,T.materialAttribute)}this.maxInstancedCount+=e,this.attributes=this.attributes||[];for(var f=0,p=this.attributes;f<p.length;f++){_=(T=p[f]).bufferAttribute,A=T.size||0;if(_.data instanceof Float32Array){(M=new Float32Array(this.maxInstancedCount*A)).set(_.data,0);var g=new o.Attribute(M,A,!0,!0);g.setDynamic(!0),T.bufferAttribute=g,this.geometry.addAttribute(T.name,g);E=t.get(T.name),S=this.allBufferLocations[T.name]||[];this.allBufferLocations[T.name]=S;for(var v=0,y=S.length;v<y;++v)S[v].buffer.value=M;E||(E=[],t.set(T.name,E));for(n=a,P=this.maxInstancedCount;n<P;++n){I={attribute:T,buffer:{value:M},instanceIndex:n,range:[n*A,n*A+A]};E.push(I),S.push(I)}}}this.scene.container&&this.model&&this.scene.container.remove(this.model)}else{this.maxInstancedCount+=e,this.geometry=new o.Geometry;for(var m=0,b=this.layer.vertexAttributes;m<b.length;m++){(T=b[m]).materialAttribute&&this.geometry.addAttribute(T.name,T.materialAttribute)}this.attributes=[];for(var w=0,x=this.layer.instanceAttributes;w<x.length;w++){var T,_,E,A=(T=x[w]).size||0,M=new Float32Array(A*this.maxInstancedCount);(_=new o.Attribute(M,A,!0,!0)).setDynamic(!0),this.geometry.addAttribute(T.name,_),(E=t.get(T.name))||(E=[],t.set(T.name,E));var S=this.allBufferLocations[T.name]||[];this.allBufferLocations[T.name]=S;for(var O=Object.assign({},T,{uid:u.uid(),bufferAttribute:_}),n=0;n<this.maxInstancedCount;++n){var I={attribute:O,buffer:{value:M},instanceIndex:n,range:[n*A,n*A+A]};E.push(I),S.push(I)}this.attributes.push(O)}this.geometry.maxInstancedCount=0,this.material=this.layer.material.clone();n=0;for(var P=this.layer.uniforms.length;n<P;++n){var R=this.layer.uniforms[n];R.materialUniforms.push(this.material.uniforms[R.name])}}return this.scene&&this.model&&this.scene.container&&this.scene.container.remove(this.model),this.material=this.material||this.layer.material.clone(),this.model=l.generateLayerModel(this.geometry,this.material,this.layer.model.drawMode),this.scene&&this.scene.container&&this.model&&this.scene.container.add(this.model),d("COMPLETE: Resizing unpacked attribute buffer"),{growth:e,newLocations:t}},t.prototype.gatherLocationsIntoGroups=function(e,t){if(0!==this.attributeToPropertyIds.size){d("BEGIN: Unpacked attribute manager grouping new buffer locations");var n,r,i,o,a,s,u=[];this.attributeToPropertyIds.forEach((function(t,n){u.push({attribute:n,bufferLocationsForAttribute:e.get(n.name)||[],childBufferLocations:(n.childAttributes||[]).map((function(t){return{location:e.get(t.name)||[],bufferIndex:-1}})),ids:t,bufferIndex:-1})}));for(var l=0;l<t;++l){for(var h={instanceIndex:-1,propertyToBufferLocation:{}},f=0,p=u.length;f<p;++f)if(n=u[f],r=n.attribute,i=n.ids,o=n.bufferLocationsForAttribute)if(a=o[++n.bufferIndex]){if(-1===h.instanceIndex)h.instanceIndex=a.instanceIndex;else if(a.instanceIndex!==h.instanceIndex){c.emitOnce("Instance Attribute Parallelism Error",(function(e,t){console.warn(t+": A buffer location does not have a matching instance index which means the buffer locations are not in parallel with each other somehow. Error count: "+e),console.warn(r.name,a)}));continue}if(r.childAttributes){a.childLocations=[];for(var g=0,v=r.childAttributes.length;g<v;++g){var y=n.childBufferLocations[g];if(y){var m=y.location[++y.bufferIndex];m?a.childLocations.push(m):(s=r.childAttributes[g],c.emitOnce("Instance Attribute Child Attribute Error",(function(e,t){console.warn(t+": A child attribute does not have a buffer location available. Error count: "+e),console.warn("Parent Attribute: "+r.name+" Child Attribute: "+s.name)})))}}}for(g=0,v=i.length;g<v;++g)h.propertyToBufferLocation[i[g]]=a}else c.emitOnce("Instance Attribute Buffer Error",(function(e,t){console.warn(t+": There is an error in forming buffer location groups in InstanceAttributeBufferManager. Error count: "+e)}));else c.emitOnce("Instance Attribute Buffer Error",(function(e,t){console.warn(t+": There is an error in forming buffer location groups in InstanceAttributeBufferManager. Error count: "+e)}));this.availableLocations.push(h)}d("COMPLETE: Unpacked attribute buffer manager buffer location grouping"),c.flushEmitOnce()}},t.prototype.getInstanceCount=function(){return this.maxInstancedCount},t}(h.BufferManagerBase);t.InstanceAttributeBufferManager=p},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.resourceTrigger=function(){},t}(n(10).Instance);t.BasicInstance=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(2),s=n(0),c=n(1),u=n(81),l=n(25),h=n(20),d=Math.max,f=n(4)("performance"),p=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.allBufferLocations={},r.availableLocations=[],r.currentInstancedCount=0,r.instanceToBufferLocation={},r.maxInstancedCount=1e3,r.blockSubAttributesLookup=new Map,r.attributeToPropertyIds=new Map,r.updateAllPropertyIdList=[],r.activePropertyId=-1,r.currentAvailableLocation=-1,r.remove=function(e){var t=r.instanceToBufferLocation[e.uid];return t&&(delete r.instanceToBufferLocation[e.uid],r.availableLocations.push(t)),e},r.add=r.doAddWithRegistration,r}return i(t,e),t.prototype.changesProcessed=function(){e.prototype.changesProcessed.call(this),this.availableLocations.splice(0,this.currentAvailableLocation+1),this.currentAvailableLocation=-1},t.prototype.doAddWithRegistration=function(e){var t=this;this.layer.instanceAttributes.forEach((function(n){if(!n.parentAttribute){a.ObservableMonitoring.setObservableMonitor(!0),n.update(e);var r=a.ObservableMonitoring.getObservableMonitorIds(!0);t.attributeToPropertyIds.set(n,r),n===t.layer.activeAttribute&&(t.activePropertyId=r[0])}})),a.ObservableMonitoring.setObservableMonitor(!1),this.makeUpdateAllPropertyIdList();var n=this.resizeBuffer();return this.gatherLocationsIntoGroups(n.newLocations,n.growth),this.add=this.doAdd,this.doAdd(e)},t.prototype.doAdd=function(e){if(this.availableLocations.length<=0||this.currentAvailableLocation>=this.availableLocations.length-1){var t=this.resizeBuffer();this.gatherLocationsIntoGroups(t.newLocations,t.growth)}var n=this.availableLocations[++this.currentAvailableLocation];return n&&this.geometry?(this.instanceToBufferLocation[e.uid]=n,this.currentInstancedCount=this.geometry.maxInstancedCount=d(this.currentInstancedCount,n.instanceIndex+1),this.model&&(this.model.vertexDrawRange=[0,this.layer.instanceVertexCount],this.model.drawInstances=this.currentInstancedCount,0===this.layer.instanceVertexCount&&(this.model.vertexDrawRange[1]=this.model.drawInstances))):console.error("Add Error: Instance Attribute Buffer Manager failed to pair an instance with a buffer location"),n},t.prototype.destroy=function(){this.geometry&&this.geometry.dispose(),this.material&&this.material.dispose(),this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model)},t.prototype.getBufferLocations=function(e){return this.instanceToBufferLocation[e.uid]},t.prototype.getActiveAttributePropertyId=function(){return this.activePropertyId},t.prototype.getUpdateAllPropertyIdList=function(){return this.updateAllPropertyIdList},t.prototype.managesInstance=function(e){return void 0!==this.instanceToBufferLocation[e.uid]},t.prototype.makeUpdateAllPropertyIdList=function(){var e={};this.attributeToPropertyIds.forEach((function(t){e[t[0]]=t[0]})),this.updateAllPropertyIdList=Object.values(e).filter(Boolean)},t.prototype.removeFromScene=function(){this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model),delete this.scene},t.prototype.resizeBuffer=function(){var e=0,t=new Map;if(this.changeListContext){e=1e3;for(var n=0,r=this.changeListContext.length;n<r;++n){var i=this.changeListContext[n];switch(i[1]){case s.InstanceDiffType.CHANGE:case s.InstanceDiffType.INSERT:this.instanceToBufferLocation[i[0].uid]||e++}}}if(f("BEGIN: Resizing packed attribute buffer by %d instances",e),this.geometry){f("Info: Vertex packing buffer is being resized for layer "+this.layer.id),this.geometry.dispose(),this.geometry=new o.Geometry;for(var a=this.maxInstancedCount,u=0,h=this.layer.vertexAttributes;u<h.length;u++){(C=h[u]).materialAttribute&&this.geometry.addAttribute(C.name,C.materialAttribute)}this.maxInstancedCount+=e,this.attributes=this.attributes||[],this.blockAttributes=this.blockAttributes||[];for(_=0,r=this.blockAttributes.length;_<r;++_){I=(C=this.blockAttributes[_]).bufferAttribute;var d=C.size||0;if(I.data instanceof Float32Array){(O=new Float32Array(this.maxInstancedCount*d)).set(I.data,0);var p=new o.Attribute(O,d,!0,!0);C.bufferAttribute=I=p,this.geometry.addAttribute(C.name,p);S=this.blockSubAttributesLookup.get(_),E=C.size||0;if(S)for(P=0,R=S.length;P<R;++P){var g=S[P];(L=t.get(g.name))||(L=[],t.set(g.name,L));N=this.allBufferLocations[g.name]||[];this.allBufferLocations[g.name]=N;D=Object.assign({},g,{uid:c.uid(),packUID:C.packUID,bufferAttribute:I}),B=g.blockIndex||0,z=g.size||1;for(var v=0,y=N.length;v<y;++v){var m=N[v];m.attribute=D,m.buffer={value:O}}for(n=a;n<this.maxInstancedCount;++n){k={attribute:D,block:_,buffer:{value:O},instanceIndex:n,range:[n*E+B,n*E+B+z]};L.push(k),N.push(k)}}}}}else{this.maxInstancedCount+=e,this.geometry=new o.Geometry;for(var b=0,w=this.layer.vertexAttributes;b<w.length;b++){(C=w[b]).materialAttribute&&this.geometry.addAttribute(C.name,C.materialAttribute)}this.attributes=[],this.blockAttributes=[];var x=new Map,T=new Map;this.blockSubAttributesLookup=T;for(var n=0,r=this.layer.instanceAttributes.length;n<r;++n){var _=(C=this.layer.instanceAttributes[n]).block||0,E=x.get(_)||0;E=Math.max(E,(C.blockIndex||0)+(C.size||0)),x.set(_,E);var A=T.get(_);A||(A=[],T.set(_,A)),A.push(C)}T.forEach((function(e){return e.sort((function(e,t){return(e.blockIndex||0)-(t.blockIndex||0)}))}));var _=0;for(r=x.size;_<r;++_){var E=x.get(_)||0,M=c.uid();E||console.warn("Instance Attribute Packing Error: The system tried to build an attribute with a size of zero.","These are the attributes used:",this.layer.instanceAttributes,"These are the block sizes calculated",x,"This is the block to attribute lookup generated",T);var S,O=new Float32Array(E*this.maxInstancedCount),I=new o.Attribute(O,E,!0,!0);if(this.geometry.addAttribute("block"+_,I),S=T.get(_)){for(var P=0,R=S.length;P<R;++P){var L,C=S[P];(L=t.get(C.name))||(L=[],t.set(C.name,L));var N=this.allBufferLocations[C.name]||[];this.allBufferLocations[C.name]=N;var D=Object.assign({},C,{uid:_,packUID:M,bufferAttribute:I,size:E}),B=C.blockIndex||0,z=C.size||1;for(n=0;n<this.maxInstancedCount;++n){var k={attribute:D,block:_,buffer:{value:O},instanceIndex:n,range:[n*E+B,n*E+B+z]};L.push(k),N.push(k)}this.attributes.push(D)}this.blockAttributes.push({uid:c.uid(),packUID:M,bufferAttribute:I,name:"block"+_,size:s.InstanceAttributeSize.FOUR,update:function(){return[0]}})}else console.warn("Instance Attribute Packing Buffer Error: Somehow there are no attributes associated with a block.","These are the attributes used:",this.layer.instanceAttributes,"These are the block sizes calculated",x,"This is the block to attribute lookup generated",T)}this.geometry.maxInstancedCount=0,this.material=this.layer.material.clone();n=0;for(var j=this.layer.uniforms.length;n<j;++n){var F=this.layer.uniforms[n];F.materialUniforms.push(this.material.uniforms[F.name])}}return this.scene&&this.model&&this.scene.container&&this.scene.container.remove(this.model),this.material=this.material||this.layer.material.clone(),this.model=l.generateLayerModel(this.geometry,this.material,this.layer.model.drawMode),this.scene&&this.scene.container&&this.model&&this.scene.container.add(this.model),f("COMPLETE: Resizing unpacked attribute buffer"),{growth:e,newLocations:t}},t.prototype.gatherLocationsIntoGroups=function(e,t){if(0!==this.attributeToPropertyIds.size){f("BEGIN: Packed attribute manager grouping new buffer locations");var n=[];this.attributeToPropertyIds.forEach((function(t,r){n.push({attribute:r,bufferLocationsForAttribute:e.get(r.name)||[],childBufferLocations:(r.childAttributes||[]).map((function(t){return{location:e.get(t.name)||[],bufferIndex:-1}})),ids:t,bufferIndex:-1})}));for(var r=0;r<t;++r){for(var i={instanceIndex:-1,propertyToBufferLocation:{}},o=function(e,t){var r=n[e],o=r.attribute,a=r.ids,s=r.bufferLocationsForAttribute;if(!s)return u.emitOnce("Instance Attribute Buffer Error",(function(e,t){console.warn(t+": There is an error in forming buffer location groups in InstanceAttributePackingBufferManager. Error count: "+e)})),"continue";var c=s[++r.bufferIndex];if(!c)return u.emitOnce("Instance Attribute Buffer Error",(function(e,t){console.warn(t+": There is an error in forming buffer location groups in InstanceAttributePackingBufferManager. Error count: "+e)})),"continue";if(-1===i.instanceIndex)i.instanceIndex=c.instanceIndex;else if(c.instanceIndex!==i.instanceIndex)return u.emitOnce("Instance Attribute Parallelism Error",(function(e,t){console.warn(t+": A buffer location does not have a matching instance index which means the buffer locations are not in parallel with each other somehow. Error count: "+e),console.warn(o.name,c)})),"continue";if(o.childAttributes){for(var l=[],h=function(e,t){var n=o.childAttributes[e],i=r.childBufferLocations[e];if(i){var a=i.location[++i.bufferIndex];a?l.push(a):u.emitOnce("Instance Attribute Child Attribute Error",(function(e,t){console.warn(t+": A child attribute does not have a buffer location available. Error count: "+e),console.warn("Parent Attribute: "+o.name+" Child Attribute: "+n.name)}))}},d=0,f=o.childAttributes.length;d<f;++d)h(d);c.childLocations=l}for(d=0,f=a.length;d<f;++d){var p=a[d];i.propertyToBufferLocation[p]=c}},a=0,s=n.length;a<s;++a)o(a);this.availableLocations.push(i)}f("COMPLETE: Packed attribute buffer manager buffer location grouping"),u.flushEmitOnce()}},t.prototype.getInstanceCount=function(){return this.maxInstancedCount},t}(h.BufferManagerBase);t.InstanceAttributePackingBufferManager=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(149),o=n(82),a=n(150),s=n(84),c=function(){function e(e,t){this.layer=e,this.bufferManager=t}return e.prototype.makeProcessor=function(){return this.processing?this.processing:(this.layer.bufferType===r.LayerBufferType.INSTANCE_ATTRIBUTE||this.layer.bufferType===r.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING?(this.layer.picking&&this.layer.picking.type===r.PickType.SINGLE&&(this.processor=new i.InstanceAttributeColorDiffProcessor(this.layer,this.bufferManager)),this.processor||(this.processor=new o.InstanceAttributeDiffProcessor(this.layer,this.bufferManager))):(this.layer.picking&&this.layer.picking.type===r.PickType.SINGLE&&(this.processor=new a.UniformColorDiffProcessor(this.layer,this.bufferManager)),this.processor||(this.processor=new s.UniformDiffProcessor(this.layer,this.bufferManager))),this.processing=[this.processor.changeInstance,this.processor.addInstance,this.processor.removeInstance],this.processing)},e}();t.InstanceDiffManager=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(20),s=n(82),c=[],u=function(e){function t(t,n){var r=e.call(this,t,n)||this;return t.picking.type===o.PickType.SINGLE?(r.colorPicking=t.picking,r.colorPicking.uidToInstance=new Map):console.warn("Diff Processing Error: A layer has a diff processor requesting Color Processing but the picking type is not valid."),r}return i(t,e),t.prototype.addInstance=function(e,t,n,r){if(r)e.changeInstance(e,t,c,r);else{var i=e.layer.bufferManager.add(t);a.isBufferLocationGroup(i)?(t.active=!0,t.easingId=e.layer.easingId,e.updateInstance(e.layer,t,c,i),e.colorPicking.uidToInstance.set(t.uid,t)):console.warn("A data cluster was not provided by the manager to associate an instance with.")}},t.prototype.changeInstance=function(e,t,n,r){r?e.updateInstance(e.layer,t,n,r):e.addInstance(e,t,c,r)},t.prototype.removeInstance=function(e,t,n,r){r&&(t.active=!1,t.clearEasing(),e.updateInstance(e.layer,t,c,r),e.layer.bufferManager.remove(t),e.colorPicking.uidToInstance.delete(t.uid))},t}(s.InstanceAttributeDiffProcessor);t.InstanceAttributeColorDiffProcessor=u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(51),s=n(84),c=[],u=function(e){function t(t,n){var r=e.call(this,t,n)||this;return t.picking.type===o.PickType.SINGLE?(r.colorPicking=t.picking,r.colorPicking.uidToInstance=new Map):console.warn("Diff Processing Error: A layer has a diff processor requesting Color Processing but the picking type is not valid."),r}return i(t,e),t.prototype.addInstance=function(e,t,n,r){if(r)e.changeInstance(e,t,c,r);else{var i=e.layer.bufferManager.add(t);a.isUniformBufferLocation(i)?(t.active=!0,t.easingId=e.layer.easingId,e.updateInstance(e.layer,t,i),e.colorPicking.uidToInstance.set(t.uid,t)):console.warn("A data cluster was not provided by the manager to associate an instance with.")}},t.prototype.changeInstance=function(e,t,n,r){r?e.updateInstance(e.layer,t,r):e.addInstance(e,t,c,r)},t.prototype.removeInstance=function(e,t,n,r){r&&(t.active=!1,t.clearEasing(),e.updateInstance(e.layer,t,r),e.layer.bufferManager.remove(t),e.colorPicking.uidToInstance.delete(t.uid))},t}(s.UniformDiffProcessor);t.UniformColorDiffProcessor=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(1);var o=function(){function e(e){this.isMouseOver=new Set,this.isMouseDown=new Set,this.isTouchOver=new Map,this.isTouchDown=new Map,this.layer=e}return e.prototype.getColorPickInstance=function(){return this.colorPicking&&this.layer.diffManager&&((e=this.layer.diffManager.processor)&&e.colorPicking)?this.layer.diffManager.processor.colorPicking.uidToInstance.get(16777215-this.colorPicking.nearestColor):null;var e},e.prototype.handleMouseOver=function(e,t){},e.prototype.handleTouchOver=function(e,t,n){},e.prototype.handleMouseDown=function(e,t){var n=this;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var i=this.layer.props.onMouseDown;if(i){var o=e.screenToWorld(t.screen.position),a=[];if(this.layer.picking.type===r.PickType.SINGLE){var s=this.getColorPickInstance();s&&a.push(s)}i({interaction:t,instances:a,layer:this.layer.id,projection:e,screen:t.screen.position,world:o}),this.isMouseDown.clear(),a.forEach((function(e){return n.isMouseDown.add(e)}))}}},e.prototype.handleTouchDown=function(e,t,n){var o=this.layer.props,a=o.onTouchDown,s=o.onTouchOver;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE&&(a||s)){var c=e.screenToWorld(n.screen.position),u=[];if(this.layer.picking.type===r.PickType.SINGLE){var l=this.getColorPickInstance();l&&u.push(l)}var h={interaction:t,touch:n,instances:u,layer:this.layer.id,projection:e,screen:n.screen.position,world:c},d=i.mapInjectDefault(this.isTouchDown,n.touch.touch.identifier,(function(){return new Set})),f=i.mapInjectDefault(this.isTouchOver,n.touch.touch.identifier,(function(){return new Set}));u.forEach((function(e){d.add(e),f.add(e)})),s&&s(h),a&&a(h)}},e.prototype.handleMouseOut=function(e,t){if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var n=this.layer.props.onMouseOut;if(n){var i=e.screenToWorld(t.screen.position);n({interaction:t,instances:Array.from(this.isMouseOver.keys()),layer:this.layer.id,projection:e,screen:t.screen.position,world:i})}}this.isMouseOver.clear()},e.prototype.handleTouchOut=function(e,t,n){var i=this.layer.props.onTouchOut;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE&&i){var o=e.screenToWorld(n.screen.position);i({interaction:t,touch:n,instances:Array.from(this.isMouseOver.keys()),layer:this.layer.id,projection:e,screen:n.screen.position,world:o}),this.isTouchOver.delete(n.touch.touch.identifier)}},e.prototype.handleMouseUp=function(e,t){var n=this,i=this.layer.props,o=i.onMouseUp,a=i.onMouseUpOutside;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE&&o){var s=e.screenToWorld(t.screen.position),c=[];if(this.layer.picking.type===r.PickType.SINGLE){var u=this.getColorPickInstance();u&&c.push(u)}var l={interaction:t,instances:c,layer:this.layer.id,projection:e,screen:t.screen.position,world:s};o(l),c.forEach((function(e){return n.isMouseDown.delete(e)})),this.isMouseDown.size<=0||!a||a(l={interaction:t,instances:Array.from(this.isMouseDown.values()),layer:this.layer.id,projection:e,screen:t.screen.position,world:s})}},e.prototype.handleTouchUp=function(e,t,n){var o=this.layer.props,a=o.onTouchUp,s=o.onTouchUpOutside,c=o.onTouchOut,u=o.onTouchAllEnd;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE&&(a||s||c||u)){var l=e.screenToWorld(n.screen.position),h=[];if(this.layer.picking.type===r.PickType.SINGLE){var d=this.getColorPickInstance();d&&h.push(d)}var f={interaction:t,touch:n,instances:h,layer:this.layer.id,projection:e,screen:n.screen.position,world:l};c&&c(f),a&&a(f);var p=i.mapGetWithDefault(this.isTouchDown,n.touch.touch.identifier,new Set);h.forEach((function(e){return p.delete(e)})),p.size>0&&s&&s(f={interaction:t,touch:n,instances:Array.from(p.values()),layer:this.layer.id,projection:e,screen:n.screen.position,world:l}),this.isTouchDown.delete(n.touch.touch.identifier),this.isTouchDown.size<=0&&u&&u(f={interaction:t,touch:n,instances:[],layer:this.layer.id,projection:e,screen:n.screen.position,world:l})}},e.prototype.handleMouseMove=function(e,t){var n=this,i=this.layer.props,o=i.onMouseOver,a=i.onMouseMove,s=i.onMouseOut;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE&&(o||a||s)){var c=void 0,u=e.screenToWorld(t.screen.position),l=[];if(this.layer.picking.type===r.PickType.SINGLE){var h=this.getColorPickInstance();h&&l.push(h)}var d=new Set;if(l.forEach((function(e){return d.add(e)})),s){var f=[];this.isMouseOver.forEach((function(e){d.has(e)||f.push(e)})),c={interaction:t,instances:f,layer:this.layer.id,projection:e,screen:t.screen.position,world:u},f.length>0&&s(c)}if(o){var p=l.filter((function(e){return!n.isMouseOver.has(e)}));c={interaction:t,instances:p,layer:this.layer.id,projection:e,screen:t.screen.position,world:u},p.length>0&&o(c)}a&&a(c={interaction:t,instances:l,layer:this.layer.id,projection:e,screen:t.screen.position,world:u}),this.isMouseOver=d}},e.prototype.handleTouchMove=function(e,t,n){var o=this.layer.props,a=o.onTouchOver,s=o.onTouchMove,c=o.onTouchOut;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE&&(a||s||c)){var u=void 0,l=e.screenToWorld(n.screen.position),h=[];if(this.layer.picking.type===r.PickType.SINGLE){var d=this.getColorPickInstance();d&&h.push(d)}var f=i.mapGetWithDefault(this.isTouchOver,n.touch.touch.identifier,new Set),p=new Set;if(h.forEach((function(e){return p.add(e)})),c){var g=[];f.forEach((function(e){p.has(e)||g.push(e)})),u={interaction:t,touch:n,instances:g,layer:this.layer.id,projection:e,screen:n.screen.position,world:l},g.length>0&&c(u)}if(a){var v=h.filter((function(e){return!f.has(e)}));u={interaction:t,touch:n,instances:v,layer:this.layer.id,projection:e,screen:n.screen.position,world:l},v.length>0&&a(u)}s&&s(u={interaction:t,touch:n,instances:h,layer:this.layer.id,projection:e,screen:n.screen.position,world:l}),this.isMouseOver=p}},e.prototype.handleMouseClick=function(e,t){if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var n=this.layer.props.onMouseClick;if(n){var i=e.screenToWorld(t.screen.position),o=[];if(this.layer.picking.type===r.PickType.SINGLE){var a=this.getColorPickInstance();a&&o.push(a)}n({interaction:t,instances:o,layer:this.layer.id,projection:e,screen:t.screen.position,world:i})}}},e.prototype.handleTap=function(e,t,n){if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var i=this.layer.props.onTap;if(i){var o=e.screenToWorld(n.screen.position),a=[];if(this.layer.picking.type===r.PickType.SINGLE){var s=this.getColorPickInstance();s&&a.push(s)}i({interaction:t,touch:n,instances:a,layer:this.layer.id,projection:e,screen:n.screen.position,world:o})}}},e.prototype.handleMouseDrag=function(e,t){},e}();t.LayerInteractionHandler=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(36),s=n(11),c=n(7),u=n(1);!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_MIDDLE=1]="TOP_MIDDLE",e[e.TOP_RIGHT=2]="TOP_RIGHT",e[e.MIDDLE_LEFT=3]="MIDDLE_LEFT",e[e.MIDDLE=4]="MIDDLE",e[e.MIDDLE_RIGHT=5]="MIDDLE_RIGHT",e[e.BOTTOM_LEFT=6]="BOTTOM_LEFT",e[e.BOTTOM_MIDDLE=7]="BOTTOM_MIDDLE",e[e.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(o=t.CameraBoundsAnchor||(t.CameraBoundsAnchor={}));var l=function(e){function t(t){var n=e.call(this,{})||this;return n._uid=u.uid(),n.isPanning=!1,n.isScaling=!1,n.panFilter=function(e,t,n){return e},n.scaleFilter=function(e,t,n){return e},n.startViews=[],n.optimizedViews=new Set,n.cameraImmediateAnimation=s.AutoEasingMethod.immediate(0),n.targetTouches=new Set,n.onRangeChanged=function(e,t){},n.startViewDidStart=!1,n.applyBounds=function(){if(n.bounds&&n.camera){var e=n.getView(n.bounds.view);n.applyScaleBounds(),e&&(n.camera.control2D.getOffset()[0]=n.boundsHorizontalOffset(e,n.bounds),n.camera.control2D.getOffset()[1]=n.boundsVerticalOffset(e,n.bounds))}},n.applyScaleBounds=function(){n.camera&&n.bounds&&(n.bounds.scaleMin&&n.camera.control2D.setScale(s.max3(n.camera.control2D.getScale(),n.bounds.scaleMin)),n.bounds.scaleMax&&n.camera.control2D.setScale(s.min3(n.camera.control2D.getScale(),n.bounds.scaleMax)))},n.handleCameraViewChange=function(e,t){if(t===n.startViews[0]){var r=n.surface.getProjections(t);r&&n.onRangeChanged(e,r)}},t.bounds&&n.setBounds(t.bounds),n._camera=t.camera,n.scaleFactor=t.scaleFactor||1e3,n.ignoreCoverViews=t.ignoreCoverViews||!1,n.twoFingerPan=t.twoFingerPan||!1,t.startView&&(Array.isArray(t.startView)?(n.startViews=t.startView,n._camera.control2D.setViewChangeHandler(n.handleCameraViewChange)):(n.startViews=[t.startView],n._camera.control2D.setViewChangeHandler(n.handleCameraViewChange))),n.panFilter=t.panFilter||n.panFilter,n.scaleFilter=t.scaleFilter||n.scaleFilter,n.onRangeChanged=t.onRangeChanged||n.onRangeChanged,t.wheelShouldScroll&&(n.wheelShouldScroll=t.wheelShouldScroll),n}return i(t,e),Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),t.prototype.anchoredByBoundsHorizontal=function(e,t){switch(t.anchor){case o.TOP_LEFT:case o.MIDDLE_LEFT:case o.BOTTOM_LEFT:return-(t.worldBounds.left-t.screenPadding.left/this.camera.control2D.getScale()[0]);case o.TOP_MIDDLE:case o.MIDDLE:case o.BOTTOM_MIDDLE:return-(t.worldBounds.right-t.worldBounds.width/2-(e.screenBounds.width+t.screenPadding.right)/this.camera.control2D.getScale()[0]*.5);case o.TOP_RIGHT:case o.MIDDLE_RIGHT:case o.BOTTOM_RIGHT:return-(t.worldBounds.right-(e.screenBounds.width-t.screenPadding.right)/this.camera.control2D.getScale()[0])}},t.prototype.anchoredByBoundsVertical=function(e,t){switch(t.anchor){case o.TOP_LEFT:case o.TOP_MIDDLE:case o.TOP_RIGHT:return-(t.worldBounds.top-t.screenPadding.top/this.camera.control2D.getScale()[1]);case o.MIDDLE_LEFT:case o.MIDDLE:case o.MIDDLE_RIGHT:return-(t.worldBounds.bottom-t.worldBounds.height/2-(e.screenBounds.height+t.screenPadding.bottom)/this.camera.control2D.getScale()[1]*.5);case o.BOTTOM_LEFT:case o.BOTTOM_MIDDLE:case o.BOTTOM_RIGHT:return-(t.worldBounds.bottom-(e.screenBounds.height-t.screenPadding.bottom)/this.camera.control2D.getScale()[1])}},t.prototype.boundsHorizontalOffset=function(e,t){var n=e.projection.worldToScreen([t.worldBounds.left,t.worldBounds.top]),r=e.projection.worldToScreen([t.worldBounds.right,t.worldBounds.bottom]);return r[0]-n[0]+t.screenPadding.left+t.screenPadding.right-e.screenBounds.width<0?this.anchoredByBoundsHorizontal(e,t):r[0]<e.screenBounds.right-t.screenPadding.right?-t.worldBounds.right+(e.screenBounds.width-t.screenPadding.right)/this.camera.control2D.getScale()[0]:n[0]>e.screenBounds.left+t.screenPadding.left?-t.worldBounds.left+t.screenPadding.left/this.camera.control2D.getScale()[0]:this.camera.control2D.getOffset()[0]},t.prototype.boundsVerticalOffset=function(e,t){var n=e.projection.worldToScreen([t.worldBounds.left,t.worldBounds.top]),r=e.projection.worldToScreen([t.worldBounds.right,t.worldBounds.bottom]);return r[1]-n[1]+t.screenPadding.top+t.screenPadding.bottom-e.screenBounds.height<0?this.anchoredByBoundsVertical(e,t):r[1]<e.screenBounds.bottom-t.screenPadding.bottom?-t.worldBounds.bottom+(e.screenBounds.height-t.screenPadding.bottom)/this.camera.control2D.getScale()[1]:n[1]>e.screenBounds.top+t.screenPadding.top?-t.worldBounds.top+t.screenPadding.top/this.camera.control2D.getScale()[0]:this.camera.control2D.getOffset()[1]},t.prototype.canStart=function(e){return 0===this.startViews.length||this.startViews&&this.startViews.indexOf(e)>-1||this.startViewDidStart&&this.ignoreCoverViews},t.prototype.centerOn=function(e,t){if(this.camera.control2D.surface){var n=this.camera.control2D.surface.getViewSize(e);if(n){var r=[n.width/2,n.height/2,0],i=s.subtract3(t,s.divide3(r,this.camera.control2D.getScale())),o=s.scale3(i,-1);this.setOffset(e,o)}}},t.prototype.doPan=function(e,t,n){var r=s.vec3(s.divide2(n,this.camera.control2D.getScale()),0);this.panFilter&&(r=this.panFilter(r,t,e)),this.camera.control2D.getOffset()[0]+=r[0],this.camera.control2D.getOffset()[1]+=r[1],this.applyBounds(),this.onRangeChanged(this.camera,t.projection),this.applyBounds(),this.camera.control2D.update()},t.prototype.doScale=function(e,t,n,r){var i=t.projection.screenToWorld(e),o=this.camera.control2D.getScale()[0]||1,a=this.camera.control2D.getScale()[1]||1;this.scaleFilter&&(r=this.scaleFilter(r,t,n)),this.camera.control2D.getScale()[0]=o+r[0],this.camera.control2D.getScale()[1]=a+r[1],this.applyScaleBounds();var c=t.projection.screenToWorld(e),u=s.subtract2(i,c);this.camera.control2D.getOffset()[0]-=u[0],this.camera.control2D.getOffset()[1]-=u[1],this.applyBounds(),this.onRangeChanged(this.camera,t.projection),this.applyBounds(),this.camera.control2D.update(),this.camera.control2D.animation=this.cameraImmediateAnimation},t.prototype.filterTouchesByValidStart=function(e){return this.ignoreCoverViews?e.filter(u.touchesContainsStartView(this.startViews)):e.filter(u.touchesHasStartView(this.startViews))},t.prototype.findCoveredStartView=function(e){var t=this,n=e.target.views.find((function(e){return t.startViews.indexOf(e.view.id)>-1}));this.startViewDidStart=Boolean(n),n&&(this.coveredStartView=n.view)},t.prototype.getRange=function(e){var t=this.getProjection(e),n=this.getViewScreenBounds(e);if(t&&n){var r=t.screenToWorld([n.x,n.y]),i=t.screenToWorld([n.right,n.bottom]);return new c.Bounds({height:i[1]-r[1],width:i[0]-r[0],x:r[0],y:r[1]})}return new c.Bounds({x:0,y:0,width:1,height:1})},t.prototype.getTargetView=function(e){return this.startViews&&!this.ignoreCoverViews?e.target.view:this.coveredStartView},t.prototype.handleMouseDown=function(e){this.startViews&&(this.findCoveredStartView(e),e.start&&(this.isPanning=this.canStart(e.start.view.id)||this.isPanning))},t.prototype.handleTouchDown=function(e){if(this.startViews){var t=this.filterTouchesByValidStart(e.allTouches);this.twoFingerPan?t.length>1&&(this.isPanning=!0):t.length>0&&(this.isPanning=!0),t.length>1&&(this.isScaling=!0);for(var n=0,r=t.length;n<r;++n){var i=t[n];this.targetTouches.add(i.touch.touch.identifier)}}},t.prototype.handleMouseUp=function(e){this.startViewDidStart=!1,this.isPanning=!1,this.optimizedViews.forEach((function(e){return e.optimizeRendering=!1})),this.optimizedViews.clear()},t.prototype.handleTouchUp=function(e){var t=this;e.touches.forEach((function(e){t.targetTouches.delete(e.touch.touch.identifier),t.targetTouches.size<=0&&(t.startViewDidStart=!1,t.isPanning=!1,t.optimizedViews.forEach((function(e){return e.optimizeRendering=!1})),t.optimizedViews.clear())})),this.isPanning=!1,this.isScaling=!1,this.targetTouches.size>0&&(this.isPanning=!0),this.targetTouches.size>1&&(this.isScaling=!0)},t.prototype.handleTouchCancelled=function(e){var t=this;e.touches.forEach((function(e){t.targetTouches.delete(e.touch.touch.identifier),t.targetTouches.size<=0&&(t.startViewDidStart=!1,t.isPanning=!1,t.optimizedViews.forEach((function(e){return e.optimizeRendering=!1})),t.optimizedViews.clear())})),this.isPanning=!1,this.isScaling=!1,this.targetTouches.size>0&&(this.isPanning=!0),this.targetTouches.size>1&&(this.isScaling=!0)},t.prototype.handleDrag=function(e){var t=this;e.start&&this.canStart(e.start.view.id)&&(e.target.views.forEach((function(e){e.view.optimizeRendering=!0,t.optimizedViews.add(e.view)})),this.doPan(e.target.views.map((function(e){return e.view})),e.start.view,e.mouse.deltaPosition),this.camera.control2D.animation=this.cameraImmediateAnimation)},t.prototype.handleTouchDrag=function(e){var t=this,n=this.filterTouchesByValidStart(e.allTouches);if(n.length>0&&this.isPanning){for(var r=0,i=n.length;r<i;++r){n[r].target.views.forEach((function(e){e.view.optimizeRendering=!0,t.optimizedViews.add(e.view)}))}var o=new Set,a=n.reduce((function(e,t){for(var n=0,r=t.target.views.length;n<r;++n){var i=t.target.views[n];o.add(i.view)}return t.touch.startTime<e.touch.startTime?t:e}),n[0]).start.view;if(this.isPanning&&(this.doPan(Array.from(o.values()),a,e.multitouch.centerDelta(n)),this.camera.control2D.animation=this.cameraImmediateAnimation),this.isScaling){var c=e.multitouch.center(n),u=s.subtract2(n[0].touch.currentPosition,c),l=s.subtract2(c,e.multitouch.centerDelta(n)),h=s.subtract2(n[0].touch.previousPosition,l),d=s.length2(u)/s.length2(h),f=[d*this.camera.scale2D[0]-this.camera.scale2D[0],d*this.camera.scale2D[1]-this.camera.scale2D[1],0];1!==d&&this.doScale(c,a,Array.from(o.values()),f)}}},t.prototype.handleWheel=function(e){if(this.findCoveredStartView(e),this.canStart(e.target.view.id))if(this.wheelShouldScroll){var t=[-e.mouse.wheel.delta[0],e.mouse.wheel.delta[1]];e.start&&this.doPan(e.target.views.map((function(e){return e.view})),e.start.view,t)}else{var n=this.camera.control2D.getScale()[0]||1,r=this.camera.control2D.getScale()[1]||1,i=this.getTargetView(e),o=[e.mouse.wheel.delta[1]/this.scaleFactor*n,e.mouse.wheel.delta[1]/this.scaleFactor*r,1];this.doScale(e.screen.position,i,e.target.views.map((function(e){return e.view})),o)}},Object.defineProperty(t.prototype,"pan",{get:function(){return this.camera.control2D.offset},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.camera.control2D.getScale()},enumerable:!0,configurable:!0}),t.prototype.setBounds=function(e){this.bounds=e,this.applyBounds()},t.prototype.setOffset=function(e,t){var n=s.copy3(this.camera.control2D.offset);if(this.camera.control2D.getOffset()[0]=t[0],this.camera.control2D.getOffset()[1]=t[1],this.camera.control2D.getOffset()[2]=t[2],this.applyBounds(),this.camera.control2D.surface){var r=this.camera.control2D.surface.getProjections(e);r&&this.onRangeChanged(this.camera,r)}this.applyBounds();var i=s.copy3(this.camera.control2D.getOffset()),o=this.camera.control2D.animation;this.camera.control2D.setOffset(n),this.camera.control2D.animation=this.cameraImmediateAnimation,this.camera.control2D.setOffset(i),this.camera.control2D.animation=o},t.prototype.setRange=function(e,t){var n=this.getProjection(t),r=this.getViewScreenBounds(t),i=this.getView(t);if(n&&r&&i){var o=s.subtract3([r.width/e.width,r.height/e.height,1],this.camera.control2D.getScale());this.camera.control2D.setScale(s.add3(this.camera.control2D.getScale(),this.scaleFilter(o,i,[i])));var a=s.subtract3([-e.x,-e.y,0],this.camera.control2D.offset);this.camera.control2D.setOffset(s.add3(this.camera.control2D.offset,this.scaleFilter(a,i,[i]))),this.applyBounds(),this.onRangeChanged(this.camera,i.projection),this.applyBounds()}},t.prototype.setRangeChangeHandler=function(e){this.onRangeChanged=e},t}(a.SimpleEventHandler);t.BasicCamera2DController=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(29),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.offsetFilter=function(e){return e},r.scaleFilter=function(e){return e},r.base=n.base,r.offsetFilter=n.offsetFilter||r.offsetFilter,r.scaleFilter=n.scaleFilter||r.scaleFilter,r}return i(t,e),Object.defineProperty(t.prototype,"offset",{get:function(){return this.offsetFilter(this.base.offset)},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.scaleFilter(this.base.scale)},set:function(e){},enumerable:!0,configurable:!0}),t}(n(30).Control2D),s=function(e){function t(t){var n=e.call(this)||this;return n.base=t.base,n._control2D=new a(n.base,{base:n.base.control2D,offsetFilter:t.offsetFilter,scaleFilter:t.scaleFilter}),n}return i(t,e),Object.defineProperty(t.prototype,"control2D",{get:function(){return this._control2D},set:function(e){},enumerable:!0,configurable:!0}),t}(o.Camera2D);t.ReferenceCamera2D=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=n(3),s=n(15),c=n(13),u=n(29),l=n(155);function h(e){return e.projectionType===c.CameraProjectionType.ORTHOGRAPHIC}var d=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.projection=new l.Projection2D,r.projection.camera=n.camera,r}return i(t,e),t.prototype.fitViewtoViewport=function(e,t){if(h(this.props.camera)){var n=t.width,r=t.height,i={bottom:-r/2,far:1e7,left:-n/2,near:-100,right:n/2,top:r/2},s=1/this.pixelRatio,c=1/this.pixelRatio,u=this.props.camera;u.projectionOptions=Object.assign(u.projectionOptions,i),u.position=[t.width/2,-t.height/2,u.position[2]],u.scale=[s,-c,1],u.lookAt(a.add3(u.position,[0,0,-1]),[0,1,0]),u.update(),this.projection.viewBounds=t,t.d=this,this.projection.screenBounds=new o.Bounds({height:this.viewBounds.height/this.pixelRatio,width:this.viewBounds.width/this.pixelRatio,x:this.viewBounds.x/this.pixelRatio,y:this.viewBounds.y/this.pixelRatio}),this.screenBounds.d=this}else h(this.props.camera)||console.warn("View2D does not support non-orthographic cameras yet.")},t.prototype.willUpdateProps=function(e){this.projection.camera=e.camera},t.defaultProps={key:"",camera:new u.Camera2D,viewport:{left:0,right:0,bottom:0,top:0}},t}(s.View);t.View2D=d},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.screenToWorld=function(e,t){var n=this.screenToView(e),r=t||[0,0];return r[0]=(n[0]-this.camera.control2D.offset[0]*this.camera.scale2D[0])/this.camera.scale2D[0],r[1]=(n[1]-this.camera.control2D.offset[1]*this.camera.scale2D[1])/this.camera.scale2D[1],r},t.prototype.worldToScreen=function(e,t){var n=[0,0];return n[0]=(e[0]*this.camera.scale2D[0]+this.camera.control2D.offset[0]*this.camera.scale2D[0])*this.pixelRatio,n[1]=(e[1]*this.camera.scale2D[1]+this.camera.control2D.offset[1]*this.camera.scale2D[1])*this.pixelRatio,this.viewToScreen(n,t)},t.prototype.viewToWorld=function(e,t){var n=t||[0,0],r=e;return n[0]=(r[0]-this.camera.control2D.offset[0]*this.camera.scale2D[0])/this.camera.scale2D[0],n[1]=(r[1]-this.camera.control2D.offset[1]*this.camera.scale2D[1])/this.camera.scale2D[1],n},t.prototype.worldToView=function(e,t){var n=t||[0,0];return n[0]=e[0]*this.camera.scale2D[0]+this.camera.control2D.offset[0]*this.camera.scale2D[0],n[1]=e[1]*this.camera.scale2D[1]+this.camera.control2D.offset[1]*this.camera.scale2D[1],n},t}(n(11).BaseProjection);t.Projection2D=o},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(157)),r(n(163)),r(n(170)),r(n(179)),r(n(186)),r(n(202)),r(n(206))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(158)),r(n(162))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(6),s=n(2),c=n(0),u=n(1),l=n(5);!function(e){e[e.NONE=0]="NONE",e[e.SCREEN_CURVE=1]="SCREEN_CURVE"}(o=t.ArcScaleType||(t.ArcScaleType={}));var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){for(var e,r,i=this.props.scaleType,a=this.props.animate||{},s=a.angle,u=a.angleOffset,l=a.center,h=a.radius,d=a.thickness,f=a.colorStart,p=a.colorEnd,g=((e={0:1})[302]=-1,e),v=((r={0:0})[302]=1,r),y=1,m=0;m<300;++m)g[m+1]=y,v[m+1]=Math.floor(m/2)/149,y*=-1;var b=i===o.NONE?n(159):n(160);return{fs:n(161),instanceAttributes:[{easing:l,name:t.attributeNames.center,size:c.InstanceAttributeSize.TWO,update:function(e){return e.center}},{easing:h,name:t.attributeNames.radius,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.radius]}},{name:t.attributeNames.depth,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{easing:d,name:t.attributeNames.thickness,size:c.InstanceAttributeSize.TWO,update:function(e){return e.thickness}},{easing:s,name:t.attributeNames.angle,size:c.InstanceAttributeSize.TWO,update:function(e){return e.angle}},{easing:u,name:t.attributeNames.angleOffset,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.angleOffset]}},{easing:f,name:t.attributeNames.colorStart,size:c.InstanceAttributeSize.FOUR,update:function(e){return e.colorStart}},{easing:p,name:t.attributeNames.colorEnd,size:c.InstanceAttributeSize.FOUR,update:function(e){return e.colorEnd}}],uniforms:[{name:"scaleFactor",size:c.UniformSize.ONE,update:function(e){return[1]}}],vertexAttributes:[{name:"vertex",size:c.VertexAttributeSize.THREE,update:function(e){return[g[e],v[e],300]}}],vertexCount:302,vs:b}},t.prototype.getMaterialOptions=function(){return Object.assign({},u.CommonMaterialOptions.transparentShapeBlending,{culling:a.GLSettings.Material.CullSide.NONE})},t.defaultProps={data:new s.InstanceProvider,key:"",scaleType:o.NONE},t.attributeNames={angle:"angle",angleOffset:"angleOffset",center:"center",colorEnd:"colorEnd",colorStart:"colorStart",depth:"depth",radius:"radius",thickness:"thickness"},t}(l.Layer2D);t.ArcLayer=h},function(e,t){e.exports="${import: arc}\nprecision highp float;\nvarying vec4 vertexColor;\nvoid main() {\nfloat startAngle = angle.x + angleOffset;\nfloat endAngle = angle.y + angleOffset;\nfloat widthStart = thickness.x;\nfloat widthEnd = thickness.y;\nfloat normal = vertex.x;\nfloat interpolationTime = vertex.y;\nfloat interpolationIncrement = 1.0 / vertex.z;\nvec2 currentPosition = arc(interpolationTime, center, radius, startAngle, endAngle);\nvec2 currentNormal = normalize(currentPosition - center);\nfloat lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;\nvec2 vertex = currentPosition + currentNormal * (normal * lineThickness);\nvertexColor = mix(colorStart, colorEnd, interpolationTime);\ngl_Position = clipSpace(vec3(vertex, depth));\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvec2 interpolation(float t, vec2 center, float radius, float start, float end) {\nfloat angle = (end - start) * t + start;\nreturn center + vec2(cos(angle) * radius, sin(angle) * radius);\n}\nvoid main() {\nfloat startAngle = angle.x;\nfloat endAngle = angle.y;\nfloat widthStart = thickness.x;\nfloat widthEnd = thickness.y;\nvec4 centerClip = clipSpace(vec3(center, depth));\nvec2 centerScreen = (centerClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nfloat normal = position.x;\nfloat interpolationTime = position.y;\nfloat interpolationIncrement = 1.0 / position.z;\nvec2 currentPosition = interpolation(interpolationTime, centerScreen, radius, startAngle, endAngle);\nvec2 currentNormal = normalize(currentPosition - centerScreen);\nfloat lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;\nvec2 vertex = currentPosition + currentNormal * (normal * lineThickness);\nvertexColor = mix(colorStart, colorEnd, interpolationTime);\nvertexColor *= vertexColor.a;\ngl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), centerClip.zw);\ngl_PointSize = 5.0;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\nsetColor(vertexColor);\n}"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=function(e){function t(t){var n=e.call(this,t)||this;return n.angle=[0,Math.PI],n.colorEnd=[1,1,1,1],n.colorStart=[1,1,1,1],n.center=[0,0],n.depth=0,n.angleOffset=0,n.radius=1,n.thickness=[5,5],n.angle=t.angle||n.angle,n.colorEnd=t.colorEnd||n.colorEnd,n.colorStart=t.colorStart||n.colorStart,n.center=t.center||n.center,n.depth=t.depth||n.depth,n.radius=t.radius||n.radius,n.thickness=t.thickness||n.thickness,n}return i(t,e),o([a.observable],t.prototype,"angle",void 0),o([a.observable],t.prototype,"colorEnd",void 0),o([a.observable],t.prototype,"colorStart",void 0),o([a.observable],t.prototype,"center",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"angleOffset",void 0),o([a.observable],t.prototype,"radius",void 0),o([a.observable],t.prototype,"thickness",void 0),t}(n(10).Instance);t.ArcInstance=s},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(164)),r(n(169))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(2),s=n(0),c=n(1),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){var e=this.props,r=e.animate,i=void 0===r?{}:r,a=e.scaleFactor,c=void 0===a?function(){return 1}:a,u=e.usePoints,l=void 0!==u&&u,h=e.opacity,d=void 0===h?function(){return 1}:h,f=i.center,p=i.radius,g=i.color,v={0:1,1:1,2:-1,3:1,4:-1,5:-1},y={0:-1,1:-1,2:-1,3:1,4:1,5:1},m=[{name:"normals",size:s.VertexAttributeSize.TWO,update:function(e){return[v[e],y[e]]}}];return{drawMode:l?o.GLSettings.Model.DrawMode.POINTS:o.GLSettings.Model.DrawMode.TRIANGLE_STRIP,fs:n(l?165:166),instanceAttributes:[{easing:f,name:t.attributeNames.center,size:s.InstanceAttributeSize.TWO,update:function(e){return e.center}},{easing:p,name:t.attributeNames.radius,size:s.InstanceAttributeSize.ONE,update:function(e){return[e.radius]}},{name:t.attributeNames.depth,size:s.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{easing:g,name:t.attributeNames.color,size:s.InstanceAttributeSize.FOUR,update:function(e){return e.color}}],uniforms:[{name:"scaleFactor",size:s.UniformSize.ONE,update:function(e){return[c()]}},{name:"layerOpacity",size:s.UniformSize.ONE,update:function(e){return[d()]}}],vertexAttributes:l?void 0:m,vertexCount:l?0:6,vs:n(l?167:168)}},t.prototype.getMaterialOptions=function(){return c.CommonMaterialOptions.transparentShapeBlending},t.defaultProps={data:new a.InstanceProvider,key:"",scaleFactor:function(){return 1}},t.attributeNames={center:"center",color:"color",depth:"depth",radius:"radius"},t}(n(5).Layer2D);t.CircleLayer=u},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nfloat circle(vec2 coord, float radius){\nvec2 dist = coord - vec2(0.5);\nreturn 1.0 - smoothstep(\nradius - (radius * edgeSharpness),\nradius + (radius * edgeSharpnessBase),\ndot(dist, dist) * 4.0\n);\n}\nvoid main() {\nfloat step_factor = circle(gl_PointCoord, 1.0);\nsetColor(mix(\nvec4(0.0, 0.0, 0.0, 0.0),\nvertexColor,\nstep_factor\n));\nif (gl_FragColor.a <= 0.0) discard;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nvarying vec2 pointCoord;\nfloat circle(vec2 coord, float radius){\nvec2 dist = coord - vec2(0.5);\nreturn 1.0 - smoothstep(\nradius - (radius * edgeSharpness),\nradius + (radius * edgeSharpnessBase),\ndot(dist, dist) * 4.0\n);\n}\nvoid main() {\nfloat step_factor = circle(pointCoord, 1.0);\nsetColor(mix(\nvec4(0.0, 0.0, 0.0, 0.0),\nvertexColor,\nstep_factor\n));\nif (gl_FragColor.a <= 0.0) discard;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nvoid main() {\nvertexColor = color;\nvertexColor.a *= layerOpacity;\nfloat size = radius * scaleFactor;\nedgeSharpness = mix(0.8, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\nedgeSharpnessBase = mix(0.1, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\ngl_Position = clipSpace(vec3(center, depth));\ngl_PointSize = size * 2.0 * pixelRatio;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nvarying vec2 pointCoord;\nvoid main() {\nvertexColor = color;\nvertexColor.a *= layerOpacity;\nfloat size = radius * scaleFactor * pixelRatio;\nedgeSharpness = mix(0.8, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\nedgeSharpnessBase = mix(0.1, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\npointCoord = (normals.xy + vec2(1.0, 1.0)) / 2.0;\nvec4 clipCenter = clipSpace(vec3(center, depth));\nvec2 screenCenter = (clipCenter.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nvec2 vertex = (normals.xy * size) + screenCenter;\ngl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), clipCenter.zw);\n}"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=function(e){function t(t){var n=e.call(this,t)||this;return n.color=[1,1,1,1],n.depth=0,n.radius=0,n.center=[0,0],n.color=t.color||n.color,n.radius=t.radius||n.radius,n.center=t.center||n.center,n.depth=t.depth||n.depth,n}return i(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),o([a.observable],t.prototype,"color",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"radius",void 0),o([a.observable],t.prototype,"center",void 0),t}(n(10).Instance);t.CircleInstance=s},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(171)),r(n(178)),r(n(87))},function(e,t,n){"use strict";var r,i,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=n(0),c=n(1),u=n(5),l=n(87);var h=((i={})[l.EdgeType.LINE]=n(172),i[l.EdgeType.BEZIER]=n(173),i[l.EdgeType.BEZIER2]=n(174),i),d=n(175),f=n(176),p=n(177),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.initShader=function(){for(var e,n,r=this,i=this.props,o=i.animate,a=void 0===o?{}:o,u=i.scaleFactor,g=void 0===u?function(){return 1}:u,v=i.type,y=i.scaleType,m=void 0===y?l.EdgeScaleType.NONE:y,b=a.end,w=a.start,x=a.startColor,T=a.endColor,_=a.control,E=a.thickness,A=v===l.EdgeType.LINE?2:50,M=((e={0:1})[2*A+2]=-1,e),S=((n={0:0})[2*A+2]=1,n),O=1,I=0;I<2*A;++I)M[I+1]=O,S[I+1]=Math.floor(I/2)/(A-1),O*=-1;var P={interpolation:h[v]},R=c.shaderTemplate({options:P,required:{name:"Edge Layer",values:["interpolation"]},shader:m===l.EdgeScaleType.NONE?d:f,onToken:function(e,t){return e in P?t:"${"+e+"}"}});return{fs:p,instanceAttributes:[{easing:x,name:t.attributeNames.startColor,size:s.InstanceAttributeSize.FOUR,update:function(e){return e.startColor}},{easing:T,name:t.attributeNames.endColor,size:s.InstanceAttributeSize.FOUR,update:function(e){return e.endColor}},{easing:w,name:t.attributeNames.start,size:s.InstanceAttributeSize.TWO,update:function(e){return e.start}},{easing:b,name:t.attributeNames.end,size:s.InstanceAttributeSize.TWO,update:function(e){return e.end}},{easing:E,name:t.attributeNames.thickness,size:s.InstanceAttributeSize.TWO,update:function(e){return e.thickness}},{name:t.attributeNames.depth,size:s.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},v===l.EdgeType.LINE?{easing:_,name:t.attributeNames.control,size:s.InstanceAttributeSize.FOUR,update:function(e){return[0,0,0,0]}}:null,v===l.EdgeType.BEZIER?{easing:_,name:t.attributeNames.control,size:s.InstanceAttributeSize.FOUR,update:function(e){return[e.control[0][0],e.control[0][1],0,0]}}:null,v===l.EdgeType.BEZIER2?{easing:_,name:t.attributeNames.control,size:s.InstanceAttributeSize.FOUR,update:function(e){return[(t=e.control)[0][0],t[0][1],t[1][0],t[1][1]];var t}}:null],uniforms:[{name:"scaleFactor",size:s.UniformSize.ONE,update:function(e){return[g()]}},{name:"layerOpacity",size:s.UniformSize.ONE,update:function(e){return[void 0===r.props.opacity?1:r.props.opacity]}}],vertexAttributes:[{name:"vertex",size:s.VertexAttributeSize.THREE,update:function(e){return[M[e],S[e],2*A]}}],vertexCount:2*A+2,vs:R.shader}},t.prototype.getMaterialOptions=function(){return c.CommonMaterialOptions.transparentShapeBlending},t.defaultProps={broadphase:l.EdgeBroadphase.ALL,data:new a.InstanceProvider,key:"none",scaleType:l.EdgeScaleType.NONE,type:l.EdgeType.LINE},t.attributeNames={control:"control",depth:"depth",end:"end",endColor:"endColor",start:"start",startColor:"startColor",thickness:"thickness"},t}(u.Layer2D);t.EdgeLayer=g},function(e,t){e.exports="vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\nreturn p1 + (p2 - p1) * t;\n}"},function(e,t){e.exports="vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\nreturn (1.0 - t) * (1.0 - t) * p1 + 2.0 * t * (1.0 - t) * c1 + t * t * p2;\n}"},function(e,t){e.exports="vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\nfloat t1 = 1.0 - t;\nreturn pow(t1, 3.0) * p1 + 3.0 * t * pow(t1, 2.0) * c1 + 3.0 * pow(t, 2.0) * t1 * c2 + pow(t, 3.0) * p2;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\n${interpolation}\nvoid main() {\nfloat normal = vertex.x;\nfloat interpolationTime = vertex.y;\nfloat interpolationIncrement = 1.0 / vertex.z;\nvec2 currentPosition = interpolation(interpolationTime, start, end, control.xy, control.zw);\nvec2 prePosition = interpolation(interpolationTime - interpolationIncrement, start, end, control.xy, control.zw);\nvec2 nextPosition = interpolation(interpolationTime + interpolationIncrement, start, end, control.xy, control.zw);\nvec2 preLine = prePosition - currentPosition;\nvec2 nextLine = nextPosition - currentPosition;\nvec2 currentNormal = mix(\nnormalize(vec2(preLine.y, -preLine.x)),\nmix(\nnormalize(vec2(preLine.y, -preLine.x) + vec2(-nextLine.y, nextLine.x)),\nnormalize(vec2(-nextLine.y, nextLine.x)),\nfloat(vertex.x >= 1.0)\n),\nfloat(vertex.x > 0.0)\n);\nfloat lineThickness = mix(thickness.x, thickness.y, interpolationTime) / 2.0;\nvec2 vertexPos = currentPosition + currentNormal * (normal * lineThickness);\nvertexColor = mix(startColor, endColor, interpolationTime);\ngl_Position = clipSpace(vec3(vertexPos, depth));\ngl_PointSize = 5.0;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\n${interpolation}\nvoid main() {\nfloat normal = vertex.x;\nfloat interpolationTime = vertex.y;\nfloat interpolationIncrement = 1.0 / vertex.z;\nvec4 startClip = clipSpace(vec3(start, depth));\nvec4 endClip = clipSpace(vec3(end, depth));\nvec2 startScreen = (startClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nvec2 endScreen = (endClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nvec2 control1 = startScreen + vec2(control.x, -control.y) * scaleFactor;\nvec2 control2 = endScreen + vec2(control.z, -control.w) * scaleFactor;\nvec2 currentPosition = interpolation(interpolationTime, startScreen, endScreen, control1, control2);\nvec2 prePosition = interpolation(interpolationTime - interpolationIncrement, startScreen, endScreen, control1, control2);\nvec2 nextPosition = interpolation(interpolationTime + interpolationIncrement, startScreen, endScreen, control1, control2);\nvec2 preLine = prePosition - currentPosition;\nvec2 nextLine = nextPosition - currentPosition;\nvec2 currentNormal = mix(\nnormalize(vec2(preLine.y, -preLine.x)),\nmix(\nnormalize(vec2(preLine.y, -preLine.x) + vec2(-nextLine.y, nextLine.x)),\nnormalize(vec2(-nextLine.y, nextLine.x)),\nfloat(vertex.x >= 1.0)\n),\nfloat(vertex.x > 0.0)\n);\nfloat lineThickness = mix(thickness.x, thickness.y, interpolationTime) / 2.0;\nvec2 vertexPos = currentPosition + currentNormal * (-normal * lineThickness * scaleFactor);\nvertexColor = mix(startColor, endColor, interpolationTime);\ngl_Position = vec4((vertexPos / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), startClip.zw);\ngl_PointSize = 5.0;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\nsetColor(vertexColor);\n}"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(10),s=n(18),c=n(11),u=function(e){function t(t){var n=e.call(this,t)||this;return n.control=[[0,0],[0,0]],n.depth=0,n.end=[0,0],n.endColor=[1,1,1,1],n.start=[0,0],n.startColor=[1,1,1,1],n.thickness=[1,1],n.startColor=t.startColor||n.startColor,n.endColor=t.endColor||n.endColor,n.control=t.control||n.control,n.depth=t.depth||n.depth,n.end=t.end||n.end,n.thickness=t.thickness||n.thickness,n.start=t.start||n.start,n}return i(t,e),Object.defineProperty(t.prototype,"length",{get:function(){var e=[this.end[0]-this.start[0],this.end[1]-this.start[1]];return Math.sqrt(e[0]*e[0]+e[1]*e[1])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"midpoint",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"perpendicular",{get:function(){var e=this.length;return[(this.end[1]-this.start[1])/e,-(this.end[0]-this.start[0])/e]},enumerable:!0,configurable:!0}),t.prototype.setEdgeThickness=function(e){this.thickness=[e,e]},t.prototype.setColor=function(e){this.startColor=c.copy4(e),this.endColor=c.copy4(e)},o([s.observable],t.prototype,"control",void 0),o([s.observable],t.prototype,"depth",void 0),o([s.observable],t.prototype,"end",void 0),o([s.observable],t.prototype,"endColor",void 0),o([s.observable],t.prototype,"start",void 0),o([s.observable],t.prototype,"startColor",void 0),o([s.observable],t.prototype,"thickness",void 0),t}(a.Instance);t.EdgeInstance=u},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(180)),r(n(185))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=n(16),c=n(19),u=n(0),l=n(1),h=n(45),d=n(5),f=n(181),p=n(182);function g(e){return e&&e.videoSrc}t.isVideoResource=g;var v=new Image;v.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.childProvider=new a.InstanceProvider,t.imageToResource=new Map,t.sourceToRequest=new Map,t.sourceToVideo=new Map,t.usingVideo=new Map,t.waitingForVideo=new Map,t.waitForVideoSource=new Map,t.originalOnReadyCallbacks=new Map,t}return i(t,e),t.prototype.childLayers=function(){return[c.createLayer(p.ImageRenderLayer,o({},this.props,{key:this.props.key+".image-render-layer"}))]},t.prototype.destroy=function(){var t=this;e.prototype.destroy.call(this),this.sourceToVideo.forEach((function(e){e.pause(),t.sourceToVideo.clear(),t.waitingForVideo.clear(),t.waitForVideoSource.clear()}))},t.prototype.draw=function(){var e=this.resolveChanges(!0);if(!(e.length<=0)){this.propertyIds||(this.propertyIds=this.getInstanceObservableIds(e[0][0],["source"]));for(var t=this.propertyIds.source,n=0,r=e.length;n<r;++n){var i=e[n],o=i[0],a=i[1],c=i[2];switch(a){case u.InstanceDiffType.CHANGE:if(void 0!==c[t]){var h=this.imageToResource.get(o),d=this.getAtlasSource(o);if(d===h)break;if(h instanceof HTMLVideoElement){if(y=this.waitForVideoSource.get(o))this.waitForVideoSource.delete(o),(m=this.waitingForVideo.get(y))&&m.delete(o);(b=this.usingVideo.get(h.getAttribute("data-source")||""))||(b=new Set),b.delete(o),b.size<=0&&this.sourceToVideo.delete(h.getAttribute("data-source")||""),o.onReady=this.originalOnReadyCallbacks.get(o)}if(g(o.source))this.prepareVideo(o,o.source),d=this.getAtlasSource(o),l.mapInjectDefault(this.usingVideo,o.source.videoSrc,new Set).add(o);if(this.imageToResource.set(o,d),this.resource.request(this,o,s.atlasRequest({key:this.props.atlas||"",disposeResource:!0,source:h})),d)(!(f=this.sourceToRequest.get(d))||f.texture&&!f.texture.isValid)&&(f=s.atlasRequest({key:this.props.atlas||"",source:d,rasterizationScale:this.props.rasterizationScale}),this.sourceToRequest.set(d,f)),o.request=f,this.resource.request(this,o,f)}break;case u.InstanceDiffType.INSERT:if(o.source){var f,p=this.getAtlasSource(o);if(g(o.source))this.prepareVideo(o,o.source),p=this.getAtlasSource(o),l.mapInjectDefault(this.usingVideo,o.source.videoSrc,new Set).add(o);(!(f=this.sourceToRequest.get(p))||f.texture&&!f.texture.isValid)&&(f=s.atlasRequest({key:this.props.atlas||"",source:p,rasterizationScale:this.props.rasterizationScale}),this.sourceToRequest.set(p,f)),o.request=f}break;case u.InstanceDiffType.REMOVE:var v=this.getAtlasSource(o);if(this.imageToResource.delete(o),g(o.source)){var y,m,b;if(y=this.waitForVideoSource.get(o))this.waitForVideoSource.delete(o),(m=this.waitingForVideo.get(y))&&m.delete(o);(b=this.usingVideo.get(o.source.videoSrc))||(b=new Set),b.delete(o),b.size<=0&&this.sourceToVideo.delete(o.source.videoSrc),this.originalOnReadyCallbacks.delete(o)}this.resource.request(this,o,s.atlasRequest({key:this.props.atlas||"",disposeResource:!0,source:v}))}}var w=[];this.usingVideo.forEach((function(e,t){e.size<=0&&w.push(t)}));for(n=0,r=w.length;n<r;++n){var x=w[n];this.usingVideo.delete(x),this.sourceToVideo.delete(x)}}},t.prototype.getAtlasSource=function(e){return g(e.source)?this.sourceToVideo.get(e.source.videoSrc)||v:e.source},t.prototype.prepareVideo=function(e,t){var n=this,r=this.sourceToVideo.get(t.videoSrc);if(this.originalOnReadyCallbacks.get(e)||this.originalOnReadyCallbacks.set(e,e.onReady),r){var i=this.waitingForVideo.get(t.videoSrc);if(i)i.add(e),this.waitForVideoSource.set(e,t.videoSrc),e.onReady=void 0,e.source=v,e.videoLoad=function(){r.load(),t.autoPlay&&r.play()};else{var o=this.originalOnReadyCallbacks.get(e)||e.onReady;if(!o)return;e.onReady=function(e){o(e,r)}}}else{var a=document.createElement("video");this.sourceToVideo.set(t.videoSrc,a),a.setAttribute("data-source",t.videoSrc),f.debugVideoEvents(a);var s=new h.PromiseResolver,c=new h.PromiseResolver,u=function(){a.removeEventListener("loadedmetadata",p),a.removeEventListener("loadeddata",d),a.removeEventListener("error",g),n.waitingForVideo.delete(t.videoSrc),n.waitForVideoSource.delete(e)},d=function(){c.resolve()},p=function(){s.resolve()},g=function(e){var t;e.path&&e.path[0]&&(t=e.path[0].error),e.originalTarget&&(t=e.originalTarget.error),console.warn("There was an error loading the video resource to the atlas texture context"),console.warn(t),s.reject({}),c.reject({})};a.addEventListener("loadedmetadata",p),a.addEventListener("loadeddata",d),a.addEventListener("error",g),e.onReady=void 0,l.mapInjectDefault(this.waitingForVideo,t.videoSrc,new Set).add(e),this.waitForVideoSource.set(e,t.videoSrc),e.source=v,e.videoLoad=function(){a.load(),t.autoPlay&&a.play()},a.muted=!0,a.src=t.videoSrc,Promise.all([s.promise,c.promise]).then((function(){a.currentTime=0,t.autoPlay&&a.play();var e=n.waitingForVideo.get(t.videoSrc);e&&e.forEach((function(e){e.source=t,e.onReady=n.originalOnReadyCallbacks.get(e)})),u()})).catch((function(){u()}))}},t.prototype.initShader=function(){return null},t.defaultProps={atlas:"default",key:"",data:new a.InstanceProvider},t}(d.Layer2D);t.ImageLayer=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4)("video");t.debugVideoEvents=function(e){r.enabled&&(e.addEventListener("abort",(function(){return r("abort")})),e.addEventListener("canplay",(function(){return r("canplay")})),e.addEventListener("canplaythrough",(function(){return r("canplaythrough")})),e.addEventListener("durationchange",(function(){return r("durationchange")})),e.addEventListener("emptied",(function(){return r("emptied")})),e.addEventListener("ended",(function(){return r("ended")})),e.addEventListener("error",(function(){return r("error")})),e.addEventListener("loadeddata",(function(){return r("loadeddata")})),e.addEventListener("loadedmetadata",(function(){return r("loadedmetadata")})),e.addEventListener("loadstart",(function(){return r("loadstart")})),e.addEventListener("pause",(function(){return r("pause")})),e.addEventListener("play",(function(){return r("play")})),e.addEventListener("playing",(function(){return r("playing")})),e.addEventListener("progress",(function(){return r("progress")})),e.addEventListener("ratechange",(function(){return r("ratechange")})),e.addEventListener("seeked",(function(){return r("seeked")})),e.addEventListener("seeking",(function(){return r("seeking")})),e.addEventListener("stalled",(function(){return r("stalled")})),e.addEventListener("suspend",(function(){return r("suspend")})),e.addEventListener("timeupdate",(function(){return r("timeupdate")})),e.addEventListener("volumechange",(function(){return r("volumechange")})),e.addEventListener("waiting",(function(){return r("waiting")})))}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(0),s=n(44),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){var e=this,r=this.props.animate||{},i=r.tint,o=r.location,s=r.size,c={0:1,1:1,2:-1,3:1,4:-1,5:-1},u={0:0,1:0,2:0,3:1,4:1,5:1};return{fs:n(183),instanceAttributes:[{easing:o,name:t.attributeNames.location,size:a.InstanceAttributeSize.TWO,update:function(e){return e.origin}},{name:t.attributeNames.anchor,size:a.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x||0,e.anchor.y||0]}},{easing:s,name:t.attributeNames.size,size:a.InstanceAttributeSize.TWO,update:function(e){return[e.width,e.height]}},{name:t.attributeNames.depth,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:t.attributeNames.scaling,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{name:t.attributeNames.texture,resource:{key:function(){return e.props.atlas||""},name:"imageAtlas"},update:function(t){return t.source,t.request?e.resource.request(e,t,t.request):(console.warn("An image utilizing the image-render-layer does not have its request specified yet.","The image-render-layer does NOT manage requests and should be handled before this layer deals with the instance"),[0,0,0,0])}},{easing:i,name:t.attributeNames.tint,size:a.InstanceAttributeSize.FOUR,update:function(e){return e.tint}}],uniforms:[{name:"scaleFactor",size:a.UniformSize.ONE,update:function(e){return[1]}}],vertexAttributes:[{name:"normals",size:a.VertexAttributeSize.TWO,update:function(e){return[c[e],u[e]]}}],vertexCount:6,vs:n(184)}},t.prototype.getMaterialOptions=function(){return s.CommonMaterialOptions.transparentImageBlending},t.defaultProps={key:"",data:new o.InstanceProvider},t.attributeNames={location:"location",anchor:"anchor",size:"size",depth:"depth",scaling:"scaling",texture:"texture",tint:"tint"},t}(n(5).Layer2D);t.ImageRenderLayer=c},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\ngl_FragColor = texture2D(imageAtlas, texCoord) * vertexColor;\nsetColor(gl_FragColor * gl_FragColor.a);\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec3 screenSize = cameraSpaceSize(vec3(size, 1.0));\nbool largerOnScreen = screenSize.y > size.y;\nfloat useScaleMode = float(\n(\nscaling == 3.0 ||\n(largerOnScreen && scaling == 2.0)\n) &&\nscaling != 1.0\n);\nfloat unequalZooms = float(cameraScale2D.x != cameraScale2D.y);\nfloat normal = normals.x;\nfloat side = normals.y;\nvec2 worldAnchor = location + anchor;\ntexCoord = texture.xy + ((texture.zw - texture.xy) * vec2(side, float(normal == -1.0)));\nvertexColor = tint;\nvec2 adjustedSize = mix(\nsize,\n(size * cameraScale2D.yx),\nunequalZooms\n);\nvec2 adjustedAnchor = mix(\nanchor,\n(anchor * cameraScale2D.yx),\nunequalZooms\n);\nvec2 vertex = vec2(side, float(normal == 1.0)) * adjustedSize + location - adjustedAnchor;\nfloat imageScreenScale = mix(\nscreenSize.y / adjustedSize.y,\nscreenSize.x / adjustedSize.x,\nfloat((cameraScale2D.x < 1.0) || (cameraScale2D.x > 1.0))\n);\nvec2 anchorToVertex = vertex - location;\nvertex = mix(\nvertex,\n(anchorToVertex / imageScreenScale) + location,\nuseScaleMode\n);\ngl_Position = clipSpace(vec3(vertex, depth));\n}"},function(e,t,n){"use strict";var r,i,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),c=n(10),u=n(0),l=n(14),h=Math.max,d=((i={})[l.AnchorType.TopLeft]=function(e,t){e.x=-e.padding,e.y=-e.padding},i[l.AnchorType.TopMiddle]=function(e,t){e.x=t.width/2,e.y=-e.padding},i[l.AnchorType.TopRight]=function(e,t){e.x=t.width+e.padding,e.y=-e.padding},i[l.AnchorType.MiddleLeft]=function(e,t){e.x=-e.padding,e.y=t.height/2},i[l.AnchorType.Middle]=function(e,t){e.x=t.width/2,e.y=t.height/2},i[l.AnchorType.MiddleRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height/2},i[l.AnchorType.BottomLeft]=function(e,t){e.x=-e.padding,e.y=t.height+e.padding},i[l.AnchorType.BottomMiddle]=function(e,t){e.x=t.width/2,e.y=t.height+e.padding},i[l.AnchorType.BottomRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height+e.padding},i[l.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},i),f=function(e){function t(t){var n=e.call(this,t)||this;return n.tint=[0,0,0,1],n.depth=0,n.height=1,n.origin=[0,0],n.scaling=l.ScaleMode.BOUND_MAX,n.width=1,n.sourceWidth=0,n.sourceHeight=0,n._anchor={padding:0,type:l.AnchorType.TopLeft,x:0,y:0},n.videoLoad=u.NOOP,n.depth=t.depth||n.depth,n.tint=t.tint||n.tint,n.scaling=t.scaling||n.scaling,n.origin=t.origin||n.origin,n.width=t.width||1,n.height=t.height||1,n.source=t.source,n.onReady=t.onReady,t.anchor&&n.setAnchor(t.anchor),n}return o(t,e),Object.defineProperty(t.prototype,"maxSize",{get:function(){return h(this.width,this.height)},set:function(e){var t=this.width/this.height;this.width=e*t,this.height=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},enumerable:!0,configurable:!0}),t.prototype.resourceTrigger=function(){this.source=this.source,this.request&&this.request.texture&&(this.sourceWidth=this.request.texture.pixelWidth,this.sourceHeight=this.request.texture.pixelHeight),this.onReady&&this.onReady(this)},t.prototype.setAnchor=function(e){var t={padding:e.padding||0,type:e.type,x:e.x||0,y:e.y||0};d[t.type](t,this),this._anchor=t},a([s.observable],t.prototype,"tint",void 0),a([s.observable],t.prototype,"depth",void 0),a([s.observable],t.prototype,"height",void 0),a([s.observable],t.prototype,"origin",void 0),a([s.observable],t.prototype,"scaling",void 0),a([s.observable],t.prototype,"source",void 0),a([s.observable],t.prototype,"width",void 0),a([s.observable],t.prototype,"_anchor",void 0),t}(c.Instance);t.ImageInstance=f},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(88)),r(n(52)),r(n(89)),r(n(90)),r(n(93)),r(n(197))},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\nsetColor(texColor * vertexColor);\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\nsetColor(texColor * vertexColor);\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 scale = fontScale * cameraScale2D.xy;\nfloat scaleBy = max(scale.x, scale.y) / maxScale;\nvec2 pushOut = normals * glyphSize * fontScale;\nfloat vx = mix(\n(origin.x + padding.x + offset.x + pushOut.x),\norigin.x + anchor.x + (padding.x - anchor.x + offset.x + pushOut.x) / scaleBy,\nfloat(scale.x >= maxScale)\n);\nfloat vy = mix(\n(origin.y + padding.y + offset.y + pushOut.y),\norigin.y + anchor.y + (padding.y - anchor.y + offset.y + pushOut.y) / scaleBy,\nfloat(scale.y >= maxScale)\n);\nvec3 position = vec3(vec2(vx, vy), depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 scale = fontScale * cameraScale2D.xy;\nfloat scaleBy = max(scale.x, scale.y) / maxScale;\nvec2 pushOut = normals * glyphSize * fontScale;\nfloat vx = mix(\n(-anchor.x + offset.x + pushOut.x),\n(-anchor.x + offset.x + pushOut.x) / scaleBy,\nfloat(scale.x >= maxScale)\n);\nfloat vy = mix(\n(-anchor.y + offset.y + pushOut.y),\n(-anchor.y + offset.y + pushOut.y) / scaleBy,\nfloat(scale.y >= maxScale)\n);\nvec3 position = vec3(origin + padding + vec2(vx, vy), depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\nsetColor(texColor * vertexColor);\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\nsetColor(texColor * vertexColor);\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 pushOut = normals * glyphSize * fontScale;\nvec3 position = vec3(origin + anchor + (padding - anchor + offset + pushOut) / cameraScale2D.xy , depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 pushOut = normals * glyphSize * fontScale;\nvec3 position = vec3(origin + padding + (-anchor + offset + pushOut) / cameraScale2D.xy, depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\nsetColor(texColor * vertexColor);\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 pushOut = normals * glyphSize * fontScale;\nvec3 position = vec3(origin + padding + offset + pushOut, depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t,n){"use strict";var r,i,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(50),s=n(3),c=n(16),u=n(19),l=n(0),h=n(14),d=n(5),f=n(198),p=n(199),g=n(52),v=n(88),y=n(93),m=((i={})[h.AnchorType.TopLeft]=function(e){return[0,0]},i[h.AnchorType.TopMiddle]=function(e){return[e.maxWidth/2,0]},i[h.AnchorType.TopRight]=function(e){return[e.maxWidth,0]},i[h.AnchorType.MiddleLeft]=function(e){return[0,e.maxHeight/2]},i[h.AnchorType.Middle]=function(e){return[e.maxWidth/2,e.maxHeight/2]},i[h.AnchorType.MiddleRight]=function(e){return[e.maxWidth,e.maxHeight/2]},i[h.AnchorType.BottomLeft]=function(e){return[0,e.maxHeight]},i[h.AnchorType.BottomMiddle]=function(e){return[e.maxWidth/2,e.maxHeight]},i[h.AnchorType.BottomRight]=function(e){return[e.maxWidth,e.maxHeight]},i[h.AnchorType.Custom]=function(e){return[e.anchor.x||0,e.anchor.y||0]},i);function b(e,t){for(var n=Number.MAX_SAFE_INTEGER,r=0,i=e.length;r<i;r++){var o=e[r],a=t.get(o);0===a?n=0:a&&a<n&&(n=a)}return n===Number.MAX_SAFE_INTEGER?0:n}function w(e,t,n){for(var r=[],i=n.fontMap?n.fontMap.fontSource.size:t.fontSize,o=t.fontSize/i,a="",c=0,u=[0,0],l=0,h=e.text.length;l<h;l++){var d=e.text[l];if(n.fontMap){var f=[0,0];a&&(f=n.fontMap.kerning[a][d]||[0,0]),u=s.add2(u,s.scale2(f,o)),0!==l&&(u=s.add2(u,[t.letterSpacing,0]));var p=n.fontMap.glyphMap[d];c=u[0]+p.pixelWidth*o,r.push(c),a=d}}return r}var x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.providers={labels:new a.InstanceProvider,borders:new a.InstanceProvider},t.fullUpdate=!1,t.areaToLabels=new Map,t.areaToLines=new Map,t.areaWaitingOnLabel=new Map,t.areaTokerningRequest=new Map,t.areaToWords=new Map,t.labelsInLine=[],t.handleLabelReady=function(e){if(e.parentTextArea){var n=e.parentTextArea,r=t.areaWaitingOnLabel.get(n);if(r&&r.has(e)&&(r.delete(e),r.size<=0)){n.active=!0;var i=n.onReady;i&&i(n)}}else delete e.onReady},t}return o(t,e),t.prototype.childLayers=function(){var e=this.props.animateLabel||{},t=this.props.animateBorder||{},n=this.props.scaling;return[u.createLayer(v.LabelLayer,{animate:e,customGlyphLayer:this.props.customGlyphLayer,data:this.providers.labels,key:this.id+".labels",resourceKey:this.props.resourceKey,scaleMode:n,inTextArea:!0}),u.createLayer(p.BorderLayer,{animate:{color:t.color,location:t.location},data:this.providers.borders,key:this.id+".border"})]},t.prototype.draw=function(){var e=this.resolveChanges();if(!(e.length<=0)){if(!this.propertyIds){var t=e[0][0];this.propertyIds=this.getInstanceObservableIds(t,["active","alignment","borderWidth","color","fontSize","hasBorder","letterSpacing","lineHeight","maxHeight","maxWidth","origin","padding","text","wordWrap"])}for(var n=this.propertyIds,r=n.active,i=n.alignment,o=n.borderWidth,a=n.color,s=n.fontSize,c=n.hasBorder,u=n.letterSpacing,h=n.lineHeight,d=n.maxHeight,f=n.maxWidth,p=n.origin,v=n.padding,y=n.text,m=n.wordWrap,b=0,w=e.length;b<w;++b){var x=e[b],T=(t=x[0],x[1]),_=x[2];switch(T){case l.InstanceDiffType.CHANGE:if(!this.areaToLabels.get(t)){this.insert(t);continue}void 0!==_[y]?(this.clear(t),this.updateLabels(t),this.layout(t)):void 0!==_[r]&&(t.active?(this.layout(t),this.showLabels(t)):this.hideLabels(t)),void 0!==_[i]&&(this.clear(t),this.updateLabels(t),this.layoutLabels(t)),void 0!==_[a]&&this.updateLabelColors(t),void 0!==_[p]&&this.updateLabelOrigins(t),void 0!==_[s]&&this.updateLabelFontSizes(t),void 0!==_[m]&&this.updateLabelLineWrap(t),void 0!==_[h]&&this.updateLabelLineHeight(t),void 0!==_[f]&&this.updateTextAreaSize(t),void 0!==_[d]&&this.updateTextAreaSize(t),void 0!==_[v]&&this.updateTextAreaSize(t),void 0!==_[o]&&this.updateBorderWidth(t),void 0!==_[c]&&this.updateBorder(t),void 0!==_[u]&&this.updateLetterSpacing(t);break;case l.InstanceDiffType.INSERT:this.insert(t);break;case l.InstanceDiffType.REMOVE:var E=this.areaToLabels.get(t);if(E){for(var A=0,M=E.length;A<M;++A){var S=E[A];S instanceof g.LabelInstance&&this.providers.labels.remove(S)}this.areaToLabels.delete(t),this.areaWaitingOnLabel.delete(t)}}}}},t.prototype.insert=function(e){this.layout(e),this.updateLabels(e)},t.prototype.hideLabels=function(e){var t=this.areaToLabels.get(e);if(t)for(var n=0,r=t.length;n<r;++n){var i=t[n];i instanceof g.LabelInstance&&this.providers.labels.remove(i)}},t.prototype.initShader=function(){return null},t.prototype.clear=function(e){for(var t=e.labels,n=0,r=t.length;n<r;n++){(o=t[n])instanceof g.LabelInstance&&this.providers.labels.remove(o)}e.labels=[];var i=e.newLabels;for(n=0,r=i.length;n<r;n++){var o;(o=i[n])instanceof g.LabelInstance&&this.providers.labels.remove(o)}e.newLabels=[],this.areaToLabels.delete(e),this.areaWaitingOnLabel.delete(e),this.areaToWords.delete(e)},t.prototype.seperateLabel=function(e,t,n,r,i,o,a,s,c){var u=e.padding[0],l=e.padding[1]||0,d=e.padding[2]||0,f=e.padding[3]||0,p=e.maxWidth-f-l,v=e.maxHeight-u-d,w=e.origin[0],x=e.origin[1];t.active=!1;var T=r.substring(0,i+1),_=b(T,n),E=m[e.anchor.type](e),A=new g.LabelInstance({anchor:{padding:0,type:h.AnchorType.Custom,paddingDirection:[o+f,a+u+_],x:E[0],y:E[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[w,x],text:T});if(A.size=[c[i],t.size[1]],this.providers.labels.add(A),e.newLabels.push(A),this.labelsInLine.push(A),o+=A.getWidth()+s,e.wordWrap===y.WordWrap.CHARACTER||e.wordWrap===y.WordWrap.WORD){if(this.setTextAlignment(o,a,s,p,e.alignment),o=0,(a+=e.lineHeight)+e.lineHeight<=v){for(var M=c[c.length-1]-c[i];M>p&&a+e.lineHeight<=v;){for(var S=c.length-1;c[S]-c[i]>p;)S--;var O=r.substring(i+1,S+1),I=b(O,n),P=new g.LabelInstance({anchor:{padding:0,type:h.AnchorType.Custom,paddingDirection:[o+f,a+u+I],x:E[0],y:E[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[w,x],text:O});P.size=[c[S]-c[i],t.size[1]],o+=P.getWidth()+s,this.labelsInLine.push(P),this.providers.labels.add(P),e.newLabels.push(P),this.setTextAlignment(o,a,s,p,e.alignment),o=0,a+=e.lineHeight,i=S,M=c[c.length-1]-c[i]}if(a+e.lineHeight<=v){var R=r.substring(i+1),L=b(R,n),C=new g.LabelInstance({anchor:{padding:0,type:h.AnchorType.Custom,paddingDirection:[o+f,a+u+L],x:E[0],y:E[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[w,x],text:R});C.size=[c[c.length-1]-c[i],t.size[1]],this.labelsInLine.push(C);for(var N=[],D=i+1;D<c.length;D++)N.push(c[D]-c[i]);this.providers.labels.add(C),e.newLabels.push(C),o+=C.getWidth()+s}}}else e.wordWrap===y.WordWrap.NONE&&(o+=A.getWidth()+s);return[o,a]},t.prototype.updateLabelLineWrap=function(e){var t=this.areaToLabels.get(e);if(t){for(var n=0,r=t.length;n<r;++n){(i=t[n])instanceof g.LabelInstance&&(i.active=!0)}for(n=0,r=e.newLabels.length;n<r;++n){var i=e.newLabels[n];this.providers.labels.remove(i)}e.newLabels=[],this.layoutLabels(e)}},t.prototype.updateLabelLineHeight=function(e){var t=this.areaToLabels.get(e);if(t){for(var n=0,r=t.length;n<r;++n){(i=t[n])instanceof g.LabelInstance&&(i.active=!0)}for(n=0,r=e.newLabels.length;n<r;++n){var i=e.newLabels[n];this.providers.labels.remove(i)}e.newLabels=[],this.layoutLabels(e)}},t.prototype.updateTextAreaSize=function(e){var t=this.areaToLabels.get(e);if(t){for(var n=0,r=t.length;n<r;++n){(i=t[n])instanceof g.LabelInstance&&(i.active=!0)}for(n=0,r=e.newLabels.length;n<r;++n){var i=e.newLabels[n];this.providers.labels.remove(i)}e.newLabels=[];for(n=0,r=e.borders.length;n<r;++n){var o=e.borders[n];this.providers.borders.remove(o)}e.borders=[],this.layoutBorder(e),this.layoutLabels(e)}},t.prototype.updateBorderWidth=function(e){for(var t=0,n=e.borders.length;t<n;++t){var r=e.borders[t];this.providers.borders.remove(r)}e.borders=[],this.layoutBorder(e)},t.prototype.updateBorder=function(e){if(e.hasBorder)this.layoutBorder(e);else{for(var t=0,n=e.borders.length;t<n;++t){var r=e.borders[t];this.providers.borders.remove(r)}e.borders=[]}},t.prototype.updateLetterSpacing=function(e){this.clear(e),this.updateLabels(e),this.layout(e)},t.prototype.setTextAlignment=function(e,t,n,r,i){if(e-n<r&&i!==y.TextAlignment.LEFT){var o=r-e+n,a=i===y.TextAlignment.RIGHT?o:o/2;this.labelsInLine.forEach((function(e){var n=e.anchor;e.anchor={padding:n.padding,type:h.AnchorType.Custom,paddingDirection:[(n.paddingDirection?n.paddingDirection[0]:0)+a,n.paddingDirection?n.paddingDirection[1]:t],x:n.x,y:n.y}}))}this.labelsInLine=[]},t.prototype.layoutBorder=function(e){if(e.hasBorder){var t=this.areaTokerningRequest.get(e);if(!t)return;var n=t.fontMap?t.fontMap.fontSource.size:e.fontSize,r=e.fontSize/n,i=this.props.scaling,o=e.borderWidth,a=new f.BorderInstance({color:e.color,fontScale:r,scaling:i,size:[e.maxWidth+2*o,o],textAreaOrigin:e.origin,textAreaAnchor:m[e.anchor.type](e),position:[-o,-o]}),s=new f.BorderInstance({color:e.color,fontScale:r,scaling:i,size:[o,e.maxHeight+2*o],textAreaOrigin:e.origin,textAreaAnchor:m[e.anchor.type](e),position:[-o,-o]}),c=new f.BorderInstance({color:e.color,fontScale:r,scaling:i,size:[o,e.maxHeight+2*o],textAreaOrigin:e.origin,textAreaAnchor:m[e.anchor.type](e),position:[e.maxWidth,-o]}),u=new f.BorderInstance({color:e.color,fontScale:r,scaling:i,size:[e.maxWidth+2*o,o],textAreaOrigin:e.origin,textAreaAnchor:m[e.anchor.type](e),position:[-o,e.maxHeight]});this.providers.borders.add(a),this.providers.borders.add(s),this.providers.borders.add(c),this.providers.borders.add(u),e.borders.push(a),e.borders.push(s),e.borders.push(c),e.borders.push(u)}},t.prototype.layoutLabels=function(e){var t=this.areaTokerningRequest.get(e);if(t){var n=e.padding[0],r=e.padding[1]||0,i=e.padding[2]||0,o=e.padding[3]||0,a=e.maxWidth-o-r,s=e.maxHeight-n-i,c=e.origin[0],u=e.origin[1],l=0;if(e.spaceWidth)l=e.spaceWidth;else{if(t.fontMap){var d=t.fontMap.fontSource.size,f=e.fontSize/d;l=t.fontMap.spaceWidth*f}else l=this.props.whiteSpaceKerning||e.fontSize/2;e.spaceWidth=l}var p=function(e,t){var n=new Map;if(t.fontMap){for(var r=t.fontMap.fontSource.size,i=e.fontSize/r,o=t.fontMap,a=e.text.replace(/\s/g,""),s=Number.MAX_SAFE_INTEGER,c=0,u=void 0,l="",h=0,d=a.length;h<d;++h){var f=a[h];u=0,l&&(u=o.kerning[l][f][1]||0),c+=u*i,n.set(f,c),s=Math.min(c,s),l=f}n.forEach((function(e,t){n.set(t,e-s)}))}return n}(e,t),v=0,x=0;this.labelsInLine=[];for(var T=0,_=e.labels.length;T<_;++T){var E=e.labels[T];if(E instanceof g.LabelInstance){var A=E.getWidth(),M=b(E.text,p),S=w(E,e,t);if(x+e.lineHeight<=s&&S[0]<=a)if(v+A<=a){E.origin=[c,u];var O=m[e.anchor.type](e);E.anchor={padding:0,paddingDirection:[v+o,x+n+M],type:h.AnchorType.Custom,x:O[0],y:O[1]},v+=A+l,this.labelsInLine.push(E),v>=a&&e.wordWrap===y.WordWrap.CHARACTER&&T+1<_&&e.labels[T+1]!==y.NewLineCharacterMode.NEWLINE&&(this.setTextAlignment(v,x,l,a,e.alignment),v=0,x+=e.lineHeight)}else if(e.wordWrap===y.WordWrap.WORD&&E.getWidth()<=e.maxWidth)if(this.setTextAlignment(v,x,l,a,e.alignment),v=0,(x+=e.lineHeight)+e.lineHeight<=s){E.origin=[c,u];O=m[e.anchor.type](e);E.anchor={padding:0,paddingDirection:[v+o,x+n+M],type:h.AnchorType.Custom,x:O[0],y:O[1]},this.labelsInLine.push(E),v+=E.getWidth()+l}else E.active=!1;else{for(var I=a-v,P=S.length-1,R=E.text;S[P]>I;)P--;if(P>=0)v=(L=this.seperateLabel(e,E,p,R,P,v,x,l,S))[0],x=L[1];else if(e.wordWrap===y.WordWrap.CHARACTER||e.wordWrap===y.WordWrap.WORD)if(this.setTextAlignment(v,x,l,a,e.alignment),v=0,(x+=e.lineHeight)+e.lineHeight<s)if(v+E.getWidth()<=a){E.origin=[c,u];O=m[e.anchor.type](e);E.anchor={padding:0,paddingDirection:[v+o,x+n+M],type:h.AnchorType.Custom,x:O[0],y:O[1]},this.labelsInLine.push(E),(v+=E.getWidth()+l)>=a&&T+1<_&&e.labels[T+1]!==y.NewLineCharacterMode.NEWLINE&&(this.setTextAlignment(v,x,l,a,e.alignment),v=0,x+=e.lineHeight)}else{for(var L,C=a-v,N=S.length-1,D=E.text;S[N]>C;)N--;if(N>=0)v=(L=this.seperateLabel(e,E,p,D,N,v,x,l,S))[0],x=L[1]}else E.active=!1;else e.wordWrap===y.WordWrap.NONE&&(E.active=!1)}else E.active=!1}else E===y.NewLineCharacterMode.NEWLINE&&(this.setTextAlignment(v,x,l,a,e.alignment),v=0,x+=e.lineHeight)}this.setTextAlignment(v,x,l,a,e.alignment)}},t.prototype.layout=function(e){this.updateKerning(e);var t=this.areaTokerningRequest.get(e);if(t&&t.fontMap){var n=this.areaWaitingOnLabel.get(e);if(!(n&&n.size>0)&&e.active){var r=this.areaToLabels.get(e);r&&0!==r.length&&(this.updateLabels(e),this.layoutBorder(e),this.layoutLabels(e))}}},t.prototype.updateKerning=function(e){var t=this.areaTokerningRequest.get(e),n=e.text;if(!t){var r={fontSize:e.fontSize,text:e.text,letterSpacing:e.letterSpacing};return t=c.fontRequest({character:"",key:this.props.resourceKey||"",kerningPairs:[n],metrics:r}),e.preload?(e.resourceTrigger=function(){e.onReady&&e.onReady(e)},this.resource.request(this,e,t)):(this.resource.request(this,e,t),this.areaTokerningRequest.set(e,t)),!1}return t.kerningPairs&&t.kerningPairs.indexOf(n)>-1?Boolean(t.fontMap):!(!t.fontMap||t.fontMap.supportsKerning(n))&&(this.areaTokerningRequest.delete(e),t=void 0,!0)},t.prototype.managesInstance=function(e){return Boolean(this.areaToLabels.get(e))},t.prototype.showLabels=function(e){var t=this.areaToLabels.get(e);if(t)for(var n=0,r=t.length;n<r;++n){var i=t[n];i instanceof g.LabelInstance&&this.providers.labels.add(i)}},t.prototype.updateLabels=function(e){var t=this.areaToLabels.get(e),n=e.padding[0],r=e.padding[3]||0,i=e.origin[0]+r,o=e.origin[1]+n;t||(t=[],this.areaToLabels.set(e,t));var a=this.areaWaitingOnLabel.get(e);a||(a=new Set,this.areaWaitingOnLabel.set(e,a));var s=this.areaToWords.get(e);if(s||(s=function(e){for(var t=[],n=e.split(l.newLineRegEx),r=0,i=n.length-1;r<i;r++){n[r].split(" ").forEach((function(e){""!==e&&t.push(e)})),t.push("/n")}return n[n.length-1].split(" ").forEach((function(e){""!==e&&t.push(e)})),t}(e.text)),t.length<s.length)for(var c=t.length,u=s.length;c<u;++c){var h=s[c];if("/n"===h)t.push(y.NewLineCharacterMode.NEWLINE);else{var d=new g.LabelInstance({active:!1,color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,text:h,origin:[i,o],onReady:this.handleLabelReady});d.parentTextArea=e,t.push(d),this.providers.labels.add(d),a.add(d)}}e.labels=t},t.prototype.updateLabelColors=function(e){var t=this.areaToLabels.get(e);if(t){for(var n=0,r=t.length;n<r;++n){var i=t[n];i instanceof g.LabelInstance&&(i.color=s.copy4(e.color))}n=0;for(var o=e.newLabels.length;n<o;++n)e.newLabels[n].color=s.copy4(e.color);for(n=0,o=e.borders.length;n<o;++n)e.borders[n].color=s.copy4(e.color)}},t.prototype.updateLabelFontSizes=function(e){this.clear(e),this.updateLabels(e),this.areaTokerningRequest.delete(e),this.layout(e)},t.prototype.updateLabelOrigins=function(e){var t=this.areaToLabels.get(e);if(t){for(var n=e.origin,r=e.oldOrigin,i=0,o=t.length;i<o;++i){if((s=t[i])instanceof g.LabelInstance){var a=s.origin;s.origin=[a[0]+n[0]-r[0],a[1]+n[1]-r[1]]}}for(i=0,o=e.newLabels.length;i<o;++i){var s;if((s=e.newLabels[i])instanceof g.LabelInstance){a=s.origin;s.origin=[a[0]+n[0]-r[0],a[1]+n[1]-r[1]]}}for(i=0,o=e.borders.length;i<o;++i){var c=e.borders[i];c.position=[c.position[0]+n[0]-r[0],c.position[1]+n[1]-r[1]]}e.oldOrigin=e.origin}},t.prototype.willUpdateProps=function(e){e.data!==this.props.data&&delete this.propertyIds,e.resourceKey!==this.props.resourceKey&&(this.fullUpdate=!0)},t.defaultProps={key:"",data:new a.InstanceProvider,scaling:h.ScaleMode.ALWAYS},t}(d.Layer2D);t.TextAreaLayer=x},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=function(e){function t(t){var n=e.call(this,t)||this;return n.fontScale=1,n.textAreaOrigin=[0,0],n.textAreaAnchor=[0,0],n.fontScale=t.fontScale||n.fontScale,n.textAreaOrigin=t.textAreaOrigin||n.textAreaOrigin,n.textAreaAnchor=t.textAreaAnchor||n.textAreaAnchor,n}return i(t,e),o([a.observable],t.prototype,"fontScale",void 0),o([a.observable],t.prototype,"textAreaOrigin",void 0),o([a.observable],t.prototype,"textAreaAnchor",void 0),t}(n(94).RectangleInstance);t.BorderInstance=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(0),s=n(44),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){var e=this.props.animate||{},r={0:1,1:1,2:-1,3:1,4:-1,5:-1},i={0:0,1:0,2:0,3:1,4:1,5:1},o=this.props.scaleFactor,s=void 0===o?function(){return 1}:o;return{fs:n(200),instanceAttributes:[{easing:e.location,name:t.attributeNames.location,size:a.InstanceAttributeSize.TWO,update:function(e){return e.position}},{name:t.attributeNames.anchor,size:a.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x||0,e.anchor.y||0]}},{name:t.attributeNames.size,size:a.InstanceAttributeSize.TWO,update:function(e){return e.size}},{name:t.attributeNames.depth,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:t.attributeNames.scaling,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{easing:e.color,name:t.attributeNames.color,size:a.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.scale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scale]}},{name:t.attributeNames.maxScale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.maxScale]}},{name:t.attributeNames.fontScale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.fontScale]}},{name:"textAreaOrigin",size:a.InstanceAttributeSize.TWO,update:function(e){return e.textAreaOrigin}},{name:"textAreaAnchor",size:a.InstanceAttributeSize.TWO,update:function(e){return e.textAreaAnchor}}],uniforms:[{name:"scaleFactor",size:a.UniformSize.ONE,update:function(e){return[s()]}}],vertexAttributes:[{name:"normals",size:a.VertexAttributeSize.TWO,update:function(e){return[r[e],i[e]]}}],vertexCount:6,vs:n(201)}},t.prototype.getMaterialOptions=function(){return s.CommonMaterialOptions.transparentShapeBlending},t.defaultProps={key:"",data:new o.InstanceProvider},t.attributeNames={anchor:"anchor",color:"color",depth:"depth",fontScale:"fontScale",location:"location",maxScale:"maxScale",scale:"scale",scaling:"scaling",size:"size"},t}(n(86).Layer2D);t.BorderLayer=c},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\nsetColor(vertexColor);\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\nfloat borderScale = mix(fontScale, 1.0, float(scaling == 3.0));\nvec3 screenSize = cameraSpaceSize(vec3(size * scale * borderScale / scaleFactor / maxScale, 1.0));\nbool largerOnScreen = screenSize.y > size.y || screenSize.x > size.x;\nfloat useScaleMode = float(\n(\nscaling == 3.0 ||\n(largerOnScreen && scaling == 2.0)\n) &&\nscaling != 1.0\n);\nfloat unequalZooms = float(cameraScale2D.x != cameraScale2D.y);\nvec2 adjustedSize = mix(\nsize,\n(size * cameraScale2D.yx),\nunequalZooms\n);\nfloat normal = normals.x;\nfloat side = normals.y;\nvec2 scaledAnchor = anchor * scale;\nvec2 worldAnchor = location + scaledAnchor;\nvec2 adjustedAnchor = mix(\nscaledAnchor,\n(scaledAnchor * cameraScale2D.yx),\nunequalZooms\n);\nvec2 vertex = vec2(side, float(normal == 1.0)) * scale * adjustedSize + location - adjustedAnchor;\nfloat labelScreenScale = mix(\nscreenSize.y / adjustedSize.y,\nscreenSize.x / adjustedSize.x,\nfloat((cameraScale2D.x != 1.0))\n);\nfloat currentScale = labelScreenScale * scale;\nvec2 anchorToVertex = vertex - location;\nvertex = mix(\nvertex + textAreaOrigin,\n(anchorToVertex + location - textAreaAnchor) / labelScreenScale + textAreaOrigin + textAreaAnchor,\nuseScaleMode\n);\nvertexColor = color;\ngl_Position = clipSpace(vec3(vertex, depth));\n}"},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(203)),r(n(94))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(0),s=n(1),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){var e=this.props.animate||{},r={0:1,1:1,2:-1,3:1,4:-1,5:-1},i={0:0,1:0,2:0,3:1,4:1,5:1},o=this.props.scaleFactor,s=void 0===o?function(){return 1}:o;return{fs:n(204),instanceAttributes:[{easing:e.location,name:t.attributeNames.location,size:a.InstanceAttributeSize.TWO,update:function(e){return e.position}},{name:t.attributeNames.anchor,size:a.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x||0,e.anchor.y||0]}},{name:t.attributeNames.size,size:a.InstanceAttributeSize.TWO,update:function(e){return e.size}},{name:t.attributeNames.depth,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:t.attributeNames.scaling,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{easing:e.color,name:t.attributeNames.color,size:a.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.scale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scale]}},{name:t.attributeNames.maxScale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.maxScale]}}],uniforms:[{name:"scaleFactor",size:a.UniformSize.ONE,update:function(e){return[s()]}}],vertexAttributes:[{name:"normals",size:a.VertexAttributeSize.TWO,update:function(e){return[r[e],i[e]]}}],vertexCount:6,vs:n(205)}},t.prototype.getMaterialOptions=function(){return s.CommonMaterialOptions.transparentShapeBlending},t.defaultProps={key:"",data:new o.InstanceProvider},t.attributeNames={anchor:"anchor",color:"color",depth:"depth",location:"location",maxScale:"maxScale",scale:"scale",scaling:"scaling",size:"size"},t}(n(5).Layer2D);t.RectangleLayer=c},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\nsetColor(vertexColor);\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\nvec3 screenSize = cameraSpaceSize(vec3(size * scale / scaleFactor / maxScale, 1.0));\nbool largerOnScreen = screenSize.y > size.y || screenSize.x > size.x;\nfloat useScaleMode = float(\n(\nscaling == 3.0 ||\n(largerOnScreen && scaling == 2.0)\n) &&\nscaling != 1.0\n);\nfloat unequalZooms = float(cameraScale2D.x != cameraScale2D.y);\nvec2 adjustedSize = mix(\nsize,\n(size * cameraScale2D.yx),\nunequalZooms\n);\nfloat normal = normals.x;\nfloat side = normals.y;\nvec2 scaledAnchor = anchor * scale;\nvec2 worldAnchor = location + scaledAnchor;\nvec2 adjustedAnchor = mix(\nscaledAnchor,\n(scaledAnchor * cameraScale2D.yx),\nunequalZooms\n);\nvec2 vertex = vec2(side, float(normal == 1.0)) * scale * adjustedSize + location - adjustedAnchor;\nfloat labelScreenScale = mix(\nscreenSize.y / adjustedSize.y,\nscreenSize.x / adjustedSize.x,\nfloat((cameraScale2D.x != 1.0))\n);\nfloat currentScale = labelScreenScale * scale;\nvec2 anchorToVertex = vertex - location;\nvertex = mix(\nvertex,\n(anchorToVertex / labelScreenScale) + location,\nuseScaleMode\n);\nvertexColor = color;\ngl_Position = clipSpace(vec3(vertex, depth));\n}"},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(207)),r(n(208))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(10),s=n(18),c=function(e){function t(t){var n=e.call(this,t)||this;return n.color=[1,1,1,1],n.depth=0,n.radius=0,n.thickness=1,n.center=[0,0],n.color=t.color||n.color,n.depth=t.depth||n.depth,n.radius=t.radius||n.radius,n.thickness=t.thickness||n.thickness,n.center=t.center||n.center,n}return i(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerRadius",{get:function(){return this.radius-this.thickness},enumerable:!0,configurable:!0}),o([s.observable],t.prototype,"color",void 0),o([s.observable],t.prototype,"depth",void 0),o([s.observable],t.prototype,"radius",void 0),o([s.observable],t.prototype,"thickness",void 0),o([s.observable],t.prototype,"center",void 0),t}(a.Instance);t.RingInstance=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(0),s=n(1),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){var e=this.props.scaleFactor||function(){return 1},r=this.props.animate||{},i=r.color,o=r.center,s=r.radius,c={0:1,1:1,2:-1,3:1,4:-1,5:-1},u={0:-1,1:-1,2:-1,3:1,4:1,5:1};return{fs:n(209),instanceAttributes:[{easing:o,name:t.attributeNames.center,size:a.InstanceAttributeSize.TWO,update:function(e){return e.center}},{easing:s,name:t.attributeNames.radius,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.radius]}},{name:t.attributeNames.depth,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{easing:i,name:t.attributeNames.color,size:a.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.thickness,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.thickness]}}],uniforms:[{name:"scaleFactor",size:a.UniformSize.ONE,update:function(t){return[e()]}}],vertexAttributes:[{name:"normals",size:a.VertexAttributeSize.TWO,update:function(e){return[c[e],u[e]]}}],vertexCount:6,vs:n(210)}},t.prototype.getMaterialOptions=function(){return s.CommonMaterialOptions.transparentShapeBlending},t.defaultProps={key:"",data:new o.InstanceProvider},t.attributeNames={center:"center",radius:"radius",depth:"depth",color:"color",thickness:"thickness"},t}(n(5).Layer2D);t.RingLayer=c},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float borderSize;\nvarying vec2 pointCoord;\nvarying float scale;\nfloat circle(vec2 coord, float radius){\nvec2 dist = coord - vec2(0.5);\nreturn 1.0 - smoothstep(\nradius - (radius * edgeSharpness),\nradius,\ndot(dist, dist) * 4.0\n);\n}\nvoid main() {\nfloat outer_step_factor = circle(pointCoord, 1.0);\nfloat inner_step_factor = circle(pointCoord, 1.0 - borderSize * scale);\nsetColor(mix(\nmix(\nvec4(0.0, 0.0, 0.0, 0.0),\nvertexColor,\nouter_step_factor\n),\nvec4(0.0, 0.0, 0.0, 0.0),\ninner_step_factor\n));\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float borderSize;\nvarying vec2 pointCoord;\nvarying float scale;\nvoid main() {\nscale = scaleFactor;\nvertexColor = color;\nfloat size = radius * scaleFactor * pixelRatio;\nfloat ringWidth = mix(2.0 , thickness, float(thickness > 2.0));\nborderSize = mix(\n(ringWidth) / size,\n((ringWidth * pixelRatio) / size),\nfloat(pixelRatio > 1.0)\n);\nedgeSharpness = min(0.2 / (ringWidth * scale), 0.1);\npointCoord = (normals.xy + vec2(1.0, 1.0)) / 2.0;\nvec4 clipCenter = clipSpace(vec3(center, depth));\nvec2 screenCenter = (clipCenter.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nvec2 vertex = (normals.xy * size) + screenCenter;\ngl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), clipCenter.zw);\n}"},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(212),r(n(254)),r(n(98)),r(n(258))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(213),n(250),n(252)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(27),i=n(5),o=n(34),a=n(0);o.ShaderModule.register([{moduleId:"world2DXY",content:n(85),compatibility:a.ShaderInjectionTarget.ALL,uniforms:function(e){return e instanceof i.Layer2D?e.props.control2D?[{name:"projection",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"view",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"cameraOffset",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof r.Control2D?e.props.control2D.offset:[0,0,0]}},{name:"cameraPosition",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraScale2D",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof r.Control2D?e.props.control2D.scale:[1,1,1]}},{name:"cameraRotation",size:a.UniformSize.FOUR,update:function(){return e.view.props.camera.transform.rotation}},{name:"viewSize",size:a.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:a.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requesed the module world2DXZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}}])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(215),n(217),n(218),n(219),n(220),n(221),n(237),n(242),n(247)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(8).ShaderModule.register([{moduleId:"camera",content:"",compatibility:r.ShaderInjectionTarget.ALL,uniforms:function(e){return[{name:"projection",size:r.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"viewProjection",size:r.UniformSize.MATRIX4,update:function(){return e.view.props.camera.viewProjection}},{name:"view",size:r.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"cameraPosition",size:r.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:r.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraRotation",size:r.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"viewSize",size:r.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:r.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]}},{moduleId:"projection",content:n(216),compatibility:r.ShaderInjectionTarget.ALL}])},function(e,t){e.exports="${import: camera}\nvec3 cameraSpace(vec3 world) {\nreturn (view * vec4(world, 1.0)).xyz;\n}\nvec3 cameraSpaceSize(vec3 worldSize) {\nreturn (view * vec4(worldSize, 0.0)).xyz;\n}\nvec4 clipSpace(vec3 world) {\nreturn (projection * view) * vec4(world, 1.0);\n}\nvec4 clipSpaceSize(vec3 worldSize) {\nreturn (projection * view) * vec4(worldSize, 0.0);\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(8).ShaderModule.register({moduleId:"dimColor",content:n(95),compatibility:r.ShaderInjectionTarget.ALL})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(8).ShaderModule.register({moduleId:"frame",content:"",compatibility:r.ShaderInjectionTarget.ALL,uniforms:function(e){return[{name:"currentTime",size:r.UniformSize.ONE,update:function(){return[e.surface.frameMetrics.currentTime]}},{name:"currentFrame",size:r.UniformSize.ONE,update:function(){return[e.surface.frameMetrics.currentFrame]}}]}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(8).ShaderModule.register({moduleId:"hsv",content:n(95),compatibility:r.ShaderInjectionTarget.ALL})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(8).ShaderModule.register({moduleId:"instancing",content:"",compatibility:r.ShaderInjectionTarget.ALL,instanceAttributes:function(e){var t={name:"_active",size:r.InstanceAttributeSize.ONE,update:function(e){return[e.active?1:0]}};return e.activeAttribute=t,[t]},vertexAttributes:function(e){return e.bufferType===r.LayerBufferType.UNIFORM?[{name:"instance",size:r.VertexAttributeSize.ONE,update:function(){return[0]}}]:[]}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(8),o=[{moduleId:"PI_INV",content:n(222),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"PI2_INV",content:n(223),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"PI_2",content:n(224),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"PI_4",content:n(225),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"PI",content:n(226),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"PI2",content:n(227),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"toDegrees",content:n(228),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"toRadians",content:n(229),compatibility:r.ShaderInjectionTarget.ALL}],a={moduleId:"constants",content:"${import: "+o.map((function(e){return e.moduleId})).join(", ")+"}",compatibility:r.ShaderInjectionTarget.ALL},s=[{moduleId:"bezier1",content:n(230),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"bezier2",content:n(231),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"arc",content:n(232),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"fmod",content:n(233),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"wrap",content:n(234),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"fcos",content:n(235),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"fsin",content:n(236),compatibility:r.ShaderInjectionTarget.ALL}];i.ShaderModule.register(s.concat(o,[a]))},function(e,t){e.exports="float PI_INV = 0.3183098862;"},function(e,t){e.exports="float PI2_INV = 0.1591549431;"},function(e,t){e.exports="float PI_2 = 1.5707963268;"},function(e,t){e.exports="float PI_4 = 0.7853981634;"},function(e,t){e.exports="float PI = 3.14159265;"},function(e,t){e.exports="float PI2 = 6.2831853;"},function(e,t){e.exports="float toDegrees = 57.2957795131;"},function(e,t){e.exports="float toRadians = 0.01745329252;"},function(e,t){e.exports="vec2 bezier1(float t, vec2 p1, vec2 p2, vec2 c1) {\nreturn (1.0 - t) * (1.0 - t) * p1 + 2.0 * t * (1.0 - t) * c1 + t * t * p2;\n}"},function(e,t){e.exports="vec2 bezier2(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\nfloat t1 = 1.0 - t;\nreturn pow(t1, 3.0) * p1 + 3.0 * t * pow(t1, 2.0) * c1 + 3.0 * pow(t, 2.0) * t1 * c2 + pow(t, 3.0) * p2;\n}"},function(e,t){e.exports="${import: PI, PI2, fsin, fcos, wrap}\nvec2 arc(float t, vec2 center, float radius, float start, float end) {\nfloat angle = wrap((end - start) * t + start, 0.0, PI2);\nreturn center + vec2(fcos(angle), fsin(angle)) * radius;\n}"},function(e,t){e.exports="float fmod(float x, float m, float m_inv) {\nreturn x - m * floor(x * m_inv);\n}"},function(e,t){e.exports="float wrap(float value, float start, float end) {\nfloat width = end - start;\nfloat offsetValue = value - start;\nreturn (offsetValue - (floor(offsetValue / width) * width)) + start;\n}"},function(e,t){e.exports="${import: PI, PI2, PI_2}\nfloat fcos(float x) {\nfloat sine;\nx += PI_2;\nx += mix(\nmix(\n0.0,\n-PI2, float(x > PI)\n),\nPI2, float(x < -PI)\n);\nsine = 1.27323954 * x;\nsine += mix(-1.0, 1.0, float(x < 0.0)) * 0.405284735 * x * x;\nsine = 0.225 * (sine * (mix(1.0, -1.0, float(sine < 0.0)) * sine) - sine) + sine;\nreturn sine;\n}"},function(e,t){e.exports="${import: PI, PI2}\nfloat fsin(float x) {\nfloat sine;\nx += mix(\nmix(\n0.0,\n-PI2, float(x > PI)\n),\nPI2, float(x < -PI)\n);\nsine = 1.27323954 * x;\nsine += mix(-1.0, 1.0, float(x < 0.0)) * 0.405284735 * x * x;\nsine = 0.225 * (sine * (mix(1.0, -1.0, float(sine < 0.0)) * sine) - sine) + sine;\nreturn sine;\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(8).ShaderModule.register([{moduleId:"translation",compatibility:r.ShaderInjectionTarget.ALL,content:n(238)},{moduleId:"rotation",compatibility:r.ShaderInjectionTarget.ALL,content:n(239)},{moduleId:"scale",compatibility:r.ShaderInjectionTarget.ALL,content:n(240)},{moduleId:"transform",compatibility:r.ShaderInjectionTarget.ALL,content:n(241)}])},function(e,t){e.exports="mat4 translation(vec3 t) {\nreturn mat4(\n1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 0,\nt.x, t.y, t.z, 1\n);\n}"},function(e,t){e.exports="mat4 rotationFromQuaternion(vec4 q) {\nfloat x2 = q.y + q.y;\nfloat y2 = q.z + q.z;\nfloat z2 = q.w + q.w;\nfloat xx = q.y * x2;\nfloat xy = q.y * y2;\nfloat xz = q.y * z2;\nfloat yy = q.z * y2;\nfloat yz = q.z * z2;\nfloat zz = q.w * z2;\nfloat wx = q.x * x2;\nfloat wy = q.x * y2;\nfloat wz = q.x * z2;\nreturn mat4(\n1.0 - (yy + zz), xy - wz, xz + wy, 0.0,\nxy + wz, 1.0 - (xx + zz), yz - wx, 0.0,\nxz - wy, yz + wx, 1.0 - (xx + yy), 0.0,\n0, 0, 0, 1\n);\n}"},function(e,t){e.exports="mat4 scale(vec3 s) {\nreturn mat4(\ns.x, 0, 0, 0,\n0, s.y, 0, 0,\n0, 0, s.z, 0,\n0, 0, 0, 1\n);\n}"},function(e,t){e.exports="${import: translation, rotation, scale}\nmat4 transform(vec3 s, vec4 r, vec3 t) {\nreturn translation(t) * rotationFromQuaternion(r) * scale(s);\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(8).ShaderModule.register([{moduleId:"picking",content:n(243),compatibility:r.ShaderInjectionTarget.VERTEX,instanceAttributes:function(e){return[{name:"_pickingColor",size:r.InstanceAttributeSize.FOUR,update:function(e){var t=16777215-e.uid;return[((16711680&t)>>16)/255,((65280&t)>>8)/255,(255&t)/255,1]}}]},uniforms:function(e){return[{name:"pickingActive",shaderInjection:r.ShaderInjectionTarget.ALL,size:r.UniformSize.ONE,update:function(){return[e.picking.currentPickMode===r.PickType.SINGLE?1:0]}}]}},{moduleId:"picking",content:n(244),compatibility:r.ShaderInjectionTarget.FRAGMENT},{moduleId:"no-picking",content:n(245),compatibility:r.ShaderInjectionTarget.VERTEX},{moduleId:"no-picking",content:n(246),compatibility:r.ShaderInjectionTarget.FRAGMENT}])},function(e,t){e.exports="varying highp vec4 _picking_color_pass_;"},function(e,t){e.exports="varying highp vec4 _picking_color_pass_;\nhighp vec4 setColor(vec4 color) {\ngl_FragColor = mix(color, _picking_color_pass_, pickingActive);\nif (color.a == 0.0) {\ndiscard;\n}\nreturn gl_FragColor;\n}"},function(e,t){e.exports=""},function(e,t){e.exports="lowp vec4 setColor(vec4 color) {\ngl_FragColor = color;\nreturn gl_FragColor;\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(8).ShaderModule.register([{moduleId:"no-op",content:n(248),compatibility:r.ShaderInjectionTarget.VERTEX},{moduleId:"no-op",content:n(249),compatibility:r.ShaderInjectionTarget.FRAGMENT}])},function(e,t){e.exports="void main() {\ngl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n}"},function(e,t){e.exports="void main() {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(27),i=n(5),o=n(34),a=n(0);o.ShaderModule.register([{moduleId:"world2DXZ",content:n(251),compatibility:a.ShaderInjectionTarget.ALL,uniforms:function(e){return e instanceof i.Layer2D?e.props.control2D?[{name:"projection",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"view",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"cameraOffset",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof r.Control2D?e.props.control2D.offset:[0,0,0]}},{name:"cameraPosition",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraScale2D",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof r.Control2D?e.props.control2D.scale:[1,1,1]}},{name:"cameraRotation",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"viewSize",size:a.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:a.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requesed the module world2DXZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}}])},function(e,t){e.exports="vec3 cameraSpace(vec3 world) {\nreturn (world + cameraOffset) * cameraScale2D;\n}\nvec3 cameraSpaceSize(vec3 worldSize) {\nreturn worldSize * cameraScale2D;\n}\nvec4 clipSpace(vec3 world) {\nreturn ((projection * view) * vec4(cameraSpace(world.xzy), 1.0));\n}\nvec4 clipSpaceSize(vec3 worldSize) {\nreturn ((projection * view) * vec4(cameraSpaceSize(worldSize.xzy), 0.0));\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(30),i=n(5),o=n(34),a=n(0);o.ShaderModule.register([{moduleId:"world2DYZ",content:n(253),compatibility:a.ShaderInjectionTarget.ALL,uniforms:function(e){return e instanceof i.Layer2D?e.props.control2D?[{name:"projection",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"view",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"cameraOffset",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof r.Control2D?e.props.control2D.offset:[0,0,0]}},{name:"cameraPosition",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraScale2D",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof r.Control2D?e.props.control2D.scale:[1,1,1]}},{name:"cameraRotation",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"viewSize",size:a.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:a.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requesed the module world2DYZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}}])},function(e,t){e.exports="vec3 cameraSpace(vec3 world) {\nreturn (world + cameraOffset) * cameraScale2D;\n}\nvec3 cameraSpaceSize(vec3 worldSize) {\nreturn worldSize * cameraScale2D;\n}\nvec4 clipSpace(vec3 world) {\nreturn ((projection * view) * vec4(cameraSpace(world.zyx), 1.0));\n}\nvec4 clipSpaceSize(vec3 worldSize) {\nreturn ((projection * view) * vec4(cameraSpaceSize(worldSize.zyx), 0.0));\n}"},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(96)),r(n(255)),r(n(97)),r(n(96))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(27),o=n(19);!function(e){e[e.XY=0]="XY",e[e.XZ=1]="XZ",e[e.YZ=2]="YZ"}(r=t.Axis2D||(t.Axis2D={})),t.createLayer2Din3D=function(e,t,n){var a;if(!(t===i.Layer2D||t.prototype instanceof i.Layer2D))return console.warn("A Layer type was specified for createLayer2din3D that is NOT a Layer2D type, which is invalid.","The layer will be used without being modified."),o.createLayer(t,n);switch(e){case r.XY:a="world2DXY";break;case r.XZ:a="world2DXZ";break;case r.YZ:a="world2DYZ";break;default:return o.createLayer(t,n)}var s=Object.assign({},n,{baseShaderModules:function(e,t){var n=t.vs.indexOf("world2D");return n>=0&&t.vs.splice(n,1,a),(n=t.fs.indexOf("world2D"))>=0&&t.fs.splice(n,1,a),t}});return o.createLayer(t,s)}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(11),a=n(257),s=n(40),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._local=new s.Transform,t._parent=null,t._world=o.identity4(),t}return i(t,e),Object.defineProperty(t.prototype,"local",{get:function(){return this._local.matrix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._world?this._world:this._local.matrix},enumerable:!0,configurable:!0}),t.prototype.willMount=function(){throw new Error("Method not implemented.")},t.prototype.didMount=function(){throw new Error("Method not implemented.")},t}(a.Node);t.Node3D=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=function(){function e(){this._uid=r.uid(),this._siblings=new Map}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"siblings",{get:function(){return this._siblings},enumerable:!0,configurable:!0}),e.prototype.addSibling=function(e,t){this._siblings.set(e.uid,e),t||e.siblings.has(this.uid)||e.addSibling(this,!0)},e.prototype.addSiblings=function(e){for(var t=0,n=e.length;t<n;++t){var r=e[t];this._siblings.set(r.uid,r),r.siblings.has(this.uid)||r.addSibling(this,!0)}},e.prototype.remove=function(){var e=this;this._siblings.forEach((function(t){t.removeSibling(e)})),this._siblings.clear()},e.prototype.removeSibling=function(e,t){this._siblings.delete(e.uid)&&!t&&e.removeSibling(this,!0)},e.prototype.trigger=function(){},e}();t.Node=i},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(259)),r(n(260))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(99))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(261)),r(n(264))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(2),s=n(19),c=n(0),u=n(1),l=n(98),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){var e=[1,1,1],t=[1,1,-1],r=[1,-1,-1],i=[1,-1,1],a=[-1,1,1],u=[-1,1,-1],h=[-1,-1,-1],d=[-1,-1,1],f=[e,t,r,e,r,i,a,e,i,a,i,d,a,h,u,a,d,h,u,r,t,u,h,r,a,t,e,a,u,t,d,i,r,d,r,h],p=[1,0,0],g=[0,0,1],v=[-1,0,0],y=[0,0,-1],m=[0,1,0],b=[0,-1,0],w=[p,p,p,p,p,p,g,g,g,g,g,g,v,v,v,v,v,v,y,y,y,y,y,y,m,m,m,m,m,m,b,b,b,b,b,b],x=[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,0],[1,1],[0,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]];return{drawMode:o.GLSettings.Model.DrawMode.TRIANGLES,fs:n(262),instanceAttributes:[s.createAttribute({name:"transform",size:c.InstanceAttributeSize.MAT4X4,update:function(e){return(e.transform||l.IdentityTransform).matrix}}),s.createAttribute({name:"size",size:c.InstanceAttributeSize.THREE,update:function(e){return e.size}})],uniforms:[],vertexAttributes:[{name:"position",size:c.VertexAttributeSize.THREE,update:function(e){return f[e]}},{name:"normal",size:c.VertexAttributeSize.THREE,update:function(e){return w[e]}},{name:"texCoord",size:c.VertexAttributeSize.TWO,update:function(e){return x[e]}}],vertexCount:36,vs:n(263)}},t.prototype.getMaterialOptions=function(){return Object.assign({},u.CommonMaterialOptions.transparentShapeBlending,{cullSide:o.GLSettings.Material.CullSide.CCW})},t.defaultProps={data:new a.InstanceProvider,key:"",materialOptions:u.CommonMaterialOptions.transparentShapeBlending},t}(s.Layer);t.CubeLayer=h},function(e,t){e.exports="varying vec2 _texCoord;\nvoid main() {\ngl_FragColor = mix(\nvec4(1.0, 0.0, 0.0, 1.0),\nvec4(0.0, 0.0, 0.0, 1.0),\nfloat(_texCoord.x <= 0.01 || _texCoord.x > 0.99 || _texCoord.y < 0.01 || _texCoord.y > 0.99)\n);\n}"},function(e,t){e.exports="${import: projection}\nvarying vec2 _texCoord;\nvoid main() {\nvec4 pos = vec4(position * size, 1.0);\nvec4 world = transform * pos;\n_texCoord = texCoord;\ngl_Position = clipSpace(world.xyz);\n}"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),s=function(e){function t(t){var n=e.call(this,t)||this;return n.size=[1,1,1],n.color=[1,1,1,1],n.size=t.size||n.size,n.color=t.color||n.color,n}return i(t,e),o([a.observable],t.prototype,"size",void 0),o([a.observable],t.prototype,"color",void 0),t}(n(99).Instance3D);t.CubeInstance=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(266))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(35),s=n(2),c=n(7),u=n(15),l=n(0),h=n(1);function d(e,t){for(var n=[],r=Object.values(t),i=0;i<r.length;++i){var o=r[i];o instanceof e?n.push(o):r.push.apply(r,Object.values(o))}return n}function f(e,t,n,r){for(var i=new Set,o=[],a=Object.keys(n).map((function(e){return[e,n[e]]})),s=function(n){var s=a[n];if(t(s[1]))o.push(r(s[0],s[1]));else{var c=!1;if(Object.keys(s[1]).forEach((function(t){var n=s[1][t];i.has(n)?(c=!0,console.warn("Invalid lookup for BasicSurface detected:",e)):(a.push([s[0]+"."+t,n]),i.add(n))})),c)return"break"}},c=0;c<a.length;++c){if("break"===s(c))break}return o}var p=function(){function e(e){var t=this;this.currentTime=0,this.drawRequestId=0,this.resizeTimer=0,this.waitForSizeContext=0,this.destroy=function(){t.base&&(t.base.destroy(),delete t.base),t.context&&(t.context.remove(),delete t.context),h.stopAnimationLoop(t.drawRequestId),window.removeEventListener("resize",t.handleResize)},this.draw=function(e){return i(t,void 0,void 0,(function(){return o(this,(function(t){return this.base?(this.currentTime=e,this.base.draw(e),[2]):[2]}))}))},this.handleResize=function(){clearTimeout(t.resizeTimer),t.base&&(t.resizeTimer=window.setTimeout((function(){t.fitContainer()}),100))},this.rebuild(e)}return e.prototype.createContext=function(){this.context||(this.context=document.createElement("canvas"),this.context.title="",this.context.width=(this.options.container.offsetWidth||0)*window.devicePixelRatio,this.context.height=(this.options.container.offsetHeight||0)*window.devicePixelRatio,this.context.style.width=(this.options.container.offsetWidth||0)+"px",this.context.style.height=(this.options.container.offsetHeight||0)+"px",this.options.container.appendChild(this.context))},e.prototype.init=function(){return i(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return this.base?[2]:[4,this.waitForValidDimensions(this.options.container)];case 1:if(!n.sent())return[2];this.createContext(),n.label=2;case 2:return n.trys.push([2,5,,6]),this.providers=this.options.providers,this.cameras=this.options.cameras,this.resources=this.options.resources||{},this.eventManagers=this.options.eventManagers(this.cameras),e=this,[4,new u.Surface({context:this.context,handlesWheelEvents:void 0===this.options.handlesWheelEvents||this.options.handlesWheelEvents,pixelRatio:window.devicePixelRatio,eventManagers:d(a.EventManager,this.eventManagers),rendererOptions:Object.assign({alpha:!0,antialias:!1},this.options.rendererOptions)}).ready];case 3:return e.base=n.sent(),this.fitContainer(!0),this.drawRequestId=h.onAnimationLoop(this.draw),[4,this.updatePipeline()];case 4:return n.sent(),window.addEventListener("resize",this.handleResize),[3,6];case 5:return(t=n.sent()).error===l.SurfaceErrorType.NO_WEBGL_CONTEXT?this.options.onNoWebGL&&this.options.onNoWebGL():(console.error("The Basic Surface could not be initialized"),console.error(t.stack||t.message)),[3,6];case 6:return[2]}}))}))},e.prototype.fitContainer=function(e){this.base&&(this.context.remove(),this.base.resize(this.options.container.offsetWidth||0,this.options.container.offsetHeight||0),this.options.container.appendChild(this.context),e||this.base.draw(this.currentTime))},e.prototype.getViewProjections=function(e){return this.base?this.base.getProjections(e):null},e.prototype.getViewScreenSize=function(e){if(!this.base)return[0,0];var t=this.base.getViewSize(e);return t?[t.width,t.height]:[0,0]},e.prototype.getViewScreenBounds=function(e){if(!this.base)return new c.Bounds({x:0,y:0,width:0,height:0});var t=this.base.getViewWorldBounds(e);return t||new c.Bounds({x:0,y:0,width:0,height:0})},e.prototype.getViewWorldBounds=function(e){if(!this.base)return new c.Bounds({x:0,y:0,width:0,height:0});var t=this.base.getViewWorldBounds(e);return t||new c.Bounds({x:0,y:0,width:0,height:0})},e.prototype.pipeline=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.options.scenes=e,this.base?[4,this.updatePipeline()]:[2];case 1:return t.sent(),[2]}}))}))},e.prototype.rebuild=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a;return o(this,(function(o){switch(o.label){case 0:if("boolean"==typeof e){if(e&&this.providers)for(n=d(s.InstanceProvider,this.providers),r=0,i=n.length;r<i;++r)n[r].clear()}else t=e;return this.options&&t&&console.warn("Ignoring options provided to rebuild method. The constructor is the only way to apply an options configuration object"),this.base&&this.base.destroy(),this.context&&(this.context.remove(),delete this.context),!this.options&&t&&(this.options=t),a=new h.PromiseResolver,this.ready=a.promise,[4,this.init()];case 1:return o.sent(),a.resolve(this),[2]}}))}))},e.prototype.setContainer=function(e){this.options.container=e,e.appendChild(this.context),this.fitContainer()},e.prototype.updatePipeline=function(){return i(this,void 0,void 0,(function(){var e,t,n,i;return o(this,(function(o){switch(o.label){case 0:return this.base?(e=f("resources",(function(e){return e&&void 0!==e.type}),this.resources||[],(function(e,t){var n=r({},t,{key:t.key||e});return t.key=n.key,n}))||[],t=this.options.scenes(this.resources||{},this.providers,this.cameras,this.eventManagers),n=f("scenes",(function(e){return e&&void 0!==e.views&&void 0!==e.layers}),t,(function(e,t){var n=f("views",(function(e){return e&&void 0!==e.init&&2===e.init.length}),t.views,(function(t,n){var i=r({},n,{key:e+"."+(n.key||t)});return i.init[1]=r({},i.init[1],{key:i.key}),i})),i=f("layers",(function(e){return e&&void 0!==e.init}),t.layers,(function(e,t){var n={init:t.init,key:t.key||e};return t.init[1].key=n.key,n})),o={key:e,order:t.order,views:n,layers:i};return void 0===t.order&&delete o.order,o})),i={resources:e,scenes:n},[4,this.base.pipeline(i)]):[2];case 1:return[2,o.sent()]}}))}))},e.prototype.waitForValidDimensions=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,s,c=this;return o(this,(function(o){switch(o.label){case 0:return t=++this.waitForSizeContext,n=new h.PromiseResolver,0!==(r=e.getBoundingClientRect()).width&&0!==r.height?[3,2]:(i=!0,a={attributes:!0},(s=new MutationObserver((function(o){if(i)for(var a=0,u=o;a<u.length;a++){"attributes"===u[a].type&&0!==(r=e.getBoundingClientRect()).width&&0!==r.height&&(s.disconnect(),i=!1,n.resolve(t===c.waitForSizeContext))}}))).observe(e,a),[4,h.nextFrame()]);case 1:return o.sent(),r=e.getBoundingClientRect(),i&&0!==r.width&&0!==r.height&&(s.disconnect(),i=!1,n.resolve(t===this.waitForSizeContext)),[3,4];case 2:return[4,h.nextFrame()];case 3:o.sent(),n.resolve(t===this.waitForSizeContext),o.label=4;case 4:return[4,n.promise];case 5:return[2,o.sent()]}}))}))},e}();t.BasicSurface=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(268))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(15),s=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return console.warn("Please ensure all debugLayer calls are removed for production:",r.key),i}return i(t,e),t.prototype.childLayers=function(){return this.props.wrap?(this.props.wrap.init[1].key="debug-wrapper."+this.props.key,[this.props.wrap]):[]},t.prototype.draw=function(){if(this.props.wrap){var e=this.resolveChanges(!0);if(0!==e.length){var t=this.props.messageHeader,n=void 0===t?function(){return""}:t;console.warn(n()+"\n",{totalChanges:e.length,changes:e})}}},t.prototype.initShader=function(){if(!this.props.wrap)return null;for(var e=new this.props.wrap.init[0](this.surface,this.scene,this.props.wrap.init[1]),t=e.childLayers(),n={};t.length>0;){var r=t.pop();if(r){var i=new r.init[0](this.surface,this.scene,r.init[1]);n[i.id]={shaderIO:i.initShader()},i.childLayers().forEach((function(e){return t.push(e)}))}}return console.warn("Shader IO: "+this.id+"\n",{shaderIO:e.initShader(),childLayers:n}),null},t.defaultProps={data:new o.InstanceProvider,key:"default",messageHeader:function(){return""},wrap:a.createLayer(a.Layer,{data:new o.InstanceProvider,scene:"default"})},t}(a.Layer);t.debugLayer=function(e,t){var n=a.createLayer(s,{messageHeader:function(){return"CHANGES FOR: "+n.init[1].key},wrap:a.createLayer(e,t),data:t.data});return n}}])}));
//# sourceMappingURL=index.js.map