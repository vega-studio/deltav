!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["network-bubble-chart"]=t():e["network-bubble-chart"]=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=133)}([function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.FragmentOutputType=t.isBoolean=t.isFunction=t.isNumber=t.isString=t.StreamChangeStrategy=t.LayerBufferType=t.SurfaceErrorType=t.InstanceDiffType=t.PickType=t.createMaterialOptions=t.isNewline=t.newLineCharRegEx=t.newLineRegEx=t.isWhiteSpace=t.whiteSpaceCharRegEx=t.whiteSpaceRegEx=t.NOOP=t.ShaderInjectionTarget=t.isResourceAttribute=t.isInstanceAttributeVector=t.EulerOrder=t.ResourceType=t.TextureSize=t.VertexAttributeSize=t.UniformSize=t.instanceAttributeSizeFloatCount=t.InstanceAttributeSize=t.InstanceBlockIndex=void 0,function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR"}(t.InstanceBlockIndex||(t.InstanceBlockIndex={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR",e[e.MAT4X4=16]="MAT4X4",e[e.ATLAS=99]="ATLAS"}(i=t.InstanceAttributeSize||(t.InstanceAttributeSize={})),t.instanceAttributeSizeFloatCount=((n={})[i.ONE]=1,n[i.TWO]=2,n[i.THREE]=3,n[i.FOUR]=4,n[i.MAT4X4]=16,n[i.ATLAS]=4,n),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR",e[e.MATRIX3=9]="MATRIX3",e[e.MATRIX4=16]="MATRIX4",e[e.FLOAT_ARRAY=97]="FLOAT_ARRAY",e[e.VEC4_ARRAY=98]="VEC4_ARRAY",e[e.TEXTURE=99]="TEXTURE"}(t.UniformSize||(t.UniformSize={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR"}(t.VertexAttributeSize||(t.VertexAttributeSize={})),function(e){e[e.SCREEN_256TH=-256]="SCREEN_256TH",e[e.SCREEN_128TH=-128]="SCREEN_128TH",e[e.SCREEN_64TH=-64]="SCREEN_64TH",e[e.SCREEN_32ND=-32]="SCREEN_32ND",e[e.SCREEN_16TH=-16]="SCREEN_16TH",e[e.SCREEN_8TH=-8]="SCREEN_8TH",e[e.SCREEN_QUARTER=-4]="SCREEN_QUARTER",e[e.SCREEN_HALF=-2]="SCREEN_HALF",e[e.SCREEN=-1]="SCREEN",e[e._2=2]="_2",e[e._4=4]="_4",e[e._8=8]="_8",e[e._16=16]="_16",e[e._32=32]="_32",e[e._64=64]="_64",e[e._128=128]="_128",e[e._256=256]="_256",e[e._512=512]="_512",e[e._1024=1024]="_1024",e[e._2048=2048]="_2048",e[e._4096=4096]="_4096"}(t.TextureSize||(t.TextureSize={})),function(e){e[e.ATLAS=0]="ATLAS",e[e.FONT=1]="FONT",e[e.TEXTURE=2]="TEXTURE",e[e.COLOR_BUFFER=3]="COLOR_BUFFER"}(t.ResourceType||(t.ResourceType={})),function(e){e[e.zyx=0]="zyx",e[e.zyz=1]="zyz",e[e.zxy=2]="zxy",e[e.zxz=3]="zxz",e[e.yxz=4]="yxz",e[e.yxy=5]="yxy",e[e.yzx=6]="yzx",e[e.yzy=7]="yzy",e[e.xyz=8]="xyz",e[e.xyx=9]="xyx",e[e.xzy=10]="xzy",e[e.xzx=11]="xzx"}(t.EulerOrder||(t.EulerOrder={})),t.isInstanceAttributeVector=function(e){return void 0!==e.size&&e.size<=4},t.isResourceAttribute=function(e){return Boolean(e&&e.resource)},function(e){e[e.VERTEX=1]="VERTEX",e[e.FRAGMENT=2]="FRAGMENT",e[e.ALL=3]="ALL"}(t.ShaderInjectionTarget||(t.ShaderInjectionTarget={})),t.NOOP=function(){},t.whiteSpaceRegEx=/\s/g,t.whiteSpaceCharRegEx=/\s/,t.isWhiteSpace=t.whiteSpaceCharRegEx.test.bind(t.whiteSpaceCharRegEx),t.newLineRegEx=/\n\r|\n|\r/g,t.newLineCharRegEx=/\n\r|\n|\r/,t.isNewline=t.newLineCharRegEx.test.bind(t.newLineCharRegEx),t.createMaterialOptions=function(e){return e},function(e){e[e.NONE=0]="NONE",e[e.SINGLE=1]="SINGLE"}(t.PickType||(t.PickType={})),function(e){e[e.CHANGE=0]="CHANGE",e[e.INSERT=1]="INSERT",e[e.REMOVE=2]="REMOVE"}(t.InstanceDiffType||(t.InstanceDiffType={})),function(e){e[e.NO_WEBGL_CONTEXT=0]="NO_WEBGL_CONTEXT"}(t.SurfaceErrorType||(t.SurfaceErrorType={})),function(e){e[e.UNIFORM=0]="UNIFORM",e[e.INSTANCE_ATTRIBUTE=1]="INSTANCE_ATTRIBUTE",e[e.INSTANCE_ATTRIBUTE_PACKING=2]="INSTANCE_ATTRIBUTE_PACKING"}(t.LayerBufferType||(t.LayerBufferType={})),function(e){e[e.LINEAR=0]="LINEAR"}(t.StreamChangeStrategy||(t.StreamChangeStrategy={})),t.isString=function(e){return void 0!==e&&void 0!==e.charCodeAt},t.isNumber=function(e){return void 0!==e&&void 0!==e.toExponential},t.isFunction=function(e){return void 0!==e&&void 0!==e.call&&void 0!==e.apply},t.isBoolean=function(e){return!0===e||!1===e},function(e){e[e.NONE=0]="NONE",e[e.BLANK=1]="BLANK",e[e.COLOR=2]="COLOR",e[e.DEPTH=3]="DEPTH",e[e.NORMAL=4]="NORMAL",e[e.PICKING=5]="PICKING",e[e.POSITION=6]="POSITION",e[e.POSITION_X=7]="POSITION_X",e[e.POSITION_Y=8]="POSITION_Y",e[e.POSITION_Z=9]="POSITION_Z",e[e.LIGHTS=10]="LIGHTS",e[e.LIGHTS2=11]="LIGHTS2",e[e.LIGHTS3=12]="LIGHTS3",e[e.ALPHA=13]="ALPHA",e[e.BETA=14]="BETA",e[e.GAMMA=15]="GAMMA",e[e.DELTA=16]="DELTA",e[e.ACCUMULATION1=17]="ACCUMULATION1",e[e.ACCUMULATION2=18]="ACCUMULATION2",e[e.ACCUMULATION3=19]="ACCUMULATION3",e[e.ACCUMULATION4=20]="ACCUMULATION4",e[e.COEFFICIENT1=21]="COEFFICIENT1",e[e.COEFFICIENT2=22]="COEFFICIENT2",e[e.COEFFICIENT3=23]="COEFFICIENT3",e[e.COEFFICIENT4=24]="COEFFICIENT4",e[e.ANGLE1=25]="ANGLE1",e[e.ANGLE2=26]="ANGLE2",e[e.ANGLE3=27]="ANGLE3",e[e.ANGLE4=28]="ANGLE4",e[e.COLOR2=29]="COLOR2",e[e.COLOR3=30]="COLOR3",e[e.COLOR4=31]="COLOR4",e[e.GLOW=32]="GLOW",e[e.BLUR=33]="BLUR"}(t.FragmentOutputType||(t.FragmentOutputType={}))},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(20),t),i(r(35),t),i(r(11),t),i(r(143),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dot2=t.normalize2=t.multiply2=t.subtract2=t.scale2=t.min2=t.max2=t.inverse2=t.floor2=t.flatten2=t.empty2=t.divide2=t.fuzzyCompare2=t.compare2=t.cross2=t.forward2=t.copy2=t.ceil2=t.add2=t.apply2=t.vec1=t.length1Components=t.length1=t.linear1=t.dot1=t.normalize1=t.multiply1=t.min1=t.max1=t.subtract1=t.scale1=t.inverse1=t.floor1=t.flatten1=t.empty1=t.divide1=t.cross1=t.forward1=t.copy1=t.fuzzyCompare1=t.compare1=t.ceil1=t.add1=t.apply1=t.isVec4=t.isVec3=t.isVec2=t.isVec1=t.V4R=t.V3R=void 0,t.dot4=t.multiply4=t.subtract4=t.scale4=t.inverse4=t.floor4=t.flatten4=t.empty4=t.divide4=t.cross4=t.forward4=t.fuzzyCompare4=t.compare4=t.copy4=t.ceil4=t.add4by3=t.add4=t.apply4=t.down3=t.left3=t.right3=t.up3=t.vec3=t.dot3=t.normalize3=t.min3=t.max3=t.length3Components=t.length3=t.linear3=t.multiply3=t.subtract3=t.scale3=t.inverse3=t.floor3=t.flatten3=t.empty3=t.divide3=t.cross3=t.forward3=t.fuzzyCompare3=t.compare3=t.copy3=t.ceil3=t.add3=t.apply3=t.vec2=t.length2Components=t.length2=t.linear2=void 0,t.toString4=t.toString3=t.toString2=t.toString1=t.VecMath=t.vec4Methods=t.vec3Methods=t.vec2Methods=t.vec1Methods=t.slerpQuat=t.color4FromHex4=t.color4FromHex3=t.vec4=t.normalize4=t.min4=t.max4=t.length4Components=t.length4=t.linear4=void 0;var n=Math.sqrt,i=Math.max,o=Math.min,a=Math.floor,s=Math.ceil,u=Math.abs,c=Math.acos,l=Math.sin;function f(e,t){return(e=e||[])[0]=t,e}function d(e,t,r){return f(r,e[0]+t[0])}function p(e,t){return f(t,s(e[0]))}function h(e,t){return e[0]===t[0]}function b(e,t){return f(t,e[0])}function g(){return[0]}function v(e,t,r){return f(r,0)}function y(e,t,r){return f(r,e[0]/t[0])}function m(e){return f(e,0)}function w(e,t){t=t||[];for(var r=0,n=e.length;r<n;++r)t.push(e[r][0]);return t}function O(e,t){return f(t,a(e[0]))}function _(e,t){return f(t,1/e[0])}function T(e,t,r){return f(r,e[0]*t)}function P(e,t,r){return f(r,e[0]-t[0])}function x(e,t,r){return f(r,i(e[0],t[0]))}function E(e,t,r){return f(r,o(e[0],t[0]))}function j(e,t,r){return f(r,e[0]*t[0])}function S(e,t){return f(t,1)}function R(e,t){return e[0]*t[0]}function M(e,t,r,n){return d(T(P(t,e),r),e,n)}function A(e){return e[0]}function I(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(r=r||[],(t=Array.isArray(e)?e.slice(0,1):[e]).length<1)for(var i=0,o=r.length;i<o&&t.length<1;++i){var a=r[i];Array.isArray(a)?t.push.apply(t,a.slice(0,1-t.length)):t.push(a)}for(;t.length<1;)t.push(0);return t}function L(e,t,r){return(e=e||new Array(2))[0]=t,e[1]=r,e}function C(e,t,r){return L(r,e[0]+t[0],e[1]+t[1])}function B(e,t){return L(t,s(e[0]),s(e[1]))}function D(e,t){return L(t,e[0],e[1])}function F(e){return L(e,1,0)}function N(e,t,r){return L(r,0,0)}function U(e,t){return e[0]===t[0]&&e[1]===t[1]}function G(e,t,r){return L(r,e[0]/t[0],e[1]/t[1])}function z(e){return L(e,0,0)}function k(e,t){t=t||new Array(2*e.length);for(var r=0,n=0,i=e.length;r<i;++r,n+=2){var o=e[r];t[n]=o[0],t[n+1]=o[1]}return t}function V(e,t){return L(t,a(e[0]),a(e[1]))}function W(e,t){return L(t,1/e[0],1/e[1])}function H(e,t,r){return L(r,i(e[0],t[0]),i(e[1],t[1]))}function Q(e,t,r){return L(r,o(e[0],t[0]),o(e[1],t[1]))}function q(e,t,r){return L(r,e[0]*t,e[1]*t)}function X(e,t,r){return L(r,e[0]-t[0],e[1]-t[1])}function Y(e,t,r){return L(r,e[0]*t[0],e[1]*t[1])}function K(e,t){var r=J(e);return L(t,e[0]/r,e[1]/r)}function $(e,t){return e[0]*t[0]+e[1]*t[1]}function Z(e,t,r,n){return C(q(X(t,e),r),e,n)}function J(e){return ee(e[0],e[1])}function ee(e,t){return n(e*e+t*t)}function te(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(r=r||[],(t=Array.isArray(e)?e.slice(0,2):[e]).length<2)for(var i=0,o=r.length;i<o&&t.length<2;++i){var a=r[i];Array.isArray(a)?t.push.apply(t,a.slice(0,2-t.length)):t.push(a)}for(;t.length<2;)t.push(0);return t}function re(e,t,r,n){return(e=e||new Array(3))[0]=t,e[1]=r,e[2]=n,e}function ne(e,t,r){return re(r,e[0]+t[0],e[1]+t[1],e[2]+t[2])}function ie(e,t){return re(t,s(e[0]),s(e[1]),s(e[2]))}function oe(e,t){return re(t,e[0],e[1],e[2])}function ae(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function se(e){return re(e,0,0,-1)}function ue(e,t,r){return(r=r||new Array(3))[0]=e[1]*t[2]-e[2]*t[1],r[1]=e[2]*t[0]-e[0]*t[2],r[2]=e[0]*t[1]-e[1]*t[0],r}function ce(e,t,r){return re(r,e[0]/t[0],e[1]/t[1],e[2]/t[2])}function le(e){return re(e,0,0,0)}function fe(e,t){t=t||new Array(3*e.length);for(var r=0,n=0,i=e.length;r<i;++r,n+=3){var o=e[r];t[n]=o[0],t[n+1]=o[1],t[n+2]=o[2]}return t}function de(e,t){return re(t,a(e[0]),a(e[1]),a(e[2]))}function pe(e,t){return re(t,1/e[0],1/e[1],1/e[2])}function he(e,t,r){return re(r,e[0]*t,e[1]*t,e[2]*t)}function be(e,t,r){return re(r,e[0]-t[0],e[1]-t[1],e[2]-t[2])}function ge(e,t,r){return re(r,e[0]*t[0],e[1]*t[1],e[2]*t[2])}function ve(e,t,r,n){return ne(he(be(t,e),r),e,n)}function ye(e){return me(e[0],e[1],e[2])}function me(e,t,r){return n(e*e+t*t+r*r)}function we(e,t,r){return re(r,i(e[0],t[0]),i(e[1],t[1]),i(e[2],t[2]))}function Oe(e,t,r){return re(r,o(e[0],t[0]),o(e[1],t[1]),o(e[2],t[2]))}function _e(e,t){t=t||new Array(3);var r=ye(e);return t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r,t}function Te(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Pe(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(r=r||[],(t=Array.isArray(e)?e.slice(0,3):[e]).length<3)for(var i=0,o=r.length;i<o&&t.length<3;++i){var a=r[i];Array.isArray(a)?t.push.apply(t,a.slice(0,3-t.length)):t.push(a)}for(;t.length<3;)t.push(0);return t}function xe(e,t,r,n,i){return(e=e||new Array(4))[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function Ee(e,t,r){return xe(r,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3])}function je(e,t){return xe(t,s(e[0]),s(e[1]),s(e[2]),s(e[3]))}function Se(e,t){return xe(t,e[0],e[1],e[2],e[3])}function Re(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Me(e){return xe(e,0,0,-1,0)}function Ae(e,t,r){return xe(r,0,0,0,1)}function Ie(e,t,r){return xe(r,e[0]/t[0],e[1]/t[1],e[2]/t[2],e[3]/t[3])}function Le(e){return xe(e,0,0,0,0)}function Ce(e,t){t=t||new Array(4);for(var r=0,n=0,i=e.length;r<i;++r,n+=4){var o=e[r];t[n]=o[0],t[n+1]=o[1],t[n+2]=o[2],t[n+3]=o[3]}return t}function Be(e,t){return xe(t,a(e[0]),a(e[1]),a(e[2]),a(e[3]))}function De(e,t){return xe(t,1/e[0],1/e[1],1/e[2],1/e[3])}function Fe(e,t,r){return xe(r,e[0]*t,e[1]*t,e[2]*t,e[3]*t)}function Ne(e,t,r){return xe(r,e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function Ue(e,t,r){return xe(r,e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3])}function Ge(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function ze(e,t,r,n){return Ee(Fe(Ne(t,e),r),e,n)}function ke(e){return Ve(e[0],e[1],e[2],e[3])}function Ve(e,t,r,i){return n(e*e+t*t+r*r+i*i)}function We(e,t,r){return xe(r,i(e[0],t[0]),i(e[1],t[1]),i(e[2],t[2]),i(e[3],t[3]))}function He(e,t,r){return xe(r,o(e[0],t[0]),o(e[1],t[1]),o(e[2],t[2]),o(e[3],t[3]))}function Qe(e,t){var r=ke(e);return xe(t,e[0]/r,e[1]/r,e[2]/r,e[3]/r)}function qe(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(r=r||[],(t=Array.isArray(e)?e.slice(0,4):[e]).length<4)for(var i=0,o=r.length;i<o&&t.length<4;++i){var a=r[i];Array.isArray(a)?t.push.apply(t,a.slice(0,4-t.length)):t.push(a)}for(;t.length<4;)t.push(0);return t}function Xe(e,t,r,n){n=n||[0,0,0,0];var i,o,a,s,u,f=[0,0,0,0];return(o=e[1]*t[1]+e[2]*t[2]+e[3]*t[3]+e[0]*t[0])<0?(o=-o,f[0]=-t[0],f[1]=-t[1],f[2]=-t[2],f[3]=-t[3]):(f[0]=t[0],f[1]=t[1],f[2]=t[2],f[3]=t[3]),1-o>1e-7?(i=c(o),a=l(i),s=l((1-r)*i)/a,u=l(r*i)/a):(s=1-r,u=r),n[1]=s*e[1]+u*f[1],n[2]=s*e[2]+u*f[2],n[3]=s*e[3]+u*f[3],n[0]=s*e[0]+u*f[0],n}t.V3R=new Array(20).fill(0).map((function(e){return[0,0,0]})),t.V4R=new Array(20).fill(0).map((function(e){return[0,0,0,0]})),t.isVec1=function(e){return e&&Array.isArray(e)&&1===e.length},t.isVec2=function(e){return e&&Array.isArray(e)&&2===e.length},t.isVec3=function(e){return e&&Array.isArray(e)&&3===e.length},t.isVec4=function(e){return e&&Array.isArray(e)&&4===e.length},t.apply1=f,t.add1=d,t.ceil1=p,t.compare1=h,t.fuzzyCompare1=function(e,t,r){return u(e[0]-t[0])<=r},t.copy1=b,t.forward1=g,t.cross1=v,t.divide1=y,t.empty1=m,t.flatten1=w,t.floor1=O,t.inverse1=_,t.scale1=T,t.subtract1=P,t.max1=x,t.min1=E,t.multiply1=j,t.normalize1=S,t.dot1=R,t.linear1=M,t.length1=A,t.length1Components=function(e){return e},t.vec1=I,t.apply2=L,t.add2=C,t.ceil2=B,t.copy2=D,t.forward2=F,t.cross2=N,t.compare2=U,t.fuzzyCompare2=function(e,t,r){return u(e[0]-t[0])<=r&&u(e[1]-t[1])<=r},t.divide2=G,t.empty2=z,t.flatten2=k,t.floor2=V,t.inverse2=W,t.max2=H,t.min2=Q,t.scale2=q,t.subtract2=X,t.multiply2=Y,t.normalize2=K,t.dot2=$,t.linear2=Z,t.length2=J,t.length2Components=ee,t.vec2=te,t.apply3=re,t.add3=ne,t.ceil3=ie,t.copy3=oe,t.compare3=ae,t.fuzzyCompare3=function(e,t,r){return u(e[0]-t[0])<=r&&u(e[1]-t[1])<=r&&u(e[2]-t[2])<=r},t.forward3=se,t.cross3=ue,t.divide3=ce,t.empty3=le,t.flatten3=fe,t.floor3=de,t.inverse3=pe,t.scale3=he,t.subtract3=be,t.multiply3=ge,t.linear3=ve,t.length3=ye,t.length3Components=me,t.max3=we,t.min3=Oe,t.normalize3=_e,t.dot3=Te,t.vec3=Pe,t.up3=function(e,t,r){return _e(ue(ue(e,t,r=r||[0,0,0]),e,r),r)},t.right3=function(e,t,r){return _e(ue(e,t,r=r||[0,0,0]),r)},t.left3=function(e,t,r){return _e(ue(t,e,r=r||[0,0,0]),r)},t.down3=function(e,t,r){return _e(ue(e,ue(e,t,r=r||[0,0,0]),r),r)},t.apply4=xe,t.add4=Ee,t.add4by3=function(e,t,r){return xe(r,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3])},t.ceil4=je,t.copy4=Se,t.compare4=Re,t.fuzzyCompare4=function(e,t,r){return u(e[0]-t[0])<=r&&u(e[1]-t[1])<=r&&u(e[2]-t[2])<=r&&u(e[3]-t[3])<=r},t.forward4=Me,t.cross4=Ae,t.divide4=Ie,t.empty4=Le,t.flatten4=Ce,t.floor4=Be,t.inverse4=De,t.scale4=Fe,t.subtract4=Ne,t.multiply4=Ue,t.dot4=Ge,t.linear4=ze,t.length4=ke,t.length4Components=Ve,t.max4=We,t.min4=He,t.normalize4=Qe,t.vec4=qe,t.color4FromHex3=function(e,t){return xe(t=t||[0,0,0,0],((16711680&e)>>16)/255,((65280&e)>>8)/255,(255&e)/255,1)},t.color4FromHex4=function(e,t){return xe(t=t||[0,0,0,0],((4278190080&e)>>24)/255,((16711680&e)>>16)/255,((65280&e)>>8)/255,(255&e)/255)},t.slerpQuat=Xe,t.vec1Methods={add:d,ceil:p,copy:b,compare:h,cross:v,divide:y,dot:R,empty:m,flatten:w,floor:O,forward:g,inverse:_,length:A,linear:M,max:x,min:E,multiply:j,normalize:S,scale:T,subtract:P,vec:I},t.vec2Methods={add:C,ceil:B,copy:D,compare:U,cross:N,divide:G,dot:$,empty:z,flatten:k,floor:V,forward:F,inverse:W,length:J,linear:Z,max:H,min:Q,multiply:Y,normalize:K,scale:q,subtract:X,vec:te},t.vec3Methods={add:ne,ceil:ie,copy:oe,compare:ae,cross:ue,divide:ce,dot:Te,empty:le,flatten:fe,floor:de,forward:se,inverse:pe,length:ye,linear:ve,max:we,min:Oe,multiply:ge,normalize:_e,scale:he,subtract:be,vec:Pe},t.vec4Methods={add:Ee,ceil:je,copy:Se,compare:Re,cross:Ae,divide:Ie,dot:Ge,empty:Le,flatten:Ce,floor:Be,forward:Me,inverse:De,length:ke,linear:ze,max:We,min:He,multiply:Ue,normalize:Qe,scale:Fe,subtract:Ne,vec:qe,slerpQuat:Xe},t.VecMath=function(e){return 1===e.length?t.vec1Methods:2===e.length?t.vec2Methods:3===e.length?t.vec3Methods:t.vec4Methods},t.toString1=function(e){return"[".concat(e[0],"]")},t.toString2=function(e){return"[".concat(e[0],", ").concat(e[1],"]")},t.toString3=function(e){return"[".concat(e[0],", ").concat(e[1],", ").concat(e[2],"]")},t.toString4=function(e){return"[".concat(e[0],", ").concat(e[1],", ").concat(e[2],", ").concat(e[3],"]")}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(16),t),i(r(55),t),i(r(56),t),i(r(62),t),i(r(168),t),i(r(28),t),i(r(95),t),i(r(29),t),i(r(96),t),i(r(61),t),i(r(38),t),i(r(79),t),i(r(8),t),i(r(169),t),i(r(101),t),i(r(170),t),i(r(57),t),i(r(18),t),i(r(102),t),i(r(103),t),i(r(171),t)},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(137),t),i(r(138),t),i(r(44),t),i(r(68),t),i(r(10),t),i(r(71),t),i(r(141),t),i(r(142),t),i(r(45),t),i(r(72),t),i(r(15),t),i(r(26),t),i(r(73),t),i(r(14),t)},function(e,t,r){(function(n){function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}(t=e.exports=r(139)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),!r)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))})),e.splice(o,0,n)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,r(70))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Layer2D=void 0;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"baseShaderModules",{enumerable:!1,configurable:!0,writable:!0,value:function(t){var r=e.prototype.baseShaderModules.call(this,t);return r.vs.push("world2D"),r}}),t}(r(13).Layer);t.Layer2D=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bounds=void 0;var n=Math.min,i=Math.max,o=function(){function e(e){Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"d",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.x=e.x||e.left||0,this.y=e.y||e.top||0,this.height=e.height||(e.bottom||0)-this.y||0,this.width=e.width||(e.right||0)-this.x||0}return Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mid",{get:function(){return[this.x+this.width/2,this.y+this.height/2]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(e,"emptyBounds",{enumerable:!1,configurable:!0,writable:!0,value:function(){return new e({height:0,width:0,x:0,y:0})}}),Object.defineProperty(e.prototype,"containsPoint",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return!(e[0]<this.x||e[1]<this.y||e[0]>this.right||e[1]>this.bottom)}}),Object.defineProperty(e.prototype,"encapsulate",{enumerable:!1,configurable:!0,writable:!0,value:function(t){return t instanceof e?(t.x<this.x&&(this.width+=Math.abs(t.x-this.x),this.x=t.x),t.y<this.y&&(this.height+=Math.abs(t.y-this.y),this.y=t.y),this.right<t.right&&(this.width+=t.right-this.right),this.bottom<t.bottom&&(this.height+=t.bottom-this.bottom),!0):(t[0]<this.x&&(this.width+=this.x-t[0],this.x=t[0]),t[0]>this.right&&(this.width+=t[0]-this.x),t[1]<this.y&&(this.height+=this.y-t[1],this.y=t[1]),t[1]>this.bottom&&(this.height+=t[1]-this.y),!0)}}),Object.defineProperty(e.prototype,"encapsulateAll",{enumerable:!1,configurable:!0,writable:!0,value:function(t){if(!(t.length<=0)){var r=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;if(t[0]instanceof e)for(var u=t,c=0,l=u.length;c<l;++c){var f=u[c];r=n(r,f.left),o=i(o,f.right),a=n(a,f.top),s=i(s,f.bottom)}else{var d=t;for(c=0,l=d.length;c<l;++c){var p=d[c],h=p[0],b=p[1];r=n(r,h),o=i(o,h),a=n(a,b),s=i(s,b)}}this.x=Math.min(this.x,r),this.y=Math.min(this.y,a),this.width=Math.max(this.width,o-r),this.height=Math.max(this.height,s-a)}}}),Object.defineProperty(e.prototype,"fits",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.width===e.width&&this.height===e.height?1:this.width>=e.width&&this.height>=e.height?2:0}}),Object.defineProperty(e.prototype,"hitBounds",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return!(this.right<e.x||this.x>e.right||this.bottom<e.y||this.y>e.bottom)}}),Object.defineProperty(e.prototype,"isInside",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.x>=e.x&&this.right<=e.right&&this.y>=e.y&&this.bottom<=e.bottom}}),Object.defineProperty(e.prototype,"location",{get:function(){return[this.x,this.y]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"toString",{enumerable:!1,configurable:!0,writable:!0,value:function(){return"{x: ".concat(this.x," y:").concat(this.y," w:").concat(this.width," h:").concat(this.height,"}")}}),e}();t.Bounds=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.colorUID=t.uid=void 0;var n=1;t.uid=function(){return++n};var i=0;t.colorUID=function(){return++i%16777215}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(87),t),i(r(84),t),i(r(83),t),i(r(81),t),i(r(82),t),i(r(98),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GLSettings=void 0,function(e){!function(e){!function(e){e[e.RGBA4=0]="RGBA4",e[e.RGB565=1]="RGB565",e[e.RGB5_A1=2]="RGB5_A1",e[e.R8=3]="R8",e[e.R8UI=4]="R8UI",e[e.R8I=5]="R8I",e[e.R16UI=6]="R16UI",e[e.R16I=7]="R16I",e[e.R32UI=8]="R32UI",e[e.R32I=9]="R32I",e[e.RG8=10]="RG8",e[e.RG8UI=11]="RG8UI",e[e.RG8I=12]="RG8I",e[e.RG16UI=13]="RG16UI",e[e.RG16I=14]="RG16I",e[e.RG32UI=15]="RG32UI",e[e.RG32I=16]="RG32I",e[e.RGB8=17]="RGB8",e[e.RGBA8=18]="RGBA8",e[e.SRGB8_ALPHA8=19]="SRGB8_ALPHA8",e[e.RGB10_A2=20]="RGB10_A2",e[e.RGBA8UI=21]="RGBA8UI",e[e.RGBA8I=22]="RGBA8I",e[e.RGB10_A2UI=23]="RGB10_A2UI",e[e.RGBA16UI=24]="RGBA16UI",e[e.RGBA16I=25]="RGBA16I",e[e.RGBA32I=26]="RGBA32I",e[e.RGBA32UI=27]="RGBA32UI"}(e.ColorBufferFormat||(e.ColorBufferFormat={})),function(e){e[e.DEPTH_COMPONENT16=0]="DEPTH_COMPONENT16",e[e.DEPTH_STENCIL=1]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=2]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=3]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=4]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=5]="DEPTH32F_STENCIL8"}(e.DepthBufferFormat||(e.DepthBufferFormat={})),function(e){e[e.STENCIL_INDEX8=0]="STENCIL_INDEX8"}(e.StencilBufferFormat||(e.StencilBufferFormat={}))}(e.RenderTarget||(e.RenderTarget={})),function(e){!function(e){e[e.NoBlending=-1]="NoBlending",e[e.NormalBlending=1]="NormalBlending",e[e.AdditiveBlending=2]="AdditiveBlending",e[e.SubtractiveBlending=3]="SubtractiveBlending",e[e.MultiplyBlending=4]="MultiplyBlending"}(e.Blending||(e.Blending={})),function(e){e[e.Zero=-1]="Zero",e[e.One=1]="One",e[e.SrcColor=2]="SrcColor",e[e.OneMinusSrcColor=3]="OneMinusSrcColor",e[e.SrcAlpha=4]="SrcAlpha",e[e.OneMinusSrcAlpha=5]="OneMinusSrcAlpha",e[e.DstAlpha=6]="DstAlpha",e[e.OneMinusDstAlpha=7]="OneMinusDstAlpha",e[e.DstColor=8]="DstColor",e[e.OneMinusDstColor=9]="OneMinusDstColor"}(e.BlendingDstFactor||(e.BlendingDstFactor={})),function(e){e[e.Zero=-1]="Zero",e[e.One=1]="One",e[e.SrcColor=2]="SrcColor",e[e.OneMinusSrcColor=3]="OneMinusSrcColor",e[e.SrcAlpha=4]="SrcAlpha",e[e.OneMinusSrcAlpha=5]="OneMinusSrcAlpha",e[e.DstAlpha=6]="DstAlpha",e[e.OneMinusDstAlpha=7]="OneMinusDstAlpha",e[e.DstColor=8]="DstColor",e[e.OneMinusDstColor=9]="OneMinusDstColor",e[e.SrcAlphaSaturate=10]="SrcAlphaSaturate"}(e.BlendingSrcFactor||(e.BlendingSrcFactor={})),function(e){e[e.Add=-1]="Add",e[e.Subtract=1]="Subtract",e[e.ReverseSubtract=2]="ReverseSubtract"}(e.BlendingEquations||(e.BlendingEquations={})),function(e){e[e.NEVER=-1]="NEVER",e[e.LESS=1]="LESS",e[e.EQUAL=2]="EQUAL",e[e.LESS_OR_EQUAL=3]="LESS_OR_EQUAL",e[e.GREATER=4]="GREATER",e[e.NOTEQUAL=5]="NOTEQUAL",e[e.GREATER_OR_EQUAL=6]="GREATER_OR_EQUAL",e[e.ALWAYS=7]="ALWAYS"}(e.DepthFunctions||(e.DepthFunctions={})),function(e){e[e.NONE=-1]="NONE",e[e.CW=1]="CW",e[e.CCW=2]="CCW",e[e.BOTH=3]="BOTH"}(e.CullSide||(e.CullSide={}))}(e.Material||(e.Material={})),function(e){!function(e){e[e.LINE_LOOP=0]="LINE_LOOP",e[e.LINE_STRIP=1]="LINE_STRIP",e[e.LINES=2]="LINES",e[e.POINTS=3]="POINTS",e[e.TRIANGLE_FAN=4]="TRIANGLE_FAN",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLES=6]="TRIANGLES"}(e.DrawMode||(e.DrawMode={}))}(e.Model||(e.Model={})),function(e){!function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.CUBE_MAP=1]="CUBE_MAP"}(e.TextureBindingTarget||(e.TextureBindingTarget={})),function(e){e[e.REPEAT=-1]="REPEAT",e[e.CLAMP_TO_EDGE=1]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"}(e.Wrapping||(e.Wrapping={})),function(e){e[e.Nearest=-1]="Nearest",e[e.NearestMipMapNearest=1]="NearestMipMapNearest",e[e.NearestMipMapLinear=2]="NearestMipMapLinear",e[e.Linear=3]="Linear",e[e.LinearMipMapNearest=4]="LinearMipMapNearest",e[e.LinearMipMapLinear=5]="LinearMipMapLinear"}(e.TextureMinFilter||(e.TextureMinFilter={})),function(e){e[e.Nearest=-1]="Nearest",e[e.Linear=1]="Linear"}(e.TextureMagFilter||(e.TextureMagFilter={})),function(e){e[e.UnsignedByte=-1]="UnsignedByte",e[e.UnsignedShort_5_6_5=1]="UnsignedShort_5_6_5",e[e.UnsignedShort_4_4_4_4=2]="UnsignedShort_4_4_4_4",e[e.UnsignedShort_5_5_5_1=3]="UnsignedShort_5_5_5_1",e[e.UnsignedShort=4]="UnsignedShort",e[e.UnsignedInt=5]="UnsignedInt",e[e.UnsignedInt_24_8=6]="UnsignedInt_24_8",e[e.Byte=7]="Byte",e[e.Short=8]="Short",e[e.Int=9]="Int",e[e.Float=10]="Float",e[e.HalfFloat=11]="HalfFloat",e[e.UnsignedInt_2_10_10_10_REV=12]="UnsignedInt_2_10_10_10_REV",e[e.UnsignedInt_10F_11F_11F_REV=13]="UnsignedInt_10F_11F_11F_REV",e[e.UnsignedInt_5_9_9_9_REV=14]="UnsignedInt_5_9_9_9_REV",e[e.Float32UnsignedInt_24_8_REV=15]="Float32UnsignedInt_24_8_REV"}(e.SourcePixelFormat||(e.SourcePixelFormat={})),function(e){e[e.Alpha=-1]="Alpha",e[e.DepthComponent=1]="DepthComponent",e[e.DepthStencil=2]="DepthStencil",e[e.Luminance=3]="Luminance",e[e.LuminanceAlpha=4]="LuminanceAlpha",e[e.RGB=5]="RGB",e[e.RGBA=6]="RGBA",e[e.RGBE=7]="RGBE",e[e.R8=8]="R8",e[e.R16F=9]="R16F",e[e.R32F=10]="R32F",e[e.R8UI=11]="R8UI",e[e.RG8=12]="RG8",e[e.RG16F=13]="RG16F",e[e.RG32F=14]="RG32F",e[e.RG8UI=15]="RG8UI",e[e.RG16UI=16]="RG16UI",e[e.RG32UI=17]="RG32UI",e[e.RGB8=18]="RGB8",e[e.SRGB8=19]="SRGB8",e[e.RGB565=20]="RGB565",e[e.R11F_G11F_B10F=21]="R11F_G11F_B10F",e[e.RGB9_E5=22]="RGB9_E5",e[e.RGB16F=23]="RGB16F",e[e.RGB32F=24]="RGB32F",e[e.RGB8UI=25]="RGB8UI",e[e.RGBA8=26]="RGBA8",e[e.SRGB8_ALPHA8=27]="SRGB8_ALPHA8",e[e.RGB5_A1=28]="RGB5_A1",e[e.RGB10_A2=29]="RGB10_A2",e[e.RGBA4=30]="RGBA4",e[e.RGBA16F=31]="RGBA16F",e[e.RGBA32F=32]="RGBA32F",e[e.RGBA8UI=33]="RGBA8UI",e[e.DEPTH_COMPONENT16=34]="DEPTH_COMPONENT16",e[e.DEPTH_COMPONENT24=35]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36]="DEPTH_COMPONENT32F",e[e.RGBA32UI=37]="RGBA32UI",e[e.RGB32UI=38]="RGB32UI",e[e.RGBA16UI=39]="RGBA16UI",e[e.RGB16UI=40]="RGB16UI",e[e.RGBA32I=41]="RGBA32I",e[e.RGB32I=42]="RGB32I",e[e.RGBA16I=43]="RGBA16I",e[e.RGB16I=44]="RGB16I",e[e.RGBA8I=45]="RGBA8I",e[e.RGB8I=46]="RGB8I",e[e.RED_INTEGER=47]="RED_INTEGER",e[e.RG_INTEGER=48]="RG_INTEGER",e[e.RGB_INTEGER=49]="RGB_INTEGER",e[e.RGBA_INTEGER=50]="RGBA_INTEGER"}(e.TexelDataType||(e.TexelDataType={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.FOUR=4]="FOUR",e[e.EIGHT=8]="EIGHT"}(e.PackAlignment||(e.PackAlignment={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.FOUR=4]="FOUR",e[e.EIGHT=8]="EIGHT"}(e.UnpackAlignment||(e.UnpackAlignment={}))}(e.Texture||(e.Texture={})),function(e){!function(e){e[e.ALPHA=0]="ALPHA",e[e.RGB=1]="RGB",e[e.RGBA=2]="RGBA"}(e.ReadFilter||(e.ReadFilter={})),function(e){e[e.UNSIGNED_BYTE=0]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT_5_6_5=1]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=2]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=3]="UNSIGNED_SHORT_5_5_5_1",e[e.FLOAT=4]="FLOAT"}(e.ReadTargetArrayFormat||(e.ReadTargetArrayFormat={}))}(e.Renderer||(e.Renderer={}))}(t.GLSettings||(t.GLSettings={}))},function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.Instance=void 0;var i=r(75),o=r(20),a=0,s=function(){function e(t){Object.defineProperty(this,"_active",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"changes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"easingId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"easing",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observableStorage",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_uid",{enumerable:!0,configurable:!0,writable:!0,value:e.newUID}),Object.defineProperty(this,"reactivate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),(0,o.makeObservable)(this,e),t&&(this.active=t.active||this.active)}return Object.defineProperty(e,"newUID",{get:function(){return a=++a%16777215},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"active",{get:function(){return this._active},set:function(e){this._active=e,this.reactivate=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"observableDisposer",{get:function(){var e=this;return function(){return e._observer=null}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"observer",{get:function(){return this._observer||null},set:function(e){var t=this._observer;t&&t!==e&&(this.easing&&this.easing.clear(),t.remove(this)),this._observer=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"getEasing",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this.easingId){var t=this.easingId["_".concat(e,"_end")];if(t&&this.easing){var r=this.easing.get(t);if(r instanceof i.EasingProps)return r}}}}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resourceTrigger",{enumerable:!1,configurable:!0,writable:!0,value:function(){console.warn("resourceTrigger called on an instance that did not override resourceTrigger. resourceTrigger MUST be overridden for instances","that utilize a resource. The observable that is tied to committing the resource should be 'triggered' in this method.")}}),n([o.observable],e.prototype,"_active",void 0),n([o.observable],e.prototype,"_uid",void 0),e}();t.Instance=s},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.VectorMath=t.RayMath=t.QuaternionMath=t.MatrixMath=void 0,o(r(52),t),o(r(47),t),o(r(36),t),o(r(77),t),o(r(2),t),o(r(46),t),o(r(78),t);var s=a(r(36)),u=a(r(77)),c=a(r(78)),l=a(r(2));t.MatrixMath=s,t.QuaternionMath=u,t.RayMath=c,t.VectorMath=l},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(94),t),i(r(60),t),i(r(37),t),i(r(166),t),i(r(27),t),i(r(85),t),i(r(181),t),i(r(58),t),i(r(182),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLStat=t.getProgramInfo=void 0,t.getProgramInfo=function(e,t){for(var r={attributeCount:0,attributes:new Array,uniformCount:0,uniforms:new Array},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o={35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT"},a={35664:1,35665:1,35666:1,35667:1,35668:1,35669:1,35670:1,35671:1,35672:1,35673:1,35674:1,35675:3,35676:4,35678:1,35680:1,5120:1,5121:1,5122:1,5123:1,5124:1,5125:1,5126:1},s=0;s<n;++s){var u=e.getActiveUniform(t,s);u.typeName=o[u.type],r.uniforms.push(u),r.uniformCount+=u.size,u.size=u.size*a[u.type]}for(s=0;s<i;s++){var c=e.getActiveAttrib(t,s);c.typeName=o[c.type],r.attributes.push(c),r.attributeCount+=c.size}return r};var n=function(){function e(){}return Object.defineProperty(e,"print",{enumerable:!1,configurable:!0,writable:!0,value:function(){return Object.assign({},e)}}),Object.defineProperty(e,"VAO",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"DEPTH_TEXTURE",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"MAX_VERTEX_UNIFORMS",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(e,"MAX_FRAGMENT_UNIFORMS",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(e,"MAX_VERTEX_ATTRIBUTES",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(e,"WEBGL_SUPPORTED",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"MAX_TEXTURE_SIZE",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(e,"HARDWARE_INSTANCING",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"MRT_EXTENSION",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"MRT",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"MAX_COLOR_ATTACHMENTS",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(e,"SHADERS_3_0",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"WEBGL_VERSION",{enumerable:!0,configurable:!0,writable:!0,value:"none"}),Object.defineProperty(e,"FLOAT_TEXTURE_READ",{enumerable:!0,configurable:!0,writable:!0,value:{half:!1,full:!1,halfLinearFilter:!1,fullLinearFilter:!1}}),Object.defineProperty(e,"FLOAT_TEXTURE_WRITE",{enumerable:!0,configurable:!0,writable:!0,value:{half:!1,full:!1}}),e}();t.WebGLStat=n,function(){var e=function(){try{var e=document.createElement("canvas"),t=void 0;return(t=e.getContext("webgl2"))?(n.WEBGL_VERSION="webgl2",t):(t=e.getContext("webgl"))?(n.WEBGL_VERSION="webgl",t):(t=e.getContext("experimental-webgl"))?(n.WEBGL_VERSION="experimental-webgl",t):null}catch(e){return null}}();if(e)if(n.WEBGL_SUPPORTED=!0,n.MAX_VERTEX_UNIFORMS=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),n.MAX_FRAGMENT_UNIFORMS=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),n.MAX_VERTEX_ATTRIBUTES=e.getParameter(e.MAX_VERTEX_ATTRIBS),n.MAX_TEXTURE_SIZE=e.getParameter(e.MAX_TEXTURE_SIZE),function(e){n.FLOAT_TEXTURE_READ.fullLinearFilter=Boolean(e.getExtension("OES_texture_float_linear")),n.FLOAT_TEXTURE_READ.halfLinearFilter=Boolean(e.getExtension("OES_texture_half_float_linear"));var t=e.createTexture();if(e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.getError()!==e.NO_ERROR)throw new Error("WebGLStat could not create a texture");var r=e.getExtension("OES_texture_float")||e.getExtension("EXT_color_buffer_float");if(e.getExtension("WEBGL_color_buffer_float"),r){var i=2,o=2;e.texImage2D(e.TEXTURE_2D,0,e instanceof WebGL2RenderingContext?e.RGBA32F:e.RGBA,i,o,0,e.RGBA,e.FLOAT,null),e.getError()===e.NO_ERROR&&(n.FLOAT_TEXTURE_READ.full=!0);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),e.bindTexture(e.TEXTURE_2D,null),e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&(n.FLOAT_TEXTURE_WRITE.full=!0),e.deleteFramebuffer(a),e.deleteTexture(t)}var s=e.createTexture();if(e.bindTexture(e.TEXTURE_2D,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.getError()!==e.NO_ERROR)throw new Error("WebGLStat could not create a texture");var u=e.getExtension("OES_texture_half_float")||e.getExtension("EXT_color_buffer_float");if(u){i=2,o=2;e.texImage2D(e.TEXTURE_2D,0,e instanceof WebGL2RenderingContext?e.RGBA16F:e.RGBA,i,o,0,e.RGBA,e instanceof WebGL2RenderingContext?e.HALF_FLOAT:u.HALF_FLOAT_OES,null),e.getError()===e.NO_ERROR&&(n.FLOAT_TEXTURE_READ.full=!0);a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0),e.bindTexture(e.TEXTURE_2D,null),e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&(n.FLOAT_TEXTURE_WRITE.full=!0),e.deleteFramebuffer(a),e.deleteTexture(s)}}(e),e instanceof WebGL2RenderingContext)n.VAO=!0,n.MRT=!0,n.HARDWARE_INSTANCING=!0,n.SHADERS_3_0=!0,n.HARDWARE_INSTANCING=!0,n.DEPTH_TEXTURE=!0,n.MAX_COLOR_ATTACHMENTS=e.getParameter(e.MAX_COLOR_ATTACHMENTS);else{n.VAO=Boolean(e.getExtension("OES_vertex_array_object")),n.HARDWARE_INSTANCING=Boolean(e.getExtension("ANGLE_instanced_arrays"));var t=e.getExtension("WEBGL_draw_buffers");n.MRT_EXTENSION=Boolean(t),n.MRT=Boolean(t),n.DEPTH_TEXTURE=Boolean(e.getExtension("WEBGL_depth_texture")),t&&(n.MAX_COLOR_ATTACHMENTS=e.getParameter(t.MAX_COLOR_ATTACHMENTS_WEBGL))}window.WebGLStat=n}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Texture=void 0;var n=r(8),i=r(10),o=function(){function e(e){Object.defineProperty(this,"_uid",{enumerable:!0,configurable:!0,writable:!0,value:(0,n.uid)()}),Object.defineProperty(this,"_destroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_anisotropy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_flipY",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_format",{enumerable:!0,configurable:!0,writable:!0,value:i.GLSettings.Texture.TexelDataType.RGBA}),Object.defineProperty(this,"_generateMipmaps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"gl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_internalFormat",{enumerable:!0,configurable:!0,writable:!0,value:i.GLSettings.Texture.TexelDataType.RGBA}),Object.defineProperty(this,"_magFilter",{enumerable:!0,configurable:!0,writable:!0,value:i.GLSettings.Texture.TextureMagFilter.Linear}),Object.defineProperty(this,"_minFilter",{enumerable:!0,configurable:!0,writable:!0,value:i.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear}),Object.defineProperty(this,"needsDataUpload",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"needsPartialDataUpload",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"needsSettingsUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_packAlignment",{enumerable:!0,configurable:!0,writable:!0,value:i.GLSettings.Texture.PackAlignment.FOUR}),Object.defineProperty(this,"_premultiplyAlpha",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_type",{enumerable:!0,configurable:!0,writable:!0,value:i.GLSettings.Texture.SourcePixelFormat.UnsignedByte}),Object.defineProperty(this,"_unpackAlignment",{enumerable:!0,configurable:!0,writable:!0,value:i.GLSettings.Texture.UnpackAlignment.FOUR}),Object.defineProperty(this,"_updateRegions",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_wrapHorizontal",{enumerable:!0,configurable:!0,writable:!0,value:i.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE}),Object.defineProperty(this,"_wrapVertical",{enumerable:!0,configurable:!0,writable:!0,value:i.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE}),this.anisotropy=e.anisotropy||this.anisotropy,this.data=e.data||this.data,this.flipY=e.flipY||this.flipY,this.format=e.format||this.format,this.internalFormat=e.internalFormat||this.format,this.generateMipMaps=e.generateMipMaps||this.generateMipMaps,this.magFilter=e.magFilter||this.magFilter,this.minFilter=e.minFilter||this.minFilter,this.packAlignment=e.packAlignment||this.packAlignment,this.premultiplyAlpha=e.premultiplyAlpha||this.premultiplyAlpha,this.type=e.type||this.type,this.unpackAlignment=e.unpackAlignment||this.unpackAlignment,this.wrapHorizontal=e.wrapHorizontal||this.wrapHorizontal,this.wrapVertical=e.wrapVertical||this.wrapVertical}return Object.defineProperty(e,"emptyTexture",{get:function(){return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anisotropy",{get:function(){return this._anisotropy},set:function(e){this.needsSettingsUpdate=!0,this._anisotropy=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this.needsDataUpload=!0,this._data=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"flipY",{get:function(){return this._flipY},set:function(e){this.needsDataUpload=!0,this._flipY=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"format",{get:function(){return this._format},set:function(e){this.needsDataUpload=!0,this._format=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"generateMipMaps",{get:function(){return this._generateMipmaps},set:function(e){this.needsSettingsUpdate=!0,this._generateMipmaps=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"internalFormat",{get:function(){return this._internalFormat},set:function(e){this.needsDataUpload=!0,this._internalFormat=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"magFilter",{get:function(){return this._magFilter},set:function(e){this.needsSettingsUpdate=!0,this._magFilter=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minFilter",{get:function(){return this._minFilter},set:function(e){this.needsSettingsUpdate=!0,this._minFilter=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"packAlignment",{get:function(){return this._packAlignment},set:function(e){this.needsSettingsUpdate=!0,this._packAlignment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"premultiplyAlpha",{get:function(){return this._premultiplyAlpha},set:function(e){this.needsSettingsUpdate=!0,this._premultiplyAlpha=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){this.needsDataUpload=!0,this._type=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unpackAlignment",{get:function(){return this._unpackAlignment},set:function(e){this.needsSettingsUpdate=!0,this._unpackAlignment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateRegions",{get:function(){return this._updateRegions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapHorizontal",{get:function(){return this._wrapHorizontal},set:function(e){this.needsSettingsUpdate=!0,this._wrapHorizontal=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapVertical",{get:function(){return this._wrapVertical},set:function(e){this.needsSettingsUpdate=!0,this._wrapVertical=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHalfFloatTexture",{get:function(){switch(this._internalFormat){case i.GLSettings.Texture.TexelDataType.R16F:case i.GLSettings.Texture.TexelDataType.RG16F:case i.GLSettings.Texture.TexelDataType.RGB16F:return!0}switch(this._type){case i.GLSettings.Texture.SourcePixelFormat.HalfFloat:return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isFloatTexture",{get:function(){switch(this._internalFormat){case i.GLSettings.Texture.TexelDataType.R11F_G11F_B10F:case i.GLSettings.Texture.TexelDataType.R16F:case i.GLSettings.Texture.TexelDataType.RG16F:case i.GLSettings.Texture.TexelDataType.R32F:case i.GLSettings.Texture.TexelDataType.RG32F:case i.GLSettings.Texture.TexelDataType.RGB16F:case i.GLSettings.Texture.TexelDataType.RGB32F:return!0}switch(this._type){case i.GLSettings.Texture.SourcePixelFormat.Float:case i.GLSettings.Texture.SourcePixelFormat.HalfFloat:return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.gl&&this.gl.proxy.disposeTexture(this),this._destroyed=!0,delete this._data}}),Object.defineProperty(e.prototype,"resolve",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.needsDataUpload=!1,this.needsPartialDataUpload=!1,this.needsSettingsUpdate=!1,this._updateRegions=[]}}),Object.defineProperty(e.prototype,"update",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this.needsPartialDataUpload=!0,this._updateRegions.push([e,t])}}),e}();t.Texture=o;var a=new o({data:{width:2,height:2,buffer:new Uint8Array(16)}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Camera=t.isPerspective=t.isOrthographic=t.CameraProjectionType=void 0;var n,i=r(51),o=r(36),a=r(2),s=r(79),u=r(8);function c(e){return e.projectionOptions.type===n.ORTHOGRAPHIC&&"left"in e.projectionOptions}function l(e){return e.projectionOptions.type===n.PERSPECTIVE&&"fov"in e.projectionOptions}!function(e){e[e.PERSPECTIVE=0]="PERSPECTIVE",e[e.ORTHOGRAPHIC=1]="ORTHOGRAPHIC"}(n=t.CameraProjectionType||(t.CameraProjectionType={})),t.isOrthographic=c,t.isPerspective=l;var f=function(){function e(e){Object.defineProperty(this,"_id",{enumerable:!0,configurable:!0,writable:!0,value:(0,u.uid)()}),Object.defineProperty(this,"animationEndTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"needsViewDrawn",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"needsBroadcast",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"viewChangeViewId",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"transform",{enumerable:!0,configurable:!0,writable:!0,value:new i.Transform}),Object.defineProperty(this,"_projection",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.identity4)()}),Object.defineProperty(this,"_needsUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_projectionOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_viewProjection",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.identity4)()}),this._projectionOptions=e,this._needsUpdate=!0,this.onChange=e.onViewChange,this.update()}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"broadcast",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.onChange&&this.onChange(this,e)}}),Object.defineProperty(e,"makeOrthographic",{enumerable:!1,configurable:!0,writable:!0,value:function(t){return new e(Object.assign({left:-100,right:100,top:-100,bottom:100,near:-100,far:1e5,type:n.ORTHOGRAPHIC},t))}}),Object.defineProperty(e,"makePerspective",{enumerable:!1,configurable:!0,writable:!0,value:function(t){return new e(Object.assign({type:n.PERSPECTIVE,far:1e4,near:1,fov:90*Math.PI/180,height:1e3,width:1e3},t))}}),Object.defineProperty(e.prototype,"projectionType",{get:function(){return this._projectionOptions.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"projection",{get:function(){return this.update(!0),this._projection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this.transform.viewMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needsUpdate",{get:function(){return this._needsUpdate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(e){this._needsUpdate=this._needsUpdate||!(0,a.compare3)(e,this.transform.position),this.transform.position=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lookAt",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=(0,o.copy4x4)(this.transform.matrix);this.transform.lookAtLocal(e,t||[0,1,0]),this._needsUpdate=this._needsUpdate||!(0,o.compare4x4)(r,this.transform.matrix)}}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(e){this._needsUpdate=this._needsUpdate||!(0,a.compare3)(e,this.transform.scale),this.transform.scale=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"projectionOptions",{get:function(){return this._projectionOptions},set:function(e){this._needsUpdate=this._needsUpdate||!(0,s.shallowCompare)(e,this._projectionOptions),this._projectionOptions=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewProjection",{get:function(){return this.update(!0),this._viewProjection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"setOrthographic",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._projectionOptions=Object.assign({left:-100,right:100,top:-100,bottom:100,near:-100,far:1e5,type:n.ORTHOGRAPHIC},e)}}),Object.defineProperty(e.prototype,"setPerspective",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._projectionOptions=Object.assign({type:n.PERSPECTIVE,far:1e4,near:1,fov:90*Math.PI/180,height:1e3,width:1e3},e)}}),Object.defineProperty(e.prototype,"resolve",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._needsUpdate=!1,this.needsViewDrawn=!1,this.needsBroadcast=!1}}),Object.defineProperty(e.prototype,"update",{enumerable:!1,configurable:!0,writable:!0,value:function(e){(this._needsUpdate||e)&&(this.updateProjection(),this._needsUpdate=!1,this.needsViewDrawn=!0)}}),Object.defineProperty(e.prototype,"updateProjection",{enumerable:!1,configurable:!0,writable:!0,value:function(){c(this)?(0,o.orthographic4x4)(this.projectionOptions.left,this.projectionOptions.right,this.projectionOptions.bottom,this.projectionOptions.top,this.projectionOptions.near,this.projectionOptions.far,this._projection):l(this)&&(0,o.perspective4x4)(this.projectionOptions.fov,this.projectionOptions.width,this.projectionOptions.height,this.projectionOptions.near,this.projectionOptions.far,this._projection),(0,o.multiply4x4)(this._projection,this.transform.viewMatrix,this._viewProjection)}}),e}();t.Camera=f},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.IdentifiableData=t.IdentifyByKey=void 0;var o=function(){function e(e){Object.defineProperty(this,"_key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._key=e.key}return Object.defineProperty(e.prototype,"id",{get:function(){return this._key},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),e}();t.IdentifyByKey=o;var a=function(e){function t(t){var r=e.call(this,t)||this;return Object.defineProperty(r,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),r.data=t.data,r}return i(t,e),t}(o);t.IdentifiableData=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLayer=void 0,t.createLayer=function(e,t){return{get key(){return t.key||""},init:[e,Object.assign(t,{key:t.key||e.defaultProps.key,data:t.data||e.defaultProps.data})]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScaleMode=t.AnchorType=void 0,function(e){e[e.BottomLeft=0]="BottomLeft",e[e.BottomMiddle=1]="BottomMiddle",e[e.BottomRight=2]="BottomRight",e[e.Custom=3]="Custom",e[e.Middle=4]="Middle",e[e.MiddleLeft=5]="MiddleLeft",e[e.MiddleRight=6]="MiddleRight",e[e.TopLeft=7]="TopLeft",e[e.TopMiddle=8]="TopMiddle",e[e.TopRight=9]="TopRight"}(t.AnchorType||(t.AnchorType={})),function(e){e[e.ALWAYS=1]="ALWAYS",e[e.BOUND_MAX=2]="BOUND_MAX",e[e.NEVER=3]="NEVER"}(t.ScaleMode||(t.ScaleMode={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeObservable=t.observable=t.ObservableMonitoring=void 0;var n=function(){function e(){}return Object.defineProperty(e,"setObservableMonitor",{enumerable:!1,configurable:!0,writable:!0,value:function(t){e.gatherIds=t,e.observableIds=[]}}),Object.defineProperty(e,"getObservableMonitorIds",{enumerable:!1,configurable:!0,writable:!0,value:function(t){var r=e.observableIds.slice(0);return t&&(e.observableIds=[]),r}}),Object.defineProperty(e,"setCycle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"gatherIds",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(e,"observableIds",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(e,"observableNamesToUID",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),e}();t.ObservableMonitoring=n;var i=n,o=new Map,a=1,s={}.constructor;t.observable=function(e,t,r){r||(r={configurable:!0,enumerable:!0});var n=o.get(e.constructor),u=i.observableNamesToUID.get(t)||0;0===u&&(u=++a,i.observableNamesToUID.set(t,u)),n||(n=new Set,o.set(e.constructor,n)),n.add(t);for(var c=Object.getPrototypeOf(e),l=0;c.constructor!==s&&++l<100;){var f=o.get(c.constructor);f&&f.forEach((function(e){return null==n?void 0:n.add(e)})),c=Object.getPrototypeOf(c)}l>=100&&console.warn("@observable decorator encountered a type that has 100+ levels of inheritance. This is most likely an error, and may be a result of a circular dependency and will not be supported by this decorator."),r.enumerable=!0,Object.defineProperty(e,t,r)},t.makeObservable=function(e,t){if(e.constructor===t){var r=o.get(t);r&&r.forEach((function(t){return function(e,t){var r=i.observableNamesToUID.get(t)||0;if(0!==r){var n=e[t];Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return i.gatherIds&&(i.setCycle||i.observableIds.push(r)),e.observableStorage[r]},set:function(t){i.gatherIds&&(i.setCycle=!0),e.observableStorage[r]=t,e.changes[r]=r,e.observer&&e.observer.instanceUpdated(e),i.gatherIds&&(i.setCycle=!1)}}),e[t]=n}else console.warn("A property with name",t,"for",e,"has not been assigned a UID which is an error in this step of the process.")}(e,t)}))}}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.INVALID_RESOURCE_MANAGER=t.InvalidResourceManager=t.BaseResourceManager=void 0;var s=function(){function e(){Object.defineProperty(this,"router",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_webGLRenderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"webGLRenderer",{get:function(){return this._webGLRenderer},set:function(e){this._webGLRenderer=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"getIOExpansion",{enumerable:!1,configurable:!0,writable:!0,value:function(){return[]}}),Object.defineProperty(e.prototype,"resize",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Object.defineProperty(e.prototype,"setAttributeContext",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),e}();t.BaseResourceManager=s;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"resources",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),t}return i(t,e),Object.defineProperty(t.prototype,"dequeueRequests",{enumerable:!1,configurable:!0,writable:!0,value:function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2,!1]}))}))}}),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Object.defineProperty(t.prototype,"destroyResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.resources.delete(e.key)}}),Object.defineProperty(t.prototype,"getResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.resources.get(e)||{key:"",type:-1}}}),Object.defineProperty(t.prototype,"initResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){return this.resources.set(e.key,e),[2]}))}))}}),Object.defineProperty(t.prototype,"request",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return[0,0,0,0]}}),Object.defineProperty(t.prototype,"updateResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),t}(s);t.InvalidResourceManager=u,t.INVALID_RESOURCE_MANAGER=new u},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(164),i(r(19),t),i(r(114),t),i(r(187),t)},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.REQUEST=t.RESOURCE=void 0;var o=r(48),a=r(99),s=r(107);i(r(21),t),i(r(176),t),i(r(99),t),i(r(107),t),t.RESOURCE={createFont:a.createFont,createAtlas:s.createAtlas,createTexture:s.createTexture,createColorBuffer:o.createColorBuffer},t.REQUEST={textureRequest:s.textureRequest,atlasRequest:s.atlasRequest,fontRequest:a.fontRequest,colorBufferRequest:o.colorBufferRequest}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubTexture=t.subTextureIOValue=void 0;var n=r(7),i=r(3);t.subTextureIOValue=function(e){return e?[e.atlasTL[0],e.atlasTL[1],e.atlasBR[0],e.atlasBR[1]]:[0,0,0,0]};var o=function(){function e(e){Object.defineProperty(this,"_uid",{enumerable:!0,configurable:!0,writable:!0,value:(0,i.uid)()}),Object.defineProperty(this,"aspectRatio",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"atlasTL",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(this,"atlasTR",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(this,"atlasBL",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(this,"atlasBR",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(this,"heightOnAtlas",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isValid",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"pixelWidth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"pixelHeight",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"atlasRegion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"texture",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"video",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"widthOnAtlas",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.assign(this,e)}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!1,configurable:!0}),Object.defineProperty(e,"fromRegion",{enumerable:!1,configurable:!0,writable:!0,value:function(t,r){if(!t.data)return null;var i=r.x/t.data.width,o=r.y/t.data.height,a=r.width/t.data.width,s=r.height/t.data.height,u=new n.Bounds({bottom:o+s,left:i,right:i+a,top:o}),c=u.bottom,l=u.y,f=u.x,d=u.x+u.width,p=new e;return p.atlasTL=[f,l],p.atlasBR=[d,c],p.atlasBL=[f,c],p.atlasTR=[d,l],p}}),Object.defineProperty(e.prototype,"update",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.texture&&this.source&&this.atlasRegion&&this.texture.update(this.source,this.atlasRegion)}}),Object.defineProperty(e.prototype,"toString",{enumerable:!1,configurable:!0,writable:!0,value:function(){return JSON.stringify({atlas:{TL:this.atlasTL,TR:this.atlasTR,BL:this.atlasBL,BR:this.atlasBR},width:this.pixelWidth,height:this.pixelHeight},null,2)}}),e}();t.SubTexture=o},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.postProcess=void 0;var i=r(22),o=r(27),a=r(0),s=r(18),u=r(302);t.postProcess=function(e){return e.uniforms&&e.uniforms.forEach((function(e){e.shaderInjection=a.ShaderInjectionTarget.FRAGMENT})),{views:{screen:(0,o.createView)(i.View2D,n({camera:new i.Camera2D,viewport:{left:0,top:0,width:"100%",height:"100%"}},e.view))},layers:{screen:(0,s.createLayer)(u.PostProcessLayer,{printShader:e.printShader,baseShaderModules:function(){return{fs:[],vs:[]}},buffers:e.buffers,fs:e.shader,uniforms:e.uniforms,materialOptions:e.material})}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UseMaterialStatus=t.isOffscreenCanvas=t.isUniformFloat=t.isUniformTexture=t.isUniformMat4=t.isUniformMat3=t.isUniformVec4Array=t.isUniformVec4=t.isUniformVec3=t.isUniformVec2=t.MaterialUniformType=void 0;var n,i=r(0);!function(e){e[e.FLOAT=0]="FLOAT",e[e.VEC2=1]="VEC2",e[e.VEC3=2]="VEC3",e[e.VEC4=3]="VEC4",e[e.VEC4_ARRAY=4]="VEC4_ARRAY",e[e.FLOAT_ARRAY=5]="FLOAT_ARRAY",e[e.MATRIX3x3=6]="MATRIX3x3",e[e.MATRIX4x4=7]="MATRIX4x4",e[e.TEXTURE=8]="TEXTURE"}(n=t.MaterialUniformType||(t.MaterialUniformType={})),t.isUniformVec2=function(e){return e.type===n.VEC2},t.isUniformVec3=function(e){return e.type===n.VEC3},t.isUniformVec4=function(e){return e.type===n.VEC4},t.isUniformVec4Array=function(e){return e.type===n.VEC4_ARRAY},t.isUniformMat3=function(e){return e.type===n.MATRIX3x3},t.isUniformMat4=function(e){return e.type===n.MATRIX4x4},t.isUniformTexture=function(e){return e.type===n.TEXTURE},t.isUniformFloat=function(e){return e.type===n.FLOAT};var o=window.OffscreenCanvas||i.NOOP;t.isOffscreenCanvas=function(e){return e instanceof o},function(e){e[e.INVALID=0]="INVALID",e[e.VALID=1]="VALID",e[e.NO_RENDER_TARGET_MATCHES=2]="NO_RENDER_TARGET_MATCHES"}(t.UseMaterialStatus||(t.UseMaterialStatus={}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.NoView=t.View=t.createView=t.ClearFlags=void 0;var o=r(4),a=r(1),s=r(47),u=r(7),c=r(48),l=r(49),f=r(50),d=r(0),p=r(16),h=r(17),b=r(37),g=r(60);!function(e){e[e.COLOR=1]="COLOR",e[e.DEPTH=2]="DEPTH",e[e.STENCIL=4]="STENCIL"}(t.ClearFlags||(t.ClearFlags={})),t.createView=function(e,t){return{get key(){return t.key||""},init:[e,Object.assign(t,{key:t.key||"",viewport:t.viewport||{left:0,right:0,top:0,bottom:0}})]}};var v=function(e){function t(r,n){var i=e.call(this,n)||this;return Object.defineProperty(i,"animationEndTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(i,"depth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(i,"lastFrameTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(i,"needsDraw",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(i,"optimizeRendering",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(i,"_pixelRatio",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(i,"projection",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(i,"props",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(i,"resource",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(i,"renderTarget",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(i,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),i.scene=r,i.props=Object.assign({},t.defaultProps||{},n),i}return i(t,e),Object.defineProperty(t.prototype,"pixelRatio",{get:function(){var e;return null!==(e=this.props.pixelRatio)&&void 0!==e?e:this._pixelRatio},set:function(e){this._pixelRatio=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screenBounds",{get:function(){return this.projection.screenBounds},set:function(e){this.projection.screenBounds=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewBounds",{get:function(){return this.projection.viewBounds},set:function(e){this.projection.viewBounds=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clearFlags",{get:function(){return this.props.clearFlags||[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"order",{get:function(){return this.props.order||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"getOutputTargets",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.props.output,t=[];return e?((0,l.isRenderTextureResource)(e.buffers)||(0,c.isColorBufferResource)(e.buffers)?t=[{outputType:d.FragmentOutputType.COLOR,resource:e.buffers}]:Object.keys(e.buffers).forEach((function(r){var n=Number.parseFloat(r),i=e.buffers[n];i&&t.push({outputType:n,resource:i})})),t):null}}),Object.defineProperty(t.prototype,"getRenderTargets",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.renderTarget?[this.renderTarget]:[]}}),Object.defineProperty(t.prototype,"createRenderTarget",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.renderTarget&&(Array.isArray(this.renderTarget)?this.renderTarget.forEach((function(e){return e.dispose()})):this.renderTarget.dispose());var e=this.props.output,t=this.scene.surface;if(e&&t){for(var r=new Set,n=0,i=this.scene.layers.length;n<i;++n){var s=this.scene.layers[n].shaderIOInfo.fs.get(this);s&&s.outputTypes.forEach((function(e){return r.add(e)}))}var u,d,p,h=new Map,g=new b.Layer(t,this.scene,{key:"",data:new a.InstanceProvider}),v=new a.Instance({}),y=this.getOutputTargets()||[];for(n=0,i=y.length;n<i;++n){var m=y[n],w=m.resource;if(r.has(m.outputType))if((0,l.isRenderTextureResource)(w)){var O=(0,f.textureRequest)({key:m.resource.key});if(this.resource.request(g,v,O),!O.texture)throw console.warn("A view has a RenderTexture output target with key:",m.resource.key,"however, no RenderTexture was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createTexture()"),new Error("Output target unable to be constructed for view ".concat(this.id));h.set(m.outputType,O.texture)}else{O=(0,c.colorBufferRequest)({key:m.resource.key});if(this.resource.request(g,v,O),!O.colorBuffer)throw console.warn("A view has a ColorBuffer output target with key:",m.resource.key,"however, no ColorBuffer was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createColorBuffer()"),new Error("Output target unable to be constructed for view ".concat(this.id));h.set(m.outputType,O.colorBuffer)}}if(h.forEach((function(e){var t,r,n;if(e instanceof o.Texture){if(void 0!==u&&void 0!==d||(u=(null===(t=e.data)||void 0===t?void 0:t.width)||0,d=(null===(r=e.data)||void 0===r?void 0:r.height)||0),0===u||0===d)throw new Error("RenderTexture for View can NOT have a width or height of zero.");if((null===(n=e.data)||void 0===n?void 0:n.width)!==u||e.data.height!==d)throw new Error("When a view has multiple output targets: ALL RenderTextures and ColorBuffers that a view references MUST have the same dimensions")}else{if(void 0!==u&&void 0!==d||(u=e.size[0]||0,d=e.size[1]||0),0===u||0===d)throw new Error("RenderTexture for View can NOT have a width or height of zero.");if(e.size[0]!==u||e.size[1]!==d)throw new Error("When a view has multiple output targets: ALL RenderTextures and ColorBuffers that a view references MUST have the same dimensions")}})),e.depth)if((0,l.isRenderTextureResource)(e.depth)){O=(0,f.textureRequest)({key:e.depth.key});if(this.resource.request(g,v,O),!O.texture)throw console.warn("A view has a depth buffer output target with key:",e.depth,"however, no RenderTexture was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createTexture()"),new Error("Output target unable to be constructed for view ".concat(this.id));p=O.texture}else if((0,c.isColorBufferResource)(e.depth)){O=(0,c.colorBufferRequest)({key:e.depth.key});if(this.resource.request(g,v,O),!O.colorBuffer)throw console.warn("A view has a depth buffer output target with key:",e.depth.key,"however, no ColorBuffer was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createColorBuffer()"),new Error("Output target unable to be constructed for view ".concat(this.id));p=O.colorBuffer}else p=o.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT16;if(!o.WebGLStat.MRT)throw new Error("MRT for non-MRT systems not supported yet.");var _=[];h.forEach((function(e,t){return _.push({buffer:e,outputType:t})})),this.renderTarget=new o.RenderTarget({buffers:{color:_,depth:p},retainTextureTargets:!0})}}}),Object.defineProperty(t.prototype,"willUseView",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.getRenderTargets();this.props.screenScale&&(this.projection.screenScale=this.props.screenScale),e.some((function(e){return e.getBuffers().some((function(e){return!!e.buffer.destroyed}))}))&&this.createRenderTarget()}}),Object.defineProperty(t.prototype,"shouldDrawView",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){for(var r in t)if(t[r]!==e[r])return!0;return!1}}),Object.defineProperty(t.prototype,"willUpdateProps",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"didUpdateProps",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{key:"",camera:p.Camera.makeOrthographic(),viewport:{left:0,right:0,top:0,bottom:0}}}),t}(h.IdentifyByKey);t.View=v;var y=function(e){function t(){var t=e.call(this,new g.LayerScene(void 0,{key:"error",layers:[],views:[]}),{key:"error",viewport:{},camera:p.Camera.makeOrthographic()})||this;return Object.defineProperty(t,"projection",{enumerable:!0,configurable:!0,writable:!0,value:new s.SimpleProjection}),t.screenBounds=new u.Bounds({x:0,y:0,width:100,height:100}),t}return i(t,e),Object.defineProperty(t.prototype,"screenToWorld",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return[0,0]}}),Object.defineProperty(t.prototype,"worldToScreen",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return[0,0]}}),Object.defineProperty(t.prototype,"viewToWorld",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return[0,0]}}),Object.defineProperty(t.prototype,"worldToView",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return[0,0]}}),Object.defineProperty(t.prototype,"fitViewtoViewport",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this.screenBounds=e}}),t}(v);t.NoView=y},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stopAllFrameCommands=t.stopAnimationLoop=t.onAnimationLoop=t.onFrame=t.nextFrame=void 0;var n=r(29),i=-1,o=0,a=[],s=[],u=[],c=new Map,l=function e(t){o=t;var r=!1,n=[];c.forEach((function(e,i){r=!0;var o=e[0],a=e[1],s=e[2],u=e[3],c=e[4];if(-1!==u&&(-1===c&&(c=t,e[4]=t),t-c>=u))return n.push(i),void o(t,c+u);if(-1!==a){if(-1===s&&(e[2]=t,s=t),t-s>=a)for(o(t);t-s>=a;)e[2]+=a,s+=a}else o(t)}));for(var l=0,f=n.length;l<f;++l){var d=n[l];c.delete(d)}var p=s.slice();s=[];for(l=0,f=p.length;l<f;++l){var h=p[l],b=h[0],g=h[1],v=h[2];g<=0?b&&b(t):t-v>g?b(t):(r=!0,s.push(p[l]))}for(l=0,f=u.length;l<f;++l){(b=u[l])&&(r=!0,b(t))}u=a.slice(0),a=[],u.length>0&&(r=!0),i=r?requestAnimationFrame(e):-1};i=requestAnimationFrame(l),t.nextFrame=function(e){var t=new n.PromiseResolver;return a.push((function(r){e&&e(r),t.resolve(r)})),-1===i&&(i=requestAnimationFrame(l)),t.promise},t.onFrame=function(e,t){var r=new n.PromiseResolver;return s.push([function(t){e&&e(t),r.resolve(t)},t||-1,o]),-1===i&&(i=requestAnimationFrame(l)),r.promise},t.onAnimationLoop=function(e,t,r){var o=new n.PromiseResolver;return c.set(o.promise,[function(t,n){e(t),void 0!==r&&r>0?void 0!==n&&o.resolve(n):o.resolve(t)},t||-1,-1,r||-1,-1]),-1===i&&(i=requestAnimationFrame(l)),o.promise},t.stopAnimationLoop=function(e){c.delete(e),-1===i&&(i=requestAnimationFrame(l))},t.stopAllFrameCommands=function(){c.forEach((function(e){return e[0](o,o)})),c.clear(),s=[],a=[],u=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseResolver=void 0;var n=function(){function e(){var e=this;Object.defineProperty(this,"resolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rejector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"promise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.promise=new Promise((function(t,r){return e.resolver=t,e.rejector=r}))}return Object.defineProperty(e.prototype,"resolve",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.resolver(e)}}),Object.defineProperty(e.prototype,"reject",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.rejector(e)}}),e}();t.PromiseResolver=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BufferManagerBase=t.isBufferLocationGroup=t.isBufferLocation=void 0;var n=r(58);t.isBufferLocation=function(e){return e&&e.buffer&&e.buffer.value},t.isBufferLocationGroup=function(e){return e&&e.propertyToBufferLocation};var i=function(){function e(e,t){Object.defineProperty(this,"changeListContext",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"layer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"add",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"remove",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.layer=e,this.scene=t}return Object.defineProperty(e.prototype,"changesProcessed",{enumerable:!1,configurable:!0,writable:!0,value:function(){delete this.changeListContext}}),Object.defineProperty(e.prototype,"incomingChangeList",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.changeListContext=e}}),Object.defineProperty(e.prototype,"makeLayerMaterial",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.layer.shaderIOInfo;return(0,n.generateLayerMaterial)(this.layer,e.vs,e.fs,e.uniforms,e.materialUniforms)}}),e}();t.BufferManagerBase=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.BaseIOExpansion=void 0;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"expand",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){return{instanceAttributes:[],uniforms:[],vertexAttributes:[]}}}),Object.defineProperty(t.prototype,"validate",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){return!0}}),Object.defineProperty(t.prototype,"processHeaderInjection",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i,o,a){return{injection:""}}}),Object.defineProperty(t.prototype,"processAttributeDestructuring",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i,o){return""}}),t}(r(87).BaseShaderIOInjection);t.BaseIOExpansion=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PackNode=void 0;var n=r(7),i=function(){function e(e,t,r,i){Object.defineProperty(this,"child",{enumerable:!0,configurable:!0,writable:!0,value:[null,null]}),Object.defineProperty(this,"isLeaf",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bounds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.bounds=new n.Bounds({height:i,width:r,x:e,y:t})}return Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.child[0],t=this.child[1];this.data=null,e&&e.destroy(),t&&t.destroy(),this.child[0]=null,this.child[1]=null}}),Object.defineProperty(e.prototype,"hasChild",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.child[0],t=this.child[1];return e&&!e.data?!e.isLeaf:!(!t||t.data)&&!t.isLeaf}}),Object.defineProperty(e.prototype,"insert",{enumerable:!1,configurable:!0,writable:!0,value:function(t){var r=this.child[0],n=this.child[1];if(!this.isLeaf&&r&&n){var i=r.insert(t);return null!==i?i:n.insert(t)}if(this.data)return null;var o=this.bounds.fits(t.bounds);if(0===o)return null;if(1===o)return this.data=t.data,this;this.isLeaf=!1;var a=t.bounds.width,s=t.bounds.height,u=this.bounds.width-a,c=this.bounds.height-t.bounds.height;return u>c?(r=this.child[0]=new e(this.bounds.x,this.bounds.y,a,this.bounds.height),n=this.child[1]=new e(this.bounds.x+a,this.bounds.y,u,this.bounds.height)):(r=this.child[0]=new e(this.bounds.x,this.bounds.y,this.bounds.width,s),n=this.child[1]=new e(this.bounds.x,this.bounds.y+s,this.bounds.width,c)),r.insert(t)}}),Object.defineProperty(e.prototype,"remove",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.child[0],r=this.child[1];if(r&&t&&!this.isLeaf){var n=t.remove(e);return!!n||(n=r.remove(e),t.hasChild()||r.hasChild()||(this.child[0]=null,this.child[1]=null),n)}return this.data===e&&(this.data=null,!0)}}),Object.defineProperty(e,"applyToSubTexture",{enumerable:!1,configurable:!0,writable:!0,value:function(t,r,i,o,a){if(i){o=o||{top:0,left:0,bottom:0,right:0};var s,u=r instanceof e?r.bounds:r,c=(u.x+o.left)/t.bounds.width,l=(u.y+o.top)/t.bounds.height,f=(u.width-o.left-o.right)/t.bounds.width,d=(u.height-o.top-o.bottom)/t.bounds.height,p=(s=a?new n.Bounds({bottom:1-l,left:c,right:c+f,top:1-(l+d)}):new n.Bounds({top:1-l,left:c,right:c+f,bottom:1-(l+d)})).bottom,h=s.y,b=s.x,g=s.x+s.width;i.atlasTL=[b,h],i.atlasBR=[g,p],i.atlasBL=[b,p],i.atlasTR=[g,h],i.widthOnAtlas=Math.abs(i.atlasTR[0]-i.atlasTL[0]),i.heightOnAtlas=Math.abs(i.atlasTR[1]-i.atlasBR[1]),i.pixelWidth=f*t.bounds.width,i.pixelHeight=d*t.bounds.height}}}),e}();t.PackNode=i},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(245),i(r(9),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventManager=void 0;var n=function(){function e(){Object.defineProperty(this,"userInputManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"surface",{get:function(){return this.userInputManager.surface},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"getProjection",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.userInputManager.getView(e);return t?t.projection:null}}),Object.defineProperty(e.prototype,"getView",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.userInputManager&&this.userInputManager.getView(e)||null}}),Object.defineProperty(e.prototype,"getViewScreenBounds",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.userInputManager.getView(e);return t?t.screenBounds:null}}),Object.defineProperty(e.prototype,"setUserInputManager",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.userInputManager=e}}),Object.defineProperty(e.prototype,"willRender",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Object.defineProperty(e.prototype,"didRender",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),e}();t.EventManager=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InstanceProvider=void 0;var n=r(0),i=r(8),o=function(){function e(e){if(Object.defineProperty(this,"_uid",{enumerable:!0,configurable:!0,writable:!0,value:(0,i.uid)()}),Object.defineProperty(this,"cleanObservation",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"instanceChanges",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"allowChanges",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"resolveContext",{enumerable:!0,configurable:!0,writable:!0,value:""}),e)for(var t=0,r=e.length;t<r;++t){var n=e[t];this.add(n)}}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"changeList",{get:function(){this.allowChanges=!1;var e=[];return this.instanceChanges.forEach((function(t){return e.push(t)})),e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"add",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this.cleanObservation.get(e.uid))return e;if(this.allowChanges){e.observer=this;var t=e.observableDisposer;this.cleanObservation.set(e.uid,[e,t]),this.instanceChanges.set(e.uid,[e,n.InstanceDiffType.INSERT,e.changes])}return e}}),Object.defineProperty(e.prototype,"clear",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.cleanObservation.forEach((function(t){e.remove(t[0])}))}}),Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.cleanObservation.forEach((function(e){e[1]()})),this.cleanObservation.clear(),this.instanceChanges.clear()}}),Object.defineProperty(e.prototype,"instanceUpdated",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.allowChanges&&this.instanceChanges.set(e.uid,[e,n.InstanceDiffType.CHANGE,e.changes])}}),Object.defineProperty(e.prototype,"remove",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this.allowChanges){var t=this.cleanObservation.get(e.uid);t&&(t[1](),this.cleanObservation.delete(e.uid),this.instanceChanges.set(e.uid,[e,n.InstanceDiffType.REMOVE,{}]))}return!1}}),Object.defineProperty(e.prototype,"resolve",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this.allowChanges=!0,this.instanceChanges.clear(),this.resolveContext&&this.resolveContext!==e)throw new Error("An instance provider has been issued to two layers. This is not a suppported feature yet and can cause issues.");this.resolveContext=e}}),Object.defineProperty(e.prototype,"sync",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=[];this.cleanObservation.forEach((function(r){var i=r[0];e.instanceChanges.set(i.uid,[i,n.InstanceDiffType.INSERT,t])}))}}),e}();t.InstanceProvider=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.concat4x4=t.multiply4x4=t.multiply3x3=t.multiply2x2=t.identity4=t.identity3=t.identity2=t.multiplyScalar4x4=t.multiplyScalar3x3=t.multiplyScalar2x2=t.affineInverse4x4=t.affineInverse3x3=t.affineInverse2x2=t.determinant4x4=t.determinant3x3=t.determinant2x2=t.apply4x4=t.apply3x3=t.apply2x2=t.M4R=t.M3R=t.M433=t.M432=t.M431=t.M430=t.M423=t.M422=t.M421=t.M420=t.M413=t.M412=t.M411=t.M410=t.M403=t.M402=t.M401=t.M400=t.M322=t.M321=t.M320=t.M312=t.M311=t.M310=t.M302=t.M301=t.M300=t.M211=t.M210=t.M201=t.M200=void 0,t.SRT4x4_2D=t.TRS4x4_2D=t.SRT4x4=t.TRS4x4=t.copy4x4=t.copy3x3=t.copy2x2=t.compare4x4=t.compare3x3=t.compare2x2=t.project3As4ToScreen=t.projectToScreen=t.orthographic4x4=t.perspectiveFOVY4x4=t.perspective4x4=t.perspectiveFrustum4x4=t.translation4x4=t.translation4x4by3=t.scale4x4=t.scale4x4by3=t.rotation4x4by3=t.rotation4x4=t.rotation2x2=t.toString4x4=t.toString3x3=t.toString2x2=t.transform4=t.transform3as4=t.transform3=t.transform2=t.shearZ4x4=t.shearY4x4=t.shearX4x4=t.shearY2x2=t.shearX2x2=t.transpose4x4=t.transpose3x3=t.transpose2x2=t.Hadamard4x4=t.Hadamard3x3=t.Hadamard2x2=t.subtract4x4=t.subtract3x3=t.subtract2x2=t.add4x4=t.add3x3=t.add2x2=void 0;var n=r(2),i=Math.cos,o=Math.sin,a=Math.tan,s=Math.PI/2;function u(e,t,r,n,i){return(e=e||new Array(4))[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function c(e,t,r,n,i,o,a,s,u,c){return(e=e||new Array(9))[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=c,e}function l(e,t,r,n,i,o,a,s,u,c,l,f,d,p,h,b,g){return(e=e||new Array(16))[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=f,e[11]=d,e[12]=p,e[13]=h,e[14]=b,e[15]=g,e}t.M200=0,t.M201=1,t.M210=2,t.M211=3,t.M300=0,t.M301=1,t.M302=2,t.M310=3,t.M311=4,t.M312=5,t.M320=6,t.M321=7,t.M322=8,t.M400=0,t.M401=1,t.M402=2,t.M403=3,t.M410=4,t.M411=5,t.M412=6,t.M413=7,t.M420=8,t.M421=9,t.M422=10,t.M423=11,t.M430=12,t.M431=13,t.M432=14,t.M433=15,t.M3R=new Array(20).fill(0).map((function(e){return m()})),t.M4R=new Array(20).fill(0).map((function(e){return w()})),t.apply2x2=u,t.apply3x3=c,t.apply4x4=l;var f=m(),d=m(),p=m(),h=m();function b(e){return e[3]*e[0]-e[1]*e[2]}function g(e){return e[0]*e[4]*e[8]-e[0]*e[5]*e[7]+e[1]*e[5]*e[6]-e[1]*e[3]*e[8]+e[2]*e[3]*e[7]-e[2]*e[4]*e[6]}function v(e){return c(f,e[5],e[6],e[7],e[9],e[10],e[11],e[13],e[14],e[15]),c(d,e[4],e[6],e[7],e[8],e[10],e[11],e[12],e[14],e[15]),c(p,e[4],e[5],e[7],e[8],e[9],e[11],e[12],e[13],e[15]),c(p,e[4],e[5],e[6],e[8],e[9],e[10],e[12],e[13],e[14]),e[0]*g(f)-e[1]*g(d)+e[2]*g(p)-e[3]*g(h)}function y(e){return u(e,1,0,0,1)}function m(e){return c(e,1,0,0,0,1,0,0,0,1)}function w(e){return l(e,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}function O(e,t,r){return(r=r||[])[0]=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],r[1]=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],r[2]=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],r[3]=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],r[4]=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],r[5]=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],r[6]=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],r[7]=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],r[8]=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],r[9]=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],r[10]=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],r[11]=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],r[12]=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],r[13]=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],r[14]=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],r[15]=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],r}function _(e,r,i){return(0,n.apply4)(i,e[t.M400]*r[0]+e[t.M410]*r[1]+e[t.M420]*r[2]+e[t.M430]*r[3],e[t.M401]*r[0]+e[t.M411]*r[1]+e[t.M421]*r[2]+e[t.M431]*r[3],e[t.M402]*r[0]+e[t.M412]*r[1]+e[t.M422]*r[2]+e[t.M432]*r[3],e[t.M403]*r[0]+e[t.M413]*r[1]+e[t.M423]*r[2]+e[t.M433]*r[3])}function T(e,t,r,n){if(e){if(t){if(r){var a=i(e),s=i(t),u=i(r),c=o(e),f=o(t);return l(n,s*u,s*(d=o(r)),-f,0,c*f*u-a*d,c*f*d+a*u,c*s,0,a*f*u+c*d,a*f*d-c*u,a*s,0,0,0,0,1)}a=i(e),s=i(t),c=o(e);return l(n,s,0,-(f=o(t)),0,c*f,a,c*s,0,a*f,-c,a*s,0,0,0,0,1)}if(r){a=i(e),u=i(r),c=o(e);return l(n,u,d=o(r),0,0,-a*d,a*u,c,0,c*d,-c*u,a,0,0,0,0,1)}return l(n,1,0,0,0,0,a=i(e),c=o(e),0,0,-c,a,0,0,0,0,1)}if(t){if(r){s=i(t),u=i(r),f=o(t);return l(n,s*u,s*(d=o(r)),-f,0,-d,u,0,0,f*u,f*d,s,0,0,0,0,1)}return l(n,s=i(t),0,-(f=o(t)),0,0,1,0,0,f,0,s,0,0,0,0,1)}var d;return r?l(n,u=i(r),d=o(r),0,0,-d,u,0,0,0,0,1,0,0,0,0,1):w(n)}function P(e,t,r,n){return l(n,e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1)}function x(e,t,r,n){return l(n,1,0,0,0,0,1,0,0,0,0,1,0,e,t,r,1)}function E(e,t,r,n,i,o,a){return l(a=a||w(),2*e/(n-r),0,0,0,0,2*e/(i-o),0,0,(n+r)/(n-r),(i+o)/(i-o),-(t+e)/(t-e),-1,0,0,-2*t*e/(t-e),0)}function j(e,t,r,i,o){return _(e,t,o=o||[0,0,0,0]),(0,n.apply4)(o,.5*(o[0]/o[3]+1)*r,.5*(o[1]/o[3]+1)*i,o[2]/o[3],1)}function S(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}t.determinant2x2=b,t.determinant3x3=g,t.determinant4x4=v,t.affineInverse2x2=function(e,t){var r=b(e);return 0===r?null:u(t,e[3]/r,-e[1]/r,-e[2]/r,e[0]/r)},t.affineInverse3x3=function(e,t){var r=g(e);if(0===r)return null;var n=b([e[4],e[5],e[7],e[8]]),i=b([e[3],e[5],e[6],e[8]]),o=b([e[3],e[4],e[6],e[7]]),a=b([e[1],e[2],e[7],e[8]]),s=b([e[0],e[2],e[6],e[8]]),u=b([e[0],e[1],e[6],e[7]]);return c(t,n/r,-a/r,b([e[1],e[2],e[4],e[5]])/r,-i/r,s/r,b([e[0],e[2],e[3],e[5]])/r,o/r,-u/r,b([e[0],e[1],e[3],e[4]])/r)},t.affineInverse4x4=function(e,t){var r=v(e);if(0===r)return null;var n=b([e[0],e[1],e[4],e[5]]),i=b([e[0],e[2],e[4],e[6]]),o=b([e[0],e[3],e[4],e[7]]),a=b([e[1],e[2],e[5],e[6]]),s=b([e[1],e[3],e[5],e[7]]),u=b([e[2],e[3],e[6],e[7]]),c=b([e[10],e[11],e[14],e[15]]),f=b([e[9],e[11],e[13],e[15]]),d=b([e[9],e[10],e[13],e[14]]),p=b([e[8],e[11],e[12],e[15]]),h=b([e[8],e[10],e[12],e[14]]),g=b([e[8],e[9],e[12],e[13]]);return l(t,(e[5]*c-e[6]*f+e[7]*d)/r,(-e[1]*c+e[2]*f-e[3]*d)/r,(e[12]*u-e[13]*s+e[14]*a)/r,(-e[9]*u+e[10]*s-e[11]*a)/r,(-e[4]*c+e[6]*p-e[7]*h)/r,(e[0]*c-e[2]*p+e[3]*h)/r,(-e[12]*u+e[14]*o-e[15]*i)/r,(e[8]*u-e[10]*o+e[11]*i)/r,(e[4]*f-e[5]*p+e[7]*g)/r,(-e[0]*f+e[1]*p-e[3]*g)/r,(e[12]*s-e[13]*o+e[15]*n)/r,(-e[8]*s+e[9]*o-e[11]*n)/r,(-e[4]*d+e[5]*h-e[6]*g)/r,(e[0]*d-e[1]*h+e[2]*g)/r,(-e[12]*a+e[13]*i-e[14]*n)/r,(e[8]*a-e[9]*i+e[10]*n)/r)},t.multiplyScalar2x2=function(e,t,r){return u(r,e[0]*t,e[1]*t,e[2]*t,e[3]*t)},t.multiplyScalar3x3=function(e,t,r){return c(r,e[0]*t,e[1]*t,e[2]*t,e[3]*t,e[4]*t,e[5]*t,e[6]*t,e[7]*t,e[8]*t)},t.multiplyScalar4x4=function(e,t,r){return l(r,e[0]*t,e[1]*t,e[2]*t,e[3]*t,e[4]*t,e[5]*t,e[6]*t,e[7]*t,e[8]*t,e[9]*t,e[10]*t,e[11]*t,e[12]*t,e[13]*t,e[14]*t,e[15]*t)},t.identity2=y,t.identity3=m,t.identity4=w,t.multiply2x2=function(e,r,n){return u(n,r[t.M200]*e[t.M200]+r[t.M201]*e[t.M210],r[t.M200]*e[t.M201]+r[t.M201]*e[t.M211],r[t.M210]*e[t.M200]+r[t.M211]*e[t.M210],r[t.M210]*e[t.M201]+r[t.M211]*e[t.M211])},t.multiply3x3=function(e,t,r){return c(r,t[0]*e[0]+t[1]*e[3]+t[2]*e[6],t[0]*e[1]+t[1]*e[4]+t[2]*e[7],t[0]*e[2]+t[1]*e[5]+t[2]*e[8],t[3]*e[0]+t[4]*e[3]+t[5]*e[6],t[3]*e[1]+t[4]*e[4]+t[5]*e[7],t[3]*e[2]+t[4]*e[5]+t[5]*e[8],t[6]*e[0]+t[7]*e[3]+t[8]*e[6],t[6]*e[1]+t[7]*e[4]+t[8]*e[7],t[6]*e[2]+t[7]*e[5]+t[8]*e[8])},t.multiply4x4=O,t.concat4x4=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(r.length<=0)return w();if(e=e||w(),1===r.length)return S(r[0],e);var i=r[0],o=t.M4R[t.M4R.length-1],a=t.M4R[t.M4R.length-2];e===o&&(o=t.M4R[t.M4R.length-3]),e===a&&(a=t.M4R[t.M4R.length-3]);for(var s=o,u=1,c=r.length-1;u<c;++u){var l=r[u];i=O(i,l,s),s=s===o?a:o}return O(i,r[r.length-1],e)},t.add2x2=function(e,t,r){return u(r,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3])},t.add3x3=function(e,t,r){return c(r,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3],e[4]+t[4],e[5]+t[5],e[6]+t[6],e[7]+t[7],e[8]+t[8])},t.add4x4=function(e,t,r){return l(r,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3],e[4]+t[4],e[5]+t[5],e[6]+t[6],e[7]+t[7],e[8]+t[8],e[9]+t[9],e[10]+t[10],e[11]+t[11],e[12]+t[12],e[13]+t[13],e[14]+t[14],e[15]+t[15])},t.subtract2x2=function(e,t,r){return u(r,e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])},t.subtract3x3=function(e,t,r){return c(r,e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3],e[4]-t[4],e[5]-t[5],e[6]-t[6],e[7]-t[7],e[8]-t[8])},t.subtract4x4=function(e,t,r){return l(r,e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3],e[4]-t[4],e[5]-t[5],e[6]-t[6],e[7]-t[7],e[8]-t[8],e[9]-t[9],e[10]-t[10],e[11]-t[11],e[12]-t[12],e[13]-t[13],e[14]-t[14],e[15]-t[15])},t.Hadamard2x2=function(e,t,r){return u(r,e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3])},t.Hadamard3x3=function(e,t,r){return c(r,e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3],e[4]*t[4],e[5]*t[5],e[6]*t[6],e[7]*t[7],e[8]*t[8])},t.Hadamard4x4=function(e,t,r){return l(r,e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3],e[4]*t[4],e[5]*t[5],e[6]*t[6],e[7]*t[7],e[8]*t[8],e[9]*t[9],e[10]*t[10],e[11]*t[11],e[12]*t[12],e[13]*t[13],e[14]*t[14],e[15]*t[15])},t.transpose2x2=function(e,t){return u(t,e[0],e[2],e[1],e[3])},t.transpose3x3=function(e,t){return c(t,e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])},t.transpose4x4=function(e,t){return l(t,e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},t.shearX2x2=function(e,t){return(e>=Math.PI/2||e<=-Math.PI/2)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),u(t=t||y(),1,0,a(e),1)},t.shearY2x2=function(e,t){return(e>=Math.PI/2||e<=-Math.PI/2)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),u(t=t||y(),1,a(e),0,1)},t.shearX4x4=function(e,t,r){(t>=s||t<=-s||e>=s||e<=-s)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),r=r||w();var n=a(t);return l(r,1,0,0,0,a(e),1,0,0,n,0,1,0,0,0,0,1)},t.shearY4x4=function(e,t,r){(t>=s||t<=-s||e>=s||e<=-s)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),r=r||w();var n=a(t);return l(r,1,a(e),0,0,0,1,0,0,0,n,1,0,0,0,0,1)},t.shearZ4x4=function(e,t,r){(t>=s||t<=-s||e>=s||e<=-s)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),r=r||w();var n=a(t);return l(r,1,0,a(e),0,0,1,n,0,0,0,1,0,0,0,0,1)},t.transform2=function(e,r,i){return(0,n.apply2)(i,e[t.M200]*r[0]+e[t.M210]*r[1],e[t.M201]*r[0]+e[t.M211]*r[1])},t.transform3=function(e,r,i){return(0,n.apply3)(i,e[t.M300]*r[0]+e[t.M310]*r[1]+e[t.M320]*r[2],e[t.M301]*r[0]+e[t.M311]*r[1]+e[t.M321]*r[2],e[t.M302]*r[0]+e[t.M312]*r[1]+e[t.M322]*r[2])},t.transform3as4=function(e,r,i){return(0,n.apply4)(i,e[t.M400]*r[0]+e[t.M410]*r[1]+e[t.M420]*r[2]+1*e[t.M430],e[t.M401]*r[0]+e[t.M411]*r[1]+e[t.M421]*r[2]+1*e[t.M431],e[t.M402]*r[0]+e[t.M412]*r[1]+e[t.M422]*r[2]+1*e[t.M432],e[t.M403]*r[0]+e[t.M413]*r[1]+e[t.M423]*r[2]+1*e[t.M433])},t.transform4=_,t.toString2x2=function(e){return"Matrix: [\n  ".concat(e[0],", ").concat(e[1],",\n  ").concat(e[2],", ").concat(e[3],",\n]")},t.toString3x3=function(e){return"Matrix: [\n  ".concat(e[0],", ").concat(e[1],", ").concat(e[2],",\n  ").concat(e[3],", ").concat(e[4],", ").concat(e[5],",\n  ").concat(e[6],", ").concat(e[7],", ").concat(e[8],",\n]")},t.toString4x4=function(e){return"Matrix: [\n  ".concat(e[0],", ").concat(e[1],", ").concat(e[2],", ").concat(e[3],",\n  ").concat(e[4],", ").concat(e[5],", ").concat(e[6],", ").concat(e[7],",\n  ").concat(e[8],", ").concat(e[9],", ").concat(e[10],", ").concat(e[11],",\n  ").concat(e[12],", ").concat(e[13],", ").concat(e[14],", ").concat(e[15],",\n]")},t.rotation2x2=function(e,r){r=r||new Array(4);var n=Math.cos(e),i=Math.sin(e);return r[t.M200]=n,r[t.M201]=-i,r[t.M210]=i,r[t.M211]=n,r},t.rotation4x4=T,t.rotation4x4by3=function(e,t){return T(e[0],e[1],e[2],t)},t.scale4x4by3=function(e,t){return P(e[0],e[1],e[2],t)},t.scale4x4=P,t.translation4x4by3=function(e,t){return x(e[0],e[1],e[2],t)},t.translation4x4=x,t.perspectiveFrustum4x4=E,t.perspective4x4=function(e,t,r,n,i,o){var s=r/t,u=a(e/2)*n,c=s*u;return E(n,i,-u,u,c,-c,o)},t.perspectiveFOVY4x4=function(e,t,r,n,i,o){var s=t/r,u=a(e/2)*n,c=s*u;return E(n,i,-c,c,u,-u,o)},t.orthographic4x4=function(e,t,r,n,i,o,a){return l(a,2/(t-e),0,0,0,0,2/(n-r),0,0,0,0,-1/(o-i),0,(t+e)/(e-t),(n+r)/(r-n),-i/(i-o),1)},t.projectToScreen=j,t.project3As4ToScreen=function(e,t,r,n,i){return j(e,[t[0],t[1],t[2],1],r,n,i)},t.compare2x2=function(e,t){return Math.abs(e[0]-t[0])<=1e-7&&Math.abs(e[1]-t[1])<=1e-7&&Math.abs(e[2]-t[2])<=1e-7&&Math.abs(e[3]-t[3])<=1e-7},t.compare3x3=function(e,t){return Math.abs(e[0]-t[0])<=1e-7&&Math.abs(e[1]-t[1])<=1e-7&&Math.abs(e[2]-t[2])<=1e-7&&Math.abs(e[3]-t[3])<=1e-7&&Math.abs(e[4]-t[4])<=1e-7&&Math.abs(e[5]-t[5])<=1e-7&&Math.abs(e[6]-t[6])<=1e-7&&Math.abs(e[7]-t[7])<=1e-7&&Math.abs(e[8]-t[8])<=1e-7},t.compare4x4=function(e,t){return Math.abs(e[0]-t[0])<=1e-7&&Math.abs(e[1]-t[1])<=1e-7&&Math.abs(e[2]-t[2])<=1e-7&&Math.abs(e[3]-t[3])<=1e-7&&Math.abs(e[4]-t[4])<=1e-7&&Math.abs(e[5]-t[5])<=1e-7&&Math.abs(e[6]-t[6])<=1e-7&&Math.abs(e[7]-t[7])<=1e-7&&Math.abs(e[8]-t[8])<=1e-7&&Math.abs(e[9]-t[9])<=1e-7&&Math.abs(e[10]-t[10])<=1e-7&&Math.abs(e[11]-t[11])<=1e-7&&Math.abs(e[12]-t[12])<=1e-7&&Math.abs(e[13]-t[13])<=1e-7&&Math.abs(e[14]-t[14])<=1e-7&&Math.abs(e[15]-t[15])<=1e-7},t.copy2x2=function(e){return[e[0],e[1],e[2],e[3]]},t.copy3x3=function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},t.copy4x4=S,t.TRS4x4=function(e,r,n,i){i=i||[];var o=e[0],a=e[1],s=e[2],u=n[0],c=n[1],l=n[2],f=r[0],d=r[1],p=r[2],h=r[3],b=r[4],g=r[5],v=r[6],y=r[7],m=r[8];i[t.M400]=f*o,i[t.M401]=d*a,i[t.M402]=p*s,i[t.M403]=0,i[t.M410]=h*o,i[t.M411]=b*a,i[t.M412]=g*s,i[t.M413]=0,i[t.M420]=v*o,i[t.M421]=y*a,i[t.M422]=m*s,i[t.M423]=0,i[t.M430]=o*(f*u+h*c+v*l),i[t.M431]=a*(d*u+b*c+y*l),i[t.M432]=s*(p*u+g*c+m*l),i[t.M433]=1},t.SRT4x4=function(e,r,n,i){i=i||[];var o=e[0],a=e[1],s=e[2],u=n[0],c=n[1],l=n[2],f=r[0],d=r[1],p=r[2],h=r[3],b=r[4],g=r[5],v=r[6],y=r[7],m=r[8];i[t.M400]=f*o,i[t.M401]=d*o,i[t.M402]=p*o,i[t.M403]=0,i[t.M410]=h*a,i[t.M411]=b*a,i[t.M412]=g*a,i[t.M413]=0,i[t.M420]=v*s,i[t.M421]=y*s,i[t.M422]=m*s,i[t.M423]=0,i[t.M430]=u,i[t.M431]=c,i[t.M432]=l,i[t.M433]=1},t.TRS4x4_2D=function(e,r,n,i){i=i||[];var o=e[0],a=e[1],s=n[0],u=n[1],c=r[0],l=r[1],f=r[2],d=r[3];i[t.M400]=c*o,i[t.M401]=l*a,i[t.M402]=0,i[t.M403]=0,i[t.M410]=f*o,i[t.M411]=d*a,i[t.M412]=0,i[t.M413]=0,i[t.M420]=0,i[t.M421]=0,i[t.M422]=1,i[t.M423]=0,i[t.M430]=o*(c*s+f*u),i[t.M431]=a*(l*s+d*u),i[t.M432]=0,i[t.M433]=1},t.SRT4x4_2D=function(e,r,n,i){i=i||[];var o=e[0],a=e[1],s=n[0],u=n[1],c=r[0],l=r[1],f=r[2],d=r[3];i[t.M400]=c*o,i[t.M401]=l*o,i[t.M402]=0,i[t.M403]=0,i[t.M410]=f*a,i[t.M411]=d*a,i[t.M412]=0,i[t.M413]=0,i[t.M420]=0,i[t.M421]=0,i[t.M422]=1,i[t.M423]=0,i[t.M430]=s,i[t.M431]=u,i[t.M432]=0,i[t.M433]=1}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Layer=void 0;var o=r(4),a=r(14),s=r(20),u=r(146),c=r(0),l=r(0),f=r(55),d=r(56),p=r(57),h=r(28),b=r(17),g=r(29),v=r(8),y=r(85),m=r(155),w=r(94),O=r(58),_=r(5)("performance"),T=function(e){function t(r,n,i){var o=e.call(this,i)||this;return Object.defineProperty(o,"animationEndTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(o,"isAnimationContinuous",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(o,"_bufferManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"_bufferType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"children",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"depth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(o,"diffManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"easingId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"_easingManager",{enumerable:!0,configurable:!0,writable:!0,value:{easingComplete:new g.PromiseResolver,complete:function(){return o._easingManager.easingComplete.promise}}}),Object.defineProperty(o,"initializer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"interactions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"lastFrameTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(o,"needsViewDrawn",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(o,"order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"parent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"picking",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"props",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"resource",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"shaderIOInfo",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(o,"streamChanges",{enumerable:!0,configurable:!0,writable:!0,value:{locked:!1,streamIndex:0}}),Object.defineProperty(o,"surface",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"_uid",{enumerable:!0,configurable:!0,writable:!0,value:(0,v.uid)()}),Object.defineProperty(o,"uidToInstance",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(o,"view",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(o,"willRebuildLayer",{enumerable:!0,configurable:!0,writable:!0,value:!1}),o.surface=r,o.scene=n,o.props=Object.assign({},t.defaultProps||{},i),o}return i(t,e),Object.defineProperty(t.prototype,"bufferManager",{get:function(){return this._bufferManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"easingManager",{get:function(){return this._easingManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid},enumerable:!1,configurable:!0}),Object.defineProperty(t,"createRef",{enumerable:!1,configurable:!0,writable:!0,value:function(){return{easing:null}}}),Object.defineProperty(t.prototype,"validateShaderIO",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return e?e.fs&&e.vs?void 0:(console.warn("Layer needs to specify the fragment and vertex shaders:",this.id),!1):(this.picking.type=c.PickType.NONE,_("Shell layer initialized. Nothing will be rendered for this layer",this.id),!0)}}),Object.defineProperty(t.prototype,"cleanShaderIOElements",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.instanceAttributes=(e.instanceAttributes||[]).filter(f.isDefined),e.vertexAttributes=(e.vertexAttributes||[]).filter(f.isDefined),e.uniforms=(e.uniforms||[]).filter(f.isDefined)}}),Object.defineProperty(t.prototype,"checkForDuplicateOutputTypes",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.props.mapOutput;(0,c.isString)(e.fs)&&(e.fs=[{outputType:c.FragmentOutputType.COLOR,source:e.fs}]),t=t||{};for(var r=new Set,n=!1,i=Number.MIN_SAFE_INTEGER,o=0,a=e.fs.length;o<a;++o){var s=e.fs[o],u=t[s.outputType];void 0!==u?(u===c.FragmentOutputType.NONE?s.outputType=i++:s.outputType=u,r.has(s.outputType)&&(n=!0),r.add(s.outputType)):(r.has(s.outputType)&&(n=!0),r.add(s.outputType))}if(n)return console.warn("Layer has duplicate fragment shader output types"),!1}}),Object.defineProperty(t.prototype,"processFragmentShadersForEachView",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){(0,c.isString)(e.fs)&&(e.fs=[{outputType:c.FragmentOutputType.COLOR,source:e.fs}]);var n=this.picking.type===c.PickType.SINGLE&&!Boolean(e.fs.find((function(e){return e.outputType===c.FragmentOutputType.PICKING})));if(this.picking.type===c.PickType.SINGLE&&!n)throw new Error("Do NOT specify picking prop on a layer when you have your own Picking output declared.");for(var i={outputType:c.FragmentOutputType.PICKING,source:r(158)},o=new Map,a={fs:new Map,vs:new Map,destructure:new Map},s=function(r,s){var l=t[r];if(n){var f=e.fs.findIndex((function(e){return e.outputType===c.FragmentOutputType.PICKING}));f>-1&&e.fs.splice(f,1)}var p=l.getOutputTargets(),h=0;e.fs.forEach((function(e,t){(null==p?void 0:p.find((function(t){return t.outputType===e.outputType})))&&(h=t)})),n&&e.fs.splice(h+1,0,i);var b=(0,d.mapInjectDefault)(a.fs,l,new Map);b||(b=new Map,a.fs.set(l,b));var g=u.ShaderProcessor.makeOutputFragmentShader(a.vs,b,p,e.fs);if(!g)return console.warn("Could not generate output fragment shaders for the view specified."),{value:!1};o.set(l,g)},l=0,f=t.length;l<f;++l){var p=s(l);if("object"==typeof p)return p.value}return{outputFragmentShaders:o,declarations:a}}}),Object.defineProperty(t.prototype,"processLayerShaders",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n;if(!(n=(new u.ShaderProcessor).process(this,e,t,r,this.surface.getIOExpanders(),this.surface.getShaderTransforms(),this.surface.getIOSorting())))return console.warn("The shader processor did not produce metrics for the layer."),!1;this.shaderIOInfo=Object.assign({activeAttribute:(0,p.createAttribute)({name:"active",size:c.InstanceAttributeSize.ONE,update:function(e){return[e.active?1:0]}}),instanceAttributes:n.instanceAttributes,instanceVertexCount:e.vertexCount,vs:n.vs,fs:n.fs,materialUniforms:n.materialUniforms,maxInstancesPerBuffer:n.maxInstancesPerBuffer,drawMode:e.drawMode||o.GLSettings.Model.DrawMode.TRIANGLE_STRIP,uniforms:n.uniforms,vertexAttributes:n.vertexAttributes},this.shaderIOInfo)}}),Object.defineProperty(t.prototype,"processVertexAttributes",{enumerable:!1,configurable:!0,writable:!0,value:function(e){(0,O.generateLayerGeometry)(this,this.shaderIOInfo.maxInstancesPerBuffer,this.shaderIOInfo.vertexAttributes,e.vertexCount)}}),Object.defineProperty(t.prototype,"init",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!this.surface.gl)return console.warn("The layer's surface does not have a valid WebGL context."),!1;var t=this.props.picking;(void 0===t?c.PickType.NONE:t)===c.PickType.SINGLE?this.picking={currentPickMode:c.PickType.NONE,type:c.PickType.SINGLE,uidToInstance:new Map}:this.picking={currentPickMode:c.PickType.NONE,type:c.PickType.NONE},this.resource=this.surface.resourceManager;var r=this.initShader();this.interactions=new w.LayerInteractionHandler(this);var n,i=this.validateShaderIO(r);return void 0!==i?i:!!r&&(n=this.cleanShaderIOElements(r),(0,l.isBoolean)(n)?n:(n=this.checkForDuplicateOutputTypes(r),(0,l.isBoolean)(n)?n:(n=this.processFragmentShadersForEachView(r,e),(0,l.isBoolean)(n)?n:(n=this.processLayerShaders(r,n.outputFragmentShaders,n.declarations),(0,l.isBoolean)(n)?n:(n=this.processVertexAttributes(r),(0,l.isBoolean)(n)?n:(n=this.makeLayerBufferManager(this.surface.gl,this.scene),(0,l.isBoolean)(n)?n:(n=this.updateDiffHandlers(),(0,l.isBoolean)(n)?n:(this.layerShaderDebugging(),this.props.ref&&(this.props.ref.easing=this.easingManager),!0))))))))}}),Object.defineProperty(t.prototype,"layerShaderDebugging",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.props.printShader&&(console.warn("A Layer requested its shader be debugged. Do not leave this active for production:","Layer:",this.props.key,"Shader Metrics",this.shaderIOInfo),console.warn("\n\nVERTEX SHADER\n--------------\n\n",this.shaderIOInfo.vs),this.shaderIOInfo.fs.forEach((function(e,t){console.warn("\n\nFRAGMENT SHADER (view: ".concat(t.id,"):\nOutput Targets").concat(JSON.stringify(e.outputNames),"\n").concat(JSON.stringify(e.outputTypes),"\n--------------\n\n"),e.source)})))}}),Object.defineProperty(t.prototype,"baseShaderModules",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=[];return t.push("instancing"),this.picking.type===c.PickType.SINGLE&&t.push("picking"),(e.instanceAttributes||[]).find((function(e){return Boolean(e&&e.easing)}))&&t.push("frame"),{fs:[],vs:t}}}),Object.defineProperty(t.prototype,"childLayers",{enumerable:!1,configurable:!0,writable:!0,value:function(){return[]}}),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.bufferManager&&(this.bufferManager.scene&&this.bufferManager.scene.removeLayer(this),this.bufferManager.removeFromScene(),this.bufferManager.destroy())}}),Object.defineProperty(t.prototype,"didUpdateProps",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Object.defineProperty(t.prototype,"draw",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.updateStreamLock();var e,t,r,n=this.getChangeList();n.length>0&&(this.needsViewDrawn=!0);var i=this.diffManager,o=i.processing,a=i.processor;a.incomingChangeList(n),this.bufferManager.incomingChangeList(n);for(var s=0,u=n.length;s<u;++s)t=(e=n[s])[0],r=this.bufferManager.getBufferLocations(t),o[e[1]](a,t,Object.values(e[2]),r),t.changes={};a.commit(),this.bufferManager.changesProcessed(),this.updateEasingManager(),this.updateUniforms()}}),Object.defineProperty(t.prototype,"updateEasingManager",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this.props.streamChanges){if(!this.streamChanges.stream||this.streamChanges.stream.length<=0){var e=this._easingManager.easingComplete;this._easingManager.easingComplete=new g.PromiseResolver,(0,h.onFrame)((function(){e.resolve()}),this.animationEndTime-this.surface.frameMetrics.currentTime)}}else{var t=this._easingManager.easingComplete;this._easingManager.easingComplete=new g.PromiseResolver,(0,h.onFrame)((function(){t.resolve()}),this.animationEndTime-this.surface.frameMetrics.currentTime)}}}),Object.defineProperty(t.prototype,"getNextStreamChanges",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,t=this.props.streamChanges,r=void 0===t?{count:1e4,strategy:c.StreamChangeStrategy.LINEAR}:t,n=this.streamChanges,i=n.stream,o=void 0===i?[]:i,a=n.streamIndex;switch(void 0===r.count&&(r.count=1e4),r.count<=0&&(r.count=Number.MAX_SAFE_INTEGER),r.strategy){case c.StreamChangeStrategy.LINEAR:default:e=o.slice(a,a+r.count),this.streamChanges.streamIndex+=r.count}return this.streamChanges.stream&&this.streamChanges.streamIndex>=this.streamChanges.stream.length&&delete this.streamChanges.stream,e}}),Object.defineProperty(t.prototype,"updateStreamLock",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.streamChanges.locked=Boolean(this.streamChanges.stream&&this.streamChanges.streamIndex<this.streamChanges.stream.length)}}),Object.defineProperty(t.prototype,"getChangeList",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e;return this.streamChanges.locked?e=this.getNextStreamChanges():this.props.streamChanges?(this.streamChanges.streamIndex=0,this.streamChanges.locked=!0,this.streamChanges.stream=this.props.data.changeList,e=[],this.props.data.resolve(this.id)):(e=this.props.data.changeList,this.props.data.resolve(this.id)),this.updateStreamLock(),e}}),Object.defineProperty(t.prototype,"getInstanceObservableIds",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){for(var r={},n=0,i=t.length;n<i;++n){s.ObservableMonitoring.setObservableMonitor(!0),e[t[n]];var o=s.ObservableMonitoring.getObservableMonitorIds(!0);void 0!==o[0]&&(r[t[n]]=o[0])}return s.ObservableMonitoring.setObservableMonitor(!1),r}}),Object.defineProperty(t.prototype,"getMaterialOptions",{enumerable:!1,configurable:!0,writable:!0,value:function(){return{}}}),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){return{fs:"${import: no-op}",instanceAttributes:[],uniforms:[],vertexAttributes:[],vertexCount:0,vs:"${import: no-op}"}}}),Object.defineProperty(t.prototype,"managesInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.bufferManager&&this.bufferManager.managesInstance(e)}}),Object.defineProperty(t.prototype,"getLayerBufferType",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=c.LayerBufferType.UNIFORM,i=0;if(void 0!==this.bufferType)return this.bufferType;if(a.WebGLStat.HARDWARE_INSTANCING){for(var o=0,s=t.length;o<s;++o){var u=t[o];i+=Math.ceil(u.size/4)}for(o=0,s=r.length;o<s;++o){u=r[o];i+=Math.ceil(c.instanceAttributeSizeFloatCount[u.size||1]/4)}if(i>a.WebGLStat.MAX_VERTEX_ATTRIBUTES){i=0;for(o=0,s=r.length;o<s;++o){u=r[o];i=Math.max(i,u.block||0)}for(o=0,s=t.length;o<s;++o){u=t[o];i+=Math.ceil(u.size/4)}i<a.WebGLStat.MAX_VERTEX_ATTRIBUTES&&(n=c.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING,_("Performance Issue (Moderate):\n            Layer %o is utilizing too many vertex attributes and is now using vertex packing.\n            Max Vertex units %o\n            Used Vertex units %o\n            Instance Attributes %o\n            Vertex Attributes %o",this.id,a.WebGLStat.MAX_VERTEX_ATTRIBUTES,i,r,t))}else n=c.LayerBufferType.INSTANCE_ATTRIBUTE}return n===c.LayerBufferType.UNIFORM&&(_("Performance Issue (High):\n        Layer %o is utilizing too many vertex attributes and is now using a uniform buffer.\n        Max Vertex units %o\n        Used Vertex units %o\n        Instance Attributes %o\n        Vertex Attributes %o",this.id,a.WebGLStat.MAX_VERTEX_ATTRIBUTES,i,r,t),n=c.LayerBufferType.UNIFORM),this.setBufferType(n),n}}),Object.defineProperty(t.prototype,"makeLayerBufferManager",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){switch(this.getLayerBufferType(e,this.shaderIOInfo.vertexAttributes,this.shaderIOInfo.instanceAttributes)){case c.LayerBufferType.INSTANCE_ATTRIBUTE:this.setBufferManager(new y.InstanceAttributeBufferManager(this,t));break;case c.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING:this.setBufferManager(new y.InstanceAttributePackingBufferManager(this,t));break;default:this.setBufferManager(new y.UniformBufferManager(this,t))}}}),Object.defineProperty(t.prototype,"updateDiffHandlers",{enumerable:!1,configurable:!0,writable:!0,value:function(){(this.shaderIOInfo.instanceAttributes||[]).find((function(e){return Boolean(e&&e.easing)}))?this.picking.type===c.PickType.SINGLE?(this.onDiffAdd=this.handleDiffAddWithPickingAndEasing,this.onDiffRemove=this.handleDiffRemoveWithPickingAndEasing):(this.onDiffAdd=this.handleDiffAddWithEasing,this.onDiffRemove=this.handleDiffRemoveWithEasing):this.picking.type===c.PickType.SINGLE&&(this.onDiffAdd=this.handleDiffAddWithPicking,this.onDiffRemove=this.handleDiffRemoveWithPicking)}}),Object.defineProperty(t.prototype,"handleDiffAddWithEasing",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.easingId=this.easingId}}),Object.defineProperty(t.prototype,"handleDiffAddWithPicking",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.uidToInstance.set(e.uid,e)}}),Object.defineProperty(t.prototype,"handleDiffAddWithPickingAndEasing",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.uidToInstance.set(e.uid,e),e.easingId=this.easingId}}),Object.defineProperty(t.prototype,"handleDiffRemoveWithEasing",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.easing&&delete e.easing,delete e.easingId}}),Object.defineProperty(t.prototype,"handleDiffRemoveWithPicking",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.uidToInstance.delete(e.uid)}}),Object.defineProperty(t.prototype,"handleDiffRemoveWithPickingAndEasing",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.uidToInstance.delete(e.uid),e.easing&&delete e.easing,delete e.easingId}}),Object.defineProperty(t.prototype,"rebuildLayer",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this.willRebuildLayer=!0,this.children)for(var e=0,t=this.children.length;e<t;++e){this.children[e].rebuildLayer()}}}),Object.defineProperty(t.prototype,"resolveChanges",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.props.data.changeList;t.length>0&&(this.needsViewDrawn=!0),e||this.props.data.resolve(this.id);for(var r=0,n=t.length;r<n;++r)t[r][0].changes={};return t}}),Object.defineProperty(t.prototype,"setBufferManager",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._bufferManager?console.warn("You can not change a layer's buffer strategy once it has been instantiated."):(this._bufferManager=e,this.diffManager=new m.InstanceDiffManager,this.diffManager.makeProcessor(this,e))}}),Object.defineProperty(t.prototype,"setBufferType",{enumerable:!1,configurable:!0,writable:!0,value:function(e){void 0===this._bufferType?this._bufferType=e:console.warn("You can not change a layers buffer strategy once it has been instantiated.")}}),Object.defineProperty(t.prototype,"shouldDrawView",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){for(var r in t)if(t[r]!==e[r])return!0;return!1}}),Object.defineProperty(t.prototype,"updateUniforms",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var e,t,r=0,n=this.shaderIOInfo.uniforms.length;r<n;++r)e=this.shaderIOInfo.uniforms[r],t=e.update(e),e.materialUniforms.forEach((function(e){return e.value=t}))}}),Object.defineProperty(t.prototype,"willUpdateProps",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.picking!==this.props.picking&&this.rebuildLayer(),e.ref!==this.props.ref&&this.props.ref&&(this.props.ref.easing=this.easingManager)}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{}}),t}(b.IdentifyByKey);t.Layer=T},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shaderTemplate=void 0,t.shaderTemplate=function(e){var t=e.shader,r=e.options,n=void 0===r?{}:r,i=e.required,o=e.onError,a=e.onToken,s=e.onMain,u=new Map,c=new Map,l=new Map,f=new Map,d=t.replace(/\$\{([^\}]*)\}/g,(function(e,t){var r="";return f.set(t,(f.get(t)||0)+1),t in n?(u.set(t,(u.get(t)||0)+1),r=n[t]):c.set(t,(c.get(t)||0)+1),a&&(r=a(t,r)),r}));Object.keys(n).forEach((function(e){u.get(e)||l.set(e,(l.get(e)||0)+1)}));var p={resolvedShaderOptions:u,shader:d,shaderProvidedOptions:f,unresolvedProvidedOptions:l,unresolvedShaderOptions:c};if(i&&i.values.forEach((function(e){if(p.unresolvedProvidedOptions.get(e)){var t="".concat(i.name,": Could not resolve all the required inputs. Input: ").concat(e);o?o(t):console.error(t)}else if(p.unresolvedShaderOptions.get(e)){t="".concat(i.name,": A required option was not provided in the options parameter. Option: ").concat(e);o?o(t):console.error(t)}else if(!p.resolvedShaderOptions.get(e)){t="".concat(i.name,": A required option was not provided in the options parameter. Option: ").concat(e);o?o(t):console.error(t)}})),s){var h=p.shader,b=h.match(/void((.+)|\s)(main(\s+)\(\)|main\(\))(((.+)(\s*)\{)|(\s*)\{)/gm);if(b&&b.length>0){var g=h.indexOf(b[0]);if(g<0)s(null);else{for(var v=h.substr(0,g),y=h.substr(g+b[0].length),m=!1,w=!1,O=1,_=0,T=-1,P=0,x=y.length;P<x;++P){var E=y[P],j=y[P+1];switch(E){case"/":switch(j){case"*":m||w||(m=!0,P++);break;case"/":m||w||(w=!0,P++)}break;case"*":"/"===j&&(w||(m=!1,P++));break;case"\n":case"\r":m||(w=!1);break;case"{":m||w||O++;break;case"}":m||w||_++,O===_&&(T=P)}if(-1!==T)break}if(-1!==T){var S=y.substr(0,T),R=y.substr(T+1),M=s(S,"".concat(v,"\n").concat(R));p.shader="string"==typeof M?h.substr(0,g+b[0].length)+M+h.substr(g+b[0].length+T):h.substr(0,g)+M.header+h.substr(g,b[0].length)+M.main+h.substr(g+b[0].length+T)}else s(null)}}}return p}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateLayerModel=void 0;var n=r(4);t.generateLayerModel=function(e,t,r,i){var o=new n.Model(e,t,r);return o.drawMode=i||n.GLSettings.Model.DrawMode.TRIANGLE_STRIP,o}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Camera2D=void 0;var o=r(16),a=r(41),s=function(e){function t(t){var r=e.call(this,{left:-100,right:100,top:-100,bottom:100,near:-100,far:1e5,type:o.CameraProjectionType.ORTHOGRAPHIC})||this;return Object.defineProperty(r,"_control2D",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),r.control2D=new a.Control2D(r,t),r}return i(t,e),Object.defineProperty(t.prototype,"control2D",{get:function(){return this._control2D},set:function(e){this._control2D=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale2D",{get:function(){return this.control2D.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offset",{get:function(){return this.control2D.offset},enumerable:!1,configurable:!0}),t}(o.Camera);t.Camera2D=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Control2D=void 0;var n=r(52),i=r(2),o=r(8),a=n.AutoEasingMethod.immediate(0),s=function(){function e(e,t){Object.defineProperty(this,"_id",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.uid)()}),Object.defineProperty(this,"animation",{enumerable:!0,configurable:!0,writable:!0,value:n.AutoEasingMethod.immediate(0)}),Object.defineProperty(this,"animationEndTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"offsetBroadcastTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"scaleBroadcastTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_offset",{enumerable:!0,configurable:!0,writable:!0,value:[0,0,0]}),Object.defineProperty(this,"startOffset",{enumerable:!0,configurable:!0,writable:!0,value:[0,0,0]}),Object.defineProperty(this,"startOffsetTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"offsetEndTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_scale",{enumerable:!0,configurable:!0,writable:!0,value:[1,1,1]}),Object.defineProperty(this,"startScale",{enumerable:!0,configurable:!0,writable:!0,value:[1,1,1]}),Object.defineProperty(this,"startScaleTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"scaleEndTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"surface",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onViewChange",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"needsBroadcast",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.camera=e,t&&(this._offset=(0,i.copy3)(t.offset||this._offset),this._scale=(0,i.copy3)(t.scale||this._scale))}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"broadcast",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.offset,this.scale,this.needsBroadcast&&(this.needsBroadcast=!1,this.onViewChange&&this.onViewChange(this.camera,e))}}),Object.defineProperty(e.prototype,"centerOn",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this.surface.getViewSize(e);if(r){var n=[r.width/2,r.height/2,0],o=(0,i.subtract3)(t,(0,i.divide3)(n,this._scale)),s=this.animation;this.setOffset((0,i.copy3)(this.offset)),this.animation=a,this.setOffset((0,i.scale3)(o,-1)),this.animation=s}}}),Object.defineProperty(e.prototype,"getCurrentTime",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.surface?this.surface.frameMetrics.currentTime:0}}),Object.defineProperty(e.prototype,"getOffset",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._offset}}),Object.defineProperty(e.prototype,"getScale",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._scale}}),Object.defineProperty(e.prototype,"offset",{get:function(){var e=this.getCurrentTime();return this.onViewChange&&this.offsetBroadcastTime<this.offsetEndTime&&(this.offsetBroadcastTime=e,this.needsBroadcast=!0),this.animation.cpu(this.startOffset,this._offset,(e-this.startOffsetTime)/this.animation.duration)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"setId",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._id=e,this.camera.needsViewDrawn=!0}}),Object.defineProperty(e.prototype,"setOffset",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.startOffset=(0,i.copy3)(this.offset),this._offset=(0,i.copy3)(e),this.startOffsetTime=this.getCurrentTime(),this.offsetEndTime=this.startOffsetTime+this.animation.duration,this.updateEndTime(),this.camera.needsViewDrawn=!0,this.onViewChange&&(this.offsetBroadcastTime=this.startOffsetTime,this.needsBroadcast=!0)}}),Object.defineProperty(e.prototype,"scale",{get:function(){var e=this.getCurrentTime();return this.onViewChange&&this.scaleBroadcastTime<this.scaleEndTime&&(this.scaleBroadcastTime=e,this.needsBroadcast=!0),this.animation.cpu(this.startScale,this._scale,(e-this.startScaleTime)/this.animation.duration)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"setViewChangeHandler",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.onViewChange=e}}),Object.defineProperty(e.prototype,"setScale",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.startScale=(0,i.copy3)(this.scale),this._scale=(0,i.copy3)(e),this.startScaleTime=this.getCurrentTime(),this.scaleEndTime=this.startScaleTime+this.animation.duration,this.updateEndTime(),this.camera.needsViewDrawn=!0,this.onViewChange&&(this.scaleBroadcastTime=this.startScaleTime,this.needsBroadcast=!0)}}),Object.defineProperty(e.prototype,"resolve",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.camera.needsViewDrawn=!1,this.needsBroadcast=!1}}),Object.defineProperty(e.prototype,"update",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.camera.needsViewDrawn=!0}}),Object.defineProperty(e.prototype,"updateEndTime",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.animationEndTime=Math.max(this.scaleEndTime,this.offsetEndTime)}}),e}();t.Control2D=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.TextureIOExpansion=void 0;var o=r(15),a=r(31),s=r(0);var u=function(e){function t(t,r){var n=e.call(this)||this;return Object.defineProperty(n,"manager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"resourceType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n.manager=r,n.resourceType=t,n}return i(t,e),Object.defineProperty(t.prototype,"expand",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){var i=this,a=this.manager,u=[],c=new Map;t.forEach((function(e){if(n=e,o=i.manager.router,a=i.resourceType,n&&n.resource&&o.getResourceType(n.resource.key())===a&&void 0!==n.resource.name&&void 0!==n.resource.key){void 0===e.size&&(e.size=s.InstanceAttributeSize.FOUR);var t=e.resource.shaderInjection||s.ShaderInjectionTarget.FRAGMENT,r=c.get(e.resource.name);r?c.set(e.resource.name,[r[0]||t===s.ShaderInjectionTarget.VERTEX||t===s.ShaderInjectionTarget.ALL,r[1]||t===s.ShaderInjectionTarget.FRAGMENT||t===s.ShaderInjectionTarget.ALL]):(u.push(e),c.set(e.resource.name,[t===s.ShaderInjectionTarget.VERTEX||t===s.ShaderInjectionTarget.ALL,t===s.ShaderInjectionTarget.FRAGMENT||t===s.ShaderInjectionTarget.ALL]))}var n,o,a}));var l=u.map((function(e){var t=s.ShaderInjectionTarget.FRAGMENT;if(e.resource){var r=c.get(e.resource.name);r&&(t=r[0]&&r[1]&&s.ShaderInjectionTarget.ALL||r[0]&&!r[1]&&s.ShaderInjectionTarget.VERTEX||!r[0]&&r[1]&&s.ShaderInjectionTarget.FRAGMENT||t)}return[{name:e.resource.name,shaderInjection:t,size:s.UniformSize.TEXTURE,update:function(){var t=a.getResource(e.resource.key());return t&&t.texture||o.Texture.emptyTexture}},{name:"".concat(e.resource.name,"_size"),shaderInjection:t,size:s.UniformSize.TWO,update:function(){var t=a.getResource(e.resource.key());if(t){var r=t.texture;if(r&&r.data){var n=r.data;return[n.width||1,n.height||1]}}return[1,1]}}]})),f=[];return l.forEach((function(e){return e.forEach((function(e){return f.push(e)}))})),{instanceAttributes:[],vertexAttributes:[],uniforms:f}}}),Object.defineProperty(t.prototype,"validate",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){var i=!1;return t.forEach((function(e){e.easing&&e.resource&&(console.warn("An instance attribute can not have both easing and resource properties. Undefined behavior will occur."),console.warn(e),i=!0)})),!i}}),Object.defineProperty(t.prototype,"processHeaderInjection",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i,o,a){for(var u=0,c=a.length;u<c;++u){var l=a[u],f=l.shaderInjection||s.ShaderInjectionTarget.VERTEX;l.size===s.UniformSize.TEXTURE&&f===e&&this.setDeclaration(t,l.name,"uniform sampler2D ".concat(l.name,";\n"),"TextureIOExpansion")}return{injection:""}}}),t}(a.BaseIOExpansion);t.TextureIOExpansion=u},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleEventHandler=void 0;var o=function(e){function t(t){var r=e.call(this)||this;return Object.assign(r,t),r}return i(t,e),Object.defineProperty(t.prototype,"handleMouseDown",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleMouseUp",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleMouseOver",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleMouseOut",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleMouseMove",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleClick",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleDrag",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleWheel",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleTouchCancelled",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleTouchDown",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleTouchUp",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleTouchOut",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleTouchDrag",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleTap",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleDoubleTap",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleLongTouch",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleLongTap",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handlePinch",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleSpread",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleTouchRotate",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"handleSwipe",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),t}(r(34).EventManager);t.SimpleEventHandler=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.textureUnitToIndex=t.indexToTextureUnit=t.indexToColorAttachment=t.wrapMode=t.stencilBufferFormat=t.depthBufferFormat=t.colorBufferFormat=t.minFilter=t.magFilter=t.inputImageFormat=t.texelFormat=t.drawMode=void 0;var n=r(10),i=r(14);t.drawMode=function(e,t){switch(t){case n.GLSettings.Model.DrawMode.LINES:return e.LINES;case n.GLSettings.Model.DrawMode.LINE_LOOP:return e.LINE_LOOP;case n.GLSettings.Model.DrawMode.LINE_STRIP:return e.LINE_STRIP;case n.GLSettings.Model.DrawMode.POINTS:return e.POINTS;case n.GLSettings.Model.DrawMode.TRIANGLES:return e.TRIANGLES;case n.GLSettings.Model.DrawMode.TRIANGLE_FAN:return e.TRIANGLE_FAN;case n.GLSettings.Model.DrawMode.TRIANGLE_STRIP:return e.TRIANGLE_STRIP;default:return e.TRIANGLES}},t.texelFormat=function(e,t){switch(t){case n.GLSettings.Texture.TexelDataType.Alpha:return e.ALPHA;case n.GLSettings.Texture.TexelDataType.DepthComponent:return e.DEPTH_COMPONENT;case n.GLSettings.Texture.TexelDataType.DepthStencil:return e.DEPTH_STENCIL;case n.GLSettings.Texture.TexelDataType.Luminance:return e.LUMINANCE;case n.GLSettings.Texture.TexelDataType.LuminanceAlpha:return e.LUMINANCE_ALPHA;case n.GLSettings.Texture.TexelDataType.RGB:return e.RGB;case n.GLSettings.Texture.TexelDataType.RGBA:return e.RGBA;default:if(e instanceof WebGL2RenderingContext)switch(t){case n.GLSettings.Texture.TexelDataType.R8:return e.R8;case n.GLSettings.Texture.TexelDataType.R16F:return e.R16F;case n.GLSettings.Texture.TexelDataType.R32F:return e.R32F;case n.GLSettings.Texture.TexelDataType.R8UI:return e.R8UI;case n.GLSettings.Texture.TexelDataType.RG8:return e.RG8;case n.GLSettings.Texture.TexelDataType.RG16F:return e.RG16F;case n.GLSettings.Texture.TexelDataType.RG32F:return e.RG32F;case n.GLSettings.Texture.TexelDataType.RG8UI:return e.RG8UI;case n.GLSettings.Texture.TexelDataType.RG16UI:return e.RG16UI;case n.GLSettings.Texture.TexelDataType.RG32UI:return e.RG32UI;case n.GLSettings.Texture.TexelDataType.RGB8:return e.RGB8;case n.GLSettings.Texture.TexelDataType.SRGB8:return e.SRGB8;case n.GLSettings.Texture.TexelDataType.RGB565:return e.RGB565;case n.GLSettings.Texture.TexelDataType.R11F_G11F_B10F:return e.R11F_G11F_B10F;case n.GLSettings.Texture.TexelDataType.RGB9_E5:return e.RGB9_E5;case n.GLSettings.Texture.TexelDataType.RGB16F:return e.RGB16F;case n.GLSettings.Texture.TexelDataType.RGB32F:return e.RGB32F;case n.GLSettings.Texture.TexelDataType.RGB8UI:return e.RGB8UI;case n.GLSettings.Texture.TexelDataType.RGBA8:return e.RGBA8;case n.GLSettings.Texture.TexelDataType.SRGB8_ALPHA8:return e.SRGB8_ALPHA8;case n.GLSettings.Texture.TexelDataType.RGB5_A1:return e.RGB5_A1;case n.GLSettings.Texture.TexelDataType.RGB10_A2:return e.RGB10_A2;case n.GLSettings.Texture.TexelDataType.RGBA4:return e.RGBA4;case n.GLSettings.Texture.TexelDataType.RGBA16F:return e.RGBA16F;case n.GLSettings.Texture.TexelDataType.RGBA32F:return i.WebGLStat.FLOAT_TEXTURE_READ.full&&i.WebGLStat.FLOAT_TEXTURE_WRITE.full?e.RGBA32F:e.RGBA16F;case n.GLSettings.Texture.TexelDataType.RGBA8UI:return e.RGBA8UI;case n.GLSettings.Texture.TexelDataType.DEPTH_COMPONENT16:return e.DEPTH_COMPONENT16;case n.GLSettings.Texture.TexelDataType.DEPTH_COMPONENT24:return e.DEPTH_COMPONENT24;case n.GLSettings.Texture.TexelDataType.DEPTH_COMPONENT32F:return e.DEPTH_COMPONENT32F;case n.GLSettings.Texture.TexelDataType.RGBA32UI:return e.RGBA32UI;case n.GLSettings.Texture.TexelDataType.RGB32UI:return e.RGB32UI;case n.GLSettings.Texture.TexelDataType.RGBA16UI:return e.RGBA16UI;case n.GLSettings.Texture.TexelDataType.RGB16UI:return e.RGB16UI;case n.GLSettings.Texture.TexelDataType.RGBA32I:return e.RGBA32I;case n.GLSettings.Texture.TexelDataType.RGB32I:return e.RGB32I;case n.GLSettings.Texture.TexelDataType.RGBA16I:return e.RGBA16I;case n.GLSettings.Texture.TexelDataType.RGB16I:return e.RGB16I;case n.GLSettings.Texture.TexelDataType.RGBA8I:return e.RGBA8I;case n.GLSettings.Texture.TexelDataType.RGB8I:return e.RGB8I;default:return console.warn("An unsupported texel format was provided that is not supported in WebGL 1 or 2"),e.RGBA}return console.warn("An Unsupported texel format was provided. Some formats are only available in WebGL 2",t),e.RGBA}},t.inputImageFormat=function(e,t){switch(t){case n.GLSettings.Texture.SourcePixelFormat.Byte:return e.BYTE;case n.GLSettings.Texture.SourcePixelFormat.Float:return e.FLOAT;case n.GLSettings.Texture.SourcePixelFormat.HalfFloat:return console.warn("Unsupported HALF_FLOAT"),e.BYTE;case n.GLSettings.Texture.SourcePixelFormat.Int:return e.INT;case n.GLSettings.Texture.SourcePixelFormat.Short:return e.SHORT;case n.GLSettings.Texture.SourcePixelFormat.UnsignedByte:return e.UNSIGNED_BYTE;case n.GLSettings.Texture.SourcePixelFormat.UnsignedInt:return e.UNSIGNED_INT;case n.GLSettings.Texture.SourcePixelFormat.UnsignedShort:return e.UNSIGNED_SHORT;case n.GLSettings.Texture.SourcePixelFormat.UnsignedShort_4_4_4_4:return e.UNSIGNED_SHORT_4_4_4_4;case n.GLSettings.Texture.SourcePixelFormat.UnsignedShort_5_5_5_1:return e.UNSIGNED_SHORT_5_5_5_1;case n.GLSettings.Texture.SourcePixelFormat.UnsignedShort_5_6_5:return e.UNSIGNED_SHORT_5_6_5;default:return console.warn("An Unsupported input image format was provided",t),e.BYTE}},t.magFilter=function(e,t){switch(t){case n.GLSettings.Texture.TextureMagFilter.Linear:return e.LINEAR;case n.GLSettings.Texture.TextureMagFilter.Nearest:return e.NEAREST}},t.minFilter=function(e,t,r){switch(t){case n.GLSettings.Texture.TextureMinFilter.Linear:return e.LINEAR;case n.GLSettings.Texture.TextureMinFilter.Nearest:return e.NEAREST;case n.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear:return r?e.LINEAR_MIPMAP_LINEAR:e.LINEAR;case n.GLSettings.Texture.TextureMinFilter.LinearMipMapNearest:return r?e.LINEAR_MIPMAP_NEAREST:e.LINEAR;case n.GLSettings.Texture.TextureMinFilter.NearestMipMapLinear:return r?e.NEAREST_MIPMAP_LINEAR:e.NEAREST;case n.GLSettings.Texture.TextureMinFilter.NearestMipMapNearest:return r?e.NEAREST_MIPMAP_NEAREST:e.NEAREST;default:return e.LINEAR}},t.colorBufferFormat=function(e,t){switch(t){case n.GLSettings.RenderTarget.ColorBufferFormat.RGB565:return e.RGB565;case n.GLSettings.RenderTarget.ColorBufferFormat.RGB5_A1:return e.RGB5_A1;case n.GLSettings.RenderTarget.ColorBufferFormat.RGBA4:return e.RGBA4;default:if(e instanceof WebGL2RenderingContext)switch(t){case n.GLSettings.RenderTarget.ColorBufferFormat.R8:return e.R8;case n.GLSettings.RenderTarget.ColorBufferFormat.R8UI:return e.R8UI;case n.GLSettings.RenderTarget.ColorBufferFormat.R8I:return e.R8I;case n.GLSettings.RenderTarget.ColorBufferFormat.R16UI:return e.R16UI;case n.GLSettings.RenderTarget.ColorBufferFormat.R16I:return e.R16I;case n.GLSettings.RenderTarget.ColorBufferFormat.R32UI:return e.R32UI;case n.GLSettings.RenderTarget.ColorBufferFormat.R32I:return e.R32I;case n.GLSettings.RenderTarget.ColorBufferFormat.RG8:return e.RG8;case n.GLSettings.RenderTarget.ColorBufferFormat.RG8UI:return e.RG8UI;case n.GLSettings.RenderTarget.ColorBufferFormat.RG8I:return e.RG8I;case n.GLSettings.RenderTarget.ColorBufferFormat.RG16UI:return e.RG16UI;case n.GLSettings.RenderTarget.ColorBufferFormat.RG16I:return e.RG16I;case n.GLSettings.RenderTarget.ColorBufferFormat.RG32UI:return e.RG32UI;case n.GLSettings.RenderTarget.ColorBufferFormat.RG32I:return e.RG32I;case n.GLSettings.RenderTarget.ColorBufferFormat.RGB8:return e.RGB8;case n.GLSettings.RenderTarget.ColorBufferFormat.RGBA8:return e.RGBA8;case n.GLSettings.RenderTarget.ColorBufferFormat.SRGB8_ALPHA8:return e.SRGB8_ALPHA8;case n.GLSettings.RenderTarget.ColorBufferFormat.RGB10_A2:return e.RGB10_A2;case n.GLSettings.RenderTarget.ColorBufferFormat.RGBA8UI:return e.RGBA8UI;case n.GLSettings.RenderTarget.ColorBufferFormat.RGBA8I:return e.RGBA8I;case n.GLSettings.RenderTarget.ColorBufferFormat.RGB10_A2UI:return e.RGB10_A2UI;case n.GLSettings.RenderTarget.ColorBufferFormat.RGBA16UI:return e.RGBA16UI;case n.GLSettings.RenderTarget.ColorBufferFormat.RGBA16I:return e.RGBA16I;case n.GLSettings.RenderTarget.ColorBufferFormat.RGBA32I:return e.RGBA32I;case n.GLSettings.RenderTarget.ColorBufferFormat.RGBA32UI:return e.RGBA32UI}return e.RGBA4}},t.depthBufferFormat=function(e,t){switch(t){case n.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT16:return e.DEPTH_COMPONENT16;case n.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_STENCIL:return e.DEPTH_STENCIL;default:if(e instanceof WebGL2RenderingContext)switch(t){case n.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT24:return e.DEPTH_COMPONENT24;case n.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT32F:return e.DEPTH_COMPONENT32F;case n.GLSettings.RenderTarget.DepthBufferFormat.DEPTH24_STENCIL8:return e.DEPTH24_STENCIL8;case n.GLSettings.RenderTarget.DepthBufferFormat.DEPTH32F_STENCIL8:return e.DEPTH32F_STENCIL8}return e.DEPTH_COMPONENT16}},t.stencilBufferFormat=function(e,t){switch(t){case n.GLSettings.RenderTarget.StencilBufferFormat.STENCIL_INDEX8:default:return e.STENCIL_INDEX8}},t.wrapMode=function(e,t){switch(t){case n.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE:return e.CLAMP_TO_EDGE;case n.GLSettings.Texture.Wrapping.MIRRORED_REPEAT:return e.MIRRORED_REPEAT;case n.GLSettings.Texture.Wrapping.REPEAT:return e.REPEAT}},t.indexToColorAttachment=function(e,t,r,n,i){if(n)return e.COLOR_ATTACHMENT0;var o=t.drawBuffers;if(i){if(o instanceof WebGL2RenderingContext)switch(r){case-2:return e.BACK;case-1:return e.NONE;case 0:return o.DRAW_BUFFER0;case 1:return o.DRAW_BUFFER1;case 2:return o.DRAW_BUFFER2;case 3:return o.DRAW_BUFFER3;case 4:return o.DRAW_BUFFER4;case 5:return o.DRAW_BUFFER5;case 6:return o.DRAW_BUFFER6;case 7:return o.DRAW_BUFFER7;case 8:return o.DRAW_BUFFER8;case 9:return o.DRAW_BUFFER9;case 10:return o.DRAW_BUFFER10;case 11:return o.DRAW_BUFFER11;case 12:return o.DRAW_BUFFER12;case 13:return o.DRAW_BUFFER13;case 14:return o.DRAW_BUFFER14;case 15:return o.DRAW_BUFFER15;default:console.warn("Attachments are only available for -2 - 15")}else if(o)switch(r){case-2:return e.BACK;case-1:return e.NONE;case 0:return o.DRAW_BUFFER0_WEBGL;case 1:return o.DRAW_BUFFER1_WEBGL;case 2:return o.DRAW_BUFFER2_WEBGL;case 3:return o.DRAW_BUFFER3_WEBGL;case 4:return o.DRAW_BUFFER4_WEBGL;case 5:return o.DRAW_BUFFER5_WEBGL;case 6:return o.DRAW_BUFFER6_WEBGL;case 7:return o.DRAW_BUFFER7_WEBGL;case 8:return o.DRAW_BUFFER8_WEBGL;case 9:return o.DRAW_BUFFER9_WEBGL;case 10:return o.DRAW_BUFFER10_WEBGL;case 11:return o.DRAW_BUFFER11_WEBGL;case 12:return o.DRAW_BUFFER12_WEBGL;case 13:return o.DRAW_BUFFER13_WEBGL;case 14:return o.DRAW_BUFFER14_WEBGL;case 15:return o.DRAW_BUFFER15_WEBGL;default:console.warn("Attachments are only available for 0 - 15")}}else if(o instanceof WebGL2RenderingContext)switch(r){case-2:return e.BACK;case-1:return e.NONE;case 0:return o.COLOR_ATTACHMENT0;case 1:return o.COLOR_ATTACHMENT1;case 2:return o.COLOR_ATTACHMENT2;case 3:return o.COLOR_ATTACHMENT3;case 4:return o.COLOR_ATTACHMENT4;case 5:return o.COLOR_ATTACHMENT5;case 6:return o.COLOR_ATTACHMENT6;case 7:return o.COLOR_ATTACHMENT7;case 8:return o.COLOR_ATTACHMENT8;case 9:return o.COLOR_ATTACHMENT9;case 10:return o.COLOR_ATTACHMENT10;case 11:return o.COLOR_ATTACHMENT11;case 12:return o.COLOR_ATTACHMENT12;case 13:return o.COLOR_ATTACHMENT13;case 14:return o.COLOR_ATTACHMENT14;case 15:return o.COLOR_ATTACHMENT15;default:console.warn("Attachments are only available for -2 - 15")}else if(o)switch(r){case-2:return e.BACK;case-1:return e.NONE;case 0:return o.COLOR_ATTACHMENT0_WEBGL;case 1:return o.COLOR_ATTACHMENT1_WEBGL;case 2:return o.COLOR_ATTACHMENT2_WEBGL;case 3:return o.COLOR_ATTACHMENT3_WEBGL;case 4:return o.COLOR_ATTACHMENT4_WEBGL;case 5:return o.COLOR_ATTACHMENT5_WEBGL;case 6:return o.COLOR_ATTACHMENT6_WEBGL;case 7:return o.COLOR_ATTACHMENT7_WEBGL;case 8:return o.COLOR_ATTACHMENT8_WEBGL;case 9:return o.COLOR_ATTACHMENT9_WEBGL;case 10:return o.COLOR_ATTACHMENT10_WEBGL;case 11:return o.COLOR_ATTACHMENT11_WEBGL;case 12:return o.COLOR_ATTACHMENT12_WEBGL;case 13:return o.COLOR_ATTACHMENT13_WEBGL;case 14:return o.COLOR_ATTACHMENT14_WEBGL;case 15:return o.COLOR_ATTACHMENT15_WEBGL;default:console.warn("Attachments are only available for 0 - 15")}return e.COLOR_ATTACHMENT0},t.indexToTextureUnit=function(e,t){return e.TEXTURE0+t},t.textureUnitToIndex=function(e,t){return t-e.TEXTURE0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderTarget=void 0;var n=r(0),i=r(8),o=r(15),a=function(){function e(e){Object.defineProperty(this,"isInvalid",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_uid",{enumerable:!0,configurable:!0,writable:!0,value:(0,i.uid)()}),Object.defineProperty(this,"_buffers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_height",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_width",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_validFramebuffer",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_disabledTargets",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"retainTextureTargets",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"gl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._buffers={color:Array.isArray(e.buffers.color)?e.buffers.color.slice(0):e.buffers.color,depth:e.buffers.depth,stencil:e.buffers.stencil},this._width=e.width||0,this._height=e.height||0,this.retainTextureTargets=e.retainTextureTargets||!1,this.calculateDimensions()}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffers",{get:function(){return{color:Array.isArray(this._buffers.color)?this._buffers.color.slice(0):this._buffers.color,depth:this._buffers.depth,stencil:this._buffers.stencil}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"validFramebuffer",{get:function(){return this._validFramebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disabledTargets",{get:function(){return this._disabledTargets},set:function(e){this._disabledTargets=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"calculateDimensions",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=[];if(this._buffers.color instanceof o.Texture)e.push(this._buffers.color);else if(Array.isArray(this._buffers.color))for(var t=0,r=this._buffers.color.length;t<r;++t){var n=this._buffers.color[t];n.buffer instanceof o.Texture&&e.push(n.buffer)}else this._buffers.color&&this._buffers.color.buffer instanceof o.Texture&&e.push(this._buffers.color.buffer);if(this._buffers.depth instanceof o.Texture&&e.push(this._buffers.depth),this._buffers.stencil instanceof o.Texture&&e.push(this._buffers.stencil),e.length>0&&e[0].data){var i=e[0].data,a=i.width,s=i.height;for(t=0,r=e.length;t<r;++t){var u=e[t];if(!u.data)return void console.warn("A texture specified for thie RenderTarget did not have any data associated with it.");var c=u.data,l=c.width,f=c.height;l===a&&f===s||(console.warn("Texture applied to the render target is invalid as it does not match dimensions of all textures applied:",u,e,"The texture will be removed as a target for the render target"),this.removeTextureFromBuffer(u))}this._width=a,this._height=s}this._width&&this._height||console.warn("A RenderTarget was not able to establish valid dimensions. This target had no texture buffers and did not specify valid width and height values.",this)}}),Object.defineProperty(e.prototype,"dispose",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.gl&&this.gl.proxy.disposeRenderTarget(this)}}),Object.defineProperty(e.prototype,"getBuffers",{enumerable:!1,configurable:!0,writable:!0,value:function(){return Array.isArray(this.buffers.color)?this.buffers.color:this.buffers.color?[this.buffers.color]:[]}}),Object.defineProperty(e.prototype,"getGLBuffers",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.gl?Array.isArray(this.gl.colorBufferId)?this.gl.colorBufferId:[this.gl.colorBufferId]:(this.isInvalid||console.warn("Attempted to retrieve gl buffers before the render target was compiled."),[])}}),Object.defineProperty(e.prototype,"getOutputTypes",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.getBuffers().map((function(e){return e.outputType}))}}),Object.defineProperty(e.prototype,"getSize",{enumerable:!1,configurable:!0,writable:!0,value:function(){return[this._width,this._height]}}),Object.defineProperty(e.prototype,"getTextures",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=[];return Array.isArray(this.buffers.color)?this.buffers.color.forEach((function(t){t.buffer instanceof o.Texture&&e.push(t.buffer)})):this.buffers.color&&this.buffers.color.buffer instanceof o.Texture&&e.push(this.buffers.color.buffer),this.buffers.depth instanceof o.Texture&&e.push(this.buffers.depth),this.buffers.stencil instanceof o.Texture&&e.push(this.buffers.stencil),e}}),Object.defineProperty(e.prototype,"isColorTarget",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e;return Array.isArray(this.buffers.color)?1===this.buffers.color.length&&this.buffers.color[0].outputType===n.FragmentOutputType.COLOR:(null===(e=this.buffers.color)||void 0===e?void 0:e.outputType)===n.FragmentOutputType.COLOR}}),Object.defineProperty(e.prototype,"removeTextureFromBuffer",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t;if(Array.isArray(this._buffers.color)){var r=this._buffers.color.find((function(t){return t.buffer===e}));if(!r)return;var n=this._buffers.color.indexOf(r);n>-1&&this._buffers.color.splice(n,1)}else(null===(t=this._buffers.color)||void 0===t?void 0:t.buffer)===e&&delete this._buffers.color;this._buffers.depth===e&&delete this._buffers.depth,this._buffers.stencil===e&&delete this._buffers.stencil}}),Object.defineProperty(e.prototype,"setSize",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this.dispose(),this._width=e,this._height=t,this.getTextures().forEach((function(r){r.data={buffer:null,height:t,width:e}}))}}),Object.defineProperty(e.prototype,"setAsValid",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._validFramebuffer=!0}}),e}();t.RenderTarget=a},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(74),t),i(r(7),t)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleProjection=t.BaseProjection=void 0;var o=r(8),a=r(7),s=r(2),u=function(){function e(){Object.defineProperty(this,"_uid",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.uid)()}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"pixelRatio",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"viewBounds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_screenScale",{enumerable:!0,configurable:!0,writable:!0,value:[1,1]}),Object.defineProperty(this,"_screenBounds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_scaledScreenBounds",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenBounds",{get:function(){return this._scaledScreenBounds||(this._scaledScreenBounds=new a.Bounds({x:this._screenBounds.x*this._screenScale[0],y:this._screenBounds.y*this._screenScale[1],width:this._screenBounds.width*this._screenScale[0],height:this._screenBounds.height*this._screenScale[1]})),this._scaledScreenBounds},set:function(e){delete this._scaledScreenBounds,this._screenBounds=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenScale",{get:function(){return this._screenScale},set:function(e){(0,s.compare2)(e,this._screenScale)||(delete this._scaledScreenBounds,this._screenScale=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"screenToRenderSpace",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return t=this.screenToView(e,t),(0,s.apply2)(t,e[0]*this.pixelRatio,e[1]*this.pixelRatio)}}),Object.defineProperty(e.prototype,"renderSpaceToScreen",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return t=t||[0,0],(0,s.apply2)(t,e[0]/this.pixelRatio-this.screenBounds.x,e[1]/this.pixelRatio-this.screenBounds.y)}}),Object.defineProperty(e.prototype,"screenToView",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return t=t||[0,0],(0,s.apply2)(t,e[0]-this.screenBounds.x,e[1]-this.screenBounds.y)}}),Object.defineProperty(e.prototype,"viewToScreen",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return t=t||[0,0],(0,s.apply2)(t,e[0]+this.screenBounds.x,e[1]+this.screenBounds.y)}}),e}();t.BaseProjection=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"screenToWorld",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return e}}),Object.defineProperty(t.prototype,"screenRay",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return[[0,0,-1],[0,0,-2]]}}),Object.defineProperty(t.prototype,"worldToScreen",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return e}}),Object.defineProperty(t.prototype,"viewToWorld",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return e}}),Object.defineProperty(t.prototype,"worldToView",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return e}}),t}(u);t.SimpleProjection=c},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(76),t),i(r(144),t),i(r(145),t)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderTexture=t.isRenderTextureResource=t.createTexture=void 0;var a=r(15),s=r(0),u=r(17);t.createTexture=function(e){return o({key:"",type:s.ResourceType.TEXTURE},e)},t.isRenderTextureResource=function(e){return e&&void 0!==e.key&&e.type===s.ResourceType.TEXTURE};var c=function(e){function t(t,r){var n=e.call(this,t)||this;return Object.defineProperty(n,"type",{enumerable:!0,configurable:!0,writable:!0,value:s.ResourceType.TEXTURE}),Object.defineProperty(n,"height",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"width",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"textureSettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"texture",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n.height=t.height,n.width=t.width,n.textureSettings=t.textureSettings,n.createTexture(r),n}return i(t,e),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.texture.destroy()}}),Object.defineProperty(t.prototype,"createTexture",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t;if(!this.texture){var r,n;this.textureSettings=o({generateMipMaps:!0,premultiplyAlpha:!1},this.textureSettings);var i=(null==e?void 0:e.getRenderSize())||[1,1];if(this.width<=s.TextureSize.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");r=i[0]/-this.width}else r=this.width;if(this.height<=s.TextureSize.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");n=i[1]/-this.width}else n=this.height;this.texture=new a.Texture(o({data:(null===(t=this.textureSettings)||void 0===t?void 0:t.data)||{width:r,height:n,buffer:null}},this.textureSettings))}}}),t}(u.IdentifyByKey);t.RenderTexture=c},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.textureRequest=void 0;var i=r(0);t.textureRequest=function(e){return n({type:i.ResourceType.TEXTURE},e)}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.IdentityTransform=t.Transform=void 0;var o=r(12),a=r(53),s=function(e){function t(t){var r=e.call(this)||this;return Object.defineProperty(r,"isQueuedForUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(r,"needsWorldOrientation",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(r,"needsWorldDecomposition",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(r,"hasViewMatrix",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(r,"_instance",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(r,"_matrix",{enumerable:!0,configurable:!0,writable:!0,value:{value:(0,o.identity4)()}}),Object.defineProperty(r,"_localMatrix",{enumerable:!0,configurable:!0,writable:!0,value:{value:r._matrix.value}}),Object.defineProperty(r,"_viewMatrix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"_localViewMatrix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"_localTransform",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"_localViewTransform",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"_rotation",{enumerable:!0,configurable:!0,writable:!0,value:{value:(0,o.oneQuat)()}}),Object.defineProperty(r,"_localRotation",{enumerable:!0,configurable:!0,writable:!0,value:{value:r._rotation.value}}),Object.defineProperty(r,"localRotationMatrix",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.identity3)()}),Object.defineProperty(r,"_scale",{enumerable:!0,configurable:!0,writable:!0,value:{value:[1,1,1]}}),Object.defineProperty(r,"_localScale",{enumerable:!0,configurable:!0,writable:!0,value:{value:r._scale.value}}),Object.defineProperty(r,"_position",{enumerable:!0,configurable:!0,writable:!0,value:{value:[0,0,0]}}),Object.defineProperty(r,"_localPosition",{enumerable:!0,configurable:!0,writable:!0,value:{value:r._position.value}}),Object.defineProperty(r,"_forward",{enumerable:!0,configurable:!0,writable:!0,value:{value:(0,o.forward3)()}}),Object.defineProperty(r,"_localForward",{enumerable:!0,configurable:!0,writable:!0,value:{value:r._forward.value}}),Object.defineProperty(r,"needsForwardUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),t?(t.localPosition&&(r.localPosition=t.localPosition),t.localRotation&&(r.localRotation=t.localRotation),t.localScale&&(r.localScale=t.localScale),t.parent&&(r.parent=t.parent),r):r}return i(t,e),Object.defineProperty(t.prototype,"instance",{set:function(e){this._instance!==e&&this._instance&&(this._instance.transform.instance=null,e&&(e.transform=this)),this._instance=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matrix",{get:function(){return this.update(),this._matrix.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localMatrix",{get:function(){return this.update(),this._localMatrix.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewMatrix",{get:function(){return this.hasViewMatrix=!0,void 0===this._viewMatrix&&this.invalidate(),this.update(),void 0===this._viewMatrix?(0,o.identity4)():this._viewMatrix.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localViewMatrix",{get:function(){return this.hasViewMatrix=!0,void 0===this._localViewMatrix&&this.invalidate(),this.update(),void 0===this._localViewMatrix?(0,o.identity4)():this._localViewMatrix.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localTransform",{get:function(){var e;return null===(e=this._localTransform)||void 0===e?void 0:e.value},set:function(e){e?(this._localTransform||(this._localTransform={value:(0,o.identity4)()}),(0,o.copy4x4)(e,this._localTransform.value),this._localTransform.didUpdate=!0):delete this._localTransform,this.invalidate()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localViewTransform",{get:function(){var e;return null===(e=this._localViewTransform)||void 0===e?void 0:e.value},set:function(e){e?(this._localViewTransform||(this._localViewTransform={value:(0,o.identity4)()}),(0,o.copy4x4)(e,this._localViewTransform.value),this._localViewTransform.didUpdate=!0):delete this._localViewTransform,this.invalidate()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.needsWorldOrientation=!0,this.update(),this._rotation.value},set:function(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world rotation when a parent is present is not supported yet. Use localRotation for now."):this.localRotation=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localRotation",{get:function(){return this._localRotation.value},set:function(e){(0,o.apply4)(this._localRotation.value,e[0],e[1],e[2],e[3]),this._localRotation.didUpdate=!0,this.invalidate(),this.needsForwardUpdate=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.needsWorldOrientation=!0,this.update(),this._scale.value},set:function(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world scale is not supported yet. Use localScale for now."):this.localScale=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localScale",{get:function(){return this._localScale.value},set:function(e){(0,o.apply3)(this._localScale.value,e[0],e[1],e[2]),this._localScale.didUpdate=!0,this.invalidate()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.needsWorldOrientation=!0,this.update(),this._position.value},set:function(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world position is not supported yet. Use localPosition for now."):this.localPosition=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localPosition",{get:function(){return this._localPosition.value},set:function(e){this._localPosition.value[0]=e[0],this._localPosition.value[1]=e[1],this._localPosition.value[2]=e[2],this._localPosition.didUpdate=!0,this.invalidate()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forward",{get:function(){var e;return(this.needsForwardUpdate||(null===(e=this.parent)||void 0===e?void 0:e.childUpdate.has(this)))&&(this.needsForwardUpdate=!1,(0,o.rotateVectorByUnitQuat)((0,o.forward3)(),this._rotation.value,this._forward.value)),this._forward.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localForward",{get:function(){return this.needsForwardUpdate&&(this.needsForwardUpdate=!1,(0,o.rotateVectorByUnitQuat)((0,o.forward3)(),this._localRotation.value,this._localForward.value)),this._localForward.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"applyLocalSRT",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){this._localScale.value=e,this._localPosition.value=r,this._localRotation.value=t,this._localScale.didUpdate=!0,this._localPosition.didUpdate=!0,this._localRotation.didUpdate=!0,this.invalidate(),this._instance&&(this._instance.transform=this)}}),Object.defineProperty(t.prototype,"decomposeWorldMatrix",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this.needsWorldDecomposition&&this.parent&&this._matrix.didUpdate&&this._matrix.value!==this._localMatrix.value){if(this._instance){if(!this._instance.needsWorldUpdate||!this.needsWorldOrientation)return}else if(!this.needsWorldOrientation)return;this.needsWorldDecomposition=!1;var e=this._matrix.value,t=this._position.value,r=this._scale.value;this._position.didUpdate=t[0]!==e[12]||t[1]!==e[13]||t[2]!==e[14],this._position.didUpdate&&(0,o.apply3)(t,e[12],e[13],e[14]);var n=(0,o.length4Components)(e[0],e[1],e[2],e[3]),i=(0,o.length4Components)(e[4],e[5],e[6],e[7]),a=(0,o.length4Components)(e[8],e[9],e[10],e[11]);this._scale.didUpdate=r[0]!==n||r[1]!==i||r[2]!==a,(0,o.apply3)(r,n,i,a),this._scale.didUpdate=!0;var s=this._rotation.value,u=s[0],c=s[1],l=s[2],f=s[3];(0,o.decomposeRotation)(this._matrix.value,n,i,a,this._rotation.value);var d=this._rotation.value;this._rotation.didUpdate=d[0]!==u||d[1]!==c||d[2]!==l||d[3]!==f}}}),Object.defineProperty(t.prototype,"lookAtLocal",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){(0,o.lookAtQuat)((0,o.subtract3)(e,this._localPosition.value,o.V3R[0]),t||[0,1,0],this._localRotation.value),this._localRotation.didUpdate=!0,this.invalidate(),this.needsForwardUpdate=!0}}),Object.defineProperty(t.prototype,"divideMemory",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._forward.value=(0,o.forward3)(),this._matrix.value=(0,o.identity4)(),this._rotation.value=(0,o.oneQuat)(),this._scale.value=[1,1,1],this._position.value=[0,0,0],this.hasViewMatrix&&this._viewMatrix&&this._localViewMatrix&&(this._viewMatrix.value=(0,o.identity4)())}}),Object.defineProperty(t.prototype,"mergeMemory",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._forward.value=this._localForward.value,this._matrix.value=this._localMatrix.value,this._rotation.value=this._localRotation.value,this._scale.value=this._localScale.value,this._position.value=this._localPosition.value,this.hasViewMatrix&&this._viewMatrix&&this._localViewMatrix&&(this._viewMatrix.value=this._localViewMatrix.value)}}),Object.defineProperty(t.prototype,"setParent",{enumerable:!1,configurable:!0,writable:!0,value:function(t,r){t!==this.parent&&(t?this.parent||this.divideMemory():this.mergeMemory(),this.invalidate(),this.needsForwardUpdate=!0,this._localScale.didUpdate=!0,this._localRotation.didUpdate=!0,this._localPosition.didUpdate=!0,e.prototype.setParent.call(this,t,r))}}),Object.defineProperty(t.prototype,"invalidate",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.queueForUpdate(),e.prototype.invalidate.call(this)}}),Object.defineProperty(t.prototype,"optimize",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.needsWorldOrientation=!1}}),Object.defineProperty(t.prototype,"queueForUpdate",{enumerable:!1,configurable:!0,writable:!0,value:function(){!this.isQueuedForUpdate&&this._instance&&this._instance.active&&(this.isQueuedForUpdate=!0,(0,a.scheduleUpdate)(this))}}),Object.defineProperty(t.prototype,"update",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=!1;if(this.isQueuedForUpdate&&((0,a.resolveUpdate)(this),this.isQueuedForUpdate=!1),this.needsUpdate){var r=this.localRotationMatrix;this._localRotation.didUpdate&&(0,o.matrix3x3FromUnitQuatModel)(this._localRotation.value,r),this._localTransform?((0,o.SRT4x4)(this._localScale.value,r,this._localPosition.value,o.M4R[0]),(0,o.multiply4x4)(this._localTransform.value,o.M4R[0],this._localMatrix.value)):(0,o.SRT4x4)(this._localScale.value,r,this._localPosition.value,this._localMatrix.value),this._localMatrix.didUpdate=!0,t=!0,this.hasViewMatrix&&(void 0===this._viewMatrix&&(this._viewMatrix={value:(0,o.identity4)()}),void 0===this._localViewMatrix&&(this.parent?this._localViewMatrix={value:(0,o.identity4)()}:this._localViewMatrix={value:this._viewMatrix.value}),this._localViewTransform?((0,o.TRS4x4)((0,o.inverse3)(this._localScale.value,o.V3R[0]),(0,o.transpose3x3)(r,o.M3R[1]),(0,o.scale3)(this._localPosition.value,-1,o.V3R[1]),o.M4R[0]),(0,o.multiply4x4)(this._localViewTransform.value,o.M4R[0],this._localViewMatrix.value)):(0,o.TRS4x4)((0,o.inverse3)(this._localScale.value,o.V3R[0]),(0,o.transpose3x3)(r,o.M3R[1]),(0,o.scale3)(this._localPosition.value,-1,o.V3R[1]),this._localViewMatrix.value),this._localViewMatrix.didUpdate=!0)}this.parent&&(this.parent.needsUpdate?(e||this.processParentUpdates((function(e){e.update(!0)})),t=!0):this.parent.childUpdate.has(this)&&(t=!0),t&&((0,o.multiply4x4)(this.parent._matrix.value,this._localMatrix.value,this._matrix.value),this._matrix.didUpdate=!0,this.needsWorldDecomposition=!0,this.hasViewMatrix&&this._viewMatrix&&this._localViewMatrix&&(this.parent.hasViewMatrix&&this.parent._viewMatrix&&this.parent._localViewMatrix?(0,o.multiply4x4)(this.parent._viewMatrix.value,this._localViewMatrix.value,this._viewMatrix.value):((0,o.matrix3x3FromUnitQuatModel)(this.parent.rotation,o.M3R[0]),(0,o.TRS4x4)((0,o.inverse3)(this.parent._scale.value,o.V3R[0]),(0,o.transpose3x3)(o.M3R[0],o.M3R[1]),(0,o.scale3)(this.parent._position.value,-1,o.V3R[1]),o.M4R[0]),(0,o.multiply4x4)(this._localViewMatrix.value,o.M4R[0],this._viewMatrix.value)),this._viewMatrix.didUpdate=!0))),this.decomposeWorldMatrix(),this._instance&&this._instance.active&&(this._localMatrix.didUpdate||this._matrix.didUpdate)&&(this._instance.needsLocalUpdate&&(this._localRotation.didUpdate&&(this._instance._localRotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._localPosition=this._localPosition.value),this._localScale.didUpdate&&(this._instance._localScale=this._localScale.value)),this._instance.needsWorldUpdate&&(this.parent?(this._rotation.didUpdate&&(this._instance._rotation=this._rotation.value),this._scale.didUpdate&&(this._instance._scale=this._scale.value),this._position.didUpdate&&(this._instance._position=this._position.value)):(this._localRotation.didUpdate&&(this._instance._rotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._position=this._localPosition.value),this._localScale.didUpdate&&(this._instance._scale=this._localScale.value))),this._matrix.didUpdate&&(this._instance._matrix=this._matrix.value),this._localMatrix.didUpdate&&(this._instance._localMatrix=this._localMatrix.value,this.parent||(this._instance._matrix=this._matrix.value))),this._localScale.didUpdate=!1,this._localRotation.didUpdate=!1,this._localPosition.didUpdate=!1,this._rotation.didUpdate=!1,this._scale.didUpdate=!1,this._position.didUpdate=!1,this._matrix.didUpdate=!1,this._localMatrix.didUpdate=!1,this.resolve()}}),t}(r(54).TreeNode);t.Transform=s,t.IdentityTransform=new s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AutoEasingMethod=t.AutoEasingLoopStyle=void 0;var n,i=r(8),o=r(2),a=Math.min,s=Math.max,u=Math.pow,c=Math.round,l=Math.sin,f=Math.PI,d=c(1e3*f)/1e3;function p(e,t,r){return a(s(e,t),r)}!function(e){e[e.NONE=1]="NONE",e[e.CONTINUOUS=4]="CONTINUOUS",e[e.REPEAT=2]="REPEAT",e[e.REFLECT=3]="REFLECT"}(n=t.AutoEasingLoopStyle||(t.AutoEasingLoopStyle={}));var h="\n${easingMethod} {\n  float p = 0.3;\n  float time = pow(2.0, -10.0 * t) * sin((t - p / 4.0) * (2.0 * ".concat(d,") / p) + 1.0;\n  return (end - start) * time + start;\n}\n"),b="\n${easingMethod} {\n  float time = t * t * t - t * 1.05 * sin(t * ".concat(d,");\n  return (end - start) * time + start;\n}\n"),g="\n${easingMethod} {\n  ${T} direction = end - start;\n  return start + direction * 0.5 + direction * sin(t * ".concat(d," * 2.0) * 0.5;\n}\n"),v="\n${easingMethod} {\n  float p = 0.3;\n  float time = pow(2.0, -10.0 * t) * sin((t - p / 4.0) * (2.0 * ".concat(d,") / p) + 1.0;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n"),y="\n${easingMethod} {\n  float time = t * t * t - t * 1.05 * sin(t * ".concat(d,");\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n"),m=function(){function e(e,t,r,o){Object.defineProperty(this,"uid",{enumerable:!0,configurable:!0,writable:!0,value:(0,i.uid)()}),Object.defineProperty(this,"cpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"delay",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"duration",{enumerable:!0,configurable:!0,writable:!0,value:500}),Object.defineProperty(this,"gpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loop",{enumerable:!0,configurable:!0,writable:!0,value:n.NONE}),Object.defineProperty(this,"methodName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cpu=e,this.gpu=t,this.duration=r||500,this.methodName=o||"easingMethod"}return Object.defineProperty(e,"immediate",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){return(0,(0,o.VecMath)(e).copy)(t,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  return end;\n}\n",loop:r,methodName:"immediate"}}}),Object.defineProperty(e,"linear",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){var i=(0,o.VecMath)(e),a=i.add,s=i.scale,u=i.subtract;return r=p(r,0,1),a(s(u(t,e),r),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  return (end - start) * t + start;\n}\n",loop:r,methodName:"linear"}}}),Object.defineProperty(e,"easeInQuad",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){var i=(r=p(r,0,1))*r,a=(0,o.VecMath)(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t;\n  return (end - start) * time + start;\n}\n",loop:r,methodName:"easeInQuad"}}}),Object.defineProperty(e,"easeOutQuad",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){var i=(r=p(r,0,1))*(2-r),a=(0,o.VecMath)(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * (2.0 - t);\n  return (end - start) * time + start;\n}\n",loop:r,methodName:"easeOutQuad"}}}),Object.defineProperty(e,"easeInOutQuad",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){var i=(r=p(r,0,1))<.5?2*r*r:(4-2*r)*r-1,a=(0,o.VecMath)(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t < 0.5 ? 2.0 * t * t : -1.0 + (4.0 - 2.0 * t) * t;\n  return (end - start) * time + start;\n}\n",loop:r,methodName:"easeInOutQuad"}}}),Object.defineProperty(e,"easeInCubic",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){var i=(r=p(r,0,1))*r*r,a=(0,o.VecMath)(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t;\n  return (end - start) * time + start;\n}\n",loop:r,methodName:"easeInCubic"}}}),Object.defineProperty(e,"easeOutCubic",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){r=p(r,0,1);var i=--r*r*r+1,a=(0,o.VecMath)(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t1 * t1 * t1 + 1.0;\n  return (end - start) * time + start;\n}\n",loop:r,methodName:"easeOutCubic"}}}),Object.defineProperty(e,"easeInOutCubic",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){var i=(r=p(r,0,1))<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1,a=(0,o.VecMath)(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t < 0.5 ? 4.0 * t * t * t : (t - 1.0) * (2.0 * t - 2.0) * (2.0 * t - 2.0) + 1.0;\n  return (end - start) * time + start;\n}\n",loop:r,methodName:"easeInOutCubic"}}}),Object.defineProperty(e,"easeInQuart",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){var i=(r=p(r,0,1))*r*r*r,a=(0,o.VecMath)(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t * t;\n  return (end - start) * time + start;\n}\n",loop:r,methodName:"easeInQuart"}}}),Object.defineProperty(e,"easeOutQuart",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){r=p(r,0,1);var i=1- --r*r*r*r,a=(0,o.VecMath)(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = 1.0 - t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:r,methodName:"easeOutQuart"}}}),Object.defineProperty(e,"easeInOutQuart",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){var i=(r=p(r,0,1))<.5?8*r*r*r*r:1-8*--r*r*r*r,a=(0,o.VecMath)(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t < 0.5 ? 8.0 * t * t * t * t : 1.0 - 8.0 * t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:r,methodName:"easeInOutQuart"}}}),Object.defineProperty(e,"easeInQuint",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){var i=(r=p(r,0,1))*r*r*r*r,a=(0,o.VecMath)(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t * t * t;\n  return (end - start) * time + start;\n}\n",loop:r,methodName:"easeInQuint"}}}),Object.defineProperty(e,"easeOutQuint",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){r=p(r,0,1);var i=1+--r*r*r*r*r,a=(0,o.VecMath)(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = 1.0 + t1 * t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:r,methodName:"easeOutQuint"}}}),Object.defineProperty(e,"easeInOutQuint",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){var i=(r=p(r,0,1))<.5?16*r*r*r*r*r:1+16*--r*r*r*r*r,a=(0,o.VecMath)(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t < 0.5 ? 16.0 * t * t * t * t * t : 1.0 + 16.0 * t1 * t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:r,methodName:"easeInOutQuint"}}}),Object.defineProperty(e,"easeOutElastic",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){r=p(r,0,1);var i=u(2,-10*r)*l(2*f*(r-.075)/.3)+1,a=(0,o.VecMath)(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,n)},delay:t,duration:e,gpu:h,loop:r,methodName:"easeOutElastic"}}}),Object.defineProperty(e,"easeBackIn",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){var i=(r=p(r,0,1))*r*r-1.05*r*l(r*f),a=(0,o.VecMath)(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,n)},delay:t,duration:e,gpu:b,loop:r,methodName:"easeBackIn"}}}),Object.defineProperty(e,"easeBackOut",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){var i=(r=p(r,0,1))-1,a=i*i*(2.7*i+1.7)+1,s=(0,o.VecMath)(e);return(0,s.add)((0,s.scale)((0,s.subtract)(t,e),a),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float a = 1.7;\n  float time = (t1 * t1 * ((a + 1.0) * t1 + a) + 1.0);\n  return (end - start) * time + start;\n}\n",loop:r,methodName:"easeBackOut"}}}),Object.defineProperty(e,"easeBackInOut",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){var i=2.5925,a=(r=p(r,0,1))/.5,s=a-2,u=a<1?.5*(a*a*(i+1)*a-i):.5*(s*s*((i+1)*s+i)+2),c=(0,o.VecMath)(e);return(0,c.add)((0,c.scale)((0,c.subtract)(t,e),u),e,n)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float a = 1.4;\n  float a1 = a * 1.525;\n  float t1 = t / 0.5;\n  float t2 = t1 - 2.0;\n  float time =\n    (t1 < 1.0) ? 0.5 * (t1 * t1 * (a1 + 1.0) * t1 - a1) :\n    0.5 * (t2 * t2 * ((a1 + 1.0) * t2 + a1) + 2.0)\n  ;\n\n  return (end - start) * time + start;\n}\n",loop:r,methodName:"easeBackInOut"}}}),Object.defineProperty(e,"continuousSinusoidal",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.CONTINUOUS),{uid:(0,i.uid)(),cpu:function(e,t,r,n){var i=(0,o.VecMath)(e),a=i.add,s=i.scale,u=i.subtract;r=p(r,0,1);var c=s(u(t,e),.5);return a(a(e,c),s(c,1*l(r*f*2)),n)},delay:t,duration:e,gpu:g,loop:r,methodName:"repeatingSinusoidal",validation:{ignoreEndValueCheck:!0,ignoreOverTimeCheck:!0}}}}),Object.defineProperty(e,"slerpQuatLinear",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}r=p(r,0,1);var a=(0,o.VecMath)(e),s=a.slerpQuat,u=a.vec;return s?s(e,t,r,n):u(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - t, t),\n    vec2(sin((1.0 - t) * omega) / sinom, sin(t * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatLinear"}}}),Object.defineProperty(e,"slerpQuatInQuad",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(r=p(r,0,1))*r,s=(0,o.VecMath)(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,n):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatInQuad"}}}),Object.defineProperty(e,"slerpQuatOutQuad",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(r=p(r,0,1))*(2-r),s=(0,o.VecMath)(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,n):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * (2.0 - t);\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatOutQuad"}}}),Object.defineProperty(e,"slerpQuatInOutQuad",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(r=p(r,0,1))<.5?2*r*r:(4-2*r)*r-1,s=(0,o.VecMath)(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,n):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t < 0.5 ? 2.0 * t * t : -1.0 + (4.0 - 2.0 * t) * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatInOutQuad"}}}),Object.defineProperty(e,"slerpQuatInCubic",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(r=p(r,0,1))*r*r,s=(0,o.VecMath)(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,n):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatInCubic"}}}),Object.defineProperty(e,"slerpQuatOutCubic",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}r=p(r,0,1);var a=--r*r*r+1,s=(0,o.VecMath)(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,n):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t1 * t1 * t1 + 1.0;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatOutCubic"}}}),Object.defineProperty(e,"slerpQuatInOutCubic",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(r=p(r,0,1))<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1,s=(0,o.VecMath)(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,n):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t < 0.5 ? 4.0 * t * t * t : (t - 1.0) * (2.0 * t - 2.0) * (2.0 * t - 2.0) + 1.0;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatInOutCubic"}}}),Object.defineProperty(e,"slerpQuatInQuart",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(r=p(r,0,1))*r*r*r,s=(0,o.VecMath)(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,n):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatInQuart"}}}),Object.defineProperty(e,"slerpQuatOutQuart",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}r=p(r,0,1);var a=1- --r*r*r*r,s=(0,o.VecMath)(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,n):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = 1.0 - t1 * t1 * t1 * t1;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatOutQuart"}}}),Object.defineProperty(e,"slerpQuatInOutQuart",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(r=p(r,0,1))<.5?8*r*r*r*r:1-8*--r*r*r*r,s=(0,o.VecMath)(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,n):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t < 0.5 ? 8.0 * t * t * t * t : 1.0 - 8.0 * t1 * t1 * t1 * t1;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatInOutQuart"}}}),Object.defineProperty(e,"slerpQuatInQuint",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(r=p(r,0,1))*r*r*r*r,s=(0,o.VecMath)(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,n):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t * t * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatInQuint"}}}),Object.defineProperty(e,"slerpQuatOutQuint",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}r=p(r,0,1);var a=1+--r*r*r*r*r,s=(0,o.VecMath)(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,n):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = 1.0 + t1 * t1 * t1 * t1 * t1;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatOutQuint"}}}),Object.defineProperty(e,"slerpQuatInOutQuint",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(r=p(r,0,1))<.5?16*r*r*r*r*r:1+16*--r*r*r*r*r,s=(0,o.VecMath)(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,n):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t < 0.5 ? 16.0 * t * t * t * t * t : 1.0 + 16.0 * t1 * t1 * t1 * t1 * t1;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatInOutQuint"}}}),Object.defineProperty(e,"slerpQuatOutElastic",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}r=p(r,0,1);var a=u(2,-10*r)*l(2*f*(r-.075)/.3)+1,s=(0,o.VecMath)(e),c=s.slerpQuat,d=s.vec;return c?c(e,t,a,n):d(1,0,0,0)},delay:t,duration:e,gpu:v,loop:r,methodName:"slerpQuatOutElastic"}}}),Object.defineProperty(e,"slerpQuatBackIn",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(r=p(r,0,1))*r*r-1.05*r*l(r*f),s=(0,o.VecMath)(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,n):c(1,0,0,0)},delay:t,duration:e,gpu:y,loop:r,methodName:"slerpQuatBackIn"}}}),Object.defineProperty(e,"slerpQuatBackOut",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(r=p(r,0,1))-1,s=a*a*(2.7*a+1.7)+1,u=(0,o.VecMath)(e),c=u.slerpQuat,l=u.vec;return c?c(e,t,s,n):l(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float a = 1.7;\n  float time = (t1 * t1 * ((a + 1.0) * t1 + a) + 1.0);\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatBackOut"}}}),Object.defineProperty(e,"slerpQuatBackInOut",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=n.NONE),{uid:(0,i.uid)(),cpu:function(e,t,r,n){if(!(0,o.isVec4)(e)||!(0,o.isVec4)(t)||!(0,o.isVec4)(n)){var i=(0,o.VecMath)(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=2.5925,s=(r=p(r,0,1))/.5,u=s-2,c=s<1?.5*(s*s*(a+1)*s-a):.5*(u*u*((a+1)*u+a)+2),l=(0,o.VecMath)(e),f=l.slerpQuat,d=l.vec;return f?f(e,t,c,n):d(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float a = 1.4;\n  float a1 = a * 1.525;\n  float t1 = t / 0.5;\n  float t2 = t1 - 2.0;\n  float time =\n    (t1 < 1.0) ? 0.5 * (t1 * t1 * (a1 + 1.0) * t1 - a1) :\n    0.5 * (t2 * t2 * ((a1 + 1.0) * t2 + a1) + 2.0)\n  ;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:r,methodName:"slerpQuatBackInOut"}}}),e}();t.AutoEasingMethod=m},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveUpdate=t.scheduleUpdate=void 0;var o=r(28),a=new Set;t.scheduleUpdate=a.add.bind(a),t.resolveUpdate=a.delete.bind(a);!function e(){return n(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,(0,o.onAnimationLoop)((function(){0!==a.size&&(a.forEach((function(e){return e.update()})),a.clear())}),void 0,Number.POSITIVE_INFINITY)];case 1:return t.sent(),e(),[2]}}))}))}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TreeNode=void 0;var n=function(){function e(){Object.defineProperty(this,"_parent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_children",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_needsUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_childUpdate",{enumerable:!0,configurable:!0,writable:!0,value:new Set})}return Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){this.setParent(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needsUpdate",{get:function(){return this._needsUpdate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"childUpdate",{get:function(){return this._childUpdate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"addChild",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){e.parent!==this&&(t||e.setParent(this,!0),this._children.push(e),this._childUpdate.add(e),e.invalidate())}}),Object.defineProperty(e.prototype,"invalidate",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this._needsUpdate)return!1;this._needsUpdate=!0;for(var e=0,t=this._children.length;e<t;++e){var r=this._children[e];this._childUpdate.add(r),r.invalidate()}return!0}}),Object.defineProperty(e.prototype,"processParentUpdates",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this._parent&&this._parent._needsUpdate){for(var t=[],r=this._parent;r&&(t.push(r),r._parent&&r._parent.needsUpdate);)r=r._parent;for(var n=t.length-1;n>=0;--n){var i=t[n];e(i),i.resolve()}}}}),Object.defineProperty(e.prototype,"removeChild",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){e._parent===this&&(void 0===e._parent||t||e.setParent(void 0,!0),this._children.splice(this._children.indexOf(e),1),this._childUpdate.delete(e))}}),Object.defineProperty(e.prototype,"resolve",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._needsUpdate&&(this._needsUpdate=!1,this._parent&&this._parent._childUpdate.delete(this))}}),Object.defineProperty(e.prototype,"setParent",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this._parent!==e&&(t||(void 0!==e&&e.addChild(this,!0),this._parent&&this._parent.removeChild(this,!0)),this._parent=e,this.invalidate())}}),e}();t.TreeNode=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.touchesContainsStartView=t.touchesHasStartView=t.isDefined=void 0,t.isDefined=function(e){return null!=e},t.touchesHasStartView=function(e){return Array.isArray(e)?function(t){return e.indexOf(t.start.view.id)>=0}:function(t){return t.start.view.id===e}},t.touchesContainsStartView=function(e){return Array.isArray(e)?function(t){return t.start.views.find((function(t){return e.indexOf(t.view.id)>=0}))}:function(t){return t.start.views.find((function(t){return t.view.id===e}))}}},function(e,t,r){"use strict";function n(e){return e&&void 0!==e.call&&void 0!==e.apply}Object.defineProperty(t,"__esModule",{value:!0}),t.mapGetWithDefault=t.mapInjectDefault=void 0,t.mapInjectDefault=function(e,t,r){var i=e.get(t);return void 0===i&&(i=n(r)?r():r,e.set(t,i)),i},t.mapGetWithDefault=function(e,t,r){var i=e.get(t);return void 0===i&&(i=n(r)?r():r),i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createAttribute=void 0,t.createAttribute=function(e){return e}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(86),t),i(r(149),t),i(r(31),t),i(r(150),t),i(r(39),t),i(r(151),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TO_DEGREES=t.TO_RADIANS=t.activeAttributeName=t.uniformBufferInstanceBufferName=void 0,t.uniformBufferInstanceBufferName="instanceData",t.activeAttributeName="_active",t.TO_RADIANS=Math.PI/180,t.TO_DEGREES=180/Math.PI},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.LayerScene=void 0;var s=r(72),u=r(17),c=r(61),l=r(86),f=r(5)("performance"),d=function(e){function t(t,r){var n=e.call(this,r)||this;return Object.defineProperty(n,"container",{enumerable:!0,configurable:!0,writable:!0,value:new s.Scene}),Object.defineProperty(n,"layerDiffs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"surface",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"viewDiffs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n.surface=t,n.init(r),n}return i(t,e),Object.defineProperty(t.prototype,"layers",{get:function(){return this.layerDiffs.items},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"views",{get:function(){return this.viewDiffs.items},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"init",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;if(this.surface&&this.surface.gl){this.container=new s.Scene;var r=(0,l.generateDefaultElements)(this.surface.gl);this.layerDiffs=new c.ReactiveDiff({buildItem:function(e){return o(t,void 0,void 0,(function(){var t,r,n,i;return a(this,(function(o){return f("Building layer",e.key),this.surface?(t=e.init[0],r=e.init[1],(n=new t(this.surface,this,Object.assign({},t.defaultProps,r))).initializer=e,n.props.data.sync(),n.parent=r.parent,r.parent&&(r.parent.children?r.parent.children.push(n):r.parent.children=[n]),n.init(this.views)?(i=n.childLayers(),this.layerDiffs.inline(i),[2,n]):(console.warn("Error initializing layer:",r.key,"A layer was unable to be added to the surface. See previous warnings (if any) to determine why they could not be instantiated"),[2,null])):[2,null]}))}))},destroyItem:function(e,r){return o(t,void 0,void 0,(function(){return a(this,(function(t){return f("Destroying layer",e.key),r.destroy(),[2,!0]}))}))},updateItem:function(e,r){return o(t,void 0,void 0,(function(){var t,n,i;return a(this,(function(o){return t=e.init[1],r.willUpdateProps(t),t.data!==r.props.data&&t.data.sync(),r.shouldDrawView(r.props,t)&&(r.needsViewDrawn=!0),Object.assign(r.props,t),r.initializer.init[1]=r.props,r.didUpdateProps(),t.parent&&r.parent&&r.parent!==t.parent&&(n=r.parent.children||[],(i=n.indexOf(r)||-1)>-1&&n.splice(i,1)),r.parent=t.parent,r.willRebuildLayer?(this.layerDiffs.rebuild(),r.willRebuildLayer=!1):this.layerDiffs.inline(r.childLayers()),[2]}))}))}}),this.viewDiffs=new c.ReactiveDiff({buildItem:function(e){return o(t,void 0,void 0,(function(){var t;return a(this,(function(n){return this.surface?((t=new e.init[0](this,e.init[1])).props.camera=t.props.camera||r.camera,t.pixelRatio=this.surface.pixelRatio,t.resource=this.surface.resourceManager,this.surface.userInputManager.waitingForRender=!0,[2,t]):[2,null]}))}))},destroyItem:function(e,r){return o(t,void 0,void 0,(function(){return a(this,(function(e){return[2,!0]}))}))},updateItem:function(e,r){return o(t,void 0,void 0,(function(){var t;return a(this,(function(n){return t=e.init[1],r.willUpdateProps(t),r.shouldDrawView(r.props,t)&&(r.needsDraw=!0),Object.assign(r.props,t),r.didUpdateProps(),this.surface&&(this.surface.userInputManager.waitingForRender=!0),[2]}))}))}}),this.update(e)}}}),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){delete this.container,this.layerDiffs.destroy(),this.viewDiffs.destroy()}}),Object.defineProperty(t.prototype,"removeLayer",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this.layers){var t=this.layers.indexOf(e);if(t>=0)return void this.layers.splice(t,1)}}}),Object.defineProperty(t.prototype,"update",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.order=e.order,[4,this.viewDiffs.diff(e.views)];case 1:return t.sent(),[4,this.layerDiffs.diff(e.layers)];case 2:return t.sent(),this.views.forEach((function(e){return e.createRenderTarget()})),[2]}}))}))}}),Object.defineProperty(t,"DEFAULT_SCENE_ID",{enumerable:!0,configurable:!0,writable:!0,value:"__default__"}),t}(u.IdentifyByKey);t.LayerScene=d},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactiveDiff=void 0;var a=function(){function e(e){var t=this;Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"willDispose",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"keyToItem",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"keyToInitializer",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"currentInitalizerIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"currentInitializers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"currentInitializer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentItem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"deferredInlining",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inlineDeferred",{enumerable:!0,configurable:!0,writable:!0,value:function(e){t.deferredInlining=e}}),Object.defineProperty(this,"inlineImmediate",{enumerable:!0,configurable:!0,writable:!0,value:function(e){var r;if(e.length>0&&t.currentInitializers&&t.currentItem){(r=t.currentInitializers).splice.apply(r,o([t.currentInitalizerIndex+1,0],e,!1));for(var n=0,i=e.length;n<i;++n){e[n].parent=t.currentItem}}}}),Object.defineProperty(this,"inline",{enumerable:!0,configurable:!0,writable:!0,value:this.inlineImmediate}),this.options=e}return Object.defineProperty(e.prototype,"items",{get:function(){return this._items.slice(0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){return n(this,void 0,void 0,(function(){var e,t,r,n,o;return i(this,(function(i){switch(i.label){case 0:for(e=[],t=0,r=this.currentInitializers.length;t<r;++t)n=this.currentInitializers[t],(o=this.keyToItem.get(n.key))&&e.push(this.options.destroyItem(n,o));return[4,Promise.all(e)];case 1:return i.sent(),[2]}}))}))}}),Object.defineProperty(e.prototype,"diff",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return n(this,void 0,void 0,(function(){var t,r,o,a,s=this;return i(this,(function(u){switch(u.label){case 0:t=e.slice(0),this.currentInitializers=t,this._items=[],r=0,u.label=1;case 1:return r<t.length?(o=t[r],this.currentInitalizerIndex=r,this.currentInitializer=o,this.willDispose.has(o.key)?(a=this.keyToItem.get(o.key)||null)?(this.currentItem=a,[4,this.options.updateItem(o,a)]):[3,3]:[3,6]):[3,9];case 2:return u.sent(),[3,5];case 3:return[4,this.options.buildItem(o)];case 4:a=u.sent(),u.label=5;case 5:return a&&(this.keyToInitializer.set(o.key,o),this.willDispose.delete(o.key),this._items.push(a)),[3,8];case 6:return this.inline=this.inlineDeferred,[4,this.options.buildItem(o)];case 7:a=u.sent(),this.inline=this.inlineImmediate,a&&(this.currentItem=a,this.deferredInlining&&(this.inline(this.deferredInlining),delete this.deferredInlining),this.keyToItem.set(o.key,a),this.keyToInitializer.set(o.key,o),this._items.push(a)),u.label=8;case 8:return delete this.currentItem,r++,[3,1];case 9:return this.willDispose.forEach((function(e){return n(s,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return t=this.keyToItem.get(e),r=this.keyToInitializer.get(e),t&&r?[4,this.options.destroyItem(r,t)]:[2];case 1:return n.sent()&&(this.keyToItem.delete(e),this.keyToInitializer.delete(e)),[2]}}))}))})),this.willDispose.clear(),this.keyToInitializer.forEach((function(e){s.willDispose.add(e.key)})),this.currentInitializers=[],delete this.currentItem,delete this.currentInitializer,[2]}}))}))}}),Object.defineProperty(e.prototype,"getByKey",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.keyToItem.get(e)}}),Object.defineProperty(e.prototype,"rebuild",{enumerable:!1,configurable:!0,writable:!0,value:function(){return n(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.currentItem&&this.currentInitializer?(this.keyToItem.delete(this.currentItem.id),this.keyToInitializer.delete(this.currentItem.id),this.options.destroyItem(this.currentInitializer,this.currentItem),[4,this.options.buildItem(this.currentInitializer)]):[2];case 1:return(e=t.sent())&&(this.keyToItem.set(this.currentItem.id,e),this.keyToInitializer.set(this.currentItem.id,this.currentInitializer)),[2]}}))}))}}),e}();t.ReactiveDiff=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommonMaterialOptions=void 0;var n=r(10),i=function(){function e(){}return Object.defineProperty(e,"transparentShapeBlending",{enumerable:!0,configurable:!0,writable:!0,value:{blending:{blendDst:n.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:n.GLSettings.Material.BlendingEquations.Add,blendSrc:n.GLSettings.Material.BlendingSrcFactor.SrcAlpha},culling:n.GLSettings.Material.CullSide.NONE,modify:function(e){return Object.assign({},this,e)}}}),Object.defineProperty(e,"transparentImageBlending",{enumerable:!0,configurable:!0,writable:!0,value:{blending:{blendSrc:n.GLSettings.Material.BlendingSrcFactor.One,blendDst:n.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:n.GLSettings.Material.BlendingEquations.Add},culling:n.GLSettings.Material.CullSide.NONE,modify:function(e){return Object.assign({},this,e)}}}),e}();t.CommonMaterialOptions=i},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.preloadNumber=t.fontRequest=t.FontResourceRequestFetch=void 0;var i=r(0);!function(e){e[e.TEXCOORDS=0]="TEXCOORDS",e[e.IMAGE_SIZE=1]="IMAGE_SIZE"}(t.FontResourceRequestFetch||(t.FontResourceRequestFetch={})),t.fontRequest=function(e){return n({type:i.ResourceType.FONT},e)},t.preloadNumber=function(){return".101112131415161718191.202122232425262728292.303132333435363738393.404142434445464748494.505152535455565758595.606162636465666768696.707172737475767778797.808182838485868788898.909192939495969798999.000102030405060708090.$0$1$2$3$4$5$6$7$8$9$%0%1%2%3%4%5%6%7%8%9%-0-1-2-3-4-5-6-7-8-9-+0+1+2+3+4+5+6+7+8+9+)0)1)2)3)4)5)6)7)8)9)(0(1(2(3(4(5(6(7(8(9("}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.Atlas=t.isAtlasResource=t.createAtlas=void 0;var a=r(15),s=r(0),u=r(17),c=r(32),l=r(24),f=r(5)("performance");t.createAtlas=function(e){return o({key:"",type:s.ResourceType.ATLAS},e)},t.isAtlasResource=function(e){return e&&e.type===s.ResourceType.ATLAS};var d=function(e){function t(t){var r=e.call(this,t)||this;Object.defineProperty(r,"height",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"packing",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"resourceReferences",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(r,"texture",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"textureSettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"type",{enumerable:!0,configurable:!0,writable:!0,value:s.ResourceType.ATLAS}),Object.defineProperty(r,"width",{enumerable:!0,configurable:!0,writable:!0,value:void 0});var n=document.createElement("canvas");if(r.width=n.width=t.width,r.height=n.height=t.height,r.textureSettings=t.textureSettings,t.width<0||t.height<0)throw new Error("TextureSize Error: An atlas does NOT support Screen Texture sizing.");return r.packing=new c.PackNode(0,0,t.width,t.height),r.createTexture(n),r}return i(t,e),Object.defineProperty(t.prototype,"createTexture",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t;this.texture||(t=this.textureSettings?o({generateMipMaps:!0,premultiplyAlpha:!0},this.textureSettings):{generateMipMaps:!0,premultiplyAlpha:!0},this.texture=new a.Texture(o({data:e},t)))}}),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;this.texture.destroy(),this.resourceReferences.forEach((function(t){e.invalidateTexture(t.subtexture)}))}}),Object.defineProperty(t.prototype,"invalidateTexture",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=[0,0];e.aspectRatio=1,e.atlasBL=t,e.atlasBR=t,e.atlasTL=t,e.atlasTR=t,e.isValid=!1,e.texture=null,e.pixelHeight=0,e.pixelWidth=0,delete e.source,e.video&&(e.video.monitor.destroy(),delete e.video)}}),Object.defineProperty(t.prototype,"resolveResources",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=[];this.resourceReferences.forEach((function(r,n){r.count<=0&&r.subtexture&&(f("A subtexture on an atlas has been invalidated as it is deemed no longer used: %o",r.subtexture),e.invalidateTexture(r.subtexture),t.push(n))}));for(var r=0,n=t.length;r<n;++r)this.resourceReferences.delete(t[r])}}),Object.defineProperty(t.prototype,"stopUsingResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){(this.resourceReferences.get(e.source)||{subtexture:e.texture||new l.SubTexture,count:0}).count--}}),Object.defineProperty(t.prototype,"useResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){(this.resourceReferences.get(e.source)||{subtexture:e.texture,count:0}).count++}}),t}(u.IdentifyByKey);t.Atlas=d},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.LabelInstance=void 0;var a=r(1),s=r(11),u=r(0),c=r(19),l=function(e){function t(r){var n=e.call(this,r)||this;return Object.defineProperty(n,"color",{enumerable:!0,configurable:!0,writable:!0,value:[0,0,0,1]}),Object.defineProperty(n,"depth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"fontSize",{enumerable:!0,configurable:!0,writable:!0,value:12}),Object.defineProperty(n,"maxScale",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(n,"maxWidth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"origin",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(n,"scale",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(n,"text",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(n,"letterSpacing",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"onReady",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"parentTextArea",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"preload",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(n,"glyphs",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(n,"size",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(n,"truncatedText",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(n,"anchor",{enumerable:!0,configurable:!0,writable:!0,value:{padding:0,paddingDirection:[0,0],type:c.AnchorType.TopLeft,x:0,y:0}}),(0,a.makeObservable)(n,t),n.anchor=r.anchor||n.anchor,n.color=r.color||n.color,n.depth=r.depth||n.depth,n.fontSize=r.fontSize||n.fontSize,n.maxScale=r.maxScale||n.maxScale,n.maxWidth=r.maxWidth||0,n.onReady=r.onReady,n.origin=r.origin,n.preload=r.preload||!1,n.scale=r.scale||n.scale,n.text=r.text||n.text,n.letterSpacing=r.letterSpacing||n.letterSpacing,r.anchor&&n.setAnchor(r.anchor),n}return i(t,e),Object.defineProperty(t.prototype,"getWidth",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.size[0]}}),Object.defineProperty(t.prototype,"setAnchor",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t={padding:e.padding||0,paddingDirection:e.paddingDirection,type:e.type,x:e.x||0,y:e.y||0};this.anchor=t}}),Object.defineProperty(t.prototype,"subTextGlyphs",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=[],r=this.text.indexOf(e);if(r<0)return t;for(var n=0,i=0,o=Math.min(this.text.length,r+e.length);i<o;++i)(0,u.isWhiteSpace)(this.text[i])||(n++,i>=r&&t.push(this.glyphs[n]));return t}}),Object.defineProperty(t.prototype,"resourceTrigger",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),o([a.observable],t.prototype,"color",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"fontSize",void 0),o([a.observable],t.prototype,"maxScale",void 0),o([a.observable],t.prototype,"maxWidth",void 0),o([a.observable],t.prototype,"origin",void 0),o([a.observable],t.prototype,"scale",void 0),o([a.observable],t.prototype,"text",void 0),o([a.observable],t.prototype,"letterSpacing",void 0),o([a.observable],t.prototype,"anchor",void 0),t}(s.Instance);t.LabelInstance=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.boxSample=t.BoxSampleDirection=void 0;var n,i=r(0),o=r(25);!function(e){e[e.DOWN=0]="DOWN",e[e.UP=1]="UP"}(n=t.BoxSampleDirection||(t.BoxSampleDirection={})),t.boxSample=function(e){var t,a=e.output,s=e.input;return(0,o.postProcess)({printShader:e.printShader,view:Object.assign(a?{output:{buffers:(t={},t[i.FragmentOutputType.COLOR]=a,t),depth:!1}}:{},e.view),buffers:{color:s},shader:r(309),material:e.material,uniforms:[{name:"delta",size:i.UniformSize.ONE,update:function(){return e.direction===n.DOWN?1:.5}}]})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserInputEventManager=void 0;var n=r(4),i=r(46),o=r(2),a=r(27),s=r(55),u=r(95),c=r(96),l=new a.NoView;function f(e,t){return t.d&&e.d?t.d.depth-e.d.depth:0}function d(e,t){return e.touch.identifier-t.touch.identifier}l.fitViewtoViewport(new i.Bounds({x:0,y:0,width:100,height:100}),new i.Bounds({x:0,y:0,width:100,height:100}));var p=function(){function e(e,t,r,n){var i=this;Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventManagers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"quadTree",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"surface",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventCleanup",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"currentInteraction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_waitingForRender",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"getViewsUnderPosition",{enumerable:!0,configurable:!0,writable:!0,value:function(e){if(!i.quadTree)return[];var t=i.quadTree.query(e);return t.sort(f),t}}),Object.defineProperty(this,"resize",{enumerable:!0,configurable:!0,writable:!0,value:function(){i._waitingForRender=!0}}),this.context=e,this.surface=t,this.setControllers(r),this.addContextListeners(n)}return Object.defineProperty(e.prototype,"waitingForRender",{get:function(){return this._waitingForRender},set:function(e){if(this._waitingForRender=e,!e){this.quadTree=new c.QuadTree(0,0,0,0);for(var t=this.scenes,r=[],n=0,i=t.length;n<i;++n)for(var o=t[n],a=0,s=o.views.length;a<s;++a){var u=o.views[a];r.push(u.screenBounds)}this.quadTree.addAll(r)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scenes",{get:function(){return this.surface&&this.surface.sceneDiffs?this.surface.sceneDiffs.items:[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"addContextListeners",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.addMouseContextListeners(e),this.addTouchContextListeners()}}),Object.defineProperty(e.prototype,"addMouseContextListeners",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this,r=this.context;if(!(0,n.isOffscreenCanvas)(r)){var i,a=!1;if(e){var s=function(e){var n=(0,u.eventElementPosition)(e,r),o=t.getViewsUnderPosition(n);if(!(o.length<=0)){i={canClick:!1,currentPosition:n,deltaPosition:[0,0],previousPosition:n,start:n,startTime:Date.now(),startView:o[0].d,event:e,wheel:t.makeWheel(e),button:-1};var a=t.makeMouseInteraction(i);t.eventManagers.forEach((function(e){e.handleWheel(a)})),e.stopPropagation(),e.preventDefault()}};"onwheel"in r&&(r.onwheel=s),"addEventListener"in r&&(r.addEventListener("DOMMouseScroll",s),this.eventCleanup.push(["DOMMouseScroll",s]))}r.onmouseleave=function(e){if(!t.waitingForRender&&i){var n=(0,u.eventElementPosition)(e,r);i.deltaPosition=(0,o.subtract2)(n,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=n;var a=t.makeMouseInteraction(i);t.eventManagers.forEach((function(e){e.handleMouseOut(a)}))}},r.onmousemove=function(e){if(!t.waitingForRender){var n=(0,u.eventElementPosition)(e,r);if(!i){var s=t.getViewsUnderPosition(n);i={canClick:!1,currentPosition:n,deltaPosition:[0,0],previousPosition:n,start:n,startTime:Date.now(),startView:s[0].d,event:e,wheel:t.makeWheel(),button:-1}}i.deltaPosition=(0,o.subtract2)(n,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=n,i.canClick=!1;var c=t.makeMouseInteraction(i);t.eventManagers.forEach((function(e){e.handleMouseMove(c)})),a=!0}},r.onmousedown=function(e){if(!t.waitingForRender){var n=(0,u.eventElementPosition)(e,r),s=t.getViewsUnderPosition(n);if(!(s.length<=0)){i={canClick:!0,currentPosition:n,deltaPosition:[0,0],previousPosition:n,start:n,startTime:Date.now(),startView:s[0].d,event:e,wheel:t.makeWheel(),button:e.button};var c=t.makeMouseInteraction(i);t.eventManagers.forEach((function(e){e.handleMouseDown(c)})),e.stopPropagation(),document.onmousemove=function(e){if(i){if(!a){var n=(0,u.eventElementPosition)(e,r);i.deltaPosition=(0,o.subtract2)(n,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=n,i.canClick=!1}var s=t.makeMouseInteraction(i);t.eventManagers.forEach((function(e){e.handleDrag(s)})),e.preventDefault(),e.stopPropagation(),a=!1}},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null,document.onmouseover=null,i=void 0},document.onmouseover=function(e){if(i){var n=(0,u.eventElementPosition)(e,r);i.deltaPosition=(0,o.subtract2)(n,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=n;var a=t.makeMouseInteraction(i);t.eventManagers.forEach((function(e){e.handleMouseOver(a)})),e.stopPropagation()}},r.onmouseup=function(e){if(i){var n=(0,u.eventElementPosition)(e,r);i.deltaPosition=(0,o.subtract2)(n,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=n,i.button=e.button;var a=t.makeMouseInteraction(i);t.eventManagers.forEach((function(e){e.handleMouseUp(a)})),i.canClick&&Date.now()-i.startTime<1e3&&t.eventManagers.forEach((function(e){e.handleClick(a)})),i=void 0}};var l=r;void 0!==l.onselectstart?l.onselectstart=function(){return!1}:r.addEventListener("selectstart",(function(){e.preventDefault()}))}}}}}}),Object.defineProperty(e.prototype,"addTouchContextListeners",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=this.context;if(!(0,n.isOffscreenCanvas)(t)){var r=new Map,i=new Map,a={center:function(t){return t.length<=0?[0,0]:e.getTouchCenter(p(t))},centerDelta:function(t){if(t.length<=0)return[0,0];var r=p(t),n=e.getTouchCenter(r,(function(e){return e.previousPosition})),i=e.getTouchCenter(r);return(0,o.subtract2)(i,n)},centerStart:function(t){if(t.length<=0)return[0,0];var r=h(t).touch;return e.getTouchCenter(p(t),(function(e){return e===r?e.start:e.startRelative.get(r)||[0,0]}))},id:function(e){return p(e).sort(d).map((function(e){return e.touch.identifier})).join("_")},rotation:function(t){if(t.length<=0)return 0;var r=p(t),n=e.getTouchCenter(r);return e.getAverageAngle(r,n)},rotationDelta:function(t){if(t.length<=0)return 0;var r=p(t),n=e.getTouchCenter(r,(function(e){return e.previousPosition})),i=e.getAverageAngle(r,n,(function(e){return e.previousPosition})),o=e.getTouchCenter(r);return e.getAverageAngle(r,o)-i},rotationStart:function(t){if(t.length<=0)return 0;var r=h(t).touch,n=p(t),i=e.getTouchCenter(n,(function(e){return e===r?e.start:e.startRelative.get(r)||[0,0]}));return e.getAverageAngle(n,i,(function(e){return e===r?e.start:e.startRelative.get(r)||[0,0]}))},spread:function(t){if(t.length<=0)return 0;var r=p(t),n=e.getTouchCenter(r);return e.getAverageDistance(r,n)},spreadDelta:function(t){if(t.length<=0)return 0;var r=p(t),n=e.getTouchCenter(r,(function(e){return e.previousPosition})),i=e.getAverageDistance(r,n,(function(e){return e.previousPosition})),o=e.getTouchCenter(r);return e.getAverageDistance(r,o)-i},spreadStart:function(t){if(t.length<=0)return 0;var r=h(t).touch,n=p(t),i=e.getTouchCenter(n,(function(e){return e===r?e.start:e.startRelative.get(r)||[0,0]}));return e.getAverageDistance(n,i,(function(e){return e===r?e.start:e.startRelative.get(r)||[0,0]}))}};t.ontouchstart=function(t){t.preventDefault(),t.stopPropagation();for(var n=e.getTouches(t),o=[],d=[],p=0,h=n.length;p<h;++p){var b=n[p],g=r.get(b.identifier);if(g)o.push(g);else{var v=(0,u.eventElementPosition)(b),y=e.getViewsUnderPosition(v);if(y.length<=0)continue;var m=y[0].d,w={canTap:!0,currentPosition:v,deltaPosition:[0,0],startTime:Date.now(),start:v,startView:m,previousPosition:v,startRelative:new Map,touch:b};r.set(b.identifier,w),d.push(w)}}if(d.length>0){var O=d.concat(o),_=[];for(p=0,h=d.length;p<h;++p){for(var T=d[p],P=0,x=O.length;P<x;++P){T!==(b=O[P])&&b.startRelative.set(T,b.currentPosition)}var E=e.makeSingleTouchInteraction(T);_.push(E),i.set(T.touch.identifier,E)}var j={touches:_,allTouches:O.map((function(e){return i.get(e.touch.identifier)})).filter(s.isDefined),multitouch:a};e.eventManagers.forEach((function(e){e.handleTouchDown(j)}))}document.ontouchend=function(e){c.call(document,e),document.ontouchend=null,document.ontouchcancel=null,document.ontouchmove=null},document.ontouchcancel=function(e){f.call(document,e),document.ontouchend=null,document.ontouchcancel=null,document.ontouchmove=null},document.ontouchmove=l};var c=t.ontouchend=function(t){t.stopPropagation(),t.preventDefault();for(var n=e.getTouches(t,"changed"),o=Array.from(i.values()),s=[],u=function(t,u){var c=n[t],l=r.get(c.identifier);if(!l)return"continue";if(l.canTap&&Date.now()-l.startTime<200){var f={touches:[e.makeSingleTouchInteraction(l)],allTouches:o,multitouch:a};e.eventManagers.forEach((function(e){e.handleTap(f)}))}s.push(l),r.delete(c.identifier),i.delete(c.identifier)},c=0,l=n.length;c<l;++c)u(c);if(s.length>0){var f={touches:s.map((function(t){return e.makeSingleTouchInteraction(t)})),allTouches:o,multitouch:a};e.eventManagers.forEach((function(e){e.handleTouchUp(f)}))}},l=t.ontouchmove=function(t){t.stopPropagation(),t.preventDefault();for(var n=e.getTouches(t),c=[],l=[],f=0,d=n.length;f<d;++f){var p=n[f],h=r.get(p.identifier);if(h){var b=(0,u.eventElementPosition)(p),g=(0,o.subtract2)(b,h.currentPosition);if((0,o.length2)(g)<=0){l.push(h),Object.assign(h,{currentPosition:b,deltaPosition:g,previousPosition:h.currentPosition,touch:p});continue}c.push(h),Object.assign(h,{canTap:!1,currentPosition:b,deltaPosition:g,previousPosition:h.currentPosition,touch:p})}}if(c.length>0){var v=c.concat(l),y={touches:c.map((function(t){return e.makeSingleTouchInteraction(t)})),allTouches:v.map((function(e){return i.get(e.touch.identifier)})).filter(s.isDefined),multitouch:a};e.eventManagers.forEach((function(e){e.handleTouchDrag(y)}))}},f=t.ontouchcancel=function(t){t.stopPropagation(),t.preventDefault();for(var n=e.getTouches(t,"changed"),o=Array.from(i.values()),s=[],u=0,c=n.length;u<c;++u){var l=n[u],f=r.get(l.identifier);f&&(s.push(f),r.delete(l.identifier),i.delete(l.identifier))}if(s.length>0){var d={touches:s.map((function(t){return e.makeSingleTouchInteraction(t)})),allTouches:o,multitouch:a};e.eventManagers.forEach((function(e){e.handleTouchCancelled(d)}))}}}function p(e){return e.map((function(e){return e.touch}))}function h(e){return e.reduce((function(e,t){return t.touch.startTime>e.touch.startTime?t:e}),e[0])}}}),Object.defineProperty(e.prototype,"getAverageDistance",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=0;if(e.length<=0)return n;r||(r=function(e){return e.currentPosition});for(var i=0,a=e.length;i<a;++i){var s=e[i];n+=(0,o.length2)((0,o.subtract2)(r(s),t))}return n/e.length}}),Object.defineProperty(e.prototype,"getAverageAngle",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=0;if(e.length<=0)return n;r||(r=function(e){return e.currentPosition});for(var i=0,a=e.length;i<a;++i){var s=e[i],u=(0,o.subtract2)(r(s),t),c=Math.atan2(u[1],u[0]);c<0&&(c+=2*Math.PI),n+=c}return n/e.length}}),Object.defineProperty(e.prototype,"getTouchCenter",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=[0,0];if(e.length<=0)return r;t||(t=function(e){return e.currentPosition});for(var n=0,i=e.length;n<i;++n){var a=t(e[n]);r=(0,o.add2)(r,a)}return(0,o.scale2)(r,1/e.length)}}),Object.defineProperty(e.prototype,"getTouches",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=new Map;if(e.touches&&e.touches.length>0&&(!t||"touches"===t))for(var n=0,i=e.touches.length;n<i;++n){(o=e.touches.item(n))&&r.set(o.identifier,o)}if(e.changedTouches&&e.changedTouches.length>0&&(!t||"changed"===t))for(n=0,i=e.changedTouches.length;n<i;++n){(o=e.changedTouches.item(n))&&r.set(o.identifier,o)}if(e.targetTouches&&e.targetTouches.length>0&&(!t||"target"===t))for(n=0,i=e.targetTouches.length;n<i;++n){var o;(o=e.targetTouches.item(n))&&r.set(o.identifier,o)}return Array.from(r.values())}}),Object.defineProperty(e.prototype,"getView",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=this.scenes,r=0,n=t.length;r<n;++r){var i=t[r].viewDiffs.getByKey(e);if(i)return i}return null}}),Object.defineProperty(e.prototype,"makeMouseInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.getViewsUnderPosition(e.currentPosition),r=t[0]&&t[0].d;r||(r=l);var i=this.getViewsUnderPosition(e.start),o=e.startView;o||(o=l);var a={canvas:(0,n.isOffscreenCanvas)(this.context)?void 0:this.context,mouse:e,screen:{position:e.currentPosition},start:{position:o.projection.screenToView(e.start),view:o,views:i.map((function(t){return t.d||(t.d=l),{position:t.d.projection.screenToView(e.start),view:t.d}}))},target:{position:r.projection.screenToView(e.currentPosition),view:r,views:t.map((function(t){return t.d||(t.d=l),{position:t.d.projection.screenToView(e.currentPosition),view:t.d}}))}};return this.currentInteraction=a,a}}),Object.defineProperty(e.prototype,"makeSingleTouchInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=e.currentPosition,r=this.getViewsUnderPosition(t),i=r[0]&&r[0].d;i||(i=l);var o=e.startView;o||(o=l);var a={canvas:(0,n.isOffscreenCanvas)(this.context)?void 0:this.context,touch:e,screen:{position:t},start:{position:o.projection.screenToView(e.start),view:o,views:this.getViewsUnderPosition(e.start).map((function(t){return t.d||(t.d=l),{position:t.d.projection.screenToView(e.start),view:t.d}}))},target:{position:i.projection.screenToView(t),view:i,views:r.map((function(e){return e.d||(e.d=l),{position:e.d.projection.screenToView(t),view:e.d}}))}};return this.currentInteraction=a,a}}),Object.defineProperty(e.prototype,"makeMultiTouchInteractions",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){e.sort(d);for(var r=this.allTouchCombinations(e),n=0,i=r.length;n<i;++n){var o=r[n],a=o.map((function(e){return e.touch.identifier})).join("_"),s=t.get(a);if(!s){var u=this.getTouchCenter(o);s={touches:o,averageSpreadDelta:0,startCenter:u,currentCenter:u,currentRotation:this.getAverageAngle(o,u),centerDelta:[0,0],rotationDelta:0},t.set(a,s)}}}}),Object.defineProperty(e.prototype,"updateMultiTouchInteractions",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){e.sort(d);for(var r=this.allTouchCombinations(e),n=0,i=r.length;n<i;++n){var a=r[n],s=a.map((function(e){return e.touch.identifier})).join("_"),u=t.get(s);if(u){var c=this.getTouchCenter(a),l=this.getAverageAngle(a,c);u.centerDelta=(0,o.subtract2)(c,u.currentCenter),u.currentCenter=c,u.rotationDelta=l-u.currentRotation,u.currentRotation=l}}}}),Object.defineProperty(e.prototype,"allTouchCombinations",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=[],r=e.length,n=1<<r,i=1;i<n;i++){for(var o=[],a=0;a<r;a++)i&1<<a&&o.push(e[a]);t.push(o)}return t}}),Object.defineProperty(e.prototype,"makeWheel",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!e)return{delta:[0,0]};var t=(0,u.normalizeWheel)(e);return{delta:[t.pixelX,t.pixelY]}}}),Object.defineProperty(e.prototype,"setControllers",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.eventManagers=e;for(var t=0,r=this.eventManagers;t<r.length;t++){r[t].setUserInputManager(this)}}}),Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this;delete this.quadTree,(0,n.isOffscreenCanvas)(this.context)||(this.context.onmousedown=null,this.context.onmousemove=null,this.context.onmouseleave=null);var t=this.context;t.onmousewheel&&(t.onmousewheel=null),this.eventCleanup.forEach((function(t){e.context.removeEventListener(t[0],t[1])}))}}),e}();t.UserInputEventManager=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GLProxy=void 0;var n=r(0),i=r(69),o=r(44),a=r(10),s=r(15),u=r(14),c=r(5)("performance");function l(e){return e&&e.buffer&&void 0!==e.buffer.byteOffset&&e.buffer.byteLength||null===e.buffer}function f(e){return 0==(e&e-1)}function d(e){return Boolean(e.gl&&e.gl.textureId&&e.gl.textureUnit>-1)}var p=function(){function e(e,t,r){Object.defineProperty(this,"debugContext",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"gl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extensions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fragmentShaders",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"vertexShaders",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"programs",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.gl=e,this.state=t,this.extensions=r}return Object.defineProperty(e,"addExtensions",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=e.getExtension("ANGLE_instanced_arrays"),r=e.getExtension("WEBGL_draw_buffers"),n=e.getExtension("OES_texture_float"),i=e.getExtension("OES_texture_float_linear"),o=e.getExtension("OES_texture_half_float"),a=e.getExtension("OES_texture_half_float_linear"),s=e.getExtension("EXT_texture_filter_anisotropic"),u=e.getExtension("EXT_color_buffer_float"),l=e.getExtension("OES_vertex_array_object"),f={maxAnistropicFilter:0};return t||e instanceof WebGL2RenderingContext||c("This device does not have hardware instancing. All buffering strategies will be utilizing compatibility modes."),r||e instanceof WebGL2RenderingContext||c("This device does not have hardware multi-render target capabilities. The system will have to fallback to multiple render passes to multiple FBOs to achieve the same result."),s?f.maxAnistropicFilter=e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT):c("This device does not have hardware anisotropic filtering for textures. This property will be ignored when setting texture settings."),l||e instanceof WebGL2RenderingContext||c("This device does not support Vertex Array Objects. This could cause performance issues for high numbers of draw calls."),{instancing:(e instanceof WebGL2RenderingContext?e:t)||void 0,drawBuffers:(e instanceof WebGL2RenderingContext?e:r)||void 0,anisotropicFiltering:s?{ext:s,stat:f}:void 0,renderFloatTexture:u||void 0,floatTex:(e instanceof WebGL2RenderingContext?e:n)||void 0,floatTexFilterLinear:(e instanceof WebGL2RenderingContext?e:i)||void 0,halfFloatTex:(e instanceof WebGL2RenderingContext?e:o)||void 0,halfFloatTexFilterLinear:(e instanceof WebGL2RenderingContext?e:a)||void 0,vao:(e instanceof WebGL2RenderingContext?e:l)||void 0}}}),Object.defineProperty(e.prototype,"clear",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=0;e&&(n|=this.gl.COLOR_BUFFER_BIT),t&&(n|=this.gl.DEPTH_BUFFER_BIT),r&&(n|=this.gl.STENCIL_BUFFER_BIT),this.gl.clear(n)}}),Object.defineProperty(e.prototype,"compileAttribute",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!e.gl){var t=this.gl,r=t.createBuffer();return r?(this.state.bindVBO(r),t.bufferData(t.ARRAY_BUFFER,e.data,e.isDynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW),e.gl={bufferId:r,type:t.ARRAY_BUFFER,proxy:this},e.resolve(),!0):(console.warn(this.debugContext,"Could bot create WebGLBuffer. Printing any existing gl errors:"),void this.printError())}}}),Object.defineProperty(e.prototype,"compileGeometry",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;if(!e.gl){var r=!0;if(e.gl={proxy:this},this.extensions.vao){var n=void 0;(n=this.extensions.vao instanceof WebGL2RenderingContext?this.extensions.vao.createVertexArray():this.extensions.vao.createVertexArrayOES())?(this.state.disableVertexAttributeArray(),this.state.bindVAO(n),e.attributes.forEach((function(r,n){t.updateAttribute(r)&&t.useAttribute(n,r,e)})),e.gl.vao=n,this.state.bindVAO(null)):c("WARNING: Could not make VAO for Geometry. This is fine, but this could cause a hit on performance.")}return e.attributes.forEach((function(e){r=Boolean(t.compileAttribute(e)&&r)})),r}}}),Object.defineProperty(e.prototype,"compileMaterial",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;if(!e.gl){var r=this.vertexShaders.get(e.vertexShader)||null;if(!r){if(!(r=this.gl.createShader(this.gl.VERTEX_SHADER)))return console.warn(this.debugContext,"Could not create a Vertex WebGLShader. Printing GL Errors:"),void this.printError();if(this.gl.shaderSource(r,e.vertexShader),this.gl.compileShader(r),this.gl.isContextLost()&&console.warn("Context was lost during compilation"),!this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS))return console.error(this.debugContext,"VERTEX SHADER COMPILER ERROR",e.name),console.warn("Could not compile provided shader. Printing logs and errors:"),console.warn(this.lineFormatShader(e.vertexShader)),console.warn("LOGS:"),console.warn(this.gl.getShaderInfoLog(r)),this.printError(),void this.gl.deleteShader(r)}var n=this.programs.get(r);n||(n=new Map,this.programs.set(r,n));var i={vsId:r,fsId:[],programId:[],proxy:this,programByTarget:new WeakMap,outputsByProgram:new WeakMap},o=new Set;e.fragmentShader.forEach((function(a){var s,u;if(n&&r){var c=t.fragmentShaders.get(a.source)||null;if(!c){if(!(c=t.gl.createShader(t.gl.FRAGMENT_SHADER)))return console.warn(t.debugContext,"Could not create a Fragment WebGLShader. Printing GL Errors:"),void t.printError();if(t.gl.shaderSource(c,a.source),t.gl.compileShader(c),t.gl.isContextLost()&&console.warn("Context was lost during compilation"),!t.gl.getShaderParameter(c,t.gl.COMPILE_STATUS))return console.error(t.debugContext,"FRAGMENT SHADER COMPILER ERROR:",e.name),console.warn("Could not compile provided shader. Printing logs and errors:"),console.warn(t.lineFormatShader(a.source)),console.warn("LOGS:"),console.warn(t.gl.getShaderInfoLog(c)),t.printError(),void t.gl.deleteShader(c)}var l=n.get(c)||null;if(l)l.useCount++;else{var f=t.gl.createProgram();if(!f)return console.warn(t.debugContext,"Could not create a WebGLProgram. Printing GL Errors:"),void t.printError();if(l={useCount:1,program:f},t.gl.attachShader(f,r),t.gl.attachShader(f,c),t.gl.linkProgram(f),t.gl.validateProgram(f),!t.gl.getProgramParameter(f,t.gl.LINK_STATUS)||!t.gl.getProgramParameter(f,t.gl.VALIDATE_STATUS)){var d=t.gl.getProgramInfoLog(f);return console.warn(t.debugContext,"Could not compile WebGL program. \n\n",d),t.printError(),void t.gl.deleteProgram(f)}n.set(c,l)}null===(s=i.fsId)||void 0===s||s.push({id:c,outputTypes:a.outputTypes}),null===(u=i.programId)||void 0===u||u.push({id:l.program,outputTypes:a.outputTypes}),i.outputsByProgram.set(l.program,a.outputTypes),t.state.useProgram(l.program);var p=t.state.currentProgram;if(!p)return!1;for(var h=t.gl.getProgramParameter(p,t.gl.ACTIVE_UNIFORMS),b=0;b<h;b++){var g=t.gl.getActiveUniform(p,b);g&&o.add(g.name.replace("[0]",""))}}})),e.gl=i;var a=new Set;return Object.keys(e.uniforms).forEach((function(e){o.has(e)||a.add(e)})),a.forEach((function(t){delete e.uniforms[t]})),Object.keys(e.uniforms).length===o.size||(console.warn(this.debugContext,"A program is requesting a set of uniforms:",Array.from(o.values()),"but our material only provides",Object.keys(e.uniforms),"thus the expected rendering will be considered invalid."),!1)}}}),Object.defineProperty(e.prototype,"compileRenderTarget",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;if(e.isInvalid)return!1;if(e.gl)return!0;var r=this.gl,n=r.createFramebuffer();if(!n)return console.warn(this.debugContext,"Could not generate a frame buffer object. Printing GL errors:"),this.printError(),!1;this.state.bindFBO(n);var a={fboId:n,proxy:this,fboByMaterial:new WeakMap};if(Array.isArray(e.buffers.color)){if(!this.extensions.drawBuffers)return console.warn("Attempted to manage a render target with MRT but the hardware does not support MRT. Use multiple render targets instead."),!1;var u=[],c=!0;a.colorBufferId=u;var l=e.buffers.color.length<=1;if(e.buffers.color.forEach((function(n,i){if(c)if(n.buffer instanceof s.Texture){var a=(0,o.indexToColorAttachment)(r,t.extensions,i,l,!1);u.push({data:n.buffer,outputType:n.outputType,attachment:a}),d(n.buffer)?r.framebufferTexture2D(r.FRAMEBUFFER,a,r.TEXTURE_2D,n.buffer.gl.textureId,0):(console.warn(t.debugContext,"Attempted to compile render target whose target texture was not ready for use."),c=!1)}else{var f=t.compileColorBuffer(n.buffer,e.width,e.height);if(f){a=(0,o.indexToColorAttachment)(r,t.extensions,i,l,!1);u.push({data:f,outputType:n.outputType,attachment:a}),r.framebufferRenderbuffer(r.FRAMEBUFFER,a,r.RENDERBUFFER,f)}}})),!c)return!1}else if(void 0!==e.buffers.color){var f;if((f=e.buffers.color).buffer instanceof s.Texture){var p=(0,o.indexToColorAttachment)(r,this.extensions,0,!0,!1);if(a.colorBufferId={data:f.buffer,outputType:f.outputType,attachment:p},!d(f.buffer))return console.warn(this.debugContext,"Attempted to compile render target whose target texture was not ready for use."),!1;r.framebufferTexture2D(r.FRAMEBUFFER,p,r.TEXTURE_2D,f.buffer.gl.textureId,0)}else{if(h=this.compileColorBuffer(f.buffer,e.width,e.height)){p=(0,o.indexToColorAttachment)(r,this.extensions,0,!0,!1);a.colorBufferId={data:h,outputType:f.outputType,attachment:p},r.framebufferRenderbuffer(r.FRAMEBUFFER,p,r.RENDERBUFFER,h)}}}if(void 0!==e.buffers.depth)if((f=e.buffers.depth)instanceof s.Texture)a.depthBufferId=f,d(f)&&r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,f.gl.textureId,0);else if(f instanceof i.ColorBuffer){(h=this.compileDepthBuffer((0,o.depthBufferFormat)(r,f.internalFormat),e.width,e.height))&&(a.depthBufferId=h,r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,h))}else{var h;(h=this.compileDepthBuffer(f,e.width,e.height))&&(a.depthBufferId=h,r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,h))}void 0!==e.buffers.stencil&&((f=e.buffers.stencil)instanceof s.Texture?(a.stencilBufferId=f,d(f)&&r.framebufferTexture2D(r.FRAMEBUFFER,r.STENCIL_ATTACHMENT,r.TEXTURE_2D,f.gl.textureId,0)):(h=this.compileStencilBuffer(f,e.width,e.height))&&(a.stencilBufferId=h,r.framebufferRenderbuffer(r.FRAMEBUFFER,r.STENCIL_ATTACHMENT,r.RENDERBUFFER,h)));e.gl=a;var b=r.checkFramebufferStatus(r.FRAMEBUFFER),g=!1,v=!1,y="";switch(b){case r.FRAMEBUFFER_COMPLETE:e.setAsValid();break;case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:y="FRAMEBUFFER_INCOMPLETE_ATTACHMENT";break;case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:y="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";break;case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:y="FRAMEBUFFER_INCOMPLETE_DIMENSIONS";break;case r.FRAMEBUFFER_UNSUPPORTED:y="FRAMEBUFFER_UNSUPPORTED";break;default:g=!0}if(r instanceof WebGL2RenderingContext)switch(b){case r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:y="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE";break;case r.RENDERBUFFER_SAMPLES:y="RENDERBUFFER_SAMPLES";break;default:v=!0}return g&&v&&(console.warn(this.debugContext,"A framebuffer check failed to return a known result. This FBO for render target will be assumed failed"),console.warn("Result:",b,"Render Target:",e),y="UNKNOWN"),!y||(console.warn(this.debugContext,"When creating a new FrameBuffer Object, the check on the framebuffer failed. Printing Errors:"),console.warn(y),this.printError(),console.warn("FAILED RENDER TARGET:",e),delete e.gl,e.isInvalid=!0,!1)}}),Object.defineProperty(e.prototype,"compileDepthBuffer",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=this.gl,i=n.createRenderbuffer();return i?(this.state.bindRBO(i),n.renderbufferStorage(n.RENDERBUFFER,(0,o.depthBufferFormat)(n,e),t,r),i):(console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),void this.printError())}}),Object.defineProperty(e.prototype,"compileStencilBuffer",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=this.gl,i=n.createRenderbuffer();return i?(this.state.bindRBO(i),n.renderbufferStorage(n.RENDERBUFFER,(0,o.stencilBufferFormat)(n,e),t,r),i):(console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),void this.printError())}}),Object.defineProperty(e.prototype,"compileColorBuffer",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=this.gl,i=n.createRenderbuffer();return i?(this.state.bindRBO(i),n.renderbufferStorage(n.RENDERBUFFER,(0,o.colorBufferFormat)(n,e.internalFormat),t,r),e.gl={bufferId:i,proxy:this},i):(console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),void this.printError())}}),Object.defineProperty(e.prototype,"compileTexture",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(e.gl&&!e.gl.textureId){if(!(e.gl.textureUnit<0)){this.state.setActiveTextureUnit(e.gl.textureUnit);var t=this.gl.createTexture();return t?(e.gl.textureId=t,e.needsDataUpload=!0,e.needsSettingsUpdate=!0,this.updateTextureData(e),this.updateTextureSettings(e),!0):(console.warn(this.debugContext,"Could not generate a texture object on the GPU. Printing any gl errors:"),void this.printError())}console.warn(this.debugContext,"A Texture object attempted to be compiled without an established Texture Unit.",e)}}}),Object.defineProperty(e.prototype,"draw",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t,r=this,n=[0,0];n=e.vertexDrawRange&&e.vertexDrawRange[0]>=0&&e.vertexDrawRange[1]>=0?[e.vertexDrawRange[0],e.vertexDrawRange[1]-e.vertexDrawRange[0]]:[0,e.vertexCount],e.drawInstances>=0&&e.geometry.isInstanced&&(t=this.extensions.instancing),(u.WebGLStat.MRT||u.WebGLStat.MRT_EXTENSION)&&this.state.renderTarget&&!this.state.drawBuffers.find((function(e){return e!==r.gl.NONE}))||(t&&t instanceof WebGL2RenderingContext?t.drawArraysInstanced((0,o.drawMode)(this.gl,e.drawMode),n[0],n[1],e.drawInstances):t?t.drawArraysInstancedANGLE((0,o.drawMode)(this.gl,e.drawMode),n[0],n[1],e.drawInstances):this.gl.drawArrays((0,o.drawMode)(this.gl,e.drawMode),n[0],n[1]),this.state.setDrawBuffers([],!0))}}),Object.defineProperty(e.prototype,"disposeAttribute",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.gl&&(this.gl.deleteBuffer(e.gl.bufferId),delete e.gl)}}),Object.defineProperty(e.prototype,"disposeColorBuffer",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.gl&&(e.gl.bufferId&&this.disposeRenderBuffer(e.gl.bufferId),delete e.gl)}}),Object.defineProperty(e.prototype,"disposeGeometry",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.gl&&this.extensions.vao&&e.gl.vao&&(this.extensions.vao instanceof WebGL2RenderingContext?this.extensions.vao.deleteVertexArray(e.gl.vao):this.extensions.vao.deleteVertexArrayOES(e.gl.vao))}}),Object.defineProperty(e.prototype,"disposeMaterial",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(e.gl){var t=e.gl,r=t.vsId,n=t.fsId,i=t.programId,o=this.programs.get(r);o||(o=new Map,this.gl.deleteShader(r));for(var a=function(e,t){var a=n[e],u=o.get(a);u||(u={useCount:0,program:i}),u.useCount--,u.useCount<1&&(s.gl.deleteProgram(u.program),o.delete(a),o.size<=0&&s.gl.deleteShader(r));var c=!1;s.programs.forEach((function(e){e.has(a)&&(c=!0)})),c||s.gl.deleteShader(a)},s=this,u=0,c=n.length;u<c;++u)a(u)}delete e.gl}}),Object.defineProperty(e.prototype,"disposeRenderBuffer",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.gl.deleteRenderbuffer(e)}}),Object.defineProperty(e.prototype,"disposeRenderTarget",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;e.gl&&(Array.isArray(e.gl.colorBufferId)?e.gl.colorBufferId.forEach((function(r){r.data instanceof s.Texture&&!e.retainTextureTargets?t.disposeTexture(r.data):r.data instanceof WebGLRenderbuffer&&t.disposeRenderBuffer(r.data)})):e.gl.colorBufferId&&e.gl.colorBufferId.data instanceof s.Texture&&!e.retainTextureTargets?this.disposeTexture(e.gl.colorBufferId.data):e.gl.colorBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.colorBufferId.data),e.gl.depthBufferId instanceof s.Texture&&!e.retainTextureTargets?this.disposeTexture(e.gl.depthBufferId):e.gl.depthBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.depthBufferId),e.gl.stencilBufferId instanceof s.Texture&&!e.retainTextureTargets?this.disposeTexture(e.gl.stencilBufferId):e.gl.stencilBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.stencilBufferId),this.gl.deleteFramebuffer(e.gl.fboId),delete e.gl)}}),Object.defineProperty(e.prototype,"disposeTexture",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.gl&&!e.destroyed&&(this.gl.deleteTexture(e.gl.textureId),this.state.freeTextureUnit(e)),delete e.gl}}),Object.defineProperty(e,"getContext",{enumerable:!1,configurable:!0,writable:!0,value:function(t,r){for(var n=[u.WebGLStat.WEBGL_VERSION,"webgl","webgl2","experimental-webgl"],i=null,o={},a=0;a<n.length;++a){var s=n[a],l=t.getContext(s,r);if(l&&(l instanceof WebGLRenderingContext||l instanceof WebGL2RenderingContext)){c("Generated GL Context of version with attributes:",s,r),i=l,o=e.addExtensions(i);break}}return{context:i,extensions:o}}}),Object.defineProperty(e.prototype,"printError",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.gl.getError();switch(e){case this.gl.NO_ERROR:console.warn("GL Error: No Error");break;case this.gl.INVALID_ENUM:console.warn("GL Error: INVALID ENUM");break;case this.gl.INVALID_VALUE:console.warn("GL Error: INVALID_VALUE");break;case this.gl.INVALID_OPERATION:console.warn("GL Error: INVALID OPERATION");break;case this.gl.INVALID_FRAMEBUFFER_OPERATION:console.warn("GL Error: INVALID FRAMEBUFFER OPERATION");break;case this.gl.OUT_OF_MEMORY:console.warn("GL Error: OUT OF MEMORY");break;case this.gl.CONTEXT_LOST_WEBGL:console.warn("GL Error: CONTEXT LOST WEBGL");break;default:console.warn("GL Error: GL Context output an unrecognized error value:",e)}}}),Object.defineProperty(e.prototype,"lineFormat",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=e.split("\n"),r=String(t.length).length+1;return"\n".concat(t.map((function(e,t){return"".concat(Array(r-String(t+1).length).join(" ")).concat(t+1,": ").concat(e)})).join("\n"))}}),Object.defineProperty(e.prototype,"lineFormatShader",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;return(0,n.isString)(e)?this.lineFormat(e):e.forEach((function(e){return"\nSHADER FOR OUTPUT TYPES: ".concat(e.outputTypes," ").concat(t.lineFormat(e.source))}))}}),Object.defineProperty(e.prototype,"updateTexture",{enumerable:!1,configurable:!0,writable:!0,value:function(e){!e.gl||e.gl.textureUnit<0?console.warn(this.debugContext,"Can not update or compile a texture that does not have an established texture unit.",e):(this.compileTexture(e),this.updateTextureData(e),this.updateTexturePartialData(e),this.updateTextureSettings(e),e.resolve())}}),Object.defineProperty(e.prototype,"updateTextureData",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(e.needsDataUpload&&e.gl&&e.gl.textureId)if(e.gl.textureUnit<0)console.warn(this.debugContext,"A Texture object attempted to update it's data without an established Texture Unit.",e);else{var t=this.gl;if(this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,a.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D),e.needsSettingsUpdate=!0,this.updateTextureSettings(e),t instanceof WebGLRenderingContext||t instanceof WebGL2RenderingContext){if(l(e.data)){f(e.data.width)&&f(e.data.height)||c("Created a texture that is not using power of 2 dimensions.");var r=(0,o.texelFormat)(t,e.internalFormat),n=(0,o.texelFormat)(t,e.format);t instanceof WebGLRenderingContext&&r!==n&&console.warn("WebGL 1 requires format and data format to be identical"),t.texImage2D(t.TEXTURE_2D,0,r,e.data.width,e.data.height,0,n,(0,o.inputImageFormat)(t,e.type),e.data.buffer)}else e.data&&(f(e.data.width)&&f(e.data.height)||c("Created a texture that is not using power of 2 dimensions. %o",e),t.texImage2D(t.TEXTURE_2D,0,(0,o.texelFormat)(t,e.internalFormat),(0,o.texelFormat)(t,e.format),(0,o.inputImageFormat)(t,e.type),e.data));e.generateMipMaps&&t.generateMipmap(t.TEXTURE_2D)}e.data&&(e.data={width:e.data.width,height:e.data.height,buffer:null}),e.needsDataUpload=!1}}}),Object.defineProperty(e.prototype,"updateTexturePartialData",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(e.needsPartialDataUpload&&e.gl&&e.gl.textureId)if(e.gl.textureUnit<0)console.warn(this.debugContext,"A Texture object attempted to update it's data without an established Texture Unit.",e);else{var t=this.gl;this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,a.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D),e.updateRegions.forEach((function(r){var n=r[0],i=r[1];(t instanceof WebGLRenderingContext||t instanceof WebGL2RenderingContext)&&(l(n)?t.texSubImage2D(t.TEXTURE_2D,0,i.x,i.y,n.width,n.height,(0,o.texelFormat)(t,e.format),(0,o.inputImageFormat)(t,e.type),n.buffer):n&&t.texSubImage2D(t.TEXTURE_2D,0,i.x,i.y,(0,o.texelFormat)(t,e.format),(0,o.inputImageFormat)(t,e.type),n),e.generateMipMaps&&t.generateMipmap(t.TEXTURE_2D))})),e.needsPartialDataUpload=!1}}}),Object.defineProperty(e.prototype,"updateTextureSettings",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(e.needsSettingsUpdate&&e.gl&&e.data&&e.gl.textureId)if(e.gl.textureUnit<0)console.warn(this.debugContext,"A Texture object attempted to update it's settings without an established Texture Unit.",e);else{var t,r,n=f(e.data.width)&&f(e.data.height),i=this.gl;if(this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,a.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D),e.isHalfFloatTexture)if(u.WebGLStat.FLOAT_TEXTURE_READ.halfLinearFilter)switch(t=(0,o.magFilter)(i,e.magFilter),e.minFilter){case a.GLSettings.Texture.TextureMinFilter.Nearest:case a.GLSettings.Texture.TextureMinFilter.NearestMipMapLinear:case a.GLSettings.Texture.TextureMinFilter.NearestMipMapNearest:r=(0,o.minFilter)(i,a.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);break;case a.GLSettings.Texture.TextureMinFilter.Linear:case a.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear:case a.GLSettings.Texture.TextureMinFilter.LinearMipMapNearest:r=(0,o.minFilter)(i,a.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps)}else t=(0,o.magFilter)(i,a.GLSettings.Texture.TextureMagFilter.Nearest),r=(0,o.minFilter)(i,a.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);else if(e.isFloatTexture)if(u.WebGLStat.FLOAT_TEXTURE_READ.fullLinearFilter)switch(t=(0,o.magFilter)(i,e.magFilter),e.minFilter){case a.GLSettings.Texture.TextureMinFilter.Nearest:case a.GLSettings.Texture.TextureMinFilter.NearestMipMapLinear:case a.GLSettings.Texture.TextureMinFilter.NearestMipMapNearest:r=(0,o.minFilter)(i,a.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);break;case a.GLSettings.Texture.TextureMinFilter.Linear:case a.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear:case a.GLSettings.Texture.TextureMinFilter.LinearMipMapNearest:r=(0,o.minFilter)(i,a.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps)}else t=(0,o.magFilter)(i,a.GLSettings.Texture.TextureMagFilter.Nearest),r=(0,o.minFilter)(i,a.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);else!n&&i instanceof WebGLRenderingContext?(t=(0,o.magFilter)(i,a.GLSettings.Texture.TextureMagFilter.Linear),r=(0,o.minFilter)(i,a.GLSettings.Texture.TextureMinFilter.Linear,e.generateMipMaps)):(t=(0,o.magFilter)(i,e.magFilter),r=(0,o.minFilter)(i,e.minFilter,e.generateMipMaps));if(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,r),e.isFloatTexture||(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,(0,o.wrapMode)(i,e.wrapHorizontal)),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,(0,o.wrapMode)(i,e.wrapVertical))),e.isFloatTexture||(i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e.flipY)),this.extensions.anisotropicFiltering){var s=this.extensions.anisotropicFiltering,c=s.ext,l=s.stat,d=Math.min(l.maxAnistropicFilter,Math.floor(e.anisotropy));isNaN(d)||e.isFloatTexture||i.texParameterf(i.TEXTURE_2D,c.TEXTURE_MAX_ANISOTROPY_EXT,d)}e.needsSettingsUpdate=!1}}}),Object.defineProperty(e.prototype,"updateAttribute",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!e.gl)return this.compileAttribute(e);if(!e.fullUpdate&&!e.needsUpdate)return!0;var t=this.gl;if(e.fullUpdate||e.updateRange.count<0||e.updateRange.offset<0)this.state.bindVBO(e.gl.bufferId),t.bufferData(t.ARRAY_BUFFER,e.data,e.isDynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW);else if(e.updateRange.count>0){this.state.bindVBO(e.gl.bufferId);var r=e.updateRange.offset;t.bufferSubData(t.ARRAY_BUFFER,4*r,e.data.subarray(r,r+e.updateRange.count))}return e.resolve(),!0}}),Object.defineProperty(e.prototype,"useAttribute",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){if(!this.state.currentProgram)return!1;if(!t.gl)return!1;t.gl.locations=t.gl.locations||new Map;var n=t.gl.locations.get(this.state.currentProgram);if(void 0===n&&(-1===(n=this.gl.getAttribLocation(this.state.currentProgram,e))&&c("WARN: An attribute is not being used with the current material: %o",e,t),t.gl.locations.set(this.state.currentProgram,n)),-1!==n){switch(this.state.bindVBO(t.gl.bufferId),t.size){case 1:case 2:case 3:case 4:this.state.willUseVertexAttributeArray(n),this.gl.vertexAttribPointer(n,t.size,this.gl.FLOAT,t.normalize,0,0),r.isInstanced&&t.isInstanced&&this.extensions.instancing?this.state.setVertexAttributeArrayDivisor(n,1):this.state.setVertexAttributeArrayDivisor(n,0);break;default:for(var i=Math.ceil(t.size/4),o=0;o<i;++o)this.state.willUseVertexAttributeArray(n+o),this.gl.vertexAttribPointer(n+o,4,this.gl.FLOAT,t.normalize,4*i*4,16*o),r.isInstanced&&t.isInstanced&&this.extensions.instancing?this.state.setVertexAttributeArrayDivisor(n+o,1):this.state.setVertexAttributeArrayDivisor(n+o,0)}return!0}}}),e}();t.GLProxy=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColorBuffer=void 0;var n=r(10),i=function(){function e(e){var t;Object.defineProperty(this,"_destroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"gl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_internalFormat",{enumerable:!0,configurable:!0,writable:!0,value:n.GLSettings.RenderTarget.ColorBufferFormat.RGBA4}),Object.defineProperty(this,"needsSettingsUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_size",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),this.size=e.size||this.size,this.internalFormat=null!==(t=e.internalFormat)&&void 0!==t?t:this.internalFormat}return Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"internalFormat",{get:function(){return this._internalFormat},set:function(e){this.needsSettingsUpdate=!0,this._internalFormat=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){this.needsSettingsUpdate=!0,this._size=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.gl&&this.gl.proxy.disposeColorBuffer(this),this._destroyed=!0}}),e}();t.ColorBuffer=i},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u,c=[],l=!1,f=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&p())}function p(){if(!l){var e=s(d);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function b(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new h(e,t)),1!==c.length||l||s(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=b,i.addListener=b,i.once=b,i.off=b,i.removeListener=b,i.removeAllListeners=b,i.emit=b,i.prependListener=b,i.prependOnceListener=b,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GLState=void 0;var n=r(2),i=r(0),o=r(44),a=r(10),s=r(45),u=r(26),c=r(5)("performance"),l=function(){function e(e,t){Object.defineProperty(this,"debugContext",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"extensions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"gl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"glProxy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_textureUnitToTexture",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_freeUnits",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_blendingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_blendDstFactor",{enumerable:!0,configurable:!0,writable:!0,value:a.GLSettings.Material.BlendingDstFactor.One}),Object.defineProperty(this,"_blendSrcFactor",{enumerable:!0,configurable:!0,writable:!0,value:a.GLSettings.Material.BlendingDstFactor.One}),Object.defineProperty(this,"_blendEquation",{enumerable:!0,configurable:!0,writable:!0,value:a.GLSettings.Material.BlendingEquations.Add}),Object.defineProperty(this,"_cullFace",{enumerable:!0,configurable:!0,writable:!0,value:a.GLSettings.Material.CullSide.NONE}),Object.defineProperty(this,"_colorMask",{enumerable:!0,configurable:!0,writable:!0,value:[!0,!0,!0,!0]}),Object.defineProperty(this,"_clearColor",{enumerable:!0,configurable:!0,writable:!0,value:[0,0,0,1]}),Object.defineProperty(this,"_depthFunc",{enumerable:!0,configurable:!0,writable:!0,value:a.GLSettings.Material.DepthFunctions.ALWAYS}),Object.defineProperty(this,"_depthTestEnabled",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_depthMask",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_ditheringEnabled",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_boundFBO",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_renderTarget",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_boundRBO",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_boundVAO",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_boundVBO",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_boundTexture",{enumerable:!0,configurable:!0,writable:!0,value:{id:null,unit:-1}}),Object.defineProperty(this,"_currentProgram",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_scissorTestEnabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_scissorBounds",{enumerable:!0,configurable:!0,writable:!0,value:{x:0,y:0,width:1,height:1}}),Object.defineProperty(this,"_currentUniforms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_activeTextureUnit",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"_drawBuffers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_textureWillBeUsed",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_viewport",{enumerable:!0,configurable:!0,writable:!0,value:{x:0,y:0,width:100,height:100}}),Object.defineProperty(this,"_enabledVertexAttributeArray",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_willUseVertexAttributeArray",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_vertexAttributeArrayDivisor",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.gl=e,this.extensions=t;for(var r=this.gl.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),n=0;n<r;++n)this._freeUnits.push((0,o.indexToTextureUnit)(e,n));this._activeTextureUnit=e.TEXTURE0}return Object.defineProperty(e.prototype,"blendingEnabled",{get:function(){return this._blendingEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendDstFactor",{get:function(){return this._blendDstFactor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendSrcFactor",{get:function(){return this._blendSrcFactor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendEquation",{get:function(){return this._blendEquation},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorMask",{get:function(){return this._colorMask},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clearColor",{get:function(){return this._clearColor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthTestEnabled",{get:function(){return this._depthTestEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ditheringEnabled",{get:function(){return this._ditheringEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundFBO",{get:function(){return this._boundFBO},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundRBO",{get:function(){return this._boundRBO},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundVAO",{get:function(){return this._boundVAO},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundVBO",{get:function(){return this._boundVBO},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boundTexture",{get:function(){return this._boundTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentProgram",{get:function(){return this._currentProgram},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scissorTestEnabled",{get:function(){return this._scissorTestEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scissorBounds",{get:function(){return this._scissorBounds},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentUniforms",{get:function(){return this._currentUniforms},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeTextureUnit",{get:function(){return this._activeTextureUnit},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawBuffers",{get:function(){return this._drawBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textureWillBeUsed",{get:function(){return this._textureWillBeUsed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enabledVertexAttributeArray",{get:function(){return this._enabledVertexAttributeArray.slice(0).filter((function(e){return void 0!==e}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bindVAO",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._boundVAO!==e&&(this._boundVAO=e,this.extensions.vao&&(this.extensions.vao instanceof WebGL2RenderingContext?this.extensions.vao.bindVertexArray(e):this.extensions.vao.bindVertexArrayOES(e)))}}),Object.defineProperty(e.prototype,"bindVBO",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._boundVBO!==e&&(this._boundVBO=e,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e))}}),Object.defineProperty(e.prototype,"bindRBO",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._boundRBO!==e&&(this._boundRBO=e,this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,e))}}),Object.defineProperty(e.prototype,"bindFBO",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._boundFBO!==e&&(this._boundFBO=e,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e))}}),Object.defineProperty(e.prototype,"bindTexture",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(e.gl&&e.gl.textureId&&(!e||this._boundTexture.id!==e.gl.textureId||this._boundTexture.unit!==this._activeTextureUnit)){switch(this._boundTexture={id:e.gl.textureId,unit:this._activeTextureUnit},t){case a.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D:this.gl.bindTexture(this.gl.TEXTURE_2D,e.gl.textureId);break;case a.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D:this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,e.gl.textureId)}var r=this._textureUnitToTexture.get(this._activeTextureUnit);r&&r.gl&&(r.gl.textureUnit=-1),this._textureUnitToTexture.set(this._activeTextureUnit,e),e.gl.textureUnit=this._activeTextureUnit}}}),Object.defineProperty(e.prototype,"disableVertexAttributeArray",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var e=0,t=this._enabledVertexAttributeArray.length;e<t;++e){var r=this._enabledVertexAttributeArray[e];this.gl.disableVertexAttribArray(r)}this._enabledVertexAttributeArray=[],this._willUseVertexAttributeArray=[],this._vertexAttributeArrayDivisor.clear()}}),Object.defineProperty(e.prototype,"willUseVertexAttributeArray",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._willUseVertexAttributeArray[e]=e,void 0===this._enabledVertexAttributeArray[e]&&(this._enabledVertexAttributeArray[e]=e,this.gl.enableVertexAttribArray(e))}}),Object.defineProperty(e.prototype,"applyVertexAttributeArrays",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var e=0,t=this._enabledVertexAttributeArray.length;e<t;++e){var r=this._enabledVertexAttributeArray[e];if(void 0!==r){if(void 0!==this._willUseVertexAttributeArray[r])return;this.gl.disableVertexAttribArray(r),delete this._enabledVertexAttributeArray[r]}}this._willUseVertexAttributeArray=[]}}),Object.defineProperty(e.prototype,"setVertexAttributeArrayDivisor",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this.extensions.instancing&&void 0!==this._enabledVertexAttributeArray[e]&&this._vertexAttributeArrayDivisor.get(e)!==t&&(this.extensions.instancing instanceof WebGL2RenderingContext?this.extensions.instancing.vertexAttribDivisor(e,t):this.extensions.instancing.vertexAttribDivisorANGLE(e,t),this._vertexAttributeArrayDivisor.set(e,t))}}),Object.defineProperty(e.prototype,"freeTextureUnit",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.gl&&e.gl.textureUnit>-1&&(this._freeUnits.unshift(e.gl.textureUnit),e.gl.textureUnit=-1)}}),Object.defineProperty(e.prototype,"setActiveTextureUnit",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._activeTextureUnit!==e&&(this._activeTextureUnit=e,this.gl.activeTexture(e))}}),Object.defineProperty(e.prototype,"setClearColor",{enumerable:!1,configurable:!0,writable:!0,value:function(e){(0,n.compare4)(e,this._clearColor)||(this._clearColor=(0,n.copy4)(e),this.applyClearColor())}}),Object.defineProperty(e.prototype,"setDrawBuffers",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=e.length!==this._drawBuffers.length;if(!r)for(var n=0,i=e.length;n<i;++n)if(this._drawBuffers[n]!==e[n]){r=!0;break}if(r){if(this.glProxy.extensions.drawBuffers instanceof WebGL2RenderingContext)t||this.glProxy.extensions.drawBuffers.drawBuffers(e);else{if(!this.glProxy.extensions.drawBuffers)return void console.warn("Attempted to use drawBuffers for MRT, but MRT is NOT supported by this hardware. Use multiple render targets instead");t||this.glProxy.extensions.drawBuffers.drawBuffersWEBGL(e)}this._drawBuffers=e}}}),Object.defineProperty(e.prototype,"setProxy",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.glProxy=e}}),Object.defineProperty(e.prototype,"setScissor",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e?(this._scissorTestEnabled||(this._scissorTestEnabled=!0,this.gl.enable(this.gl.SCISSOR_TEST)),e.x===this._scissorBounds.x&&e.y===this._scissorBounds.y&&e.width===this._scissorBounds.width&&e.height===this._scissorBounds.height||(this._scissorBounds=e,this.applyScissorBounds())):this._scissorTestEnabled&&(this._scissorTestEnabled=!1,this.gl.disable(this.gl.SCISSOR_TEST))}}),Object.defineProperty(e.prototype,"setViewport",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){e===this._viewport.x&&t===this._viewport.y&&r===this._viewport.width&&n===this._viewport.height||(this._viewport={x:e,y:t,width:r,height:n},this.applyViewport())}}),Object.defineProperty(e.prototype,"useProgram",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._currentProgram!==e&&(this._currentProgram=e,this.gl.useProgram(this._currentProgram))}}),Object.defineProperty(e.prototype,"useMaterial",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!e.gl){if(!this.glProxy.compileMaterial(e))return u.UseMaterialStatus.INVALID;if(!e.gl)return u.UseMaterialStatus.INVALID}if(!e.gl.programId||0===e.gl.programId.length)return u.UseMaterialStatus.INVALID;var t=this.findMaterialProgram(e);if(void 0===t)return console.warn("Could NOT determine a program for the given material that would appropriately match with the current RenderTarget"),u.UseMaterialStatus.NO_RENDER_TARGET_MATCHES;if(this._renderTarget&&(e.gl.programByTarget.set(this._renderTarget,t),this.glProxy.extensions.drawBuffers)){var r=e.gl.outputsByProgram.get(t),n=this._renderTarget.getGLBuffers();if(!r||!n)return console.warn("Could not establish the buffers to utilize for the render target"),u.UseMaterialStatus.NO_RENDER_TARGET_MATCHES;for(var i=[],o=function(e,t){var o=n[e];void 0===r.find((function(e){return(null==o?void 0:o.outputType)===e}))||a._renderTarget.disabledTargets.has((null==o?void 0:o.outputType)||0)?i.push(a.gl.NONE):i.push((null==o?void 0:o.attachment)||a.gl.NONE)},a=this,s=0,c=n.length;s<c;++s)o(s);this.setDrawBuffers(i)}return this.useProgram(t),this.syncMaterial(e),u.UseMaterialStatus.VALID}}),Object.defineProperty(e.prototype,"findMaterialProgram",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(e.gl){if(!this._renderTarget||this._renderTarget.isColorTarget()){var t;if(this._renderTarget&&void 0!==(t=e.gl.programByTarget.get(this._renderTarget)))return t;for(var r=Number.MAX_SAFE_INTEGER,n=0,o=e.gl.programId.length;n<o;++n){var a=e.gl.programId[n];a.outputTypes.length<r&&a.outputTypes.indexOf(i.FragmentOutputType.COLOR)>=0&&(t=a.id,r=a.outputTypes.length)}return t||(t=e.gl.programId[e.gl.programId.length-1]),t}var s=e.gl.programByTarget.get(this._renderTarget);if(void 0!==s)return s;var u=new Set,c=this._renderTarget.getBuffers();for(n=0,o=c.length;n<o;++n){var l=c[n];l&&u.add(l.outputType)}var f=0,d=[];for(n=0,o=e.gl.programId.length;n<o;++n){for(var p=e.gl.programId[n],h=0,b=0,g=p.outputTypes.length;b<g;++b){var v=p.outputTypes[b];u.has(v)&&h++}h>f?(f=h,d=[p]):h===f&&d.push(p)}if(0!==d.length)return 1===d.length?s=d[0].id:d.length>1&&(s=d.reduce((function(e,t){return t.outputTypes.length<e.outputTypes.length?t:e}))),s}}}),Object.defineProperty(e.prototype,"useRenderTarget",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return e?!!e.gl&&(this.bindFBO(e.gl.fboId),this._renderTarget=e,!0):(this.bindFBO(null),this._renderTarget=null,!0)}}),Object.defineProperty(e.prototype,"syncMaterial",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;return this.setDepthMask(e.depthWrite),this.setDepthTest(e.depthTest),this.setDepthFunc(e.depthFunc),this.setBlending(e.blending),this.setCullFace(e.culling),this.setColorMask(e.colorWrite),this.setDithering(e.dithering),this._currentUniforms=e.uniforms,!!this._currentProgram&&(Object.entries(e.uniforms).forEach((function(e){var r=e[0],n=e[1];if(t._currentProgram){n.gl||(n.gl=new Map);var i=n.gl.get(t._currentProgram);if(!i){var o=t.gl.getUniformLocation(t._currentProgram,r);if(!o)return i={location:void 0},void c(t.debugContext,"A Material specified a uniform ".concat(r,", but none was found in the current program."));i={location:o},n.gl.set(t._currentProgram,i)}i.location&&t.uploadUniform(i.location,n)}})),!(this._textureWillBeUsed.size>0&&!this.applyUsedTextures()))}}),Object.defineProperty(e.prototype,"setDepthMask",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._depthMask!==e&&(this._depthMask=e,this.gl.depthMask(this._depthMask))}}),Object.defineProperty(e.prototype,"setDepthTest",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._depthTestEnabled!==e&&(this._depthTestEnabled=e,this._depthTestEnabled?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST))}}),Object.defineProperty(e.prototype,"setDepthFunc",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._depthFunc!==e&&(this._depthFunc=e,this.applyDepthFunc())}}),Object.defineProperty(e.prototype,"setBlending",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e?(this._blendingEnabled||(this.gl.enable(this.gl.BLEND),this._blendingEnabled=!0),this._blendDstFactor===e.blendDst&&this._blendSrcFactor===e.blendSrc&&this._blendEquation===e.blendEquation||(this._blendDstFactor=e.blendDst||this._blendDstFactor,this._blendSrcFactor=e.blendSrc||this._blendSrcFactor,this._blendEquation=e.blendEquation||this._blendEquation,this.applyBlendFactors())):this._blendingEnabled&&(this.gl.disable(this.gl.BLEND),this._blendingEnabled=!1)}}),Object.defineProperty(e.prototype,"setDithering",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._ditheringEnabled!==e&&(this._ditheringEnabled=e,this._ditheringEnabled?this.gl.enable(this.gl.DITHER):this.gl.disable(this.gl.DITHER))}}),Object.defineProperty(e.prototype,"setColorMask",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._colorMask[0]===e[0]&&this._colorMask[1]===e[1]&&this._colorMask[2]===e[2]&&this._colorMask[3]===e[3]||(this._colorMask=e,this.applyColorMask())}}),Object.defineProperty(e.prototype,"setCullFace",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._cullFace!==e&&(this._cullFace=e,this.applyCullFace())}}),Object.defineProperty(e.prototype,"uploadUniform",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r;switch(t.type){case u.MaterialUniformType.FLOAT:r=t.value,this.gl.uniform1f(e,r);break;case u.MaterialUniformType.VEC2:r=t.value,this.gl.uniform2f(e,r[0],r[1]);break;case u.MaterialUniformType.VEC3:r=t.value,this.gl.uniform3f(e,r[0],r[1],r[2]);break;case u.MaterialUniformType.VEC4:r=t.value,this.gl.uniform4f(e,r[0],r[1],r[2],r[3]);break;case u.MaterialUniformType.VEC4_ARRAY:r=t.value,this.gl.uniform4fv(e,(0,n.flatten4)(r));break;case u.MaterialUniformType.MATRIX3x3:r=t.value,this.gl.uniformMatrix3fv(e,!1,r);break;case u.MaterialUniformType.MATRIX4x4:r=t.value,this.gl.uniformMatrix4fv(e,!1,r);break;case u.MaterialUniformType.FLOAT_ARRAY:r=t.value,this.gl.uniform1fv(e,r);break;case u.MaterialUniformType.TEXTURE:r=t.value,this.willUseTextureUnit(r,e);break;default:console.warn(this.debugContext,"A uniform specified an unrecognized type. It will not sync with the GPU:",t)}}}),Object.defineProperty(e.prototype,"applyUsedTextures",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=this.assignTextureUnits(Array.from(this._textureWillBeUsed.keys()));t.forEach((function(t){t.gl?t.gl.textureUnit=e.gl.TEXTURE0:t.gl={textureId:null,textureUnit:e.gl.TEXTURE0,proxy:e.glProxy}}));var r=new Map,n=new Set;return this._textureWillBeUsed.forEach((function(e,t){e instanceof s.RenderTarget?n.add(e):r.set(t,e)})),n.forEach((function(r){r.getTextures().some((function(r){return!(t.indexOf(r)<0)||(e.glProxy.updateTexture(r),!1)}))?console.warn(e.debugContext,"A RenderTarget can not be used because all of it's textures could not be compiled."):e.glProxy.compileRenderTarget(r)})),r.forEach((function(r,n){t.indexOf(n)<0?(e.glProxy.updateTexture(n),r.forEach((function(t){e.uploadTextureToUniform(t,n)}))):r.forEach((function(t){e.gl.uniform1i(t,(0,o.textureUnitToIndex)(e.gl,0))}))})),this._textureWillBeUsed.clear(),!0}}),Object.defineProperty(e.prototype,"assignTextureUnits",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=[],r=[];for(e.forEach((function(e){!e.gl||e.gl.textureUnit<0?t.push(e):r.push(e)}));this._freeUnits.length>0&&t.length>0;){if(o=t.shift())void 0!==(a=this._freeUnits.shift())?(o.gl?o.gl.textureUnit=a:o.gl={textureId:null,textureUnit:a,proxy:this.glProxy},r.push(o)):t.unshift(o)}if(t.length<=0)return t;c("WARNING: Too many textures in use are causing texture units to be swapped. Doing this occasionally is fine, but handling this on a frame loop can have serious performance concerns.");var n=new Map;this._textureUnitToTexture.forEach((function(e){e&&n.set(e,!1)})),r.forEach((function(e){n.set(e,!0)}));var i=[];if(n.forEach((function(e,t){e||i.push(t)})),0===i.length)return console.warn(this.debugContext,"There are too many textures being used for a single draw call. These textures will not be utilized on the GPU",t),console.warn("Current GL State:",this),t;for(;i.length>0&&t.length>0;){var o,a;if(o=t.shift())void 0===(a=i.shift())||!a.gl||a.gl.textureUnit<0?t.unshift(o):(o.gl?o.gl.textureUnit=a.gl.textureUnit:o.gl={textureId:null,textureUnit:a.gl.textureUnit,proxy:this.glProxy},r.push(o))}return t.length>0&&(console.error(this.debugContext,"There are too many textures being used for a single draw call. These textures will not be utilized on the GPU",t),console.warn("Current GL State:",this)),t}}),Object.defineProperty(e.prototype,"uploadTextureToUniform",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){t.gl&&t.gl.textureUnit>=0?this.gl.uniform1i(e,(0,o.textureUnitToIndex)(this.gl,t.gl.textureUnit)):console.warn(this.debugContext,"Attempted to set a Texture Object to a uniform, but the Texture object did not have a valid texture unit.",t)}}),Object.defineProperty(e.prototype,"willUseTextureUnit",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this._textureWillBeUsed.get(e);t instanceof s.RenderTarget?r?r instanceof s.RenderTarget&&r!==t&&console.warn(this.debugContext,"A Texture is attempting to be used by two different render targets in a single draw."):this._textureWillBeUsed.set(e,t):r?r instanceof s.RenderTarget?console.warn(this.debugContext,"A texture in a single draw is attempting to attach to a uniform AND a render target which is invalid."):r.add(t):this._textureWillBeUsed.set(e,new Set([t]))}}),Object.defineProperty(e.prototype,"syncState",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.gl;this._blendingEnabled?e.enable(e.BLEND):e.disable(e.BLEND),this._ditheringEnabled?e.enable(e.DITHER):e.disable(e.DITHER),this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.setActiveTextureUnit(this._activeTextureUnit),this.applyClearColor(),this.applyCullFace(),this.applyBlendFactors(),this.applyBlendEquation(),this.applyColorMask(),this.applyDepthFunc(),this.applyScissorBounds(),this.applyViewport(),e.depthMask(this._depthMask)}}),Object.defineProperty(e.prototype,"applyClearColor",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.gl.clearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3])}}),Object.defineProperty(e.prototype,"applyDepthFunc",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.gl;switch(this._depthFunc){case a.GLSettings.Material.DepthFunctions.ALWAYS:e.depthFunc(e.ALWAYS);break;case a.GLSettings.Material.DepthFunctions.EQUAL:e.depthFunc(e.EQUAL);break;case a.GLSettings.Material.DepthFunctions.GREATER:e.depthFunc(e.GREATER);break;case a.GLSettings.Material.DepthFunctions.GREATER_OR_EQUAL:e.depthFunc(e.GEQUAL);break;case a.GLSettings.Material.DepthFunctions.LESS:e.depthFunc(e.LESS);break;case a.GLSettings.Material.DepthFunctions.LESS_OR_EQUAL:e.depthFunc(e.LEQUAL);break;case a.GLSettings.Material.DepthFunctions.NEVER:e.depthFunc(e.NEVER);break;case a.GLSettings.Material.DepthFunctions.NOTEQUAL:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.ALWAYS)}}}),Object.defineProperty(e.prototype,"applyScissorBounds",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.gl.scissor(this._scissorBounds.x,this._scissorBounds.y,this._scissorBounds.width,this._scissorBounds.height)}}),Object.defineProperty(e.prototype,"applyColorMask",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.gl.colorMask(this.colorMask[0]||!1,this.colorMask[1]||!1,this.colorMask[2]||!1,this.colorMask[3]||!1)}}),Object.defineProperty(e.prototype,"applyBlendEquation",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.gl;switch(this._blendEquation){case a.GLSettings.Material.BlendingEquations.Add:e.blendEquation(e.FUNC_ADD);break;case a.GLSettings.Material.BlendingEquations.Subtract:e.blendEquation(e.FUNC_SUBTRACT);break;case a.GLSettings.Material.BlendingEquations.ReverseSubtract:e.blendEquation(e.FUNC_REVERSE_SUBTRACT)}}}),Object.defineProperty(e.prototype,"applyBlendFactors",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,t,r=this.gl;switch(this._blendDstFactor){case a.GLSettings.Material.BlendingDstFactor.DstAlpha:e=r.BLEND_DST_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.DstColor:e=r.BLEND_DST_RGB;break;case a.GLSettings.Material.BlendingDstFactor.One:e=r.ONE;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusDstAlpha:e=r.ONE_MINUS_DST_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusDstColor:e=r.ONE_MINUS_DST_COLOR;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha:e=r.ONE_MINUS_SRC_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusSrcColor:e=r.ONE_MINUS_SRC_COLOR;break;case a.GLSettings.Material.BlendingDstFactor.SrcAlpha:e=r.SRC_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.SrcColor:e=r.SRC_COLOR;break;case a.GLSettings.Material.BlendingDstFactor.Zero:e=r.ZERO;break;default:e=r.ONE}switch(this._blendSrcFactor){case a.GLSettings.Material.BlendingDstFactor.DstAlpha:t=r.BLEND_DST_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.DstColor:t=r.BLEND_DST_RGB;break;case a.GLSettings.Material.BlendingDstFactor.One:t=r.ONE;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusDstAlpha:t=r.ONE_MINUS_DST_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusDstColor:t=r.ONE_MINUS_DST_COLOR;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha:t=r.ONE_MINUS_SRC_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusSrcColor:t=r.ONE_MINUS_SRC_COLOR;break;case a.GLSettings.Material.BlendingDstFactor.SrcAlpha:t=r.SRC_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.SrcColor:t=r.SRC_COLOR;break;case a.GLSettings.Material.BlendingDstFactor.Zero:t=r.ZERO;break;case a.GLSettings.Material.BlendingSrcFactor.SrcAlphaSaturate:t=r.SRC_ALPHA_SATURATE;break;default:t=r.ONE}r.blendFunc(t,e)}}),Object.defineProperty(e.prototype,"applyCullFace",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.gl;switch(this._cullFace!==a.GLSettings.Material.CullSide.NONE&&e.enable(e.CULL_FACE),this._cullFace){case a.GLSettings.Material.CullSide.CW:e.frontFace(e.CW),e.cullFace(e.FRONT);break;case a.GLSettings.Material.CullSide.CCW:e.frontFace(e.CCW),e.cullFace(e.FRONT);break;case a.GLSettings.Material.CullSide.BOTH:e.frontFace(e.CW),e.cullFace(e.FRONT_AND_BACK);break;default:e.disable(e.CULL_FACE)}}}),Object.defineProperty(e.prototype,"applyViewport",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.gl.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)}}),e}();t.GLState=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Scene=void 0;var n=function(){function e(){Object.defineProperty(this,"models",{enumerable:!0,configurable:!0,writable:!0,value:new Set})}return Object.defineProperty(e.prototype,"add",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.models.add(e)}}),Object.defineProperty(e.prototype,"remove",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.models.delete(e)}}),e}();t.Scene=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLRenderer=void 0;var n=r(68),i=r(71),o=r(26),a=r(14),s=r(5)("performance"),u=function(){function e(e){Object.defineProperty(this,"_gl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"glProxy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"glState",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{clearMask:[!1,!1,!1],currentRenderTarget:null,displaySize:[1,1],pixelRatio:1,renderSize:[1,1]}}),this.options=Object.assign({alpha:!1,antialias:!1,preserveDrawingBuffer:!1},e),this.options.canvas||console.warn("WebGLRenderer ERROR: A canvas is REQUIRED as a parameter."),this.getContext()}return Object.defineProperty(e.prototype,"debugContext",{set:function(e){this.glProxy&&(this.glProxy.debugContext=e),this.glState&&(this.glState.debugContext=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gl",{get:function(){return this._gl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clear",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=this.state.clearMask;this.state.clearMask=[n[0]||e||!1,n[1]||t||!1,n[2]||r||!1]}}),Object.defineProperty(e.prototype,"clearColor",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e&&this.glState.setClearColor(e)}}),Object.defineProperty(e.prototype,"dispose",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Object.defineProperty(e.prototype,"getContext",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this._gl)return this._gl;var e=n.GLProxy.getContext(this.options.canvas,{alpha:this.options.alpha||!1,antialias:this.options.antialias||!1,premultipliedAlpha:this.options.premultipliedAlpha||!1,preserveDrawingBuffer:this.options.preserveDrawingBuffer||!1});return e.context?(this._gl=e.context,this.glState=new i.GLState(e.context,e.extensions),this.glProxy=new n.GLProxy(e.context,this.glState,e.extensions),this.glState.setProxy(this.glProxy),this.glState.syncState()):this.options.onNoContext?this.options.onNoContext():console.warn("No context was able to be produced, and the handler onNoContext was not implemented for such cases."),this._gl}}),Object.defineProperty(e.prototype,"getDisplaySize",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.state.displaySize}}),Object.defineProperty(e.prototype,"getPixelRatio",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.state.pixelRatio}}),Object.defineProperty(e.prototype,"getRenderSize",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.state.renderSize}}),Object.defineProperty(e.prototype,"getFullViewport",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.state.currentRenderTarget;if(Array.isArray(e))return{x:0,y:0,width:e[0].width,height:e[0].height};if(e)return{x:0,y:0,width:e.width,height:e.height};var t=this.getRenderSize();return{x:0,y:0,width:t[0],height:t[1]}}}),Object.defineProperty(e.prototype,"prepareAttribute",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return this.glProxy.updateAttribute(t)?(e.gl&&e.gl.vao||this.glProxy.useAttribute(r,t,e),!0):(console.warn("Could not update attribute",t),!1)}}),Object.defineProperty(e.prototype,"render",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=this;if(void 0===t&&(t=null),this.gl){this.setRenderTarget(t);var i=[];if(t&&!Array.isArray(t)&&(a.WebGLStat.MRT||a.WebGLStat.MRT_EXTENSION)){var o=t.getGLBuffers();this.glState.setDrawBuffers(o.map((function(e){return(null==e?void 0:e.attachment)||0})))}var s=this.state.clearMask;if((s[0]||s[1]||s[2])&&(this.glProxy.clear(s[0],s[1],s[2]),this.state.clearMask=[!1,!1,!1]),Array.isArray(t))for(var u=0,c=t.length;u<c;++u){var l=t[u];if(this.glState.useRenderTarget(l),l&&!l.gl)return;e.models.forEach((function(e){n.renderModel(e,i,r)}))}else{if(t&&!t.gl)return;e.models.forEach((function(e){n.renderModel(e,i,r)}))}i.forEach((function(t){e.remove(t)}))}}}),Object.defineProperty(e.prototype,"renderModel",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n,i=this,a=e.geometry,u=e.material;switch(this.glState.useMaterial(u)){case o.UseMaterialStatus.VALID:this.glProxy.compileGeometry(a);var c=!0;a.attributes.forEach((function(e,t){c=i.prepareAttribute(a,e,t)&&c})),(null===(n=a.gl)||void 0===n?void 0:n.vao)?this.glState.bindVAO(a.gl.vao):this.glState.applyVertexAttributeArrays(),null==r||r(this.glState,e.id),c?this.glProxy.draw(e):(console.warn("Geometry was unable to update correctly, thus we are skipping the drawing of",e),t.push(e)),this.glState.bindVAO(null);break;case o.UseMaterialStatus.INVALID:console.warn("Could not utilize material. Skipping draw call for:",u,a),t.push(e);break;case o.UseMaterialStatus.NO_RENDER_TARGET_MATCHES:s("Skipped draw for material due to no output matches for the current render target");break;default:s("Skipped draw for material due to unknown reasons")}}}),Object.defineProperty(e.prototype,"readPixels",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i,o){if(void 0===o&&(o=0),this.gl){var a,s=this.state.currentRenderTarget,u=!0;if(Array.isArray(s))a=s.find((function(e){var t;return Array.isArray(e.buffers.color)?e.buffers.color.find((function(e){return e.outputType===o})):(null===(t=e.buffers.color)||void 0===t?void 0:t.outputType)===o}));else if(s&&Array.isArray(null==s?void 0:s.buffers.color)){if(s.buffers.color.length>1)return void console.warn("It is not yet implemented to read the pixels from a RenderTarget with multiple color buffers");a=s}else a=s;if(a&&(u=a.validFramebuffer),u)if(e=Math.max(0,e),t=Math.max(0,t),a){e+r>a.width&&(r=a.width-e),t+n>a.height&&(n=a.height-t);var c=a.height;this.gl.readPixels(e,c-t-n,r,n,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i)}else{var l=this.getRenderSize();c=l[1];e+r>l[0]&&(r=l[0]-e),t+n>l[1]&&(n=l[1]-t),this.gl.readPixels(e,c-t-n,r,n,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i)}else console.warn("Framebuffer is incomplete. Can not read pixels at this time.")}}}),Object.defineProperty(e.prototype,"setClearColor",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.glState.setClearColor(e)}}),Object.defineProperty(e.prototype,"setPixelRatio",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.options.canvas,r=this.getDisplaySize();t.width=r[0]*e,t.height=r[1]*e,this.state.pixelRatio=e}}),Object.defineProperty(e.prototype,"setScissor",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(t=t||this.state.currentRenderTarget||null,Array.isArray(t)){var r=t[0].height;if(e){var n=e.x,i=e.y,o=e.width,a=e.height;this.glState.setScissor({x:n,y:r-i-a,width:o,height:a})}else this.glState.setScissor(null)}else if(t){r=t.height;if(e){n=e.x,i=e.y,o=e.width,a=e.height;this.glState.setScissor({x:n,y:r-i-a,width:o,height:a})}else this.glState.setScissor(null)}else{r=this.state.renderSize[1];if(e){n=e.x,i=e.y,o=e.width,a=e.height;this.glState.setScissor({x:n,y:r-i-a,width:o,height:a})}else this.glState.setScissor(null)}}}),Object.defineProperty(e.prototype,"setSize",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this.options.canvas,n=this.state.pixelRatio;r.width=Math.min(e*n,a.WebGLStat.MAX_TEXTURE_SIZE),r.height=Math.min(t*n,a.WebGLStat.MAX_TEXTURE_SIZE),r.style.width="".concat(e,"px"),r.style.height="".concat(t,"px"),this.state.renderSize=[r.width,r.height],this.state.displaySize=[e,t]}}),Object.defineProperty(e.prototype,"setRenderTarget",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;this.state.currentRenderTarget!==e&&(Array.isArray(e)?e.forEach((function(e){e.gl||t.glProxy.compileRenderTarget(e)})):!this.glState.useRenderTarget(e)&&e&&(e.getTextures().forEach((function(r){t.glState.willUseTextureUnit(r,e)})),this.glState.applyUsedTextures(),this.glProxy.compileRenderTarget(e)&&this.glState.useRenderTarget(e)),this.state.currentRenderTarget=e)}}),Object.defineProperty(e.prototype,"setViewport",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.state.currentRenderTarget,r=e.x,n=e.y,i=e.width,o=e.height;if(Array.isArray(t)){var a=t[0].height;this.glState.setViewport(r,a-n-o,i,o)}else if(t){a=t.height;this.glState.setViewport(r,a-n-o,i,o)}else{a=this.state.renderSize[1];this.glState.setViewport(r,a-n-o,i,o)}}}),e}();t.WebGLRenderer=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAbsolutePositionBounds=void 0;var n=r(7);function i(e,t,r){var n="".concat(e),i=parseFloat(n);return isNaN(i)?0:n.indexOf("%")>-1?i/100*t:i*r}t.getAbsolutePositionBounds=function(e,t,r){0!==t.width&&0!==t.height||console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are non-zero.","item:",e,"reference:",t.toString());var o,a,s=n.Bounds.emptyBounds();if(e.width)s.width=i(e.width,t.width,r),void 0!==e.left?s.x=i(e.left,t.width,r):void 0!==e.right&&(s.x=t.width-i(e.right,t.width,r)-s.width);else{var u=i(e.left||0,t.width,r);(o=t.width-i(e.right||0,t.width,r)-u)<0&&console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are greater than zero.","item:",e,"reference:",t.toString()),s.x=u,s.width=o}if(e.height)s.height=i(e.height,t.height,r),void 0!==e.top?s.y=i(e.top,t.height,r):void 0!==e.bottom&&(s.y=t.height-i(e.bottom,t.height,r)-s.height);else{var c=i(e.top||0,t.height,r);(void 0===(a=t.height-i(e.bottom||0,t.height,r)-c)||a<0)&&console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are greater than zero.","item:",e,"reference:",t.toString()),s.y=c,s.height=a}return(0===s.width||0===s.height||isNaN(s.x+s.y+s.width+s.height))&&(s.x=0,s.y=0,s.width=t.width,s.height=t.height),s}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EasingProps=void 0;var n=function(){function e(e){Object.defineProperty(this,"delay",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"duration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isManualStart",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isTimeSet",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"start",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"startTime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.assign(this,e)}return Object.defineProperty(e.prototype,"setAutomatic",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.isManualStart=!1,this.isTimeSet=!1}}),Object.defineProperty(e.prototype,"setStart",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e&&(this.start.length!==e.length?console.warn("A manual easing adjustment provided an incompatible value for the easing type."):(this.start=e,this.isManualStart=!0))}}),Object.defineProperty(e.prototype,"setTiming",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this.delay=void 0===e?this.delay:e,this.duration=void 0===t?this.duration:t,this.isTimeSet=!0}}),e}();t.EasingProps=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ColorBufferResource=t.isColorBufferResource=t.createColorBuffer=void 0;var a=r(4),s=r(69),u=r(0),c=r(17);t.createColorBuffer=function(e){return o({key:"",type:u.ResourceType.COLOR_BUFFER},e)},t.isColorBufferResource=function(e){return void 0!==e&&void 0!==e.key&&e.type===u.ResourceType.COLOR_BUFFER};var l=function(e){function t(t,r){var n=e.call(this,t)||this;return Object.defineProperty(n,"type",{enumerable:!0,configurable:!0,writable:!0,value:u.ResourceType.COLOR_BUFFER}),Object.defineProperty(n,"height",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"width",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"colorBufferSettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"colorBuffer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n.height=t.height,n.width=t.width,n.colorBufferSettings=t.colorBufferSettings,n.createColorBuffer(r),n}return i(t,e),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.colorBuffer.destroy()}}),Object.defineProperty(t.prototype,"createColorBuffer",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!this.colorBuffer){var t,r;this.colorBufferSettings=o({},this.colorBufferSettings);var n=(null==e?void 0:e.getRenderSize())||[1,1];if(this.width<=u.TextureSize.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");t=n[0]/-this.width}else t=this.width;if(this.height<=u.TextureSize.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");r=n[1]/-this.width}else r=this.height;this.colorBuffer=new s.ColorBuffer(o({internalFormat:a.GLSettings.RenderTarget.ColorBufferFormat.RGBA4,size:[t,r]},this.colorBufferSettings))}}}),t}(c.IdentifyByKey);t.ColorBufferResource=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.kQuat=t.jQuat=t.iQuat=t.oneQuat=t.slerpUnitQuat=t.rotateVectorByUnitQuat=t.lookAtMatrix=t.decomposeRotation=t.matrix4x4ToQuaternion=t.matrix3x3ToQuaternion=t.lookAtQuat=t.eulerToQuat=t.matrix4x4FromUnitQuatView=t.matrix3x3FromUnitQuatView=t.matrix4x4FromUnitQuatModel=t.matrix3x3FromUnitQuatModel=t.axisQuat=t.angleQuat=t.toOrderedEulerFromQuat2=t.toOrderedEulerFromQuat=t.toEulerFromQuat=t.toEulerXYZfromOrderedEuler=t.fromOrderedEulerToQuat=t.fromEulerAxisAngleToQuat=t.dotQuat=t.imaginaryQuat=t.realQuat=t.normalizeQuat=t.lengthQuat=t.inverseQuat=t.conjugateQuat=t.diffUnitQuat=t.scaleQuat=t.exponentQuat=t.divideQuat=t.multiplyQuat=t.addQuat=t.zeroQuat=t.clamp=t.QW=t.QZ=t.QY=t.QX=t.QR4=t.QR3=t.QR2=t.QR1=void 0;var n,i,o,a,s,u,c,l,f,d,p,h,b,g,v,y,m,w,O=r(0),_=r(36),T=r(2),P=Math.cos,x=Math.sin,E=Math.sqrt,j=Math.exp,S=Math.acos,R=Math.atan2,M=Math.PI;function A(e,t,r){return e>r?r:e<t?t:e}function I(e){return e?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):[0,0,0,0]}function L(e,t,r){r=r||I();var n=e[0],i=t[0],o=e[1],a=t[1],s=e[2],u=t[2],c=e[3],l=t[3];return r[0]=n*i-o*a-s*u-c*l,r[1]=n*a+o*i+s*l-c*u,r[2]=n*u-o*l+s*i+c*a,r[3]=n*l+o*u-s*a+c*i,r}function C(e,t,r){return(r=r||I())[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function B(e,t){return(t=t||I())[0]=e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function D(e){var t=e[0],r=e[1],n=e[2],i=e[3];return E(t*t+r*r+n*n+i*i)}function F(e,t,r){r=r||I();var n=e[0],i=e[1],o=e[2],a=Math.cos,s=Math.sin,u=a(n/2),c=a(i/2),l=a(o/2),f=s(n/2),d=s(i/2),p=s(o/2);switch(t){case O.EulerOrder.xyz:r[1]=f*c*l+u*d*p,r[2]=u*d*l-f*c*p,r[3]=u*c*p+f*d*l,r[0]=u*c*l-f*d*p;break;case O.EulerOrder.yxz:r[0]=u*c*l+f*d*p,r[1]=f*c*l+u*d*p,r[2]=u*d*l-f*c*p,r[3]=u*c*p-f*d*l;break;case O.EulerOrder.zxy:r[0]=u*c*l-f*d*p,r[1]=f*c*l-u*d*p,r[2]=u*d*l+f*c*p,r[3]=u*c*p+f*d*l;break;case O.EulerOrder.zyx:r[0]=u*c*l+f*d*p,r[1]=f*c*l-u*d*p,r[2]=u*d*l+f*c*p,r[3]=u*c*p-f*d*l;break;case O.EulerOrder.yzx:r[0]=u*c*l-f*d*p,r[1]=f*c*l+u*d*p,r[2]=u*d*l+f*c*p,r[3]=u*c*p-f*d*l;break;case O.EulerOrder.xzy:r[0]=u*c*l+f*d*p,r[1]=f*c*l-u*d*p,r[2]=u*d*l-f*c*p,r[3]=u*c*p+f*d*l}return r}function N(e,t,r,n,i,o){o[0]=R(e,t),o[1]=S(r),o[2]=R(n,i)}function U(e,t,r){r=r||[0,0,0];var n=e[0],i=e[1],o=e[2],a=e[3],s=G(e),u=s[0],c=s[4],l=s[8],f=s[1],d=s[5],p=s[9],h=s[2],b=s[6],g=s[10];switch(t){case O.EulerOrder.zyx:r[1]=Math.asin(-A(h,-1,1)),Math.abs(h)<.99999?(r[0]=Math.atan2(b,g),r[2]=Math.atan2(f,u)):(r[0]=0,r[2]=Math.atan2(-c,d));break;case O.EulerOrder.zyz:N(2*o*a+2*n*i,2*n*o-2*i*a,a*a-o*o-i*i+n*n,2*o*a-2*n*i,2*i*a+2*n*o,r);break;case O.EulerOrder.zxy:r[0]=Math.asin(A(b,-1,1)),Math.abs(b)<.99999?(r[1]=Math.atan2(-h,g),r[2]=Math.atan2(-c,d)):(r[1]=0,r[2]=Math.atan2(f,u));break;case O.EulerOrder.zxz:N(2*i*a-2*n*o,2*o*a+2*n*i,a*a-o*o-i*i+n*n,2*i*a+2*n*o,2*n*i-2*o*a,r);break;case O.EulerOrder.yxz:r[0]=Math.asin(-A(p,-1,1)),Math.abs(p)<.9999?(r[1]=Math.atan2(l,g),r[2]=Math.atan2(f,d)):(r[1]=Math.atan2(-h,u),r[2]=0);break;case O.EulerOrder.yxy:N(2*i*o+2*n*a,2*n*i-2*o*a,o*o-a*a+n*n-i*i,2*i*o-2*n*a,2*o*a+2*n*i,r);break;case O.EulerOrder.yzx:r[2]=Math.asin(A(f,-1,1)),Math.abs(f)<.99999?(r[0]=Math.atan2(-p,d),r[1]=Math.atan2(-h,u)):(r[0]=0,r[1]=Math.atan2(l,g));break;case O.EulerOrder.yzy:N(2*o*a-2*n*i,2*i*o+2*n*a,o*o-a*a+n*n-i*i,2*o*a+2*n*i,2*n*a-2*i*o,r);break;case O.EulerOrder.xyz:r[1]=Math.asin(A(l,-1,1)),Math.abs(l)<.99999?(r[0]=Math.atan2(-p,g),r[2]=Math.atan2(-c,u)):(r[0]=Math.atan2(b,d),r[2]=0);break;case O.EulerOrder.xyx:N(2*i*o-2*n*a,2*i*a+2*n*o,i*i+n*n-a*a-o*o,2*i*o+2*n*a,2*n*o-2*i*a,r);break;case O.EulerOrder.xzy:r[2]=Math.asin(-A(c,-1,1)),Math.abs(c)<.99999?(r[0]=Math.atan2(b,d),r[1]=Math.atan2(l,u)):(r[0]=Math.atan2(-p,g),r[1]=0);break;case O.EulerOrder.xzx:N(2*i*a+2*n*o,2*n*a-2*i*o,i*i+n*n-a*a-o*o,2*i*a-2*n*o,2*i*o+2*n*a,r);break;default:console.warn("Invalid Euler rotation order.")}return r}function G(e,t){var r,n,i,o,a,s,u,c,l,f,d,p;return t=t||(0,_.identity4)(),f=e[1]+e[1],d=e[2]+e[2],p=e[3]+e[3],o=e[1]*f,u=e[1]*d,c=e[1]*p,a=e[2]*d,s=e[2]*p,l=e[3]*p,r=e[0]*f,n=e[0]*d,i=e[0]*p,t[_.M400]=1-(a+l),t[_.M410]=u-i,t[_.M420]=c+n,t[_.M430]=0,t[_.M401]=u+i,t[_.M411]=1-(o+l),t[_.M421]=s-r,t[_.M431]=0,t[_.M402]=c-n,t[_.M412]=s+r,t[_.M422]=1-(o+a),t[_.M432]=0,t[_.M403]=0,t[_.M413]=0,t[_.M423]=0,t[_.M433]=1,t}t.QR1=I(),t.QR2=I(),t.QR3=I(),t.QR4=I(),t.QX=1,t.QY=2,t.QZ=3,t.QW=0,t.clamp=A,t.zeroQuat=I,t.addQuat=function(e,t,r){return(r=r||I())[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r},t.multiplyQuat=L,t.divideQuat=function(e,t,r){r=r||I();var n=e[0],i=e[1],o=e[2],a=e[3],s=t[0],u=t[1],c=t[2],l=t[3],f=s*s+u*u+c*c+l*l;if(0===f)r[0]=0,r[1]=0,r[2]=0,r[3]=0;else{var d=1/f;r[0]=(n*s+i*u+o*c+a*l)*d,r[1]=(i*s-n*u-o*l+a*c)*d,r[2]=(o*s-n*c-a*u+i*l)*d,r[3]=(a*s-n*l-i*c+o*u)*d}return r},t.exponentQuat=function(e,t){t=t||I();var r=e[0],n=e[1],i=e[2],o=e[3],a=E(n*n+i*i+o*o),s=j(r),u=s/a*x(a);return 0===a?(t[0]=j(r),t[1]=0,t[2]=0,t[3]=0):(t[0]=s*P(a),t[1]=n*u,t[2]=i*u,t[3]=o*u),t},t.scaleQuat=C,t.diffUnitQuat=function(e,t,r){return r=r||I(),L(t,B(e),r)},t.conjugateQuat=B,t.inverseQuat=function(e,t){t=t||I();var r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o;if(0===a)t[0]=0,t[1]=0,t[2]=0,t[3]=0;else{var s=1/a;t[0]=r*s,t[1]=-n*s,t[2]=-i*s,t[3]=-o*s}return t},t.lengthQuat=D,t.normalizeQuat=function(e,t){t=t||I();var r=D(e);return 0===r?[0,0,0,0]:C(e,1/r,t)},t.realQuat=function(e){return e[0]},t.imaginaryQuat=function(e){return[e[1],e[2],e[3]]},t.dotQuat=function(e,t){return(0,T.dot4)(e,t)},t.fromEulerAxisAngleToQuat=function(e,t,r){r=r||I();var n=e[0],i=e[1],o=e[2],a=1/E(n*n+i*i+o*o),s=x(t/2);return r[0]=P(t/2),r[1]=s*n*a,r[2]=s*i*a,r[3]=s*o*a,r},t.fromOrderedEulerToQuat=F,t.toEulerXYZfromOrderedEuler=function(e,t,r){return r=r||[0,0,0],U(F(e,t),O.EulerOrder.xyz,r),r},t.toEulerFromQuat=function(e,t){return U(e,O.EulerOrder.zyx,t)},t.toOrderedEulerFromQuat=U,t.toOrderedEulerFromQuat2=function(e,t,r){r=r||[0,0,0];var n=G(e),i=n[0],o=n[4],a=n[8],s=n[1],u=n[5],c=n[9],l=n[2],f=n[6],d=n[10];switch(t){case O.EulerOrder.xyz:r[1]=Math.asin(A(a,-1,1)),Math.abs(a)<.99999?(r[0]=Math.atan2(-c,d),r[2]=Math.atan2(-o,i)):(r[0]=Math.atan2(f,u),r[2]=0);break;case O.EulerOrder.yxz:r[0]=Math.asin(-A(c,-1,1)),Math.abs(c)<.9999?(r[1]=Math.atan2(a,d),r[2]=Math.atan2(s,u)):(r[1]=Math.atan2(-l,i),r[2]=0);break;case O.EulerOrder.zxy:r[0]=Math.asin(A(f,-1,1)),Math.abs(f)<.99999?(r[1]=Math.atan2(-l,d),r[2]=Math.atan2(-o,u)):(r[1]=0,r[2]=Math.atan2(s,i));break;case O.EulerOrder.zyx:r[1]=Math.asin(-A(l,-1,1)),Math.abs(l)<.99999?(r[0]=Math.atan2(f,d),r[2]=Math.atan2(s,i)):(r[0]=0,r[2]=Math.atan2(-o,u));break;case O.EulerOrder.yzx:r[2]=Math.asin(A(s,-1,1)),Math.abs(s)<.99999?(r[0]=Math.atan2(-c,u),r[1]=Math.atan2(-l,i)):(r[0]=0,r[1]=Math.atan2(a,d));break;case O.EulerOrder.xzy:r[2]=Math.asin(-A(o,-1,1)),Math.abs(o)<.99999?(r[0]=Math.atan2(f,u),r[1]=Math.atan2(a,i)):(r[0]=Math.atan2(-c,d),r[1]=0)}},t.angleQuat=function(e){var t=e[0];if(t<-1||t>1)return 0;var r=2*S(t);return r>M?r-2*M:r},t.axisQuat=function(e){var t=e[1],r=e[2],n=e[3];if(0===E(t*t+r*r+n*n))return[0,0,0];var i=1/E(t*t+r*r+n*n);return[t*i,r*i,n*i]},t.matrix3x3FromUnitQuatModel=function(e,t){var r,n,i,o,a,s,u,c,l,f,d,p;return t=t||(0,_.identity3)(),f=e[1]+e[1],d=e[2]+e[2],p=e[3]+e[3],o=e[1]*f,u=e[1]*d,c=e[1]*p,a=e[2]*d,s=e[2]*p,l=e[3]*p,r=e[0]*f,n=e[0]*d,i=e[0]*p,t[_.M300]=1-(a+l),t[_.M301]=u-i,t[_.M302]=c+n,t[_.M310]=u+i,t[_.M311]=1-(o+l),t[_.M312]=s-r,t[_.M320]=c-n,t[_.M321]=s+r,t[_.M322]=1-(o+a),t},t.matrix4x4FromUnitQuatModel=function(e,t){var r,n,i,o,a,s,u,c,l,f,d,p;return t=t||(0,_.identity4)(),f=e[1]+e[1],d=e[2]+e[2],p=e[3]+e[3],o=e[1]*f,u=e[1]*d,c=e[1]*p,a=e[2]*d,s=e[2]*p,l=e[3]*p,r=e[0]*f,n=e[0]*d,i=e[0]*p,t[_.M400]=1-(a+l),t[_.M401]=u-i,t[_.M402]=c+n,t[_.M403]=0,t[_.M410]=u+i,t[_.M411]=1-(o+l),t[_.M412]=s-r,t[_.M413]=0,t[_.M420]=c-n,t[_.M421]=s+r,t[_.M422]=1-(o+a),t[_.M423]=0,t[_.M430]=0,t[_.M431]=0,t[_.M432]=0,t[_.M433]=1,t},t.matrix3x3FromUnitQuatView=function(e,t){var r,n,i,o,a,s,u,c,l,f,d,p;return t=t||(0,_.identity3)(),f=e[1]+e[1],d=e[2]+e[2],p=e[3]+e[3],o=e[1]*f,u=e[1]*d,c=e[1]*p,a=e[2]*d,s=e[2]*p,l=e[3]*p,r=e[0]*f,n=e[0]*d,i=e[0]*p,t[_.M300]=1-(a+l),t[_.M310]=u-i,t[_.M320]=c+n,t[_.M301]=u+i,t[_.M311]=1-(o+l),t[_.M321]=s-r,t[_.M302]=c-n,t[_.M312]=s+r,t[_.M322]=1-(o+a),t},t.matrix4x4FromUnitQuatView=G,t.eulerToQuat=function(e,t){var r,n,i,o,a,s,u,c,l,f;t=t||I();var d=e[0],p=e[1],h=e[2];return r=P(d/2),n=P(p/2),i=P(h/2),o=x(d/2),u=n*i,c=(a=x(p/2))*(s=x(h/2)),l=n*s,f=a*i,t[0]=r*u+o*c,t[1]=o*u-r*c,t[2]=r*f+o*l,t[3]=r*l-o*f,t},t.lookAtQuat=function(e,t,r){return r=r||I(),w=(0,T.normalize3)([-e[0],-e[1],-e[2]],T.V3R[T.V3R.length-1]),y=(0,T.normalize3)((0,T.cross3)(t,w,T.V3R[T.V3R.length-2])),m=(0,T.cross3)(w,y,T.V3R[T.V3R.length-3]),s=y[0],u=m[0],c=w[0],f=y[1],d=m[1],p=w[1],h=y[2],b=m[2],g=w[2],(v=.25*(1+s+d+g))>0?(v=Math.sqrt(v),r[0]=v,v=1/(4*v),r[1]=(p-b)*v,r[2]=(h-c)*v,r[3]=(u-f)*v):(r[0]=0,(v=-.5*(d+g))>0?(v=Math.sqrt(v),r[1]=v,v*=2,r[2]=u/v,r[3]=c/v):(r[1]=0,(v=.5*(1-g))>0?(v=Math.sqrt(v),r[2]=v,r[3]=p/(2*v)):(r[2]=0,r[3]=1))),r},t.matrix3x3ToQuaternion=function(e,t){if(t=t||I(),n=e[0],i=e[3],o=e[6],a=e[1],s=e[4],u=e[7],l=e[2],f=e[5],d=e[8],(v=n+s+d)>0){var r=2*E(v+1);return t[0]=.25*r,t[1]=(f-u)/r,t[2]=(o-l)/r,t[3]=(a-i)/r,t}if(n>s&&n>d){var c=2*E(1+n-s-d);return t[0]=(f-u)/c,t[1]=.25*c,t[2]=(i+a)/c,t[3]=(o+l)/c,t}if(s>d){var p=2*E(1+s-n-d);return t[0]=(o-l)/p,t[1]=(a+i)/p,t[2]=.25*p,t[3]=(f+u)/p,t}var h=2*E(1+d-n-s);return t[0]=(a-i)/h,t[1]=(l+o)/h,t[2]=(f+u)/h,t[3]=.25*h,t},t.matrix4x4ToQuaternion=function(e,t){if(t=t||I(),n=e[0],i=e[4],o=e[8],a=e[1],s=e[5],u=e[9],l=e[2],f=e[6],d=e[10],(v=n+s+d)>0){var r=2*E(v+1);return t[0]=.25*r,t[1]=(f-u)/r,t[2]=(o-l)/r,t[3]=(a-i)/r,t}if(n>s&&n>d){var c=2*E(1+n-s-d);return t[0]=(f-u)/c,t[1]=.25*c,t[2]=(i+a)/c,t[3]=(o+l)/c,t}if(s>d){var p=2*E(1+s-n-d);return t[0]=(o-l)/p,t[1]=(a+i)/p,t[2]=.25*p,t[3]=(f+u)/p,t}var h=2*E(1+d-n-s);return t[0]=(a-i)/h,t[1]=(l+o)/h,t[2]=(f+u)/h,t[3]=.25*h,t},t.decomposeRotation=function(e,t,r,n,i){return i=i||I(),s=e[0]/t,u=e[4]/r,c=e[8]/n,f=e[1]/t,d=e[5]/r,p=e[9]/n,h=e[2]/t,b=e[6]/r,g=e[10]/n,(v=.25*(1+s+d+g))>0?(v=Math.sqrt(v),i[0]=v,v=1/(4*v),i[1]=(p-b)*v,i[2]=(h-c)*v,i[3]=(u-f)*v):(i[0]=0,(v=-.5*(d+g))>0?(v=Math.sqrt(v),i[1]=v,v*=2,i[2]=u/v,i[3]=c/v):(i[1]=0,(v=.5*(1-g))>0?(v=Math.sqrt(v),i[2]=v,i[3]=p/(2*v)):(i[2]=0,i[3]=1))),i},t.lookAtMatrix=function(e,t,r){r=r||(0,_.identity4)();var n=(0,T.normalize3)([-e[0],-e[1],-e[2]]),i=(0,T.normalize3)((0,T.cross3)(t,n)),o=(0,T.cross3)(n,i);return r[0]=i[0],r[1]=o[0],r[2]=n[0],r[3]=0,r[4]=i[1],r[5]=o[1],r[6]=n[1],r[7]=0,r[8]=i[2],r[9]=o[2],r[10]=n[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},t.rotateVectorByUnitQuat=function(e,t,r){return y=(0,T.vec3)(t[1],t[2],t[3]),v=t[0],(0,T.add3)((0,T.add3)((0,T.scale3)(y,2*(0,T.dot3)(y,e)),(0,T.scale3)(e,v*v-(0,T.dot3)(y,y))),(0,T.scale3)((0,T.cross3)(y,e),2*v),r)},t.slerpUnitQuat=function(e,t,r,n){n=n||I();var i,o,a,s,u,c=[0,0,0,0];return(o=e[1]*t[1]+e[2]*t[2]+e[3]*t[3]+e[0]*t[0])<0?(o=-o,c[0]=-t[1],c[1]=-t[2],c[2]=-t[3],c[3]=-t[0]):(c[0]=t[1],c[1]=t[2],c[2]=t[3],c[3]=t[0]),1-o>1e-7?(i=S(o),a=x(i),s=x((1-r)*i)/a,u=x(r*i)/a):(s=1-r,u=r),n[1]=s*e[1]+u*c[0],n[2]=s*e[2]+u*c[1],n[3]=s*e[3]+u*c[2],n[0]=s*e[0]+u*c[3],n},t.oneQuat=function(){return[1,0,0,0]},t.iQuat=function(){return[0,1,0,0]},t.jQuat=function(){return[0,0,1,0]},t.kQuat=function(){return[0,0,0,1]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rayFromPoints=t.rayToLocation=t.ray=void 0;var n=r(2);t.ray=function(e,t){return[e,t]},t.rayToLocation=function(e,t,r){return r=r||[0,0,0],(0,n.add3)(e[0],(0,n.scale3)(e[1],t),r)},t.rayFromPoints=function(e,t,r){return r=r||[[0,0,0],[0,0,0]],(0,n.copy3)(e,r[0]),(0,n.normalize3)((0,n.subtract3)(t,e),r[1]),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shallowCompare=void 0,t.shallowCompare=function(e,t){return e&&t?!Boolean(Object.keys(Object.assign({},e,t)).find((function(r){return e[r]!==t[r]}))):e===t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeComments=void 0,t.removeComments=function(e){for(var t=!1,r=!1,n=[],i={start:-1,stop:-1},o={start:-1,stop:-1},a=0,s=e.length;a<s;++a){var u=e[a],c=e[a+1];switch(u){case"/":switch(c){case"*":r||t||(i.start=a,t=!0,a++);break;case"/":t||r||(o.start=a,r=!0,a++)}break;case"*":"/"===c&&t&&(i.stop=a+2,n.push(i),i={start:-1,stop:-1},t=!1,a++);break;case"\n":case"\r":r&&(o.stop=a,n.push(o),o={start:-1,stop:-1},r=!1)}}return n.reverse(),n.forEach((function(t){e=function(e,t,r,n){return t<0&&(t=e.length+t)<0&&(t=0),e.slice(0,t)+(n||"")+e.slice(t+r)}(e,t.start,t.stop-t.start)})),e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.injectShaderIO=void 0;var n=r(82);function i(e){return Boolean(e)}function o(e){return Boolean(e)}function a(e){return Boolean(e)}function s(e){return Object.assign({},e,{materialAttribute:null})}function u(e){return Object.assign({},e,{materialUniforms:[]})}t.injectShaderIO=function(e,t,r,c,l,f){!function(e,t,r){if(r){var n=t.instanceAttributes||[],i=t.uniforms||[],o=t.vertexAttributes||[];r.shaderModuleUnits.forEach((function(t){t.instanceAttributes&&(n=n.concat(t.instanceAttributes(e))),t.uniforms&&(i=i.concat(t.uniforms(e))),t.vertexAttributes&&(o=o.concat(t.vertexAttributes(e)))}));var a=new Set,s=new Set,u=new Set;i.filter((function(e){return!!e&&(a.has(e.name)?(console.warn("Included shader modules has introduced duplicate uniform names:",e.name,"One will be overridden thus causing a potential crash of the shader."),!1):(a.add(e.name),!0))})),n.filter((function(e){return!!e&&(s.has(e.name)?(console.warn("Included shader modules has introduced duplicate Instance Attribute names:",e.name,"One will be overridden thus causing a potential crash of the shader."),!1):(s.add(e.name),!0))})),o.filter((function(e){return!!e&&(u.has(e.name)?(console.warn("Included shader modules has introduced duplicate Vertex Attribute names:",e.name,"One will be overridden thus causing a potential crash of the shader."),!1):(u.add(e.name),!0))})),t.instanceAttributes=n,t.uniforms=i,t.vertexAttributes=o}}(t,r,f);for(var d=(r.instanceAttributes||[]).filter(i),p=(r.vertexAttributes||[]).filter(o),h=(r.uniforms||[]).filter(a),b=0,g=c.length;b<g;++b){var v=c[b];if(v.validate(t,d,p,h)){var y=v.expand(t,d,p,h);y.instanceAttributes.filter(i).forEach((function(e){return d.push(e)})),y.vertexAttributes.filter(o).forEach((function(e){return p.push(e)})),y.uniforms.filter(a).forEach((function(e){return h.push(e)}))}}!function(e,t,r,n){t.forEach((function(n){void 0===n.name&&console.warn("All instance attributes MUST have a name on Layer:",e.id),t.find((function(e){return e!==n&&e.name===n.name}))&&console.warn("An instance attribute can not have the same name used more than once:",n.name),r.find((function(e){return e.name===n.name}))&&console.warn("An instance attribute and a vertex attribute in a layer can not share the same name:",n.name),n.resource||void 0===n.size&&(console.warn("An instance attribute requires the size to be defined."),console.warn(n))}))}(t,d,p);var m=d.slice(0),w=(p||[]).map(s),O=h.map(u);return m.sort(l.sortInstanceAttributes),O.sort(l.sortUniforms),w.sort(l.sortVertexAttributes),(0,n.packAttributes)(m),t.getLayerBufferType(e,p,m),{instanceAttributes:m,uniforms:O,vertexAttributes:w}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.packAttributes=void 0;var n=r(11),i=r(0),o=function(){function e(e){Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"available",{enumerable:!0,configurable:!0,writable:!0,value:4}),this.index=e}return Object.defineProperty(e.prototype,"setAttribute",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(e.size||0)<=this.available&&(e.block=this.index,e.blockIndex=4-this.available,this.available-=e.size||0,!0)}}),e}();t.packAttributes=function(e){!function(e){e.forEach((function(e){if(e.resource&&void 0===e.size&&(e.size=i.InstanceAttributeSize.FOUR),!e.size)try{var t=e.update(new n.Instance({}));t.length>0&&t.length<=i.InstanceAttributeSize.FOUR&&(e.size=t.length)}catch(t){console.warn("The system could not determine the size of the provided attribute. Please provide the size of the attribute:",e)}}))}(e);var t=[];e.forEach((function(e){if(e.size&&e.size===i.InstanceAttributeSize.MAT4X4){e.block=t.length,e.blockIndex=0;for(var r=0;r<4;++r){(n=new o(t.length)).available=0,n.index=0,t.push(n)}}else{if(!t.find((function(t){return!!t.setAttribute(e)&&Boolean(t)}))){var n=new o(t.length);t.push(n),n.setAttribute(e)||console.warn("There was a problem packing an attribute into a block. No block would accommodate it:",e)}}}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderModule=void 0;var n=r(0),i=r(38),o=r(84),a=r(5)("performance"),s=r(5)("shader-module-vs"),u=r(5)("shader-module-fs");function c(e,t){return Boolean(e)&&(e.compatibility===t||e.compatibility===n.ShaderInjectionTarget.ALL)}var l=function(){function e(){}return Object.defineProperty(e,"register",{enumerable:!1,configurable:!0,writable:!0,value:function(t){if(!(t instanceof o.ShaderModuleUnit)){if(Array.isArray(t)){var r="";return t.forEach((function(t){var n=e.register(t);n&&(r+="".concat(n,"\n"))})),r||null}return e.register(new o.ShaderModuleUnit(t))}var i=e.modules.get(t.moduleId);i||(i={},e.modules.set(t.moduleId,i));var s=i.fs,u=i.vs,l=c(t,n.ShaderInjectionTarget.FRAGMENT),f=c(t,n.ShaderInjectionTarget.VERTEX);if(s&&l){if(s.isFinal)return"Module ID: ".concat(t.moduleId," Can not override the module's existing Fragment registration as the exisitng module is marked as final");a("A Shader Module Unit has overridden an existing module for the Fragment Shader Module ID: %o",t.moduleId)}if(u&&f){if(u.isFinal)return"Module ID: ".concat(t.moduleId," Can not override the module's existing Vertex registration as the exisitng module is marked as final");a("A Shader Module Unit has overridden an existing module for the Vertex Shader Module ID: %o",t.moduleId)}return l&&(i.fs=t),f&&(i.vs=t),t.lock(),null}}),Object.defineProperty(e,"analyzeDependents",{enumerable:!1,configurable:!0,writable:!0,value:function(t){if(t.dependents&&t.isLocked)return[];var r=[],o=[],a=new Set,s=t.compatibility,u=t.moduleId,c=(0,i.shaderTemplate)({options:{},shader:t.content,onToken:function(t){var i=t.trim();if(0===i.indexOf("import")){var c=i.substr("import".length).trim();if(":"===c[0]){var l=!1,f=c.substr(":".length).trim().split(",");return 0===f[f.length-1].trim().length&&f.pop(),f.forEach((function(t){t=t.trim();var i=e.modules.get(t);i?(s!==n.ShaderInjectionTarget.FRAGMENT&&s!==n.ShaderInjectionTarget.ALL||(i.fs?(l=!0,a.has(t)||o.push(t)):r.push("Could not find requested target fragment module for Module ID: ".concat(t," requested by module: ").concat(u))),s!==n.ShaderInjectionTarget.VERTEX&&s!==n.ShaderInjectionTarget.ALL||(i.vs?(l=!0,a.has(t)||o.push(t)):r.push("Could not find requested target vertex module for Module ID: ".concat(t," requested by module: ").concat(u))),i.vs||i.fs||r.push("Could not find a vertex or fragment shader within exisitng module"),l||r.push("Error Processing module Module ID: ".concat(t," requested by module: ").concat(u))):r.push("Could not find requested module: ".concat(t," requested by module: ").concat(u))})),""}}return"${".concat(t,"}")}});return t.applyAnalyzedContent(c.shader),t.dependents=o,r}}),Object.defineProperty(e,"process",{enumerable:!1,configurable:!0,writable:!0,value:function(t,r,i,a){var c=new Set,l=new Set,f=[],d=[],p=i===n.ShaderInjectionTarget.VERTEX?s:u;p("Processing Shader for context %o:",t);var h=r;if(a){var b="";a.forEach((function(e){b+="${import: ".concat(e,"}\n")})),h=b+r}var g=new o.ShaderModuleUnit({content:h,compatibility:i,moduleId:'Layer "'.concat(t,'" ').concat(i===n.ShaderInjectionTarget.ALL?"fs vs":i===n.ShaderInjectionTarget.VERTEX?"vs":"fs")});return{errors:d,shader:function t(r){var o=r.moduleId;if(!function(e){var t=e.moduleId;p("%o: %o",t,f.slice(0).reverse().join(" -> "));var r=f.indexOf(t);if(f.unshift(t),r>-1){var n=f.slice(0,r+2).reverse();return d.push("A Shader has detected a Circular dependency in import requests: ".concat(n.join(" -> "))),f.shift(),!1}return!0}(r))return null;if(o&&l.has(o))return f.shift(),"";var a="";e.analyzeDependents(r).forEach((function(e){return d.push(e)}));var s=r.dependents;if(p("Module dependencies detected %o",s),s&&s.length>0)for(var u=0,h=s.length;u<h;++u){var b=s[u],g=e.modules.get(b);if(g){var v=void 0;i!==n.ShaderInjectionTarget.FRAGMENT&&i!==n.ShaderInjectionTarget.ALL||(g.fs?(c.add(g.fs),v=t(g.fs)):d.push("Could not find requested target fragment module for Module ID: ".concat(b," requested by module: ").concat(o))),i!==n.ShaderInjectionTarget.VERTEX&&i!==n.ShaderInjectionTarget.ALL||(g.vs?(c.add(g.vs),v=t(g.vs)):d.push("Could not find requested target vertex module for Module ID: ".concat(b," requested by module: ").concat(o))),g.vs||g.fs||d.push("Could not find a vertex or fragment shader within exisitng module"),null===v&&d.push("Error Processing module Module ID: ".concat(b," requested by module: ").concat(o)),a+=v||""}else d.push("Could not find requested module: ".concat(b," requested by module: ").concat(o))}return f.shift(),l.add(o||""),"".concat(a.trim(),"\n\n").concat(r.content.trim())}(g),shaderModuleUnits:c}}}),Object.defineProperty(e,"modules",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),e}();t.ShaderModule=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderModuleUnit=void 0;var n="Once a ShaderModuleUnit has been registered, you CAN NOT modify it! Module ID:",i=function(){function e(e){Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isLocked",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_compatibility",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_moduleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_dependents",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"isFinal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.assign(this,e)}return Object.defineProperty(e.prototype,"content",{get:function(){return this._content},set:function(e){this._isLocked?console.warn(n,this._moduleId):this._content=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"compatibility",{get:function(){return this._compatibility},set:function(e){this._isLocked?console.warn(n,this._moduleId):this._compatibility=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dependents",{get:function(){return this._dependents},set:function(e){this._isLocked&&null!==this._dependents?console.warn(n,this._moduleId):this._dependents=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLocked",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this._isLocked}}),Object.defineProperty(e.prototype,"moduleId",{get:function(){return this._moduleId},set:function(e){this._isLocked?console.warn(n,this._moduleId):this._moduleId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"applyAnalyzedContent",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._isLocked&&null!==this.dependents?console.warn(n,this._moduleId):this._content=e}}),Object.defineProperty(e.prototype,"lock",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._isLocked=!0}}),e}();t.ShaderModuleUnit=i},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(30),t),i(r(153),t),i(r(154),t),i(r(92),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateDefaultElements=void 0;var n=r(16);t.generateDefaultElements=function(e){var t=e.canvas.height,r=e.canvas.width,i={aspectRatio:r/t,bottom:-t/2,far:1e7,left:-r/2,near:-100,right:r/2,top:t/2,viewSize:t},o=new n.Camera({type:n.CameraProjectionType.ORTHOGRAPHIC,left:i.left,right:i.right,top:i.top,bottom:i.bottom,near:i.near,far:i.far});return o.scale=[1,-1,1],o.position=[0,0,-300],o.update(),{camera:o,viewport:{bottom:0,left:0,right:0,top:0}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseShaderIOInjection=void 0;var n=r(5)("performance"),i=function(){function e(){}return Object.defineProperty(e.prototype,"setDeclaration",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,i){e.has(t)&&n("%s: Overriding declaration %s\nSetting new value: %s",i||"Expand IO Declarations",t,r),e.set(t,r)}}),e}();t.BaseShaderIOInjection=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.EasingIOExpansion=t.createEasingAttribute=void 0;var o=r(52),a=r(2),s=r(0),u=r(75),c=r(38),l=r(31),f="EasingIOExpansion",d=Math.abs,p=Math.max,h={duration:0,start:[0],end:[0],startTime:0},b={1:"float",2:"vec2",3:"vec3",4:"vec4",9:"mat3",16:"mat4",99:"vec4"},g="easingMethod",v="T";t.createEasingAttribute=function(e){return e};var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"baseAttributeName",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),t}return i(t,e),Object.defineProperty(t.prototype,"expand",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){for(var i,c=new Set,l=[],f=[],b=0,g=t;b<g.length;b++){var v=g[b];i=v,Boolean(i)&&i.easing&&void 0!==i.size&&i.size<=4&&l.push(v)}var y={};e.easingId=y;for(var m=function(t,r){var n=l[t],i=n.easing,b=i.cpu,g=i.loop,v=i.uid,m=n.name,O=n.size,_=n.update,T=v;w.baseAttributeName.set(n,n.name),n.name="_".concat(n.name,"_end"),y[n.name]=T,c.has(T)&&console.error("Undefined behavior occurs if you reuse an IAutoEasingMethod. Please ensure you are using uid() from the util to give the IAutoEasingMethod its uid, or just use the default provided methods"),c.add(T);var P,x,E,j,S,R,M,A,I,L,C,B,D,F={values:h};n.update=function(t){if(I=e.surface.frameMetrics,x=n.easing.delay,E=n.easing.duration,M=_(t),A=I.currentTime,t.easing=B=t.easing||new Map,L=B.get(T),C&&L?t.reactivate&&(C.copy(M,L.end),C.copy(M,L.end),L.startTime=A):(C=(0,a.VecMath)(M),L=new u.EasingProps({duration:E,end:C.copy(M),start:C.copy(M),startTime:A}),B.set(T,L)),j=E,P=x,(S=L).isTimeSet&&(j=S.duration||E,P=S.delay||0),!S.isManualStart){switch(R=1,g){case o.AutoEasingLoopStyle.CONTINUOUS:R=(A-S.startTime)/j,D=!0;break;case o.AutoEasingLoopStyle.REPEAT:R=(A-S.startTime)/j%1,D=!0;break;case o.AutoEasingLoopStyle.REFLECT:var r=(A-S.startTime)/j;R=2*d(r/2%1-.5),D=!0;break;case o.AutoEasingLoopStyle.NONE:default:R=(A-S.startTime)/j,D=!1}S.start=b(S.start,S.end,R,S.start)}return S.startTime=A+P,C.copy(M,S.end),F.values=S,e.animationEndTime=p(e.animationEndTime,S.startTime+j+I.frameDuration),e.isAnimationContinuous=D,M},n.childAttributes=n.childAttributes||[];var N={name:"_".concat(m,"_start"),parentAttribute:n,size:O,update:function(e){return F.values.start}};n.childAttributes.push(N),f.push(N);var U={name:"_".concat(m,"_start_time"),parentAttribute:n,size:s.InstanceAttributeSize.ONE,update:function(e){return[F.values.startTime]}};n.childAttributes.push(U),f.push(U);var G={name:"_".concat(m,"_duration"),parentAttribute:n,size:s.InstanceAttributeSize.ONE,update:function(e){return[F.values.duration]}};n.childAttributes.push(G),f.push(G)},w=this,O=0,_=l.length;O<_;++O)m(O);return{instanceAttributes:f,vertexAttributes:[],uniforms:[]}}}),Object.defineProperty(t.prototype,"validate",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){var i=!1;return t.forEach((function(e){e.easing&&e.resource&&(console.warn("An instance attribute can not have both easing and resource properties. Undefined behavior will occur."),console.warn(e),i=!0),e.easing&&void 0===e.size&&console.warn("An Instance Attribute with easing MUST have a size declared")})),!i}}),Object.defineProperty(t.prototype,"processAttributeDestructuring",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i,a){for(var s=0,u=i.length;s<u;++s){var c=i[s];if(c.easing&&c.size){var l=this.baseAttributeName.get(c);if(l){this.baseAttributeName.delete(c);var d="_".concat(l,"_time"),p="_".concat(l,"_duration"),h="_".concat(l,"_start_time");switch(c.easing.loop){case o.AutoEasingLoopStyle.CONTINUOUS:this.setDeclaration(t,d,"  float ".concat(d," = (currentTime - ").concat(h,") / ").concat(p,";\n"),f);break;case o.AutoEasingLoopStyle.REPEAT:this.setDeclaration(t,d,"  float ".concat(d," = clamp(fract((currentTime - ").concat(h,") / ").concat(p,"), 0.0, 1.0);\n"),f);break;case o.AutoEasingLoopStyle.REFLECT:var g="_".concat(l,"_timePassed"),v="_".concat(l,"_pingPong");this.setDeclaration(t,g,"  float ".concat(g," = (currentTime - ").concat(h,") / ").concat(p,";\n"),f),this.setDeclaration(t,v,"  float ".concat(v," = abs((fract(").concat(g," / 2.0)) - 0.5) * 2.0;\n"),f),this.setDeclaration(t,d,"  float ".concat(d," = clamp(").concat(v,", 0.0, 1.0);\n"),f);break;case o.AutoEasingLoopStyle.NONE:default:this.setDeclaration(t,d,"  float ".concat(d," = clamp((currentTime - ").concat(h,") / ").concat(p,", 0.0, 1.0);\n"),f)}this.setDeclaration(t,l,"  ".concat(b[c.size]," ").concat(l," = ").concat(c.easing.methodName,"(_").concat(l,"_start, _").concat(l,"_end, _").concat(l,"_time);\n"),f)}else console.warn("Could not determine a base name for an easing attribute.")}}return""}}),Object.defineProperty(t.prototype,"processHeaderInjection",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i,o,a){var u=this,l={injection:""};if(e!==s.ShaderInjectionTarget.VERTEX)return l;var d=new Map;if(l.injection="// Auto Easing Methods specified by the layer\n",o.forEach((function(e){if(e.easing&&e.size){var t=d.get(e.easing.methodName);t||(t=new Map,d.set(e.easing.methodName,t)),t.set(e.size,e.easing.gpu)}})),0===d.size)return l.injection="",l;var p={name:"Easing Method Generation",values:[g]};return d.forEach((function(e,r){e.forEach((function(e,n){var i,o=b[n],a=((i={})[g]="".concat(o," ").concat(r,"(").concat(o," start, ").concat(o," end, float t)"),i[v]="".concat(o),i),s=(0,c.shaderTemplate)({options:a,required:p,shader:e});u.setDeclaration(t,"".concat(o," ").concat(r),"".concat(s.shader,"\n"),f)}))})),l}}),t}(l.BaseIOExpansion);t.EasingIOExpansion=y},function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.BasicIOExpansion=void 0;var s=r(59),u=r(4),c=r(26),l=r(31),f=r(0),d="BasicIOExpansion",p=["x","y","z","w"],h=((i={})[f.UniformSize.ONE]="float",i[f.UniformSize.TWO]="vec2",i[f.UniformSize.THREE]="vec3",i[f.UniformSize.FOUR]="vec4",i[f.UniformSize.MATRIX3]="mat3",i[f.UniformSize.MATRIX4]="mat4",i[f.UniformSize.FLOAT_ARRAY]="float",i[f.UniformSize.VEC4_ARRAY]="vec4",i[f.UniformSize.TEXTURE]="vec4",i);function b(e){return e&&e.length}var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),Object.defineProperty(t.prototype,"generateUniformAttributePacking",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return this.setDeclaration(e,s.uniformBufferInstanceBufferName,"\n// Instance Attributes as a packed Uniform Buffer\nuniform vec4 ".concat(s.uniformBufferInstanceBufferName,"[").concat(t.totalInstanceUniformBlocks,"];\n"),d),this.setDeclaration(e,"instanceSize","int instanceSize = ".concat(t.totalInstanceUniformBlocks,";"),d),this.setDeclaration(e,"getBlock","vec4 getBlock(int index, int instanceIndex) { return ".concat(s.uniformBufferInstanceBufferName,"[(instanceSize * instanceIndex) + index]; }"),d),{injection:"",material:{uniforms:[{name:s.uniformBufferInstanceBufferName,type:c.MaterialUniformType.VEC4_ARRAY,value:new Array(t.totalInstanceUniformBlocks).fill(0).map((function(){return[0,0,0,0]}))}]}}}}),Object.defineProperty(t.prototype,"processAttributeDestructuring",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i,o){var a="",s=i.slice(0);switch(e.bufferType){case f.LayerBufferType.INSTANCE_ATTRIBUTE:a=this.processDestructuringInstanceAttribute(t,s);break;case f.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING:a=this.processDestructuringInstanceAttributePacking(t,s);break;case f.LayerBufferType.UNIFORM:a=this.processDestructuringUniformBuffer(t,s,r.blocksPerInstance)}return e.picking.type===f.PickType.SINGLE&&(a+="\n// This portion is where the shader assigns the picking color that gets passed to the fragment shader\n_picking_color_pass_ = _pickingColor;\n"),a}}),Object.defineProperty(t.prototype,"processDestructuringInstanceAttribute",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return""}}),Object.defineProperty(t.prototype,"processDestructuringInstanceAttributePacking",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r="";return r+=this.processDestructureBlocks(e,t)}}),Object.defineProperty(t.prototype,"processDestructuringUniformBuffer",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){this.setDeclaration(e,"instanceIndex","int instanceIndex = int(instance);",d);for(var n=0;n<r;++n)this.setDeclaration(e,"block".concat(n),"  vec4 block".concat(n," = getBlock(").concat(n,", instanceIndex);\n"),d);return this.processDestructureBlocks(e,t)}}),Object.defineProperty(t.prototype,"processDestructureBlocks",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this;return t.forEach((function(t){var n,i,o=t.block||0;t.size===f.InstanceAttributeSize.MAT4X4?r.setDeclaration(e,t.name,"  ".concat(h[t.size]," ").concat(t.name," = mat4(block").concat(o,", block").concat(o+1,", block").concat(o+2,", block").concat(o+3,");\n"),d):t.size===f.InstanceAttributeSize.FOUR?r.setDeclaration(e,t.name,"  ".concat(h[t.size]," ").concat(t.name," = block").concat(o,";\n"),d):r.setDeclaration(e,t.name,"  ".concat(h[t.size||1]," ").concat(t.name," = block").concat(o,".").concat((n=t.blockIndex||0,i=t.size||1,p.slice(n,n+i).join("")),";\n"),d)})),""}}),Object.defineProperty(t.prototype,"processHeaderInjection",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i,o,s){var u={injection:""};e===f.ShaderInjectionTarget.VERTEX&&(u=this.processAttributeHeader(t,r,n,i,o));var c=this.processUniformHeader(t,s,e);return a(a({},u),{injection:u.injection+c})}}),Object.defineProperty(t.prototype,"processAttributeHeader",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i){var o=void 0,a="// Shader input\n";if(t.bufferType===f.LayerBufferType.UNIFORM&&i.length>0){var s=this.generateUniformAttributePacking(e,r);o=s.material,a+=s.injection}return a+=this.processVertexAttributes(e,n),t.bufferType===f.LayerBufferType.INSTANCE_ATTRIBUTE&&i.length>0&&(a+=this.processInstanceAttributeBufferStrategy(e,i)),t.bufferType===f.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING&&i.length>0&&(a+=this.processInstanceAttributePackingBufferStrategy(e,r.instanceMaxBlock)),{injection:a,material:o}}}),Object.defineProperty(t.prototype,"processUniformHeader",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=this,i=r||f.ShaderInjectionTarget.VERTEX;return t.forEach((function(t){t.shaderInjection=t.shaderInjection||f.ShaderInjectionTarget.VERTEX,t.shaderInjection!==i&&t.shaderInjection!==f.ShaderInjectionTarget.ALL||n.setDeclaration(e,t.name,"".concat(function(e){var t=e.size;if(t===f.UniformSize.FLOAT_ARRAY||t===f.UniformSize.VEC4_ARRAY){var r=e.update(e);if(b(r))return"#define ".concat(e.name,"_length ").concat(r.length,"\n")}return""}(t),"uniform ").concat(t.qualifier||"").concat(t.qualifier?" ":"").concat(h[t.size]," ").concat(t.name).concat(function(e){var t=e.size;return t!==f.UniformSize.FLOAT_ARRAY&&t!==f.UniformSize.VEC4_ARRAY||!b(e.update(e))?"":"[".concat(e.name,"_length]")}(t),";\n"),d)})),""}}),Object.defineProperty(t.prototype,"processInstanceAttributeBufferStrategy",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this,n="attribute";return u.WebGLStat.SHADERS_3_0&&(n="in"),t.forEach((function(t){r.setDeclaration(e,t.name,"".concat(n," ").concat(h[t.size||1]," ").concat(t.qualifier||"").concat(t.qualifier?" ":""," ").concat(t.name,";\n"),d)})),""}}),Object.defineProperty(t.prototype,"processInstanceAttributePackingBufferStrategy",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r="attribute";u.WebGLStat.SHADERS_3_0&&(r="in");for(var n=0,i=t+1;n<i;++n)this.setDeclaration(e,"block".concat(n),"".concat(r," ").concat(h[f.InstanceAttributeSize.FOUR]," block").concat(n,";\n"),d);return""}}),Object.defineProperty(t.prototype,"processVertexAttributes",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this,n="attribute";return u.WebGLStat.SHADERS_3_0&&(n="in"),t.forEach((function(t){r.setDeclaration(e,t.name,"".concat(n," ").concat(h[t.size]," ").concat(t.qualifier||"").concat(t.qualifier?" ":"").concat(t.name,";\n"),d)})),""}}),t}(l.BaseIOExpansion);t.BasicIOExpansion=g},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveIOExpansion=void 0;var o=r(59),a=r(31),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"processAttributeDestructuring",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n,i,a,s){return a.find((function(e){return e.name===o.activeAttributeName}))?(this.setDeclaration(t,"__active_attribute_handler__",r(152),"ActiveIOExpansion"),""):""}}),t}(a.BaseIOExpansion);t.ActiveIOExpansion=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.flushEmitOnce=t.emitOnce=void 0;var n={};t.emitOnce=function(e,t){var r=n[e]||[t,-1,0];n[e]=r,r[2]++,clearTimeout(r[1]),r[1]=window.setTimeout((function(){t(r[2],e),delete n[e]}),1)},t.flushEmitOnce=function(){for(var e in n){var t=n[e];clearTimeout(t[1]),t[0](t[2],e)}n={}}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.UniformBufferManager=t.isUniformBufferLocation=void 0;var o=r(59),a=r(4),s=r(26),u=r(8),c=r(39),l=r(30);t.isUniformBufferLocation=function(e){return e&&e.buffer&&e.buffer.value&&e.type===s.MaterialUniformType.VEC4_ARRAY};var f=function(e){function t(t,r){var n=e.call(this,t,r)||this;Object.defineProperty(n,"uniformBlocksPerInstance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"buffers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(n,"availableClusters",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(n,"instanceToCluster",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(n,"clusterToBuffer",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(n,"add",{enumerable:!0,configurable:!0,writable:!0,value:function(e){n.availableClusters.length<=0&&n.makeNewBuffer();var t=n.availableClusters.pop();return t?n.instanceToCluster[e.uid]=t:console.warn("No valid cluster available for instance added to uniform manager."),t}}),Object.defineProperty(n,"remove",{enumerable:!0,configurable:!0,writable:!0,value:function(e){var t=this.instanceToCluster[e.uid];return t&&(delete this.instanceToCluster[e.uid],this.availableClusters.push(t)),e}});var i=0;return t.shaderIOInfo.instanceAttributes.forEach((function(e){i=Math.max(e.block||0,i)})),n.uniformBlocksPerInstance=i+1,n}return i(t,e),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.buffers.forEach((function(e){e.geometry.destroy(),e.material.dispose()}))}}),Object.defineProperty(t.prototype,"getBufferLocations",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.instanceToCluster[e.uid]}}),Object.defineProperty(t.prototype,"getActiveAttributePropertyId",{enumerable:!1,configurable:!0,writable:!0,value:function(){return-1}}),Object.defineProperty(t.prototype,"getInstanceCount",{enumerable:!1,configurable:!0,writable:!0,value:function(){return-1}}),Object.defineProperty(t.prototype,"getUpdateAllPropertyIdList",{enumerable:!1,configurable:!0,writable:!0,value:function(){return[]}}),Object.defineProperty(t.prototype,"managesInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return void 0===this.instanceToCluster[e.uid]}}),Object.defineProperty(t.prototype,"removeFromScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.scene;if(null==e?void 0:e.container){for(var t=0,r=this.buffers.length;t<r;++t){var n=this.buffers[t];e.container.remove(n.model)}delete this.scene}}}),Object.defineProperty(t.prototype,"setScene",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(e.container){for(var t=0,r=this.buffers.length;t<r;++t){var n=this.buffers[t];e.container.add(n.model)}this.scene=e}else console.warn("Can not set a scene that has an undefined container.")}}),Object.defineProperty(t.prototype,"makeNewBuffer",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.layer.shaderIOInfo,t=new a.Geometry;e.vertexAttributes.forEach((function(e){e.materialAttribute&&t.addAttribute(e.name,e.materialAttribute)}));var r=this.makeLayerMaterial(),n=(0,c.generateLayerModel)(this.layer.id,t,r,e.drawMode);n.vertexDrawRange=[0,e.maxInstancesPerBuffer*e.instanceVertexCount];var i={activeInstances:[],clusters:[],firstInstance:0,geometry:t,lastInstance:0,material:r,model:n};this.buffers.push(i);var l=0,f=o.uniformBufferInstanceBufferName,d=r.uniforms[f];if((0,s.isUniformVec4Array)(d)){d.value=d.value.map((function(){return[0,0,0,0]}));for(var p=Object.assign({},e.instanceAttributes[0],{bufferAttribute:new a.Attribute(new Float32Array(1),1),uid:(0,u.uid)()}),h=0,b=e.maxInstancesPerBuffer;h<b;++h){var g={attribute:p,buffer:d,instanceIndex:h,range:[l,0]};l+=this.uniformBlocksPerInstance,g.range[1]=l,i.clusters.push(g),this.availableClusters.push(g),this.clusterToBuffer.set(g,i)}for(h=0,b=e.uniforms.length;h<b;++h){var v=e.uniforms[h];v.materialUniforms.push(r.uniforms[v.name])}this.scene&&this.scene.container&&this.scene.container.add(i.model)}else console.warn("Material is utilizing an invalid uniform type for Uniform Buffer Management. Buffering will not be possible.")}}),t}(l.BufferManagerBase);t.UniformBufferManager=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseDiffProcessor=void 0;var n=function(e,t){Object.defineProperty(this,"layer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bufferManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.layer=e,this.bufferManager=t};t.BaseDiffProcessor=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayerInteractionHandler=void 0;var n=r(0),i=r(56),o=function(){function e(e){Object.defineProperty(this,"colorPicking",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isMouseOver",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"isMouseDown",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"layer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isTouchOver",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"isTouchDown",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.layer=e}return Object.defineProperty(e.prototype,"getColorPickInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.colorPicking&&this.layer.picking.type===n.PickType.SINGLE&&this.colorPicking.view===e?this.layer.uidToInstance.get(16777215-this.colorPicking.nearestColor):null}}),Object.defineProperty(e.prototype,"handleMouseOver",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){}}),Object.defineProperty(e.prototype,"handleTouchOver",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){}}),Object.defineProperty(e.prototype,"handleMouseDown",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this;if(this.layer.picking&&this.layer.picking.type!==n.PickType.NONE){var i=this.layer.props.onMouseDown;if(i){var o=e.projection.screenToWorld(t.screen.position),a=[];if(this.layer.picking.type===n.PickType.SINGLE){var s=this.getColorPickInstance(e);s&&a.push(s)}i({interaction:t,instances:a,layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:o}),this.isMouseDown.clear(),a.forEach((function(e){return r.isMouseDown.add(e)}))}}}}),Object.defineProperty(e.prototype,"handleTouchDown",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var o=this.layer.props,a=o.onTouchDown,s=o.onTouchOver;if(this.layer.picking&&this.layer.picking.type!==n.PickType.NONE&&(a||s)){var u=e.projection.screenToWorld(r.screen.position),c=[];if(this.layer.picking.type===n.PickType.SINGLE){var l=this.getColorPickInstance(e);l&&c.push(l)}var f={interaction:t,touch:r,instances:c,layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:u},d=(0,i.mapInjectDefault)(this.isTouchDown,r.touch.touch.identifier,(function(){return new Set})),p=(0,i.mapInjectDefault)(this.isTouchOver,r.touch.touch.identifier,(function(){return new Set}));c.forEach((function(e){d.add(e),p.add(e)})),s&&s(f),a&&a(f)}}}),Object.defineProperty(e.prototype,"handleMouseOut",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(this.layer.picking&&this.layer.picking.type!==n.PickType.NONE){var r=this.layer.props.onMouseOut;if(r){var i=e.projection.screenToWorld(t.screen.position);r({interaction:t,instances:Array.from(this.isMouseOver.keys()),layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:i})}}this.isMouseOver.clear()}}),Object.defineProperty(e.prototype,"handleTouchOut",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var i=this.layer.props.onTouchOut;if(this.layer.picking&&this.layer.picking.type!==n.PickType.NONE&&i){var o=e.projection.screenToWorld(r.screen.position);i({interaction:t,touch:r,instances:Array.from(this.isMouseOver.keys()),layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:o}),this.isTouchOver.delete(r.touch.touch.identifier)}}}),Object.defineProperty(e.prototype,"handleMouseUp",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this,i=this.layer.props,o=i.onMouseUp,a=i.onMouseUpOutside;if(this.layer.picking&&this.layer.picking.type!==n.PickType.NONE&&o){var s=e.projection.screenToWorld(t.screen.position),u=[];if(this.layer.picking.type===n.PickType.SINGLE){var c=this.getColorPickInstance(e);c&&u.push(c)}var l={interaction:t,instances:u,layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:s};o(l),u.forEach((function(e){return r.isMouseDown.delete(e)})),this.isMouseDown.size<=0||!a||a(l={interaction:t,instances:Array.from(this.isMouseDown.values()),layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:s})}}}),Object.defineProperty(e.prototype,"handleTouchUp",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var o=this.layer.props,a=o.onTouchUp,s=o.onTouchUpOutside,u=o.onTouchOut,c=o.onTouchAllEnd;if(this.layer.picking&&this.layer.picking.type!==n.PickType.NONE&&(a||s||u||c)){var l=e.projection.screenToWorld(r.screen.position),f=[];if(this.layer.picking.type===n.PickType.SINGLE){var d=this.getColorPickInstance(e);d&&f.push(d)}var p={interaction:t,touch:r,instances:f,layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:l};u&&u(p),a&&a(p);var h=(0,i.mapGetWithDefault)(this.isTouchDown,r.touch.touch.identifier,new Set);f.forEach((function(e){return h.delete(e)})),h.size>0&&s&&s(p={interaction:t,touch:r,instances:Array.from(h.values()),layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:l}),this.isTouchDown.delete(r.touch.touch.identifier),this.isTouchDown.size<=0&&c&&c(p={interaction:t,touch:r,instances:[],layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:l})}}}),Object.defineProperty(e.prototype,"handleMouseMove",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this,i=this.layer.props,o=i.onMouseOver,a=i.onMouseMove,s=i.onMouseOut;if(this.layer.picking&&this.layer.picking.type!==n.PickType.NONE&&(o||a||s)){var u=void 0,c=e.projection.screenToWorld(t.screen.position),l=[];if(this.layer.picking.type===n.PickType.SINGLE){var f=this.getColorPickInstance(e);f&&l.push(f)}var d=new Set;if(l.forEach((function(e){return d.add(e)})),s){var p=[];this.isMouseOver.forEach((function(e){d.has(e)||p.push(e)})),u={interaction:t,instances:p,layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:c},p.length>0&&s(u)}if(o){var h=l.filter((function(e){return!r.isMouseOver.has(e)}));u={interaction:t,instances:h,layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:c},h.length>0&&o(u)}a&&a(u={interaction:t,instances:l,layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:c}),this.isMouseOver=d}}}),Object.defineProperty(e.prototype,"handleTouchMove",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var o=this.layer.props,a=o.onTouchOver,s=o.onTouchMove,u=o.onTouchOut;if(this.layer.picking&&this.layer.picking.type!==n.PickType.NONE&&(a||s||u)){var c=void 0,l=e.projection.screenToWorld(r.screen.position),f=[];if(this.layer.picking.type===n.PickType.SINGLE){var d=this.getColorPickInstance(e);d&&f.push(d)}var p=(0,i.mapGetWithDefault)(this.isTouchOver,r.touch.touch.identifier,new Set),h=new Set;if(f.forEach((function(e){return h.add(e)})),u){var b=[];p.forEach((function(e){h.has(e)||b.push(e)})),c={interaction:t,touch:r,instances:b,layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:l},b.length>0&&u(c)}if(a){var g=f.filter((function(e){return!p.has(e)}));c={interaction:t,touch:r,instances:g,layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:l},g.length>0&&a(c)}s&&s(c={interaction:t,touch:r,instances:f,layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:l}),this.isMouseOver=h}}}),Object.defineProperty(e.prototype,"handleMouseClick",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(this.layer.picking&&this.layer.picking.type!==n.PickType.NONE){var r=this.layer.props.onMouseClick;if(r){var i=e.projection.screenToWorld(t.screen.position),o=[];if(this.layer.picking.type===n.PickType.SINGLE){var a=this.getColorPickInstance(e);a&&o.push(a)}r({interaction:t,instances:o,layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:i})}}}}),Object.defineProperty(e.prototype,"handleTap",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){if(this.layer.picking&&this.layer.picking.type!==n.PickType.NONE){var i=this.layer.props.onTap;if(i){var o=e.projection.screenToWorld(r.screen.position),a=[];if(this.layer.picking.type===n.PickType.SINGLE){var s=this.getColorPickInstance(e);s&&a.push(s)}i({interaction:t,touch:r,instances:a,layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:o})}}}}),Object.defineProperty(e.prototype,"handleMouseDrag",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){}}),e}();t.LayerInteractionHandler=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeWheel=t.eventElementPosition=void 0;var n=r(159);Object.defineProperty(t,"normalizeWheel",{enumerable:!0,get:function(){return n.normalizeWheel}}),t.eventElementPosition=function(e,t){var r=0,n=0,i=0,o=0,a=t||e.nativeEvent&&e.nativeEvent.target||e.target;if(e||(e=window.event),e.pageX||e.pageY)r=e.pageX,n=e.pageY;else if(e.clientX||e.clientY){var s=0,u=0;document.documentElement&&(s=document.documentElement.scrollLeft,u=document.documentElement.scrollTop),r=e.clientX+document.body.scrollLeft+s,n=e.clientY+document.body.scrollTop+u}if(a.offsetParent)do{i+=a.offsetLeft,o+=a.offsetTop,a=a.offsetParent}while(a);return[r-i,n-o]}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.QuadTree=t.QuadTreeNode=t.QuadTreeQuadrants=t.filterQuery=void 0;var o=r(7),a=r(2);t.filterQuery=function(e,t){var r=[];return t.forEach((function(t){e.find((function(e){return t instanceof e}))&&r.push(t)})),r};var s=function(){function e(e,t){Object.defineProperty(this,"TL",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"TR",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BL",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BR",{enumerable:!0,configurable:!0,writable:!0,value:void 0});var r=e.mid;this.TL=new u(e.x,r[0],e.y,r[1],t),this.TR=new u(r[0],e.right,e.y,r[1],t),this.BL=new u(e.x,r[0],r[1],e.bottom,t),this.BR=new u(r[0],e.right,r[1],e.bottom,t)}return Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.TL.destroy(),this.TR.destroy(),this.BL.destroy(),this.BR.destroy(),delete this.TL,delete this.TR,delete this.BL,delete this.BR}}),e}();t.QuadTreeQuadrants=s;var u=function(){function e(e,t,r,n,i){Object.defineProperty(this,"bounds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"children",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"depth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bounds=arguments.length>=4?new o.Bounds({left:e,right:t,top:r,bottom:n}):new o.Bounds({left:0,right:1,top:0,bottom:1}),this.depth=i||0}return Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){delete this.children,delete this.bounds,this.nodes&&(this.nodes.destroy(),delete this.nodes)}}),Object.defineProperty(e.prototype,"add",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return e.isInside(this.bounds)?this.doAdd(e):(this.cover(e),this.add(e,t))}}),Object.defineProperty(e.prototype,"addAll",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=this,r=Number.MAX_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,a=Number.MIN_SAFE_INTEGER,s=Math.min,u=Math.max,c=0,l=e.length;c<l;++c){var f=e[c];r=s(r,f.x),i=u(f.right,i),n=s(n,f.y),a=u(a,f.bottom)}this.cover(new o.Bounds({left:r,right:i,top:n,bottom:a})),e.forEach((function(e){return t.doAdd(e)}))}}),Object.defineProperty(e.prototype,"cover",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;if(!e.isInside(this.bounds)){this.bounds.encapsulate(e),this.bounds.x-=1,this.bounds.y-=1,this.bounds.width+=2,this.bounds.height+=2;var r=this.gatherChildren([]);this.nodes&&(this.nodes.destroy(),delete this.nodes),r.forEach((function(e){return t.doAdd(e)}))}}}),Object.defineProperty(e.prototype,"doAdd",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.nodes?e.isInside(this.nodes.TL.bounds)?this.nodes.TL.doAdd(e):e.isInside(this.nodes.TR.bounds)?this.nodes.TR.doAdd(e):e.isInside(this.nodes.BL.bounds)?this.nodes.BL.doAdd(e):e.isInside(this.nodes.BR.bounds)?this.nodes.BR.doAdd(e):(this.children.push(e),!0):e.isInside(this.bounds)?(this.children.push(e),this.children.length>5&&this.depth<10&&this.split(),!0):(isNaN(e.width+e.height+e.x+e.y)?console.error("Child did not fit into bounds because a dimension is NaN",e):0===e.area&&console.error("Child did not fit into bounds because the area is zero",e),!0)}}),Object.defineProperty(e.prototype,"gatherChildren",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){t&&t(this);for(var r=0,n=this.children.length;r<n;++r)e.push(this.children[r]);return this.nodes&&(this.nodes.TL.gatherChildren(e,t),this.nodes.TR.gatherChildren(e,t),this.nodes.BL.gatherChildren(e,t),this.nodes.BR.gatherChildren(e,t)),e}}),Object.defineProperty(e.prototype,"query",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return e instanceof o.Bounds?e.hitBounds(this.bounds)?this.queryBounds(e,[],t):[]:(0,a.isVec2)(e)&&this.bounds.containsPoint(e)?this.queryPoint(e,[],t):[]}}),Object.defineProperty(e.prototype,"queryBounds",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return this.bounds.isInside(e)?(this.gatherChildren(t,r),t):(this.children.forEach((function(r){r.hitBounds(e)&&t.push(r)})),r&&r(this),this.nodes&&(e.hitBounds(this.nodes.TL.bounds)&&this.nodes.TL.queryBounds(e,t,r),e.hitBounds(this.nodes.TR.bounds)&&this.nodes.TR.queryBounds(e,t,r),e.hitBounds(this.nodes.BL.bounds)&&this.nodes.BL.queryBounds(e,t,r),e.hitBounds(this.nodes.BR.bounds)&&this.nodes.BR.queryBounds(e,t,r)),t)}}),Object.defineProperty(e.prototype,"queryPoint",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return this.children.forEach((function(r){r.containsPoint(e)&&t.push(r)})),r&&r(this),this.nodes&&(this.nodes.TL.bounds.containsPoint(e)&&this.nodes.TL.queryPoint(e,t,r),this.nodes.TR.bounds.containsPoint(e)&&this.nodes.TR.queryPoint(e,t,r),this.nodes.BL.bounds.containsPoint(e)&&this.nodes.BL.queryPoint(e,t,r),this.nodes.BR.bounds.containsPoint(e)&&this.nodes.BR.queryPoint(e,t,r)),t}}),Object.defineProperty(e.prototype,"split",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=[];this.gatherChildren(e),this.nodes=new s(this.bounds,this.depth+1),this.children=[];for(var t=0,r=e.length;t<r;++t){var n=e[t];n&&this.doAdd(n)}}}),Object.defineProperty(e.prototype,"visit",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=Boolean(e(this));this.nodes&&!t&&(this.nodes.TL.visit(e),this.nodes.TR.visit(e),this.nodes.BL.visit(e),this.nodes.BR.visit(e))}}),e}();t.QuadTreeNode=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(u);t.QuadTree=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.QueuedEventHandler=void 0;var o=r(34),a=r(43),s=function(e){function t(t,r){void 0===r&&(r=!1);var n=e.call(this)||this;return Object.defineProperty(n,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"preserveQueueMouse",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(n,"singleQueueMouse",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(n,"preserveQueueTouch",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(n,"singleQueueTouch",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(n,"preserveEvents",{enumerable:!0,configurable:!0,writable:!0,value:!1}),n.handlers=new a.SimpleEventHandler(t),n.preserveEvents=r,n}return i(t,e),Object.defineProperty(t.prototype,"dequeue",{enumerable:!1,configurable:!0,writable:!0,value:function(){try{this.preserveEvents?(this.preserveQueueMouse.forEach((function(e){e[0](e[1])})),this.preserveQueueTouch.forEach((function(e){e[0](e[1])}))):(this.singleQueueMouse.forEach((function(e,t){t(e)})),this.singleQueueTouch.forEach((function(e,t){t(e)})))}catch(e){console.error("Queued events had errors. Further events aborted"),console.error(e.stack||e.message)}this.preserveQueueMouse=[],this.singleQueueMouse.clear(),this.preserveQueueTouch=[],this.singleQueueTouch.clear()}}),Object.defineProperty(t.prototype,"handleMouseDown",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseDown,e]):this.singleQueueMouse.set(this.handlers.handleMouseDown,e)}}),Object.defineProperty(t.prototype,"handleMouseUp",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseUp,e]):this.singleQueueMouse.set(this.handlers.handleMouseUp,e)}}),Object.defineProperty(t.prototype,"handleMouseOver",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseOver,e]):this.singleQueueMouse.set(this.handlers.handleMouseOver,e)}}),Object.defineProperty(t.prototype,"handleMouseOut",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseOut,e]):this.singleQueueMouse.set(this.handlers.handleMouseOut,e)}}),Object.defineProperty(t.prototype,"handleMouseMove",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseMove,e]):this.singleQueueMouse.set(this.handlers.handleMouseMove,e)}}),Object.defineProperty(t.prototype,"handleClick",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleClick,e]):this.singleQueueMouse.set(this.handlers.handleClick,e)}}),Object.defineProperty(t.prototype,"handleDrag",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleDrag,e]):this.singleQueueMouse.set(this.handlers.handleDrag,e)}}),Object.defineProperty(t.prototype,"handleWheel",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleWheel,e]):this.singleQueueMouse.set(this.handlers.handleWheel,e)}}),Object.defineProperty(t.prototype,"handleTouchCancelled",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchCancelled,e]):this.singleQueueTouch.set(this.handlers.handleTouchCancelled,e)}}),Object.defineProperty(t.prototype,"handleTouchDown",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchDown,e]):this.singleQueueTouch.set(this.handlers.handleTouchDown,e)}}),Object.defineProperty(t.prototype,"handleTouchUp",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchUp,e]):this.singleQueueTouch.set(this.handlers.handleTouchUp,e)}}),Object.defineProperty(t.prototype,"handleTouchOut",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchOut,e]):this.singleQueueTouch.set(this.handlers.handleTouchOut,e)}}),Object.defineProperty(t.prototype,"handleTouchDrag",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchDrag,e]):this.singleQueueTouch.set(this.handlers.handleTouchDrag,e)}}),Object.defineProperty(t.prototype,"handleTap",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTap,e]):this.singleQueueTouch.set(this.handlers.handleTap,e)}}),Object.defineProperty(t.prototype,"handleDoubleTap",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleDoubleTap,e]):this.singleQueueTouch.set(this.handlers.handleDoubleTap,e)}}),Object.defineProperty(t.prototype,"handleLongTouch",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleLongTouch,e]):this.singleQueueTouch.set(this.handlers.handleLongTouch,e)}}),Object.defineProperty(t.prototype,"handleLongTap",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleLongTap,e]):this.singleQueueTouch.set(this.handlers.handleLongTap,e)}}),Object.defineProperty(t.prototype,"handlePinch",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handlePinch,e]):this.singleQueueTouch.set(this.handlers.handlePinch,e)}}),Object.defineProperty(t.prototype,"handleSpread",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleSpread,e]):this.singleQueueTouch.set(this.handlers.handleSpread,e)}}),Object.defineProperty(t.prototype,"handleTouchRotate",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchRotate,e]):this.singleQueueTouch.set(this.handlers.handleTouchRotate,e)}}),Object.defineProperty(t.prototype,"handleSwipe",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleSwipe,e]):this.singleQueueTouch.set(this.handlers.handleSwipe,e)}}),t}(o.EventManager);t.QueuedEventHandler=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseIOSorting=void 0;var n=function(){function e(){}return Object.defineProperty(e.prototype,"sortInstanceAttributes",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return e.resource&&!t.resource||e.easing&&!t.easing?-1:1}}),Object.defineProperty(e.prototype,"sortVertexAttributes",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return 1}}),Object.defineProperty(e.prototype,"sortUniforms",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return 1}}),e}();t.BaseIOSorting=n},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(167),t),i(r(100),t),i(r(104),t),i(r(105),t),i(r(173),t),i(r(63),t),i(r(106),t)},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.FontManager=t.createFont=t.isFontResource=t.FontGlyphRenderSize=void 0;var a=r(46),s=r(32),u=r(0),c=r(24),l=r(104),f=r(105),d=r(63),p=r(5)("performance");!function(e){e[e._16=16]="_16",e[e._32=32]="_32",e[e._64=64]="_64",e[e._128=128]="_128"}(t.FontGlyphRenderSize||(t.FontGlyphRenderSize={})),t.isFontResource=function(e){return e&&e.type===u.ResourceType.FONT},t.createFont=function(e){return n({key:"",type:u.ResourceType.FONT},e)};var h=function(){function e(){Object.defineProperty(this,"fontMaps",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"fontRenderer",{enumerable:!0,configurable:!0,writable:!0,value:new f.FontRenderer})}return Object.defineProperty(e.prototype,"calculateMetrics",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return i(this,void 0,void 0,(function(){var r,n,i,a,s,u;return o(this,(function(o){switch(o.label){case 0:if(p("Calculating metrics for requests"),!(r=this.fontMaps.get(e)))return[2];n=0,i=t.length,o.label=1;case 1:return n<i?(a=t[n],(s=a.metrics)?(s.layout=r.getStringLayout(s.text,s.fontSize,s.letterSpacing),s.maxWidth?(p("Calculating truncation for",s.text,s.maxWidth),u=s,[4,r.getTruncatedLayout(s.layout,s.truncation||"",s.maxWidth,s.fontSize,s.letterSpacing,this.fontRenderer)]):[3,3]):[3,3]):[3,4];case 2:u.layout=o.sent(),s.truncatedText=s.layout.text,o.label=3;case 3:return++n,[3,1];case 4:return[2]}}))}))}}),Object.defineProperty(e.prototype,"characterFilterToCharacters",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=new Set,r="",n=0,i=e.length;n<i;++n){var o=e[n];t.has(o)||(t.add(o),r+=o)}return r}}),Object.defineProperty(e.prototype,"createFontMap",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return i(this,void 0,void 0,(function(){var t,r,i,a;return o(this,(function(o){switch(o.label){case 0:return t=this.characterFilterToCharacters(e.characterFilter||""),i=e.fontSource,a=l.FontMapGlyphType.SDF,i&&(a=(s=i)&&void 0===s.type?l.FontMapGlyphType.BITMAP:i.type||a),r=new l.FontMap(n(n({},e),{glyphType:a})),[4,this.updateFontMapCharacters(t,r)];case 1:return o.sent(),this.fontMaps.set(e.key,r),e.fontSource.preload&&this.updateFontMap(e.key,[(0,d.fontRequest)({key:e.key,character:"",kerningPairs:[e.fontSource.preload],metrics:{fontSize:12,text:e.fontSource.preload,letterSpacing:0}})]),[2,r]}var s}))}))}}),Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.fontMaps.forEach((function(e){return e.destroy()}))}}),Object.defineProperty(e.prototype,"destroyFontMap",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.fontMaps.get(e);t&&t.destroy()}}),Object.defineProperty(e.prototype,"updateFontMap",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return i(this,void 0,void 0,(function(){var r,n,i,a,s,u,c,l,f,d;return o(this,(function(o){switch(o.label){case 0:if(!(r=this.fontMaps.get(e)))return[2];for(n=[],i=new Set,f=0,d=t.length;f<d;++f)if((a=t[f]).character&&i.add(a.character),a.kerningPairs&&(n=n.concat(a.kerningPairs)),a.metrics&&a.metrics.truncation)for(s=a.metrics.truncation.replace(/\s/g,""),n.push(s),u=0,c=a.metrics.truncation.length;u<c;++u)i.add(s);for(f=0,d=n.length;f<d;++f)i.add(n[f]);return l="",i.forEach((function(e){return l+=e})),[4,this.updateFontMapCharacters(l,r)];case 1:return o.sent(),[4,this.updateKerningPairs(n,r)];case 2:for(o.sent(),f=0,d=t.length;f<d;++f)t[f].fontMap=r;return[2]}}))}))}}),Object.defineProperty(e.prototype,"updateKerningPairs",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(n){switch(n.label){case 0:return t?[4,this.fontRenderer.estimateKerning(e,t.fontString,t.fontSource.size,t.kerning,!t.spaceWidth)]:[2];case 1:return r=n.sent(),t.addKerning(r.pairs),t.spaceWidth=t.spaceWidth||r.spaceWidth,[2]}}))}))}}),Object.defineProperty(e.prototype,"updateFontMapCharacters",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return i(this,void 0,void 0,(function(){var r,i,u,l,f,d,p,h;return o(this,(function(o){if(!t)return[2];if(r=t.texture,(i=t.findMissingCharacters(e)).length<=0)return[2];for(l in u=this.fontRenderer.makeBitmapGlyphs(i,t.fontString,t.fontSource.size))if(f=u[l],r.data){if(d=new a.Bounds({x:0,y:0,width:f.glyph.width,height:f.glyph.height}),p=new c.SubTexture,!(h=t.packing.insert({data:p,bounds:d})))return console.warn("Font map is full and could not pack in any more glyphs"),[2];s.PackNode.applyToSubTexture(t.packing,h,p,void 0,!0),r.update(f.glyph,n(n({},h.bounds),{y:t.packing.bounds.height-h.bounds.y-h.bounds.height})),p?t.registerGlyph(l,p):console.warn("Could not generate a subtexture for the font map registration.")}else console.warn("Can not update font map as the maps texture data is not defined.");return[2]}))}))}}),Object.defineProperty(e.prototype,"getPrerenderedImageData",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return i(this,void 0,void 0,(function(){var n;return o(this,(function(i){switch(i.label){case 0:return n=[],r.forEach((function(r){var i=e.glyphs[r];if(i||(i=e.errorGlyph),!e.errorGlyph)return console.warn("The prerendered source provided did NOT provide a proper glyph for rendering when a glyph could not be located."),[];var o,a=new Image,s=new Promise((function(e){return o=e}));return a.onload=function(){var e=document.createElement("canvas"),r=e.getContext("2d");if(r){e.width=t,e.height=t,r.drawImage(a,0,0,t,t);var n=r.getImageData(0,0,t,t);o(n)}},a.onerror=function(){console.warn("There was an issue with loading the glyph data for character:",r),o(null)},a.src=e.glyphs[r],n.push(s),[]})),[4,Promise.all(n)];case 1:return[2,i.sent()]}}))}))}}),e}();t.FontManager=h},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.waitForValidDimensions=void 0;var o=r(28),a=r(29);t.waitForValidDimensions=function(e){var t=this,r=0,s=[];return Object.assign((function(u){return n(t,void 0,Promise,(function(){var t,n,c,l,f,d,p;return i(this,(function(i){switch(i.label){case 0:return void 0!==u&&u!==e&&(s.forEach((function(e){return e.resolve(!1)})),e=u),e?(t=++r,n=new a.PromiseResolver,c=e.getBoundingClientRect(),s.push(n),0!==c.width&&0!==c.height?[3,2]:(f=!0,d={attributes:!0},(l=new MutationObserver((function(i){if(f)for(var o=0,a=i;o<a.length;o++){if("attributes"===a[o].type){if(!e)return;0!==(c=e.getBoundingClientRect()).width&&0!==c.height&&(l&&(l.disconnect(),l=void 0),f=!1,n.resolve(t===r))}}}))).observe(e,d),[4,(0,o.nextFrame)()])):[2,!1];case 1:return i.sent(),c=e.getBoundingClientRect(),f&&0!==c.width&&0!==c.height&&(l.disconnect(),f=!1,n.resolve(t===r)),[3,4];case 2:return[4,(0,o.nextFrame)()];case 3:i.sent(),n.resolve(t===r),i.label=4;case 4:return[4,n.promise];case 5:return p=i.sent(),l&&(l.disconnect(),l=void 0),p&&(s.forEach((function(e){return e.resolve(!1)})),s=[]),[2,p]}}))}))}),{cancel:function(){s.forEach((function(e){return e.resolve(!1)})),s=[]}})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createUniform=void 0,t.createUniform=function(e){return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createVertex=void 0,t.createVertex=function(e){return e}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.FontMap=t.FontMapGlyphType=void 0;var u,c=r(4),l=r(2),f=r(0),d=r(17),p=r(32),h=r(5)("performance");!function(e){e[e.BITMAP=0]="BITMAP",e[e.SDF=1]="SDF",e[e.MSDF=2]="MSDF"}(u=t.FontMapGlyphType||(t.FontMapGlyphType={}));var b=function(e){function t(t){var r=e.call(this,t)||this;Object.defineProperty(r,"dynamic",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(r,"fontSource",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"glyphCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"glyphMap",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(r,"kerning",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(r,"manager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"packing",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"spaceWidth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(r,"texture",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"textureSettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"type",{enumerable:!0,configurable:!0,writable:!0,value:f.ResourceType.FONT}),r.dynamic=t.dynamic||!1,r.fontSource=t.fontSource,t.characters&&t.characters.forEach((function(e){r.doRegisterGlyph(e[0],e[1])}));var n=t.fontMapSize?t.fontMapSize:[f.TextureSize._1024,f.TextureSize._1024];return r.makeGlyphTypeTextureSettings(t.glyphType),r.createTexture(n),r.packing=new p.PackNode(0,0,n[0],n[1]),r.addCachedKerning(),r}return i(t,e),Object.defineProperty(t.prototype,"fontString",{get:function(){return"".concat(this.fontSource.size,"px ").concat(this.fontSource.family)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"getKerningCacheName",{enumerable:!1,configurable:!0,writable:!0,value:function(){return"__deltav_kerning_cache_".concat(this.fontSource.family,"__")}}),Object.defineProperty(t.prototype,"addCachedKerning",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this.fontSource.localKerningCache){var e=localStorage.getItem(this.getKerningCacheName());if(e){h("Loading cached kerning items:",this.getKerningCacheName());try{var t=JSON.parse(e),r=0;for(var n in t){var i="string"==typeof n&&1===n.length;if(i){var o=t[n],a=this.kerning[n]||{};for(var s in this.kerning[n]=a,o)(i="string"==typeof n&&1===n.length)&&(a[s]=o[s],r++)}}h("Found kerning items in the cache!","Count:",r)}catch(e){}}}}}),Object.defineProperty(t.prototype,"addKerning",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=!1;for(var r in e){var n=e[r],i=this.kerning[r]||{};for(var o in this.kerning[r]||(t=!0),this.kerning[r]=i,n)i[o]||(t=!0),i[o]=n[o]}if(t&&this.fontSource.localKerningCache)try{h("Storing kerning info in cache...");var a=JSON.stringify(this.kerning);localStorage.setItem(this.getKerningCacheName(),a)}catch(e){h("Could not cache kerning info")}}}),Object.defineProperty(t.prototype,"createTexture",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t;this.texture||(t=this.textureSettings?o({generateMipMaps:!0,premultiplyAlpha:!0},this.textureSettings):{generateMipMaps:!0,premultiplyAlpha:!0},this.texture=new c.Texture(o({data:{width:e[0],height:e[1],buffer:null}},t)))}}),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.texture.destroy()}}),Object.defineProperty(t.prototype,"doRegisterGlyph",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=e[0];this.glyphMap[r]?console.warn("A Glyph is already registered with a rendering"):this.glyphMap[r]=t}}),Object.defineProperty(t.prototype,"findMissingCharacters",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=new Set,r="",n=0,i=e.length;n<i;++n){var o=e[n];this.glyphMap[o]||t.has(o)||(t.add(o),r+=o)}return r}}),Object.defineProperty(t.prototype,"getGlyphTexture",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.glyphMap[e[0]]||null}}),Object.defineProperty(t.prototype,"getGlyphKerning",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this.kerning[e];return r&&r[t]||[0,0]}}),Object.defineProperty(t.prototype,"getGlyphWidth",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=e.positions[t],i=e.positions[r];if(!t||!r)return 0;var o=this.glyphMap[e.glyphs[r]];return o?i[0]+o.pixelWidth-n[0]:0}}),Object.defineProperty(t.prototype,"getTruncatedLayout",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i,o){return a(this,void 0,void 0,(function(){var a,u,c,l,d,p,h,b,g,v,y,m,w,O,_;return s(this,(function(s){switch(s.label){case 0:if(!(e.size[0]>r))return[3,5];for(a="",u=0,w=0,O=t.length;w<O;++w)u+=this.glyphMap[t[w]].pixelWidth;if(u>r)return[2,{fontScale:1,glyphs:"",positions:[],size:[0,0],text:""}];for(c=0,l=e.positions.length,d=0,p=0,h="";c!==l;){if(d=Math.floor((l-c)/2)+c,h=e.glyphs[d],(p=e.positions[d][0]+this.glyphMap[h].pixelWidth+u)>r)l=d;else{if(!(p<r))break;c=d}if(Math.abs(c-l)<=1){if(p<r)break;for(;p>r&&d>=0;)d--,p=e.positions[d][0]+this.glyphMap[h].pixelWidth+u;break}}if(!((p=e.positions[d][0]+this.glyphMap[h].pixelWidth+u)<r))return[3,3];for(b=0,g=0,w=0,O=e.text.length;w<O&&b<=d;++w)v=e.text[w],g++,(0,f.isWhiteSpace)(v)||b++;for(y=e.text[g-1],m=void 0,w=0,O=t.length;w<O;++w)if(!(0,f.isWhiteSpace)(t[w])){m=t[w];break}return y&&m&&!this.kerning[y][m]?[4,o.estimateKerning([y+m],this.fontString,this.fontSource.size,this.kerning,!1)]:[3,2];case 1:_=s.sent(),this.addKerning(_.pairs),s.label=2;case 2:return a="".concat(e.text.substr(0,g)).concat(t),[3,4];case 3:a=t,s.label=4;case 4:return[2,this.getStringLayout(a,n,i)];case 5:return[2,e]}}))}))}}),Object.defineProperty(t.prototype,"getStringWidth",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=e.text,i=0,o=n.length;if("string"==typeof t){var a=n.indexOf(t);if(a<0)return 0;o=(i=a)+t.length}else i=t;void 0!==r&&(o=r);for(var s=0,u=Math.min(n.length,i),c=Math.min(n.length,o);s<u;++s)(0,f.isWhiteSpace)(n[s])&&(i--,o--);for(;s<c;++s)(0,f.isWhiteSpace)(n[s])&&o--;var l=this.glyphMap[e.text[o]||""];return l?(e.positions[o]||[0,0])[0]-(e.positions[i]||[0,0])[0]+l.pixelWidth:0}}),Object.defineProperty(t.prototype,"getStringLayout",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){for(var n,i,o=[],a="",s=t/this.fontSource.size,u=Number.MAX_SAFE_INTEGER,c=0,d=0,p=[0,0],h=this.spaceWidth,b=0,g="",v=0,y=e.length;v<y;++v){var m=e[v];(0,f.isWhiteSpace)(m)?b++:(n=[0,0],g&&(n=this.kerning[g][m]||[0,0]),p=(0,l.add2)((0,l.add2)(p,(0,l.scale2)(n,s)),[b*h*s+(0===v?0:r),0]),o.push([p[0],p[1]]),a+=m,i=this.glyphMap[m],u=Math.min(p[1],u),c=Math.max(p[1]+i.pixelHeight*s,c),g=m,d=p[0]+i.pixelWidth*s,b=0)}var w=[d,c-u];for(v=0,y=o.length;v<y;++v)(p=o[v])[1]-=u;return{fontScale:s,glyphs:a,positions:o,size:w,text:e}}}),Object.defineProperty(t.prototype,"makeGlyphTypeTextureSettings",{enumerable:!1,configurable:!0,writable:!0,value:function(e){switch(e){case u.BITMAP:this.textureSettings={magFilter:c.GLSettings.Texture.TextureMagFilter.Linear,minFilter:c.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear,internalFormat:c.GLSettings.Texture.TexelDataType.LuminanceAlpha,format:c.GLSettings.Texture.TexelDataType.LuminanceAlpha};break;case u.SDF:this.textureSettings={magFilter:c.GLSettings.Texture.TextureMagFilter.Linear,minFilter:c.GLSettings.Texture.TextureMinFilter.Linear,internalFormat:c.GLSettings.Texture.TexelDataType.Luminance,format:c.GLSettings.Texture.TexelDataType.Luminance};break;case u.MSDF:this.textureSettings={magFilter:c.GLSettings.Texture.TextureMagFilter.Linear,minFilter:c.GLSettings.Texture.TextureMinFilter.Linear,internalFormat:c.GLSettings.Texture.TexelDataType.RGB,format:c.GLSettings.Texture.TexelDataType.RGB}}}}),Object.defineProperty(t.prototype,"registerGlyph",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this.dynamic?this.doRegisterGlyph(e,t):console.warn("Attempted to register a new glyph with a non-dynamic FontMap")}}),Object.defineProperty(t.prototype,"supportsKerning",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=1,r=e.length;t<r;++t){var n=e[t],i=e[t-1];if(!this.kerning[i])return!1;if(!this.kerning[i][n])return!1}return!0}}),t}(d.IdentifyByKey);t.FontMap=b},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.FontRenderer=void 0;var o=r(14),a=r(12),s=r(106),u=r(172),c=r(5)("performance"),l=Math.floor;function f(e,t,r,f){return n(this,void 0,void 0,(function(){var n,d,p,h,b,g,v,y,m,w,O,_,T,P,x,E,j,S,R,M,A,I,L,C,B,D,F,N,U,G,z,k,V,W,H,Q,q,X,Y,K,$,Z,J,ee,te,re,ne,ie,oe,ae,se,ue,ce,le,fe,de,pe,he,be,ge;return i(this,(function(i){switch(i.label){case 0:for(n="http://www.w3.org/2000/svg",d=o.WebGLStat.MAX_TEXTURE_SIZE/window.devicePixelRatio,h=1.3*t,b=l(d/(p=2*t)),(g=document.createElementNS(n,"svg")).setAttribute("width","".concat(d,"px")),g.style.font=e,g.style.position="relative",g.style.left="0px",g.style.top="0px",v=[],y=Math.floor(d/h),m=0,w=0,O=0,P=0;w<r.all.length;){for(F=document.createElementNS(n,"g"),_=F,m=Math.floor(v.length/y),F.setAttribute("transform","translate(0, ".concat((v.length-m*y)*h,")")),v.push(F),x=d,O=0;O<b&&w<r.all.length;O++)(I=document.createElementNS(n,"text")).setAttribute("x","".concat(O*p)),I.setAttribute("dy","1em"),le=r.all[w],w++,E=le[0],j=le[1],C=document.createElementNS(n,"tspan"),D=document.createElementNS(n,"tspan"),C.setAttribute("fill","#ff0000"),D.setAttribute("fill","#0000ff"),C.textContent=E,D.textContent=j,I.appendChild(C),I.appendChild(D),F.appendChild(I),x-=p;x>=0?((I=document.createElementNS(n,"text")).setAttribute("width","".concat(x,"px")),F.appendChild(I),T=I):T=null,P=x}for(S=[],ue=0;ue<r.all.length;ue++)S.push([Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER]);return R=0,M=!1,f?(A="M",(I=document.createElementNS(n,"text")).setAttribute("dy","1em"),I.style.width="".concat(p),I.style.height="".concat(h),I.setAttribute("x","".concat(p*O)),I.style.font=e,[4,(0,s.renderGlyph)(A,128,128,e)]):[3,2];case 1:(L=i.sent())&&(R=L.size[0],C=document.createElementNS(n,"tspan"),B=document.createElementNS(n,"tspan"),D=document.createElementNS(n,"tspan"),C.setAttribute("fill","#ff0000"),D.setAttribute("fill","#0000ff"),C.textContent=A,D.textContent=A,B.textContent=" ",I.appendChild(C),I.appendChild(B),I.appendChild(D),O<b&&_?(_.appendChild(I),P-=p,T&&(T.remove(),P>0&&(_.style.width="".concat(P,"px"),_.appendChild(T)))):(F=document.createElement("g"),m=Math.floor(v.length/y),F.setAttribute("transform","translate(0, ".concat((v.length-m*y)*h,")")),(_=F).appendChild(I),v.push(F),T=document.createElementNS(n,"text"),F.appendChild(T)),S.push([Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER]),M=!0),i.label=2;case 2:N=v.length*h,U=Math.ceil(N/d),G=null,c("Rendering table canvas batches for font kerning analysis",r,v),ue=0,i.label=3;case 3:if(!(ue<U))return[3,8];for(z=v.splice(0,y),k=z.length*h,g.setAttribute("height","".concat(k,"px"));g.lastElementChild;)g.lastElementChild.remove();for(V=0,W=z.length;V<W;++V)H=z[V],g.appendChild(H);return G?[3,5]:[4,(0,u.svgToData)(g)];case 4:return G=i.sent(),[3,7];case 5:return[4,(0,u.svgToData)(g)];case 6:if(!(Q=i.sent()))return console.warn("Font Renderer: Could not generate image data for analyzing font kerning"),[3,7];(q=new Uint8ClampedArray(G.data.length+Q.data.length)).set(G.data),q.set(Q.data,G.data.length),G=new ImageData(q,d*window.devicePixelRatio,G.height+Q.height),i.label=7;case 7:return++ue,[3,3];case 8:if(c("Analyzing rendered data",G),X=p*window.devicePixelRatio,Y=h*window.devicePixelRatio,G){for(K=G.data,$=void 0,Z=void 0,J=void 0,ee=void 0,te=void 0,re=void 0,ne=0,ie=G.height;ne<ie;ne++)for(oe=0,ae=G.width;oe<ae;oe++)Z=K[($=4*(ae*ne+oe))+0],J=K[$+1],ee=K[$+2],(re=l(ne/Y)*b+l(oe/X))<S.length&&(te=S[re],Z>0&&0===J&&0===ee&&(oe<te[0]&&(te[0]=oe),ne<te[1]&&(te[1]=ne)),0===Z&&0===J&&ee>0&&(oe<te[2]&&(te[2]=oe),ne<te[3]&&(te[3]=ne)));for(M&&(se=S.pop())&&(he=[se[2]-se[0],0],ge=(0,a.scale2)(he,1/window.devicePixelRatio),r.spaceWidth=Math.ceil(ge[0])-R),ue=0,ce=S.length;ue<ce;ue++)le=r.all[ue],fe=le[0],de=le[1],pe=S[ue],he=[pe[2]-pe[0],pe[3]-pe[1]],(be=r.pairs[fe])&&(ge=(0,a.scale2)(he,1/window.devicePixelRatio),be[de]=[Math.ceil(ge[0]),ge[1]])}else console.warn("html2canvas did not produce a valid canvas context to analyze");return c("Kerning rendering analysis complete",r.pairs),[2]}}))}))}function d(e,t,r){e=e.replace(/\s/g,"");for(var n=r&&r.all||[],i=r&&r.pairs||{},o=0;o<e.length-1;o++){var a=e[o],s=e[o+1],u=i[a];u||(u=i[a]={}),t[a]&&t[a][s]||u[s]||(u[s]=[0,0],n.push("".concat(a).concat(s)))}return{all:n,pairs:i,spaceWidth:0}}var p=function(){function e(){}return Object.defineProperty(e.prototype,"makeBitmapGlyphs",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){for(var n={},i=new Set,o=0,a=e.length;o<a;++o)i.add(e[o]);var u=Array.from(i.values());for(o=0,a=u.length;o<a;++o){var c=u[o],l=(0,s.renderGlyph)(c,2*r,2*r,t);l?n[c]={glyph:l.data,glyphIndex:o}:console.warn("Unable to render character",c,"to font map for rendering.")}return n}}),Object.defineProperty(e.prototype,"estimateKerning",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,o,a){return n(this,void 0,void 0,(function(){var n,s,u;return i(this,(function(i){switch(i.label){case 0:for(n={all:[],pairs:{},spaceWidth:0},c("Estimating Kerning for",e),s=0,u=e.length;s<u;++s)d(e[s],o,n);return n.all.length>0||a?[4,f(t,r,n,a)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2,n]}}))}))}}),e}();t.FontRenderer=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderGlyph=void 0;var n,i=Math.min,o=Math.max,a=document.createElement("canvas");t.renderGlyph=function(e,t,r,s){if(e=e[0],(a.width<t||a.height<r)&&(a.width=t,a.height=r),!n){var u=a.getContext("2d");if(!u)return null;n=u}n.clearRect(0,0,a.width,a.height),n.font=s,n.fillStyle="white",n.fillText(e,t/2,r/2);var c=function(e){for(var t=e.canvas,r=t.width,n=t.height,a=e.getImageData(0,0,r,n).data,s=!1,u=Number.MAX_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER,f=Number.MIN_SAFE_INTEGER,d=0;d<r;++d)for(var p=0;p<n;++p){a[p*(4*r)+4*d]>0&&(s=!0,u=i(u,p),c=i(c,d),l=o(l,d),f=o(f,p))}return s?(f+=2,l+=2,c-=1,u=o(u-=1,0),{minX:c=o(c,0),minY:u,maxX:l,maxY:f}):null}(n);if(!c)return{data:n.getImageData(0,0,1,1),size:[0,0]};var l=c.maxX-c.minX,f=c.maxY-c.minY;return{data:n.getImageData(c.minX,c.minY,l,f),size:[l,f]}}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(108),t),i(r(110),t),i(r(175),t),i(r(64),t),i(r(109),t),i(r(32),t),i(r(24),t),i(r(42),t),i(r(49),t),i(r(111),t),i(r(50),t)},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.AtlasManager=void 0;var a=r(4),s=r(7),u=r(109),c=r(174),l=r(0),f=r(64),d=r(32),p=r(24),h=r(5)("performance"),b=new p.SubTexture({aspectRatio:0,atlasBL:[0,0],atlasBR:[0,0],texture:null,atlasTL:[0,0],atlasTR:[0,0],heightOnAtlas:0,isValid:!1,pixelHeight:0,pixelWidth:0,widthOnAtlas:0});var g=function(){function e(){Object.defineProperty(this,"allAtlas",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"renderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"createAtlas",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(r){return t=new f.Atlas(e),this.allAtlas.set(t.id,t),h("Atlas Created-> %o",t),[2,t]}))}))}}),Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.allAtlas.forEach((function(e){return e.destroy()}))}}),Object.defineProperty(e.prototype,"destroyAtlas",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.allAtlas.get(e);t&&t.destroy()}}),Object.defineProperty(e.prototype,"setDefaultImage",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return e=Object.assign(e,b,{atlasReferenceID:t})}}),Object.defineProperty(e.prototype,"draw",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return i(this,void 0,Promise,(function(){var r,i,a,u,l,f,b,g;return o(this,(function(o){switch(o.label){case 0:return r=e.id,t.disposeResource?[2,!0]:(i=e.resourceReferences.get(t.source))?(t.texture=i.subtexture,[2,!0]):(t.texture=new p.SubTexture,t.texture.isValid=!0,e.resourceReferences.set(t.source,{subtexture:t.texture,count:0}),[4,this.loadImage(t)]);case 1:if(a=o.sent(),u=t.texture,a&&((v=u)&&v.isValid&&v.pixelWidth&&v.pixelHeight)){if(l=new s.Bounds({bottom:u.pixelHeight,left:0,right:u.pixelWidth,top:0}),(f={data:u,bounds:l}).bounds.width+=0,f.bounds.height+=0,b=e.packing,!(g=b.insert(f))){if(!this.repackResources(e))return console.error("Repacking the atlas failed. Some resources may be in an undefined state. Consider making another atlas."),[2,!1];b=e.packing,g=b.insert(f)}return g?(g.data=u,d.PackNode.applyToSubTexture(b,g,u,{top:.5,left:.5,right:.5,bottom:.5}),u.texture=e.texture,u.source=a,u.atlasRegion=n(n({},g.bounds),{y:e.height-g.bounds.y-g.bounds.height}),e.texture.update(a,u.atlasRegion),a instanceof HTMLVideoElement&&(u.video={monitor:new c.VideoTextureMonitor(a,u)}),[2,!0]):(console.error("Could not fit resource into atlas",t),t.texture=this.setDefaultImage(u,r),[2,!1])}return u&&!u.isValid?h("Resource was invalidated during load:",t):console.error("Could not load resource:",t),t.texture&&(t.texture=this.setDefaultImage(t.texture,r)),[2,!1]}var v}))}))}}),Object.defineProperty(e.prototype,"getAtlasTexture",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.allAtlas.get(e)}}),Object.defineProperty(e.prototype,"loadImage",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return i(this,void 0,Promise,(function(){var t,r,n,i;return o(this,(function(o){switch(o.label){case 0:return t=e.texture||new p.SubTexture,r=e.source,e.texture=t,!1===e.texture.isValid?[2,null]:r instanceof HTMLImageElement?[4,new Promise((function(e){if(r instanceof HTMLImageElement){var n=r;if(n.width&&n.height)return u.ImageRasterizer.calculateImageSize(n),t.pixelWidth=n.width,t.pixelHeight=n.height,t.aspectRatio=n.width/n.height,void e(n);n?(n.onload=function(){t.pixelWidth=n.width,t.pixelHeight=n.height,t.aspectRatio=n.width/n.height,n.onload=null,e(n)},n.onerror=function(){console.error("Error generating Image element for source:",r),n.onload=null,e(null)}):e(null)}}))]:[3,4];case 1:return(i=o.sent())&&void 0!==e.rasterizationScale&&1!==e.rasterizationScale?[4,u.ImageRasterizer.resizeImage(i,e.rasterizationScale||1)]:[3,3];case 2:i=o.sent(),o.label=3;case 3:return[2,i];case 4:return r instanceof HTMLVideoElement?0===r.videoHeight||0===r.videoWidth?(console.warn("Video requests to the atlas manager MUST have the video completely loaded and ready for loading","There are too many caveats to automate video loading at this low of a level to have it prepped properly for","use in the texture for all browsers. Consider handling video resources at the layer level to have them","prepped for use."),[2,null]):(t.pixelWidth=r.videoWidth,t.pixelHeight=r.videoHeight,t.aspectRatio=r.videoWidth/r.videoHeight,[2,r]):[3,5];case 5:return(0,l.isString)(r)?(n=r,[4,new Promise((function(e){var i=new Image;i.onload=function(){t.pixelWidth=i.width,t.pixelHeight=i.height,t.aspectRatio=i.width/i.height,i.onload=null,e(i)},i.onerror=function(){console.error("Error generating Image element for source:",r),e(null)},i.src=n}))]):[3,9];case 6:return(i=o.sent())&&void 0!==e.rasterizationScale&&1!==e.rasterizationScale?[4,u.ImageRasterizer.resizeImage(i,e.rasterizationScale||1)]:[3,8];case 7:i=o.sent(),o.label=8;case 8:return[2,i];case 9:return(i=r)&&void 0!==e.rasterizationScale&&1!==e.rasterizationScale?[4,u.ImageRasterizer.resizeImage(i,e.rasterizationScale||1)]:[3,11];case 10:i=o.sent(),o.label=11;case 11:return[2,i]}}))}))}}),Object.defineProperty(e.prototype,"repackResources",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!this.renderer)return console.warn("Attempted to repack resources for an atlas, but no renderer has been specified for this manager yet."),!1;for(var t=[e.packing],r=[],n=0,i=new Map;n<t.length;){var o=t[n];n++,o.data&&o.data.texture&&(r.push(o),i.set(o.bounds,new s.Bounds(o.bounds))),o.child[0]&&t.push(o.child[0]),o.child[1]&&t.push(o.child[1])}if(r.sort((function(e,t){return Math.max(t.bounds.width,t.bounds.height)-Math.max(e.bounds.width,e.bounds.height)})),r.length<=0)return e.packing=new d.PackNode(0,0,e.width,e.height),!0;var u=new a.Texture(e.texture);u.data={buffer:new Uint8Array(e.width*e.height*4),width:e.width,height:e.height};for(var c=new d.PackNode(0,0,e.width,e.height),l=!1,f=0,h=r.length;f<h;++f){if((m=r[f]).data){m.bounds.x=0,m.bounds.y=0;var b=c.insert({bounds:m.bounds,data:m.data});b?d.PackNode.applyToSubTexture(c,b,m.data):(console.warn("When repacking the atlas, an existing node was unable to be repacked",m),l=!0)}else console.warn("Attempted to repack a node with no valid data.")}if(l)return!1;var g=new Float32Array(2*r.length*6),v=new Float32Array(2*r.length*6),y=new p.SubTexture;for(f=0,h=r.length;f<h;++f){var m=r[f],w=i.get(m.bounds),O=m.data;if(w&&O){d.PackNode.applyToSubTexture(c,w,y);var _=2*f*6;g[_]=2*O.atlasTL[0]-1,g[_+1]=2*O.atlasTL[1]-1,g[_+2]=2*O.atlasTR[0]-1,g[_+3]=2*O.atlasTR[1]-1,g[_+4]=2*O.atlasBL[0]-1,g[_+5]=2*O.atlasBL[1]-1,g[_+6]=2*O.atlasTR[0]-1,g[_+7]=2*O.atlasTR[1]-1,g[_+8]=2*O.atlasBR[0]-1,g[_+9]=2*O.atlasBR[1]-1,g[_+10]=2*O.atlasBL[0]-1,g[_+11]=2*O.atlasBL[1]-1,v[_]=y.atlasTL[0],v[_+1]=y.atlasTL[1],v[_+2]=y.atlasTR[0],v[_+3]=y.atlasTR[1],v[_+4]=y.atlasBL[0],v[_+5]=y.atlasBL[1],v[_+6]=y.atlasTR[0],v[_+7]=y.atlasTR[1],v[_+8]=y.atlasBR[0],v[_+9]=y.atlasBR[1],v[_+10]=y.atlasBL[0],v[_+11]=y.atlasBL[1],O.texture=u}else console.warn("While repacking there was an issue finding the previous bounds and the next texture to use",w,O)}var T=new a.Geometry,P=new a.Attribute(g,2),x=new a.Attribute(v,2);T.addAttribute("position",P),T.addAttribute("texCoord",x);var E=new a.RenderTarget({buffers:{color:{buffer:u,outputType:0}},retainTextureTargets:!0}),j=new a.Material({culling:a.GLSettings.Material.CullSide.NONE,uniforms:{texture:{type:a.MaterialUniformType.TEXTURE,value:e.texture}},fragmentShader:new Map([[E,{outputNames:[],outputTypes:[0],source:"\n          precision highp float;\n\n          uniform sampler2D texture;\n          varying vec2 _texCoord;\n\n          void main() {\n            gl_FragColor = texture2D(texture, _texCoord);\n          }\n        "}]]),vertexShader:"\n        precision highp float;\n\n        attribute vec2 position;\n        attribute vec2 texCoord;\n        varying vec2 _texCoord;\n\n        void main() {\n          _texCoord = texCoord;\n          gl_Position = vec4(position, 0.0, 1.0);\n        }\n      "}),S=new a.Model("__atlas_manager__",T,j);S.vertexCount=6*r.length,S.drawMode=a.GLSettings.Model.DrawMode.TRIANGLES;var R=new a.Scene;return R.add(S),this.renderer.setRenderTarget(E),this.renderer.setViewport(this.renderer.getFullViewport()),this.renderer.setScissor(this.renderer.getFullViewport()),this.renderer.render(R,E),j.dispose(),T.destroy(),E.dispose(),e.texture.destroy(),e.texture=u,e.packing=c,!0}}),Object.defineProperty(e.prototype,"updateAtlas",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return i(this,void 0,void 0,(function(){var r,n,i,a,s,u;return o(this,(function(o){switch(o.label){case 0:if(!(r=this.allAtlas.get(e)))return[3,5];n=0,i=t,o.label=1;case 1:return n<i.length?(u=i[n]).disposeResource?[3,3]:[4,this.draw(r,u)]:[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:for(a=0,s=t.length;a<s;++a)(u=t[a]).disposeResource?r.stopUsingResource(u):r.useResource(u);return r.resolveResources(),[3,6];case 5:console.warn("Can not update non-existing atlas:",e,"These resources will not be loaded:",t),o.label=6;case 6:return[2,r]}}))}))}}),e}();t.AtlasManager=g},function(e,t,r){"use strict";var n,i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageRasterizer=void 0;var a=function(){function e(){}return Object.defineProperty(e,"awaitContext",{enumerable:!1,configurable:!0,writable:!0,value:function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return n?[3,2]:(this.getContext(),[4,new Promise((function(e){return setTimeout(e,10)}))]);case 1:return e.sent(),[3,0];case 2:return[2]}}))}))}}),Object.defineProperty(e,"getContext",{enumerable:!1,configurable:!0,writable:!0,value:function(){n||(n=document.createElement("canvas").getContext("2d"))}}),Object.defineProperty(e,"calculateImageSize",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.awaitContext()];case 1:return t.sent(),n?0===e.width||0===e.height?(console.warn("Images provided shoud have valid dimensions! Please ensure the image is loaded first."),[2]):(n.canvas.width=100,n.canvas.height=100,n.drawImage(e,0,0,1,1),[2,[e.width,e.height]]):(console.warn("The Image rasterizer was unable to establish a valid canvas context. Please ensure the system supports contexts and ensure the document is ready first."),[2])}}))}))}}),Object.defineProperty(e,"resizeImage",{enumerable:!1,configurable:!0,writable:!0,value:function(t,r){return i(this,void 0,void 0,(function(){var i;return o(this,(function(o){switch(o.label){case 0:return[4,this.awaitContext()];case 1:return o.sent(),n?0===t.width||0===t.height?(console.warn("Images provided shoud have valid dimensions! Please ensure the image is loaded first."),[2,t]):(n.canvas.width=Math.floor(t.width*r),n.canvas.height=Math.floor(t.height*r),t instanceof ImageData?n.putImageData(t,0,0,0,0,n.canvas.width,n.canvas.height):n.drawImage(t,0,0,n.canvas.width,n.canvas.height),(i=new Image).src=n.canvas.toDataURL("image/png"),[4,e.calculateImageSize(i)]):(console.warn("The Image rasterizer was unable to establish a valid canvas context. Please ensure the system supports contexts and ensure the document is ready first."),[2,t]);case 2:return o.sent(),[2,i]}}))}))}}),e}();t.ImageRasterizer=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.AtlasResourceManager=void 0;var s=r(0),u=r(3),c=r(21),l=r(64),f=r(108),d=r(24),p=r(42),h=function(e){function t(t){var r=e.call(this)||this;return Object.defineProperty(r,"resources",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(r,"atlasManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"requestQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(r,"requestLookup",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),r.atlasManager=t&&t.atlasManager||new f.AtlasManager,r}return i(t,e),Object.defineProperty(t.prototype,"webGLRenderer",{get:function(){return this._webGLRenderer},set:function(e){this._webGLRenderer=e,this.atlasManager.renderer=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dequeueRequests",{enumerable:!1,configurable:!0,writable:!0,value:function(){return o(this,void 0,void 0,(function(){var e,t,r,n,i,o,s,c,l;return a(this,(function(f){switch(f.label){case 0:e=!1,t=[],this.requestQueue.forEach((function(e,r){t.push([r,e])})),this.requestQueue.clear(),r=function(t,r){var i,o,s;return a(this,(function(a){switch(a.label){case 0:return r.length>0?(e=!0,i=r.slice(0),r.length=0,[4,n.atlasManager.updateAtlas(t,i)]):[3,2];case 1:a.sent(),(o=n.requestLookup.get(t))&&(s=new Set,i.forEach((function(e){var t=o.get(e);if(o.delete(e),t&&!e.disposeResource)for(var r=0,n=t.length;r<n;++r){var i=t[r],a=i[0],u=i[1];a.managesInstance(u)&&(u.active=!0),s.add(u)}})),(0,u.nextFrame)((function(){s.forEach((function(e){e.active=!0,e.resourceTrigger()}))}))),a.label=2;case 2:return[2]}}))},n=this,i=0,o=t,f.label=1;case 1:return i<o.length?(s=o[i],c=s[0],l=s[1],[5,r(c,l)]):[3,4];case 2:f.sent(),f.label=3;case 3:return i++,[3,1];case 4:return[2,e]}}))}))}}),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.atlasManager.destroy()}}),Object.defineProperty(t.prototype,"destroyResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.resources.get(e.key)&&(this.atlasManager.destroyAtlas(e.key),this.resources.delete(e.key))}}),Object.defineProperty(t.prototype,"getAtlasTexture",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.atlasManager.getAtlasTexture(e);return t?t.texture:null}}),Object.defineProperty(t.prototype,"getResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.resources.get(e)||null}}),Object.defineProperty(t.prototype,"getIOExpansion",{enumerable:!1,configurable:!0,writable:!0,value:function(){return[new p.TextureIOExpansion(s.ResourceType.ATLAS,this)]}}),Object.defineProperty(t.prototype,"initResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(r){switch(r.label){case 0:return(0,l.isAtlasResource)(e)?[4,this.atlasManager.createAtlas(e)]:[3,2];case 1:t=r.sent(),this.resources.set(e.key,t),r.label=2;case 2:return[2]}}))}))}}),Object.defineProperty(t.prototype,"request",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){var i=r.key||"",o=r.texture;if(o)return(0,d.subTextureIOValue)(o);var a=this.requestLookup.get(i);if(a){var s=a.get(r);if(s)return s.push([e,t]),t.active=!1,(0,d.subTextureIOValue)(r.texture)}else a=new Map,this.requestLookup.set(i,a);r.disposeResource||(t.active=!1);var u=this.requestQueue.get(i);return u||(u=[],this.requestQueue.set(i,u)),u.push(r),a.set(r,[[e,t]]),(0,d.subTextureIOValue)(o)}}),Object.defineProperty(t.prototype,"updateResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){(0,l.isAtlasResource)(e)}}),t}(c.BaseResourceManager);t.AtlasResourceManager=h},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderTextureResourceManager=void 0;var s=r(0),u=r(21),c=r(49),l=r(42),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"resources",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),t}return i(t,e),Object.defineProperty(t.prototype,"dequeueRequests",{enumerable:!1,configurable:!0,writable:!0,value:function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2,!1]}))}))}}),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.resources.forEach((function(e){return e.destroy()})),this.resources.clear()}}),Object.defineProperty(t.prototype,"getIOExpansion",{enumerable:!1,configurable:!0,writable:!0,value:function(){return[new l.TextureIOExpansion(s.ResourceType.TEXTURE,this)]}}),Object.defineProperty(t.prototype,"getResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.resources.get(e)||null}}),Object.defineProperty(t.prototype,"destroyResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.resources.get(e.key);t&&(t.destroy(),this.resources.delete(e.key))}}),Object.defineProperty(t.prototype,"initResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(r){return(t=this.resources.get(e.key))?(console.warn("Attempted to generate a RenderTexture that already exists for key",e.key),[2]):(t=new c.RenderTexture(e,this.webGLRenderer),this.resources.set(e.key,t),[2])}))}))}}),Object.defineProperty(t.prototype,"request",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){var i=this.resources.get(r.key);return i?(r.texture=i.texture,[0,0,1,1]):[0,0,0,0]}}),Object.defineProperty(t.prototype,"resize",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=new Map;this.resources.forEach((function(r,n){r.width>s.TextureSize.SCREEN&&r.height>s.TextureSize.SCREEN||(r.texture.destroy(),r=new c.RenderTexture(r,e.webGLRenderer),t.set(n,r))})),t.forEach((function(t,r){return e.resources.set(r,t)}))}}),Object.defineProperty(t.prototype,"updateResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.resources.get(e.key)&&console.warn("UPDATING AN EXISTING RENDER TEXTURE IS NOT SUPPORTED YET")}}),t}(u.BaseResourceManager);t.RenderTextureResourceManager=f},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.LayerMouseEvents=void 0;var s=r(97),u=r(0),c=r(3),l=function(e){function t(){var t=e.call(this,{handleClick:function(e){return o(t,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.enablePicking(),[4,this.willRenderResolver.promise];case 1:return t.sent(),this.enablePicking(),[4,this.didRenderResolver.promise];case 2:return t.sent(),this.handleInteraction(e,(function(t,r){t.interactions.handleMouseClick(r,e)})),[2]}}))}))},handleTap:function(e){return o(t,void 0,void 0,(function(){var t=this;return a(this,(function(r){switch(r.label){case 0:return this.enablePicking(),[4,this.willRenderResolver.promise];case 1:return r.sent(),this.enablePicking(),[4,this.didRenderResolver.promise];case 2:return r.sent(),e.touches.forEach((function(r){t.handleInteraction(r,(function(t,n){t.interactions.handleTap(n,e,r)}))})),[2]}}))}))},handleDrag:function(e){return o(t,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.willRenderResolver.promise];case 1:return t.sent(),this.handleInteraction(e,(function(t,r){t.interactions.handleMouseDrag(r,e)})),[2]}}))}))},handleMouseDown:function(e){return o(t,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.enablePicking(),[4,this.willRenderResolver.promise];case 1:return t.sent(),this.handleInteraction(e,(function(t,r){return t.interactions.handleMouseDown(r,e)})),[2]}}))}))},handleTouchDown:function(e){return o(t,void 0,void 0,(function(){var t=this;return a(this,(function(r){switch(r.label){case 0:return this.enablePicking(),[4,this.willRenderResolver.promise];case 1:return r.sent(),e.touches.forEach((function(r){t.handleInteraction(r,(function(t,n){return t.interactions.handleTouchDown(n,e,r)}))})),[2]}}))}))},handleMouseUp:function(e){return o(t,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.willRenderResolver.promise];case 1:return t.sent(),this.handleInteraction(e,(function(t,r){return t.interactions.handleMouseUp(r,e)})),[2]}}))}))},handleTouchUp:function(e){return o(t,void 0,void 0,(function(){var t=this;return a(this,(function(r){switch(r.label){case 0:return[4,this.willRenderResolver.promise];case 1:return r.sent(),e.touches.forEach((function(r){t.handleInteraction(r,(function(t,n){return t.interactions.handleTouchUp(n,e,r)}))})),[2]}}))}))},handleMouseOut:function(e){return o(t,void 0,void 0,(function(){var t=this;return a(this,(function(r){switch(r.label){case 0:return[4,this.willRenderResolver.promise];case 1:return r.sent(),this.isOver.forEach((function(r){t.handleView(r,(function(t,r){return t.interactions.handleMouseOut(r,e)}))})),this.isOver.clear(),[2]}}))}))},handleTouchOut:function(e){return o(t,void 0,void 0,(function(){var t=this;return a(this,(function(r){switch(r.label){case 0:return[4,this.willRenderResolver.promise];case 1:return r.sent(),e.touches.forEach((function(r){(0,c.mapGetWithDefault)(t.isTouchOver,r.touch.touch.identifier,new Set).forEach((function(n){t.handleView(n,(function(t,n){return t.interactions.handleTouchOut(n,e,r)}))})),t.isOver.clear()})),[2]}}))}))},handleMouseMove:function(e){return o(t,void 0,void 0,(function(){var t,r,n=this;return a(this,(function(i){switch(i.label){case 0:return this.enablePicking(),[4,this.willRenderResolver.promise];case 1:return i.sent(),t=this.handleInteraction(e,(function(t,r){return t.interactions.handleMouseMove(r,e)})),r=new Set,t.forEach((function(e){return r.add(e)})),this.isOver.forEach((function(t){r.has(t)||n.handleView(t,(function(t,r){return t.interactions.handleMouseOut(r,e)}))})),r.forEach((function(t){n.isOver.has(t)||n.handleView(t,(function(t,r){return t.interactions.handleMouseOver(r,e)}))})),this.isOver=r,[2]}}))}))},handleTouchDrag:function(e){return o(t,void 0,void 0,(function(){var t=this;return a(this,(function(r){switch(r.label){case 0:return this.enablePicking(),[4,this.willRenderResolver.promise];case 1:return r.sent(),e.touches.forEach((function(r){var n=t.handleInteraction(r,(function(t,n){return t.interactions.handleTouchMove(n,e,r)})),i=new Set;n.forEach((function(e){return i.add(e)}));var o=(0,c.mapInjectDefault)(t.isTouchOver,r.touch.touch.identifier,new Set);o.forEach((function(n){i.has(n)||t.handleView(n,(function(t,n){return t.interactions.handleTouchOut(n,e,r)}))})),i.forEach((function(n){o.has(n)||t.handleView(n,(function(t,n){return t.interactions.handleTouchOver(n,e,r)}))})),t.isTouchOver.set(r.touch.touch.identifier,i)})),[2]}}))}))}})||this;return Object.defineProperty(t,"isOver",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(t,"isTouchOver",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"willRenderResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"didRenderResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t}return i(t,e),Object.defineProperty(t.prototype,"scenes",{get:function(){return this.surface&&this.surface.sceneDiffs?this.surface.sceneDiffs.items:[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enablePicking",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.surface&&this.surface.enableOptimizedOutput(u.FragmentOutputType.PICKING)}}),Object.defineProperty(t.prototype,"willRender",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var e=0,t=this.scenes.length;e<t;++e)for(var r=this.scenes[e],n=0,i=r.layers.length;n<i;++n){delete r.layers[n].interactions.colorPicking}this.willRenderResolver&&this.willRenderResolver.resolve(),this.willRenderResolver=new c.PromiseResolver,this.dequeue()}}),Object.defineProperty(t.prototype,"didRender",{enumerable:!1,configurable:!0,writable:!0,value:function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return this.didRenderResolver&&this.didRenderResolver.resolve(),this.didRenderResolver=new c.PromiseResolver,[2]}))}))}}),Object.defineProperty(t.prototype,"getSceneViewsUnderMouse",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=new Map,r=0,n=this.scenes.length;r<n;++r)for(var i=this.scenes[r],o=0,a=i.views.length;o<a;++o){var s=i.views[o];t.set(s.id,s)}return e.target.views.map((function(e){return t.get(e.view.id)})).filter(c.isDefined)}}),Object.defineProperty(t.prototype,"handleInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){for(var r=this.getSceneViewsUnderMouse(e),n=0,i=r.length;n<i;++n){var o=r[n];this.handleView(o,t)}return r}}),Object.defineProperty(t.prototype,"handleView",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){for(var r=0,n=e.scene.layers.length;r<n;++r){var i=e.scene.layers[r];i.picking&&i.picking.type!==u.PickType.NONE&&t(i,e)}}}),t}(s.QueuedEventHandler);t.LayerMouseEvents=l},function(e,t){e.exports="vec3 cameraSpace(vec3 world) {\nreturn (world + cameraOffset) * cameraScale2D;\n}\nvec3 cameraSpaceSize(vec3 worldSize) {\nreturn worldSize * cameraScale2D;\n}\nvec4 clipSpace(vec3 world) {\nreturn (viewProjection) * vec4(cameraSpace(world), 1.0);\n}\nvec4 clipSpaceSize(vec3 worldSize) {\nreturn (viewProjection) * vec4(cameraSpaceSize(worldSize), 0.0);\n}"},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(183),t),i(r(40),t),i(r(41),t),i(r(6),t),i(r(184),t),i(r(185),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeBroadphase=t.EdgeType=t.EdgeScaleType=void 0,function(e){e[e.NONE=0]="NONE",e[e.SCREEN_CURVE=1]="SCREEN_CURVE"}(t.EdgeScaleType||(t.EdgeScaleType={})),function(e){e[e.LINE=0]="LINE",e[e.BEZIER=1]="BEZIER",e[e.BEZIER2=2]="BEZIER2"}(t.EdgeType||(t.EdgeType={})),function(e){e[e.ALL=0]="ALL",e[e.PASS_Y=1]="PASS_Y",e[e.PASS_X=2]="PASS_X"}(t.EdgeBroadphase||(t.EdgeBroadphase={}))},function(e,t,r){"use strict";var n,i,o,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.LabelLayer=void 0;var u=r(35),c=r(2),l=r(23),f=r(0),d=r(3),p=r(19),h=r(6),b=r(117),g=r(118),v=((i={})[p.AnchorType.TopLeft]=function(e,t){e.x=0,e.y=0},i[p.AnchorType.TopMiddle]=function(e,t){e.x=t.size[0]/2,e.y=0},i[p.AnchorType.TopRight]=function(e,t){e.x=t.size[0],e.y=0},i[p.AnchorType.MiddleLeft]=function(e,t){e.x=0,e.y=t.size[1]/2},i[p.AnchorType.Middle]=function(e,t){e.x=t.size[0]/2,e.y=t.size[1]/2},i[p.AnchorType.MiddleRight]=function(e,t){e.x=t.size[0],e.y=t.size[1]/2},i[p.AnchorType.BottomLeft]=function(e,t){e.x=0,e.y=t.size[1]},i[p.AnchorType.BottomMiddle]=function(e,t){e.x=t.size[0]/2,e.y=t.size[1]},i[p.AnchorType.BottomRight]=function(e,t){e.x=t.size[0],e.y=t.size[1]},i[p.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},i),y=[[-1,-1],[0,-1],[1,-1],[-1,0],[0,0],[1,0],[-1,1],[0,1],[1,1]].map((function(e){var t=Math.sqrt((0,c.dot2)(e,e));return(0,c.scale2)(e,1/-t)})),m=((o={})[p.AnchorType.TopLeft]=function(e){e.paddingDirection=(0,c.scale2)(y[0],e.padding)},o[p.AnchorType.TopMiddle]=function(e){e.paddingDirection=(0,c.scale2)(y[1],e.padding)},o[p.AnchorType.TopRight]=function(e){e.paddingDirection=(0,c.scale2)(y[2],e.padding)},o[p.AnchorType.MiddleLeft]=function(e){e.paddingDirection=(0,c.scale2)(y[3],e.padding)},o[p.AnchorType.Middle]=function(e){e.paddingDirection=[0,0]},o[p.AnchorType.MiddleRight]=function(e){e.paddingDirection=(0,c.scale2)(y[5],e.padding)},o[p.AnchorType.BottomLeft]=function(e){e.paddingDirection=(0,c.scale2)(y[6],e.padding)},o[p.AnchorType.BottomMiddle]=function(e){e.paddingDirection=(0,c.scale2)(y[7],e.padding)},o[p.AnchorType.BottomRight]=function(e){e.paddingDirection=(0,c.scale2)(y[8],e.padding)},o[p.AnchorType.Custom]=function(e){e.paddingDirection=e.paddingDirection},o);function w(e){if(e)return function(t){e(s(s({},t),{instances:t.instances.map((function(e){return e.parentLabel})).filter(d.isDefined)}))}}var O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"fullUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(t,"glyphProvider",{enumerable:!0,configurable:!0,writable:!0,value:new u.InstanceProvider}),Object.defineProperty(t,"labelToGlyphs",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"labelToKerningRequest",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"labelWaitingOnGlyph",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"propertyIds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"truncationKerningRequest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"truncationWidth",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(t,"handleGlyphReady",{enumerable:!0,configurable:!0,writable:!0,value:function(e){if(e.parentLabel){var r=e.parentLabel,n=t.labelWaitingOnGlyph.get(e.parentLabel);if(n&&n.has(e)&&(n.delete(e),n.size<=0)){var i=r.onReady;i&&i(r)}}else delete e.onReady}}),t}return a(t,e),Object.defineProperty(t.prototype,"childLayers",{enumerable:!1,configurable:!0,writable:!0,value:function(){return[(0,d.createLayer)(this.props.customGlyphLayer||g.GlyphLayer,{animate:this.props.animate,data:this.glyphProvider,key:"".concat(this.id,".glyphs"),resourceKey:this.props.resourceKey,scaleMode:this.props.scaleMode||p.ScaleMode.BOUND_MAX,inTextArea:this.props.inTextArea,picking:this.props.picking,onMouseClick:w(this.props.onMouseClick),onMouseUp:w(this.props.onMouseUp),onMouseDown:w(this.props.onMouseDown),onMouseOut:w(this.props.onMouseOut),onMouseOver:w(this.props.onMouseOver),onMouseMove:w(this.props.onMouseMove),onMouseUpOutside:w(this.props.onMouseUpOutside),onTap:w(this.props.onTap),onTouchDown:w(this.props.onTouchDown),onTouchUp:w(this.props.onTouchUp),onTouchUpOutside:w(this.props.onTouchUpOutside),onTouchMove:w(this.props.onTouchMove),onTouchOut:w(this.props.onTouchOut),onTouchOver:w(this.props.onTouchOver),onTouchAllEnd:w(this.props.onTouchAllEnd),onTouchAllOut:w(this.props.onTouchAllOut)})]}}),Object.defineProperty(t.prototype,"draw",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.resolveChanges();if(!(e.length<=0)){if(!this.propertyIds){var t=e[0][0];this.propertyIds=this.getInstanceObservableIds(t,["text","active","anchor","color","origin","fontSize","maxWidth","maxScale","letterSpacing"])}for(var r=this.propertyIds,n=r.text,i=r.active,o=r.anchor,a=r.color,s=r.origin,u=r.fontSize,c=r.maxWidth,l=r.maxScale,d=r.letterSpacing,p=0,h=e.length;p<h;++p){var b=e[p],g=(t=b[0],b[1]),v=b[2];switch(g){case f.InstanceDiffType.CHANGE:if(!this.labelToGlyphs.get(t)){this.insert(t);continue}void 0!==v[n]?(this.invalidateRequest(t),this.layoutGlyphs(t)):void 0!==v[i]&&(t.active?(this.layoutGlyphs(t),this.showGlyphs(t)):this.hideGlyphs(t)),v[o]&&this.updateAnchor(t),void 0!==v[a]&&this.updateGlyphColors(t),void 0!==v[s]&&this.updateGlyphOrigins(t),void 0!==v[l]&&this.updateGlyphMaxScales(t),void 0!==v[u]&&(this.invalidateRequest(t),this.layoutGlyphs(t)),void 0!==v[c]&&(this.invalidateRequest(t),this.layoutGlyphs(t)),void 0!==v[d]&&(this.invalidateRequest(t),this.layoutGlyphs(t));break;case f.InstanceDiffType.INSERT:this.insert(t);break;case f.InstanceDiffType.REMOVE:var y=this.labelToGlyphs.get(t);if(y){for(var m=0,w=y.length;m<w;++m)this.glyphProvider.remove(y[m]);this.labelToGlyphs.delete(t),this.labelToKerningRequest.delete(t),this.labelWaitingOnGlyph.delete(t)}}}}}}),Object.defineProperty(t.prototype,"insert",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.preload?this.props.data.remove(e):this.labelToGlyphs.get(e)||this.labelToGlyphs.set(e,[]);this.layoutGlyphs(e)}}),Object.defineProperty(t.prototype,"hideGlyphs",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.labelToGlyphs.get(e);if(t)for(var r=0,n=t.length;r<n;++r)this.glyphProvider.remove(t[r])}}),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){return null}}),Object.defineProperty(t.prototype,"invalidateRequest",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.labelToKerningRequest.delete(e)}}),Object.defineProperty(t.prototype,"layoutGlyphs",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this.updateKerning(e)&&e.active){var t=this.labelToKerningRequest.get(e);if(t&&t.fontMap){var r=t.metrics;if(r&&r.layout){var n=r.layout;this.updateGlyphs(e,n);var i=e.glyphs;e.size=n.size,v[e.anchor.type](e.anchor,e),m[e.anchor.type](e.anchor);for(var o=e.anchor,a=e.anchor.paddingDirection,s=0,u=Math.min(n.positions.length,i.length);s<u;++s){var l=n.positions[s],f=i[s];f.offset=l,f.fontScale=n.fontScale,f.anchor=[o.x||0,o.y||0],f.origin=(0,c.copy2)(e.origin),f.padding=a||[0,0],f.maxScale=e.maxScale}}}}}}),Object.defineProperty(t.prototype,"managesInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return Boolean(this.labelToGlyphs.get(e))}}),Object.defineProperty(t.prototype,"showGlyphs",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.labelToGlyphs.get(e);if(t)for(var r=0,n=t.length;r<n;++r)this.glyphProvider.add(t[r])}}),Object.defineProperty(t.prototype,"updateAnchor",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=e.glyphs;if(t){v[e.anchor.type](e.anchor,e),m[e.anchor.type](e.anchor);for(var r=e.anchor,n=e.anchor.paddingDirection,i=0,o=t.length;i<o;++i)t[i].anchor=[r.x||0,r.y||0],t[i].padding=n||[0,0]}}}),Object.defineProperty(t.prototype,"updateGlyphs",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this.labelToGlyphs.get(e);r||(r=[],this.labelToGlyphs.set(e,r));var n=this.labelWaitingOnGlyph.get(e);n||(n=new Set,this.labelWaitingOnGlyph.set(e,n));for(var i=0,o=Math.min(r.length,t.glyphs.length);i<o;++i){(u=r[i]).character!==t.glyphs[i]&&(u.character=t.glyphs[i],u.request&&u.request.fontMap&&u.request.fontMap.glyphMap[u.character]||n.add(u))}if(r.length<t.glyphs.length){var a=0;for(i=r.length,o=t.glyphs.length;i<o;++i,++a){var s=t.glyphs[i];(u=new b.GlyphInstance({character:s,color:e.color,origin:e.origin,maxScale:e.maxScale,onReady:this.handleGlyphReady})).parentLabel=e,r.push(u),e.active&&this.glyphProvider.add(u),n.add(u)}}else if(r.length>t.glyphs.length){for(i=t.glyphs.length,o=r.length;i<o;++i){var u=r[i];this.glyphProvider.remove(u)}for(;r.length>t.glyphs.length;)r.pop()}e.glyphs=r}}),Object.defineProperty(t.prototype,"updateGlyphColors",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=e.glyphs;if(t)for(var r=0,n=t.length;r<n;++r)t[r].color=(0,c.copy4)(e.color)}}),Object.defineProperty(t.prototype,"updateGlyphOrigins",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=e.glyphs;if(t)for(var r=e.origin,n=0,i=t.length;n<i;++n)t[n].origin=[r[0],r[1]]}}),Object.defineProperty(t.prototype,"updateGlyphMaxScales",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=e.glyphs;if(t)for(var r=e.maxScale,n=0,i=t.length;n<i;++n)t[n].maxScale=r}}),Object.defineProperty(t.prototype,"updateKerning",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.labelToKerningRequest.get(e),r=e.text;if(t){if(t.kerningPairs&&t.kerningPairs.indexOf(r)>-1)return Boolean(t.fontMap);if(!t.fontMap||t.fontMap.supportsKerning(r.replace(/\s/g,"")))return!0;this.labelToKerningRequest.delete(e),t=void 0}if(!t){var n={fontSize:e.fontSize,text:e.text,letterSpacing:e.letterSpacing};return e.maxWidth>0&&(n.maxWidth=e.maxWidth,n.truncation=this.props.truncation||"..."),t=(0,l.fontRequest)({key:this.props.resourceKey||"",character:"",kerningPairs:[r],metrics:n}),e.preload?(e.resourceTrigger=function(){e.onReady&&e.onReady(e)},this.resource.request(this,e,t)):(this.resource.request(this,e,t,{resource:{type:f.ResourceType.FONT,key:this.props.resourceKey||""}}),this.labelToKerningRequest.set(e,t)),!1}return!0}}),Object.defineProperty(t.prototype,"willUpdateProps",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.data!==this.props.data&&delete this.propertyIds,e.scaleMode!==this.props.scaleMode&&this.rebuildLayer(),e.resourceKey!==this.props.resourceKey&&(this.fullUpdate=!0)}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{key:"",data:new u.InstanceProvider}}),t}(h.Layer2D);t.LabelLayer=O},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphInstance=void 0;var a=r(1),s=function(e){function t(r){var n=e.call(this,r)||this;return Object.defineProperty(n,"anchor",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(n,"character",{enumerable:!0,configurable:!0,writable:!0,value:"a"}),Object.defineProperty(n,"color",{enumerable:!0,configurable:!0,writable:!0,value:[1,1,1,1]}),Object.defineProperty(n,"depth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"fontScale",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(n,"maxScale",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(n,"offset",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(n,"origin",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(n,"padding",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(n,"parentLabel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"onReady",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,a.makeObservable)(n,t),n.origin=r.origin||n.origin,n.offset=r.offset||n.offset,n.character=r.character||n.character,n.color=r.color||n.color,n.maxScale=r.maxScale||n.maxScale,n.padding=r.padding||n.padding,n.anchor=r.anchor||n.anchor,n.onReady=r.onReady,n}return i(t,e),Object.defineProperty(t.prototype,"clone",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=new t(this);e.onReady=this.onReady,e.request=this.request}}),Object.defineProperty(t.prototype,"resourceTrigger",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.offset=this.offset,this.origin=this.origin,this.character=this.character,this.color=this.color,this.onReady&&this.onReady(this)}}),o([a.observable],t.prototype,"anchor",void 0),o([a.observable],t.prototype,"character",void 0),o([a.observable],t.prototype,"color",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"fontScale",void 0),o([a.observable],t.prototype,"maxScale",void 0),o([a.observable],t.prototype,"offset",void 0),o([a.observable],t.prototype,"origin",void 0),o([a.observable],t.prototype,"padding",void 0),t}(a.Instance);t.GlyphInstance=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphLayer=void 0;var o=r(1),a=r(23),s=r(0),u=r(3),c=r(19),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"glyphRequests",{enumerable:!0,configurable:!0,writable:!0,value:{}}),t}return i(t,e),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e,n,i=this,o=this.props.animate||{},u=o.anchor,l=o.color,f=o.offset,d=o.origin,p={0:[0,0],1:[0,0],2:[1,0],3:[0,1],4:[1,1],5:[1,1]},h={name:"texture",resource:{key:function(){return i.props.resourceKey||""},name:"fontMap"},update:function(e){var t=e.character;return e.request&&e.character===e.request.character||(i.glyphRequests[e.character]?e.request=i.glyphRequests[e.character]:(e.request=(0,a.fontRequest)({key:i.props.resourceKey||"",character:t}),i.glyphRequests[e.character]=e.request),e.request.fontMap&&e.onReady&&e.onReady(e)),e.request.fetch=a.FontResourceRequestFetch.TEXCOORDS,i.resource.request(i,e,e.request)}},b={name:"glyphSize",parentAttribute:h,resource:{key:function(){return i.props.resourceKey||""},name:"fontMap"},size:s.InstanceAttributeSize.TWO,update:function(e){var t=e.character;return e.request&&e.character===e.request.character||(i.glyphRequests[e.character]?e.request=i.glyphRequests[e.character]:(e.request=(0,a.fontRequest)({key:i.props.resourceKey||"",character:t}),i.glyphRequests[e.character]=e.request),e.request.fontMap&&e.onReady&&e.onReady(e)),e.request.fetch=a.FontResourceRequestFetch.IMAGE_SIZE,i.resource.request(i,e,e.request)}};switch(h.childAttributes=[b],this.props.scaleMode||c.ScaleMode.ALWAYS){case c.ScaleMode.BOUND_MAX:e=this.props.inTextArea?r(218):r(219),n=this.props.inTextArea?r(220):r(221);break;case c.ScaleMode.NEVER:e=this.props.inTextArea?r(222):r(223),n=this.props.inTextArea?r(224):r(225);break;case c.ScaleMode.ALWAYS:e=this.props.inTextArea?r(226):r(119),n=this.props.inTextArea?r(227):r(120);break;default:e=r(119),n=r(120)}return{fs:e,instanceAttributes:[{easing:l,name:t.attributeNames.color,size:s.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.depth,size:s.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:"fontScale",size:s.InstanceAttributeSize.ONE,update:function(e){return[e.fontScale]}},{easing:u,name:t.attributeNames.anchor,size:s.InstanceAttributeSize.TWO,update:function(e){return e.anchor}},{easing:d,name:t.attributeNames.origin,size:s.InstanceAttributeSize.TWO,update:function(e){return e.origin}},{easing:f,name:t.attributeNames.offset,size:s.InstanceAttributeSize.TWO,update:function(e){return e.offset}},{name:"padding",size:s.InstanceAttributeSize.TWO,update:function(e){return e.padding}},{name:"maxScale",size:s.InstanceAttributeSize.ONE,update:function(e){return[e.maxScale]}},b,h],uniforms:[],vertexAttributes:[{name:"normals",size:s.VertexAttributeSize.TWO,update:function(e){return p[e]}}],vertexCount:6,vs:n}}}),Object.defineProperty(t.prototype,"draw",{enumerable:!1,configurable:!0,writable:!0,value:function(){e.prototype.draw.call(this)}}),Object.defineProperty(t.prototype,"getMaterialOptions",{enumerable:!1,configurable:!0,writable:!0,value:function(){return Object.assign({},u.CommonMaterialOptions.transparentImageBlending,(0,s.createMaterialOptions)({depthTest:!1}))}}),Object.defineProperty(t.prototype,"willUpdateProps",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.resourceKey!==this.props.resourceKey&&(Object.values(this.glyphRequests).forEach((function(t){delete t.fontMap,t.key=e.resourceKey||""})),this.rebuildLayer())}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{key:"",data:new o.InstanceProvider,resourceKey:"No resource specified"}}),Object.defineProperty(t,"attributeNames",{enumerable:!0,configurable:!0,writable:!0,value:{color:"color",depth:"depth",anchor:"anchor",origin:"origin",offset:"offset"}}),t}(r(6).Layer2D);t.GlyphLayer=l},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\ngl_FragColor = texColor * vertexColor;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 pushOut = normals * glyphSize * fontScale;\nvec3 position = vec3(origin + padding - anchor + offset + pushOut, depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.TextAreaInstance=t.NewLineCharacterMode=t.WordWrap=t.TextAlignment=void 0;var a,s,u=r(20),c=r(65);!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.CENTERED=2]="CENTERED"}(a=t.TextAlignment||(t.TextAlignment={})),function(e){e[e.NONE=0]="NONE",e[e.CHARACTER=1]="CHARACTER",e[e.WORD=2]="WORD"}(s=t.WordWrap||(t.WordWrap={})),function(e){e[e.NEWLINE=0]="NEWLINE"}(t.NewLineCharacterMode||(t.NewLineCharacterMode={}));var l=function(e){function t(r){var n=e.call(this,r)||this;return Object.defineProperty(n,"maxHeight",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"lineHeight",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"wordWrap",{enumerable:!0,configurable:!0,writable:!0,value:s.NONE}),Object.defineProperty(n,"alignment",{enumerable:!0,configurable:!0,writable:!0,value:a.LEFT}),Object.defineProperty(n,"labels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(n,"newLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(n,"borders",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(n,"oldOrigin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"padding",{enumerable:!0,configurable:!0,writable:!0,value:[0,0,0,0]}),Object.defineProperty(n,"borderWidth",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(n,"hasBorder",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(n,"spaceWidth",{enumerable:!0,configurable:!0,writable:!0,value:0}),(0,u.makeObservable)(n,t),n.color=r.color,n.origin=r.origin,n.oldOrigin=r.origin,n.text=r.text,n.fontSize=r.fontSize||n.fontSize,n.maxWidth=r.maxWidth||n.maxWidth,n.maxHeight=r.maxHeight||n.maxHeight,n.lineHeight=r.lineHeight||n.lineHeight,n.wordWrap=r.wordWrap||n.wordWrap,n.alignment=r.alignment||n.alignment,n.padding=r.padding||n.padding,n.borderWidth=r.borderWidth||n.borderWidth,n.hasBorder=void 0!==r.hasBorder?r.hasBorder:n.hasBorder,n.letterSpacing=r.letterSpacing||n.letterSpacing,n}return i(t,e),o([u.observable],t.prototype,"maxHeight",void 0),o([u.observable],t.prototype,"lineHeight",void 0),o([u.observable],t.prototype,"wordWrap",void 0),o([u.observable],t.prototype,"alignment",void 0),o([u.observable],t.prototype,"padding",void 0),o([u.observable],t.prototype,"borderWidth",void 0),o([u.observable],t.prototype,"hasBorder",void 0),t}(c.LabelInstance);t.TextAreaInstance=l},function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.RectangleInstance=void 0;var s=r(1),u=r(11),c=r(19),l=((i={})[c.AnchorType.TopLeft]=function(e,t){e.x=-e.padding,e.y=-e.padding},i[c.AnchorType.TopMiddle]=function(e,t){e.x=t.size[0]/2,e.y=-e.padding},i[c.AnchorType.TopRight]=function(e,t){e.x=t.size[0]+e.padding,e.y=-e.padding},i[c.AnchorType.MiddleLeft]=function(e,t){e.x=-e.padding,e.y=t.size[1]/2},i[c.AnchorType.Middle]=function(e,t){e.x=t.size[0]/2,e.y=t.size[1]/2},i[c.AnchorType.MiddleRight]=function(e,t){e.x=t.size[0]+e.padding,e.y=t.size[1]/2},i[c.AnchorType.BottomLeft]=function(e,t){e.x=-e.padding,e.y=t.size[1]+e.padding},i[c.AnchorType.BottomMiddle]=function(e,t){e.x=t.size[0]/2,e.y=t.size[1]+e.padding},i[c.AnchorType.BottomRight]=function(e,t){e.x=t.size[0]+e.padding,e.y=t.size[1]+e.padding},i[c.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},i),f=function(e){function t(r){var n=e.call(this,r)||this;return Object.defineProperty(n,"color",{enumerable:!0,configurable:!0,writable:!0,value:[0,0,0,1]}),Object.defineProperty(n,"depth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"maxScale",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(n,"scale",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(n,"scaling",{enumerable:!0,configurable:!0,writable:!0,value:c.ScaleMode.BOUND_MAX}),Object.defineProperty(n,"size",{enumerable:!0,configurable:!0,writable:!0,value:[1,1]}),Object.defineProperty(n,"position",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(n,"_anchor",{enumerable:!0,configurable:!0,writable:!0,value:{padding:0,type:c.AnchorType.TopLeft,x:0,y:0}}),(0,s.makeObservable)(n,t),n.depth=r.depth||n.depth,n.color=r.color||n.color,n.scaling=r.scaling||n.scaling,n.position=r.position||n.position,n.size=r.size||n.size,r.anchor&&n.setAnchor(r.anchor),n}return o(t,e),Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"setAnchor",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t={padding:e.padding||0,type:e.type,x:e.x||0,y:e.y||0};l[t.type](t,this),this._anchor=t}}),a([s.observable],t.prototype,"color",void 0),a([s.observable],t.prototype,"depth",void 0),a([s.observable],t.prototype,"maxScale",void 0),a([s.observable],t.prototype,"scale",void 0),a([s.observable],t.prototype,"scaling",void 0),a([s.observable],t.prototype,"size",void 0),a([s.observable],t.prototype,"position",void 0),a([s.observable],t.prototype,"_anchor",void 0),t}(u.Instance);t.RectangleInstance=f},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.View3D=void 0;var o=r(7),a=r(13),s=r(16),u=r(124);var c=function(e){function t(t,r){var n=e.call(this,t,r)||this;return Object.defineProperty(n,"projection",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n.projection=new u.Projection3D,n.projection.camera=r.camera,n.projection.pixelRatio=n.pixelRatio,n}return i(t,e),Object.defineProperty(t.prototype,"fitViewtoViewport",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if((0,s.isPerspective)(this.props.camera)){var r=t.width,n=t.height,i={near:(a=this.props.camera).projectionOptions.near,far:a.projectionOptions.far,width:r,height:n};this.props.preventCameraAdjustment||(a.projectionOptions=Object.assign(a.projectionOptions,i),a.update()),this.projection.pixelRatio=this.pixelRatio,this.projection.viewBounds=t,this.projection.viewBounds.d=this,this.projection.screenBounds=new o.Bounds({height:this.projection.viewBounds.height/this.pixelRatio,width:this.projection.viewBounds.width/this.pixelRatio,x:this.projection.viewBounds.x/this.pixelRatio,y:this.projection.viewBounds.y/this.pixelRatio}),this.projection.screenBounds.d=this}else if(this.props.camera.projectionType===s.CameraProjectionType.ORTHOGRAPHIC){var a;r=t.width,n=t.height,i={near:(a=this.props.camera).projectionOptions.near,far:a.projectionOptions.far,left:-r/2,right:r/2,top:n/2,bottom:-n/2};this.props.preventCameraAdjustment||(a.projectionOptions=Object.assign(a.projectionOptions,i),a.update()),this.projection.pixelRatio=this.pixelRatio,this.projection.viewBounds=t,this.projection.viewBounds.d=this,this.projection.screenBounds=new o.Bounds({height:this.projection.viewBounds.height/this.pixelRatio,width:this.projection.viewBounds.width/this.pixelRatio,x:this.projection.viewBounds.x/this.pixelRatio,y:this.projection.viewBounds.y/this.pixelRatio}),this.projection.screenBounds.d=this}}}),Object.defineProperty(t.prototype,"willUpdateProps",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.projection.camera=e.camera}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{key:"",camera:new s.Camera({type:s.CameraProjectionType.PERSPECTIVE,width:100,height:100,fov:Math.PI/2,far:1e5,near:1}),viewport:{left:0,right:0,bottom:0,top:0}}}),t}(a.View);t.View3D=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Projection3D=void 0;var o=r(12),a=r(47),s=r(2),u=r(16),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t}return i(t,e),Object.defineProperty(t.prototype,"screenToWorld",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return t=t||[0,0,0],this.viewToWorld(this.screenToView(e),t),t}}),Object.defineProperty(t.prototype,"screenRay",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this.camera.projectionType===u.CameraProjectionType.ORTHOGRAPHIC){var t=(0,s.vec3)(this.screenToWorld(e));return(0,o.ray)(t,this.camera.transform.forward)}t=(0,s.vec3)(this.screenToWorld(e));return(0,o.rayFromPoints)((0,s.vec3)(this.camera.transform.position),t)}}),Object.defineProperty(t.prototype,"worldToScreen",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){t=t||[0,0];var r=(0,o.multiply4x4)(this.camera.projection,this.camera.view),n=(0,o.project3As4ToScreen)(r,e,this.viewBounds.width,this.viewBounds.height);return(0,s.apply2)(t,n[0]/this.pixelRatio,n[1]/this.pixelRatio)}}),Object.defineProperty(t.prototype,"viewToWorld",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){t=t||[0,0,0];var r=this.viewBounds,n=r.width,i=r.height,a=this.camera.projectionOptions,c=(0,s.scale2)(e,this.pixelRatio),l=Math.tan;if(a.type===u.CameraProjectionType.PERSPECTIVE){var f=a.fov,d=a.near,p=i/n,h=l(f/2)*d,b=[((c[0]+.5)/n*2-1)*h,(1-(c[1]+.5)/i*2)*h*p,-1],g=(0,o.transform4)(this.camera.transform.matrix,(0,s.vec4)(b,1));(0,s.apply3)(t,g[0],g[1],g[2])}else{var v=(0,s.subtract2)(c,[n/2,i/2]);g=(0,o.transform4)(this.camera.transform.viewMatrix,(0,s.vec4)(v,-a.near));(0,s.apply3)(t,g[0],-g[1],g[2])}return t}}),Object.defineProperty(t.prototype,"worldToView",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){t=t||[0,0];var r=(0,o.multiply4x4)(this.camera.projection,this.camera.view),n=(0,o.project3As4ToScreen)(r,e,this.viewBounds.width,this.viewBounds.height);return(0,s.apply2)(t,n[0]/this.pixelRatio,n[1]/this.pixelRatio)}}),t}(a.BaseProjection);t.Projection3D=c},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(286),i(r(53),t),i(r(51),t),i(r(126),t),i(r(54),t),i(r(127),t),i(r(287),t)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SceneGraphLayer=void 0;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"baseShaderModules",{enumerable:!1,configurable:!0,writable:!0,value:function(t){var r=e.prototype.baseShaderModules.call(this,t);return r.vs.push("parent-transform"),r}}),t}(r(13).Layer);t.SceneGraphLayer=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.Instance3D=void 0;var a=r(1),s=r(51),u=function(e){function t(r){var n=e.call(this,r)||this;Object.defineProperty(n,"needsLocalUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(n,"needsWorldUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(n,"_transform",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_matrix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_localMatrix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_localPosition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_localRotation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_localScale",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_position",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_rotation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"_scale",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,a.makeObservable)(n,t);var i=r.transform||new s.Transform;return n.transform=i,r.parent&&(r.parent instanceof t?n.parent=r.parent:n.transform.parent=r.parent),n}return i(t,e),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},set:function(e){this._transform||(this._position=e.position,this._rotation=e.rotation,this._scale=e.scale,this._localPosition=e.localPosition,this._localRotation=e.localRotation,this._localScale=e.localScale,this._matrix=e.matrix,this._localMatrix=e.localMatrix),e.instance=this,this._transform=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matrix",{get:function(){return this._transform.update(),this._matrix},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localMatrix",{get:function(){return this._transform.update(),this._localMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localPosition",{get:function(){return this.needsLocalUpdate=!0,this._localPosition},set:function(e){this.transform.localPosition=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localRotation",{get:function(){return this.needsLocalUpdate=!0,this._localRotation},set:function(e){this.transform.localRotation=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localScale",{get:function(){return this.needsLocalUpdate=!0,this._localScale},set:function(e){this.transform.localScale=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.needsWorldUpdate=!0,this.transform.update(),this._position},set:function(e){this.transform.position=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.needsWorldUpdate=!0,this.transform.update(),this._rotation},set:function(e){this.transform.rotation=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.needsWorldUpdate=!0,this.transform.update(),this._scale},set:function(e){this.transform.scale=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{set:function(e){this.transform.parent=e.transform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"optimize",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.needsWorldUpdate=!1,this.needsLocalUpdate=!1,this.transform.optimize()}}),o([a.observable],t.prototype,"_matrix",void 0),o([a.observable],t.prototype,"_localMatrix",void 0),o([a.observable],t.prototype,"_localPosition",void 0),o([a.observable],t.prototype,"_localRotation",void 0),o([a.observable],t.prototype,"_localScale",void 0),o([a.observable],t.prototype,"_position",void 0),o([a.observable],t.prototype,"_rotation",void 0),o([a.observable],t.prototype,"_scale",void 0),t}(a.Instance);t.Instance3D=u},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectionScreen=void 0;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"screenToWorld",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this.screenToView(e),n=t||[0,0];return n[0]=r[0],n[1]=r[1],n}}),Object.defineProperty(t.prototype,"screenRay",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.screenToWorld(e);return[[t[0],t[1],0],[t[0],t[1],-1]]}}),Object.defineProperty(t.prototype,"worldToScreen",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=[0,0];return r[0]=e[0],r[1]=e[1],this.viewToScreen(r,t)}}),Object.defineProperty(t.prototype,"viewToWorld",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=t||[0,0],n=e;return r[0]=n[0],r[1]=n[1],r}}),Object.defineProperty(t.prototype,"worldToView",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=t||[0,0];return r[0]=e[0],r[1]=e[1],r}}),t}(r(12).BaseProjection);t.ProjectionScreen=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gaussHorizontalBlur=void 0;var n=r(0),i=r(25);t.gaussHorizontalBlur=function(e){var t=e.output,o=e.input;return(0,i.postProcess)({printShader:e.printShader,view:t?{output:{buffers:t,depth:!1}}:void 0,buffers:{color:o},shader:r(307),uniforms:[{name:"weight",size:n.UniformSize.FLOAT_ARRAY,update:function(){return[.299478,.22598,.097046,.023687,.003279,257e-6,11e-6]}}]})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gaussVerticalBlur=void 0;var n=r(0),i=r(25);t.gaussVerticalBlur=function(e){var t=e.output,o=e.input;return(0,i.postProcess)({printShader:e.printShader,view:t?{output:{buffers:t,depth:!1}}:void 0,buffers:{color:o},shader:r(308),uniforms:[{name:"weight",size:n.UniformSize.FLOAT_ARRAY,update:function(){return[.299478,.22598,.097046,.023687,.003279,257e-6,11e-6]}}]})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bloom=void 0;var n=r(10),i=r(0),o=r(25),a=r(66);t.bloom=function(e){for(var t,s=e.compose,u=e.output,c=e.resources,l={blending:{blendDst:n.GLSettings.Material.BlendingDstFactor.One,blendSrc:n.GLSettings.Material.BlendingSrcFactor.One,blendEquation:n.GLSettings.Material.BlendingEquations.Add}},f={},d=0,p=e.samples;d<p;++d){var h=(0,a.boxSample)({printShader:e.printShader,input:c[d],output:c[d+1],direction:a.BoxSampleDirection.DOWN,material:{blending:void 0}});f["downSample".concat(d)]=h}for(d=e.samples-1;d>0;--d){h=(0,a.boxSample)({printShader:e.printShader,input:c[d+1],output:c[d],direction:a.BoxSampleDirection.UP,material:l});f["upSample".concat(d)]=h}return s&&(f.compose=(0,o.postProcess)({printShader:e.printShader,buffers:{color:s,glow:c[1]},material:{blending:null},view:u?{output:{buffers:(t={},t[i.FragmentOutputType.COLOR]=u,t),depth:!1}}:void 0,shader:r(310)})),f}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.draw=void 0;var n=r(25),i=r(5)("performance");t.draw=function(e){var t=e.output,r=e.input,o=e.channel,a=e.grayScale;return r.textureSettings&&!r.textureSettings.generateMipMaps||i("POSSIBLE ERROR: for the draw post effect,","it is a common mistale to leave mipmaps enabled on the input texture.","Often the mipmaps are not available in the target resource and thus","you will get a blank output when rendering in certain scenarios."),(0,n.postProcess)({printShader:e.printShader,view:Object.assign(t?{output:{buffers:t,depth:!1}}:{},e.view),buffers:{color:r},shader:a&&o?"\n      varying vec2 texCoord;\n\n      void main() {\n        gl_FragColor = vec4(texture2D(color, texCoord).".concat(o).concat(o).concat(o,", 1.);\n      }\n    "):o?"\n      varying vec2 texCoord;\n\n      void main() {\n        gl_FragColor = vec4(texture2D(color, texCoord).".concat(o,", 0., 0., 1.);\n      }\n    "):"\n      varying vec2 texCoord;\n\n      void main() {\n        gl_FragColor = texture2D(color, texCoord);\n      }\n    ",material:e.material})}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(134),i(r(135),t),i(r(22),t),i(r(242),t),i(r(1),t),i(r(13),t),i(r(0),t),i(r(3),t),i(r(33),t),i(r(23),t),i(r(4),t),i(r(294),t),i(r(299),t),i(r(12),t),i(r(301),t)},function(e,t){window.WebGL2RenderingContext=window.WebGL2RenderingContext||function(){}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(34),t),i(r(43),t),i(r(136),t),i(r(67),t),i(r(97),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MouseButton=void 0,function(e){e[e.NONE=-1]="NONE",e[e.LEFT=0]="LEFT",e[e.AUX=1]="AUX",e[e.RIGHT=2]="RIGHT",e[e.FOURTH=3]="FOURTH",e[e.FIFTH=4]="FIFTH"}(t.MouseButton||(t.MouseButton={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Attribute=void 0;var n=function(){function e(e,t,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"gl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isDynamic",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_isInstanced",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_fullUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"normalize",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_needsUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_updateRange",{enumerable:!0,configurable:!0,writable:!0,value:{count:-1,offset:-1}}),this.data=e,this.size=t,this._isDynamic=r,this._isInstanced=n}return Object.defineProperty(e.prototype,"isDynamic",{get:function(){return this._isDynamic},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInstanced",{get:function(){return this._isInstanced},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullUpdate",{get:function(){return this._fullUpdate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needsUpdate",{get:function(){return this._needsUpdate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateRange",{get:function(){return this._updateRange},set:function(e){this._updateRange=e,this._needsUpdate=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.gl&&this.gl.proxy.disposeAttribute(this)}}),Object.defineProperty(e.prototype,"resolve",{enumerable:!1,configurable:!0,writable:!0,value:function(){this._needsUpdate=!1,this._fullUpdate=!1}}),Object.defineProperty(e.prototype,"setDynamic",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this._isDynamic=e,this._needsUpdate=!0,this._fullUpdate=!0}}),e}();t.Attribute=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Geometry=void 0;var n=function(){function e(){Object.defineProperty(this,"_attributes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"gl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxInstancedCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isInstanced",{enumerable:!0,configurable:!0,writable:!0,value:!1})}return Object.defineProperty(e.prototype,"attributes",{get:function(){return new Map(Object.entries(this._attributes))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"addAttribute",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r,n=this;this._attributes[e]=t,this.isInstanced=!1,Object.values(this._attributes).forEach((function(e){var t=e.isInstanced?1:0;void 0===r&&(r=t),1==(r^t)&&(n.isInstanced=!0)}))}}),Object.defineProperty(e.prototype,"removeAttribute",{enumerable:!1,configurable:!0,writable:!0,value:function(e){delete this._attributes[e]}}),Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.attributes.forEach((function(e){return e.destroy()})),this.gl&&this.gl.proxy.disposeGeometry(this)}}),e}();t.Geometry=n},function(e,t,r){function n(e){var r;function n(){if(n.enabled){var e=n,i=+new Date,o=i-(r||i);e.diff=o,e.prev=r,e.curr=i,r=i;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var u=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(function(r,n){if("%%"===r)return r;u++;var i=t.formatters[n];if("function"==typeof i){var o=a[u];r=i.call(e,o),a.splice(u,1),u--}return r})),t.formatArgs.call(e,a);var c=n.log||t.log||console.log.bind(console);c.apply(e,a)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var r,n=0;for(r in e)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]}(e),n.destroy=i,"function"==typeof t.init&&t.init(n),t.instances.push(n),n}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var r;t.save(e),t.names=[],t.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(r=0;r<t.instances.length;r++){var o=t.instances[r];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(140),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){var r=1e3,n=6e4,i=60*n,o=24*i;function a(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}e.exports=function(e,t){t=t||{};var s,u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(e);if("number"===u&&!1===isNaN(e))return t.long?a(s=e,o,"day")||a(s,i,"hour")||a(s,n,"minute")||a(s,r,"second")||s+" ms":function(e){if(e>=o)return Math.round(e/o)+"d";if(e>=i)return Math.round(e/i)+"h";if(e>=n)return Math.round(e/n)+"m";if(e>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Material=void 0;var n=r(10),i=function(){function e(e){Object.defineProperty(this,"blending",{enumerable:!0,configurable:!0,writable:!0,value:{blendDst:n.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:n.GLSettings.Material.BlendingEquations.Add,blendSrc:n.GLSettings.Material.BlendingSrcFactor.SrcAlpha}}),Object.defineProperty(this,"colorWrite",{enumerable:!0,configurable:!0,writable:!0,value:[!0,!0,!0,!0]}),Object.defineProperty(this,"culling",{enumerable:!0,configurable:!0,writable:!0,value:n.GLSettings.Material.CullSide.CCW}),Object.defineProperty(this,"depthFunc",{enumerable:!0,configurable:!0,writable:!0,value:n.GLSettings.Material.DepthFunctions.LESS_OR_EQUAL}),Object.defineProperty(this,"depthTest",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"depthWrite",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"dithering",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"fragmentShader",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"gl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"polygonOffset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"uniforms",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"vertexShader",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.assign(this,e),delete this.gl}return Object.defineProperty(e.prototype,"clone",{enumerable:!1,configurable:!0,writable:!0,value:function(){var t=new e(this);t.blending=Object.assign({},this.blending),t.polygonOffset=Object.assign({},this.polygonOffset),t.uniforms=Object.assign({},this.uniforms);var r=function(e){var r=t.uniforms[e];if(r.gl){var n=new Map;r.gl.forEach((function(e,t){n.set(t,Object.assign({},e))}))}};for(var n in t.uniforms)r(n);return t}}),Object.defineProperty(e.prototype,"dispose",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.gl&&this.gl.proxy.disposeMaterial(this)}}),e}();t.Material=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Model=void 0;var n=r(10),i=function(e,t,r){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"drawMode",{enumerable:!0,configurable:!0,writable:!0,value:n.GLSettings.Model.DrawMode.TRIANGLES}),Object.defineProperty(this,"vertexDrawRange",{enumerable:!0,configurable:!0,writable:!0,value:[-1,-1]}),Object.defineProperty(this,"drawInstances",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"geometry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"material",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"vertexCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.id=e,this.geometry=t,this.material=r};t.Model=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.BasicInstance=void 0;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"resourceTrigger",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),t}(r(11).Instance);t.BasicInstance=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ColorBufferResourceManager=void 0;var s=r(0),u=r(21),c=r(76),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"resources",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),t}return i(t,e),Object.defineProperty(t.prototype,"dequeueRequests",{enumerable:!1,configurable:!0,writable:!0,value:function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2,!1]}))}))}}),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.resources.forEach((function(e){return e.destroy()})),this.resources.clear()}}),Object.defineProperty(t.prototype,"getIOExpansion",{enumerable:!1,configurable:!0,writable:!0,value:function(){return[]}}),Object.defineProperty(t.prototype,"getResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.resources.get(e)||null}}),Object.defineProperty(t.prototype,"destroyResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.resources.get(e.key);t&&(t.destroy(),this.resources.delete(e.key))}}),Object.defineProperty(t.prototype,"initResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(r){return(t=this.resources.get(e.key))?(console.warn("Attempted to generate a RenderTexture that already exists for key",e.key),[2]):(t=new c.ColorBufferResource(e,this.webGLRenderer),this.resources.set(e.key,t),[2])}))}))}}),Object.defineProperty(t.prototype,"request",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){var i=this.resources.get(r.key);return i?(r.colorBuffer=i.colorBuffer,[0,0,1,1]):[0,0,0,0]}}),Object.defineProperty(t.prototype,"resize",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=new Map;this.resources.forEach((function(r,n){r.width>s.TextureSize.SCREEN&&r.height>s.TextureSize.SCREEN||(r.colorBuffer.destroy(),r=new c.ColorBufferResource(r,e.webGLRenderer),t.set(n,r))})),t.forEach((function(t,r){return e.resources.set(r,t)}))}}),Object.defineProperty(t.prototype,"updateResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.resources.get(e.key)&&console.warn("UPDATING AN EXISTING COLOR BUFFER IS NOT SUPPORTED YET")}}),t}(u.BaseResourceManager);t.ColorBufferResourceManager=l},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.colorBufferRequest=void 0;var i=r(0);t.colorBufferRequest=function(e){return n({type:i.ResourceType.COLOR_BUFFER},e)}},function(e,t,r){"use strict";var n=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderProcessor=void 0;var i=r(4),o=r(0),a=r(80),s=r(38),u=r(147),c=r(81),l=r(148),f=r(83),d=function(){function e(){Object.defineProperty(this,"metricsProcessing",{enumerable:!0,configurable:!0,writable:!0,value:new l.MetricsProcessing})}return Object.defineProperty(e,"mergeFragmentOutputsForMRT",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,u,c){var l="",f="",d="",p=new Set,h=[],b=new Set;return i.WebGLStat.MRT||(d=" = gl_FragColor"),r.forEach((function(e,g){var v=!0,y=!1;if(u&&u.indexOf(e.outputType)<0&&(v=!1),c&&g<r.length-1&&(v=!1),!c&&n.indexOf(e.outputType)<0&&(v=!1),b.has(e.outputType))throw new Error("Can not use the same Output Fragment type multiple times");b.add(e.outputType);var m=n.indexOf(e.outputType);(0,s.shaderTemplate)({shader:(0,a.removeComments)(e.source),onToken:function(r){var n=r.trim();if(0===n.indexOf("out")){if(y)throw console.error("Found multiple ${out} tokens in a single fragment shader. This is not supported nor logical","If you need to use the declared output multiple times, use the assigned name","and don't wrap it repeatedly in the shader.","eg-","void main() {","  ${out: myOutput} = value;","  vec4 somethingElse = myOutput;","}"),new Error("Invalid Shader Format");y=!0;var o=n.substr("out".length).trim();if(":"===o[0]){var a=o.substr(":".length).trim();if(!a)throw new Error("Output in a shader requires an identifier ${out: <name required>}");if(p.has(a))throw new Error("You can not declare the same output name in subsequent fragment shader outputs");if("gl_FragColor"===a)throw new Error("DO not use gl_FragColor as an identifier for an out. Choose something not used by the WebGL spec.");var s="";if(v)if(p.add(a),h.push(e.outputType),i.WebGLStat.MRT_EXTENSION)d=" = gl_FragData[".concat(m,"]"),s="vec4 ";else{if(!i.WebGLStat.MRT||!i.WebGLStat.SHADERS_3_0)throw new Error("Could not generate a proper output declaration for the fragment shader output: ".concat(a));t.set(a,"layout(location = ".concat(m,") out vec4 ").concat(a,";\n"))}else s="vec4 ";return"".concat(s).concat(a).concat(d)}throw new Error("Output in a shader requires an identifier ${out: <name required>}")}return"${".concat(r,"}")},onMain:function(r,n){!y&&r&&(r.match("gl_FragColor")?(h.push(e.outputType),i.WebGLStat.MRT&&(i.WebGLStat.SHADERS_3_0?(t.set("_FragColor","layout(location = ".concat(m,") out vec4 _FragColor;\n")),r=r.replace(/gl_FragColor/g,"_FragColor")):r=(r=(r=r.replace(/gl_FragColor\s+=/,"vec4 _FragColor = gl_FragData[".concat(m,"] ="))).replace(/gl_FragColor\s+=/g,"_FragColor = gl_FragData[".concat(m,"] ="))).replace(/gl_FragColor/g,"_FragColor")),p.add("_FragColor")):h.push(o.FragmentOutputType.NONE));return l+="\n".concat((n||"").trim()),f+="\n  ".concat((r||"").trim()),(r||"").trim()}})})),{output:"".concat(l,"\nvoid main() {\n").concat(f,"\n}"),outputNames:Array.from(p.values()),outputTypes:h}}}),Object.defineProperty(e,"mergeOutputFragmentShaderForColor",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(t.length>1||t[0]!==o.FragmentOutputType.COLOR)throw new Error("Merging fragment shaders for only COLOR output is only valid when the view has a single COLOR output target.");(0,o.isString)(e)&&(e=[{outputType:o.FragmentOutputType.COLOR,source:e}]);var r="",n="",i=new Set,u=[];return e.some((function(e){var t=e.outputType===o.FragmentOutputType.COLOR,c=!1;return t&&u.push(o.FragmentOutputType.COLOR),(0,s.shaderTemplate)({shader:(0,a.removeComments)(e.source),onToken:function(e){var r=e.trim();if(0===r.indexOf("out")){if(c)throw console.error("Found multiple ${out} tokens in a single fragment shader. This is not supported nor logical","If you need to use the declared output multiple times, use the assigned name","and don't wrap it repeatedly in the shader.","eg-","void main() {","  ${out: myOutput} = value;","  vec4 somethingElse = myOutput;","}"),new Error("Invalid Shader Format");c=!0;var n=r.substr("out".length).trim();if(":"===n[0]){var o=n.substr(":".length).trim();if(!o)throw new Error("Output in a shader requires an identifier ${out: <name required>}");if(i.has(o))throw new Error("You can not declare the same output name in subsequent fragment shader outputs");if("gl_FragColor"===o)throw new Error("DO not use gl_FragColor as an identifier for an out. Choose something not used by the WebGL spec.");return t?(i.add("gl_FragColor"),"gl_FragColor"!==o?"vec4 ".concat(o," = gl_FragColor"):"gl_FragColor"):"vec4 ".concat(o)}}return"${".concat(e,"}")},onMain:function(e,t){return n+="\n".concat((t||"").trim()),r+="\n  ".concat((e||"").trim()),(e||"").trim()}}),!!t})),{output:"".concat(n,"\nvoid main() {\n").concat(r,"\n}"),outputNames:Array.from(i.values()),outputTypes:u}}}),Object.defineProperty(e,"makeOutputFragmentShader",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){if(!r||(0,o.isString)(r)){if((0,o.isString)(n))return{source:(b=this.mergeOutputFragmentShaderForColor([{source:n,outputType:o.FragmentOutputType.COLOR}],[o.FragmentOutputType.COLOR])).output,outputTypes:[o.FragmentOutputType.COLOR],outputNames:b.outputNames};if(Array.isArray(n)){var a=n.find((function(e){return e.outputType===o.FragmentOutputType.COLOR})),s=-1;return s=a?n.indexOf(a):n.length-1,{source:(b=this.mergeOutputFragmentShaderForColor(n.slice(0,s+1),[o.FragmentOutputType.COLOR])).output,outputNames:b.outputNames,outputTypes:[o.FragmentOutputType.COLOR]}}return null}if(Array.isArray(r)){if(!i.WebGLStat.MRT)throw new Error("Multiple Render Targets were specified, but are not natively supported by user's hardware! MRT also does not have a fallback in deltav yet!");var u=r.map((function(e){return e.outputType}));if(Array.isArray(n)){for(var c=new Map,l=0,f=r.length;l<f;++l)for(var d=r[l],p=0,h=n.length;p<h;++p){if(n[p].outputType===d.outputType){c.set(d.outputType,p);break}}if(i.WebGLStat.MRT){var b,g=-1,v=[];return c.forEach((function(e,t){v.push(t),g=Math.max(e,g)})),-1===g?null:{source:(b=this.mergeFragmentOutputsForMRT(e,t,n.slice(0,g+1),u,v)).output,outputNames:b.outputNames,outputTypes:b.outputTypes}}throw new Error("Fragment shader generation not supported for MRT systems on non MRT hardware...yet")}if(r.find((function(e){return e.outputType===o.FragmentOutputType.COLOR}))&&n)return{source:(b=this.mergeFragmentOutputsForMRT(e,t,[{source:n,outputType:o.FragmentOutputType.COLOR}],u)).output,outputNames:b.outputNames,outputTypes:b.outputTypes}}return null}}),Object.defineProperty(e.prototype,"process",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i,a,l){var f,d=this;try{if(!e.surface.gl)return console.warn("No WebGL context available for layer!"),null;var p=this.processImports(e,t,r);if(!p)return null;var h=(0,c.injectShaderIO)(e.surface.gl,e,t,i,l,p),b=h.vertexAttributes,g=h.instanceAttributes,v=h.uniforms;e.getLayerBufferType(e.surface.gl,b,g),this.metricsProcessing.process(g,v);for(var y="",m="",w="",O={uniforms:[]},_=n.vs||new Map,T=n.fs||new Map,P=n.destructure||new Map,x=0,E=i.length;x<E;++x){var j=i[x],S=j.processHeaderInjection(o.ShaderInjectionTarget.VERTEX,_,e,this.metricsProcessing,b,g,v);y+=S.injection,S.material&&(O.uniforms=O.uniforms.concat(S.material.uniforms||[])),w+=j.processAttributeDestructuring(e,P,this.metricsProcessing,b,g,v)}var R="";_.forEach((function(e){R+=e})),y=R+y,R="",P.forEach((function(e){R+=e})),w=R+w;var M=this.processExtensions(),A=M+"precision highp float;\n\n"+y+p.vs,I=((f={})[u.templateVars.attributes]=w,f),L=!1,C=(0,s.shaderTemplate)({options:I,required:void 0,shader:A,onToken:function(e,t){return e===u.templateVars.attributes&&(L=!0),t},onMain:function(e){return L?e||"":null===e?(console.warn("The body of void main() could not be determined."),""):"".concat(w,"\n").concat(e)}});return p.fs.forEach((function(t,r){I={},m="",R="";for(var n=T.get(r)||new Map,u=function(t,r){var a=i[t].processHeaderInjection(o.ShaderInjectionTarget.FRAGMENT,n,e,d.metricsProcessing,b,g,v);if(m+=a.injection,a.material){var s=new Set;O.uniforms.forEach((function(e){return s.add(e.name)})),O.uniforms.forEach((function(e){s.has(e.name)||O.uniforms.push(e)}))}},c=0,l=i.length;c<l;++c)u(c);n.forEach((function(e){R+=e}));var f=M+"precision highp float;\n\n"+(m=R+m)+t.source,p=(0,s.shaderTemplate)({options:I,required:void 0,shader:f});t.source=p.shader.trim();for(c=0,l=a.length;c<l;++c){var h=a[c];C.shader=h.vertex(C.shader),t.source=h.fragment(t.source)}})),{fs:p.fs,materialUniforms:O.uniforms,maxInstancesPerBuffer:this.metricsProcessing.maxInstancesPerUniformBuffer,modules:Array.from(p.shaderModuleUnits),vs:C.shader.trim(),vertexAttributes:b,instanceAttributes:g,uniforms:v}}catch(t){return console.warn("An unknown error occurred while processing the shaders for layer:",e.id),console.warn("Error:"),console.warn(t&&(t.stack||t.message)),null}}}),Object.defineProperty(e.prototype,"processExtensions",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e="";return i.WebGLStat.SHADERS_3_0&&(e+="#version 300 es"),i.WebGLStat.MRT_EXTENSION&&(e+="#extension GL_EXT_draw_buffers : require"),e&&(e+="\n\n"),e}}),Object.defineProperty(e.prototype,"processImports",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var i=new Set,a=e.baseShaderModules(t);e.props.baseShaderModules&&(a=e.props.baseShaderModules(t,a));var s=f.ShaderModule.process(e.id,t.vs,o.ShaderInjectionTarget.VERTEX,a.vs);if(s.errors.length>0)return console.warn.apply(console,n(["Error processing imports for the vertex shader of layer:",e.id,"Errors"],s.errors.reverse(),!1)),null;var u=new Map;return r.forEach((function(t,r){var s=f.ShaderModule.process(e.id,t.source,o.ShaderInjectionTarget.FRAGMENT,a.fs);if(s.errors.length>0)console.warn.apply(console,n(["Error processing imports for the fragment shader of layer:",e.id,"Errors"],s.errors.reverse(),!1));else{s.shaderModuleUnits.forEach((function(e){return i.add(e)}));var c={source:s.shader||"",outputTypes:t.outputTypes,outputNames:t.outputNames};u.set(r,c)}})),s.shaderModuleUnits.forEach((function(e){return i.add(e)})),{fs:u,vs:s.shader||"",shaderModuleUnits:i}}}),e}();t.ShaderProcessor=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.templateVars=void 0,t.templateVars={attributes:"attributes",easingMethod:"easingMethod",extend:"extend",extendHeader:"extendHeader",T:"T"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsProcessing=void 0;var n=r(14),i=function(){function e(){Object.defineProperty(this,"instanceMaxBlock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blocksPerInstance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxUniforms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxUniformsForInstancing",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxInstancesPerUniformBuffer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"totalInstanceUniformBlocks",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e,"calculateUniformBlockUseage",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=0,r=0,n=e.length;r<n;++r)t+=Math.ceil(e[r].size/4);return t}}),Object.defineProperty(e.prototype,"process",{enumerable:!1,configurable:!0,writable:!0,value:function(t,r){var i=this;this.instanceMaxBlock=0,t.forEach((function(e){i.instanceMaxBlock=Math.max(i.instanceMaxBlock,e.block||0)})),this.blocksPerInstance=this.instanceMaxBlock+1,this.maxUniforms=n.WebGLStat.MAX_VERTEX_UNIFORMS,this.maxUniformsForInstancing=this.maxUniforms-e.calculateUniformBlockUseage(r),this.maxInstancesPerUniformBuffer=Math.floor(this.maxUniformsForInstancing/this.blocksPerInstance),this.totalInstanceUniformBlocks=this.maxInstancesPerUniformBuffer*this.blocksPerInstance}}),e}();t.MetricsProcessing=i},function(e,t,r){"use strict";var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.generateLayerMaterial=void 0;var o=r(4),a=r(0),s=((n={})[a.UniformSize.ONE]=o.MaterialUniformType.FLOAT,n[a.UniformSize.TWO]=o.MaterialUniformType.VEC2,n[a.UniformSize.THREE]=o.MaterialUniformType.VEC3,n[a.UniformSize.FOUR]=o.MaterialUniformType.VEC4,n[a.UniformSize.MATRIX3]=o.MaterialUniformType.MATRIX3x3,n[a.UniformSize.MATRIX4]=o.MaterialUniformType.MATRIX4x4,n[a.UniformSize.FLOAT_ARRAY]=o.MaterialUniformType.FLOAT_ARRAY,n[a.UniformSize.TEXTURE]=o.MaterialUniformType.TEXTURE,n),u=((i={})[a.UniformSize.ONE]=[0],i[a.UniformSize.TWO]=[0,0],i[a.UniformSize.THREE]=[0,0,0],i[a.UniformSize.FOUR]=[0,0,0,0],i[a.UniformSize.MATRIX3]=[0,0,0,0,0,0,0,0,0],i[a.UniformSize.MATRIX4]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i);function c(e){return{type:s[e.size],value:u[e.size]}}t.generateLayerMaterial=function(e,t,r,n,i){var a=e.getMaterialOptions(),s=new Map;r.forEach((function(e,t){s.set(t.renderTarget||null,e)})),Object.assign(a,e.props.materialOptions||{}),a.vertexShader=t,a.fragmentShader=s,a.name=e.id,a.uniforms={};for(var u=0,l=n.length;u<l;++u){var f=n[u],d=c(f);a.uniforms[f.name]=d}for(u=0,l=i.length;u<l;++u){var p=i[u];a.uniforms[p.name]={type:p.type,value:p.value}}return new o.Material(a)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateLayerGeometry=void 0;var n=r(4),i=r(0);t.generateLayerGeometry=function(e,t,r,o){var a=[];e.bufferType!==i.LayerBufferType.INSTANCE_ATTRIBUTE&&e.bufferType!==i.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING||(t=1);for(var s=0,u=r.length;s<u;++s){var c=r[s];a.push(new Float32Array(c.size*o*t))}var l,f,d,p,h=r.length,b=!1;for(s=0,u=o;s<u;++s)for(var g=0;g<h;++g)if(f=r[g],l=a[g],d=f.update(s),p=d,Array.isArray(p[0]))b=!0;else for(var v=s*f.size,y=v+f.size,m=0;v<y;++v,++m)l[v]=d[m];for(b&&console.warn("A vertex buffer updating method should not use arrays of arrays of numbers."),s=0,u=r.length;s<u;++s)for(var w=r[s].size*o,O=(g=1,t);g<O;++g)a[s].copyWithin(w*g,0,w);if(e.bufferType===i.LayerBufferType.UNIFORM){var _=a[0];for(s=0,u=t;s<u;++s){var T=s*o;for(g=0;g<o;++g)_[g+T]=s}}var P=new n.Geometry;for(s=0,u=r.length;s<u;++s){var x=r[s],E=new n.Attribute(a[s],x.size);x.materialAttribute=E,P.addAttribute(x.name,E)}return P}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(88),t),i(r(89),t),i(r(90),t)},function(e,t){e.exports="if (_active < 0.5) {\ngl_Position = vec4(0.0, 0.0, 0.0, 1.0);\nreturn;\n}"},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.InstanceAttributeBufferManager=t.isInstanceAttributeBufferLocation=void 0;var o=r(4),a=r(1),s=r(0),u=r(91),c=r(8),l=r(39),f=r(30),d=r(5)("performance"),p=Math.max;t.isInstanceAttributeBufferLocation=function(e){return Boolean(e&&e.buffer&&e.buffer.value)};var h=function(e){function t(t,r){var n=e.call(this,t,r)||this;return Object.defineProperty(n,"allBufferLocations",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(n,"availableLocations",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(n,"currentInstancedCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"instanceToBufferLocation",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(n,"maxInstancedCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"geometry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"material",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"model",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"attributes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"attributeToPropertyIds",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(n,"updateAllPropertyIdList",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(n,"activePropertyId",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(n,"currentAvailableLocation",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(n,"remove",{enumerable:!0,configurable:!0,writable:!0,value:function(e){var t=n.instanceToBufferLocation[e.uid];return t&&(delete n.instanceToBufferLocation[e.uid],n.availableLocations.push(t)),e}}),n.add=n.doAddWithRegistration,n}return i(t,e),Object.defineProperty(t.prototype,"changesProcessed",{enumerable:!1,configurable:!0,writable:!0,value:function(){e.prototype.changesProcessed.call(this),this.availableLocations.splice(0,this.currentAvailableLocation+1),this.currentAvailableLocation=-1}}),Object.defineProperty(t.prototype,"doAddWithRegistration",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;a.ObservableMonitoring.setObservableMonitor(!0),this.layer.shaderIOInfo.instanceAttributes.forEach((function(r){if(!r.parentAttribute){r.update(e);var n=a.ObservableMonitoring.getObservableMonitorIds(!0);t.attributeToPropertyIds.set(r,[n[n.length-1]]),n.length>1&&d("Property has multiple observables. Only the last trigger will be retained as the feature is not complete yet"),r===t.layer.shaderIOInfo.activeAttribute&&(t.activePropertyId=n[0])}})),a.ObservableMonitoring.setObservableMonitor(!1),this.makeUpdateAllPropertyIdList();var r=this.resizeBuffer();return this.gatherLocationsIntoGroups(r.newLocations,r.growth),this.add=this.doAdd,this.doAdd(e)}}),Object.defineProperty(t.prototype,"doAdd",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this.availableLocations.length<=0||this.currentAvailableLocation>=this.availableLocations.length-1){var t=this.resizeBuffer();this.gatherLocationsIntoGroups(t.newLocations,t.growth)}var r=this.availableLocations[++this.currentAvailableLocation];return r&&this.geometry?(this.instanceToBufferLocation[e.uid]=r,this.currentInstancedCount=this.geometry.maxInstancedCount=p(this.currentInstancedCount,r.instanceIndex+1),this.model&&(this.model.vertexDrawRange=[0,this.layer.shaderIOInfo.instanceVertexCount],this.model.drawInstances=this.currentInstancedCount,0===this.layer.shaderIOInfo.instanceVertexCount&&(this.model.vertexDrawRange[1]=this.model.drawInstances))):console.error("Add Error: Instance Attribute Buffer Manager failed to pair an instance with a buffer location"),r}}),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.geometry&&this.geometry.destroy(),this.material&&this.material.dispose(),this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model)}}),Object.defineProperty(t.prototype,"getBufferLocations",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.instanceToBufferLocation[e.uid]}}),Object.defineProperty(t.prototype,"getActiveAttributePropertyId",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.activePropertyId}}),Object.defineProperty(t.prototype,"getUpdateAllPropertyIdList",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.updateAllPropertyIdList}}),Object.defineProperty(t.prototype,"managesInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return void 0!==this.instanceToBufferLocation[e.uid]}}),Object.defineProperty(t.prototype,"makeUpdateAllPropertyIdList",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e={};this.attributeToPropertyIds.forEach((function(t){e[t[0]]=t[0]})),this.updateAllPropertyIdList=Object.values(e).filter(Boolean)}}),Object.defineProperty(t.prototype,"removeFromScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model),delete this.scene}}),Object.defineProperty(t.prototype,"resizeBuffer",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e;d("Gathering resize growth amount...");var t=this.layer.shaderIOInfo,r=0,n=new Map;if(this.changeListContext){r=1e3;for(var i=0,a=this.changeListContext.length;i<a;++i){var u=this.changeListContext[i];switch(u[1]){case s.InstanceDiffType.CHANGE:case s.InstanceDiffType.INSERT:this.instanceToBufferLocation[u[0].uid]||r++}}}if(d("BEGIN: Resizing unpacked attribute buffer by %d instances",r),this.geometry){this.geometry.destroy(),this.geometry=new o.Geometry;for(var f=this.maxInstancedCount,p=0,h=t.vertexAttributes;p<h.length;p++){(E=h[p]).materialAttribute&&this.geometry.addAttribute(E.name,E.materialAttribute)}this.maxInstancedCount+=r,this.attributes=this.attributes||[];for(var b=0,g=this.attributes;b<g.length;b++){j=(E=g[b]).bufferAttribute,R=E.size||0;if(j.data instanceof Float32Array){(M=j.data).length<this.maxInstancedCount*R&&(M=new Float32Array(this.maxInstancedCount*R*2)).set(j.data,0);var v=new o.Attribute(M,R,!0,!0);v.setDynamic(!0),E.bufferAttribute=v,this.geometry.addAttribute(E.name,v);S=n.get(E.name),A=this.allBufferLocations[E.name]||[];this.allBufferLocations[E.name]=A;for(var y=0,m=A.length;y<m;++y)A[y].buffer.value=M;S||(S=[],n.set(E.name,S));L=void 0;var w=S.length,O=this.maxInstancedCount-f;S.length+=O,A.length+=O;for(i=f,C=this.maxInstancedCount;i<C;++i,++w)L={attribute:E,buffer:{value:M},instanceIndex:i,range:[i*R,i*R+R]},S[w]=L,A[i]=L}}(null===(e=this.scene)||void 0===e?void 0:e.container)&&this.model&&this.scene.container.remove(this.model)}else{this.maxInstancedCount+=r,this.geometry=new o.Geometry;for(var _=0,T=t.vertexAttributes;_<T.length;_++){(E=T[_]).materialAttribute&&this.geometry.addAttribute(E.name,E.materialAttribute)}this.attributes=[];for(var P=0,x=t.instanceAttributes;P<x.length;P++){var E,j,S,R=(E=x[P]).size||0,M=new Float32Array(R*this.maxInstancedCount);(j=new o.Attribute(M,R,!0,!0)).setDynamic(!0),this.geometry.addAttribute(E.name,j),(S=n.get(E.name))||(S=[],n.set(E.name,S));var A=this.allBufferLocations[E.name]||[];this.allBufferLocations[E.name]=A;for(var I=Object.assign({},E,{uid:(0,c.uid)(),bufferAttribute:j}),i=0;i<this.maxInstancedCount;++i){var L={attribute:I,buffer:{value:M},instanceIndex:i,range:[i*R,i*R+R]};S.push(L),A.push(L)}this.attributes.push(I)}this.geometry.maxInstancedCount=0,this.material=this.makeLayerMaterial();i=0;for(var C=t.uniforms.length;i<C;++i){var B=t.uniforms[i];B.materialUniforms.push(this.material.uniforms[B.name])}}return this.scene&&this.model&&this.scene.container&&this.scene.container.remove(this.model),this.material=this.material||this.makeLayerMaterial(),this.model=(0,l.generateLayerModel)(this.layer.id,this.geometry,this.material,t.drawMode),this.scene&&this.scene.container&&this.model&&this.scene.container.add(this.model),d("COMPLETE: Resizing unpacked attribute buffer"),{growth:r,newLocations:n}}}),Object.defineProperty(t.prototype,"gatherLocationsIntoGroups",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(0!==this.attributeToPropertyIds.size){d("BEGIN: Unpacked attribute manager grouping new buffer locations");var r,n,i,o,a,s,c=[];this.attributeToPropertyIds.forEach((function(t,r){c.push({attribute:r,bufferLocationsForAttribute:e.get(r.name)||[],childBufferLocations:(r.childAttributes||[]).map((function(t){return{location:e.get(t.name)||[],bufferIndex:-1}})),ids:t,bufferIndex:-1})}));for(var l=0;l<t;++l){for(var f={instanceIndex:-1,propertyToBufferLocation:{}},p=0,h=c.length;p<h;++p)if(r=c[p],n=r.attribute,i=r.ids,o=r.bufferLocationsForAttribute)if(a=o[++r.bufferIndex]){if(-1===f.instanceIndex)f.instanceIndex=a.instanceIndex;else if(a.instanceIndex!==f.instanceIndex){(0,u.emitOnce)("Instance Attribute Parallelism Error",(function(e,t){console.warn("".concat(t,": A buffer location does not have a matching instance index which means the buffer locations are not in parallel with each other somehow. Error count: ").concat(e)),console.warn(n.name,a)}));continue}if(n.childAttributes){a.childLocations=[];for(var b=0,g=n.childAttributes.length;b<g;++b){var v=r.childBufferLocations[b];if(v){var y=v.location[++v.bufferIndex];y?a.childLocations.push(y):(s=n.childAttributes[b],(0,u.emitOnce)("Instance Attribute Child Attribute Error",(function(e,t){console.warn("".concat(t,": A child attribute does not have a buffer location available. Error count: ").concat(e)),console.warn("Parent Attribute: ".concat(n.name," Child Attribute: ").concat(s.name))})))}}}for(b=0,g=i.length;b<g;++b)f.propertyToBufferLocation[i[b]]=a}else(0,u.emitOnce)("Instance Attribute Buffer Error",(function(e,t){console.warn("".concat(t,": There is an error in forming buffer location groups in InstanceAttributeBufferManager. Error count: ").concat(e))}));else(0,u.emitOnce)("Instance Attribute Buffer Error",(function(e,t){console.warn("".concat(t,": There is an error in forming buffer location groups in InstanceAttributeBufferManager. Error count: ").concat(e))}));this.availableLocations.push(f)}d("COMPLETE: Unpacked attribute buffer manager buffer location grouping"),(0,u.flushEmitOnce)()}}}),Object.defineProperty(t.prototype,"getInstanceCount",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.maxInstancedCount}}),t}(f.BufferManagerBase);t.InstanceAttributeBufferManager=h},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.InstanceAttributePackingBufferManager=void 0;var o=r(4),a=r(1),s=r(0),u=r(91),c=r(8),l=r(39),f=r(30),d=Math.max,p=r(5)("performance"),h=function(e){function t(t,r){var n=e.call(this,t,r)||this;return Object.defineProperty(n,"allBufferLocations",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(n,"availableLocations",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(n,"currentInstancedCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"instanceToBufferLocation",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(n,"maxInstancedCount",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(n,"geometry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"material",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"model",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"attributes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"blockAttributes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"blockSubAttributesLookup",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(n,"attributeToPropertyIds",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(n,"updateAllPropertyIdList",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(n,"activePropertyId",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(n,"currentAvailableLocation",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(n,"remove",{enumerable:!0,configurable:!0,writable:!0,value:function(e){var t=n.instanceToBufferLocation[e.uid];return t&&(delete n.instanceToBufferLocation[e.uid],n.availableLocations.push(t)),e}}),n.add=n.doAddWithRegistration,n}return i(t,e),Object.defineProperty(t.prototype,"changesProcessed",{enumerable:!1,configurable:!0,writable:!0,value:function(){e.prototype.changesProcessed.call(this),this.availableLocations.splice(0,this.currentAvailableLocation+1),this.currentAvailableLocation=-1}}),Object.defineProperty(t.prototype,"doAddWithRegistration",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;this.layer.shaderIOInfo.instanceAttributes.forEach((function(r){if(!r.parentAttribute){a.ObservableMonitoring.setObservableMonitor(!0),r.update(e);var n=a.ObservableMonitoring.getObservableMonitorIds(!0);t.attributeToPropertyIds.set(r,[n[n.length-1]]),n.length>1&&p("Property has multiple observables. Only the last trigger will be retained as the feature is not complete yet"),r===t.layer.shaderIOInfo.activeAttribute&&(t.activePropertyId=n[0])}})),a.ObservableMonitoring.setObservableMonitor(!1),this.makeUpdateAllPropertyIdList();var r=this.resizeBuffer();return this.gatherLocationsIntoGroups(r.newLocations,r.growth),this.add=this.doAdd,this.doAdd(e)}}),Object.defineProperty(t.prototype,"doAdd",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this.availableLocations.length<=0||this.currentAvailableLocation>=this.availableLocations.length-1){var t=this.resizeBuffer();this.gatherLocationsIntoGroups(t.newLocations,t.growth)}var r=this.availableLocations[++this.currentAvailableLocation];return r&&this.geometry?(this.instanceToBufferLocation[e.uid]=r,this.currentInstancedCount=this.geometry.maxInstancedCount=d(this.currentInstancedCount,r.instanceIndex+1),this.model&&(this.model.vertexDrawRange=[0,this.layer.shaderIOInfo.instanceVertexCount],this.model.drawInstances=this.currentInstancedCount,0===this.layer.shaderIOInfo.instanceVertexCount&&(this.model.vertexDrawRange[1]=this.model.drawInstances))):console.error("Add Error: Instance Attribute Buffer Manager failed to pair an instance with a buffer location"),r}}),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.geometry&&this.geometry.destroy(),this.material&&this.material.dispose(),this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model)}}),Object.defineProperty(t.prototype,"getBufferLocations",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.instanceToBufferLocation[e.uid]}}),Object.defineProperty(t.prototype,"getActiveAttributePropertyId",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.activePropertyId}}),Object.defineProperty(t.prototype,"getUpdateAllPropertyIdList",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.updateAllPropertyIdList}}),Object.defineProperty(t.prototype,"managesInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return void 0!==this.instanceToBufferLocation[e.uid]}}),Object.defineProperty(t.prototype,"makeUpdateAllPropertyIdList",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e={};this.attributeToPropertyIds.forEach((function(t){e[t[0]]=t[0]})),this.updateAllPropertyIdList=Object.values(e).filter(Boolean)}}),Object.defineProperty(t.prototype,"removeFromScene",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model),delete this.scene}}),Object.defineProperty(t.prototype,"resizeBuffer",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.layer.shaderIOInfo,t=0,r=new Map;if(this.changeListContext){t=1e3;for(var n=0,i=this.changeListContext.length;n<i;++n){var a=this.changeListContext[n];switch(a[1]){case s.InstanceDiffType.CHANGE:case s.InstanceDiffType.INSERT:this.instanceToBufferLocation[a[0].uid]||t++}}}if(p("BEGIN: Resizing packed attribute buffer by %d instances",t),this.geometry){p("Info: Vertex packing buffer is being resized for layer ".concat(this.layer.id)),this.geometry.destroy(),this.geometry=new o.Geometry;for(var u=this.maxInstancedCount,f=0,d=e.vertexAttributes;f<d.length;f++){(D=d[f]).materialAttribute&&this.geometry.addAttribute(D.name,D.materialAttribute)}this.maxInstancedCount+=t,this.attributes=this.attributes||[],this.blockAttributes=this.blockAttributes||[];for(E=0,i=this.blockAttributes.length;E<i;++E){I=(D=this.blockAttributes[E]).bufferAttribute;var h=D.size||0;if(I.data instanceof Float32Array){(A=I.data).length<this.maxInstancedCount*h&&(A=new Float32Array(this.maxInstancedCount*h*2)).set(I.data,0),A.set(I.data,0);var b=new o.Attribute(A,h,!0,!0);D.bufferAttribute=I=b,this.geometry.addAttribute(D.name,b);M=this.blockSubAttributesLookup.get(E),j=D.size||0;if(M)for(L=0,C=M.length;L<C;++L){var g=M[L];(B=r.get(g.name))||(B=[],r.set(g.name,B));F=this.allBufferLocations[g.name]||[];this.allBufferLocations[g.name]=F;N=Object.assign({},g,{uid:(0,c.uid)(),packUID:D.packUID,bufferAttribute:I}),U=g.blockIndex||0,G=g.size||1;for(var v=void 0,y=0,m=F.length;y<m;++y)(v=F[y]).attribute=N,v.buffer.value=A;z=void 0;var w=B.length,O=this.maxInstancedCount-u;B.length+=O,F.length+=O;for(n=u;n<this.maxInstancedCount;++n,++w)z={attribute:N,block:E,buffer:{value:A},instanceIndex:n,range:[n*j+U,n*j+U+G]},B[w]=z,F[n]=z}}}}else{this.maxInstancedCount+=t,this.geometry=new o.Geometry;for(var _=0,T=e.vertexAttributes;_<T.length;_++){(D=T[_]).materialAttribute&&this.geometry.addAttribute(D.name,D.materialAttribute)}this.attributes=[],this.blockAttributes=[];var P=new Map,x=new Map;this.blockSubAttributesLookup=x;for(var n=0,i=e.instanceAttributes.length;n<i;++n){var E=(D=e.instanceAttributes[n]).block||0,j=P.get(E)||0;j=Math.max(j,(D.blockIndex||0)+(D.size||0)),P.set(E,j);var S=x.get(E);S||(S=[],x.set(E,S)),S.push(D)}x.forEach((function(e){return e.sort((function(e,t){return(e.blockIndex||0)-(t.blockIndex||0)}))}));var E=0;for(i=P.size;E<i;++E){var j=P.get(E)||0,R=(0,c.uid)();j||console.warn("Instance Attribute Packing Error: The system tried to build an attribute with a size of zero.","These are the attributes used:",e.instanceAttributes,"These are the block sizes calculated",P,"This is the block to attribute lookup generated",x);var M,A=new Float32Array(j*this.maxInstancedCount),I=new o.Attribute(A,j,!0,!0);if(this.geometry.addAttribute("block".concat(E),I),M=x.get(E)){for(var L=0,C=M.length;L<C;++L){var B,D=M[L];(B=r.get(D.name))||(B=[],r.set(D.name,B));var F=this.allBufferLocations[D.name]||[];this.allBufferLocations[D.name]=F;var N=Object.assign({},D,{uid:E,packUID:R,bufferAttribute:I,size:j}),U=D.blockIndex||0,G=D.size||1;for(n=0;n<this.maxInstancedCount;++n){var z={attribute:N,block:E,buffer:{value:A},instanceIndex:n,range:[n*j+U,n*j+U+G]};B.push(z),F.push(z)}this.attributes.push(N)}this.blockAttributes.push({uid:(0,c.uid)(),packUID:R,bufferAttribute:I,name:"block".concat(E),size:j,update:function(){return[0]}})}else console.warn("Instance Attribute Packing Buffer Error: Somehow there are no attributes associated with a block.","These are the attributes used:",e.instanceAttributes,"These are the block sizes calculated",P,"This is the block to attribute lookup generated",x)}this.geometry.maxInstancedCount=0,this.material=this.makeLayerMaterial();n=0;for(var k=e.uniforms.length;n<k;++n){var V=e.uniforms[n];V.materialUniforms.push(this.material.uniforms[V.name])}}return this.scene&&this.model&&this.scene.container&&this.scene.container.remove(this.model),this.material=this.material||this.makeLayerMaterial(),this.model=(0,l.generateLayerModel)(this.layer.id,this.geometry,this.material,this.layer.shaderIOInfo.drawMode),this.scene&&this.scene.container&&this.model&&this.scene.container.add(this.model),p("COMPLETE: Resizing unpacked attribute buffer"),{growth:t,newLocations:r}}}),Object.defineProperty(t.prototype,"gatherLocationsIntoGroups",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(0!==this.attributeToPropertyIds.size){p("BEGIN: Packed attribute manager grouping new buffer locations");var r=[];this.attributeToPropertyIds.forEach((function(t,n){r.push({attribute:n,bufferLocationsForAttribute:e.get(n.name)||[],childBufferLocations:(n.childAttributes||[]).map((function(t){return{location:e.get(t.name)||[],bufferIndex:-1}})),ids:t,bufferIndex:-1})}));for(var n=0;n<t;++n){for(var i={instanceIndex:-1,propertyToBufferLocation:{}},o=function(e,t){var n=r[e],o=n.attribute,a=n.ids,s=n.bufferLocationsForAttribute;if(!s)return(0,u.emitOnce)("Instance Attribute Buffer Error",(function(e,t){console.warn("".concat(t,": There is an error in forming buffer location groups in InstanceAttributePackingBufferManager. Error count: ").concat(e))})),"continue";var c=s[++n.bufferIndex];if(!c)return(0,u.emitOnce)("Instance Attribute Buffer Error",(function(e,t){console.warn("".concat(t,": There is an error in forming buffer location groups in InstanceAttributePackingBufferManager. Error count: ").concat(e))})),"continue";if(-1===i.instanceIndex)i.instanceIndex=c.instanceIndex;else if(c.instanceIndex!==i.instanceIndex)return(0,u.emitOnce)("Instance Attribute Parallelism Error",(function(e,t){console.warn("".concat(t,": A buffer location does not have a matching instance index which means the buffer locations are not in parallel with each other somehow. Error count: ").concat(e)),console.warn(o.name,c)})),"continue";if(o.childAttributes){for(var l=[],f=function(e,t){var r=o.childAttributes[e],i=n.childBufferLocations[e];if(i){var a=i.location[++i.bufferIndex];a?l.push(a):(0,u.emitOnce)("Instance Attribute Child Attribute Error",(function(e,t){console.warn("".concat(t,": A child attribute does not have a buffer location available. Error count: ").concat(e)),console.warn("Parent Attribute: ".concat(o.name," Child Attribute: ").concat(r.name))}))}},d=0,p=o.childAttributes.length;d<p;++d)f(d);c.childLocations=l}for(d=0,p=a.length;d<p;++d){var h=a[d];i.propertyToBufferLocation[h]=c}},a=0,s=r.length;a<s;++a)o(a);this.availableLocations.push(i)}p("COMPLETE: Packed attribute buffer manager buffer location grouping"),(0,u.flushEmitOnce)()}}}),Object.defineProperty(t.prototype,"getInstanceCount",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.maxInstancedCount}}),t}(f.BufferManagerBase);t.InstanceAttributePackingBufferManager=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InstanceDiffManager=void 0;var n=r(0),i=r(156),o=r(157),a=function(){function e(){Object.defineProperty(this,"processor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"processing",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"makeProcessor",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return this.processing||(e.bufferType===n.LayerBufferType.INSTANCE_ATTRIBUTE||e.bufferType===n.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING?this.processor=new i.InstanceAttributeDiffProcessor(e,t):this.processor=new o.UniformDiffProcessor(e,t),this.processing=[this.processor.changeInstance,this.processor.addInstance,this.processor.removeInstance]),this.processing}}),e}();t.InstanceDiffManager=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.InstanceAttributeDiffProcessor=void 0;var o,a=r(93),s=r(30),u=[],c=Math.min,l=Math.max;!function(e){e[e.PARTIAL=0]="PARTIAL",e[e.FULL=1]="FULL"}(o||(o={}));var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"diffMode",{enumerable:!0,configurable:!0,writable:!0,value:o.PARTIAL}),Object.defineProperty(t,"bufferAttributeUpdateRange",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(t,"bufferAttributeWillUpdate",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(t,"updateInstance",{enumerable:!0,configurable:!0,writable:!0,value:t.updateInstancePartial}),t}return i(t,e),Object.defineProperty(t.prototype,"addInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){if(n)e.changeInstance(e,t,u,n);else{var i=e.layer.bufferManager.add(t);(0,s.isBufferLocationGroup)(i)&&(t.active=!0,e.layer.onDiffAdd&&e.layer.onDiffAdd(t),e.updateInstance(e.layer,t,u,i))}}}),Object.defineProperty(t.prototype,"changeInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){n?e.updateInstance(e.layer,t,r,n):e.addInstance(e,t,u,n)}}),Object.defineProperty(t.prototype,"removeInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){n&&(t.active=!1,e.layer.onDiffRemove&&e.layer.onDiffRemove(t),e.updateInstance(e.layer,t,u,n),e.layer.bufferManager.remove(t))}}),Object.defineProperty(t.prototype,"updateInstancePartial",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){var i,o,a,s,u,f,d=n.propertyToBufferLocation,p=this.bufferAttributeUpdateRange;if(t.active){(0===r.length||t.reactivate)&&(r=this.bufferManager.getUpdateAllPropertyIdList());for(var h=0,b=r.length;h<b;++h)if((i=d[r[h]])&&(f=(u=i.attribute).packUID||u.uid,o=u.update(t),i.buffer.value.set(o,i.range[0]),(a=p[f]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER])[0]=u,a[1]=c(i.range[0],a[1]),a[2]=l(i.range[1],a[2]),p[f]=a,i.childLocations))for(var g=0,v=(s=i.childLocations).length;g<v;++g)(i=s[g])&&(f=i.attribute.packUID||i.attribute.uid,o=i.attribute.update(t),i.buffer.value.set(o,i.range[0]),(a=p[f]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER])[0]=i.attribute,a[1]=c(i.range[0],a[1]),a[2]=l(i.range[1],a[2]),p[f]=a)}else f=(u=(i=d[this.bufferManager.getActiveAttributePropertyId()]).attribute).packUID||u.uid,o=u.update(t),i.buffer.value.set(o,i.range[0]),(a=p[f]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER])[0]=u,a[1]=c(i.range[0],a[1]),a[2]=l(i.range[1],a[2]),p[f]=a;t.reactivate=!1}}),Object.defineProperty(t.prototype,"updateInstanceFull",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){var i,o,a,s,u=n.propertyToBufferLocation,c=this.bufferAttributeWillUpdate;if(t.active){(0===r.length||t.reactivate)&&(r=this.bufferManager.getUpdateAllPropertyIdList());for(var l=0,f=r.length;l<f;++l)if((i=u[r[l]])&&(o=(s=i.attribute).update(t),i.buffer.value.set(o,i.range[0]),c[s.packUID||s.uid]=s,i.childLocations))for(var d=0,p=(a=i.childLocations).length;d<p;++d)(i=a[d])&&(o=(s=i.attribute).update(t),i.buffer.value.set(o,i.range[0]),c[s.packUID||s.uid]=s)}else o=(s=(i=u[this.bufferManager.getActiveAttributePropertyId()]).attribute).update(t),i.buffer.value.set(o,i.range[0]),c[s.packUID||s.uid]=s;t.reactivate=!1}}),Object.defineProperty(t.prototype,"commit",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this.diffMode===o.PARTIAL)for(var e=0,t=(n=Object.values(this.bufferAttributeUpdateRange)).length;e<t;++e){var r=n[e];r[0].bufferAttribute.updateRange={count:r[2]-r[1],offset:r[1]}}else{var n;for(e=0,t=(n=Object.values(this.bufferAttributeWillUpdate)).length;e<t;++e){n[e].bufferAttribute.updateRange={count:-1,offset:0}}}this.bufferAttributeUpdateRange={}}}),Object.defineProperty(t.prototype,"incomingChangeList",{enumerable:!1,configurable:!0,writable:!0,value:function(e){0===e.length?this.diffMode=o.PARTIAL:e.length>.7*this.bufferManager.getInstanceCount()?this.diffMode=o.FULL:this.diffMode=o.PARTIAL,this.diffMode===o.PARTIAL?this.updateInstance=this.updateInstancePartial:this.updateInstance=this.updateInstanceFull}}),t}(a.BaseDiffProcessor);t.InstanceAttributeDiffProcessor=f},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.UniformDiffProcessor=void 0;var o=r(93),a=r(92),s=[],u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"addInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){if(n)e.changeInstance(e,t,s,n);else{var i=e.layer.bufferManager.add(t);(0,a.isUniformBufferLocation)(i)&&(t.active=!0,e.layer.onDiffAdd&&e.layer.onDiffAdd(t),e.updateInstance(e.layer,t,i))}}}),Object.defineProperty(t.prototype,"changeInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){n?e.updateInstance(e.layer,t,n):e.addInstance(e,t,s,n)}}),Object.defineProperty(t.prototype,"removeInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){n&&(t.active=!1,e.layer.onDiffRemove&&e.layer.onDiffRemove(t),e.updateInstance(e.layer,t,n),e.layer.bufferManager.remove(t))}}),Object.defineProperty(t.prototype,"updateInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){if(t.active){for(var n=r.buffer,i=r.range[0],o=n.value,a=void 0,s=(p=void 0,void 0),u=void 0,c=void 0,l=void 0,f=0,d=e.shaderIOInfo.instanceAttributes.length;f<d;++f)if(p=(a=e.shaderIOInfo.instanceAttributes[f]).update(t),s=o[i+(a.block||0)],void 0!==(u=a.blockIndex))for(c=u,l=p.length+u;c<l;++c)s[c]=p[c-u];n.value=o}else{n=r.buffer,i=r.range[0],o=n.value,a=void 0;var p=void 0;s=void 0,u=void 0;if(p=(a=e.shaderIOInfo.activeAttribute).update(t),s=o[i+(a.block||0)],void 0!==(u=a.blockIndex))for(c=u,l=p.length+u;c<l;++c)s[c]=p[c-u];n.value=o}}}),Object.defineProperty(t.prototype,"commit",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Object.defineProperty(t.prototype,"incomingChangeList",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),t}(o.BaseDiffProcessor);t.UniformDiffProcessor=u},function(e,t){e.exports="varying highp vec4 _picking_color_pass_;\nvoid main() {\n${out: _picking_fragment_} = _picking_color_pass_;\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeWheel=void 0;var n=r(160);Object.defineProperty(t,"normalizeWheel",{enumerable:!0,get:function(){return n.normalizeWheel}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeWheel=void 0;var n=r(161),i=r(162);function o(e){var t=0,r=0,n=0,i=0;return"detail"in e&&(r=e.detail),"wheelDelta"in e&&(r=-e.wheelDelta/120),"wheelDeltaY"in e&&(r=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=r,r=0),n=10*t,i=10*r,"deltaY"in e&&(i=e.deltaY),"deltaX"in e&&(n=e.deltaX),(n||i)&&e.deltaMode&&(1===e.deltaMode?(n*=40,i*=40):(n*=800,i*=800)),n&&!t&&(t=n<1?-1:1),i&&!r&&(r=i<1?-1:1),{spinX:t,spinY:-r,pixelX:n,pixelY:-i}}t.normalizeWheel=o,o.getEventType=function(){return n.firefox()?"DOMMouseScroll":i("wheel")?"wheel":"mousewheel"}},function(e,t){var r,n,i,o,a,s,u,c,l,f,d,p,h,b,g,v=!1;function y(){if(!v){v=!0;var e=navigator.userAgent,t=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(e),y=/(Mac OS X)|(Windows)|(Linux)/.exec(e);if(p=/\b(iPhone|iP[ao]d)/.exec(e),h=/\b(iP[ao]d)/.exec(e),f=/Android/i.exec(e),b=/FBAN\/\w+;/i.exec(e),g=/Mobile/i.exec(e),d=!!/Win64/.exec(e),t){(r=t[1]?parseFloat(t[1]):t[5]?parseFloat(t[5]):NaN)&&document&&document.documentMode&&(r=document.documentMode);var m=/(?:Trident\/(\d+.\d+))/.exec(e);s=m?parseFloat(m[1])+4:r,n=t[2]?parseFloat(t[2]):NaN,i=t[3]?parseFloat(t[3]):NaN,(o=t[4]?parseFloat(t[4]):NaN)?(t=/(?:Chrome\/(\d+\.\d+))/.exec(e),a=t&&t[1]?parseFloat(t[1]):NaN):a=NaN}else r=n=i=a=o=NaN;if(y){if(y[1]){var w=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(e);u=!w||parseFloat(w[1].replace("_","."))}else u=!1;c=!!y[2],l=!!y[3]}else u=c=l=!1}}var m={ie:function(){return y()||r},ieCompatibilityMode:function(){return y()||s>r},ie64:function(){return m.ie()&&d},firefox:function(){return y()||n},opera:function(){return y()||i},webkit:function(){return y()||o},safari:function(){return m.webkit()},chrome:function(){return y()||a},windows:function(){return y()||c},osx:function(){return y()||u},linux:function(){return y()||l},iphone:function(){return y()||p},mobile:function(){return y()||p||h||f||g},nativeApp:function(){return y()||b},android:function(){return y()||f},ipad:function(){return y()||h}};e.exports=m},function(e,t,r){"use strict";var n,i=r(163);i.canUseDOM&&(n=document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("",""))
/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */,e.exports=function(e,t){if(!i.canUseDOM||t&&!("addEventListener"in document))return!1;var r="on"+e,o=r in document;if(!o){var a=document.createElement("div");a.setAttribute(r,"return;"),o="function"==typeof a[r]}return!o&&n&&"wheel"===e&&(o=document.implementation.hasFeature("Events.wheel","3.0")),o}},function(e,t,r){"use strict";var n=!("undefined"==typeof window||!window.document||!window.document.createElement),i={canUseDOM:n,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:n&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:n&&!!window.screen,isInWorker:!n};e.exports=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(165)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(9),i=r(0),o=r(40),a=r(6);n.ShaderModule.register([{moduleId:"world2D",description:"\nThese are projection methods and camera\nrelated constants associated with a\nView2D.\n\nMethods:\nvec3 cameraSpace(vec3 world);\nvec3 cameraSpaceSize(vec3 worldSize);\nvec4 clipSpace(vec3 world);\nvec4 clipSpaceSize(vec3 worldSize);\n\nConstants:\nmat4 projection;\nmat4 view;\nmat4 viewProjection;\nvec3 cameraOffset;\nvec3 cameraPosition;\nvec3 cameraScale;\nvec3 cameraScale2D;\nvec3 cameraRotation;\nvec2 viewSize;\nfloat pixelRatio;\n",content:r(113),compatibility:i.ShaderInjectionTarget.ALL,uniforms:function(e){return e instanceof a.Layer2D?[{name:"projection",size:i.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"view",size:i.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"viewProjection",size:i.UniformSize.MATRIX4,update:function(){return e.view.props.camera.viewProjection}},{name:"cameraOffset",size:i.UniformSize.THREE,update:function(){return e.view.props.camera instanceof o.Camera2D?e.view.props.camera.control2D.offset:[0,0,0]}},{name:"cameraPosition",size:i.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:i.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraScale2D",size:i.UniformSize.THREE,update:function(){return e.view.props.camera instanceof o.Camera2D?e.view.props.camera.scale2D:[1,1,1]}},{name:"cameraRotation",size:i.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"viewSize",size:i.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:i.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]:(console.warn("A shader requested the module world2D; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}}])},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Surface=t.DEFAULT_SHADER_TRANSFORM=t.DEFAULT_RESOURCE_MANAGEMENT=t.DEFAULT_IO_EXPANSION=void 0;var o=r(67),a=r(4),s=r(73),u=r(74),c=r(7),l=r(23),f=r(48),d=r(110),p=r(111),h=r(98),b=r(90),g=r(0),v=r(3),y=r(61),m=r(112),w=r(89),O=r(88),_=r(177),T=r(60),P=r(179),x=r(27);t.DEFAULT_IO_EXPANSION=[new w.BasicIOExpansion,new b.ActiveIOExpansion,new O.EasingIOExpansion],t.DEFAULT_RESOURCE_MANAGEMENT=[{type:g.ResourceType.COLOR_BUFFER,manager:new f.ColorBufferResourceManager},{type:g.ResourceType.TEXTURE,manager:new p.RenderTextureResourceManager},{type:g.ResourceType.ATLAS,manager:new d.AtlasResourceManager({})},{type:g.ResourceType.FONT,manager:new l.FontResourceManager}],t.DEFAULT_SHADER_TRANSFORM=[new _.Shaders30CompatibilityTransform];var E,j=[0,0,0,0];function S(e,t){return(e.order||Number.MAX_SAFE_INTEGER)-(t.order||Number.MAX_SAFE_INTEGER)}!function(e){e[e.WILL_RENDER=0]="WILL_RENDER",e[e.DID_RENDER=1]="DID_RENDER"}(E||(E={}));var R=function(){function e(e){var t=this;Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"commands",{enumerable:!0,configurable:!0,writable:!0,value:new P.SurfaceCommands({surface:this})}),Object.defineProperty(this,"frameMetrics",{enumerable:!0,configurable:!0,writable:!0,value:{currentFrame:0,currentTime:0|Date.now(),frameDuration:1e3/60,previousTime:0|Date.now()}}),Object.defineProperty(this,"isBufferingResources",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ioExpanders",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"shaderTransforms",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"optimizedOutputs",{enumerable:!0,configurable:!0,writable:!0,value:new Set([g.FragmentOutputType.PICKING])}),Object.defineProperty(this,"ioSorting",{enumerable:!0,configurable:!0,writable:!0,value:new h.BaseIOSorting}),Object.defineProperty(this,"userInputManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pixelRatio",{enumerable:!0,configurable:!0,writable:!0,value:window.devicePixelRatio}),Object.defineProperty(this,"renderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"resourceManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enabledOptimizedOutputs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"viewDrawDependencies",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"ready",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"readyResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"resourceDiffs",{enumerable:!0,configurable:!0,writable:!0,value:new y.ReactiveDiff({buildItem:function(e){return n(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.resourceManager.initResource(e)];case 1:return t.sent(),[2,{id:e.key}]}}))}))},destroyItem:function(e,r){return n(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.resourceManager.destroyResource(e)];case 1:return t.sent(),[2,!0]}}))}))},updateItem:function(e,r){return n(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.resourceManager.updateResource(e)];case 1:return t.sent(),[2]}}))}))}})}),Object.defineProperty(this,"sceneDiffs",{enumerable:!0,configurable:!0,writable:!0,value:new y.ReactiveDiff({buildItem:function(e){return n(t,void 0,void 0,(function(){return i(this,(function(t){return[2,new T.LayerScene(this,{key:e.key,views:e.views,layers:e.layers})]}))}))},destroyItem:function(e,r){return n(t,void 0,void 0,(function(){return i(this,(function(e){return r.destroy(),[2,!0]}))}))},updateItem:function(e,r){return n(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,r.update(e)];case 1:return t.sent(),[2]}}))}))}})}),this.readyResolver=new v.PromiseResolver,this.ready=this.readyResolver.promise,e&&this.init(e)}return Object.defineProperty(e.prototype,"gl",{get:function(){return this.context},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scenes",{get:function(){return this.sceneDiffs.items},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"broadcastEventManagerCycle",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=0,r=this.userInputManager.eventManagers.length;t<r;++t){var n=this.userInputManager.eventManagers[t];switch(e){case E.DID_RENDER:n.didRender();break;case E.WILL_RENDER:n.willRender()}}}}),Object.defineProperty(e.prototype,"commit",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return n(this,void 0,void 0,(function(){var n,o,a,s,l,f,d,p,h,b,g,v,y,m,w,O,_,T,P,x,E,j,R;return i(this,(function(i){if(!this.gl)return[2];for(n=!1,t&&this.frameMetrics.currentFrame++,this.frameMetrics.frameDuration=this.frameMetrics.currentTime-this.frameMetrics.previousTime,this.frameMetrics.previousTime=this.frameMetrics.currentTime,void 0===e?this.frameMetrics.currentTime=0|Date.now():(this.frameMetrics.previousTime===this.frameMetrics.currentTime&&(this.frameMetrics.previousTime=e),this.frameMetrics.currentTime=e),e=this.frameMetrics.currentTime,(o=this.sceneDiffs.items).sort(S),a={},s=0,l=o.length;s<l;++s)for(f=o[s],d=f.views,p=f.layers,d.sort(S),p.sort(S),h=0,b=d.length;h<b;++h){for(g=d[h],v={},p.length>0&&g.willUseView(),y=this.renderer.getRenderSize(),m=new c.Bounds({width:y[0],height:y[1],x:0,y:0}),g.renderTarget&&(w=Array.isArray(g.renderTarget)?g.renderTarget[0]:g.renderTarget,O=w.getSize(),m=new c.Bounds({width:O[0],height:O[1],x:0,y:0})),_=(0,u.getAbsolutePositionBounds)(g.props.viewport,m,this.pixelRatio),g.fitViewtoViewport(m,_),T=0,P=p.length;T<P;++T){(x=p[T]).view=g;try{x.draw(),(x.needsViewDrawn||x.isAnimationContinuous)&&(g.needsDraw=!0),v[x.id]=x,g.animationEndTime=Math.max(g.animationEndTime,x.animationEndTime,g.props.camera.animationEndTime),x.lastFrameTime=e}catch(e){a[x.id]||(a[x.id]=[x,e])}}(g.needsDraw||e&&e<g.lastFrameTime||e&&e<g.animationEndTime||g.props.camera.needsViewDrawn)&&(g.needsDraw=!0,n=!0,(E=this.viewDrawDependencies.get(g))&&E.forEach((function(e){e.needsDraw=!0}))),j=Object.values(v),p.length!==j.length&&f.layerDiffs.diff(j.map((function(e){return e.initializer}))),f.container&&(r&&r(n,f,g))}return R=Object.values(a),this.printLayerErrors(R),[2]}))}))}}),Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.resourceManager.destroy(),this.userInputManager.destroy(),this.sceneDiffs.destroy(),this.renderer.dispose(),delete this.context}}),Object.defineProperty(e.prototype,"draw",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return n(this,void 0,void 0,(function(){var t,r,n,o,a,s,u,c,l,f,d,p,h=this;return i(this,(function(i){switch(i.label){case 0:if(!this.gl)return[2];for(this.broadcastEventManagerCycle(E.WILL_RENDER),a=0,s=this.sceneDiffs.items.length;a<s;++a)for(u=this.sceneDiffs.items[a],t=0,r=u.views.length;t<r;++t)(f=u.views[t]).props.camera.broadcast(f.id);return[4,this.commit(e,!0,(function(e,t,r){t.container&&e&&h.drawSceneView(t.container,r)}))];case 1:return i.sent(),this.userInputManager.waitingForRender&&(this.userInputManager.waitingForRender=!1),this.isBufferingResources?[3,4]:(this.isBufferingResources=!0,[4,this.resourceManager.dequeueRequests()]);case 2:return n=i.sent(),this.isBufferingResources=!1,n?(o=this.draw,[4,(0,v.onFrame)()]):[3,4];case 3:o.apply(this,[i.sent()]),i.label=4;case 4:for(a=0,s=this.sceneDiffs.items.length;a<s;++a){for(u=this.sceneDiffs.items[a],c=0,l=u.views.length;c<l;++c)(f=u.views[c]).needsDraw=!1,f.props.camera.resolve();for(d=0,p=u.layers.length;d<p;++d)u.layers[d].needsViewDrawn=!1}return this.broadcastEventManagerCycle(E.DID_RENDER),this.enabledOptimizedOutputs.clear(),[2]}}))}))}}),Object.defineProperty(e.prototype,"drawSceneView",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){var i=this;r=r||this.renderer;var o={x:t.viewBounds.left,y:t.viewBounds.top},a=t.viewBounds,s=t.props.background||j,u=t.clearFlags.indexOf(x.ClearFlags.COLOR)>-1,c=n||t.renderTarget||null;t.renderTarget&&(t.getRenderTargets().forEach((function(e){return i.optimizedOutputs.forEach((function(t){return e.disabledTargets.add(t)}))})),this.enabledOptimizedOutputs.size>0&&t.getRenderTargets().forEach((function(e){return i.enabledOptimizedOutputs.forEach((function(t){return e.disabledTargets.delete(t)}))})));r.setRenderTarget(c),r.setScissor({x:o.x,y:o.y,width:a.width,height:a.height},c),u&&r.clearColor([s[0],s[1],s[2],s[3]]),r.setViewport({x:o.x,y:o.y,width:a.width,height:a.height}),t.clearFlags&&t.clearFlags.length>0?r.clear(u,t.clearFlags.indexOf(x.ClearFlags.DEPTH)>-1,t.clearFlags.indexOf(x.ClearFlags.STENCIL)>-1):r.clear(!1),r.render(e,c,t.props.glState),t.lastFrameTime=this.frameMetrics.currentTime}}),Object.defineProperty(e.prototype,"fitContainer",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this.context&&!(0,a.isOffscreenCanvas)(this.context.canvas)){var t=this.context.canvas.parentElement;if(t){var r=this.context.canvas;r.className="",r.setAttribute("style",""),t.style.position="relative",r.style.position="absolute",r.style.left="0xp",r.style.top="0xp",r.style.width="100%",r.style.height="100%",r.setAttribute("width",""),r.setAttribute("height","");var n=t.getBoundingClientRect(),i=r.getBoundingClientRect();this.resize(i.width||100,n.height||100)}}}}),Object.defineProperty(e.prototype,"gatherViewDrawDependencies",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this.sceneDiffs){this.viewDrawDependencies.clear();for(var e=this.sceneDiffs.items,t=this.renderer.getRenderSize(),r=0,n=e.length;r<n;r++)for(var i=0,o=(d=e[r]).views.length;i<o;++i){var a=d.views[i];a.willUseView();var s=new c.Bounds({width:t[0],height:t[1],x:0,y:0});if(a.renderTarget){var l=(Array.isArray(a.renderTarget)?a.renderTarget[0]:a.renderTarget).getSize();s=new c.Bounds({width:l[0],height:l[1],x:0,y:0})}var f=(0,u.getAbsolutePositionBounds)(a.props.viewport,s,this.pixelRatio);a.fitViewtoViewport(s,f),a.props.camera.update(!0)}for(r=0,n=e.length;r<n;r++){var d;for(i=0,o=(d=e[r]).views.length;i<o;++i){for(var p=d.views[i],h=[],b=0,g=e.length;b<g;b++)if(b!==r)for(var v=e[b],y=0,m=v.views.length;y<m;++y){var w=v.views[y];p.viewBounds.hitBounds(w.viewBounds)&&h.push(w)}this.viewDrawDependencies.set(p,h)}}}}}),Object.defineProperty(e.prototype,"getCurrentInteraction",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.userInputManager.currentInteraction}}),Object.defineProperty(e.prototype,"getIOExpanders",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.ioExpanders}}),Object.defineProperty(e.prototype,"getIOSorting",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.ioSorting}}),Object.defineProperty(e.prototype,"getShaderTransforms",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.shaderTransforms}}),Object.defineProperty(e.prototype,"getOptimizedOutputs",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.enabledOptimizedOutputs}}),Object.defineProperty(e.prototype,"getViewSize",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=0,r=this.sceneDiffs.items.length;t<r;++t){var n=this.sceneDiffs.items[t].viewDiffs.getByKey(e);if(n)return n.renderTarget?n.viewBounds:n.screenBounds}return null}}),Object.defineProperty(e.prototype,"getViewWorldBounds",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=0,r=this.sceneDiffs.items.length;t<r;++t){var n=this.sceneDiffs.items[t].viewDiffs.getByKey(e);if(n){if(n.screenBounds){var i=n.projection.viewToWorld([0,0]),o=n.projection.screenToWorld([n.screenBounds.right,n.screenBounds.bottom]);return new c.Bounds({bottom:o[1],left:i[0],right:o[0],top:i[1]})}return null}}return null}}),Object.defineProperty(e.prototype,"getProjections",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=0,r=this.sceneDiffs.items.length;t<r;++t){var n=this.sceneDiffs.items[t].viewDiffs.getByKey(e);if(n)return n.projection}return null}}),Object.defineProperty(e.prototype,"init",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t;return n(this,void 0,void 0,(function(){var r,n=this;return i(this,(function(i){switch(i.label){case 0:return this.context?[2,this]:(this.pixelRatio=e.pixelRatio||this.pixelRatio,this.pixelRatio<1&&(this.pixelRatio=1),(r=this.initGL(e))?(this.context=r,this.gl?(null===(t=e.optimizedOutputTargets)||void 0===t||t.forEach((function(e){return n.optimizedOutputs.add(e)})),this.initUserInputManager(e),[4,this.initResources(e)]):[3,4]):(this.readyResolver.reject({error:g.SurfaceErrorType.NO_WEBGL_CONTEXT,message:"Could not establish a webgl context. Surface is being destroyed to free resources."}),this.destroy(),[2,this]));case 1:return i.sent(),[4,this.initIOExpanders(e)];case 2:return i.sent(),[4,this.initShaderTransforms(e)];case 3:return i.sent(),[3,5];case 4:console.warn("Could not establish a GL context. Layer Surface will be unable to render"),i.label=5;case 5:return this.readyResolver.resolve(this),[2,this]}}))}))}}),Object.defineProperty(e.prototype,"initGL",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=e.context;if(!t)return null;try{t.setAttribute("data-deltav",r(180).version)}catch(e){}var n=t.width,i=t.height,o=!0,a=Object.assign({alpha:!1,antialias:!1,preserveDrawingBuffer:!1,premultiplyAlpha:!1},e.rendererOptions);return this.renderer=new s.WebGLRenderer({alpha:a.alpha,antialias:a.antialias,canvas:t,preserveDrawingBuffer:a.preserveDrawingBuffer,premultipliedAlpha:a.premultipliedAlpha,onNoContext:function(){o=!1}}),o&&this.renderer.gl?(this.context=this.renderer.gl,this.resourceManager&&this.resourceManager.setWebGLRenderer(this.renderer),this.setRendererSize(n,i),this.renderer.setPixelRatio(this.pixelRatio),this.renderer.gl):null}}),Object.defineProperty(e.prototype,"initIOExpanders",{enumerable:!1,configurable:!0,writable:!0,value:function(e){Array.isArray(e.ioExpansion)||void 0===e.ioExpansion?this.ioExpanders=e.ioExpansion&&e.ioExpansion.slice(0)||t.DEFAULT_IO_EXPANSION&&t.DEFAULT_IO_EXPANSION.slice(0)||[]:e.ioExpansion instanceof Function&&(this.ioExpanders=e.ioExpansion(t.DEFAULT_IO_EXPANSION));var r=this.resourceManager.getIOExpansion();this.ioExpanders=this.ioExpanders.concat(r)}}),Object.defineProperty(e.prototype,"initShaderTransforms",{enumerable:!1,configurable:!0,writable:!0,value:function(e){Array.isArray(e.shaderTransforms)||void 0===e.shaderTransforms?this.shaderTransforms=e.shaderTransforms&&e.shaderTransforms.slice(0)||t.DEFAULT_SHADER_TRANSFORM&&t.DEFAULT_SHADER_TRANSFORM.slice(0)||[]:e.shaderTransforms instanceof Function&&(this.shaderTransforms=e.shaderTransforms(t.DEFAULT_SHADER_TRANSFORM))}}),Object.defineProperty(e.prototype,"initUserInputManager",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this.context){var t=[new m.LayerMouseEvents].concat(e.eventManagers||[]);this.userInputManager=new o.UserInputEventManager(this.context.canvas,this,t,e.handlesWheelEvents)}}}),Object.defineProperty(e.prototype,"initResources",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return n(this,void 0,void 0,(function(){var r=this;return i(this,(function(n){return this.resourceManager=new l.ResourceRouter,this.resourceManager.setWebGLRenderer(this.renderer),(e.resourceManagers&&e.resourceManagers.slice(0)||t.DEFAULT_RESOURCE_MANAGEMENT&&t.DEFAULT_RESOURCE_MANAGEMENT.slice(0)||[]).forEach((function(e){r.resourceManager.setManager(e.type,e.manager)})),[2]}))}))}}),Object.defineProperty(e.prototype,"pipeline",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return e.resources?[4,this.resourceDiffs.diff(e.resources)]:[3,2];case 1:t.sent(),t.label=2;case 2:return e.scenes?[4,this.sceneDiffs.diff(e.scenes)]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.gatherViewDrawDependencies(),[2]}}))}))}}),Object.defineProperty(e.prototype,"printLayerErrors",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.length>0&&(console.warn("Some layers errored during their draw update. These layers will be removed. They can be re-added if render() is called again:",e.map((function(e){return e[0].id}))),e.forEach((function(e){if(console.warn("Layer ".concat(e[0].id," removed for the following error:")),e[1]){var t=e[1].stack||e[1].message;if(console.error(t),t.indexOf("RangeError")>-1||t.indexOf("Source is too large")>-1){for(var r,n=e[0],i=n.bufferManager.changeListContext||[],o=0,a=function(e,t){var a=i[e][0];n.shaderIOInfo.instanceAttributes.forEach((function(e){e.update(a).length!==e.size&&(r||(r=["Example instance returned the wrong sized value for an attribute:",a,e]),o++)}))},s=0,u=i.length;s<u;++s)a(s);r&&(console.error("The following output shows discovered issues related to the specified error"),console.error("Instances are returning too large IO for an attribute\n",r[0],r[1],r[2],"Total errors for too large IO values",o))}}})))}}),Object.defineProperty(e.prototype,"resize",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){if(this.pixelRatio=r||this.pixelRatio,this.pixelRatio<1&&(this.pixelRatio=1),this.setRendererSize(e,t),this.renderer.setPixelRatio(this.pixelRatio),this.userInputManager.resize(),this.resourceManager.resize(),this.sceneDiffs)for(var n=this.sceneDiffs.items,i=0,o=n.length;i<o;++i)for(var a=n[i],s=0,u=a.views.length;s<u;++s){var c=a.views[s];c.pixelRatio=this.pixelRatio,c.props.camera.update(!0)}this.gatherViewDrawDependencies()}}),Object.defineProperty(e.prototype,"redraw",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var e=0,t=this.sceneDiffs.items.length;e<t;++e)for(var r=this.sceneDiffs.items[e],n=0,i=r.views.length;n<i;++n){r.views[n].needsDraw=!0}}}),Object.defineProperty(e.prototype,"setRendererSize",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){e=e||100,t=t||100,this.renderer.setSize(e,t)}}),Object.defineProperty(e.prototype,"enableOptimizedOutput",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.enabledOptimizedOutputs.add(e)}}),e}();t.Surface=R},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeFontSDF=t.convertToSDF=void 0;var n=r(2),i=Math.ceil,o=Math.max,a=Math.log2,s=Math.pow,u=Math.sqrt,c=[-1,-1];function l(e,t,r){void 0===r&&(r=!1);for(var i,a,s,c,l=r?-1:1,f=[],d=-1,p=0,h=e.length;p<h;++p){var b=e[p];f[p]=[];for(var g=0,v=b.length;g<v;++g)(i=b[g])===t?c=256:(a=[p,g],s=(0,n.subtract2)(i,a),c=u((0,n.dot2)(s,s))),f[p][g]=c,d=o(c,d)}for(p=0,h=e.length;p<h;++p)for(g=0,v=(b=e[p]).length;g<v;++g)c=f[p][g],f[p][g]=c/d*255*l;return f}function f(e,t,r,n){for(var i,o=l(e,r,!0),a=l(t,r,!1),s=o.length,u=o,c=0,f=o.length;c<f;++c)for(var d=o[c],p=a[c],h=0,b=d.length;h<b;++h){var g=d[h],v=p[h];d[h]=g+v}for(c=0,f=u.length;c<f;++c)for(h=0,b=(d=u[c]).length;h<b;++h){i=i=d[h];var y=h*(4*s)+4*c;n[y]=i,n[y+1]=i,n[y+2]=i,n[y+3]=255}}function d(e,t){for(var r,i,o,a,u,l,f,d,p,h=e.length,b=e[0].length,g=function(e){for(var t=[],r=0,n=e.length;r<n;++r)t[r]=[];return t}(e),v=e,y=0;y<t;++y){var m=g;g=v,v=m;var w=s(2,t-y-1);for(f=0;f<h;++f)for(d=0;d<b;++d){for(r=[f,d],o=[(g[f-w]||[])[d-w]||c,(g[f]||[])[d-w]||c,(g[f+w]||[])[d-w]||c,(g[f-w]||[])[d]||c,(g[f]||[])[d]||c,(g[f+w]||[])[d]||c,(g[f-w]||[])[d+w]||c,(g[f]||[])[d+w]||c,(g[f+w]||[])[d+w]||c],u=0,a=Number.MAX_VALUE,p=0;p<9;++p){var O=o[p];O!==c&&(i=(0,n.subtract2)(O,r),(l=(0,n.dot2)(i,i))<a&&(a=l,u=p))}v[f][d]=o[u]}}return v}t.convertToSDF=function(e,t){void 0===t&&(t=f);var r=e.width,n=e.height,s=e.getContext("2d");if(s){var u=s.getImageData(0,0,r,n).data,l=o(r,n),p=i(a(l)),h=function(e,t){for(var r=e.width,n=e.height,i=[],o=[],a=0;a<r;++a){i[a]=[],o[a]=[];for(var s=0;s<n;++s){t[s*(4*r)+4*a+3]?(i[a][s]=[a,s],o[a][s]=c):(i[a][s]=c,o[a][s]=[a,s])}}return{seed:i,inverse:o}}(e,u),b=d(h.seed,p),g=d(h.inverse,p),v=new ImageData(r,n);t(b,g,c,v.data),s.putImageData(v,0,0)}},t.makeFontSDF=function(e){}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.EasingUtil=void 0;var o=r(0),a=r(28),s=function(){function e(){}return Object.defineProperty(e,"modify",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){return n(this,void 0,void 0,(function(){var n,o,a,s,u,c,l;return i(this,(function(i){for(n=0,o=t.length;n<o;++n)for(a=t[n],s=0,u=e.length;s<u;++s)c=e[s],(l=c.getEasing(a))&&r(l,c,s,n);return[2]}))}))}}),Object.defineProperty(e,"all",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,s){return n(this,void 0,void 0,(function(){var n,u,c,l,f,d,p,h,b,g,v;return i(this,(function(i){for(n=o.NOOP,u=new Promise((function(e){return n=e})),c=0,l=0,f=r.length;l<f;++l)for(d=r[l],p=0,h=t.length;p<h;++p)b=t[p],(g=b.getEasing(d))&&(s&&s(g,b,p,l),c=Math.max((g.delay||0)+g.duration,c));return v=function(e){e<c?(0,a.onFrame)(v):n()},e?(0,a.onFrame)((function(e){c+=e,v(e)})):n(),[2,u]}))}))}}),e}();t.EasingUtil=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wait=void 0,t.wait=function(e){return new Promise((function(t){return setTimeout(t,e)}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=void 0;var n=r(27),i=r(57),o=r(18),a=r(102),s=r(103);t.create={layer:o.createLayer,view:n.createView,vertex:s.createVertex,uniform:a.createUniform,attribute:i.createAttribute}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResourcePool=void 0;var n=function(){function e(e){Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"pool",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"marker",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pool=new Array(e.firstAlloc);for(var t=0,r=e.firstAlloc;t<r;++t)this.pool[t]=e.create();this.options=e}return Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var e=0,t=this.pool.length;e<t;++e)this.options.destroy(this.pool[e]);delete this.pool,delete this.marker,delete this.options}}),Object.defineProperty(e.prototype,"retrieve",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.pool[this.index+1];return this.index++,this.marker.set(e,this.index),e}}),Object.defineProperty(e.prototype,"replace",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.marker.get(e);void 0!==t&&(this.pool[t]=this.pool[this.index],this.pool[this.index]=e,this.marker.delete(e),this.index--)}}),e}();t.ResourcePool=n},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.svgToData=void 0;var o=r(3),a=document.createElement("img"),s=document.createElement("canvas");t.svgToData=function(e){return n(this,void 0,void 0,(function(){var t,r,n,u,c,l;return i(this,(function(i){switch(i.label){case 0:return t=new o.PromiseResolver,a&&s?(r=(new XMLSerializer).serializeToString(e),n=btoa(r),"data:image/svg+xml;base64,",u="data:image/svg+xml;base64,"+n,c=!1,l=function(){if(!c){c=!0,s.width=a.width*window.devicePixelRatio,s.height=a.height*window.devicePixelRatio;var e=s.getContext("2d");e?(e.clearRect(0,0,s.width,s.height),e.mozImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1,e.drawImage(a,0,0,a.width*window.devicePixelRatio,a.height*window.devicePixelRatio),t.resolve(e.getImageData(0,0,s.width,s.height)),a.src="",s.width=0,s.height=0,s.style.position="absolute",s.style.top="0px",s.style.zIndex="9999"):t.resolve(null)}},a.onload=l,a.src=u,a.width>0&&a.height>0&&l(),[4,t.promise]):[2,null];case 1:return[2,i.sent()]}}))}))}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.FontResourceManager=void 0;var s=r(24),u=r(0),c=r(3),l=r(21),f=r(42),d=r(100),p=r(63),h=r(5)("performance"),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"currentAttribute",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"requestLookup",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"requestQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"resourceLookup",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"fontManager",{enumerable:!0,configurable:!0,writable:!0,value:new d.FontManager}),t}return i(t,e),Object.defineProperty(t.prototype,"dequeueRequests",{enumerable:!1,configurable:!0,writable:!0,value:function(){return o(this,void 0,Promise,(function(){var e,t,r,n,i,o;return a(this,(function(s){switch(s.label){case 0:e=!1,t=[],this.requestQueue.forEach((function(e,r){t.push([r,e])})),this.requestQueue.clear(),r=function(r,i){var o,s,u,l,f;return a(this,(function(i){switch(i.label){case 0:return o=t[r],s=o[0],(u=o[1]).length>0?(e=!0,l=u.slice(0),u.length=0,h("Processing requests for resource '%s'",s),[4,n.fontManager.updateFontMap(s,l)]):[3,3];case 1:return i.sent(),[4,n.fontManager.calculateMetrics(s,l)];case 2:i.sent(),(f=n.requestLookup.get(s))?(l.forEach((function(e){var t=f.get(e);if(f.delete(e),t){for(var r=0,n=t.length;r<n;++r){var i=t[r],o=i[0],a=i[1];o.managesInstance(a)&&(a.active=!0)}(0,c.nextFrame)((function(){for(var e=new Set,r=0,n=t.length;r<n;++r){var i=t[r][1];e.has(i)||(e.add(i),i.resourceTrigger())}}))}})),h("All requests for resource '%s' are processed",s)):h("There were no Font requests waiting for completion for resource",s),i.label=3;case 3:return[2]}}))},n=this,i=0,o=t.length,s.label=1;case 1:return i<o?[5,r(i,o)]:[3,4];case 2:s.sent(),s.label=3;case 3:return++i,[3,1];case 4:return[2,e]}}))}))}}),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.fontManager.destroy()}}),Object.defineProperty(t.prototype,"destroyResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.resourceLookup.get(e.key);t&&(this.fontManager.destroyFontMap(t.id),this.resourceLookup.delete(e.key))}}),Object.defineProperty(t.prototype,"getResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.resourceLookup.get(e)||null}}),Object.defineProperty(t.prototype,"getIOExpansion",{enumerable:!1,configurable:!0,writable:!0,value:function(){return[new f.TextureIOExpansion(u.ResourceType.FONT,this)]}}),Object.defineProperty(t.prototype,"initResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(r){switch(r.label){case 0:return(0,d.isFontResource)(e)?[4,this.fontManager.createFontMap(e)]:[3,2];case 1:(t=r.sent())&&this.resourceLookup.set(e.key,t),h("Font map created->",t),r.label=2;case 2:return[2]}}))}))}}),Object.defineProperty(t.prototype,"request",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){var i=r,o=i.fontMap,a=null;if(o)return i.character&&(a=o.getGlyphTexture(i.character)),a?i.fetch===p.FontResourceRequestFetch.IMAGE_SIZE?[a.pixelWidth,a.pixelHeight]:(0,s.subTextureIOValue)(a):i.fetch===p.FontResourceRequestFetch.IMAGE_SIZE?[0,0]:(0,s.subTextureIOValue)(null);var u=r.key,c=this.requestLookup.get(u);if(c){var l=c.get(i);if(l)return l.push([e,t]),t.active=!1,i.fetch===p.FontResourceRequestFetch.IMAGE_SIZE?[0,0]:(0,s.subTextureIOValue)(a)}else c=new Map,this.requestLookup.set(u,c);t.active=!1;var f=this.requestQueue.get(u);return f||(f=[],this.requestQueue.set(u,f)),f.push(i),c.set(i,[[e,t]]),i.fetch?[0,0]:(0,s.subTextureIOValue)(a)}}),Object.defineProperty(t.prototype,"updateResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if((0,d.isFontResource)(e)){var t=this.resourceLookup.get(e.key);t&&((0,c.shallowCompare)(e.fontSource,t.fontSource)||h("Font resources currently do not update. To update their properties simply destroy and recreate for now."))}}}),t}(l.BaseResourceManager);t.FontResourceManager=b},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.VideoTextureMonitor=void 0;var o=r(3),a=function(){function e(e,t){var r=this;Object.defineProperty(this,"video",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"subTexture",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"isDestroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"renderedTime",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"previousTime",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"playedFrames",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"caughtFrames",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"timeFrame",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"doUpdate",{enumerable:!0,configurable:!0,writable:!0,value:function(){Math.abs(r.video.currentTime-r.renderedTime)<.015||(r.renderedTime=r.video.currentTime,r.subTexture.update())}}),Object.defineProperty(this,"loop",{enumerable:!0,configurable:!0,writable:!0,value:function(e){r.doUpdate(),r.isDestroyed||(0,o.onFrame)(r.loop)}}),this.addEventListeners()}return Object.defineProperty(e.prototype,"addEventListeners",{enumerable:!1,configurable:!0,writable:!0,value:function(){return n(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.isDestroyed?[2]:(e=this.loop,[4,(0,o.onFrame)()]);case 1:return e.apply(this,[t.sent()]),[2]}}))}))}}),Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.video.pause(),this.isDestroyed=!0,this.removeEventListeners()}}),Object.defineProperty(e.prototype,"removeEventListeners",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),e}();t.VideoTextureMonitor=a},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.atlasRequest=void 0;var i=r(0),o=new Image;t.atlasRequest=function(e){return n({type:i.ResourceType.ATLAS,source:o},e)}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceRouter=void 0;var o=r(21),a=r(5)("performance"),s=function(){function e(){Object.defineProperty(this,"managers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"resourceKeyToType",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"webGLRenderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}return Object.defineProperty(e.prototype,"dequeueRequests",{enumerable:!1,configurable:!0,writable:!0,value:function(){return n(this,void 0,void 0,(function(){var e,t,r,n,o;return i(this,(function(i){switch(i.label){case 0:e=!1,t=Array.from(this.managers.values()),r=0,n=t.length,i.label=1;case 1:return r<n?[4,t[r].dequeueRequests()]:[3,4];case 2:o=i.sent(),e=e||o,i.label=3;case 3:return++r,[3,1];case 4:return[2,e]}}))}))}}),Object.defineProperty(e.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.managers.forEach((function(e){return e.destroy()})),this.resourceKeyToType.clear(),this.managers.clear(),delete this.webGLRenderer}}),Object.defineProperty(e.prototype,"destroyResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return(t=this.managers.get(e.type))?(this.resourceKeyToType.delete(e.key),[4,t.destroyResource(e)]):(console.warn("A Resource is trying to be destroyed but has no manager to facilitate the operation: ".concat(e.type)),[2]);case 1:return[2,r.sent()]}}))}))}}),Object.defineProperty(e.prototype,"getIOExpansion",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=[];return this.managers.forEach((function(t){e=e.concat(t.getIOExpansion())})),e}}),Object.defineProperty(e.prototype,"getManager",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.managers.get(e);return t||(console.warn("A manager was requested that does not exist for type ".concat(e)),o.INVALID_RESOURCE_MANAGER)}}),Object.defineProperty(e.prototype,"getResourceType",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.resourceKeyToType.get(e)}}),Object.defineProperty(e.prototype,"initResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return(t=this.managers.get(e.type))?this.resourceKeyToType.has(e.key)?(console.warn("Detected two resources with identical keys. The duplicate resource will not be generated:",e.key),[2]):(this.resourceKeyToType.set(e.key,e.type),[4,t.initResource(e)]):(console.warn("A Resource is trying to be created but has no manager to facilitate the operation: ".concat(e.type)),[2]);case 1:return[2,r.sent()]}}))}))}}),Object.defineProperty(e.prototype,"request",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){var i=this.managers.get(r.type);return i?i.request(e,t,r,n):(console.warn("A Layer is requesting a resource for which there is no manager set. Please make sure a Resource Manager is set for resource of type: ".concat(r.type)),[-1,-1,-1,-1])}}),Object.defineProperty(e.prototype,"resize",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.managers.forEach((function(e){return e.resize()}))}}),Object.defineProperty(e.prototype,"setManager",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this.managers.get(e)&&a("A manager was assigned to a resource type: ".concat(e," that overrides another manager already set to that type.")),t.router=this,this.managers.set(e,t),t.webGLRenderer=this.webGLRenderer}}),Object.defineProperty(e.prototype,"setWebGLRenderer",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.webGLRenderer=e,this.managers.forEach((function(t){return t.webGLRenderer=e}))}}),Object.defineProperty(e.prototype,"updateResource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return(t=this.managers.get(e.type))?[4,t.updateResource(e)]:(console.warn("A Resource is trying to be updated but has no manager to facilitate the operation: ".concat(e.type)),[2]);case 1:return[2,r.sent()]}}))}))}}),e}();t.ResourceRouter=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Shaders30CompatibilityTransform=void 0;var o=r(14),a=r(178),s=r(80),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"vertex",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=(0,s.removeComments)(e);return t=o.WebGLStat.SHADERS_3_0?(t=t.replace(/\s+varying\s+/g,"\nout ")).replace(/(texture2D(\s+)\(|texture2D\()/g,"texture("):(t=t.replace(/^#version 300 es/g,"")).replace(/\s+out\s+/g,"\nvarying ")}}),Object.defineProperty(t.prototype,"fragment",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=(0,s.removeComments)(e);if(o.WebGLStat.SHADERS_3_0){if((t=(t=t.replace(/\s+varying\s+/g,"\nin ")).replace(/(texture2D(\s+)\(|texture2D\()/g,"texture(")).match(/gl_FragColor/g)&&!(t=t.replace(/gl_FragColor/g,"_FragColor")).match("out vec4 _FragColor")){var r=t.split("\n");r.splice(3,0,"layout(location = 0) out vec4 _FragColor;"),t=r.join("\n")}}else t=(t=t.replace(/^#version 300 es/g,"")).replace(/\s+in\s+/g,"\nvarying ");return t}}),t}(a.BaseShaderTransform);t.Shaders30CompatibilityTransform=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseShaderTransform=void 0;var n=function(){};t.BaseShaderTransform=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SurfaceCommands=void 0;var n=r(45),i=r(15),o=r(2),a=r(0);var s=function(){function e(e){Object.defineProperty(this,"surface",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pickingRenderTargets",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.surface=e.surface}return Object.defineProperty(e.prototype,"analyzePickedPixels",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(!t.optimizeRendering){var r=(0,o.divide2)((0,o.scale2)(e,this.surface.pixelRatio),t.projection.screenScale),n=new Uint8Array(100);this.surface.renderer.readPixels(Math.floor(r[0]-2.5),Math.floor(r[1]-2.5),5,5,n);for(var i=function(e,t,r,n,i){for(var o={view:e,allColors:[],colorData:r,dataHeight:i,dataWidth:n,mouse:t,nearestColor:0,nearestColorBytes:[0,0,0,0]},a=new Map,s=0,u=[],c=n/2,l=i/2,f=0,d=[0,0,0,0],p=Number.MAX_SAFE_INTEGER,h=0;h<i;++h){var b=[];u.push(b);for(var g=0;g<n;++g){var v=r[s],y=r[s+1],m=r[s+2];s+=4;var w=v<<16|y<<8|m;if(a.set(w,!0),b.push(w),0!==w){var O=g-c,_=h-l,T=O*O+_*_;T<p&&(p=T,f=w,d=[v,y,m,255])}}}return o.allColors=Array.from(a.keys()),o.nearestColor=f,o.nearestColorBytes=d,o}(t,[r[0]-t.screenBounds.x,r[1]-t.screenBounds.y],n,5,5),s=0,u=t.scene.layers.length;s<u;++s){var c=t.scene.layers[s];c.picking.type===a.PickType.SINGLE&&(c.interactions.colorPicking=i)}}}}),Object.defineProperty(e.prototype,"decodePicking",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=this.surface.getCurrentInteraction();if(t){var r=t.screen.position,o=t.target.views.map((function(e){return e.view})),s=new Set;this.pickingRenderTargets.forEach((function(e,t){var r=e.getBuffers()[0].buffer;r instanceof i.Texture&&(r.gl&&!r.destroyed||(e.dispose(),s.add(t)))})),s.forEach((function(t){return e.pickingRenderTargets.delete(t)})),o.forEach((function(t){var i=e.pickingRenderTargets.get(t);if(i||t.getRenderTargets().forEach((function(r){r.gl&&r.getBuffers().forEach((function(r){if(r.outputType===a.FragmentOutputType.PICKING){if(0===(i=new n.RenderTarget({buffers:{color:r}})).width||0===i.height)return void(i=void 0);e.pickingRenderTargets.set(t,i)}}))})),i){var o=e.surface.renderer.state.currentRenderTarget,s=!1;o?(Array.isArray(o)||o.getBuffers()[0].buffer!==i.getBuffers()[0].buffer)&&(s=!0):s=!0,s&&e.surface.renderer.setRenderTarget(i),e.analyzePickedPixels(r,t)}}))}}}),e}();t.SurfaceCommands=s},function(e){e.exports={version:"2.1.0"}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(112),t)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.CommandLayer=void 0;var o=r(35),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"draw",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.props.commands(this.surface)}}),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){return null}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{data:new o.InstanceProvider,key:"",commands:function(){}}}),t}(r(37).Layer);t.CommandLayer=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.BasicCamera2DController=t.CameraBoundsAnchor=void 0;var o,a=r(43),s=r(12),u=r(7),c=r(3);!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_MIDDLE=1]="TOP_MIDDLE",e[e.TOP_RIGHT=2]="TOP_RIGHT",e[e.MIDDLE_LEFT=3]="MIDDLE_LEFT",e[e.MIDDLE=4]="MIDDLE",e[e.MIDDLE_RIGHT=5]="MIDDLE_RIGHT",e[e.BOTTOM_LEFT=6]="BOTTOM_LEFT",e[e.BOTTOM_MIDDLE=7]="BOTTOM_MIDDLE",e[e.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(o=t.CameraBoundsAnchor||(t.CameraBoundsAnchor={}));var l=function(e){function t(t){var r=e.call(this,{})||this;return Object.defineProperty(r,"_uid",{enumerable:!0,configurable:!0,writable:!0,value:(0,c.uid)()}),Object.defineProperty(r,"bounds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"_camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"ignoreCoverViews",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"isPanning",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(r,"isScaling",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(r,"panFilter",{enumerable:!0,configurable:!0,writable:!0,value:function(e,t,r){return e}}),Object.defineProperty(r,"scaleFactor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"scaleFilter",{enumerable:!0,configurable:!0,writable:!0,value:function(e,t,r){return e}}),Object.defineProperty(r,"startViews",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(r,"wheelShouldScroll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"twoFingerPan",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"optimizedViews",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(r,"cameraImmediateAnimation",{enumerable:!0,configurable:!0,writable:!0,value:s.AutoEasingMethod.immediate(0)}),Object.defineProperty(r,"targetTouches",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(r,"coveredStartView",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(r,"onRangeChanged",{enumerable:!0,configurable:!0,writable:!0,value:function(e,t){}}),Object.defineProperty(r,"startViewDidStart",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(r,"applyBounds",{enumerable:!0,configurable:!0,writable:!0,value:function(){if(r.bounds&&r.camera){var e=r.getView(r.bounds.view);r.applyScaleBounds(),e&&(r.camera.control2D.getOffset()[0]=r.boundsHorizontalOffset(e,r.bounds),r.camera.control2D.getOffset()[1]=r.boundsVerticalOffset(e,r.bounds))}}}),Object.defineProperty(r,"applyScaleBounds",{enumerable:!0,configurable:!0,writable:!0,value:function(){r.camera&&r.bounds&&(r.bounds.scaleMin&&r.camera.control2D.setScale((0,s.max3)(r.camera.control2D.getScale(),r.bounds.scaleMin)),r.bounds.scaleMax&&r.camera.control2D.setScale((0,s.min3)(r.camera.control2D.getScale(),r.bounds.scaleMax)))}}),Object.defineProperty(r,"handleCameraViewChange",{enumerable:!0,configurable:!0,writable:!0,value:function(e,t){if(t===r.startViews[0]){var n=r.surface.getProjections(t);n&&r.onRangeChanged(e,n)}}}),t.bounds&&r.setBounds(t.bounds),r._camera=t.camera,r.scaleFactor=t.scaleFactor||1e3,r.ignoreCoverViews=t.ignoreCoverViews||!1,r.twoFingerPan=t.twoFingerPan||!1,t.startView&&(Array.isArray(t.startView)?(r.startViews=t.startView,r._camera.control2D.setViewChangeHandler(r.handleCameraViewChange)):(r.startViews=[t.startView],r._camera.control2D.setViewChangeHandler(r.handleCameraViewChange))),r.panFilter=t.panFilter||r.panFilter,r.scaleFilter=t.scaleFilter||r.scaleFilter,r.onRangeChanged=t.onRangeChanged||r.onRangeChanged,t.wheelShouldScroll&&(r.wheelShouldScroll=t.wheelShouldScroll),r}return i(t,e),Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anchoredByBoundsHorizontal",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){switch(t.anchor){case o.TOP_LEFT:case o.MIDDLE_LEFT:case o.BOTTOM_LEFT:return-(t.worldBounds.left-t.screenPadding.left/this.camera.control2D.getScale()[0]);case o.TOP_MIDDLE:case o.MIDDLE:case o.BOTTOM_MIDDLE:return-(t.worldBounds.right-t.worldBounds.width/2-(e.screenBounds.width+t.screenPadding.right)/this.camera.control2D.getScale()[0]*.5);case o.TOP_RIGHT:case o.MIDDLE_RIGHT:case o.BOTTOM_RIGHT:return-(t.worldBounds.right-(e.screenBounds.width-t.screenPadding.right)/this.camera.control2D.getScale()[0])}}}),Object.defineProperty(t.prototype,"anchoredByBoundsVertical",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){switch(t.anchor){case o.TOP_LEFT:case o.TOP_MIDDLE:case o.TOP_RIGHT:return-(t.worldBounds.top-t.screenPadding.top/this.camera.control2D.getScale()[1]);case o.MIDDLE_LEFT:case o.MIDDLE:case o.MIDDLE_RIGHT:return-(t.worldBounds.bottom-t.worldBounds.height/2-(e.screenBounds.height+t.screenPadding.bottom)/this.camera.control2D.getScale()[1]*.5);case o.BOTTOM_LEFT:case o.BOTTOM_MIDDLE:case o.BOTTOM_RIGHT:return-(t.worldBounds.bottom-(e.screenBounds.height-t.screenPadding.bottom)/this.camera.control2D.getScale()[1])}}}),Object.defineProperty(t.prototype,"boundsHorizontalOffset",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=e.projection.worldToScreen([t.worldBounds.left,t.worldBounds.top]),n=e.projection.worldToScreen([t.worldBounds.right,t.worldBounds.bottom]);return n[0]-r[0]+t.screenPadding.left+t.screenPadding.right-e.screenBounds.width<0?this.anchoredByBoundsHorizontal(e,t):n[0]<e.screenBounds.right-t.screenPadding.right?-t.worldBounds.right+(e.screenBounds.width-t.screenPadding.right)/this.camera.control2D.getScale()[0]:r[0]>e.screenBounds.left+t.screenPadding.left?-t.worldBounds.left+t.screenPadding.left/this.camera.control2D.getScale()[0]:this.camera.control2D.getOffset()[0]}}),Object.defineProperty(t.prototype,"boundsVerticalOffset",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=e.projection.worldToScreen([t.worldBounds.left,t.worldBounds.top]),n=e.projection.worldToScreen([t.worldBounds.right,t.worldBounds.bottom]);return n[1]-r[1]+t.screenPadding.top+t.screenPadding.bottom-e.screenBounds.height<0?this.anchoredByBoundsVertical(e,t):n[1]<e.screenBounds.bottom-t.screenPadding.bottom?-t.worldBounds.bottom+(e.screenBounds.height-t.screenPadding.bottom)/this.camera.control2D.getScale()[1]:r[1]>e.screenBounds.top+t.screenPadding.top?-t.worldBounds.top+t.screenPadding.top/this.camera.control2D.getScale()[0]:this.camera.control2D.getOffset()[1]}}),Object.defineProperty(t.prototype,"canStart",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return 0===this.startViews.length||this.startViews&&this.startViews.indexOf(e)>-1||this.startViewDidStart&&this.ignoreCoverViews}}),Object.defineProperty(t.prototype,"centerOn",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(this.camera.control2D.surface){var r=this.camera.control2D.surface.getViewSize(e);if(r){var n=[r.width/2,r.height/2,0],i=(0,s.subtract3)(t,(0,s.divide3)(n,this.camera.control2D.getScale())),o=(0,s.scale3)(i,-1);this.setOffset(e,o)}}}}),Object.defineProperty(t.prototype,"doPan",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){var n=(0,s.vec3)((0,s.divide2)(r,this.camera.control2D.getScale()),0);this.panFilter&&(n=this.panFilter(n,t,e)),this.camera.control2D.getOffset()[0]+=n[0],this.camera.control2D.getOffset()[1]+=n[1],this.applyBounds(),this.onRangeChanged(this.camera,t.projection),this.applyBounds(),this.camera.control2D.update()}}),Object.defineProperty(t.prototype,"doScale",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n){var i=t.projection.screenToWorld(e),o=this.camera.control2D.getScale()[0]||1,a=this.camera.control2D.getScale()[1]||1;this.scaleFilter&&(n=this.scaleFilter(n,t,r)),this.camera.control2D.getScale()[0]=o+n[0],this.camera.control2D.getScale()[1]=a+n[1],this.applyScaleBounds();var u=t.projection.screenToWorld(e),c=(0,s.subtract2)(i,u);this.camera.control2D.getOffset()[0]-=c[0],this.camera.control2D.getOffset()[1]-=c[1],this.applyBounds(),this.onRangeChanged(this.camera,t.projection),this.applyBounds(),this.camera.control2D.update(),this.camera.control2D.animation=this.cameraImmediateAnimation}}),Object.defineProperty(t.prototype,"filterTouchesByValidStart",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.ignoreCoverViews?e.filter((0,c.touchesContainsStartView)(this.startViews)):e.filter((0,c.touchesHasStartView)(this.startViews))}}),Object.defineProperty(t.prototype,"findCoveredStartView",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this,r=e.target.views.find((function(e){return t.startViews.indexOf(e.view.id)>-1}));this.startViewDidStart=Boolean(r),r&&(this.coveredStartView=r.view)}}),Object.defineProperty(t.prototype,"getRange",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.getProjection(e),r=this.getViewScreenBounds(e);if(t&&r){var n=t.screenToWorld([r.x,r.y]),i=t.screenToWorld([r.right,r.bottom]);return new u.Bounds({height:i[1]-n[1],width:i[0]-n[0],x:n[0],y:n[1]})}return new u.Bounds({x:0,y:0,width:1,height:1})}}),Object.defineProperty(t.prototype,"getTargetView",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.startViews&&!this.ignoreCoverViews?e.target.view:this.coveredStartView}}),Object.defineProperty(t.prototype,"handleMouseDown",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.startViews&&(this.findCoveredStartView(e),e.start&&(this.isPanning=this.canStart(e.start.view.id)||this.isPanning))}}),Object.defineProperty(t.prototype,"handleTouchDown",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this.startViews){var t=this.filterTouchesByValidStart(e.allTouches);this.twoFingerPan?t.length>1&&(this.isPanning=!0):t.length>0&&(this.isPanning=!0),t.length>1&&(this.isScaling=!0);for(var r=0,n=t.length;r<n;++r){var i=t[r];this.targetTouches.add(i.touch.touch.identifier)}}}}),Object.defineProperty(t.prototype,"handleMouseUp",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.startViewDidStart=!1,this.isPanning=!1,this.optimizedViews.forEach((function(e){return e.optimizeRendering=!1})),this.optimizedViews.clear()}}),Object.defineProperty(t.prototype,"handleTouchUp",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;e.touches.forEach((function(e){t.targetTouches.delete(e.touch.touch.identifier),t.targetTouches.size<=0&&(t.startViewDidStart=!1,t.isPanning=!1,t.optimizedViews.forEach((function(e){return e.optimizeRendering=!1})),t.optimizedViews.clear())})),this.isPanning=!1,this.isScaling=!1,this.targetTouches.size>0&&(this.isPanning=!0),this.targetTouches.size>1&&(this.isScaling=!0)}}),Object.defineProperty(t.prototype,"handleTouchCancelled",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;e.touches.forEach((function(e){t.targetTouches.delete(e.touch.touch.identifier),t.targetTouches.size<=0&&(t.startViewDidStart=!1,t.isPanning=!1,t.optimizedViews.forEach((function(e){return e.optimizeRendering=!1})),t.optimizedViews.clear())})),this.isPanning=!1,this.isScaling=!1,this.targetTouches.size>0&&(this.isPanning=!0),this.targetTouches.size>1&&(this.isScaling=!0)}}),Object.defineProperty(t.prototype,"handleDrag",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;e.start&&this.canStart(e.start.view.id)&&(e.target.views.forEach((function(e){e.view.optimizeRendering=!0,t.optimizedViews.add(e.view)})),this.doPan(e.target.views.map((function(e){return e.view})),e.start.view,e.mouse.deltaPosition),this.camera.control2D.animation=this.cameraImmediateAnimation)}}),Object.defineProperty(t.prototype,"handleTouchDrag",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this,r=this.filterTouchesByValidStart(e.allTouches);if(r.length>0&&this.isPanning){for(var n=0,i=r.length;n<i;++n){r[n].target.views.forEach((function(e){e.view.optimizeRendering=!0,t.optimizedViews.add(e.view)}))}var o=new Set,a=r.reduce((function(e,t){for(var r=0,n=t.target.views.length;r<n;++r){var i=t.target.views[r];o.add(i.view)}return t.touch.startTime<e.touch.startTime?t:e}),r[0]).start.view;if(this.isPanning&&(this.doPan(Array.from(o.values()),a,e.multitouch.centerDelta(r)),this.camera.control2D.animation=this.cameraImmediateAnimation),this.isScaling){var u=e.multitouch.center(r),c=(0,s.subtract2)(r[0].touch.currentPosition,u),l=(0,s.subtract2)(u,e.multitouch.centerDelta(r)),f=(0,s.subtract2)(r[0].touch.previousPosition,l),d=(0,s.length2)(c)/(0,s.length2)(f),p=[d*this.camera.scale2D[0]-this.camera.scale2D[0],d*this.camera.scale2D[1]-this.camera.scale2D[1],0];1!==d&&this.doScale(u,a,Array.from(o.values()),p)}}}}),Object.defineProperty(t.prototype,"handleWheel",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(this.findCoveredStartView(e),this.canStart(e.target.view.id))if(this.wheelShouldScroll){var t=[-e.mouse.wheel.delta[0],e.mouse.wheel.delta[1]];e.start&&this.doPan(e.target.views.map((function(e){return e.view})),e.start.view,t)}else{var r=this.camera.control2D.getScale()[0]||1,n=this.camera.control2D.getScale()[1]||1,i=this.getTargetView(e),o=[e.mouse.wheel.delta[1]/this.scaleFactor*r,e.mouse.wheel.delta[1]/this.scaleFactor*n,1];this.doScale(e.screen.position,i,e.target.views.map((function(e){return e.view})),o)}}}),Object.defineProperty(t.prototype,"pan",{get:function(){return this.camera.control2D.offset},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.camera.control2D.getScale()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"setBounds",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.bounds=e,this.applyBounds()}}),Object.defineProperty(t.prototype,"setOffset",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=(0,s.copy3)(this.camera.control2D.offset);if(this.camera.control2D.getOffset()[0]=t[0],this.camera.control2D.getOffset()[1]=t[1],this.camera.control2D.getOffset()[2]=t[2],this.applyBounds(),this.camera.control2D.surface){var n=this.camera.control2D.surface.getProjections(e);n&&this.onRangeChanged(this.camera,n)}this.applyBounds();var i=(0,s.copy3)(this.camera.control2D.getOffset()),o=this.camera.control2D.animation;this.camera.control2D.setOffset(r),this.camera.control2D.animation=this.cameraImmediateAnimation,this.camera.control2D.setOffset(i),this.camera.control2D.animation=o}}),Object.defineProperty(t.prototype,"setRange",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this.getProjection(t),n=this.getViewScreenBounds(t),i=this.getView(t);if(r&&n&&i){var o=(0,s.subtract3)([n.width/e.width,n.height/e.height,1],this.camera.control2D.getScale());this.camera.control2D.setScale((0,s.add3)(this.camera.control2D.getScale(),this.scaleFilter(o,i,[i])));var a=(0,s.subtract3)([-e.x,-e.y,0],this.camera.control2D.offset);this.camera.control2D.setOffset((0,s.add3)(this.camera.control2D.offset,this.scaleFilter(a,i,[i]))),this.applyBounds(),this.onRangeChanged(this.camera,i.projection),this.applyBounds()}}}),Object.defineProperty(t.prototype,"setRangeChangeHandler",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.onRangeChanged=e}}),t}(a.SimpleEventHandler);t.BasicCamera2DController=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ReferenceCamera2D=void 0;var o=r(40),a=function(e){function t(t,r){var n=e.call(this,t)||this;return Object.defineProperty(n,"base",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"offsetFilter",{enumerable:!0,configurable:!0,writable:!0,value:function(e){return e}}),Object.defineProperty(n,"scaleFilter",{enumerable:!0,configurable:!0,writable:!0,value:function(e){return e}}),n.base=r.base,n.offsetFilter=r.offsetFilter||n.offsetFilter,n.scaleFilter=r.scaleFilter||n.scaleFilter,n}return i(t,e),Object.defineProperty(t.prototype,"offset",{get:function(){return this.offsetFilter(this.base.offset)},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.scaleFilter(this.base.scale)},set:function(e){},enumerable:!1,configurable:!0}),t}(r(41).Control2D),s=function(e){function t(t){var r=e.call(this)||this;return Object.defineProperty(r,"base",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),r.base=t.base,r._control2D=new a(r.base,{base:r.base.control2D,offsetFilter:t.offsetFilter,scaleFilter:t.scaleFilter}),r}return i(t,e),Object.defineProperty(t.prototype,"control2D",{get:function(){return this._control2D},set:function(e){},enumerable:!1,configurable:!0}),t}(o.Camera2D);t.ReferenceCamera2D=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.View2D=void 0;var o=r(7),a=r(2),s=r(13),u=r(16),c=r(40),l=r(186);function f(e){return e.projectionType===u.CameraProjectionType.ORTHOGRAPHIC}var d=function(e){function t(t,r){var n=e.call(this,t,r)||this;return Object.defineProperty(n,"projection",{enumerable:!0,configurable:!0,writable:!0,value:new l.Projection2D}),n.projection.camera=r.camera||new c.Camera2D,n}return i(t,e),Object.defineProperty(t.prototype,"fitViewtoViewport",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(f(this.props.camera)){var r=t.width,n=t.height,i={bottom:-n/2,far:1e7,left:-r/2,near:-100,right:r/2,top:n/2},s=1/this.pixelRatio,u=1/this.pixelRatio,c=this.props.camera;c.projectionOptions=Object.assign(c.projectionOptions,i),c.position=[t.width/(2*this.pixelRatio),t.height/(2*this.pixelRatio),c.position[2]],c.scale=[s,-u,1],c.lookAt((0,a.add3)(c.position,[0,0,-1]),[0,1,0]),c.update(),this.projection.viewBounds=t,t.d=this,this.projection.screenBounds=new o.Bounds({height:this.viewBounds.height/this.pixelRatio,width:this.viewBounds.width/this.pixelRatio,x:this.viewBounds.x/this.pixelRatio,y:this.viewBounds.y/this.pixelRatio}),this.screenBounds.d=this}else f(this.props.camera)||console.warn("View2D does not support non-orthographic cameras.")}}),Object.defineProperty(t.prototype,"willUpdateProps",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.projection.camera=e.camera}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{key:"",camera:new c.Camera2D,viewport:{left:0,right:0,bottom:0,top:0}}}),t}(s.View);t.View2D=d},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Projection2D=void 0;var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"camera",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t}return i(t,e),Object.defineProperty(t.prototype,"screenToWorld",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this.screenToView(e),n=t||[0,0];return n[0]=(r[0]-this.camera.control2D.offset[0]*this.camera.scale2D[0])/this.camera.scale2D[0],n[1]=(r[1]-this.camera.control2D.offset[1]*this.camera.scale2D[1])/this.camera.scale2D[1],n}}),Object.defineProperty(t.prototype,"screenRay",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.screenToWorld(e);return[[t[0],t[1],0],[t[0],t[1],-1]]}}),Object.defineProperty(t.prototype,"worldToScreen",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=[0,0];return r[0]=(e[0]*this.camera.scale2D[0]+this.camera.control2D.offset[0]*this.camera.scale2D[0])*this.pixelRatio,r[1]=(e[1]*this.camera.scale2D[1]+this.camera.control2D.offset[1]*this.camera.scale2D[1])*this.pixelRatio,this.viewToScreen(r,t)}}),Object.defineProperty(t.prototype,"viewToWorld",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=t||[0,0],n=e;return r[0]=(n[0]-this.camera.control2D.offset[0]*this.camera.scale2D[0])/this.camera.scale2D[0],r[1]=(n[1]-this.camera.control2D.offset[1]*this.camera.scale2D[1])/this.camera.scale2D[1],r}}),Object.defineProperty(t.prototype,"worldToView",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=t||[0,0];return r[0]=e[0]*this.camera.scale2D[0]+this.camera.control2D.offset[0]*this.camera.scale2D[0],r[1]=e[1]*this.camera.scale2D[1]+this.camera.control2D.offset[1]*this.camera.scale2D[1],r}}),t}(r(12).BaseProjection);t.Projection2D=o},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(188),t),i(r(194),t),i(r(201),t),i(r(210),t),i(r(217),t),i(r(233),t),i(r(237),t)},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(189),t),i(r(193),t)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ArcLayer=t.ArcScaleType=void 0;var o,a=r(4),s=r(1),u=r(0),c=r(3),l=r(6);!function(e){e[e.NONE=0]="NONE",e[e.SCREEN_CURVE=1]="SCREEN_CURVE"}(o=t.ArcScaleType||(t.ArcScaleType={}));var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var e,n,i=this.props.scaleType,a=this.props.animate||{},s=a.angle,c=a.angleOffset,l=a.center,f=a.radius,d=a.thickness,p=a.colorStart,h=a.colorEnd,b=((e={0:1})[302]=-1,e),g=((n={0:0})[302]=1,n),v=1,y=0;y<300;++y)b[y+1]=v,g[y+1]=Math.floor(y/2)/149,v*=-1;var m=i===o.NONE?r(190):r(191);return{fs:r(192),instanceAttributes:[{easing:l,name:t.attributeNames.center,size:u.InstanceAttributeSize.TWO,update:function(e){return e.center}},{easing:f,name:t.attributeNames.radius,size:u.InstanceAttributeSize.ONE,update:function(e){return[e.radius]}},{name:t.attributeNames.depth,size:u.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{easing:d,name:t.attributeNames.thickness,size:u.InstanceAttributeSize.TWO,update:function(e){return e.thickness}},{easing:s,name:t.attributeNames.angle,size:u.InstanceAttributeSize.TWO,update:function(e){return e.angle}},{easing:c,name:t.attributeNames.angleOffset,size:u.InstanceAttributeSize.ONE,update:function(e){return[e.angleOffset]}},{easing:p,name:t.attributeNames.colorStart,size:u.InstanceAttributeSize.FOUR,update:function(e){return e.colorStart}},{easing:h,name:t.attributeNames.colorEnd,size:u.InstanceAttributeSize.FOUR,update:function(e){return e.colorEnd}}],uniforms:[{name:"scaleFactor",size:u.UniformSize.ONE,update:function(e){return[1]}}],vertexAttributes:[{name:"vertex",size:u.VertexAttributeSize.THREE,update:function(e){return[b[e],g[e],300]}}],vertexCount:302,vs:m}}}),Object.defineProperty(t.prototype,"getMaterialOptions",{enumerable:!1,configurable:!0,writable:!0,value:function(){return Object.assign({},c.CommonMaterialOptions.transparentShapeBlending,{culling:a.GLSettings.Material.CullSide.NONE})}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{data:new s.InstanceProvider,key:"",scaleType:o.NONE}}),Object.defineProperty(t,"attributeNames",{enumerable:!0,configurable:!0,writable:!0,value:{angle:"angle",angleOffset:"angleOffset",center:"center",colorEnd:"colorEnd",colorStart:"colorStart",depth:"depth",radius:"radius",thickness:"thickness"}}),t}(l.Layer2D);t.ArcLayer=f},function(e,t){e.exports="${import: arc}\nprecision highp float;\nvarying vec4 vertexColor;\nvoid main() {\nfloat startAngle = angle.x + angleOffset;\nfloat endAngle = angle.y + angleOffset;\nfloat widthStart = thickness.x;\nfloat widthEnd = thickness.y;\nfloat normal = vertex.x;\nfloat interpolationTime = vertex.y;\nfloat interpolationIncrement = 1.0 / vertex.z;\nvec2 currentPosition = arc(interpolationTime, center, radius, startAngle, endAngle);\nvec2 currentNormal = normalize(currentPosition - center);\nfloat lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;\nvec2 vertex = currentPosition + currentNormal * (normal * lineThickness);\nvertexColor = mix(colorStart, colorEnd, interpolationTime);\ngl_Position = clipSpace(vec3(vertex, depth));\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvec2 interpolation(float t, vec2 center, float radius, float start, float end) {\nfloat angle = (end - start) * t + start;\nreturn center + vec2(cos(angle) * radius, sin(angle) * radius);\n}\nvoid main() {\nfloat startAngle = angle.x;\nfloat endAngle = angle.y;\nfloat widthStart = thickness.x;\nfloat widthEnd = thickness.y;\nvec4 centerClip = clipSpace(vec3(center, depth));\nvec2 centerScreen = (centerClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nfloat normal = position.x;\nfloat interpolationTime = position.y;\nfloat interpolationIncrement = 1.0 / position.z;\nvec2 currentPosition = interpolation(interpolationTime, centerScreen, radius, startAngle, endAngle);\nvec2 currentNormal = normalize(currentPosition - centerScreen);\nfloat lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;\nvec2 vertex = currentPosition + currentNormal * (normal * lineThickness);\nvertexColor = mix(colorStart, colorEnd, interpolationTime);\nvertexColor *= vertexColor.a;\ngl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), centerClip.zw);\ngl_PointSize = 5.0;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\ngl_FragColor = vertexColor;\n}"},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ArcInstance=void 0;var a=r(1),s=function(e){function t(r){var n=e.call(this,r)||this;return Object.defineProperty(n,"angle",{enumerable:!0,configurable:!0,writable:!0,value:[0,Math.PI]}),Object.defineProperty(n,"colorEnd",{enumerable:!0,configurable:!0,writable:!0,value:[1,1,1,1]}),Object.defineProperty(n,"colorStart",{enumerable:!0,configurable:!0,writable:!0,value:[1,1,1,1]}),Object.defineProperty(n,"center",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(n,"depth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"angleOffset",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"radius",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(n,"thickness",{enumerable:!0,configurable:!0,writable:!0,value:[5,5]}),(0,a.makeObservable)(n,t),n.angle=r.angle||n.angle,n.colorEnd=r.colorEnd||n.colorEnd,n.colorStart=r.colorStart||n.colorStart,n.center=r.center||n.center,n.depth=r.depth||n.depth,n.radius=r.radius||n.radius,n.thickness=r.thickness||n.thickness,n}return i(t,e),o([a.observable],t.prototype,"angle",void 0),o([a.observable],t.prototype,"colorEnd",void 0),o([a.observable],t.prototype,"colorStart",void 0),o([a.observable],t.prototype,"center",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"angleOffset",void 0),o([a.observable],t.prototype,"radius",void 0),o([a.observable],t.prototype,"thickness",void 0),t}(r(11).Instance);t.ArcInstance=s},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(195),t),i(r(200),t)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.CircleLayer=void 0;var o=r(4),a=r(1),s=r(0),u=r(3),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.props,n=e.animate,i=void 0===n?{}:n,a=e.usePoints,u=void 0!==a&&a,c=e.opacity,l=void 0===c?function(){return 1}:c,f=i.center,d=i.radius,p=i.color,h={0:1,1:1,2:-1,3:1,4:-1,5:-1},b={0:-1,1:-1,2:-1,3:1,4:1,5:1},g=[{name:"normals",size:s.VertexAttributeSize.TWO,update:function(e){return[h[e],b[e]]}}];return{drawMode:u?o.GLSettings.Model.DrawMode.POINTS:o.GLSettings.Model.DrawMode.TRIANGLE_STRIP,fs:u?[{outputType:s.FragmentOutputType.COLOR,source:r(196)},{outputType:s.FragmentOutputType.GLOW,source:"\n              void main() {\n                ${out: glow} = color;\n              }\n              "}]:[{outputType:s.FragmentOutputType.COLOR,source:r(197)},{outputType:s.FragmentOutputType.GLOW,source:"\n              void main() {\n                ${out: glow} = color;\n              }\n              "}],instanceAttributes:[{easing:f,name:t.attributeNames.center,size:s.InstanceAttributeSize.TWO,update:function(e){return e.center}},{easing:d,name:t.attributeNames.radius,size:s.InstanceAttributeSize.ONE,update:function(e){return[e.radius]}},{name:t.attributeNames.depth,size:s.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{easing:p,name:t.attributeNames.color,size:s.InstanceAttributeSize.FOUR,update:function(e){return e.color}}],uniforms:[{name:"layerOpacity",size:s.UniformSize.ONE,update:function(e){return[l()]}}],vertexAttributes:u?void 0:g,vertexCount:u?0:6,vs:r(u?198:199)}}}),Object.defineProperty(t.prototype,"getMaterialOptions",{enumerable:!1,configurable:!0,writable:!0,value:function(){return u.CommonMaterialOptions.transparentShapeBlending}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{data:new a.InstanceProvider,key:""}}),Object.defineProperty(t,"attributeNames",{enumerable:!0,configurable:!0,writable:!0,value:{center:"center",color:"color",depth:"depth",radius:"radius"}}),t}(r(6).Layer2D);t.CircleLayer=c},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nfloat circle(vec2 coord, float radius){\nvec2 dist = coord - vec2(0.5);\nreturn 1.0 - smoothstep(\nradius - (radius * edgeSharpness),\nradius + (radius * edgeSharpnessBase),\ndot(dist, dist) * 4.0\n);\n}\nvoid main() {\nfloat step_factor = circle(gl_PointCoord, 1.0);\n${out: color} = mix(\nvec4(0.0, 0.0, 0.0, 0.0),\nvertexColor,\nstep_factor\n);\nif (color.a == 0.0) discard;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nvarying vec2 pointCoord;\nfloat circle(vec2 coord, float radius){\nvec2 dist = coord - vec2(0.5);\nreturn 1.0 - smoothstep(\nradius - (radius * edgeSharpness),\nradius + (radius * edgeSharpnessBase),\ndot(dist, dist) * 4.0\n);\n}\nvoid main() {\nfloat step_factor = circle(pointCoord, 1.0);\n${out: color} = mix(\nvec4(0.0, 0.0, 0.0, 0.0),\nvertexColor,\nstep_factor\n);\nif (color.a == 0.0) discard;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nvoid main() {\nvertexColor = color;\nvertexColor.a *= layerOpacity;\nfloat size = radius * cameraScale2D.x;\nedgeSharpness = mix(0.8, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\nedgeSharpnessBase = mix(0.1, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\ngl_Position = clipSpace(vec3(center, depth));\ngl_PointSize = size * 2.0 * pixelRatio;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nvarying vec2 pointCoord;\nvoid main() {\nvertexColor = color;\nvertexColor.a *= layerOpacity;\nfloat size = radius * cameraScale2D.x * pixelRatio;\nedgeSharpness = mix(0.8, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\nedgeSharpnessBase = mix(0.1, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\npointCoord = (normals.xy + vec2(1.0, 1.0)) / 2.0;\nvec4 clipCenter = clipSpace(vec3(center, depth));\nvec2 screenCenter = (clipCenter.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nvec2 vertex = (normals.xy * size) + screenCenter;\ngl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), clipCenter.zw);\n}"},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.CircleInstance=void 0;var a=r(1),s=function(e){function t(r){var n=e.call(this,r)||this;return Object.defineProperty(n,"color",{enumerable:!0,configurable:!0,writable:!0,value:[1,1,1,1]}),Object.defineProperty(n,"depth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"radius",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"center",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),(0,a.makeObservable)(n,t),n.color=r.color||n.color,n.radius=r.radius||n.radius,n.center=r.center||n.center,n.depth=r.depth||n.depth,n}return i(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return 2*this.radius},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return 2*this.radius},enumerable:!1,configurable:!0}),o([a.observable],t.prototype,"color",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"radius",void 0),o([a.observable],t.prototype,"center",void 0),t}(r(11).Instance);t.CircleInstance=s},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(202),t),i(r(209),t),i(r(115),t)},function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeLayer=void 0;var a=r(1),s=r(0),u=r(3),c=r(6),l=r(115);var f=((i={})[l.EdgeType.LINE]=r(203),i[l.EdgeType.BEZIER]=r(204),i[l.EdgeType.BEZIER2]=r(205),i),d=r(206),p=r(207),h=r(208),b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var e,r,n=this,i=this.props,o=i.animate,a=void 0===o?{}:o,c=i.scaleFactor,b=void 0===c?function(){return 1}:c,g=i.type,v=i.scaleType,y=void 0===v?l.EdgeScaleType.NONE:v,m=a.end,w=a.start,O=a.startColor,_=a.endColor,T=a.control,P=a.thickness,x=g===l.EdgeType.LINE?2:50,E=((e={0:1})[2*x+2]=-1,e),j=((r={0:0})[2*x+2]=1,r),S=1,R=0;R<2*x;++R)E[R+1]=S,j[R+1]=Math.floor(R/2)/(x-1),S*=-1;var M={interpolation:f[g]},A=(0,u.shaderTemplate)({options:M,required:{name:"Edge Layer",values:["interpolation"]},shader:y===l.EdgeScaleType.NONE?d:p,onToken:function(e,t){return e in M?t:"${".concat(e,"}")}});return{fs:h,instanceAttributes:[{easing:O,name:t.attributeNames.startColor,size:s.InstanceAttributeSize.FOUR,update:function(e){return e.startColor}},{easing:_,name:t.attributeNames.endColor,size:s.InstanceAttributeSize.FOUR,update:function(e){return e.endColor}},{easing:w,name:t.attributeNames.start,size:s.InstanceAttributeSize.TWO,update:function(e){return e.start}},{easing:m,name:t.attributeNames.end,size:s.InstanceAttributeSize.TWO,update:function(e){return e.end}},{easing:P,name:t.attributeNames.thickness,size:s.InstanceAttributeSize.TWO,update:function(e){return e.thickness}},{name:t.attributeNames.depth,size:s.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},g===l.EdgeType.LINE?{easing:T,name:t.attributeNames.control,size:s.InstanceAttributeSize.FOUR,update:function(e){return[0,0,0,0]}}:null,g===l.EdgeType.BEZIER?{easing:T,name:t.attributeNames.control,size:s.InstanceAttributeSize.FOUR,update:function(e){return[e.control[0][0],e.control[0][1],0,0]}}:null,g===l.EdgeType.BEZIER2?{easing:T,name:t.attributeNames.control,size:s.InstanceAttributeSize.FOUR,update:function(e){return function(e){return[e[0][0],e[0][1],e[1][0],e[1][1]]}(e.control)}}:null],uniforms:[{name:"scaleFactor",size:s.UniformSize.ONE,update:function(e){return[b()]}},{name:"layerOpacity",size:s.UniformSize.ONE,update:function(e){return[void 0===n.props.opacity?1:n.props.opacity]}}],vertexAttributes:[{name:"vertex",size:s.VertexAttributeSize.THREE,update:function(e){return[E[e],j[e],2*x]}}],vertexCount:2*x+2,vs:A.shader}}}),Object.defineProperty(t.prototype,"getMaterialOptions",{enumerable:!1,configurable:!0,writable:!0,value:function(){return u.CommonMaterialOptions.transparentShapeBlending}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{broadphase:l.EdgeBroadphase.ALL,data:new a.InstanceProvider,key:"none",scaleType:l.EdgeScaleType.NONE,type:l.EdgeType.LINE}}),Object.defineProperty(t,"attributeNames",{enumerable:!0,configurable:!0,writable:!0,value:{control:"control",depth:"depth",end:"end",endColor:"endColor",start:"start",startColor:"startColor",thickness:"thickness"}}),t}(c.Layer2D);t.EdgeLayer=b},function(e,t){e.exports="vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\nreturn p1 + (p2 - p1) * t;\n}"},function(e,t){e.exports="vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\nreturn (1.0 - t) * (1.0 - t) * p1 + 2.0 * t * (1.0 - t) * c1 + t * t * p2;\n}"},function(e,t){e.exports="vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\nfloat t1 = 1.0 - t;\nreturn pow(t1, 3.0) * p1 + 3.0 * t * pow(t1, 2.0) * c1 + 3.0 * pow(t, 2.0) * t1 * c2 + pow(t, 3.0) * p2;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\n${interpolation}\nvoid main() {\nfloat normal = vertex.x;\nfloat interpolationTime = vertex.y;\nfloat interpolationIncrement = 1.0 / vertex.z;\nvec2 currentPosition = interpolation(interpolationTime, start, end, control.xy, control.zw);\nvec2 prePosition = interpolation(interpolationTime - interpolationIncrement, start, end, control.xy, control.zw);\nvec2 nextPosition = interpolation(interpolationTime + interpolationIncrement, start, end, control.xy, control.zw);\nvec2 preLine = prePosition - currentPosition;\nvec2 nextLine = nextPosition - currentPosition;\nvec2 currentNormal = mix(\nnormalize(vec2(preLine.y, -preLine.x)),\nmix(\nnormalize(vec2(preLine.y, -preLine.x) + vec2(-nextLine.y, nextLine.x)),\nnormalize(vec2(-nextLine.y, nextLine.x)),\nfloat(vertex.x >= 1.0)\n),\nfloat(vertex.x > 0.0)\n);\nfloat lineThickness = mix(thickness.x, thickness.y, interpolationTime) / 2.0;\nvec2 vertexPos = currentPosition + currentNormal * (normal * lineThickness);\nvertexColor = mix(startColor, endColor, interpolationTime);\ngl_Position = clipSpace(vec3(vertexPos, depth));\ngl_PointSize = 5.0;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\n${interpolation}\nvoid main() {\nfloat normal = vertex.x;\nfloat interpolationTime = vertex.y;\nfloat interpolationIncrement = 1.0 / vertex.z;\nvec4 startClip = clipSpace(vec3(start, depth));\nvec4 endClip = clipSpace(vec3(end, depth));\nvec2 startScreen = (startClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nvec2 endScreen = (endClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nvec2 control1 = startScreen + vec2(control.x, -control.y) * scaleFactor;\nvec2 control2 = endScreen + vec2(control.z, -control.w) * scaleFactor;\nvec2 currentPosition = interpolation(interpolationTime, startScreen, endScreen, control1, control2);\nvec2 prePosition = interpolation(interpolationTime - interpolationIncrement, startScreen, endScreen, control1, control2);\nvec2 nextPosition = interpolation(interpolationTime + interpolationIncrement, startScreen, endScreen, control1, control2);\nvec2 preLine = prePosition - currentPosition;\nvec2 nextLine = nextPosition - currentPosition;\nvec2 currentNormal = mix(\nnormalize(vec2(preLine.y, -preLine.x)),\nmix(\nnormalize(vec2(preLine.y, -preLine.x) + vec2(-nextLine.y, nextLine.x)),\nnormalize(vec2(-nextLine.y, nextLine.x)),\nfloat(vertex.x >= 1.0)\n),\nfloat(vertex.x > 0.0)\n);\nfloat lineThickness = mix(thickness.x, thickness.y, interpolationTime) / 2.0;\nvec2 vertexPos = currentPosition + currentNormal * (-normal * lineThickness * scaleFactor);\nvertexColor = mix(startColor, endColor, interpolationTime);\ngl_Position = vec4((vertexPos / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), startClip.zw);\ngl_PointSize = 5.0;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\ngl_FragColor = vertexColor;\n}"},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeInstance=void 0;var a=r(11),s=r(20),u=r(12),c=function(e){function t(r){var n=e.call(this,r)||this;return Object.defineProperty(n,"control",{enumerable:!0,configurable:!0,writable:!0,value:[[0,0],[0,0]]}),Object.defineProperty(n,"depth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"end",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(n,"endColor",{enumerable:!0,configurable:!0,writable:!0,value:[1,1,1,1]}),Object.defineProperty(n,"start",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(n,"startColor",{enumerable:!0,configurable:!0,writable:!0,value:[1,1,1,1]}),Object.defineProperty(n,"thickness",{enumerable:!0,configurable:!0,writable:!0,value:[1,1]}),(0,s.makeObservable)(n,t),n.startColor=r.startColor||n.startColor,n.endColor=r.endColor||n.endColor,n.control=r.control||n.control,n.depth=r.depth||n.depth,n.end=r.end||n.end,n.thickness=r.thickness||n.thickness,n.start=r.start||n.start,n}return i(t,e),Object.defineProperty(t.prototype,"length",{get:function(){var e=[this.end[0]-this.start[0],this.end[1]-this.start[1]];return Math.sqrt(e[0]*e[0]+e[1]*e[1])},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"midpoint",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"perpendicular",{get:function(){var e=this.length;return[(this.end[1]-this.start[1])/e,-(this.end[0]-this.start[0])/e]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"setEdgeThickness",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.thickness=[e,e]}}),Object.defineProperty(t.prototype,"setColor",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.startColor=(0,u.copy4)(e),this.endColor=(0,u.copy4)(e)}}),o([s.observable],t.prototype,"control",void 0),o([s.observable],t.prototype,"depth",void 0),o([s.observable],t.prototype,"end",void 0),o([s.observable],t.prototype,"endColor",void 0),o([s.observable],t.prototype,"start",void 0),o([s.observable],t.prototype,"startColor",void 0),o([s.observable],t.prototype,"thickness",void 0),t}(a.Instance);t.EdgeInstance=c},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(211),t),i(r(216),t)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageLayer=t.isVideoResource=void 0;var a=r(1),s=r(23),u=r(0),c=r(3),l=r(29),f=r(6),d=r(212),p=r(213);function h(e){return e&&e.videoSrc}t.isVideoResource=h;var b=new Image;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"childProvider",{enumerable:!0,configurable:!0,writable:!0,value:new a.InstanceProvider}),Object.defineProperty(t,"imageToResource",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"propertyIds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"sourceToRequest",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"sourceToVideo",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"usingVideo",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"waitingForVideo",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"waitForVideoSource",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"originalOnReadyCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),t}return i(t,e),Object.defineProperty(t.prototype,"childLayers",{enumerable:!1,configurable:!0,writable:!0,value:function(){return[(0,c.createLayer)(p.ImageRenderLayer,o(o({},this.props),{key:"".concat(this.props.key,".image-render-layer")}))]}}),Object.defineProperty(t.prototype,"destroy",{enumerable:!1,configurable:!0,writable:!0,value:function(){var t=this;e.prototype.destroy.call(this),this.sourceToVideo.forEach((function(e){e.pause(),t.sourceToVideo.clear(),t.waitingForVideo.clear(),t.waitForVideoSource.clear()}))}}),Object.defineProperty(t.prototype,"draw",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.resolveChanges(!0);if(this.updateAnimationState(),!(e.length<=0)){this.propertyIds||(this.propertyIds=this.getInstanceObservableIds(e[0][0],["source"]));for(var t=this.propertyIds.source,r=0,n=e.length;r<n;++r){var i=e[r],o=i[0],a=i[1],l=i[2];switch(a){case u.InstanceDiffType.CHANGE:if(void 0!==l[t]){var f=this.imageToResource.get(o),d=this.getAtlasSource(o);if(d===f)break;if(f instanceof HTMLVideoElement){if(v=this.waitForVideoSource.get(o))this.waitForVideoSource.delete(o),(y=this.waitingForVideo.get(v))&&y.delete(o);(m=this.usingVideo.get(f.getAttribute("data-source")||""))||(m=new Set),m.delete(o),m.size<=0&&this.sourceToVideo.delete(f.getAttribute("data-source")||""),o.onReady=this.originalOnReadyCallbacks.get(o)}if(h(o.source))this.prepareVideo(o,o.source),d=this.getAtlasSource(o),(0,c.mapInjectDefault)(this.usingVideo,o.source.videoSrc,new Set).add(o);if(this.imageToResource.set(o,d),this.resource.request(this,o,(0,s.atlasRequest)({key:this.props.atlas||"",disposeResource:!0,source:f})),d)(!(p=this.sourceToRequest.get(d))||p.texture&&!p.texture.isValid)&&(p=(0,s.atlasRequest)({key:this.props.atlas||"",source:d,rasterizationScale:this.props.rasterizationScale}),this.sourceToRequest.set(d,p)),o.request=p,this.resource.request(this,o,p)}break;case u.InstanceDiffType.INSERT:if(o.source){var p,b=this.getAtlasSource(o);if(h(o.source))this.prepareVideo(o,o.source),b=this.getAtlasSource(o),(0,c.mapInjectDefault)(this.usingVideo,o.source.videoSrc,new Set).add(o);(!(p=this.sourceToRequest.get(b))||p.texture&&!p.texture.isValid)&&(p=(0,s.atlasRequest)({key:this.props.atlas||"",source:b,rasterizationScale:this.props.rasterizationScale}),this.sourceToRequest.set(b,p)),o.request=p}break;case u.InstanceDiffType.REMOVE:var g=this.getAtlasSource(o);if(this.imageToResource.delete(o),h(o.source)){var v,y,m;if(v=this.waitForVideoSource.get(o))this.waitForVideoSource.delete(o),(y=this.waitingForVideo.get(v))&&y.delete(o);(m=this.usingVideo.get(o.source.videoSrc))||(m=new Set),m.delete(o),m.size<=0&&this.sourceToVideo.delete(o.source.videoSrc),this.originalOnReadyCallbacks.delete(o)}this.resource.request(this,o,(0,s.atlasRequest)({key:this.props.atlas||"",disposeResource:!0,source:g}))}}var w=[];this.usingVideo.forEach((function(e,t){e.size<=0&&w.push(t)}));for(r=0,n=w.length;r<n;++r){var O=w[r];this.usingVideo.delete(O),this.sourceToVideo.delete(O)}}}}),Object.defineProperty(t.prototype,"getAtlasSource",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return h(e.source)?this.sourceToVideo.get(e.source.videoSrc)||b:e.source}}),Object.defineProperty(t.prototype,"prepareVideo",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var r=this,n=this.sourceToVideo.get(t.videoSrc);if(this.originalOnReadyCallbacks.get(e)||this.originalOnReadyCallbacks.set(e,e.onReady),n){var i=this.waitingForVideo.get(t.videoSrc);if(i)i.add(e),this.waitForVideoSource.set(e,t.videoSrc),e.onReady=void 0,e.source=b,e.videoLoad=function(){n.load(),t.autoPlay&&n.play()};else{var o=this.originalOnReadyCallbacks.get(e)||e.onReady;if(!o)return;e.onReady=function(e){o(e,n)}}}else{var a=document.createElement("video");this.sourceToVideo.set(t.videoSrc,a),a.setAttribute("data-source",t.videoSrc),(0,d.debugVideoEvents)(a);var s=new l.PromiseResolver,u=new l.PromiseResolver,f=function(){a.removeEventListener("loadedmetadata",h),a.removeEventListener("loadeddata",p),a.removeEventListener("error",g),r.waitingForVideo.delete(t.videoSrc),r.waitForVideoSource.delete(e)},p=function(){u.resolve()},h=function(){s.resolve()},g=function(e){var t;e.path&&e.path[0]&&(t=e.path[0].error),e.originalTarget&&(t=e.originalTarget.error),console.warn("There was an error loading the video resource to the atlas texture context"),console.warn(t),s.reject({}),u.reject({})};a.addEventListener("loadedmetadata",h),a.addEventListener("loadeddata",p),a.addEventListener("error",g),e.onReady=void 0,(0,c.mapInjectDefault)(this.waitingForVideo,t.videoSrc,new Set).add(e),this.waitForVideoSource.set(e,t.videoSrc),e.source=b,e.videoLoad=function(){a.load(),t.autoPlay&&a.play()},a.muted=!0,a.src=t.videoSrc,Promise.all([s.promise,u.promise]).then((function(){a.currentTime=0,t.autoPlay&&a.play();var e=r.waitingForVideo.get(t.videoSrc);e&&e.forEach((function(e){e.source=t,e.onReady=r.originalOnReadyCallbacks.get(e)})),f()})).catch((function(){f()}))}}}),Object.defineProperty(t.prototype,"updateAnimationState",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=!1;this.sourceToVideo.forEach((function(t){t.paused||(e=!0)})),this.isAnimationContinuous=this.usingVideo.size>0&&e}}),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){return null}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{atlas:"default",key:"",data:new a.InstanceProvider}}),t}(f.Layer2D);t.ImageLayer=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debugVideoEvents=void 0;var n=r(5)("video");t.debugVideoEvents=function(e){n.enabled&&(e.addEventListener("abort",(function(){return n("abort")})),e.addEventListener("canplay",(function(){return n("canplay")})),e.addEventListener("canplaythrough",(function(){return n("canplaythrough")})),e.addEventListener("durationchange",(function(){return n("durationchange")})),e.addEventListener("emptied",(function(){return n("emptied")})),e.addEventListener("ended",(function(){return n("ended")})),e.addEventListener("error",(function(){return n("error")})),e.addEventListener("loadeddata",(function(){return n("loadeddata")})),e.addEventListener("loadedmetadata",(function(){return n("loadedmetadata")})),e.addEventListener("loadstart",(function(){return n("loadstart")})),e.addEventListener("pause",(function(){return n("pause")})),e.addEventListener("play",(function(){return n("play")})),e.addEventListener("playing",(function(){return n("playing")})),e.addEventListener("progress",(function(){return n("progress")})),e.addEventListener("ratechange",(function(){return n("ratechange")})),e.addEventListener("seeked",(function(){return n("seeked")})),e.addEventListener("seeking",(function(){return n("seeking")})),e.addEventListener("stalled",(function(){return n("stalled")})),e.addEventListener("suspend",(function(){return n("suspend")})),e.addEventListener("timeupdate",(function(){return n("timeupdate")})),e.addEventListener("volumechange",(function(){return n("volumechange")})),e.addEventListener("waiting",(function(){return n("waiting")})))}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ImageRenderLayer=void 0;var o=r(1),a=r(0),s=r(62),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,n=this.props.animate||{},i=n.tint,o=n.location,s=n.size,u={0:1,1:1,2:-1,3:1,4:-1,5:-1},c={0:0,1:0,2:0,3:1,4:1,5:1};return{fs:r(214),instanceAttributes:[{easing:o,name:t.attributeNames.location,size:a.InstanceAttributeSize.TWO,update:function(e){return e.origin}},{name:t.attributeNames.anchor,size:a.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x||0,e.anchor.y||0]}},{easing:s,name:t.attributeNames.size,size:a.InstanceAttributeSize.TWO,update:function(e){return[e.width,e.height]}},{name:t.attributeNames.depth,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:t.attributeNames.scaling,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{name:t.attributeNames.texture,resource:{key:function(){return e.props.atlas||""},name:"imageAtlas"},update:function(t){return t.source,t.request?e.resource.request(e,t,t.request):(console.warn("An image utilizing the image-render-layer does not have its request specified yet.","The image-render-layer does NOT manage requests and should be handled before this layer deals with the instance"),[0,0,0,0])}},{easing:i,name:t.attributeNames.tint,size:a.InstanceAttributeSize.FOUR,update:function(e){return e.tint}}],uniforms:[{name:"scaleFactor",size:a.UniformSize.ONE,update:function(e){return[1]}}],vertexAttributes:[{name:"normals",size:a.VertexAttributeSize.TWO,update:function(e){return[u[e],c[e]]}}],vertexCount:6,vs:r(215)}}}),Object.defineProperty(t.prototype,"getMaterialOptions",{enumerable:!1,configurable:!0,writable:!0,value:function(){return s.CommonMaterialOptions.transparentImageBlending}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{key:"",data:new o.InstanceProvider}}),Object.defineProperty(t,"attributeNames",{enumerable:!0,configurable:!0,writable:!0,value:{location:"location",anchor:"anchor",size:"size",depth:"depth",scaling:"scaling",texture:"texture",tint:"tint"}}),t}(r(6).Layer2D);t.ImageRenderLayer=u},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\ngl_FragColor = texture2D(imageAtlas, texCoord) * vertexColor;\ngl_FragColor = gl_FragColor * gl_FragColor.a;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec3 screenSize = cameraSpaceSize(vec3(size, 1.0));\nbool largerOnScreen = screenSize.y > size.y;\nfloat useScaleMode = float(\n(\nscaling == 3.0 ||\n(largerOnScreen && scaling == 2.0)\n) &&\nscaling != 1.0\n);\nfloat unequalZooms = float(cameraScale2D.x != cameraScale2D.y);\nfloat normal = normals.x;\nfloat side = normals.y;\nvec2 worldAnchor = location + anchor;\ntexCoord = texture.xy + ((texture.zw - texture.xy) * vec2(side, float(normal == -1.0)));\nvertexColor = tint;\nvec2 adjustedSize = mix(\nsize,\n(size * cameraScale2D.yx),\nunequalZooms\n);\nvec2 adjustedAnchor = mix(\nanchor,\n(anchor * cameraScale2D.yx),\nunequalZooms\n);\nvec2 vertex = vec2(side, float(normal == 1.0)) * adjustedSize + location - adjustedAnchor;\nfloat imageScreenScale = mix(\nscreenSize.y / adjustedSize.y,\nscreenSize.x / adjustedSize.x,\nfloat((cameraScale2D.x < 1.0) || (cameraScale2D.x > 1.0))\n);\nvec2 anchorToVertex = vertex - location;\nvertex = mix(\nvertex,\n(anchorToVertex / imageScreenScale) + location,\nuseScaleMode\n);\ngl_Position = clipSpace(vec3(vertex, depth));\n}"},function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageInstance=void 0;var s=r(1),u=r(11),c=r(0),l=r(19),f=Math.max,d=((i={})[l.AnchorType.TopLeft]=function(e,t){e.x=-e.padding,e.y=-e.padding},i[l.AnchorType.TopMiddle]=function(e,t){e.x=t.width/2,e.y=-e.padding},i[l.AnchorType.TopRight]=function(e,t){e.x=t.width+e.padding,e.y=-e.padding},i[l.AnchorType.MiddleLeft]=function(e,t){e.x=-e.padding,e.y=t.height/2},i[l.AnchorType.Middle]=function(e,t){e.x=t.width/2,e.y=t.height/2},i[l.AnchorType.MiddleRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height/2},i[l.AnchorType.BottomLeft]=function(e,t){e.x=-e.padding,e.y=t.height+e.padding},i[l.AnchorType.BottomMiddle]=function(e,t){e.x=t.width/2,e.y=t.height+e.padding},i[l.AnchorType.BottomRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height+e.padding},i[l.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},i),p=function(e){function t(r){var n=e.call(this,r)||this;return Object.defineProperty(n,"tint",{enumerable:!0,configurable:!0,writable:!0,value:[0,0,0,1]}),Object.defineProperty(n,"depth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"height",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(n,"origin",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(n,"scaling",{enumerable:!0,configurable:!0,writable:!0,value:l.ScaleMode.BOUND_MAX}),Object.defineProperty(n,"source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"width",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(n,"onError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"onReady",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(n,"sourceWidth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"sourceHeight",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"_anchor",{enumerable:!0,configurable:!0,writable:!0,value:{padding:0,type:l.AnchorType.TopLeft,x:0,y:0}}),Object.defineProperty(n,"videoLoad",{enumerable:!0,configurable:!0,writable:!0,value:c.NOOP}),(0,s.makeObservable)(n,t),n.depth=r.depth||n.depth,n.tint=r.tint||n.tint,n.scaling=r.scaling||n.scaling,n.origin=r.origin||n.origin,n.width=r.width||1,n.height=r.height||1,n.source=r.source,n.onReady=r.onReady,r.anchor&&n.setAnchor(r.anchor),n}return o(t,e),Object.defineProperty(t.prototype,"maxSize",{get:function(){return f(this.width,this.height)},set:function(e){var t=this.width/this.height;this.width=e*t,this.height=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resourceTrigger",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.source=this.source,this.request&&this.request.texture&&(this.sourceWidth=this.request.texture.pixelWidth,this.sourceHeight=this.request.texture.pixelHeight),this.onReady&&this.onReady(this)}}),Object.defineProperty(t.prototype,"setAnchor",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t={padding:e.padding||0,type:e.type,x:e.x||0,y:e.y||0};d[t.type](t,this),this._anchor=t}}),a([s.observable],t.prototype,"tint",void 0),a([s.observable],t.prototype,"depth",void 0),a([s.observable],t.prototype,"height",void 0),a([s.observable],t.prototype,"origin",void 0),a([s.observable],t.prototype,"scaling",void 0),a([s.observable],t.prototype,"source",void 0),a([s.observable],t.prototype,"width",void 0),a([s.observable],t.prototype,"_anchor",void 0),t}(u.Instance);t.ImageInstance=p},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(116),t),i(r(65),t),i(r(117),t),i(r(118),t),i(r(121),t),i(r(228),t)},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\ngl_FragColor = texColor * vertexColor;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\ngl_FragColor = texColor * vertexColor;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 scale = fontScale * cameraScale2D.xy;\nfloat scaleBy = max(scale.x, scale.y) / maxScale;\nvec2 pushOut = normals * glyphSize * fontScale;\nfloat vx = mix(\n(origin.x + padding.x + offset.x + pushOut.x),\norigin.x + anchor.x + (padding.x - anchor.x + offset.x + pushOut.x) / scaleBy,\nfloat(scale.x >= maxScale)\n);\nfloat vy = mix(\n(origin.y + padding.y + offset.y + pushOut.y),\norigin.y + anchor.y + (padding.y - anchor.y + offset.y + pushOut.y) / scaleBy,\nfloat(scale.y >= maxScale)\n);\nvec3 position = vec3(vec2(vx, vy), depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 scale = fontScale * cameraScale2D.xy;\nfloat scaleBy = max(scale.x, scale.y) / maxScale;\nvec2 pushOut = normals * glyphSize * fontScale;\nfloat vx = mix(\n(-anchor.x + offset.x + pushOut.x),\n(-anchor.x + offset.x + pushOut.x) / scaleBy,\nfloat(scale.x >= maxScale)\n);\nfloat vy = mix(\n(-anchor.y + offset.y + pushOut.y),\n(-anchor.y + offset.y + pushOut.y) / scaleBy,\nfloat(scale.y >= maxScale)\n);\nvec3 position = vec3(origin + padding + vec2(vx, vy), depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\ngl_FragColor = texColor * vertexColor;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\ngl_FragColor = texColor * vertexColor;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 pushOut = normals * glyphSize * fontScale;\nvec3 position = vec3(origin + anchor + (padding - anchor + offset + pushOut) / cameraScale2D.xy , depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 pushOut = normals * glyphSize * fontScale;\nvec3 position = vec3(origin + padding + (-anchor + offset + pushOut) / cameraScale2D.xy, depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\ngl_FragColor = texColor * vertexColor;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 pushOut = normals * glyphSize * fontScale;\nvec3 position = vec3(origin + padding + offset + pushOut, depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.TextAreaLayer=void 0;var a=r(35),s=r(2),u=r(23),c=r(0),l=r(18),f=r(19),d=r(6),p=r(229),h=r(230),b=r(65),g=r(116),v=r(121),y=((i={})[f.AnchorType.TopLeft]=function(e){return[0,0]},i[f.AnchorType.TopMiddle]=function(e){return[e.maxWidth/2,0]},i[f.AnchorType.TopRight]=function(e){return[e.maxWidth,0]},i[f.AnchorType.MiddleLeft]=function(e){return[0,e.maxHeight/2]},i[f.AnchorType.Middle]=function(e){return[e.maxWidth/2,e.maxHeight/2]},i[f.AnchorType.MiddleRight]=function(e){return[e.maxWidth,e.maxHeight/2]},i[f.AnchorType.BottomLeft]=function(e){return[0,e.maxHeight]},i[f.AnchorType.BottomMiddle]=function(e){return[e.maxWidth/2,e.maxHeight]},i[f.AnchorType.BottomRight]=function(e){return[e.maxWidth,e.maxHeight]},i[f.AnchorType.Custom]=function(e){return[e.anchor.x||0,e.anchor.y||0]},i);function m(e,t){for(var r=Number.MAX_SAFE_INTEGER,n=0,i=e.length;n<i;n++){var o=e[n],a=t.get(o);0===a?r=0:a&&a<r&&(r=a)}return r===Number.MAX_SAFE_INTEGER?0:r}function w(e,t,r){for(var n=[],i=r.fontMap?r.fontMap.fontSource.size:t.fontSize,o=t.fontSize/i,a="",u=0,c=[0,0],l=0,f=e.text.length;l<f;l++){var d=e.text[l];if(r.fontMap){var p=[0,0];a&&(p=r.fontMap.kerning[a][d]||[0,0]),c=(0,s.add2)(c,(0,s.scale2)(p,o)),0!==l&&(c=(0,s.add2)(c,[t.letterSpacing,0]));var h=r.fontMap.glyphMap[d];u=c[0]+h.pixelWidth*o,n.push(u),a=d}}return n}var O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"providers",{enumerable:!0,configurable:!0,writable:!0,value:{labels:new a.InstanceProvider,borders:new a.InstanceProvider}}),Object.defineProperty(t,"propertyIds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(t,"fullUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(t,"areaToLabels",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"areaToLines",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"areaWaitingOnLabel",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"areaTokerningRequest",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"areaToWords",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(t,"labelsInLine",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(t,"handleLabelReady",{enumerable:!0,configurable:!0,writable:!0,value:function(e){if(e.parentTextArea){var r=e.parentTextArea,n=t.areaWaitingOnLabel.get(r);if(n&&n.has(e)&&(n.delete(e),n.size<=0)){r.active=!0;var i=r.onReady;i&&i(r)}}else delete e.onReady}}),t}return o(t,e),Object.defineProperty(t.prototype,"childLayers",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.props.animateLabel||{},t=this.props.animateBorder||{},r=this.props.scaling;return[(0,l.createLayer)(g.LabelLayer,{animate:e,customGlyphLayer:this.props.customGlyphLayer,data:this.providers.labels,key:"".concat(this.id,".labels"),resourceKey:this.props.resourceKey,scaleMode:r,inTextArea:!0}),(0,l.createLayer)(h.BorderLayer,{animate:{color:t.color,location:t.location},data:this.providers.borders,key:"".concat(this.id,".border")})]}}),Object.defineProperty(t.prototype,"draw",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.resolveChanges();if(!(e.length<=0)){if(!this.propertyIds){var t=e[0][0];this.propertyIds=this.getInstanceObservableIds(t,["active","alignment","borderWidth","color","fontSize","hasBorder","letterSpacing","lineHeight","maxHeight","maxWidth","origin","padding","text","wordWrap"])}for(var r=this.propertyIds,n=r.active,i=r.alignment,o=r.borderWidth,a=r.color,s=r.fontSize,u=r.hasBorder,l=r.letterSpacing,f=r.lineHeight,d=r.maxHeight,p=r.maxWidth,h=r.origin,g=r.padding,v=r.text,y=r.wordWrap,m=0,w=e.length;m<w;++m){var O=e[m],_=(t=O[0],O[1]),T=O[2];switch(_){case c.InstanceDiffType.CHANGE:if(!this.areaToLabels.get(t)){this.insert(t);continue}void 0!==T[v]?(this.clear(t),this.updateLabels(t),this.layout(t)):void 0!==T[n]&&(t.active?(this.layout(t),this.showLabels(t)):this.hideLabels(t)),void 0!==T[i]&&(this.clear(t),this.updateLabels(t),this.layoutLabels(t)),void 0!==T[a]&&this.updateLabelColors(t),void 0!==T[h]&&this.updateLabelOrigins(t),void 0!==T[s]&&this.updateLabelFontSizes(t),void 0!==T[y]&&this.updateLabelLineWrap(t),void 0!==T[f]&&this.updateLabelLineHeight(t),void 0!==T[p]&&this.updateTextAreaSize(t),void 0!==T[d]&&this.updateTextAreaSize(t),void 0!==T[g]&&this.updateTextAreaSize(t),void 0!==T[o]&&this.updateBorderWidth(t),void 0!==T[u]&&this.updateBorder(t),void 0!==T[l]&&this.updateLetterSpacing(t);break;case c.InstanceDiffType.INSERT:this.insert(t);break;case c.InstanceDiffType.REMOVE:var P=this.areaToLabels.get(t);if(P){for(var x=0,E=P.length;x<E;++x){var j=P[x];j instanceof b.LabelInstance&&this.providers.labels.remove(j)}this.areaToLabels.delete(t),this.areaWaitingOnLabel.delete(t)}}}}}}),Object.defineProperty(t.prototype,"insert",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.layout(e),this.updateLabels(e)}}),Object.defineProperty(t.prototype,"hideLabels",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.areaToLabels.get(e);if(t)for(var r=0,n=t.length;r<n;++r){var i=t[r];i instanceof b.LabelInstance&&this.providers.labels.remove(i)}}}),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){return null}}),Object.defineProperty(t.prototype,"clear",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=e.labels,r=0,n=t.length;r<n;r++){(o=t[r])instanceof b.LabelInstance&&this.providers.labels.remove(o)}e.labels=[];var i=e.newLabels;for(r=0,n=i.length;r<n;r++){var o;(o=i[r])instanceof b.LabelInstance&&this.providers.labels.remove(o)}e.newLabels=[],this.areaToLabels.delete(e),this.areaWaitingOnLabel.delete(e),this.areaToWords.delete(e)}}),Object.defineProperty(t.prototype,"seperateLabel",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i,o,a,s,u){var c=e.padding[0],l=e.padding[1]||0,d=e.padding[2]||0,p=e.padding[3]||0,h=e.maxWidth-p-l,g=e.maxHeight-c-d,w=e.origin[0],O=e.origin[1];t.active=!1;var _=n.substring(0,i+1),T=m(_,r),P=y[e.anchor.type](e),x=new b.LabelInstance({anchor:{padding:0,type:f.AnchorType.Custom,paddingDirection:[o+p,a+c+T],x:P[0],y:P[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[w,O],text:_});if(x.size=[u[i],t.size[1]],this.providers.labels.add(x),e.newLabels.push(x),this.labelsInLine.push(x),o+=x.getWidth()+s,e.wordWrap===v.WordWrap.CHARACTER||e.wordWrap===v.WordWrap.WORD){if(this.setTextAlignment(o,a,s,h,e.alignment),o=0,(a+=e.lineHeight)+e.lineHeight<=g){for(var E=u[u.length-1]-u[i];E>h&&a+e.lineHeight<=g;){for(var j=u.length-1;u[j]-u[i]>h;)j--;var S=n.substring(i+1,j+1),R=m(S,r),M=new b.LabelInstance({anchor:{padding:0,type:f.AnchorType.Custom,paddingDirection:[o+p,a+c+R],x:P[0],y:P[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[w,O],text:S});M.size=[u[j]-u[i],t.size[1]],o+=M.getWidth()+s,this.labelsInLine.push(M),this.providers.labels.add(M),e.newLabels.push(M),this.setTextAlignment(o,a,s,h,e.alignment),o=0,a+=e.lineHeight,i=j,E=u[u.length-1]-u[i]}if(a+e.lineHeight<=g){var A=n.substring(i+1),I=m(A,r),L=new b.LabelInstance({anchor:{padding:0,type:f.AnchorType.Custom,paddingDirection:[o+p,a+c+I],x:P[0],y:P[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[w,O],text:A});L.size=[u[u.length-1]-u[i],t.size[1]],this.labelsInLine.push(L);for(var C=[],B=i+1;B<u.length;B++)C.push(u[B]-u[i]);this.providers.labels.add(L),e.newLabels.push(L),o+=L.getWidth()+s}}}else e.wordWrap===v.WordWrap.NONE&&(o+=x.getWidth()+s);return[o,a]}}),Object.defineProperty(t.prototype,"updateLabelLineWrap",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.areaToLabels.get(e);if(t){for(var r=0,n=t.length;r<n;++r){(i=t[r])instanceof b.LabelInstance&&(i.active=!0)}for(r=0,n=e.newLabels.length;r<n;++r){var i=e.newLabels[r];this.providers.labels.remove(i)}e.newLabels=[],this.layoutLabels(e)}}}),Object.defineProperty(t.prototype,"updateLabelLineHeight",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.areaToLabels.get(e);if(t){for(var r=0,n=t.length;r<n;++r){(i=t[r])instanceof b.LabelInstance&&(i.active=!0)}for(r=0,n=e.newLabels.length;r<n;++r){var i=e.newLabels[r];this.providers.labels.remove(i)}e.newLabels=[],this.layoutLabels(e)}}}),Object.defineProperty(t.prototype,"updateTextAreaSize",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.areaToLabels.get(e);if(t){for(var r=0,n=t.length;r<n;++r){(i=t[r])instanceof b.LabelInstance&&(i.active=!0)}for(r=0,n=e.newLabels.length;r<n;++r){var i=e.newLabels[r];this.providers.labels.remove(i)}e.newLabels=[];for(r=0,n=e.borders.length;r<n;++r){var o=e.borders[r];this.providers.borders.remove(o)}e.borders=[],this.layoutBorder(e),this.layoutLabels(e)}}}),Object.defineProperty(t.prototype,"updateBorderWidth",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var t=0,r=e.borders.length;t<r;++t){var n=e.borders[t];this.providers.borders.remove(n)}e.borders=[],this.layoutBorder(e)}}),Object.defineProperty(t.prototype,"updateBorder",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(e.hasBorder)this.layoutBorder(e);else{for(var t=0,r=e.borders.length;t<r;++t){var n=e.borders[t];this.providers.borders.remove(n)}e.borders=[]}}}),Object.defineProperty(t.prototype,"updateLetterSpacing",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.clear(e),this.updateLabels(e),this.layout(e)}}),Object.defineProperty(t.prototype,"setTextAlignment",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,n,i){if(e-r<n&&i!==v.TextAlignment.LEFT){var o=n-e+r,a=i===v.TextAlignment.RIGHT?o:o/2;this.labelsInLine.forEach((function(e){var r=e.anchor;e.anchor={padding:r.padding,type:f.AnchorType.Custom,paddingDirection:[(r.paddingDirection?r.paddingDirection[0]:0)+a,r.paddingDirection?r.paddingDirection[1]:t],x:r.x,y:r.y}}))}this.labelsInLine=[]}}),Object.defineProperty(t.prototype,"layoutBorder",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(e.hasBorder){var t=this.areaTokerningRequest.get(e);if(!t)return;var r=t.fontMap?t.fontMap.fontSource.size:e.fontSize,n=e.fontSize/r,i=this.props.scaling,o=e.borderWidth,a=new p.BorderInstance({color:e.color,fontScale:n,scaling:i,size:[e.maxWidth+2*o,o],textAreaOrigin:e.origin,textAreaAnchor:y[e.anchor.type](e),position:[-o,-o]}),s=new p.BorderInstance({color:e.color,fontScale:n,scaling:i,size:[o,e.maxHeight+2*o],textAreaOrigin:e.origin,textAreaAnchor:y[e.anchor.type](e),position:[-o,-o]}),u=new p.BorderInstance({color:e.color,fontScale:n,scaling:i,size:[o,e.maxHeight+2*o],textAreaOrigin:e.origin,textAreaAnchor:y[e.anchor.type](e),position:[e.maxWidth,-o]}),c=new p.BorderInstance({color:e.color,fontScale:n,scaling:i,size:[e.maxWidth+2*o,o],textAreaOrigin:e.origin,textAreaAnchor:y[e.anchor.type](e),position:[-o,e.maxHeight]});this.providers.borders.add(a),this.providers.borders.add(s),this.providers.borders.add(u),this.providers.borders.add(c),e.borders.push(a),e.borders.push(s),e.borders.push(u),e.borders.push(c)}}}),Object.defineProperty(t.prototype,"layoutLabels",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.areaTokerningRequest.get(e);if(t){var r=e.padding[0],n=e.padding[1]||0,i=e.padding[2]||0,o=e.padding[3]||0,a=e.maxWidth-o-n,s=e.maxHeight-r-i,u=e.origin[0],c=e.origin[1],l=0;if(e.spaceWidth)l=e.spaceWidth;else{if(t.fontMap){var d=t.fontMap.fontSource.size,p=e.fontSize/d;l=t.fontMap.spaceWidth*p}else l=this.props.whiteSpaceKerning||e.fontSize/2;e.spaceWidth=l}var h=function(e,t){var r=new Map;if(t.fontMap){for(var n=t.fontMap.fontSource.size,i=e.fontSize/n,o=t.fontMap,a=e.text.replace(/\s/g,""),s=Number.MAX_SAFE_INTEGER,u=0,c=void 0,l="",f=0,d=a.length;f<d;++f){var p=a[f];c=0,l&&(c=o.kerning[l][p][1]||0),u+=c*i,r.set(p,u),s=Math.min(u,s),l=p}r.forEach((function(e,t){r.set(t,e-s)}))}return r}(e,t),g=0,O=0;this.labelsInLine=[];for(var _=0,T=e.labels.length;_<T;++_){var P=e.labels[_];if(P instanceof b.LabelInstance){var x=P.getWidth(),E=m(P.text,h),j=w(P,e,t);if(O+e.lineHeight<=s&&j[0]<=a)if(g+x<=a){P.origin=[u,c];var S=y[e.anchor.type](e);P.anchor={padding:0,paddingDirection:[g+o,O+r+E],type:f.AnchorType.Custom,x:S[0],y:S[1]},g+=x+l,this.labelsInLine.push(P),g>=a&&e.wordWrap===v.WordWrap.CHARACTER&&_+1<T&&e.labels[_+1]!==v.NewLineCharacterMode.NEWLINE&&(this.setTextAlignment(g,O,l,a,e.alignment),g=0,O+=e.lineHeight)}else if(e.wordWrap===v.WordWrap.WORD&&P.getWidth()<=e.maxWidth)if(this.setTextAlignment(g,O,l,a,e.alignment),g=0,(O+=e.lineHeight)+e.lineHeight<=s){P.origin=[u,c];S=y[e.anchor.type](e);P.anchor={padding:0,paddingDirection:[g+o,O+r+E],type:f.AnchorType.Custom,x:S[0],y:S[1]},this.labelsInLine.push(P),g+=P.getWidth()+l}else P.active=!1;else{for(var R=a-g,M=j.length-1,A=P.text;j[M]>R;)M--;if(M>=0)g=(I=this.seperateLabel(e,P,h,A,M,g,O,l,j))[0],O=I[1];else if(e.wordWrap===v.WordWrap.CHARACTER||e.wordWrap===v.WordWrap.WORD)if(this.setTextAlignment(g,O,l,a,e.alignment),g=0,(O+=e.lineHeight)+e.lineHeight<s)if(g+P.getWidth()<=a){P.origin=[u,c];S=y[e.anchor.type](e);P.anchor={padding:0,paddingDirection:[g+o,O+r+E],type:f.AnchorType.Custom,x:S[0],y:S[1]},this.labelsInLine.push(P),(g+=P.getWidth()+l)>=a&&_+1<T&&e.labels[_+1]!==v.NewLineCharacterMode.NEWLINE&&(this.setTextAlignment(g,O,l,a,e.alignment),g=0,O+=e.lineHeight)}else{for(var I,L=a-g,C=j.length-1,B=P.text;j[C]>L;)C--;if(C>=0)g=(I=this.seperateLabel(e,P,h,B,C,g,O,l,j))[0],O=I[1]}else P.active=!1;else e.wordWrap===v.WordWrap.NONE&&(P.active=!1)}else P.active=!1}else P===v.NewLineCharacterMode.NEWLINE&&(this.setTextAlignment(g,O,l,a,e.alignment),g=0,O+=e.lineHeight)}this.setTextAlignment(g,O,l,a,e.alignment)}}}),Object.defineProperty(t.prototype,"layout",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.updateKerning(e);var t=this.areaTokerningRequest.get(e);if(t&&t.fontMap){var r=this.areaWaitingOnLabel.get(e);if(!(r&&r.size>0)&&e.active){var n=this.areaToLabels.get(e);n&&0!==n.length&&(this.updateLabels(e),this.layoutBorder(e),this.layoutLabels(e))}}}}),Object.defineProperty(t.prototype,"updateKerning",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.areaTokerningRequest.get(e),r=e.text;if(!t){var n={fontSize:e.fontSize,text:e.text,letterSpacing:e.letterSpacing};return t=(0,u.fontRequest)({character:"",key:this.props.resourceKey||"",kerningPairs:[r],metrics:n}),e.preload?(e.resourceTrigger=function(){e.onReady&&e.onReady(e)},this.resource.request(this,e,t)):(this.resource.request(this,e,t),this.areaTokerningRequest.set(e,t)),!1}return t.kerningPairs&&t.kerningPairs.indexOf(r)>-1?Boolean(t.fontMap):!(!t.fontMap||t.fontMap.supportsKerning(r))&&(this.areaTokerningRequest.delete(e),t=void 0,!0)}}),Object.defineProperty(t.prototype,"managesInstance",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return Boolean(this.areaToLabels.get(e))}}),Object.defineProperty(t.prototype,"showLabels",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.areaToLabels.get(e);if(t)for(var r=0,n=t.length;r<n;++r){var i=t[r];i instanceof b.LabelInstance&&this.providers.labels.add(i)}}}),Object.defineProperty(t.prototype,"updateLabels",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.areaToLabels.get(e),r=e.padding[0],n=e.padding[3]||0,i=e.origin[0]+n,o=e.origin[1]+r;t||(t=[],this.areaToLabels.set(e,t));var a=this.areaWaitingOnLabel.get(e);a||(a=new Set,this.areaWaitingOnLabel.set(e,a));var s=this.areaToWords.get(e);if(s||(s=function(e){for(var t=[],r=e.split(c.newLineRegEx),n=0,i=r.length-1;n<i;n++){r[n].split(" ").forEach((function(e){""!==e&&t.push(e)})),t.push("\n")}return r[r.length-1].split(" ").forEach((function(e){""!==e&&t.push(e)})),t}(e.text)),t.length<s.length)for(var u=t.length,l=s.length;u<l;++u){var f=s[u];if("\n"===f)t.push(v.NewLineCharacterMode.NEWLINE);else{var d=new b.LabelInstance({active:!1,color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,text:f,origin:[i,o],onReady:this.handleLabelReady});d.parentTextArea=e,t.push(d),this.providers.labels.add(d),a.add(d)}}e.labels=t}}),Object.defineProperty(t.prototype,"updateLabelColors",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.areaToLabels.get(e);if(t){for(var r=0,n=t.length;r<n;++r){var i=t[r];i instanceof b.LabelInstance&&(i.color=(0,s.copy4)(e.color))}r=0;for(var o=e.newLabels.length;r<o;++r)e.newLabels[r].color=(0,s.copy4)(e.color);for(r=0,o=e.borders.length;r<o;++r)e.borders[r].color=(0,s.copy4)(e.color)}}}),Object.defineProperty(t.prototype,"updateLabelFontSizes",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.clear(e),this.updateLabels(e),this.areaTokerningRequest.delete(e),this.layout(e)}}),Object.defineProperty(t.prototype,"updateLabelOrigins",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.areaToLabels.get(e);if(t){for(var r=e.origin,n=e.oldOrigin,i=0,o=t.length;i<o;++i){if((s=t[i])instanceof b.LabelInstance){var a=s.origin;s.origin=[a[0]+r[0]-n[0],a[1]+r[1]-n[1]]}}for(i=0,o=e.newLabels.length;i<o;++i){var s;if((s=e.newLabels[i])instanceof b.LabelInstance){a=s.origin;s.origin=[a[0]+r[0]-n[0],a[1]+r[1]-n[1]]}}for(i=0,o=e.borders.length;i<o;++i){var u=e.borders[i];u.position=[u.position[0]+r[0]-n[0],u.position[1]+r[1]-n[1]]}e.oldOrigin=e.origin}}}),Object.defineProperty(t.prototype,"willUpdateProps",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.data!==this.props.data&&delete this.propertyIds,e.resourceKey!==this.props.resourceKey&&(this.fullUpdate=!0)}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{key:"",data:new a.InstanceProvider,scaling:f.ScaleMode.ALWAYS}}),t}(d.Layer2D);t.TextAreaLayer=O},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.BorderInstance=void 0;var a=r(1),s=function(e){function t(r){var n=e.call(this,r)||this;return Object.defineProperty(n,"fontScale",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(n,"textAreaOrigin",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),Object.defineProperty(n,"textAreaAnchor",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),(0,a.makeObservable)(n,t),n.fontScale=r.fontScale||n.fontScale,n.textAreaOrigin=r.textAreaOrigin||n.textAreaOrigin,n.textAreaAnchor=r.textAreaAnchor||n.textAreaAnchor,n}return i(t,e),o([a.observable],t.prototype,"fontScale",void 0),o([a.observable],t.prototype,"textAreaOrigin",void 0),o([a.observable],t.prototype,"textAreaAnchor",void 0),t}(r(122).RectangleInstance);t.BorderInstance=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.BorderLayer=void 0;var o=r(1),a=r(0),s=r(62),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.props.animate||{},n={0:1,1:1,2:-1,3:1,4:-1,5:-1},i={0:0,1:0,2:0,3:1,4:1,5:1},o=this.props.scaleFactor,s=void 0===o?function(){return 1}:o;return{fs:r(231),instanceAttributes:[{easing:e.location,name:t.attributeNames.location,size:a.InstanceAttributeSize.TWO,update:function(e){return e.position}},{name:t.attributeNames.anchor,size:a.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x||0,e.anchor.y||0]}},{name:t.attributeNames.size,size:a.InstanceAttributeSize.TWO,update:function(e){return e.size}},{name:t.attributeNames.depth,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:t.attributeNames.scaling,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{easing:e.color,name:t.attributeNames.color,size:a.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.scale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scale]}},{name:t.attributeNames.maxScale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.maxScale]}},{name:t.attributeNames.fontScale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.fontScale]}},{name:"textAreaOrigin",size:a.InstanceAttributeSize.TWO,update:function(e){return e.textAreaOrigin}},{name:"textAreaAnchor",size:a.InstanceAttributeSize.TWO,update:function(e){return e.textAreaAnchor}}],uniforms:[{name:"scaleFactor",size:a.UniformSize.ONE,update:function(e){return[s()]}}],vertexAttributes:[{name:"normals",size:a.VertexAttributeSize.TWO,update:function(e){return[n[e],i[e]]}}],vertexCount:6,vs:r(232)}}}),Object.defineProperty(t.prototype,"getMaterialOptions",{enumerable:!1,configurable:!0,writable:!0,value:function(){return s.CommonMaterialOptions.transparentShapeBlending}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{key:"",data:new o.InstanceProvider}}),Object.defineProperty(t,"attributeNames",{enumerable:!0,configurable:!0,writable:!0,value:{anchor:"anchor",color:"color",depth:"depth",fontScale:"fontScale",location:"location",maxScale:"maxScale",scale:"scale",scaling:"scaling",size:"size"}}),t}(r(114).Layer2D);t.BorderLayer=u},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\ngl_FragColor = vertexColor;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\nfloat borderScale = mix(fontScale, 1.0, float(scaling == 3.0));\nvec3 screenSize = cameraSpaceSize(vec3(size * scale * borderScale / scaleFactor / maxScale, 1.0));\nbool largerOnScreen = screenSize.y > size.y || screenSize.x > size.x;\nfloat useScaleMode = float(\n(\nscaling == 3.0 ||\n(largerOnScreen && scaling == 2.0)\n) &&\nscaling != 1.0\n);\nfloat unequalZooms = float(cameraScale2D.x != cameraScale2D.y);\nvec2 adjustedSize = mix(\nsize,\n(size * cameraScale2D.yx),\nunequalZooms\n);\nfloat normal = normals.x;\nfloat side = normals.y;\nvec2 scaledAnchor = anchor * scale;\nvec2 worldAnchor = location + scaledAnchor;\nvec2 adjustedAnchor = mix(\nscaledAnchor,\n(scaledAnchor * cameraScale2D.yx),\nunequalZooms\n);\nvec2 vertex = vec2(side, float(normal == 1.0)) * scale * adjustedSize + location - adjustedAnchor;\nfloat labelScreenScale = mix(\nscreenSize.y / adjustedSize.y,\nscreenSize.x / adjustedSize.x,\nfloat((cameraScale2D.x != 1.0))\n);\nfloat currentScale = labelScreenScale * scale;\nvec2 anchorToVertex = vertex - location;\nvertex = mix(\nvertex + textAreaOrigin,\n(anchorToVertex + location - textAreaAnchor) / labelScreenScale + textAreaOrigin + textAreaAnchor,\nuseScaleMode\n);\nvertexColor = color;\ngl_Position = clipSpace(vec3(vertex, depth));\n}"},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(234),t),i(r(122),t)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RectangleLayer=void 0;var o=r(1),a=r(0),s=r(3),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.props.animate||{},n={0:1,1:1,2:-1,3:1,4:-1,5:-1},i={0:0,1:0,2:0,3:1,4:1,5:1},o=this.props.scaleFactor,s=void 0===o?function(){return 1}:o;return{fs:r(235),instanceAttributes:[{easing:e.location,name:t.attributeNames.location,size:a.InstanceAttributeSize.TWO,update:function(e){return e.position}},{name:t.attributeNames.anchor,size:a.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x||0,e.anchor.y||0]}},{name:t.attributeNames.size,size:a.InstanceAttributeSize.TWO,update:function(e){return e.size}},{name:t.attributeNames.depth,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:t.attributeNames.scaling,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{easing:e.color,name:t.attributeNames.color,size:a.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.scale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scale]}},{name:t.attributeNames.maxScale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.maxScale]}}],uniforms:[{name:"scaleFactor",size:a.UniformSize.ONE,update:function(e){return[s()]}}],vertexAttributes:[{name:"normals",size:a.VertexAttributeSize.TWO,update:function(e){return[n[e],i[e]]}}],vertexCount:6,vs:r(236)}}}),Object.defineProperty(t.prototype,"getMaterialOptions",{enumerable:!1,configurable:!0,writable:!0,value:function(){return s.CommonMaterialOptions.transparentShapeBlending}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{key:"",data:new o.InstanceProvider}}),Object.defineProperty(t,"attributeNames",{enumerable:!0,configurable:!0,writable:!0,value:{anchor:"anchor",color:"color",depth:"depth",location:"location",maxScale:"maxScale",scale:"scale",scaling:"scaling",size:"size"}}),t}(r(6).Layer2D);t.RectangleLayer=u},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\ngl_FragColor = vertexColor;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\nvec3 screenSize = cameraSpaceSize(vec3(size * scale / scaleFactor / maxScale, 1.0));\nbool largerOnScreen = screenSize.y > size.y || screenSize.x > size.x;\nfloat useScaleMode = float(\n(\nscaling == 3.0 ||\n(largerOnScreen && scaling == 2.0)\n) &&\nscaling != 1.0\n);\nfloat unequalZooms = float(cameraScale2D.x != cameraScale2D.y);\nvec2 adjustedSize = mix(\nsize,\n(size * cameraScale2D.yx),\nunequalZooms\n);\nfloat normal = normals.x;\nfloat side = normals.y;\nvec2 scaledAnchor = anchor * scale;\nvec2 worldAnchor = location + scaledAnchor;\nvec2 adjustedAnchor = mix(\nscaledAnchor,\n(scaledAnchor * cameraScale2D.yx),\nunequalZooms\n);\nvec2 vertex = vec2(side, float(normal == 1.0)) * scale * adjustedSize + location - adjustedAnchor;\nfloat labelScreenScale = mix(\nscreenSize.y / adjustedSize.y,\nscreenSize.x / adjustedSize.x,\nfloat((cameraScale2D.x != 1.0))\n);\nfloat currentScale = labelScreenScale * scale;\nvec2 anchorToVertex = vertex - location;\nvertex = mix(\nvertex,\n(anchorToVertex / labelScreenScale) + location,\nuseScaleMode\n);\nvertexColor = color;\ngl_Position = clipSpace(vec3(vertex, depth));\n}"},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(238),t),i(r(239),t)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.RingInstance=void 0;var a=r(11),s=r(20),u=function(e){function t(r){var n=e.call(this,r)||this;return Object.defineProperty(n,"color",{enumerable:!0,configurable:!0,writable:!0,value:[1,1,1,1]}),Object.defineProperty(n,"depth",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"radius",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(n,"thickness",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(n,"center",{enumerable:!0,configurable:!0,writable:!0,value:[0,0]}),(0,s.makeObservable)(n,t),n.color=r.color||n.color,n.depth=r.depth||n.depth,n.radius=r.radius||n.radius,n.thickness=r.thickness||n.thickness,n.center=r.center||n.center,n}return i(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return 2*this.radius},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return 2*this.radius},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"innerRadius",{get:function(){return this.radius-this.thickness},enumerable:!1,configurable:!0}),o([s.observable],t.prototype,"color",void 0),o([s.observable],t.prototype,"depth",void 0),o([s.observable],t.prototype,"radius",void 0),o([s.observable],t.prototype,"thickness",void 0),o([s.observable],t.prototype,"center",void 0),t}(a.Instance);t.RingInstance=u},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RingLayer=void 0;var o=r(1),a=r(0),s=r(3),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.props.scaleFactor||function(){return 1},n=this.props.animate||{},i=n.color,o=n.center,s=n.radius,u={0:1,1:1,2:-1,3:1,4:-1,5:-1},c={0:-1,1:-1,2:-1,3:1,4:1,5:1};return{fs:r(240),instanceAttributes:[{easing:o,name:t.attributeNames.center,size:a.InstanceAttributeSize.TWO,update:function(e){return e.center}},{easing:s,name:t.attributeNames.radius,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.radius]}},{name:t.attributeNames.depth,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{easing:i,name:t.attributeNames.color,size:a.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.thickness,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.thickness]}}],uniforms:[{name:"scaleFactor",size:a.UniformSize.ONE,update:function(t){return[e()]}}],vertexAttributes:[{name:"normals",size:a.VertexAttributeSize.TWO,update:function(e){return[u[e],c[e]]}}],vertexCount:6,vs:r(241)}}}),Object.defineProperty(t.prototype,"getMaterialOptions",{enumerable:!1,configurable:!0,writable:!0,value:function(){return s.CommonMaterialOptions.transparentShapeBlending}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{key:"",data:new o.InstanceProvider}}),Object.defineProperty(t,"attributeNames",{enumerable:!0,configurable:!0,writable:!0,value:{center:"center",radius:"radius",depth:"depth",color:"color",thickness:"thickness"}}),t}(r(6).Layer2D);t.RingLayer=u},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float borderSize;\nvarying vec2 pointCoord;\nvarying float scale;\nfloat circle(vec2 coord, float radius){\nvec2 dist = coord - vec2(0.5);\nreturn 1.0 - smoothstep(\nradius - (radius * edgeSharpness),\nradius,\ndot(dist, dist) * 4.0\n);\n}\nvoid main() {\nfloat outer_step_factor = circle(pointCoord, 1.0);\nfloat inner_step_factor = circle(pointCoord, 1.0 - borderSize * scale);\ngl_FragColor = mix(\nmix(\nvec4(0.0, 0.0, 0.0, 0.0),\nvertexColor,\nouter_step_factor\n),\nvec4(0.0, 0.0, 0.0, 0.0),\ninner_step_factor\n);\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float borderSize;\nvarying vec2 pointCoord;\nvarying float scale;\nvoid main() {\nscale = scaleFactor;\nvertexColor = color;\nfloat size = radius * scaleFactor * pixelRatio;\nfloat ringWidth = mix(2.0 , thickness, float(thickness > 2.0));\nborderSize = mix(\n(ringWidth) / size,\n((ringWidth * pixelRatio) / size),\nfloat(pixelRatio > 1.0)\n);\nedgeSharpness = min(0.2 / (ringWidth * scale), 0.1);\npointCoord = (normals.xy + vec2(1.0, 1.0)) / 2.0;\nvec4 clipCenter = clipSpace(vec3(center, depth));\nvec2 screenCenter = (clipCenter.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nvec2 vertex = (normals.xy * size) + screenCenter;\ngl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), clipCenter.zw);\n}"},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),r(243),i(r(284),t),i(r(125),t),i(r(288),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(244),r(280),r(282)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(22),i=r(6),o=r(33),a=r(0);o.ShaderModule.register([{moduleId:"world2DXY",description:"\nThis is a special helper module used by\nthe system to map View2D content into\na 3D world space. The system utilizes\nthis module automatically for you when\nyou utilize createLayer2Din3D.\n",content:r(113),compatibility:a.ShaderInjectionTarget.ALL,uniforms:function(e){return e instanceof i.Layer2D?e.props.control2D?[{name:"projection",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"view",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"cameraOffset",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof n.Control2D?e.props.control2D.offset:[0,0,0]}},{name:"cameraPosition",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraScale2D",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof n.Control2D?e.props.control2D.scale:[1,1,1]}},{name:"cameraRotation",size:a.UniformSize.FOUR,update:function(){return e.view.props.camera.transform.rotation}},{name:"viewSize",size:a.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:a.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requested the module world2DXZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}}])},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(246),r(248),r(249),r(251),r(252),r(268),r(273),r(275),r(277)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);r(9).ShaderModule.register([{moduleId:"camera",description:"\nThese are properties injected from the\ncurrent camera applied to the view.\n\nConstants:\nmat4 projection;\nmat4 view;\nmat4 viewProjection;\nvec3 cameraOffset;\nvec3 cameraPosition;\nvec3 cameraScale;\nvec3 cameraRotation;\nvec2 viewSize;\nfloat pixelRatio;\n",content:"",compatibility:n.ShaderInjectionTarget.ALL,uniforms:function(e){return[{name:"projection",size:n.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"viewProjection",size:n.UniformSize.MATRIX4,update:function(){return e.view.props.camera.viewProjection}},{name:"view",size:n.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"cameraPosition",size:n.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:n.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraRotation",size:n.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{shaderInjection:n.ShaderInjectionTarget.ALL,name:"viewSize",size:n.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{shaderInjection:n.ShaderInjectionTarget.ALL,name:"pixelRatio",size:n.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]}},{moduleId:"projection",content:r(247),compatibility:n.ShaderInjectionTarget.ALL}])},function(e,t){e.exports="${import: camera}\nvec3 cameraSpace(vec3 world) {\nreturn (view * vec4(world, 1.0)).xyz;\n}\nvec3 cameraSpace(vec4 world) {\nreturn (view * world).xyz;\n}\nvec3 cameraSpaceDirection(vec3 world) {\nreturn (view * vec4(world, 0.0)).xyz;\n}\nvec3 cameraSpaceDirection(vec4 world) {\nreturn (view * world).xyz;\n}\nvec3 cameraSpaceSize(vec3 worldSize) {\nreturn (view * vec4(worldSize, 0.0)).xyz;\n}\nvec4 clipSpace(vec3 world) {\nreturn (viewProjection) * vec4(world, 1.0);\n}\nvec4 clipSpace(vec4 world) {\nreturn (viewProjection) * world;\n}\nvec4 clipSpaceDirection(vec3 worldSize) {\nreturn (viewProjection) * vec4(worldSize, 0.0);\n}\nvec4 clipSpaceDirection(vec4 worldSize) {\nreturn (viewProjection) * worldSize;\n}\nvec4 clipSpaceSize(vec3 worldSize) {\nreturn (viewProjection) * vec4(worldSize, 0.0);\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);r(9).ShaderModule.register({moduleId:"frame",description:"\nThis provides frame timing information\nor how many frames have been rendered.\n\nConstants:\nfloat currentTime;\nfloat currentFrame;\n",content:"",compatibility:n.ShaderInjectionTarget.ALL,uniforms:function(e){return[{name:"currentTime",size:n.UniformSize.ONE,update:function(){return[e.surface.frameMetrics.currentTime]}},{name:"currentFrame",size:n.UniformSize.ONE,update:function(){return[e.surface.frameMetrics.currentFrame]}}]}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);r(9).ShaderModule.register({moduleId:"hsv",description:"\nProvides methods that converts colors to\nHSV values and back. This makes it\neasier to deal with hue saturation and\nlightness levels.\n\nMethods:\nvec3 rgb2hsv(vec3 c);\nvec3 hsv2rgb(vec3 c);\n",content:r(250),compatibility:n.ShaderInjectionTarget.ALL})},function(e,t){e.exports="vec3 rgb2hsv(vec3 c) {\nvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\nvec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\nfloat d = q.x - min(q.w, q.y);\nfloat e = 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);r(9).ShaderModule.register({moduleId:"instancing",description:"\nThis is an internal shader module that\nhelps establish the instancing system.\nNot recommended for use unless you\nreally know how to utilize it properly.\n\nAttributes:\nfloat _active;\nfloat instance;\n",content:"",compatibility:n.ShaderInjectionTarget.ALL,instanceAttributes:function(e){var t={name:"_active",size:n.InstanceAttributeSize.ONE,update:function(e){return[e.active?1:0]}};return e.shaderIOInfo.activeAttribute=t,[t]},vertexAttributes:function(e){return e.bufferType===n.LayerBufferType.UNIFORM?[{name:"instance",size:n.VertexAttributeSize.ONE,update:function(){return[0]}}]:[]}})},function(e,t,r){"use strict";var n=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(9),a=[{moduleId:"PI_INV",description:"Provides: float PI_INV = 1.0 / pi",content:r(253),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"PI2_INV",description:"Provides:\nfloat PI2_INV = 1.0 / (pi * 2.0)",content:r(254),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"PI_2",description:"Provides: float PI_2 = pi / 2.0",content:r(255),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"PI_4",description:"Provides: float PI_4 = pi / 4.0",content:r(256),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"PI",description:"Provides: float PI = pi",content:r(257),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"PI2",description:"Provides: float PI2 = pi * 2.0",content:r(258),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"toDegrees",description:"Provides: float toDegrees;\nCan be used to convert radians to degrees:\nradians * toDegrees",content:r(259),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"toRadians",description:"Provides: float toRadians;\nCan be used to convert degrees to radians:\ndegress * toRadians",content:r(260),compatibility:i.ShaderInjectionTarget.ALL}],s={moduleId:"constants",description:"\nProvides all the math constants you may\nneed as convenience. It's probably\nbetter to include them individually, but\nconvenience sometimes beats practicality\n\nConstants:\n".concat(a.map((function(e){return e.moduleId})).join("\n"),"\n"),content:"${import: ".concat(a.map((function(e){return e.moduleId})).join(", "),"}"),compatibility:i.ShaderInjectionTarget.ALL},u=[{moduleId:"bezier1",description:"Provides the 2D single control\npoint bezier method:\nvec2 bezier1(float t, vec2 p1, vec2 p2, vec2 c1)",content:r(261),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"bezier2",description:"Provides the 2D single control\npoint bezier method:\nvec2 bezier2(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2)",content:r(262),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"arc",description:"Provides the 2D\narc interpolation method:\nvec2 arc(float t,\n\tvec2 center,\n\tfloat radius,\n\tfloat start,\n\tfloat end\n)",content:r(263),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"fmod",description:"Provides the floating point\nmodulus method:\nfloat fmod(float x, float m, float m_inv)",content:r(264),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"wrap",description:"Provides a method that wraps\nvalue overflows:\nfloat wrap(float value, float start, float end)",content:r(265),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"fcos",description:"Provides a fcos method that also\nhas a higher precision than\nsome hardware cos implementations:\nfloat fcos(float x)",content:r(266),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"fsin",description:"Provides a fsin method that also\nhas a higher precision than\nsome hardware sin implementations:\nfloat fsin(float x)",content:r(267),compatibility:i.ShaderInjectionTarget.ALL}];o.ShaderModule.register(n(n(n([],u,!0),a,!0),[s],!1))},function(e,t){e.exports="float PI_INV = 0.3183098862;"},function(e,t){e.exports="float PI2_INV = 0.1591549431;"},function(e,t){e.exports="float PI_2 = 1.5707963268;"},function(e,t){e.exports="float PI_4 = 0.7853981634;"},function(e,t){e.exports="float PI = 3.14159265;"},function(e,t){e.exports="float PI2 = 6.2831853;"},function(e,t){e.exports="float toDegrees = 57.2957795131;"},function(e,t){e.exports="float toRadians = 0.01745329252;"},function(e,t){e.exports="vec2 bezier1(float t, vec2 p1, vec2 p2, vec2 c1) {\nreturn (1.0 - t) * (1.0 - t) * p1 + 2.0 * t * (1.0 - t) * c1 + t * t * p2;\n}"},function(e,t){e.exports="vec2 bezier2(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\nfloat t1 = 1.0 - t;\nreturn pow(t1, 3.0) * p1 + 3.0 * t * pow(t1, 2.0) * c1 + 3.0 * pow(t, 2.0) * t1 * c2 + pow(t, 3.0) * p2;\n}"},function(e,t){e.exports="${import: PI, PI2, fsin, fcos, wrap}\nvec2 arc(float t, vec2 center, float radius, float start, float end) {\nfloat angle = wrap((end - start) * t + start, 0.0, PI2);\nreturn center + vec2(fcos(angle), fsin(angle)) * radius;\n}"},function(e,t){e.exports="float fmod(float x, float m, float m_inv) {\nreturn x - m * floor(x * m_inv);\n}"},function(e,t){e.exports="float wrap(float value, float start, float end) {\nfloat width = end - start;\nfloat offsetValue = value - start;\nreturn (offsetValue - (floor(offsetValue / width) * width)) + start;\n}"},function(e,t){e.exports="${import: PI, PI2, PI_2}\nfloat fcos(float x) {\nfloat sine;\nx += PI_2;\nx += mix(\nmix(\n0.0,\n-PI2, float(x > PI)\n),\nPI2, float(x < -PI)\n);\nsine = 1.27323954 * x;\nsine += mix(-1.0, 1.0, float(x < 0.0)) * 0.405284735 * x * x;\nsine = 0.225 * (sine * (mix(1.0, -1.0, float(sine < 0.0)) * sine) - sine) + sine;\nreturn sine;\n}"},function(e,t){e.exports="${import: PI, PI2}\nfloat fsin(float x) {\nfloat sine;\nx += mix(\nmix(\n0.0,\n-PI2, float(x > PI)\n),\nPI2, float(x < -PI)\n);\nsine = 1.27323954 * x;\nsine += mix(-1.0, 1.0, float(x < 0.0)) * 0.405284735 * x * x;\nsine = 0.225 * (sine * (mix(1.0, -1.0, float(sine < 0.0)) * sine) - sine) + sine;\nreturn sine;\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);r(9).ShaderModule.register([{moduleId:"translation",description:"Generates a translation matrix\nfrom a vec3:\nmat4 transform(vec3 s, vec4 r, vec3 t)",compatibility:n.ShaderInjectionTarget.ALL,content:r(269)},{moduleId:"rotation",description:"Generates a rotation matrix\nfrom a quaternion:\nmat4 rotationFromQuaternion(vec4 q)",compatibility:n.ShaderInjectionTarget.ALL,content:r(270)},{moduleId:"scale",description:"Generates a scale matrix\nfrom a vec3:\nmat4 scale(vec3 s)",compatibility:n.ShaderInjectionTarget.ALL,content:r(271)},{moduleId:"transform",description:"Generates a full transform matrix\nfrom a scale, quaternion, translation:\nmat4 transform(vec3 s, vec4 r, vec3 t)",compatibility:n.ShaderInjectionTarget.ALL,content:r(272)}])},function(e,t){e.exports="mat4 translation(vec3 t) {\nreturn mat4(\n1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 0,\nt.x, t.y, t.z, 1\n);\n}"},function(e,t){e.exports="mat4 rotationFromQuaternion(vec4 q) {\nfloat x2 = q.y + q.y;\nfloat y2 = q.z + q.z;\nfloat z2 = q.w + q.w;\nfloat xx = q.y * x2;\nfloat xy = q.y * y2;\nfloat xz = q.y * z2;\nfloat yy = q.z * y2;\nfloat yz = q.z * z2;\nfloat zz = q.w * z2;\nfloat wx = q.x * x2;\nfloat wy = q.x * y2;\nfloat wz = q.x * z2;\nreturn mat4(\n1.0 - (yy + zz), xy - wz, xz + wy, 0.0,\nxy + wz, 1.0 - (xx + zz), yz - wx, 0.0,\nxz - wy, yz + wx, 1.0 - (xx + yy), 0.0,\n0, 0, 0, 1\n);\n}"},function(e,t){e.exports="mat4 scale(vec3 s) {\nreturn mat4(\ns.x, 0, 0, 0,\n0, s.y, 0, 0,\n0, 0, s.z, 0,\n0, 0, 0, 1\n);\n}"},function(e,t){e.exports="${import: translation, rotation, scale}\nmat4 transform(vec3 s, vec4 r, vec3 t) {\nreturn translation(t) * rotationFromQuaternion(r) * scale(s);\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);r(9).ShaderModule.register({moduleId:"packFloat",description:"\nThis provides the ability to pack\na float value into a color RGBA\nvalue. This is used to bypass the\nlack of support for float textures.\n\nConstants:\nfloat currentTime;\nfloat currentFrame;\n",content:r(274),compatibility:n.ShaderInjectionTarget.ALL})},function(e,t){e.exports="vec4 bitSh = vec4(16777216., 65536., 256., 1.);\nvec4 bitMsk = vec4(0., vec3(1. / 256.0));\nvec4 bitShifts = vec4(1.) / vec4(16777216., 65536., 256., 1.);\nvec4 packFloat(float value, float range) {\nvalue = (value + range) / (range * 2.);\nvec4 comp = fract(value * bitSh);\ncomp -= comp.xxyz * bitMsk;\nreturn comp;\n}\nfloat unpackFloat(vec4 color, float range) {\nreturn dot(color , bitShifts) * (range * 2.) - range;\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);r(9).ShaderModule.register([{moduleId:"picking",description:"Internal use only. Provides methods\nand constants to make the picking processes work.",content:r(276),compatibility:n.ShaderInjectionTarget.VERTEX,instanceAttributes:function(e){return[{name:"_pickingColor",size:n.InstanceAttributeSize.FOUR,update:function(e){var t=16777215-e.uid;return[((16711680&t)>>16)/255,((65280&t)>>8)/255,(255&t)/255,1]}}]}}])},function(e,t){e.exports="varying highp vec4 _picking_color_pass_;"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i="\nMakes a no-op shader where gl_Position\nis [0, 0, 0, 0] and gl_FragColor is\n[0, 0, 0, 0].\n\nYou can not import this if you specify\nyour own main() method.\n";r(9).ShaderModule.register([{moduleId:"no-op",description:i,content:r(278),compatibility:n.ShaderInjectionTarget.VERTEX},{moduleId:"no-op",description:i,content:r(279),compatibility:n.ShaderInjectionTarget.FRAGMENT}])},function(e,t){e.exports="void main() {\ngl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n}"},function(e,t){e.exports="void main() {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(22),i=r(6),o=r(33),a=r(0);o.ShaderModule.register([{moduleId:"world2DXZ",description:"\nThis is a special helper module used by\nthe system to map View2D content into\na 3D world space. The system utilizes\nthis module automatically for you when\nyou utilize createLayer2Din3D.\n",content:r(281),compatibility:a.ShaderInjectionTarget.ALL,uniforms:function(e){return e instanceof i.Layer2D?e.props.control2D?[{name:"projection",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"view",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"cameraOffset",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof n.Control2D?e.props.control2D.offset:[0,0,0]}},{name:"cameraPosition",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraScale2D",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof n.Control2D?e.props.control2D.scale:[1,1,1]}},{name:"cameraRotation",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"viewSize",size:a.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:a.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requesed the module world2DXZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}}])},function(e,t){e.exports="vec3 cameraSpace(vec3 world) {\nreturn (world + cameraOffset) * cameraScale2D;\n}\nvec3 cameraSpaceSize(vec3 worldSize) {\nreturn worldSize * cameraScale2D;\n}\nvec4 clipSpace(vec3 world) {\nreturn ((projection * view) * vec4(cameraSpace(world.xzy), 1.0));\n}\nvec4 clipSpaceSize(vec3 worldSize) {\nreturn ((projection * view) * vec4(cameraSpaceSize(worldSize.xzy), 0.0));\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(41),i=r(6),o=r(33),a=r(0);o.ShaderModule.register([{moduleId:"world2DYZ",description:"\nThis is a special helper module used by\nthe system to map View2D content into\na 3D world space. The system utilizes\nthis module automatically for you when\nyou utilize createLayer2Din3D.\n",content:r(283),compatibility:a.ShaderInjectionTarget.ALL,uniforms:function(e){return e instanceof i.Layer2D?e.props.control2D?[{name:"projection",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"view",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"cameraOffset",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof n.Control2D?e.props.control2D.offset:[0,0,0]}},{name:"cameraPosition",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraScale2D",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof n.Control2D?e.props.control2D.scale:[1,1,1]}},{name:"cameraRotation",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"viewSize",size:a.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:a.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requesed the module world2DYZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}}])},function(e,t){e.exports="vec3 cameraSpace(vec3 world) {\nreturn (world + cameraOffset) * cameraScale2D;\n}\nvec3 cameraSpaceSize(vec3 worldSize) {\nreturn worldSize * cameraScale2D;\n}\nvec4 clipSpace(vec3 world) {\nreturn ((projection * view) * vec4(cameraSpace(world.zyx), 1.0));\n}\nvec4 clipSpaceSize(vec3 worldSize) {\nreturn ((projection * view) * vec4(cameraSpaceSize(worldSize.zyx), 0.0));\n}"},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(123),t),i(r(285),t),i(r(124),t),i(r(123),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLayer2Din3D=t.Axis2D=void 0;var n,i=r(22),o=r(18);!function(e){e[e.XY=0]="XY",e[e.XZ=1]="XZ",e[e.YZ=2]="YZ"}(n=t.Axis2D||(t.Axis2D={})),t.createLayer2Din3D=function(e,t,r){var a;if(!(t===i.Layer2D||t.prototype instanceof i.Layer2D))return console.warn("A Layer type was specified for createLayer2din3D that is NOT a Layer2D type, which is invalid.","The layer will be used without being modified."),(0,o.createLayer)(t,r);switch(e){case n.XY:a="world2DXY";break;case n.XZ:a="world2DXZ";break;case n.YZ:a="world2DYZ";break;default:return(0,o.createLayer)(t,r)}var s=Object.assign({},r,{baseShaderModules:function(e,t){var r=t.vs.indexOf("world2D");return r>=0&&t.vs.splice(r,1,a),(r=t.fs.indexOf("world2D"))>=0&&t.fs.splice(r,1,a),t}});return(0,o.createLayer)(t,s)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=r(33),o=r(0),a=r(3),s=r(126);i.ShaderModule.register({moduleId:"parent-transform",description:"\nWhen working with SceneGraphLayers, the\nlayer can have a transform applied to\nthe layer. This makes that transform\navailable in the parentTransform\nconstant.\n\nmat4 parentTransform;\n",compatibility:o.ShaderInjectionTarget.VERTEX,content:"",uniforms:function(e){var t=e;if(!(t instanceof s.SceneGraphLayer))return console.warn("A shader requested the module parent-transform; however, the layer the","shader is generated from is NOT a SceneGraphLayer which is","required for the module to work."),[];var r=(0,n.identity4)();return[(0,a.createUniform)({name:"parentTransform",size:o.UniformSize.MATRIX4,update:function(){var e;return(null===(e=t.props.parent)||void 0===e?void 0:e.matrix)||r}})]}})},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Transform2D=void 0;var o=r(12),a=r(53),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"isQueuedForUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(t,"needsWorldOrientation",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(t,"needsWorldDecomposition",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(t,"_instance",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(t,"_matrix",{enumerable:!0,configurable:!0,writable:!0,value:{value:(0,o.identity4)()}}),Object.defineProperty(t,"_localMatrix",{enumerable:!0,configurable:!0,writable:!0,value:{value:t._matrix.value}}),Object.defineProperty(t,"_position",{enumerable:!0,configurable:!0,writable:!0,value:{value:[0,0,0]}}),Object.defineProperty(t,"_localPosition",{enumerable:!0,configurable:!0,writable:!0,value:{value:t._position.value}}),Object.defineProperty(t,"_rotation",{enumerable:!0,configurable:!0,writable:!0,value:{value:(0,o.oneQuat)()}}),Object.defineProperty(t,"_localRotation",{enumerable:!0,configurable:!0,writable:!0,value:{value:0}}),Object.defineProperty(t,"localRotationMatrix",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.identity2)()}),Object.defineProperty(t,"_scale",{enumerable:!0,configurable:!0,writable:!0,value:{value:[1,1,1]}}),Object.defineProperty(t,"_localScale",{enumerable:!0,configurable:!0,writable:!0,value:{value:t._scale.value}}),t}return i(t,e),Object.defineProperty(t.prototype,"instance",{set:function(e){this._instance!==e&&this._instance&&(this._instance.transform.instance=null,e&&(e.transform=this)),this._instance=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matrix",{get:function(){return this.update(),this._matrix.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.needsWorldOrientation=!0,this.update(),this._position.value},set:function(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world position is not supported yet. Use localPosition for now."):this.localPosition=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localPosition",{get:function(){return this._localPosition.value},set:function(e){this._localPosition.value[0]=e[0],this._localPosition.value[1]=e[1],this._localPosition.didUpdate=!0,this.invalidate()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.needsWorldOrientation=!0,this.update(),this._rotation.value},set:function(e){console.warn("NOT IMPLEMENTED: Setting world rotation for a 2D transform is not supported yet.")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localRotation",{get:function(){return this._localRotation.value},set:function(e){this._localRotation.value=e,this._localRotation.didUpdate=!0,this.invalidate()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.needsWorldOrientation=!0,this.update(),this._scale.value},set:function(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world scale is not supported yet. Use localScale for now."):this.localScale=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localScale",{get:function(){return this._localScale.value},set:function(e){(0,o.apply2)(this._localScale.value,e[0],e[1]),this._localScale.didUpdate=!0,this.invalidate()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"decomposeWorldMatrix",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this.parent&&this.needsWorldDecomposition&&this.needsWorldOrientation){this.needsWorldDecomposition=!1;var e=this._matrix.value,t=this._position.value,r=this._scale.value;this._position.didUpdate=t[0]!==e[12]||t[1]!==e[13]||t[2]!==e[14],this._position.didUpdate&&(0,o.apply3)(t,e[12],e[13],e[14]);var n=(0,o.length4Components)(e[0],e[1],e[2],e[3]),i=(0,o.length4Components)(e[4],e[5],e[6],e[7]),a=(0,o.length4Components)(e[8],e[9],e[10],e[11]);this._scale.didUpdate=r[0]!==n||r[1]!==i||r[2]!==a,(0,o.apply3)(r,n,i,a),this._scale.didUpdate=!0;var s=this._rotation.value,u=s[0],c=s[1],l=s[2],f=s[3];(0,o.decomposeRotation)(this._matrix.value,n,i,a,this._rotation.value);var d=this._rotation.value;this._rotation.didUpdate=d[0]!==u||d[1]!==c||d[2]!==l||d[3]!==f}}}),Object.defineProperty(t.prototype,"queueForUpdate",{enumerable:!1,configurable:!0,writable:!0,value:function(){!this.isQueuedForUpdate&&this._instance&&this._instance.active&&(this.isQueuedForUpdate=!0,(0,a.scheduleUpdate)(this))}}),Object.defineProperty(t.prototype,"update",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=!1;if(this.isQueuedForUpdate&&((0,a.resolveUpdate)(this),this.isQueuedForUpdate=!1),this.needsUpdate){var r=this.localRotationMatrix;this._localRotation.didUpdate&&(0,o.rotation2x2)(this._localRotation.value,r),(0,o.SRT4x4_2D)(this._localScale.value,r,this._localPosition.value,this._localMatrix.value),this._localMatrix.didUpdate=!0,t=!0}this.parent&&(this.parent.needsUpdate?(e||this.processParentUpdates((function(e){e.update(!0)})),t=!0):this.parent.childUpdate.has(this)&&(t=!0),t&&((0,o.multiply4x4)(this.parent._matrix.value,this._localMatrix.value,this._matrix.value),this._matrix.didUpdate=!0,this.needsWorldDecomposition=!0)),this.decomposeWorldMatrix(),this._instance&&this._instance.active&&(this._localRotation.didUpdate&&(this._instance._localRotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._localPosition=this._localPosition.value),this._localScale.didUpdate&&(this._instance._localScale=this._localScale.value),this.parent?(this._rotation.didUpdate&&(this._instance._rotation=this._rotation.value),this._scale.didUpdate&&(this._instance._scale=this._scale.value),this._position.didUpdate&&(this._instance._position=this._position.value)):(this._localRotation.didUpdate&&(this._instance._rotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._position=this._localPosition.value),this._localScale.didUpdate&&(this._instance._scale=this._localScale.value)),(this._matrix.didUpdate||this._localMatrix.didUpdate)&&(this._instance.transform=this)),this._localScale.didUpdate=!1,this._localRotation.didUpdate=!1,this._localPosition.didUpdate=!1,this._rotation.didUpdate=!1,this._scale.didUpdate=!1,this._position.didUpdate=!1,this._matrix.didUpdate=!1,this._localMatrix.didUpdate=!1,this.resolve()}}),t}(r(54).TreeNode);t.Transform2D=s},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(289),t)},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(290),t),i(r(293),t)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.CubeLayer=void 0;var o=r(4),a=r(1),s=r(37),u=r(0),c=r(3),l=r(125),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=[1,1,1],t=[1,1,-1],n=[1,-1,-1],i=[1,-1,1],a=[-1,1,1],s=[-1,1,-1],f=[-1,-1,-1],d=[-1,-1,1],p=[e,t,n,e,n,i,a,e,i,a,i,d,a,f,s,a,d,f,s,n,t,s,f,n,a,t,e,a,s,t,d,i,n,d,n,f],h=[1,0,0],b=[0,0,1],g=[-1,0,0],v=[0,0,-1],y=[0,1,0],m=[0,-1,0],w=[h,h,h,h,h,h,b,b,b,b,b,b,g,g,g,g,g,g,v,v,v,v,v,v,y,y,y,y,y,y,m,m,m,m,m,m],O=[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,0],[1,1],[0,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]];return{drawMode:o.GLSettings.Model.DrawMode.TRIANGLES,fs:[{outputType:u.FragmentOutputType.COLOR,source:r(291)}],instanceAttributes:[(0,c.createAttribute)({name:"transform",size:u.InstanceAttributeSize.MAT4X4,update:function(e){return(e.transform||l.IdentityTransform).matrix}}),(0,c.createAttribute)({name:"size",size:u.InstanceAttributeSize.THREE,update:function(e){return e.size}})],uniforms:[],vertexAttributes:[{name:"position",size:u.VertexAttributeSize.THREE,update:function(e){return p[e]}},{name:"normal",size:u.VertexAttributeSize.THREE,update:function(e){return w[e]}},{name:"texCoord",size:u.VertexAttributeSize.TWO,update:function(e){return O[e]}}],vertexCount:36,vs:r(292)}}}),Object.defineProperty(t.prototype,"getMaterialOptions",{enumerable:!1,configurable:!0,writable:!0,value:function(){return Object.assign({},c.CommonMaterialOptions.transparentShapeBlending,{cullSide:o.GLSettings.Material.CullSide.CCW})}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{data:new a.InstanceProvider,key:"",materialOptions:c.CommonMaterialOptions.transparentShapeBlending}}),t}(s.Layer);t.CubeLayer=f},function(e,t){e.exports="varying vec2 _texCoord;\nvoid main() {\ngl_FragColor = mix(\nvec4(1.0, 0.0, 0.0, 1.0),\nvec4(0.0, 0.0, 0.0, 1.0),\nfloat(_texCoord.x <= 0.01 || _texCoord.x > 0.99 || _texCoord.y < 0.01 || _texCoord.y > 0.99)\n);\n}"},function(e,t){e.exports="${import: projection}\nvarying vec2 _texCoord;\nvoid main() {\nvec4 pos = vec4(position * size, 1.0);\nvec4 world = transform * pos;\n_texCoord = texCoord;\ngl_Position = clipSpace(world.xyz);\n}"},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.CubeInstance=void 0;var a=r(1),s=function(e){function t(r){var n=e.call(this,r)||this;return Object.defineProperty(n,"size",{enumerable:!0,configurable:!0,writable:!0,value:[1,1,1]}),Object.defineProperty(n,"color",{enumerable:!0,configurable:!0,writable:!0,value:[1,1,1,1]}),(0,a.makeObservable)(n,t),n.size=r.size||n.size,n.color=r.color||n.color,n}return i(t,e),o([a.observable],t.prototype,"size",void 0),o([a.observable],t.prototype,"color",void 0),t}(r(127).Instance3D);t.CubeInstance=s},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(295),t)},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.BasicSurface=t.createScene=void 0;var s=r(296),u=r(34),c=r(1),l=r(7),f=r(13),d=r(0),p=r(3),h=r(101);function b(e,t){for(var r=[],n=Object.values(t),i=0;i<n.length;++i){var o=n[i];o instanceof e?r.push(o):n.push.apply(n,Object.values(o))}return r}function g(e,t,r,n){for(var i=new Set,o=[],s=Object.keys(r).map((function(e){return[e,r[e]]})),u=function(r){var u=s[r];if(t(u[1]))o.push(n(u[0],u[1]));else{var c=!1,l=[];if(Object.keys(u[1]).forEach((function(t){var r=u[1][t];i.has(r)?(c=!0,console.warn("Invalid lookup for BasicSurface detected:",e)):(l.push(["".concat(u[0],".").concat(t),r]),i.add(r))})),l.length>0&&s.splice.apply(s,a([r+1,0],l,!1)),c)return"break"}},c=0;c<s.length;++c){if("break"===u(c))break}return o}t.createScene=function(e){return e};var v=function(){function e(e){var t=this;Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"drawRequestId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"resizeTimer",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"visibility",{enumerable:!0,configurable:!0,writable:!0,value:"visible"}),Object.defineProperty(this,"waitForSize",{enumerable:!0,configurable:!0,writable:!0,value:(0,h.waitForValidDimensions)()}),Object.defineProperty(this,"cameras",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"base",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventManagers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"providers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scenes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ready",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"resources",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"destroy",{enumerable:!0,configurable:!0,writable:!0,value:function(){t.base&&(t.base.destroy(),delete t.base),t.context&&(t.context.remove(),delete t.context),(0,p.stopAnimationLoop)(t.drawRequestId),window.removeEventListener("resize",t.handleResize)}}),Object.defineProperty(this,"draw",{enumerable:!0,configurable:!0,writable:!0,value:function(e){return i(t,void 0,void 0,(function(){return o(this,(function(t){return this.base?(this.currentTime=e,this.base.draw(e),[2]):[2]}))}))}}),Object.defineProperty(this,"handleResize",{enumerable:!0,configurable:!0,writable:!0,value:function(){clearTimeout(t.resizeTimer),t.base&&(t.resizeTimer=window.setTimeout((function(){t.fitContainer()}),100))}}),Object.defineProperty(this,"handleVisibility",{enumerable:!0,configurable:!0,writable:!0,value:function(){var e;"visible"===document.visibilityState&&t.visibility!==document.visibilityState&&(null===(e=t.base)||void 0===e||e.redraw()),t.visibility=document.visibilityState}}),this.rebuild(e)}return Object.defineProperty(e.prototype,"createContext",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.context||(this.context=document.createElement("canvas"),this.context.title="",this.context.width=(this.options.container.offsetWidth||0)*window.devicePixelRatio,this.context.height=(this.options.container.offsetHeight||0)*window.devicePixelRatio,this.context.style.width="".concat(this.options.container.offsetWidth||0,"px"),this.context.style.height="".concat(this.options.container.offsetHeight||0,"px"),this.options.container.appendChild(this.context))}}),Object.defineProperty(e.prototype,"init",{enumerable:!1,configurable:!0,writable:!0,value:function(){return i(this,void 0,void 0,(function(){var e,t;return o(this,(function(r){switch(r.label){case 0:return this.base?[2]:[4,this.waitForSize(this.options.container)];case 1:if(!r.sent())return[2];this.createContext(),r.label=2;case 2:return r.trys.push([2,5,,6]),this.providers=this.options.providers,this.cameras=this.options.cameras,this.resources=this.options.resources||{},this.eventManagers=this.options.eventManagers(this.cameras),e=this,[4,new f.Surface({context:this.context,handlesWheelEvents:void 0===this.options.handlesWheelEvents||this.options.handlesWheelEvents,pixelRatio:window.devicePixelRatio,eventManagers:b(u.EventManager,this.eventManagers),rendererOptions:Object.assign({alpha:!0,antialias:!1},this.options.rendererOptions)}).ready];case 3:return e.base=r.sent(),this.fitContainer(!0),this.drawRequestId=(0,p.onAnimationLoop)(this.draw),[4,this.updatePipeline()];case 4:return r.sent(),window.addEventListener("resize",this.handleResize),document.addEventListener("visibilitychange",this.handleVisibility),[3,6];case 5:return(t=r.sent()).error===d.SurfaceErrorType.NO_WEBGL_CONTEXT?this.options.onNoWebGL&&this.options.onNoWebGL():(console.error("The Basic Surface could not be initialized"),console.error(t.stack||t.message)),[3,6];case 6:return[2]}}))}))}}),Object.defineProperty(e.prototype,"fitContainer",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t;this.base&&(null===(t=this.context)||void 0===t||t.remove(),this.base.resize(this.options.container.offsetWidth||0,this.options.container.offsetHeight||0),this.context&&this.options.container.appendChild(this.context),e||this.base.draw(this.currentTime))}}),Object.defineProperty(e.prototype,"getViewProjections",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.base?this.base.getProjections(e):null}}),Object.defineProperty(e.prototype,"getViewScreenSize",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!this.base)return[0,0];var t;if((0,s.isString)(e)){if(!(t=this.base.getViewSize(e)))return[0,0]}else if(!(t=this.base.getViewSize(e(this.scenes).init[1].key)))return[0,0];return[t.width,t.height]}}),Object.defineProperty(e.prototype,"getViewScreenBounds",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!this.base)return new l.Bounds({x:0,y:0,width:0,height:0});var t=this.base.getViewWorldBounds(e);return t||new l.Bounds({x:0,y:0,width:0,height:0})}}),Object.defineProperty(e.prototype,"getViewWorldBounds",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!this.base)return new l.Bounds({x:0,y:0,width:0,height:0});var t=this.base.getViewWorldBounds(e);return t||new l.Bounds({x:0,y:0,width:0,height:0})}}),Object.defineProperty(e.prototype,"pipeline",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.options.scenes=e,this.base?[4,this.updatePipeline()]:[2];case 1:return t.sent(),[2]}}))}))}}),Object.defineProperty(e.prototype,"rebuild",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return i(this,void 0,void 0,(function(){var t,r,n,i,a;return o(this,(function(o){switch(o.label){case 0:if("boolean"==typeof e){if(e&&this.providers)for(r=b(c.InstanceProvider,this.providers),n=0,i=r.length;n<i;++n)r[n].clear()}else t=e;return this.options&&t&&console.warn("Ignoring options provided to rebuild method. The constructor is the only way to apply an options configuration object"),this.base&&this.base.destroy(),this.context&&(this.context.remove(),delete this.context),!this.options&&t&&(this.options=t),a=new p.PromiseResolver,this.ready=a.promise,[4,this.init()];case 1:return o.sent(),a.resolve(this),[2]}}))}))}}),Object.defineProperty(e.prototype,"setContainer",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.options.container=e,this.context&&e.appendChild(this.context),this.fitContainer()}}),Object.defineProperty(e.prototype,"updatePipeline",{enumerable:!1,configurable:!0,writable:!0,value:function(){return i(this,void 0,void 0,(function(){var e,t,r,i;return o(this,(function(o){switch(o.label){case 0:return this.base?(e=g("resources",(function(e){return e&&void 0!==e.type}),this.resources||[],(function(e,t){var r=n(n({},t),{key:t.key||e});return t.key=r.key,r}))||[],t=this.options.scenes(this.resources||{},this.providers,this.cameras,this.eventManagers),this.scenes=t,r=g("scenes",(function(e){return e&&void 0!==e.views&&void 0!==e.layers}),t,(function(e,t){var r=g("views",(function(e){return e&&void 0!==e.init&&2===e.init.length}),t.views,(function(t,r){var i=n(n({},r),{key:"".concat(e,".").concat(r.key||t)});return i.init[1]=n(n({},i.init[1]),{key:i.key}),i})),i=g("layers",(function(e){return e&&void 0!==e.init}),t.layers,(function(e,t){var r={init:t.init,key:t.key||e};return t.init[1].key=r.key,r})),o={key:e,order:t.order,views:r,layers:i};return void 0===t.order&&delete o.order,o})),i={resources:e,scenes:r},[4,this.base.pipeline(i)]):[2];case 1:return[2,o.sent()]}}))}))}}),e}();t.BasicSurface=v},function(e,t,r){(function(e){var n=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[t[n]]=Object.getOwnPropertyDescriptor(e,t[n]);return r},i=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(s(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,o=n.length,a=String(e).replace(i,(function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),u=n[r];r<o;u=n[++r])b(u)||!w(u)?a+=" "+u:a+=" "+s(u);return a},t.deprecate=function(r,n){if(void 0!==e&&!0===e.noDeprecation)return r;if(void 0===e)return function(){return t.deprecate(r,n).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(n);e.traceDeprecation?console.trace(n):console.error(n),i=!0}return r.apply(this,arguments)}};var o,a={};function s(e,r){var n={seen:[],stylize:c};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),h(r)?n.showHidden=r:r&&t._extend(n,r),y(n.showHidden)&&(n.showHidden=!1),y(n.depth)&&(n.depth=2),y(n.colors)&&(n.colors=!1),y(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),l(n,e,n.depth)}function u(e,t){var r=s.styles[t];return r?"["+s.colors[r][0]+"m"+e+"["+s.colors[r][1]+"m":e}function c(e,t){return e}function l(e,r,n){if(e.customInspect&&r&&T(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,e);return v(i)||(i=l(e,i,n)),i}var o=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(v(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(g(t))return e.stylize(""+t,"number");if(h(t))return e.stylize(""+t,"boolean");if(b(t))return e.stylize("null","null")}(e,r);if(o)return o;var a=Object.keys(r),s=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(r)),_(r)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return f(r);if(0===a.length){if(T(r)){var u=r.name?": "+r.name:"";return e.stylize("[Function"+u+"]","special")}if(m(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(O(r))return e.stylize(Date.prototype.toString.call(r),"date");if(_(r))return f(r)}var c,w="",P=!1,x=["{","}"];(p(r)&&(P=!0,x=["[","]"]),T(r))&&(w=" [Function"+(r.name?": "+r.name:"")+"]");return m(r)&&(w=" "+RegExp.prototype.toString.call(r)),O(r)&&(w=" "+Date.prototype.toUTCString.call(r)),_(r)&&(w=" "+f(r)),0!==a.length||P&&0!=r.length?n<0?m(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),c=P?function(e,t,r,n,i){for(var o=[],a=0,s=t.length;a<s;++a)S(t,String(a))?o.push(d(e,t,r,n,String(a),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(d(e,t,r,n,i,!0))})),o}(e,r,n,s,a):a.map((function(t){return d(e,r,n,s,t,P)})),e.seen.pop(),function(e,t,r){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(c,w,x)):x[0]+w+x[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,r,n,i,o){var a,s,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),S(n,i)||(a="["+i+"]"),s||(e.seen.indexOf(u.value)<0?(s=b(r)?l(e,u.value,null):l(e,u.value,r-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),y(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function p(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function b(e){return null===e}function g(e){return"number"==typeof e}function v(e){return"string"==typeof e}function y(e){return void 0===e}function m(e){return w(e)&&"[object RegExp]"===P(e)}function w(e){return"object"==typeof e&&null!==e}function O(e){return w(e)&&"[object Date]"===P(e)}function _(e){return w(e)&&("[object Error]"===P(e)||e instanceof Error)}function T(e){return"function"==typeof e}function P(e){return Object.prototype.toString.call(e)}function x(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(r){if(y(o)&&(o=e.env.NODE_DEBUG||""),r=r.toUpperCase(),!a[r])if(new RegExp("\\b"+r+"\\b","i").test(o)){var n=e.pid;a[r]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",r,n,e)}}else a[r]=function(){};return a[r]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=p,t.isBoolean=h,t.isNull=b,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=y,t.isRegExp=m,t.isObject=w,t.isDate=O,t.isError=_,t.isFunction=T,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=r(297);var E=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function j(){var e=new Date,t=[x(e.getHours()),x(e.getMinutes()),x(e.getSeconds())].join(":");return[e.getDate(),E[e.getMonth()],t].join(" ")}function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",j(),t.format.apply(t,arguments))},t.inherits=r(298),t._extend=function(e,t){if(!t||!w(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e};var R="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function M(e,t){if(!e){var r=new Error("Promise was rejected with a falsy value");r.reason=e,e=r}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(R&&e[R]){var t;if("function"!=typeof(t=e[R]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,R,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,r,n=new Promise((function(e,n){t=e,r=n})),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push((function(e,n){e?r(e):t(n)}));try{e.apply(this,i)}catch(e){r(e)}return n}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),R&&Object.defineProperty(t,R,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,n(e))},t.promisify.custom=R,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function r(){for(var r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);var i=r.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var o=this,a=function(){return i.apply(o,arguments)};t.apply(this,r).then((function(t){e.nextTick(a,null,t)}),(function(t){e.nextTick(M,t,a)}))}return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.defineProperties(r,n(t)),r}}).call(this,r(70))},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(300),t)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.debugLayer=void 0;var o=r(1),a=r(13),s=r(18),u=function(e){function t(t,r,n){var i=e.call(this,t,r,n)||this;return console.warn("Please ensure all debugLayer calls are removed for production:",n.key),i}return i(t,e),Object.defineProperty(t.prototype,"childLayers",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.props.wrap?(this.props.wrap.init[1].key="debug-wrapper.".concat(this.props.key),[this.props.wrap]):[]}}),Object.defineProperty(t.prototype,"draw",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(this.props.wrap){var e=this.resolveChanges(!0);if(0!==e.length){var t=this.props.messageHeader,r=void 0===t?function(){return""}:t;console.warn("".concat(r(),"\n"),{totalChanges:e.length,changes:e})}}}}),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){if(!this.props.wrap)return null;for(var e=new this.props.wrap.init[0](this.surface,this.scene,this.props.wrap.init[1]),t=e.childLayers(),r={};t.length>0;){var n=t.pop();if(n){var i=new n.init[0](this.surface,this.scene,n.init[1]);r[i.id]={shaderIO:i.initShader()},i.childLayers().forEach((function(e){return t.push(e)}))}}return console.warn("Shader IO: ".concat(this.id,"\n"),{shaderIO:e.initShader(),childLayers:r}),null}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{data:new o.InstanceProvider,key:"default",messageHeader:function(){return""},wrap:(0,s.createLayer)(a.Layer,{data:new o.InstanceProvider,scene:"default"})}}),t}(a.Layer);t.debugLayer=function(e,t){var r=(0,s.createLayer)(u,{messageHeader:function(){return"CHANGES FOR: ".concat(r.init[1].key)},wrap:(0,s.createLayer)(e,t),data:t.data});return r}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(25),t),i(r(128),t),i(r(305),t),i(r(306),t),i(r(311),t)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.PostProcessLayer=void 0;var a=r(4),s=r(15),u=r(1),c=r(50),l=r(13),f=r(0),d=r(3),p=r(303),h=function(e){function t(){var r=e.call(this)||this;return Object.defineProperty(r,"tint",{enumerable:!0,configurable:!0,writable:!0,value:[1,1,1,1]}),Object.defineProperty(r,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,u.makeObservable)(r,t),r}return i(t,e),o([u.observable],t.prototype,"tint",void 0),t}(u.Instance),b=new s.Texture({data:{width:2,height:2,buffer:new Uint8Array(16)}}),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),Object.defineProperty(t.prototype,"initShader",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=this.props,n=t.buffers,i=t.fs,o=new h,s=[[-1,-1],[1,-1],[-1,1],[1,1]],u=s.map((function(e){return[1===e[0]?1:0,1===e[1]?1:0]})),l=(0,p.flatten2D)(Object.keys(n).map((function(t){var r=n[t];if(r){var i=r.key,a=(0,c.textureRequest)({key:i});return[{name:t,shaderInjection:f.ShaderInjectionTarget.FRAGMENT,size:f.UniformSize.TEXTURE,update:function(){return e.resource.request(e,o,a),a.texture||b}},{name:"".concat(t,"_size"),shaderInjection:f.ShaderInjectionTarget.FRAGMENT,size:f.UniformSize.TWO,update:function(){e.resource.request(e,o,a);var t=(a.texture||b).data;return[(null==t?void 0:t.width)||1,(null==t?void 0:t.height)||1]}}]}})).filter(d.isDefined));return{drawMode:a.GLSettings.Model.DrawMode.TRIANGLE_STRIP,instanceAttributes:[{name:"tint",size:f.InstanceAttributeSize.FOUR,update:function(e){return e.tint}}],uniforms:l.concat(this.props.uniforms||[]),vertexAttributes:[{name:"vertex",size:f.VertexAttributeSize.TWO,update:function(e){return s[e]}},{name:"tex",size:f.VertexAttributeSize.TWO,update:function(e){return u[e]}}],vertexCount:4,vs:r(304),fs:i}}}),Object.defineProperty(t.prototype,"getMaterialOptions",{enumerable:!1,configurable:!0,writable:!0,value:function(){return d.CommonMaterialOptions.transparentImageBlending}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{key:"",data:new u.InstanceProvider([new h]),buffers:{},fs:"void main() { gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);"}}),t}(l.Layer);t.PostProcessLayer=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.flatten2D=void 0,t.flatten2D=function(e){for(var t=[],r=0,n=e.length;r<n;++r)for(var i=e[r],o=0,a=i.length;o<a;++o)t.push(i[o]);return t}},function(e,t){e.exports="varying vec2 texCoord;\nvoid main() {\ngl_Position = vec4(vertex, 0.0, 1.0);\ntexCoord = tex;\n}"},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ViewScreen=void 0;var o=r(7),a=r(2),s=r(13),u=r(16),c=r(128);function l(e){return e.projectionType===u.CameraProjectionType.ORTHOGRAPHIC}var f=function(e){function t(t,r){var n=e.call(this,t,r)||this;return Object.defineProperty(n,"projection",{enumerable:!0,configurable:!0,writable:!0,value:new c.ProjectionScreen}),n}return i(t,e),Object.defineProperty(t.prototype,"fitViewtoViewport",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(l(this.props.camera)){var r=t.width,n=t.height,i={bottom:-n/2,far:1e7,left:-r/2,near:-100,right:r/2,top:n/2},s=1/this.pixelRatio,u=1/this.pixelRatio,c=this.props.camera;c.projectionOptions=Object.assign(c.projectionOptions,i),c.position=[t.width/(2*this.pixelRatio),t.height/(2*this.pixelRatio),c.position[2]],c.scale=[s,-u,1],c.lookAt((0,a.add3)(c.position,[0,0,-1]),[0,1,0]),c.update(),this.projection.viewBounds=t,t.d=this,this.projection.screenBounds=new o.Bounds({height:this.viewBounds.height/this.pixelRatio,width:this.viewBounds.width/this.pixelRatio,x:this.viewBounds.x/this.pixelRatio,y:this.viewBounds.y/this.pixelRatio}),this.screenBounds.d=this}else l(this.props.camera)||console.warn("ViewScreen does not support non-orthographic cameras.")}}),Object.defineProperty(t.prototype,"willUpdateProps",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{key:"",camera:u.Camera.makeOrthographic(),viewport:{left:0,right:0,bottom:0,top:0}}}),t}(s.View);t.ViewScreen=f},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.PostEffect=void 0,i(r(129),t),i(r(130),t),i(r(66),t),i(r(131),t),i(r(132),t);var o=r(131),a=r(66),s=r(132),u=r(129),c=r(130);t.PostEffect={bloom:o.bloom,boxSample:a.boxSample,draw:s.draw,gaussHorizontalBlur:u.gaussHorizontalBlur,gaussVerticalBlur:c.gaussVerticalBlur}},function(e,t){e.exports="${import: camera}\nvarying vec2 texCoord;\nvoid main() {\nfloat dtx = 1.0 / viewSize.x;\nvec3 result = texture2D(color, texCoord).rgb * weight[0];\nfloat index = 1.0;\nvec2 delta = vec2(0.0, 0.0);\nfor(int i = 1; i < weight_length; ++i, index += 1.0) {\ndelta.x = dtx * index;\nresult += texture2D(color, texCoord + delta).rgb * weight[i];\nresult += texture2D(color, texCoord - delta).rgb * weight[i];\n}\ngl_FragColor = vec4(result, 1.0);\n}"},function(e,t){e.exports="${import: camera}\nvarying vec2 texCoord;\nvoid main() {\nfloat dty = 1.0 / viewSize.x;\nvec3 result = texture2D(color, texCoord).rgb * weight[0];\nfloat index = 1.0;\nvec2 delta = vec2(0.0, 0.0);\nfor(int i = 1; i < weight_length; ++i, index += 1.0) {\ndelta.y = dty * index;\nresult += texture2D(color, texCoord + delta).rgb * weight[i];\nresult += texture2D(color, texCoord - delta).rgb * weight[i];\n}\ngl_FragColor = vec4(result, 1.0);\n}"},function(e,t){e.exports="${import: camera}\nvarying vec2 texCoord;\nvoid main() {\nvec2 texelSize = 1.0 / viewSize;\nvec4 o = texelSize.xyxy * vec2(-delta, delta).xxyy;\nvec4 s =\ntexture2D(color, texCoord + o.xy) + texture2D(color, texCoord + o.zy) +\ntexture2D(color, texCoord + o.xw) + texture2D(color, texCoord + o.zw);\ngl_FragColor = s * 0.25;\n}"},function(e,t){e.exports="varying vec2 texCoord;\nvoid main() {\nvec3 result = texture2D(color, texCoord).rgb;\nresult += texture2D(glow, texCoord).rgb * 1.3;\ngl_FragColor = vec4(result, 1.0);\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.commands=void 0;var n=r(22),i=r(13),o=r(18);t.commands=function(e){return{views:{screen:(0,i.createView)(n.View2D,{camera:new n.Camera2D,viewport:{left:0,top:0,width:1,height:1}})},layers:{screen:(0,o.createLayer)(i.CommandLayer,{commands:e})}}}}])}));
//# sourceMappingURL=index.js.map