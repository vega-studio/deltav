!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("three"),require("bowser")):"function"==typeof define&&define.amd?define(["three","bowser"],t):"object"==typeof exports?exports["network-bubble-chart"]=t(require("three"),require("bowser")):e["network-bubble-chart"]=t(e.three,e.bowser)}(window,function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=163)}([function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR"}(t.InstanceBlockIndex||(t.InstanceBlockIndex={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR",e[e.ATLAS=99]="ATLAS"}(i=t.InstanceAttributeSize||(t.InstanceAttributeSize={})),t.instanceAttributeSizeFloatCount=((r={})[i.ONE]=1,r[i.TWO]=2,r[i.THREE]=3,r[i.FOUR]=4,r[i.ATLAS]=4,r),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR",e[e.MATRIX3=9]="MATRIX3",e[e.MATRIX4=16]="MATRIX4",e[e.ATLAS=99]="ATLAS"}(t.UniformSize||(t.UniformSize={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR"}(t.VertexAttributeSize||(t.VertexAttributeSize={})),function(e){e[e.VERTEX=1]="VERTEX",e[e.FRAGMENT=2]="FRAGMENT",e[e.ALL=3]="ALL"}(t.ShaderInjectionTarget||(t.ShaderInjectionTarget={})),function(e){e[e.NONE=0]="NONE",e[e.ALL=1]="ALL",e[e.SINGLE=2]="SINGLE"}(t.PickType||(t.PickType={})),function(e){e[e.CHANGE=0]="CHANGE",e[e.INSERT=1]="INSERT",e[e.REMOVE=2]="REMOVE"}(t.InstanceDiffType||(t.InstanceDiffType={}))},function(t,n){t.exports=e},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(6)),r(n(56)),r(n(159)),r(n(55)),r(n(30)),r(n(158)),r(n(53)),r(n(153)),r(n(17)),r(n(152)),r(n(18)),r(n(13)),r(n(28)),r(n(27))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(19)),r(n(148)),r(n(6))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.x=0,this.y=0,this.width=0,this.height=0,this.x=e.x||e.left||0,this.y=e.y||e.top||0,this.height=e.height||(e.bottom||0)-this.y||0,this.width=e.width||(e.right||0)-this.x||0}return Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mid",{get:function(){return[this.x+this.width/2,this.y+this.height/2]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),e.emptyBounds=function(){return new e({height:0,width:0,x:0,y:0})},e.prototype.containsPoint=function(e){return!(e[0]<this.x||e[1]<this.y||e[0]>this.right||e[1]>this.bottom)},e.prototype.encapsulate=function(t){return t instanceof e?(t.x<this.x&&(this.width+=Math.abs(t.x-this.x),this.x=t.x),t.y<this.y&&(this.height+=Math.abs(t.y-this.y),this.y=t.y),this.right<t.right&&(this.width+=t.right-this.right),this.bottom<t.bottom&&(this.height+=t.bottom-this.bottom),!0):(t[0]<this.x&&(this.width+=this.x-t[0],this.x=t[0]),t[0]>this.right&&(this.width+=t[0]-this.x),t[1]<this.y&&(this.height+=this.y-t[1],this.y=t[1]),t[1]>this.bottom&&(this.height+=t[1]-this.y),!0)},e.prototype.fits=function(e){return this.width===e.width&&this.height===e.height?1:this.width>=e.width&&this.height>=e.height?2:0},e.prototype.hitBounds=function(e){return!(this.right<e.x||this.x>e.right||this.bottom<e.y||this.y>e.height)},e.prototype.isInside=function(e){return this.x>=e.x&&this.right<=e.right&&this.y>=e.y&&this.bottom<=e.bottom},Object.defineProperty(e.prototype,"location",{get:function(){return[this.x,this.y]},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"{x: "+this.x+" y:"+this.y+" w:"+this.width+" h:"+this.height+"}"},e}();t.Bounds=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBufferLocation=function(e){return e&&e.buffer&&e.buffer.value},t.isBufferLocationGroup=function(e){return e&&e.propertyToBufferLocation};var r=function(){return function(e,t){this.layer=e,this.scene=t}}();t.BufferManagerBase=r},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var i=n(57),o=n(19),a=0,s=function(){function e(t){this.changes={},this.property={},this._easing=new Map,this.observableStorage=[],this._uid=e.newUID,this._id=t.id||"",this.active=t.active||this.active}return Object.defineProperty(e,"newUID",{get:function(){return a=++a%16777215},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"observableDisposer",{get:function(){var e=this;return function(){return delete e._observer}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"observer",{get:function(){return this._observer||null},set:function(e){var t=this._observer;t&&t!==e&&(this._easing.clear(),t.remove(this)),this._observer=e},enumerable:!0,configurable:!0}),e.prototype.clearEasing=function(){this._easing.clear(),delete this.easingId},Object.defineProperty(e.prototype,"easing",{get:function(){return this._easing},enumerable:!0,configurable:!0}),e.prototype.getEasing=function(e){if(this.easingId){var t=this.easingId[e];if(t){var n=this._easing.get(t);if(n instanceof i.EasingProps)return n}}},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),e.prototype.resourceTrigger=function(){console.warn("resourceTrigger called on an instance that did not override resourceTrigger. resourceTrigger MUST be overridden for instances","that utilize a resource. The observable that is tied to committing the resource should be 'triggered' in this method.")},r([o.observable],e.prototype,"active",void 0),r([o.observable],e.prototype,"_uid",void 0),e}();t.Instance=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(0),a=n(2),s=n(16),c=n(147),u=n(139),l=function(e){function t(n){var r=e.call(this,n)||this;r.depth=0,r.instanceById=new Map,r.instanceVertexCount=0,r.needsViewDrawn=!1,r.animationEndTime=0,r.props=Object.assign({},t.defaultProps||{},n);var i=r.props.picking,s=void 0===i?o.PickType.NONE:i;if(s===o.PickType.ALL){var c=r.getInstancePickingMethods();r.picking={currentPickMode:o.PickType.NONE,hitTest:c.hitTest,quadTree:new a.TrackedQuadTree(0,1,0,1,c.boundsAccessor),type:o.PickType.ALL}}else s===o.PickType.SINGLE?r.picking={currentPickMode:o.PickType.NONE,type:o.PickType.SINGLE,uidToInstance:new Map}:r.picking={currentPickMode:o.PickType.NONE,type:o.PickType.NONE};return r}return r(t,e),Object.defineProperty(t.prototype,"bufferManager",{get:function(){return this._bufferManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0}),t.prototype.baseShaderModules=function(e){var t=[],n=[];return t.push("instancing"),this.picking.type===o.PickType.SINGLE?(t.push("picking"),n.push("picking")):(t.push("no-picking"),n.push("no-picking")),(e.instanceAttributes||[]).find(function(e){return Boolean(e&&e.easing)})&&t.push("frame"),{fs:n,vs:t}},t.prototype.destroy=function(){this.bufferManager&&(this.bufferManager.scene&&this.bufferManager.scene.removeLayer(this),this.bufferManager.removeFromScene(),this.bufferManager.destroy())},t.prototype.didUpdateProps=function(){},t.prototype.draw=function(){var e,t,n,r=this.props.data.changeList;r.length>0&&(this.needsViewDrawn=!0);var i=this.diffManager,o=i.processing,a=i.processor;a.incomingChangeList(r);for(var s=0,c=r.length;s<c;++s)t=(e=r[s])[0],n=this.bufferManager.getBufferLocations(t),o[e[1]](a,t,Object.values(e[2]),n),t.changes={};a.commit(),this.props.data.resolve(this.id),this.updateUniforms()},t.prototype.getInstancePickingMethods=function(){throw new Error("When picking is set to PickType.ALL, the layer MUST have this method implemented; otherwise, the layer is incompatible with this picking mode.")},t.prototype.getModelType=function(){return{drawMode:i.TrianglesDrawMode,modelType:i.Mesh}},t.prototype.getMaterialOptions=function(){return{}},t.prototype.initShader=function(){return{fs:"${import: no-op}",instanceAttributes:[],uniforms:[],vertexAttributes:[],vertexCount:0,vs:"${import: no-op}"}},t.prototype.makeInstanceAttribute=function(e,t,n,r,i,o){return{atlas:o,block:e,blockIndex:t,name:n,size:r,update:i}},t.prototype.makeUniform=function(e,t,n,r,i){return{name:e,qualifier:i,shaderInjection:r,size:t,update:n}},t.prototype.setBufferManager=function(e){this._bufferManager?console.warn("You can not change a layer's buffer strategy once it has been instantiated."):(this._bufferManager=e,this.diffManager=new c.InstanceDiffManager(this,e),this.diffManager.makeProcessor(),this.interactions=new u.LayerInteractionHandler(this))},t.prototype.setBufferType=function(e){void 0===this._bufferType?this._bufferType=e:console.warn("You can not change a layers buffer strategy once it has been instantiated.")},t.prototype.shouldDrawView=function(e,t){for(var n in t)if(t[n]!==e[n])return!0;return!1},t.prototype.updateUniforms=function(){for(var e,t,n=0,r=this.uniforms.length;n<r;++n)e=this.uniforms[n],t=e.update(e),e.materialUniforms.forEach(function(e){return e.value=t})},t.prototype.willUpdateInstances=function(e){},t.prototype.willUpdateProps=function(e){},t.prototype.didUpdate=function(){this.props.data.resolve(this.id)},t.defaultProps={},t}(s.IdentifyByKey);t.Layer=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.BottomLeft=0]="BottomLeft",e[e.BottomMiddle=1]="BottomMiddle",e[e.BottomRight=2]="BottomRight",e[e.Custom=3]="Custom",e[e.Middle=4]="Middle",e[e.MiddleLeft=5]="MiddleLeft",e[e.MiddleRight=6]="MiddleRight",e[e.TopLeft=7]="TopLeft",e[e.TopMiddle=8]="TopMiddle",e[e.TopRight=9]="TopRight"}(t.AnchorType||(t.AnchorType={})),function(e){e[e.ALWAYS=1]="ALWAYS",e[e.BOUND_MAX=2]="BOUND_MAX",e[e.NEVER=3]="NEVER"}(t.ScaleType||(t.ScaleType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(27),a=n(146),s=n(145),c=n(144),u=n(12)("performance");function l(e,t,n,a){var s=r.UNIFORM,c=0;if(void 0!==t.bufferType)return t.bufferType;if(o.WebGLStat.HARDWARE_INSTANCING){for(var l=0,d=n.length;l<d;++l){var h=n[l];c+=Math.ceil(h.size/4)}for(l=0,d=a.length;l<d;++l){h=a[l];c+=Math.ceil(i.instanceAttributeSizeFloatCount[h.size||1]/4)}if(c>o.WebGLStat.MAX_VERTEX_ATTRIBUTES){c=0;for(l=0,d=a.length;l<d;++l){h=a[l];c=Math.max(c,h.block||0)}for(l=0,d=n.length;l<d;++l){h=n[l];c+=Math.ceil(h.size/4)}c<o.WebGLStat.MAX_VERTEX_ATTRIBUTES&&(s=r.INSTANCE_ATTRIBUTE_PACKING,u("Performance Issue (Moderate):\n          Layer %o is utilizing too many vertex attributes and is now using vertex packing.\n          Max Vertex units %o\n          Used Vertex units %o\n          Instance Attributes %o\n          Vertex Attributes %o",t.id,o.WebGLStat.MAX_VERTEX_ATTRIBUTES,c,a,n))}else s=r.INSTANCE_ATTRIBUTE}return s===r.UNIFORM&&(u("Performance Issue (High):\n      Layer %o is utilizing too many vertex attributes and is now using a uniform buffer.\n      Max Vertex units %o\n      Used Vertex units %o\n      Instance Attributes %o\n      Vertex Attributes %o",t.id,o.WebGLStat.MAX_VERTEX_ATTRIBUTES,c,a,n),s=r.UNIFORM),t.setBufferType(s),s}!function(e){e[e.UNIFORM=0]="UNIFORM",e[e.INSTANCE_ATTRIBUTE=1]="INSTANCE_ATTRIBUTE",e[e.INSTANCE_ATTRIBUTE_PACKING=2]="INSTANCE_ATTRIBUTE_PACKING"}(r=t.LayerBufferType||(t.LayerBufferType={})),t.getLayerBufferType=l,t.makeLayerBufferManager=function(e,t,n){switch(l(0,t,t.vertexAttributes,t.instanceAttributes)){case r.INSTANCE_ATTRIBUTE:t.setBufferManager(new a.InstanceAttributeBufferManager(t,n));break;case r.INSTANCE_ATTRIBUTE_PACKING:t.setBufferManager(new s.InstanceAttributePackingBufferManager(t,n));break;default:t.setBufferManager(new c.UniformBufferManager(t,n))}}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(37)),r(n(36))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(48)),r(n(4)),r(n(132))},function(e,t,n){(function(r){function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(155)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(o=++i)}),e.splice(o,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(156))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Math.sqrt,i=Math.max,o=Math.min;function a(e,t){return[e[0]+t[0]]}function s(e){return[e[0]]}function c(e,t){return[e[0]/t[0]]}function u(e){return[1/e[0]]}function l(e,t){return[e[0]*t]}function d(e,t){return[e[0]-t[0]]}function h(e,t){return[i(e[0],t[0])]}function f(e,t){return[o(e[0],t[0])]}function p(e,t){return[e[0]*t[0]]}function v(e,t){return e[0]*t[0]}function g(e,t,n){return l(a(d(t,e),e),n)}function y(e){return r(v(e,e))}function m(e,t){return[e[0]+t[0],e[1]+t[1]]}function b(e){return[e[0],e[1]]}function w(e,t){return[e[0]/t[0],e[1]/t[1]]}function _(e){return[1/e[0],1/e[1]]}function T(e,t){return[i(e[0],t[0]),i(e[1],t[1])]}function x(e,t){return[o(e[0],t[0]),o(e[1],t[1])]}function A(e,t){return[e[0]*t,e[1]*t]}function I(e,t){return[e[0]-t[0],e[1]-t[1]]}function S(e,t){return[e[0]*t[0],e[1]*t[1]]}function M(e,t){return e[0]*t[0]+e[1]*t[1]}function E(e,t,n){return A(m(I(t,e),e),n)}function O(e){return r(M(e,e))}function P(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function C(e){return[e[0],e[1],e[2]]}function L(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[2]]}function k(e){return[1/e[0],1/e[1],1/e[2]]}function R(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function z(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]}function B(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2]]}function N(e,t,n){return R(P(z(t,e),e),n)}function j(e){return r(U(e,e))}function D(e,t){return[i(e[0],t[0]),i(e[1],t[1]),i(e[2],t[2])]}function F(e,t){return[o(e[0],t[0]),o(e[1],t[1]),o(e[2],t[2])]}function U(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function V(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3]]}function G(e){return[e[0],e[1],e[2],e[3]]}function q(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[2],e[3]/t[3]]}function W(e){return[1/e[0],1/e[1],1/e[2],1/e[3]]}function X(e,t){return[e[0]*t,e[1]*t,e[2]*t,e[3]*t]}function H(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3]]}function $(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3]]}function Q(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Y(e,t,n){return X(V(H(t,e),e),n)}function Z(e){return r(Q(e,e))}function K(e,t){return[i(e[0],t[0]),i(e[1],t[1]),i(e[2],t[2]),i(e[3],t[3])]}function J(e,t){return[o(e[0],t[0]),o(e[1],t[1]),o(e[2],t[2]),o(e[3],t[3])]}t.isVec1=function(e){return e&&Array.isArray(e)&&1===e.length},t.isVec2=function(e){return e&&Array.isArray(e)&&2===e.length},t.isVec3=function(e){return e&&Array.isArray(e)&&3===e.length},t.isVec4=function(e){return e&&Array.isArray(e)&&4===e.length},t.add1=a,t.copy1=s,t.divide1=c,t.inverse1=u,t.scale1=l,t.subtract1=d,t.max1=h,t.min1=f,t.multiply1=p,t.dot1=v,t.linear1=g,t.length1=y,t.vec1=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(n=n||[],(t=Array.isArray(e)?e.slice(0,1):[e]).length<1)for(var i=0,o=n.length;i<o&&t.length<1;++i){var a=n[i];Array.isArray(a)?t.push.apply(t,a.slice(0,1-t.length)):t.push(a)}for(;t.length<1;)t.push(0);return t},t.add2=m,t.copy2=b,t.divide2=w,t.inverse2=_,t.max2=T,t.min2=x,t.scale2=A,t.subtract2=I,t.multiply2=S,t.dot2=M,t.linear2=E,t.length2=O,t.vec2=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(n=n||[],(t=Array.isArray(e)?e.slice(0,2):[e]).length<2)for(var i=0,o=n.length;i<o&&t.length<2;++i){var a=n[i];Array.isArray(a)?t.push.apply(t,a.slice(0,2-t.length)):t.push(a)}for(;t.length<2;)t.push(0);return t},t.add3=P,t.copy3=C,t.divide3=L,t.inverse3=k,t.scale3=R,t.subtract3=z,t.multiply3=B,t.linear3=N,t.length3=j,t.max3=D,t.min3=F,t.dot3=U,t.vec3=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(n=n||[],(t=Array.isArray(e)?e.slice(0,3):[e]).length<3)for(var i=0,o=n.length;i<o&&t.length<3;++i){var a=n[i];Array.isArray(a)?t.push.apply(t,a.slice(0,3-t.length)):t.push(a)}for(;t.length<3;)t.push(0);return t},t.add4=V,t.copy4=G,t.divide4=q,t.inverse4=W,t.scale4=X,t.subtract4=H,t.multiply4=$,t.dot4=Q,t.linear4=Y,t.length4=Z,t.max4=K,t.min4=J,t.vec4=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(n=n||[],(t=Array.isArray(e)?e.slice(0,4):[e]).length<4)for(var i=0,o=n.length;i<o&&t.length<4;++i){var a=n[i];Array.isArray(a)?t.push.apply(t,a.slice(0,4-t.length)):t.push(a)}for(;t.length<4;)t.push(0);return t},t.vec1Methods={add:a,copy:s,divide:c,dot:v,inverse:u,length:y,linear:g,max:h,min:f,multiply:p,scale:l,subtract:d},t.vec2Methods={add:m,copy:b,divide:w,dot:M,inverse:_,length:O,linear:E,max:T,min:x,multiply:S,scale:A,subtract:I},t.vec3Methods={add:P,copy:C,divide:L,dot:U,inverse:k,length:j,linear:N,max:D,min:F,multiply:B,scale:R,subtract:z},t.vec4Methods={add:V,copy:G,divide:q,dot:Q,inverse:W,length:Z,linear:Y,max:K,min:J,multiply:$,scale:X,subtract:H},t.VecMath=function(e){return 1===e.length?t.vec1Methods:2===e.length?t.vec2Methods:3===e.length?t.vec3Methods:t.vec4Methods}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);t.generateLayerModel=function(e,t,n){var i=e.getModelType(),o=new i.modelType(t,n);return function(e){return Boolean(e.isMesh)}(o)&&(o.drawMode=void 0===i.drawMode?r.TriangleStripDrawMode:i.drawMode),o}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(45)),r(n(113)),r(n(43)),r(n(42)),r(n(41)),r(n(112)),r(n(22)),r(n(40))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.key=e.key}return Object.defineProperty(e.prototype,"id",{get:function(){return this.key},enumerable:!0,configurable:!0}),e}();t.IdentifyByKey=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shaderTemplate=function(e){var t=e.shader,n=e.options,r=e.required,i=e.onError,o=e.onToken,a=new Map,s=new Map,c=new Map,u=new Map,l=t.replace(/\$\{([^\}]*)\}/g,function(e,t){var r="";return u.set(t,(u.get(t)||0)+1),t in n?(a.set(t,(a.get(t)||0)+1),r=n[t]):s.set(t,(s.get(t)||0)+1),o&&(r=o(t,r)),r});Object.keys(n).forEach(function(e){a.get(e)||c.set(e,(c.get(e)||0)+1)});var d={resolvedShaderOptions:a,shader:l,shaderProvidedOptions:u,unresolvedProvidedOptions:c,unresolvedShaderOptions:s};return r&&r.values.forEach(function(e){if(d.unresolvedProvidedOptions.get(e)){var t=r.name+": Could not resolve all the required inputs. Input: "+e;i?i(t):console.error(t)}else d.unresolvedShaderOptions.get(e)?(t=r.name+": A required option was not provided in the options parameter. Option: "+e,i?i(t):console.error(t)):d.resolvedShaderOptions.get(e)||(t=r.name+": A required option was not provided in the options parameter. Option: "+e,i?i(t):console.error(t))}),d}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=1;t.uid=function(){return++r};var i=0;t.colorUID=function(){return++i%16777215}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(18),i=function(){function e(){}return e.setObservableMonitor=function(t){e.gatherIds=t,e.observableIds=[]},e.getObservableMonitorIds=function(t){var n=e.observableIds.slice(0);return t&&(e.observableIds=[]),n},e.gatherIds=!1,e.observableIds=[],e.observableNamesToUID=new Map,e}();t.ObservableMonitoring=i,t.observable=function(e,t){var n=i.observableNamesToUID.get(t)||0;n||(n=r.uid(),i.observableNamesToUID.set(t,n)),Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return i.gatherIds&&i.observableIds.push(n),this.observableStorage[n]},set:function(e){this.observableStorage[n]=e,this.changes[n]=n,this.observer&&this.observer.instanceUpdated(this)}})}},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(48),o=n(4),a=n(16),s=n(28);function c(e){return"left"in e}!function(e){e[e.COLOR=1]="COLOR",e[e.DEPTH=2]="DEPTH",e[e.STENCIL=4]="STENCIL"}(t.ClearFlags||(t.ClearFlags={}));var u=function(e){function t(t){var n=e.call(this,t)||this;return n.depth=0,n.pixelRatio=window.devicePixelRatio,n.needsDraw=!1,n.animationEndTime=0,Object.assign(n,t),n}return r(t,e),t.prototype.screenToPixelSpace=function(e,t){var n=t||[0,0];return n[0]=e[0]*this.pixelRatio,n[1]=e[1]*this.pixelRatio,n},t.prototype.pixelSpaceToScreen=function(e,t){var n=t||[0,0];return n[0]=e[0]/this.pixelRatio,n[1]=e[1]/this.pixelRatio,n},t.prototype.screenToView=function(e,t){var n=this.screenToPixelSpace(e,t);return n[0]=n[0]-this.viewBounds.x,n[1]=n[1]-this.viewBounds.y,n},t.prototype.viewToScreen=function(e,t){var n=[0,0];return n[0]=e[0]+this.viewBounds.x,n[1]=e[1]+this.viewBounds.y,this.pixelSpaceToScreen(n,t)},t.prototype.screenToWorld=function(e,t){var n=this.pixelSpaceToScreen(this.screenToView(e)),r=t||[0,0];return r[0]=(n[0]-this.camera.offset[0]*this.camera.scale[0])/this.camera.scale[0],r[1]=(n[1]-this.camera.offset[1]*this.camera.scale[1])/this.camera.scale[1],this.viewCamera.type===s.ViewCameraType.CUSTOM&&console.warn("Custom View Camera projections not supported yet"),r},t.prototype.worldToScreen=function(e,t){var n=[0,0];return n[0]=(e[0]*this.camera.scale[0]+this.camera.offset[0]*this.camera.scale[0])*this.pixelRatio,n[1]=(e[1]*this.camera.scale[1]+this.camera.offset[1]*this.camera.scale[1])*this.pixelRatio,this.viewCamera.type===s.ViewCameraType.CUSTOM&&console.warn("Custom View Camera projections not supported yet"),this.viewToScreen(n,t)},t.prototype.viewToWorld=function(e,t){var n=t||[0,0],r=this.pixelSpaceToScreen(e);return n[0]=(r[0]-this.camera.offset[0]*this.camera.scale[0])/this.camera.scale[0],n[1]=(r[1]-this.camera.offset[1]*this.camera.scale[1])/this.camera.scale[1],this.viewCamera.type===s.ViewCameraType.CUSTOM&&console.warn("Custom View Camera projections not supported yet"),n},t.prototype.worldToView=function(e,t){var n=t||[0,0];return n[0]=e[0]*this.camera.scale[0]+this.camera.offset[0]*this.camera.scale[0],n[1]=e[1]*this.camera.scale[1]+this.camera.offset[1]*this.camera.scale[1],this.viewCamera.type===s.ViewCameraType.CUSTOM&&console.warn("Custom View Camera projections not supported yet"),n},t.prototype.fitViewtoViewport=function(e){if(this.viewCamera.type===s.ViewCameraType.CONTROLLED&&c(this.viewCamera.baseCamera)){var t=i.getAbsolutePositionBounds(this.viewport,e,this.pixelRatio),n=t.width,r=t.height,a={bottom:-r/2,far:1e7,left:-n/2,near:-100,right:n/2,top:r/2},u=this.viewCamera.baseCamera;Object.assign(u,a),u.position.set(-t.width/2*1,t.height/2*1,u.position.z),u.scale.set(1,-1,1),u.updateMatrix(),u.updateMatrixWorld(!0),u.updateProjectionMatrix(),this.viewBounds=t,this.viewBounds.data=this,this.screenBounds=new o.Bounds({height:this.viewBounds.height/this.pixelRatio,width:this.viewBounds.width/this.pixelRatio,x:this.viewBounds.x/this.pixelRatio,y:this.viewBounds.y/this.pixelRatio})}else c(this.viewCamera.baseCamera)||console.warn("Fit to viewport does not support non-orthographic cameras as a default behavior.")},t.DEFAULT_VIEW_ID="__default__",t}(a.IdentifyByKey);t.View=u},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);function o(e,t){return e.depth-t.depth}var a=function(e){function t(t){var n=e.call(this,t)||this;return n.container=new i.Scene,n.pickingContainer=new i.Scene,n.layers=[],n.sortIsDirty=!1,n.viewById=new Map,n.container&&(n.container.frustumCulled=!1,n.container.autoUpdate=!1),n}return r(t,e),t.prototype.addLayer=function(e){this.layers.push(e),this.sortIsDirty=!0},t.prototype.addView=function(e){this.viewById.set(e.id,e)},t.prototype.destroy=function(){delete this.container},t.prototype.removeLayer=function(e){if(this.layers){var t=this.layers.indexOf(e);if(t>=0)return void this.layers.splice(t,1)}console.warn("Could not remove a layer from the scene as the layer was not a part of the scene to start. Scene:",this.id,"Layer:",e.id)},t.prototype.sortLayers=function(){this.sortIsDirty&&this.layers.sort(o)},t.DEFAULT_SCENE_ID="__default__",t}(n(16).IdentifyByKey);t.Scene=a},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){var n=e.call(this)||this;return n.label=t,n}return r(t,e),t}(n(23).BaseAtlasResource);t.LabelAtlasResource=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.sampleScale=1}}();t.BaseAtlasResource=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.SCREEN_CURVE=1]="SCREEN_CURVE"}(t.EdgeScaleType||(t.EdgeScaleType={})),function(e){e[e.LINE=0]="LINE",e[e.BEZIER=1]="BEZIER",e[e.BEZIER2=2]="BEZIER2"}(t.EdgeType||(t.EdgeType={})),function(e){e[e.ALL=0]="ALL",e[e.PASS_Y=1]="PASS_Y",e[e.PASS_X=2]="PASS_X"}(t.EdgeBroadphase||(t.EdgeBroadphase={}))},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(49),o=n(5),a=["x","y","z","w"],s=[],c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.addInstance=function(e,t,n,r){if(r)e.changeInstance(e,t,s,r);else{var i=e.layer.bufferManager.add(t);o.isBufferLocation(i)&&(t.active=!0,t.easingId=e.layer.easingId,e.updateInstance(e.layer,t,i))}},t.prototype.changeInstance=function(e,t,n,r){r?e.updateInstance(e.layer,t,r):e.addInstance(e,t,s,r)},t.prototype.removeInstance=function(e,t,n,r){r&&(t.active=!1,t.clearEasing(),e.updateInstance(e.layer,t,r),e.layer.bufferManager.remove(t))},t.prototype.updateInstance=function(e,t,n){if(t.active){for(var r=n.buffer,i=n.range[0],o=r.value,s=void 0,c=void 0,u=void 0,l=void 0,d=void 0,h=void 0,f=0,p=e.instanceAttributes.length;f<p;++f)if(c=(s=e.instanceAttributes[f]).update(t),u=o[i+(s.block||0)],s.atlas&&e.resource.setTargetAtlas(s.atlas.key),void 0!==(l=s.blockIndex))for(d=l,h=c.length+l;d<h;++d)u[a[d]]=c[d-l];r.value=o}else{r=n.buffer,i=n.range[0],o=r.value,s=void 0,c=void 0,u=void 0,l=void 0;if(c=(s=e.activeAttribute).update(t),u=o[i+(s.block||0)],s.atlas&&e.resource.setTargetAtlas(s.atlas.key),void 0!==(l=s.blockIndex))for(d=l,h=c.length+l;d<h;++d)u[a[d]]=c[d-l];r.value=o}},t.prototype.commit=function(){},t.prototype.incomingChangeList=function(e){},t}(i.BaseDiffProcessor);t.UniformDiffProcessor=c},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(49),a=n(5),s=[],c=Math.min,u=Math.max;!function(e){e[e.PARTIAL=0]="PARTIAL",e[e.FULL=1]="FULL"}(i||(i={}));var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.diffMode=i.PARTIAL,t.bufferAttributeUpdateRange={},t.bufferAttributeWillUpdate={},t.updateInstance=t.updateInstancePartial,t}return r(t,e),t.prototype.addInstance=function(e,t,n,r){if(r)e.changeInstance(e,t,s,r);else{var i=e.layer.bufferManager.add(t);a.isBufferLocationGroup(i)&&(t.active=!0,t.easingId=e.layer.easingId,e.updateInstance(e.layer,t,s,i))}},t.prototype.changeInstance=function(e,t,n,r){r?e.updateInstance(e.layer,t,n,r):e.addInstance(e,t,s,r)},t.prototype.removeInstance=function(e,t,n,r){r&&(t.active=!1,t.clearEasing(),e.updateInstance(e.layer,t,s,r),e.layer.bufferManager.remove(t))},t.prototype.updateInstancePartial=function(e,t,n,r){var i,o,a,s,l,d,h=r.propertyToBufferLocation,f=this.bufferAttributeUpdateRange;if(t.active){0===n.length&&(n=this.bufferManager.getUpdateAllPropertyIdList());for(var p=0,v=n.length;p<v;++p)if(d=(l=(i=h[n[p]]).attribute).packUID||l.uid,l.atlas&&e.resource.setTargetAtlas(l.atlas.key),o=l.update(t),i.buffer.value.set(o,i.range[0]),(a=f[d]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER])[0]=l,a[1]=c(i.range[0],a[1]),a[2]=u(i.range[1],a[2]),f[d]=a,i.childLocations)for(var g=0,y=(s=i.childLocations).length;g<y;++g)d=(i=s[g]).attribute.packUID||i.attribute.uid,o=i.attribute.update(t),i.buffer.value.set(o,i.range[0]),(a=f[d]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER])[0]=i.attribute,a[1]=c(i.range[0],a[1]),a[2]=u(i.range[1],a[2]),f[d]=a}else d=(l=(i=h[this.bufferManager.getActiveAttributePropertyId()]).attribute).packUID||l.uid,o=l.update(t),i.buffer.value.set(o,i.range[0]),(a=f[d]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER])[0]=l,a[1]=c(i.range[0],a[1]),a[2]=u(i.range[1],a[2]),f[d]=a},t.prototype.updateInstanceFull=function(e,t,n,r){var i,o,a,s,c=r.propertyToBufferLocation,u=this.bufferAttributeWillUpdate;if(t.active){0===n.length&&(n=this.bufferManager.getUpdateAllPropertyIdList());for(var l=0,d=n.length;l<d;++l)if((s=(i=c[n[l]]).attribute).atlas&&e.resource.setTargetAtlas(s.atlas.key),o=s.update(t),i.buffer.value.set(o,i.range[0]),u[s.packUID||s.uid]=s,i.childLocations)for(var h=0,f=(a=i.childLocations).length;h<f;++h)o=(s=(i=a[h]).attribute).update(t),i.buffer.value.set(o,i.range[0]),u[s.packUID||s.uid]=s}else(s=(i=c[this.bufferManager.getActiveAttributePropertyId()]).attribute).atlas&&e.resource.setTargetAtlas(s.atlas.key),o=s.update(t),i.buffer.value.set(o,i.range[0]),u[s.packUID||s.uid]=s},t.prototype.commit=function(){if(this.diffMode===i.PARTIAL)for(var e=0,t=(r=Object.values(this.bufferAttributeUpdateRange)).length;e<t;++e){var n=r[e];(o=n[0].bufferAttribute).needsUpdate=!0,o.updateRange={count:n[2]-n[1],offset:n[1]}}else{var r;for(e=0,t=(r=Object.values(this.bufferAttributeWillUpdate)).length;e<t;++e){var o;(o=r[e].bufferAttribute).needsUpdate=!0,o.updateRange={count:-1,offset:0}}}this.bufferAttributeUpdateRange={}},t.prototype.incomingChangeList=function(e){0===e.length?this.diffMode=i.PARTIAL:e.length>.7*this.bufferManager.getInstanceCount()?this.diffMode=i.FULL:this.diffMode=i.PARTIAL,this.diffMode===i.PARTIAL?this.updateInstance=this.updateInstancePartial:this.updateInstance=this.updateInstanceFull},t}(o.BaseDiffProcessor);t.InstanceAttributeDiffProcessor=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProgramInfo=function(e,t){for(var n={attributeCount:0,attributes:new Array,uniformCount:0,uniforms:new Array},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o={35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT"},a={35664:1,35665:1,35666:1,35667:1,35668:1,35669:1,35670:1,35671:1,35672:1,35673:1,35674:1,35675:3,35676:4,35678:1,35680:1,5120:1,5121:1,5122:1,5123:1,5124:1,5125:1,5126:1},s=0;s<r;++s){var c=e.getActiveUniform(t,s);c.typeName=o[c.type],n.uniforms.push(c),n.uniformCount+=c.size,c.size=c.size*a[c.type]}for(s=0;s<i;s++){var u=e.getActiveAttrib(t,s);u.typeName=o[u.type],n.attributes.push(u),n.attributeCount+=u.size}return n};var r=function(){function e(){}return e.MAX_VERTEX_UNIFORMS=0,e.MAX_FRAGMENT_UNIFORMS=0,e.MAX_VERTEX_ATTRIBUTES=0,e.WEBGL_SUPPORTED=!1,e.MAX_TEXTURE_SIZE=0,e.HARDWARE_INSTANCING=!1,e.HARDWARE_INSTANCING_ANGLE=!1,e}();t.WebGLStat=r,function(){var e=function(){try{var e=document.createElement("canvas");return window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(e){return!1}}();e&&(r.WEBGL_SUPPORTED=!0,r.MAX_VERTEX_UNIFORMS=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),r.MAX_FRAGMENT_UNIFORMS=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),r.MAX_VERTEX_ATTRIBUTES=e.getParameter(e.MAX_VERTEX_ATTRIBS),r.MAX_TEXTURE_SIZE=e.getParameter(e.MAX_TEXTURE_SIZE),r.HARDWARE_INSTANCING_ANGLE=Boolean(e.getExtension("ANGLE_instanced_arrays")),r.HARDWARE_INSTANCING=r.HARDWARE_INSTANCING_ANGLE)}()},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.CONTROLLED=0]="CONTROLLED",e[e.CUSTOM=1]="CUSTOM"}(r=t.ViewCameraType||(t.ViewCameraType={}));var i=function(){return function(){this.type=r.CONTROLLED}}();t.ViewCamera=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.templateVars={attributes:"attributes",easingMethod:"easingMethod",extend:"extend",extendHeader:"extendHeader",T:"T"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=0;function i(e,t){e&&t&&e.splice.apply(e,[0,t.length].concat(t))}var o=function(){function e(e){this._id=r++,this._offset=[0,0,0],this._scale=[1,1,1],this._needsViewDrawn=!0,e&&(i(this.offset,e.offset),i(this.scale,e.scale))}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.setId=function(e){this._id=e,this._needsViewDrawn=!0},Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},enumerable:!0,configurable:!0}),e.prototype.setOffset=function(e){this._offset=e.slice(0),this._needsViewDrawn=!0},Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),e.prototype.setScale=function(e){this._scale=e,this._needsViewDrawn=!0},Object.defineProperty(e.prototype,"needsViewDrawn",{get:function(){return this._needsViewDrawn},enumerable:!0,configurable:!0}),e.prototype.resolve=function(){this._needsViewDrawn=!1},e.prototype.update=function(){this._needsViewDrawn=!0},e}();t.ChartCamera=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.getProjection=function(e){return this.mouseManager.getView(e)},e.prototype.getView=function(e){return this.mouseManager&&this.mouseManager.getView(e)||null},e.prototype.getViewScreenBounds=function(e){var t=this.mouseManager.getView(e);return t?t.screenBounds:null},e.prototype.setMouseManager=function(e){this.mouseManager=e},e}();t.EventManager=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(53),o=n(85);function a(e,t){return t.data.depth-e.data.depth}function s(e){return Boolean(e)}var c=function(){function e(e,t,n,r){var i=this;this.eventCleanup=[],this._waitingForRender=!0,this.getViewsUnderMouse=function(e){var t=i.quadTree.query(e);return t.sort(a),t},this.resize=function(){i._waitingForRender=!0},this.context=e,this.setViews(t),this.setControllers(n),this.addContextListeners(r)}return Object.defineProperty(e.prototype,"waitingForRender",{get:function(){return this._waitingForRender},set:function(e){this._waitingForRender=e,e||(this.quadTree=new o.QuadTree(0,0,0,0),this.quadTree.addAll(this.views.map(function(e){return e.bounds}).filter(s)))},enumerable:!0,configurable:!0}),e.prototype.addContextListeners=function(e){var t,n=this,o=this.context,a=[0,0];if(e){var s=function(e){var r=i.eventElementPosition(e,o),s=n.makeInteraction(r,a,t),c=n.makeWheel(e);n.controllers.forEach(function(e){e.handleWheel(s,c)}),e.stopPropagation(),e.preventDefault()};"onwheel"in o&&(o.onwheel=s),"addEventListener"in o&&(o.addEventListener("DOMMouseScroll",s),this.eventCleanup.push(["DOMMouseScroll",s]))}o.onmouseleave=function(e){if(!n.waitingForRender){var r=i.eventElementPosition(e,o),s=n.makeInteraction(r,a,t);n.controllers.forEach(function(e){e.handleMouseOut(s)})}},o.onmousemove=function(e){if(!n.waitingForRender){var r=i.eventElementPosition(e,o),s=n.makeInteraction(r,a,t);n.controllers.forEach(function(e){e.handleMouseMove(s)})}},o.onmousedown=function(e){if(!n.waitingForRender){a=i.eventElementPosition(e,o);var s=n.getViewsUnderMouse(a),c=!0,u=Date.now();if(!(s.length<=0)&&(t=s[0].data)){var l=n.makeInteraction(a,a,t),d=a;n.controllers.forEach(function(t){t.handleMouseDown(l,e.button)}),e.stopPropagation(),document.onmousemove=function(e){var s=i.eventElementPosition(e,o),u=n.makeInteraction(s,a,t),l=r.subtract2(s,d),h=n.makeDrag(s,a||{x:0,y:0},d,l);d=s,n.controllers.forEach(function(e){e.handleDrag(u,h)}),c=!1},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null,document.onmouseover=null},document.onmouseover=function(e){var r=i.eventElementPosition(e,o),s=n.makeInteraction(r,a,t);n.controllers.forEach(function(e){e.handleMouseOver(s)}),e.stopPropagation()},o.onmouseup=function(e){var r=i.eventElementPosition(e,o),s=n.makeInteraction(r,a,t);n.controllers.forEach(function(t){t.handleMouseUp(s,e.button)}),c&&Date.now()-u<1e3&&n.controllers.forEach(function(t){t.handleClick(s,e.button)})};var h=o;void 0!==h.onselectstart?h.onselectstart=function(){return!1}:o.addEventListener("selectstart",function(){e.preventDefault()})}}},this.addTouchContextListeners()},e.prototype.addTouchContextListeners=function(){var e=this.context;e.ontouchstart=function(e){},e.ontouchend=function(e){},e.ontouchmove=function(e){},e.ontouchcancel=function(e){}},e.prototype.getView=function(e){for(var t=0,n=this.views;t<n.length;t++){var r=n[t];if(r.view.id===e)return r.view}return null},e.prototype.makeDrag=function(e,t,n,r){return{screen:{current:e,delta:r,previous:n,start:t}}},e.prototype.makeInteraction=function(e,t,n){var r=this.getViewsUnderMouse(e);return{screen:{mouse:e},start:t&&n&&{mouse:n.view.screenToView(e),view:n.view},target:{mouse:r[0]&&r[0].data.view.screenToView(e),view:r[0]&&r[0].data.view},viewsUnderMouse:r.map(function(t){return{mouse:t.data.view.screenToView(e),view:t.data.view}})}},e.prototype.makeWheel=function(e){return{wheel:i.normalizeWheel(e)}},e.prototype.setControllers=function(e){this.controllers=e;for(var t=0,n=this.controllers;t<n.length;t++){n[t].setMouseManager(this)}},e.prototype.setViews=function(e){this.views=e},e.prototype.destroy=function(){var e=this;delete this.quadTree,this.context.onmousedown=null,this.context.onmousemove=null,this.context.onmouseleave=null;var t=this.context;t.onmousewheel&&(t.onmousewheel=null),this.eventCleanup.forEach(function(t){e.context.removeEventListener(t[0],t[1])})},e}();t.MouseEventManager=c},function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(0),s=((r={})[a.UniformSize.ONE]="f",r[a.UniformSize.TWO]="v2",r[a.UniformSize.THREE]="v3",r[a.UniformSize.FOUR]="v4",r[a.UniformSize.MATRIX3]="Matrix3fv",r[a.UniformSize.MATRIX4]="Matrix4fv",r),c=((i={})[a.UniformSize.ONE]=[0],i[a.UniformSize.TWO]=[0,0],i[a.UniformSize.THREE]=[0,0,0],i[a.UniformSize.FOUR]=[0,0,0,0],i[a.UniformSize.MATRIX3]=[0,0,0,0,0,0,0,0,0],i[a.UniformSize.MATRIX4]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i);function u(e){return{type:s[e.size],value:c[e.size]}}t.generateLayerMaterial=function(e,t,n,r,i){var a=e.getMaterialOptions();a.vertexShader=t,a.fragmentShader=n,a.uniforms={};for(var s=0,c=r.length;s<c;++s){var l=r[s],d=u(l);a.uniforms[l.name]=d}for(s=0,c=i.length;s<c;++s){var h=i[s];a.uniforms[h.name]={type:h.type,value:h.value}}return new o.RawShaderMaterial(a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(9);function o(e){return!Array.isArray(e[0])}t.generateLayerGeometry=function(e,t,n,a){var s=[];e.bufferType!==i.LayerBufferType.INSTANCE_ATTRIBUTE&&e.bufferType!==i.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING||(t=1);for(var c=0,u=n.length;c<u;++c){var l=n[c];s.push(new Float32Array(l.size*a*t))}var d,h,f,p=n.length,v=!1;for(c=0,u=a;c<u;++c)for(var g=0;g<p;++g)if(h=n[g],d=s[g],o(f=h.update(c)))for(var y=c*h.size,m=y+h.size,b=0;y<m;++y,++b)d[y]=f[b];else v=!0;for(v&&console.warn("A vertex buffer updating method should not use arrays of arrays of numbers."),c=0,u=n.length;c<u;++c)for(var w=n[c].size*a,_=(g=1,t);g<_;++g)s[c].copyWithin(w*g,0,w);if(e.bufferType===i.LayerBufferType.UNIFORM){var T=s[0];for(c=0,u=t;c<u;++c){var x=c*a;for(g=0;g<a;++g)T[g+x]=c}}var A=new r.BufferGeometry;for(c=0,u=n.length;c<u;++c){var I=n[c],S=new r.BufferAttribute(s[c],I.size);I.materialAttribute=S,A.addAttribute(I.name,S)}return A}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(30),o=n(28),a=n(21),s=n(20);t.generateDefaultScene=function(e){var t=e.canvas.height,n=e.canvas.width,c={aspectRatio:n/t,bottom:-t/2,far:1e7,left:-n/2,near:-100,right:n/2,top:t/2,viewSize:t},u=new o.ViewCamera;u.baseCamera=new r.OrthographicCamera(c.left,c.right,c.top,c.bottom,c.near,c.far),u.baseCamera.scale.set(1,-1,1),u.baseCamera.position.set(0,0,-300),u.baseCamera.updateMatrixWorld(!0),u.baseCamera.updateMatrix(),u.baseCamera instanceof r.OrthographicCamera&&u.baseCamera.updateProjectionMatrix();var l=new i.ChartCamera,d={bottom:0,left:0,right:0,top:0},h=new s.View({camera:l,key:s.View.DEFAULT_VIEW_ID,viewCamera:u,viewport:d}),f=new a.Scene({key:a.Scene.DEFAULT_SCENE_ID,views:[]});return f.addView(h),{camera:l,scene:f,view:h,viewCamera:u,viewport:d}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="Once a ShaderModuleUnit has been registered, you CAN NOT modify it! Module ID:",i=function(){function e(e){this._dependents=null,Object.assign(this,e)}return Object.defineProperty(e.prototype,"content",{get:function(){return this._content},set:function(e){this._isLocked?console.warn(r,this._moduleId):this._content=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compatibility",{get:function(){return this._compatibility},set:function(e){this._isLocked?console.warn(r,this._moduleId):this._compatibility=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dependents",{get:function(){return this._dependents},set:function(e){this._isLocked&&null!==this._dependents?console.warn(r,this._moduleId):this._dependents=e},enumerable:!0,configurable:!0}),e.prototype.isLocked=function(){return this._isLocked},Object.defineProperty(e.prototype,"moduleId",{get:function(){return this._moduleId},set:function(e){this._isLocked?console.warn(r,this._moduleId):this._moduleId=e},enumerable:!0,configurable:!0}),e.prototype.applyAnalyzedContent=function(e){this._isLocked&&null!==this.dependents?console.warn(r,this._moduleId):this._content=e},e.prototype.lock=function(){this._isLocked=!0},e}();t.ShaderModuleUnit=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(2),o=n(36),a=n(12)("performance"),s=n(12)("shader-module-vs"),c=n(12)("shader-module-fs");function u(e,t){return Boolean(e)&&(e.compatibility===t||e.compatibility===r.ShaderInjectionTarget.ALL)}var l=function(){function e(){}return e.register=function(t){if(!(t instanceof o.ShaderModuleUnit)){if(Array.isArray(t)){var n="";return t.forEach(function(t){var r=e.register(t);r&&(n+=r+"\n")}),n||null}return e.register(new o.ShaderModuleUnit(t))}var i=e.modules.get(t.moduleId);i||(i={},e.modules.set(t.moduleId,i));var s=i.fs,c=i.vs,l=u(t,r.ShaderInjectionTarget.FRAGMENT),d=u(t,r.ShaderInjectionTarget.VERTEX);if(s&&l){if(s.isFinal)return"Module ID: "+t.moduleId+" Can not override the module's existing Fragment registration as the exisitng module is marked as final";a("A Shader Module Unit has overridden an existing module for the Fragment Shader Module ID: %o",t.moduleId)}if(c&&d){if(c.isFinal)return"Module ID: "+t.moduleId+" Can not override the module's existing Vertex registration as the exisitng module is marked as final";a("A Shader Module Unit has overridden an existing module for the Vertex Shader Module ID: %o",t.moduleId)}return l&&(i.fs=t),d&&(i.vs=t),t.lock(),null},e.analyzeDependents=function(t){if(t.dependents&&t.isLocked)return[];var n=[],o=[],a=new Set,s=t.compatibility,c=t.moduleId,u=i.shaderTemplate({options:{},shader:t.content,onToken:function(t){var i=t.trim();if(0===i.indexOf("import")){var u=i.substr("import".length).trim();if(":"===u[0]){var l=!1,d=u.substr(":".length).trim().split(",");return 0===d[d.length-1].trim().length&&d.pop(),d.forEach(function(t){t=t.trim();var i=e.modules.get(t);i?(s!==r.ShaderInjectionTarget.FRAGMENT&&s!==r.ShaderInjectionTarget.ALL||(i.fs?(l=!0,a.has(t)||o.push(t)):n.push("Could not find requested target fragment module for Module ID: "+t+" requested by module: "+c)),s!==r.ShaderInjectionTarget.VERTEX&&s!==r.ShaderInjectionTarget.ALL||(i.vs?(l=!0,a.has(t)||o.push(t)):n.push("Could not find requested target vertex module for Module ID: "+t+" requested by module: "+c)),i.vs||i.fs||n.push("Could not find a vertex or fragment shader within exisitng module"),l||n.push("Error Processing module Module ID: "+t+" requested by module: "+c)):n.push("Could not find requested module: "+t+" requested by module: "+c)}),""}}return"${"+t+"}"}});return t.applyAnalyzedContent(u.shader),t.dependents=o,n},e.process=function(t,n,i,a){var u=new Set,l=new Set,d=[],h=[],f=i===r.ShaderInjectionTarget.VERTEX?s:c;f("Processing Shader for id %o:",t);var p=n;if(a){var v="";a.forEach(function(e){return v+="${import: "+e+"}\n"}),p=v+n}var g=new o.ShaderModuleUnit({content:p,compatibility:i,moduleId:'Layer "'+t+'" '+(i===r.ShaderInjectionTarget.ALL?"fs vs":i===r.ShaderInjectionTarget.VERTEX?"vs":"fs")});return{errors:h,shader:function t(n){var o=n.moduleId;if(!function(e){var t=e.moduleId;f("%o: %o",t,d.slice(0).reverse().join(" -> "));var n=d.indexOf(t);if(d.unshift(t),n>-1){var r=d.slice(0,n+2).reverse();return h.push("A Shader has detected a Circular dependency in import requests: "+r.join(" -> ")),d.shift(),!1}return!0}(n))return null;if(o&&l.has(o))return d.shift(),"";var a="";e.analyzeDependents(n).forEach(function(e){return h.push(e)});var s=n.dependents;if(s&&s.length>0)for(var c=0,p=s.length;c<p;++c){var v=s[c],g=e.modules.get(v);if(g){var y=void 0;i!==r.ShaderInjectionTarget.FRAGMENT&&i!==r.ShaderInjectionTarget.ALL||(g.fs?(u.add(g.fs),y=t(g.fs)):h.push("Could not find requested target fragment module for Module ID: "+v+" requested by module: "+o)),i!==r.ShaderInjectionTarget.VERTEX&&i!==r.ShaderInjectionTarget.ALL||(g.vs?(u.add(g.vs),y=t(g.vs)):h.push("Could not find requested target vertex module for Module ID: "+v+" requested by module: "+o)),g.vs||g.fs||h.push("Could not find a vertex or fragment shader within exisitng module"),null===y&&h.push("Error Processing module Module ID: "+v+" requested by module: "+o),a+=y||""}else h.push("Could not find requested module: "+v+" requested by module: "+o)}return d.shift(),l.add(o||""),a.trim()+"\n\n"+n.content.trim()}(g),shaderModuleUnits:u}},e.modules=new Map,e}();t.ShaderModule=l},function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(94),s=n(93),c=n(9),u=n(92),l=((r={})[o.InstanceAttributeSize.ONE]=[1],r[o.InstanceAttributeSize.TWO]=[1,2],r[o.InstanceAttributeSize.THREE]=[1,2,3],r[o.InstanceAttributeSize.FOUR]=[1,2,3,4],r),d=((i={})[o.InstanceAttributeSize.ONE]=[4],i[o.InstanceAttributeSize.TWO]=[4,3],i[o.InstanceAttributeSize.THREE]=[4,3,2],i[o.InstanceAttributeSize.FOUR]=[4,3,2,1],i);function h(e){return Boolean(e)}function f(e){return Boolean(e)}function p(e){return Boolean(e)}function v(e){return Object.assign({},e,{materialAttribute:null})}function g(e){return Object.assign({},e,{materialUniforms:[]})}function y(e,t){return e.atlas&&!t.atlas?-1:e.easing&&!t.easing?-1:1}function m(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;++n)if(Math.round(100*e[n])/100!=Math.round(100*t[n])/100)return!1;return!0}t.injectShaderIO=function(e,t,n,r){!function(e,t,n){if(n){var r=t.instanceAttributes||[],i=t.uniforms||[],o=t.vertexAttributes||[];n.shaderModuleUnits.forEach(function(t){t.instanceAttributes&&(r=r.concat(t.instanceAttributes(e))),t.uniforms&&(i=i.concat(t.uniforms(e))),t.vertexAttributes&&(o=o.concat(t.vertexAttributes(e)))});var a=new Set,s=new Set,c=new Set;i.filter(function(e){return!!e&&(a.has(e.name)?(console.warn("Included shader modules has introduced duplicate uniform names:",e.name,"One will be overridden thus causing a potential crash of the shader."),!1):(a.add(e.name),!0))}),r.filter(function(e){return!!e&&(s.has(e.name)?(console.warn("Included shader modules has introduced duplicate Instance Attribute names:",e.name,"One will be overridden thus causing a potential crash of the shader."),!1):(s.add(e.name),!0))}),o.filter(function(e){return!!e&&(c.has(e.name)?(console.warn("Included shader modules has introduced duplicate Vertex Attribute names:",e.name,"One will be overridden thus causing a potential crash of the shader."),!1):(c.add(e.name),!0))}),t.instanceAttributes=r,t.uniforms=i,t.vertexAttributes=o}}(t,n,r);var i=(n.instanceAttributes||[]).filter(h),o=(n.vertexAttributes||[]).filter(f),b=(n.uniforms||[]).filter(p);!function(e,t,n){t.forEach(function(r){if(void 0===r.name&&console.warn("All instance attributes MUST have a name on Layer:",e.id),t.find(function(e){return e!==r&&e.name===r.name})&&console.warn("An instance attribute can not have the same name used more than once:",r.name),n.find(function(e){return e.name===r.name})&&console.warn("An instance attribute and a vertex attribute in a layer can not share the same name:",r.name),r.easing&&r.atlas&&(console.warn("An instance attribute can not have both easing and atlas properties. Undefined behavior will occur."),console.warn(r)),r.atlas||void 0===r.size&&(console.warn("An instance attribute requires the size to be defined."),console.warn(r)),r.easing)if(void 0!==r.size){var i=l[r.size],o=d[r.size],a=r.easing.validation||{},s=r.easing.cpu(i,o,0);m(s,i)||(console.warn("Auto Easing Validation Failed: using a time of 0 does not produce the start value"),console.warn("Start:",i,"End:",o,"Result:",s),console.warn(r)),s=r.easing.cpu(i,o,1),a.ignoreEndValueCheck||m(s,o)||(console.warn("Auto Easing Validation Failed: using a time of 1 does not produce the end value"),console.warn("Start:",i,"End:",o,"Result:",s),console.warn(r)),m(s=r.easing.cpu(i,o,-1),i)||(console.warn("Auto Easing Validation Failed: using a time of -1 does not produce the start value"),console.warn("Start:",i,"End:",o,"Result:",s),console.warn(r)),s=r.easing.cpu(i,o,2),a.ignoreOverTimeCheck||m(s,o)||(console.warn("Auto Easing Validation Failed: using a time of 2 does not produce the end value"),console.warn("Start:",i,"End:",o,"Result:",s),console.warn(r))}else console.warn("An Instance Attribute with easing MUST have a size declared")})}(t,i,o),s.generateEasingAttributes(t,i);var w=b.concat(a.generateAtlasResourceUniforms(t,i)),_=i.slice(0),T=w.map(g),x=_.sort(y);return u.packAttributes(x),c.getLayerBufferType(e,t,o,x),{instanceAttributes:x,uniforms:T,vertexAttributes:[].concat(o||[]).map(v)}}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(111)),r(n(108))},function(e,t,n){"use strict";var r,i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=Math.floor,s=Math.max,c=Math.min,u=function(){function e(){}return e.awaitContext=function(){return i(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return r?[3,2]:(this.getContext(),[4,new Promise(function(e){return setTimeout(e,10)})]);case 1:return e.sent(),[3,0];case 2:return[2]}})})},e.calculateLabelSize=function(e,t,n){n&&this.calculateTrucatedText(e);var i=e.label,o=t||e.sampleScale||1;this.drawLabel(i,e.truncatedText,r,o);var a=this.measureContents(r),s=a.minX,c=a.minY,u=a.maxX,l=a.maxY;e.rasterization=e.rasterization||{texture:{height:0,width:0},world:{height:0,width:0}},n?(e.rasterization.texture={height:l-c,width:u-s},e.rasterization.canvas=this.createCroppedCanvas(e,c,s),this.calculateLabelSize(e,1,!1)):e.rasterization.world={height:l-c,width:u-s}},e.calculateTrucatedText=function(e){var t=e.label,n=t.maxWidth;if(n){this.drawLabel(t,t.text,r,1);var i=this.measureContents(r);if(i.maxX-i.minX<=n)e.truncatedText=t.text;else{for(var o=t.text,s=0,c=o.length,u=a((c-s)/2),l=0;c>s&&0!==u&&l++<50;){this.drawLabel(t,o.substr(0,u)+"...",r,1);var d=this.measureContents(r),h=d.minX;d.maxX-h<=n?s=u:c=u;var f=a((c-s)/2)+s;if(f===u)break;u=f}e.truncatedText=0===u?"...":o.substr(0,u)+"..."}}else e.truncatedText=t.text},e.createCroppedCanvas=function(e,t,n){var i=document.createElement("canvas"),o=i.getContext("2d");if(o){var a=e.rasterization.texture;i.width=a.width,i.height=a.height,o.imageSmoothingEnabled=!1,o.drawImage(r.canvas,n,t,a.width,a.height,0,0,a.width,a.height)}else console.warn("Could not create a canvas 2d context to generate a label's cropped image.");return i},e.drawLabel=function(e,t,n,r){var i=this.getLabelRasterizationFontSize(e,r);n.fillStyle="white",n.font=this.makeCSSFont(e,r),n.canvas.width=n.measureText(e.text).width+i,n.canvas.height=2*i,n.fillStyle="white",n.font=this.makeCSSFont(e,r),n.fillText(t,i/2,i/4+i)},e.getContext=function(){if(!r){var e=document.createElement("canvas").getContext("2d");return e&&(r=e),e}return r},e.getLabelRasterizationFontSize=function(e,t){return e.fontSize*t},e.makeCSSFont=function(e,t){return e.fontWeight+" "+this.getLabelRasterizationFontSize(e,t)+"px "+e.fontFamily},e.measureContents=function(e){for(var t=e.canvas,n=t.width,r=t.height,i=e.getImageData(0,0,n,r).data,o=Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER,d=0;d<n;++d)for(var h=0;h<r;++h){i[h*(4*n)+4*d]>0&&(o=c(o,h),a=c(a,d),u=s(u,d),l=s(l,h))}return l+=2,u+=2,a-=1,o=s(o-=1,0),{minX:a=s(a,0),minY:o,maxX:u,maxY:l}},e.render=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this.awaitContext()];case 1:return t.sent(),e.label.fontSize>50?(console.warn("Labels only support font sizes up to 50"),[2,e]):(this.calculateLabelSize(e,e.sampleScale,!0),[2,e])}})})},e.renderSync=function(e){return this.getContext(),r?e.label.fontSize>50?(console.warn("Labels only support font sizes up to 50"),e):(this.calculateLabelSize(e,e.sampleScale,!0),e):(console.warn("Can not render a label synchronously without the canvas context being ready."),e)},e}();t.LabelRasterizer=u},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){var n=e.call(this)||this;return n.image=t,n}return r(t,e),t}(n(23).BaseAtlasResource);t.ImageAtlasResource=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.awaitContext=function(e){return r(this,void 0,void 0,function(){var t,n;return i(this,function(r){switch(r.label){case 0:t=e.getContext("2d"),n=0,r.label=1;case 1:return!Boolean(t)&&n<100?[4,new Promise(function(e){return setTimeout(e,10)})]:[3,4];case 2:r.sent(),r.label=3;case 3:return t=e.getContext("2d"),++n,[3,1];case 4:return[2]}})})},e.makeCSS=function(e){return"rgba("+Math.floor(256*e.r)+", "+Math.floor(256*e.g)+", "+Math.floor(256*e.b)+", "+e.opacity+")"},e.render=function(e){return r(this,void 0,void 0,function(){var t,n;return i(this,function(r){switch(r.label){case 0:return t=document.createElement("canvas"),n=t.getContext("2d"),[4,this.awaitContext(t)];case 1:return r.sent(),n?(t.width=2,t.height=2,n.imageSmoothingEnabled=!1,n.fillStyle=this.makeCSS(e.color),n.fillRect(0,0,2,2),e.rasterization.canvas=t):console.warn("Could not create a canvas 2d context to generate a color for rasterization."),[2,e]}})})},e}();t.ColorRasterizer=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){var n=e.call(this)||this;return n.color=t,n}return r(t,e),t}(n(23).BaseAtlasResource);t.ColorAtlasResource=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.aspectRatio=1,this.atlasReferenceID="",this.atlasTexture=null,this.atlasTL=[0,0],this.atlasTR=[0,0],this.atlasBL=[0,0],this.atlasBR=[0,0],this.widthOnAtlas=0,this.heightOnAtlas=0,this.isValid=!1,this.pixelWidth=0,this.pixelHeight=0}}();t.SubTexture=r},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(16),a=n(114),s=n(44);!function(e){e[e._2=2]="_2",e[e._4=4]="_4",e[e._8=8]="_8",e[e._16=16]="_16",e[e._32=32]="_32",e[e._64=64]="_64",e[e._128=128]="_128",e[e._256=256]="_256",e[e._512=512]="_512",e[e._1024=1024]="_1024",e[e._2048=2048]="_2048",e[e._4096=4096]="_4096"}(t.AtlasSize||(t.AtlasSize={}));var c=function(e){function t(t){var n=e.call(this,t)||this;n.validResources=new Set;var r=document.createElement("canvas");return n.width=r.width=t.width,n.height=r.height=t.height,n.textureSettings=t.textureSettings,n.packing=new a.PackNode(0,0,t.width,t.height),n.updateTexture(r),n}return r(t,e),t.prototype.invalidateResource=function(e){var t=[0,0];e.texture.aspectRatio=1,e.texture.atlasBL=t,e.texture.atlasBR=t,e.texture.atlasTL=t,e.texture.atlasTR=t,e.texture.atlasReferenceID="",e.texture.pixelWidth=0,e.texture.pixelHeight=0,e.texture.isValid=!1,e.texture.atlasTexture=null},t.prototype.setManager=function(e){this.manager=e},t.prototype.registerResource=function(e){if(this.validResources.has(e))console.warn("Atlas Error:",this.id,"A resource was trying to be added to the atlas that has already been added before.","Consider creating a new resource to indicate what you want loaded to the atlas","Resource:",e);else{if(!e.texture||!e.texture.isValid)return e.texture||(e.texture=new s.SubTexture),e.texture.isValid=!0,e.texture.atlasTexture=this.texture,this.validResources.add(e),!0;console.warn("Atlas Error:",this.id,"Attempted to add a resource to an Atlas that is already a valid resource on another atlas.","Consider Creating a new resource to be loaded into this particular atlas.","Resource:",e)}return!1},t.prototype.removeResource=function(e){this.validResources.has(e)?(this.validResources.delete(e),this.invalidateResource(e)):console.warn("Atlas Error:",this.id,"Attempted to remove a resource that does not exist on this atlas.","or the resource was already considered invalidated on this atlas.","Resource:",e)},t.prototype.updateTexture=function(e){var t=this;if(this.texture){var n=this.texture.image;this.texture.dispose(),this.texture=new i.Texture(n)}else this.texture=new i.Texture(e);this.validResources.forEach(function(e){e.texture&&(e.texture.atlasTexture=t.texture)}),this.texture.generateMipmaps=!0,this.texture.premultiplyAlpha=!0,this.textureSettings&&Object.assign(this.texture,this.textureSettings),this.texture.needsUpdate=!0},t.prototype.destroy=function(){var e=this;this.texture.dispose(),this.validResources.forEach(function(t,n){e.invalidateResource(n)})},t}(o.IdentifyByKey);t.Atlas=c},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(118)),r(n(115))},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.emptyBounds=function(){return new t({height:0,width:0,x:0,y:0})},t}(n(4).Bounds);t.DataBounds=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(47);function i(e,t,n){var r=""+e,i=parseFloat(r);return isNaN(i)?0:r.indexOf("%")>-1?i/100*t:i*n}t.getAbsolutePositionBounds=function(e,t,n){0!==t.width&&0!==t.height||console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are non-zero.","item:",e,"reference:",t.toString());var o,a,s=r.DataBounds.emptyBounds();if(e.width)s.width=i(e.width,t.width,n),void 0!==e.left?s.x=i(e.left,t.width,n):void 0!==e.right&&(s.x=t.width-i(e.right,t.width,n)-s.width);else{var c=i(e.left||0,t.width,n);(o=t.width-i(e.right||0,t.width,n)-c)<0&&console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are greater than zero.","item:",e,"reference:",t.toString()),s.x=c,s.width=o}if(e.height)s.height=i(e.height,t.height,n),void 0!==e.top?s.y=i(e.top,t.height,n):void 0!==e.bottom&&(s.y=t.height-i(e.bottom,t.height,n)-s.height);else{var u=i(e.top||0,t.height,n);(void 0===(a=t.height-i(e.bottom||0,t.height,n)-u)||a<0)&&console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are greater than zero.","item:",e,"reference:",t.toString()),s.y=u,s.height=a}return(0===s.width||0===s.height||isNaN(s.x+s.y+s.width+s.height))&&(s.x=0,s.y=0,s.width=t.width,s.height=t.height),s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){this.layer=e,this.bufferManager=t}}();t.BaseDiffProcessor=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(0),o={1:"float",2:"vec2",3:"vec3",4:"vec4",9:"mat3",16:"mat4",99:"sampler2D"},a=function(){function e(e){this.materialUniforms=[],this.metricsProcessor=e}return e.prototype.generateUniformAttributePacking=function(){var t="\n// Instance Attributes as a packed Uniform Buffer";return t+="uniform vec4 "+e.uniformPackingBufferName()+"["+this.metricsProcessor.totalInstanceUniformBlocks+"];\n",t+="int instanceSize = "+this.metricsProcessor.totalInstanceUniformBlocks+";",t+="vec4 getBlock(int index, int instanceIndex) { return "+e.uniformPackingBufferName()+"[(instanceSize * instanceIndex) + index]; }",this.materialUniforms.push({name:e.uniformPackingBufferName(),type:"4fv",value:new Array(this.metricsProcessor.totalInstanceUniformBlocks).fill(0).map(function(){return new r.Vector4(0,0,0,0)})}),t},e.prototype.process=function(e,t){var n="",r=t||i.ShaderInjectionTarget.VERTEX;return e.forEach(function(e){e.shaderInjection=e.shaderInjection||i.ShaderInjectionTarget.VERTEX,e.shaderInjection!==r&&e.shaderInjection!==i.ShaderInjectionTarget.ALL||(n+="uniform "+(e.qualifier||"")+(e.qualifier?" ":"")+o[e.size]+" "+e.name+";\n")}),n},e.uniformPackingBufferName=function(){return"instanceData"},e}();t.UniformProcessing=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};t.emitOnce=function(e,t){var n=r[e]||[t,-1,0];r[e]=n,n[2]++,clearTimeout(n[1]),n[1]=window.setTimeout(function(){t(n[2],e),delete r[e]},1)},t.flushEmitOnce=function(){for(var e in r){var t=r[e];clearTimeout(t[1]),t[0](t[2],e)}r={}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAttributeShaderName=function(e){return e.easing?"_"+e.name+"_end":e.name}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(157),o=n(13),a=n(12)("CommunicationsView:Mouse"),s=1/30,c=-.25,u=100,l=[0,0,0,0],d=.02,h=.1,f=.18,p=.7;t.normalizeWheel=r,i.firefox?(a("Using mouse wheel for firefox"),t.normalizeWheel=r=function(e){var t,n=e,r=0;return Math.sign(l[0])!==Math.sign(r)&&l.splice(0,l.length,0,0,0,0),t=n.deltaX*u,r=n.deltaY*u*d+l[0]*h+l[1]*f+l[2]*p,l.unshift(r),l.pop(),[-t,-r]}):i.msie&&+i.version>=11?(a("Using mouse wheel for IE 11"),t.normalizeWheel=r=function(e){var t=e,n=t.deltaX;void 0===n&&(n=void 0!==t.wheelDeltaX?t.wheelDeltaX*s:0);var r=t.deltaY;return void 0===r&&(r=void 0!==t.wheelDeltaY?t.wheelDeltaY*s:(t.wheelDelta||-t.detail)*c),[-n,-r]}):i.msedge?(a("Using mouse wheel for MS EDGE"),t.normalizeWheel=r=function(e){var t=e,n=t.deltaX,r=t.deltaY;void 0===n&&(n=void 0!==t.wheelDeltaX?t.wheelDeltaX*s:0),void 0===r&&(r=void 0!==t.wheelDeltaY?t.wheelDeltaY*s:t.wheelDelta||-t.detail);var i=[n,-r];return o.scale2(i,.25),i}):(a("Using mouse wheel for Chrome"),t.normalizeWheel=r=function(e){var t=e;return[t.deltaX,-t.deltaY]}),t.eventElementPosition=function(e,t){var n=0,r=0,i=0,o=0,a=t||e.nativeEvent&&e.nativeEvent.target||e.target;if(e||(e=window.event),e.pageX||e.pageY)n=e.pageX,r=e.pageY;else if(e.clientX||e.clientY){var s=0,c=0;document.documentElement&&(s=document.documentElement.scrollLeft,c=document.documentElement.scrollTop),n=e.clientX+document.body.scrollLeft+s,r=e.clientY+document.body.scrollTop+c}if(a.offsetParent)do{i+=a.offsetLeft,o+=a.offsetTop,a=a.offsetParent}while(a);return[n-i,r-o]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),i=n(29);t.extendShader=function(e,t,n){var o=e.vs,a=e.fs,s={shader:o},c={shader:a};if(t){(l={})[i.templateVars.extendHeader]=t.header?t.header+"\n${"+i.templateVars.extendHeader+"}":"",l[i.templateVars.extend]=t.body?t.body+"\n${"+i.templateVars.extend+"}":"";var u={name:"Extend VS Shader",values:[i.templateVars.extendHeader,i.templateVars.extend]};s=r.shaderTemplate({options:l,required:u,shader:o,onToken:function(e,t){return e===i.templateVars.extendHeader||e===i.templateVars.extend?t:"${"+e+"}"}})}if(n){var l;(l={})[i.templateVars.extendHeader]=n.header?n.header+"\n${"+i.templateVars.extendHeader+"}":"",l[i.templateVars.extend]=n.body?n.body+"\n${"+i.templateVars.extend+"}":"",u={name:"Extend FS Shader",values:[i.templateVars.extendHeader,i.templateVars.extend]},c=r.shaderTemplate({options:l,required:u,shader:a,onToken:function(e,t){return e===i.templateVars.extendHeader||e===i.templateVars.extend?t:"${"+e+"}"}})}return{fs:c.shader,vs:s.shader}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(18),o=n(13),a=Math.min,s=Math.max,c=Math.pow,u=Math.round,l=Math.sin,d=Math.PI,h=u(1e3*d)/1e3;function f(e,t,n){return a(s(e,t),n)}!function(e){e[e.NONE=1]="NONE",e[e.CONTINUOUS=4]="CONTINUOUS",e[e.REPEAT=2]="REPEAT",e[e.REFLECT=3]="REFLECT"}(r=t.AutoEasingLoopStyle||(t.AutoEasingLoopStyle={}));var p="\n${easingMethod} {\n  float p = 0.3;\n  float time = pow(2.0, -10.0 * t) * sin((t - p / 4.0) * (2.0 * "+h+") / p) + 1.0;\n  return (end - start) * time + start;\n}\n",v="\n${easingMethod} {\n  float time = t * t * t - t * 1.05 * sin(t * "+h+");\n  return (end - start) * time + start;\n}\n",g="\n${easingMethod} {\n  ${T} direction = end - start;\n  float amplitude = length(direction) * 2.0;\n  return start + direction * sin(t * "+h+" * 2.0) * amplitude;\n}\n",y=function(){function e(e,t,n,o){this.uid=i.uid(),this.delay=0,this.duration=500,this.loop=r.NONE,this.cpu=e,this.gpu=t,this.duration=n||500,this.methodName=o||"easingMethod"}return e.immediate=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){return t},delay:t,duration:e,gpu:"\n${easingMethod} {\n  return end;\n}\n",loop:n,methodName:"immediate"}},e.linear=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){var r=o.VecMath(e),i=r.add,a=r.scale,s=r.subtract;return n=f(n,0,1),i(a(s(t,e),n),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  return (end - start) * t + start;\n}\n",loop:n,methodName:"linear"}},e.easeInQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){var r=(n=f(n,0,1))*n,i=o.VecMath(e);return(0,i.add)((0,i.scale)((0,i.subtract)(t,e),r),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInQuad"}},e.easeOutQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){var r=(n=f(n,0,1))*(2-n),i=o.VecMath(e);return(0,i.add)((0,i.scale)((0,i.subtract)(t,e),r),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * (2.0 - t);\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeOutQuad"}},e.easeInOutQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){var r=(n=f(n,0,1))<.5?2*n*n:(4-2*n)*n-1,i=o.VecMath(e);return(0,i.add)((0,i.scale)((0,i.subtract)(t,e),r),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t < 0.5 ? 2.0 * t * t : -1.0 + (4.0 - 2.0 * t) * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInOutQuad"}},e.easeInCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){var r=(n=f(n,0,1))*n*n,i=o.VecMath(e);return(0,i.add)((0,i.scale)((0,i.subtract)(t,e),r),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInCubic"}},e.easeOutCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){n=f(n,0,1);var r=--n*n*n+1,i=o.VecMath(e);return(0,i.add)((0,i.scale)((0,i.subtract)(t,e),r),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t1 * t1 * t1 + 1.0;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeOutCubic"}},e.easeInOutCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){var r=(n=f(n,0,1))<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,i=o.VecMath(e);return(0,i.add)((0,i.scale)((0,i.subtract)(t,e),r),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t < 0.5 ? 4.0 * t * t * t : (t - 1.0) * (2.0 * t - 2.0) * (2.0 * t - 2.0) + 1.0;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInOutCubic"}},e.easeInQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){var r=(n=f(n,0,1))*n*n*n,i=o.VecMath(e);return(0,i.add)((0,i.scale)((0,i.subtract)(t,e),r),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInQuart"}},e.easeOutQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){n=f(n,0,1);var r=1- --n*n*n*n,i=o.VecMath(e);return(0,i.add)((0,i.scale)((0,i.subtract)(t,e),r),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = 1.0 - t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeOutQuart"}},e.easeInOutQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){var r=(n=f(n,0,1))<.5?8*n*n*n*n:1-8*--n*n*n*n,i=o.VecMath(e);return(0,i.add)((0,i.scale)((0,i.subtract)(t,e),r),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t < 0.5 ? 8.0 * t * t * t * t : 1.0 - 8.0 * t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInOutQuart"}},e.easeInQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){var r=(n=f(n,0,1))*n*n*n*n,i=o.VecMath(e);return(0,i.add)((0,i.scale)((0,i.subtract)(t,e),r),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t * t * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInQuint"}},e.easeOutQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){n=f(n,0,1);var r=1+--n*n*n*n*n,i=o.VecMath(e);return(0,i.add)((0,i.scale)((0,i.subtract)(t,e),r),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = 1.0 + t1 * t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeOutQuint"}},e.easeInOutQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){var r=(n=f(n,0,1))<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,i=o.VecMath(e);return(0,i.add)((0,i.scale)((0,i.subtract)(t,e),r),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t < 0.5 ? 16.0 * t * t * t * t * t : 1.0 + 16.0 * t1 * t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInOutQuint"}},e.easeOutElastic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){n=f(n,0,1);var r=c(2,-10*n)*l(2*d*(n-.075)/.3)+1,i=o.VecMath(e);return(0,i.add)((0,i.scale)((0,i.subtract)(t,e),r),e)},delay:t,duration:e,gpu:p,loop:n,methodName:"easeOutElastic"}},e.easeBackIn=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){var r=(n=f(n,0,1))*n*n-1.05*n*l(n*d),i=o.VecMath(e);return(0,i.add)((0,i.scale)((0,i.subtract)(t,e),r),e)},delay:t,duration:e,gpu:v,loop:n,methodName:"easeBackIn"}},e.easeBackOut=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){var r=(n=f(n,0,1))-1,i=r*r*(2.7*r+1.7)+1,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float a = 1.7;\n  float time = (t1 * t1 * ((a + 1.0) * t1 + a) + 1.0);\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeBackOut"}},e.easeBackInOut=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n){var r=2.5925,i=(n=f(n,0,1))/.5,a=i-2,s=i<1?.5*(i*i*(r+1)*i-r):.5*(a*a*((r+1)*a+r)+2),c=o.VecMath(e);return(0,c.add)((0,c.scale)((0,c.subtract)(t,e),s),e)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float a = 1.4;\n  float a1 = a * 1.525;\n  float t1 = t / 0.5;\n  float t2 = t1 - 2.0;\n  float time =\n    (t1 < 1.0) ? 0.5 * (t1 * t1 * (a1 + 1.0) * t1 - a1) :\n    0.5 * (t2 * t2 * ((a1 + 1.0) * t2 + a1) + 2.0)\n  ;\n\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeBackInOut"}},e.continuousSinusoidal=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.CONTINUOUS),{uid:i.uid(),cpu:function(e,t,n){var r=o.VecMath(e),i=r.add,a=r.length,s=r.scale,c=r.subtract;n=f(n,0,1);var u=c(t,e),h=2*a(u);return i(e,s(u,l(n*d*2)*h))},delay:t,duration:e,gpu:g,loop:n,methodName:"repeatingSinusoidal",validation:{ignoreEndValueCheck:!0,ignoreOverTimeCheck:!0}}},e}();t.AutoEasingMethod=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=function(){function e(){}return e.transparentShape={premultipliedAlpha:!1,transparent:!0},e.transparentImage={blending:r.CustomBlending,blendSrc:r.OneFactor,premultipliedAlpha:!0,transparent:!0},e}();t.CommonMaterialOptions=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.delay=0,this.isManualStart=!1,this.isTimeSet=!1,Object.assign(this,e)}return e.prototype.setAutomatic=function(){this.isManualStart=!1,this.isTimeSet=!1},e.prototype.setStart=function(e){e&&(this.start.length!==e.length?console.warn("A manual easing adjustment provided an incompatible value for the easing type."):(this.start=e,this.isManualStart=!0))},e.prototype.setTiming=function(e,t){this.delay=void 0===e?this.delay:e,this.duration=void 0===t?this.duration:t,this.isTimeSet=!0},e}();t.EasingProps=r},function(e,t){e.exports="void main() {\n  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n}\n"},function(e,t){e.exports="void main() {\n  gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n}\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(10).ShaderModule.register([{moduleId:"no-op",content:n(59),compatibility:r.ShaderInjectionTarget.VERTEX},{moduleId:"no-op",content:n(58),compatibility:r.ShaderInjectionTarget.FRAGMENT}])},function(e,t){e.exports="lowp vec4 setColor(vec4 color) {\n  gl_FragColor = color;\n  return gl_FragColor;\n}\n"},function(e,t){e.exports="\n"},function(e,t){e.exports="// This contains the method required to be used on a fragment shader when a layer desires to use\n// PickType.SINGLE (color picking).\nvarying vec4 _picking_color_pass_;\n\nlowp vec4 setColor(vec4 color) {\n  gl_FragColor = mix(color, _picking_color_pass_, pickingActive);\n\n  if (color.a == 0.0) {\n    discard;\n  }\n\n  return gl_FragColor;\n}\n"},function(e,t){e.exports="// This is the varying auto generated for the fragment shader that is needed in the vertex shader to pass the\n// color for the instance through to the fragment shader\nvarying vec4 _picking_color_pass_;\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(10).ShaderModule.register([{moduleId:"picking",content:n(64),compatibility:r.ShaderInjectionTarget.VERTEX,instanceAttributes:function(e){return[{name:"_pickingColor",size:r.InstanceAttributeSize.FOUR,update:function(e){var t=16777215-e.uid;return[(t>>16)/255,((65280&t)>>8)/255,(255&t)/255,1]}}]},uniforms:function(e){return[{name:"pickingActive",shaderInjection:r.ShaderInjectionTarget.ALL,size:r.UniformSize.ONE,update:function(){return[e.picking.currentPickMode===r.PickType.SINGLE?1:0]}}]}},{moduleId:"picking",content:n(63),compatibility:r.ShaderInjectionTarget.FRAGMENT},{moduleId:"no-picking",content:n(62),compatibility:r.ShaderInjectionTarget.VERTEX},{moduleId:"no-picking",content:n(61),compatibility:r.ShaderInjectionTarget.FRAGMENT}])},function(e,t){e.exports="${import: PI, PI2}\n\n/**\n * This is an approximation of sin that allows us to bypass hardware precision\n * limitations for sin.\n *\n * http://lab.polygonal.de/2007/07/18/fast-and-accurate-sinecosine-approximation/\n * This is a GPU adaptation of this method to provide optimal GPU performance for the operation\n */\nfloat fsin(float x) {\n  float sine;\n\n  // Always wrap input angle to -PI..PI\n  x += mix(\n    mix(\n      0.0,\n      -PI2, float(x > PI)\n    ),\n    PI2, float(x < -PI)\n  );\n\n  // Compute sine\n  sine = 1.27323954 * x;\n  sine += mix(-1.0, 1.0, float(x < 0.0)) * 0.405284735 * x * x;\n  sine = 0.225 * (sine * (mix(1.0, -1.0, float(sine < 0.0)) * sine) - sine) + sine;\n\n  return sine;\n}\n"},function(e,t){e.exports="${import: PI, PI2, PI_2}\n\n/**\n * This is an approximation of cos that allows us to bypass hardware precision\n * limitations for cos.\n *\n * http://lab.polygonal.de/2007/07/18/fast-and-accurate-sinecosine-approximation/\n * This is a GPU adaptation of this method to provide optimal GPU performance for the operation\n */\nfloat fcos(float x) {\n  float sine;\n  // Cos is the same as sine but\n  x += PI_2;\n\n  // Always wrap input angle to -PI..PI\n  x += mix(\n    mix(\n      0.0,\n      -PI2, float(x > PI)\n    ),\n    PI2, float(x < -PI)\n  );\n\n  // Compute sine\n  sine = 1.27323954 * x;\n  sine += mix(-1.0, 1.0, float(x < 0.0)) * 0.405284735 * x * x;\n  sine = 0.225 * (sine * (mix(1.0, -1.0, float(sine < 0.0)) * sine) - sine) + sine;\n\n  return sine;\n}\n"},function(e,t){e.exports="${import: fsin, fcos}\n\n/**\n * A circular arc interpolator\n */\nvec2 circularArc(float t, vec2 center, float radius, float start, float end) {\n  float angle = (end - start) * t + start;\n  return center + vec2(fcos(angle) * radius, fsin(angle) * radius);\n}\n"},function(e,t){e.exports="/**\n * Two control point bezier curve\n */\nvec2 bezier2(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\n  float t1 = 1.0 - t;\n  return pow(t1, 3.0) * p1 + 3.0 * t * pow(t1, 2.0) * c1 + 3.0 * pow(t, 2.0) * t1 * c2 + pow(t, 3.0) * p2;\n}"},function(e,t){e.exports="/**\n * Single control point bezier curve\n */\nvec2 bezier1(float t, vec2 p1, vec2 p2, vec2 c1) {\n  return (1.0 - t) * (1.0 - t) * p1 + 2.0 * t * (1.0 - t) * c1 + t * t * p2;\n}\n"},function(e,t){e.exports="float toRadians = 0.01745329252;\n"},function(e,t){e.exports="float toDegrees = 57.2957795131;\n"},function(e,t){e.exports="float PI2 = 6.2831853;\n"},function(e,t){e.exports="float PI = 3.14159265;\n"},function(e,t){e.exports="float PI_4 = 0.7853981634;\n"},function(e,t){e.exports="float PI_2 = 1.5707963268;\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(10),o=[{moduleId:"PI_2",content:n(76),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"PI_4",content:n(75),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"PI",content:n(74),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"PI2",content:n(73),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"toDegrees",content:n(72),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"toRadians",content:n(71),compatibility:r.ShaderInjectionTarget.ALL}],a={moduleId:"constants",content:"${import: "+o.map(function(e){return e.moduleId}).join(", ")+"}",compatibility:r.ShaderInjectionTarget.ALL},s=[{moduleId:"bezier1",content:n(70),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"bezier2",content:n(69),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"circularArc",content:n(68),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"fcos",content:n(67),compatibility:r.ShaderInjectionTarget.ALL},{moduleId:"fsin",content:n(66),compatibility:r.ShaderInjectionTarget.ALL}];i.ShaderModule.register(s.concat(o,[a]))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(0);n(10).ShaderModule.register({moduleId:"instancing",content:"",compatibility:i.ShaderInjectionTarget.ALL,instanceAttributes:function(e){var t={name:"_active",size:i.InstanceAttributeSize.ONE,update:function(e){return[e.active?1:0]}};return e.activeAttribute=t,[t]},vertexAttributes:function(e){return e.bufferType===r.LayerBufferType.UNIFORM?[{name:"instance",size:i.VertexAttributeSize.ONE,update:function(){return[0]}}]:[]}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(10).ShaderModule.register({moduleId:"frame",content:"",compatibility:r.ShaderInjectionTarget.ALL,uniforms:function(e){return[{name:"currentTime",size:r.UniformSize.ONE,update:function(){return[e.surface.frameMetrics.currentTime]}}]}})},function(e,t){e.exports="// These are projection methods utilizing the simpler camera breakdown approach\n${import: camera}\n\nvec3 cameraSpace(vec3 world) {\n  return (world + cameraOffset) * cameraScale;\n}\n\nvec3 cameraSpaceSize(vec3 worldSize) {\n  return worldSize * cameraScale;\n}\n\nvec4 clipSpace(vec3 world) {\n  return vec4(((projection * modelView) * vec4(cameraSpace(world), 1.0)).xyz, 1.0);\n}\n\nvec4 clipSpaceSize(vec3 worldSize) {\n  return vec4(((projection * modelView) * vec4(cameraSpaceSize(worldSize), 0.0)).xyz, 1.0);\n}\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(10).ShaderModule.register([{moduleId:"camera",content:"",compatibility:r.ShaderInjectionTarget.ALL,uniforms:function(e){return[{name:"projection",size:r.UniformSize.MATRIX4,update:function(){return e.view.viewCamera.baseCamera.projectionMatrix.elements}},{name:"modelView",size:r.UniformSize.MATRIX4,update:function(){return e.view.viewCamera.baseCamera.matrix.elements}},{name:"cameraOffset",size:r.UniformSize.THREE,update:function(){return e.view.camera.offset}},{name:"cameraScale",size:r.UniformSize.THREE,update:function(){return e.view.camera.scale}},{name:"viewSize",size:r.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:r.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]}},{moduleId:"projection",content:n(80),compatibility:r.ShaderInjectionTarget.ALL}])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(81),n(79),n(78),n(77),n(65),n(60)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(82),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(54))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(22);function a(e){return e?[e.atlasTL[0],e.atlasTL[1],e.atlasBR[0],e.atlasBR[1]]:[0,0,0,0]}var s=function(){function e(e){this.targetAtlas="",this.requestQueue=new Map,this.requestLookup=new Map,this.atlasManager=e.atlasManager}return e.prototype.dequeueRequests=function(){return r(this,void 0,void 0,function(){var e,t,n,r,o,a,s,c;return i(this,function(u){switch(u.label){case 0:e=!1,t=function(t,r){var o,a;return i(this,function(i){switch(i.label){case 0:return r.length>0?(e=!0,o=r.slice(0),r.length=0,[4,n.atlasManager.updateAtlas(t,o)]):[3,2];case 1:i.sent(),(a=n.requestLookup.get(t))&&o.forEach(function(e){var t=a.get(e);if(a.delete(e),t){for(var n=0,r=t.length;n<r;++n){var i=t[n],o=i[0],s=i[1];o.bufferManager.getBufferLocations(s)&&(s.active=!0)}requestAnimationFrame(function(){for(var e=0,n=t.length;e<n;++e){t[e][1].resourceTrigger()}})}}),i.label=2;case 2:return[2]}})},n=this,r=0,o=Array.from(this.requestQueue.entries()),u.label=1;case 1:return r<o.length?(a=o[r],s=a[0],c=a[1],[5,t(s,c)]):[3,4];case 2:u.sent(),u.label=3;case 3:return r++,[3,1];case 4:return[2,e]}})})},e.prototype.destroy=function(){this.atlasManager.destroy()},e.prototype.getAtlasTexture=function(e){var t=this.atlasManager.getAtlasTexture(e);return t?t.texture:null},e.prototype.request=function(e,t,n){var r=n.texture;if(r)return a(r);if(n instanceof o.LabelAtlasResource&&!n.label.text)return a(r);var i=this.requestLookup.get(this.targetAtlas);if(i){var s=i.get(n);if(s)return s.push([e,t]),t.active=!1,a(r)}else i=new Map,this.requestLookup.set(this.targetAtlas,i);t.active=!1;var c=this.requestQueue.get(this.targetAtlas);return c||(c=[],this.requestQueue.set(this.targetAtlas,c)),c.push(n),i.set(n,[[e,t]]),a(r)},e.prototype.setTargetAtlas=function(e){this.targetAtlas=e},e}();t.AtlasResourceManager=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),o=n(13);t.filterQuery=function(e,t){var n=[];return t.forEach(function(t){e.find(function(e){return t instanceof e})&&n.push(t)}),n};var a=function(){function e(e,t){var n=e.mid;this.TL=new s(e.x,n[0],e.y,n[1],t),this.TR=new s(n[0],e.right,e.y,n[1],t),this.BL=new s(e.x,n[0],n[1],e.bottom,t),this.BR=new s(n[0],e.right,n[1],e.bottom,t)}return e.prototype.destroy=function(){this.TL.destroy(),this.TR.destroy(),this.BL.destroy(),this.BR.destroy(),delete this.TL,delete this.TR,delete this.BL,delete this.BR},e}();t.Quadrants=a;var s=function(){function e(e,t,n,r,o){this.children=[],this.depth=0,arguments.length>=4?this.bounds=new i.Bounds({height:n-r,width:t-e,x:e,y:n}):this.bounds=new i.Bounds({height:1,width:1,x:0,y:0}),this.depth=o||0}return e.prototype.destroy=function(){delete this.children,delete this.bounds,this.nodes&&(this.nodes.destroy(),delete this.nodes)},e.prototype.add=function(e,t){return e.isInside(this.bounds)?this.doAdd(e):(this.cover(e),this.add(e,t))},e.prototype.addAll=function(e,t){var n=this;t=t||[];var r=Number.MAX_VALUE,o=Number.MAX_VALUE,a=-Number.MAX_VALUE,s=-Number.MAX_VALUE;e.forEach(function(e){e.x<r&&(r=e.x),e.right>a&&(a=e.right),e.bottom>s&&(s=e.bottom),e.y<o&&(o=e.y)}),this.cover(new i.Bounds({height:s-o,width:a-r,x:r,y:o})),e.forEach(function(e){return n.doAdd(e)})},e.prototype.cover=function(e){var t=this;if(!e.isInside(this.bounds)){this.bounds.encapsulate(e),this.bounds.x-=1,this.bounds.y-=1,this.bounds.width+=2,this.bounds.height+=4;var n=this.gatherChildren([]);this.nodes&&(this.nodes.destroy(),delete this.nodes),n.forEach(function(e){return t.doAdd(e)})}},e.prototype.doAdd=function(e){return this.nodes?e.isInside(this.nodes.TL.bounds)?this.nodes.TL.doAdd(e):e.isInside(this.nodes.TR.bounds)?this.nodes.TR.doAdd(e):e.isInside(this.nodes.BL.bounds)?this.nodes.BL.doAdd(e):e.isInside(this.nodes.BR.bounds)?this.nodes.BR.doAdd(e):(this.children.push(e),!0):e.isInside(this.bounds)?(this.children.push(e),this.children.length>5&&this.depth<10&&this.split(),!0):(isNaN(e.width+e.height+e.x+e.y)?console.error("Child did not fit into bounds because a dimension is NaN",e):0===e.area&&console.error("Child did not fit into bounds because the area is zero",e),!0)},e.prototype.gatherChildren=function(e){return e=e.concat(this.children),this.nodes&&(this.nodes.TL.gatherChildren(e),this.nodes.TR.gatherChildren(e),this.nodes.BL.gatherChildren(e),this.nodes.BR.gatherChildren(e)),e},e.prototype.query=function(e,t){return e instanceof i.Bounds?e.hitBounds(this.bounds)?this.queryBounds(e,[],t):[]:o.isVec2(e)&&this.bounds.containsPoint(e)?this.queryPoint(e,[],t):[]},e.prototype.queryBounds=function(e,t,n){return this.children.forEach(function(n){n.hitBounds(e)&&t.push(n)}),n&&n(this),this.nodes&&(e.hitBounds(this.nodes.TL.bounds)&&this.nodes.TL.queryBounds(e,t,n),e.hitBounds(this.nodes.TR.bounds)&&this.nodes.TR.queryBounds(e,t,n),e.hitBounds(this.nodes.BL.bounds)&&this.nodes.BL.queryBounds(e,t,n),e.hitBounds(this.nodes.BR.bounds)&&this.nodes.BR.queryBounds(e,t,n)),t},e.prototype.queryPoint=function(e,t,n){return this.children.forEach(function(n){n.containsPoint(e)&&t.push(n)}),n&&n(this),this.nodes&&(this.nodes.TL.bounds.containsPoint(e)&&this.nodes.TL.queryPoint(e,t,n),this.nodes.TR.bounds.containsPoint(e)&&this.nodes.TR.queryPoint(e,t,n),this.nodes.BL.bounds.containsPoint(e)&&this.nodes.BL.queryPoint(e,t,n),this.nodes.BR.bounds.containsPoint(e)&&this.nodes.BR.queryPoint(e,t,n)),t},e.prototype.split=function(){var e=this.gatherChildren([]);for(this.nodes=new a(this.bounds,this.depth+1),this.children=[];e.length>0;){var t=e.pop();t&&this.doAdd(t)}},e.prototype.visit=function(e){var t=Boolean(e(this));this.nodes&&!t&&(this.nodes.TL.visit(e),this.nodes.TR.visit(e),this.nodes.BL.visit(e),this.nodes.BR.visit(e))},e}();t.Node=s;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(s);t.QuadTree=c},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);function o(e){return Boolean(e)}var a=function(e){function t(t){var n=e.call(this)||this;return n.isOver=new Map,n.surface=t,n.sceneViews=t.sceneViews,n}return r(t,e),t.prototype.getSceneViewsUnderMouse=function(e){for(var t=new Map,n=0,r=this.sceneViews;n<r.length;n++){var i=r[n];t.set(i.view.id,i)}return e.viewsUnderMouse.map(function(e){return t.get(e.view.id)}).filter(o)},t.prototype.getMouseByViewId=function(e){for(var t=new Map,n=0,r=e.viewsUnderMouse;n<r.length;n++){var i=r[n];t.set(i.view.id,i.mouse)}return t},t.prototype.handleClick=function(e,t){this.handleInteraction(e,function(e,n,r){return e.interactions.handleMouseClick(n,r,t)})},t.prototype.handleDrag=function(e,t){this.handleInteraction(e,function(e,t,n){return e.interactions.handleMouseDrag(t,n)})},t.prototype.handleInteraction=function(e,t){for(var n=this.getSceneViewsUnderMouse(e),r=this.getMouseByViewId(e),i=0,o=n;i<o.length;i++){var a=o[i];this.handleSceneView(a,r,t)}return n},t.prototype.handleMouseDown=function(e,t){this.handleInteraction(e,function(e,n,r){return e.interactions.handleMouseDown(n,r,t)})},t.prototype.handleMouseUp=function(e,t){this.handleInteraction(e,function(e,n,r){return e.interactions.handleMouseUp(n,r,t)})},t.prototype.handleMouseOver=function(e){},t.prototype.handleMouseOut=function(e){var t=this,n=this.getMouseByViewId(e),r=e.screen.mouse;this.isOver.forEach(function(e,i){n.set(i.view.id,i.view.screenToView(r)),t.handleSceneView(i,n,function(e,t,n){return e.interactions.handleMouseOut(t,n)})}),this.isOver.clear()},t.prototype.handleMouseMove=function(e){var t=this;this.surface&&this.surface.updateColorPickRange(e.screen.mouse,e.viewsUnderMouse.map(function(e){return e.view}));var n=this.handleInteraction(e,function(e,t,n){return e.interactions.handleMouseMove(t,n)}),r=this.getMouseByViewId(e),i=e.screen.mouse,o=new Map;n.forEach(function(e){return o.set(e,!0)}),o.forEach(function(e,n){t.isOver.get(n)||t.handleSceneView(n,r,function(e,t,n){return e.interactions.handleMouseOver(t,n)})}),this.isOver.forEach(function(e,n){o.get(n)||(r.set(n.view.id,n.view.screenToView(i)),t.handleSceneView(n,r,function(e,t,n){return e.interactions.handleMouseOut(t,n)}))}),this.isOver=o},t.prototype.handleSceneView=function(e,t,n){var r=e.view,o=t.get(r.id);if(o)for(var a=0,s=e.scene.layers;a<s.length;a++){var c=s[a];c.picking&&c.picking.type!==i.PickType.NONE&&n(c,r,o)}},t.prototype.handleWheel=function(e){},t}(n(31).EventManager);t.LayerMouseEvents=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.analyzeColorPickingRendering=function(e,t,n,r){for(var i={allColors:[],colorData:t,dataHeight:r,dataWidth:n,mouse:e,nearestColor:0},o=new Map,a=0,s=[],c=n/2,u=r/2,l=0,d=Number.MAX_SAFE_INTEGER,h=0;h<r;++h){var f=[];s.push(f);for(var p=0;p<n;++p){var v=t[a],g=t[a+1],y=t[a+2];a+=4;var m=v<<16|g<<8|y;if(o.set(m,!0),f.push(m),0!==m){var b=p-c,w=h-u,_=b*b+w*w;_<d&&(d=_,l=m)}}}return i.allColors=Array.from(o.keys()),i.nearestColor=l,i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(27),i=function(){function e(){}return e.calculateUniformBlockUseage=function(e){for(var t=0,n=0,r=e.length;n<r;++n)t+=Math.ceil(e[n].size/4);return t},e.prototype.process=function(t,n){var i=this;this.instanceMaxBlock=0,t.forEach(function(e){i.instanceMaxBlock=Math.max(i.instanceMaxBlock,e.block||0)}),this.blocksPerInstance=this.instanceMaxBlock+1,this.maxUniforms=r.WebGLStat.MAX_VERTEX_UNIFORMS,this.maxUniformsForInstancing=this.maxUniforms-e.calculateUniformBlockUseage(n),this.maxInstancesPerBuffer=Math.floor(this.maxUniformsForInstancing/this.blocksPerInstance),this.totalInstanceUniformBlocks=this.maxInstancesPerBuffer*this.blocksPerInstance},e}();t.MetricsProcessing=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),i=n(29),o={1:"float",2:"vec2",3:"vec3",4:"vec4",9:"mat3",16:"mat4",99:"sampler2D"},a=function(){function e(){}return e.prototype.process=function(e){var t=new Map,n="// Auto Easing Methods specified by the layer\n";if(e.forEach(function(e){if(e.easing&&e.size){var n=t.get(e.easing.methodName);n||(n=new Map,t.set(e.easing.methodName,n)),n.set(e.size,e.easing.gpu)}}),0===t.size)return"";var a={name:"Easing Method Generation",values:[i.templateVars.easingMethod]};return t.forEach(function(e,t){e.forEach(function(e,s){var c,u=o[s],l=((c={})[i.templateVars.easingMethod]=u+" "+t+"("+u+" start, "+u+" end, float t)",c[i.templateVars.T]=""+u,c),d=r.shaderTemplate({options:l,required:a,shader:e});n+=d.shader+"\n"})}),n},e}();t.EasingProcessing=a},function(e,t){e.exports="\n  // This is a special injected instance attribute. It lets the system\n  // control specific instances ability to draw, which allows the backend\n  // system greater control on how it optimizes draw calls and it's buffers.\n  if (_active == 0.0) {\n    gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Quick exit to prevent any geometry from arising from the instance\n    return;\n  }\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(0),o=n(55),a=n(52),s=["x","y","z","w"],c={1:"float",2:"vec2",3:"vec3",4:"vec4",9:"mat3",16:"mat4",99:"vec4"};function u(e,t){return e.easing&&!t.easing?1:-1}function l(e,t){return s.slice(e,e+t).join("")}var d=function(){function e(e,t){this.metricsProcessor=t,this.uniformProcessor=e}return e.prototype.process=function(e,t,n){return{declarations:this.processDeclarations(e,t,n),destructuring:this.processDestructuring(e,n)}},e.prototype.processDeclarations=function(e,t,n){var i="// Shader input\n";return e.bufferType===r.LayerBufferType.UNIFORM&&n.length>0&&(i+=this.uniformProcessor.generateUniformAttributePacking()),i+=this.processVertexAttributes(t),e.bufferType===r.LayerBufferType.INSTANCE_ATTRIBUTE&&n.length>0&&(i+=this.processInstanceAttributeBufferStrategy(n)),e.bufferType===r.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING&&n.length>0&&(i+=this.processInstanceAttributePackingBufferStrategy(this.metricsProcessor.instanceMaxBlock)),i},e.prototype.processDestructuring=function(e,t){var o="",a=t.slice(0).sort(u);switch(e.bufferType){case r.LayerBufferType.INSTANCE_ATTRIBUTE:o=this.processDestructuringInstanceAttribute(a);break;case r.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING:o=this.processDestructuringInstanceAttributePacking(a);break;case r.LayerBufferType.UNIFORM:o=this.processDestructuringUniformBuffer(a,this.metricsProcessor.blocksPerInstance)}return e.picking.type===i.PickType.SINGLE&&(o+="\n// This portion is where the shader assigns the picking color that gets passed to the fragment shader\n_picking_color_pass_ = _pickingColor;\n"),o+=n(90)},e.prototype.processDestructuringInstanceAttribute=function(e){var t=this,n="";return e.forEach(function(e){e.easing&&e.size&&(n+=t.processAutoEasingTiming(e),n+="  "+c[e.size]+" "+e.name+" = "+e.easing.methodName+"(_"+e.name+"_start, _"+e.name+"_end, _"+e.name+"_time);\n")}),n},e.prototype.processDestructuringInstanceAttributePacking=function(e){var t="";return t+=this.processDestructureBlocks(e)},e.prototype.processDestructuringUniformBuffer=function(e,t){for(var n="int instanceIndex = int(instance);",r=0;r<t;++r)n+="  vec4 block"+r+" = getBlock("+r+", instanceIndex);\n";return n+=this.processDestructureBlocks(e)},e.prototype.processDestructureBlocks=function(e){var t=this,n="";return e.forEach(function(e){var r=e.block;e.easing&&e.size?(e.size===i.InstanceAttributeSize.FOUR?n+="  "+c[e.size]+" _"+e.name+"_end = block"+r+";\n":n+="  "+c[e.size||1]+" _"+e.name+"_end = block"+r+"."+l(e.blockIndex||0,e.size||1)+";\n",n+=t.processAutoEasingTiming(e),n+="  "+c[e.size]+" "+e.name+" = "+e.easing.methodName+"(_"+e.name+"_start, _"+e.name+"_end, _"+e.name+"_time);\n"):e.size===i.InstanceAttributeSize.FOUR?n+="  "+c[e.size]+" "+e.name+" = block"+r+";\n":e.atlas?n+="  "+c[i.InstanceAttributeSize.ATLAS]+" "+e.name+" = block"+r+";\n":n+="  "+c[e.size||1]+" "+e.name+" = block"+r+"."+l(e.blockIndex||0,e.size||1)+";\n"}),n},e.prototype.processAutoEasingTiming=function(e){if(e.easing){var t="",n="_"+e.name+"_time",r="_"+e.name+"_duration",i="_"+e.name+"_start_time";switch(e.easing.loop){case o.AutoEasingLoopStyle.CONTINUOUS:t+="  float "+n+" = (currentTime - "+i+") / "+r+";\n";break;case o.AutoEasingLoopStyle.REPEAT:t+="  float "+n+" = clamp(fract((currentTime - "+i+") / "+r+"), 0.0, 1.0);\n";break;case o.AutoEasingLoopStyle.REFLECT:var a="_"+e.name+"_timePassed",s="_"+e.name+"_pingPong";t+="  float "+a+" = (currentTime - "+i+") / "+r+";\n",t+="  float "+s+" = abs((fract("+a+" / 2.0)) - 0.5) * 2.0;\n",t+="  float "+n+" = clamp("+s+", 0.0, 1.0);\n";break;case o.AutoEasingLoopStyle.NONE:default:t+="  float "+n+" = clamp((currentTime - "+i+") / "+r+", 0.0, 1.0);\n"}return t}},e.prototype.processInstanceAttributeBufferStrategy=function(e){var t="\n// Instance Attributes\n";return e.forEach(function(e){t+="attribute "+c[e.size||1]+" "+(e.qualifier||"")+(e.qualifier?" ":"")+" "+a.getAttributeShaderName(e)+";\n"}),t},e.prototype.processInstanceAttributePackingBufferStrategy=function(e){for(var t="\n// Instance Attributes\n",n=0,r=e+1;n<r;++n)t+="attribute "+c[i.InstanceAttributeSize.FOUR]+" block"+n+";\n";return t},e.prototype.processVertexAttributes=function(e){var t="// Vertex Attributes\n";return e.forEach(function(e){t+="attribute "+c[e.size]+" "+(e.qualifier||"")+(e.qualifier?" ":"")+e.name+";\n"}),t},e}();t.AttributeProcessing=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(2),o=function(){function e(e){this.index=0,this.available=4,this.index=e}return e.prototype.setAttribute=function(e){return(e.size||0)<=this.available&&(e.block=this.index,e.blockIndex=4-this.available,this.available-=e.size||0,!0)},e}();t.packAttributes=function(e){!function(e){e.forEach(function(e){if(e.atlas&&(e.size=r.InstanceAttributeSize.FOUR),!e.size)try{var t=e.update(new i.Instance({}));t.length>0&&t.length<=r.InstanceAttributeSize.FOUR&&(e.size=t.length)}catch(t){console.warn("The system could not determine the size of the provided attribute. Please provide the size of the attribute:",e)}})}(e);var t=[new o(0)];e.forEach(function(e){if(!t.find(function(t){return!!t.setAttribute(e)&&Boolean(t)})){var n=new o(t.length);t.push(n),n.setAttribute(e)||console.warn("There was a problem packing an attribute into a block. No block would accommodate it:",e)}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(2),o=n(57),a=Math.abs,s={duration:0,start:[0],end:[0],startTime:0};function c(e){return Boolean(e)&&e.easing&&void 0!==e.size}t.generateEasingAttributes=function(e,t){for(var n=new Set,u=[],l=0,d=t;l<d.length;l++)c(g=d[l])&&u.push(g);var h={};e.easingId=h;for(var f=function(c){var u=c.easing,l=u.cpu,d=u.loop,f=u.uid,p=c.name,v=c.size,g=c.update,y=f;h[c.name]=y,n.has(y)&&console.error("Undefined behavior occurs if you reuse an IAutoEasingMethod. Please ensure you are using uid() from the util to give the IAutoEasingMethod its uid, or just use the default provided methods"),n.add(y);var m={values:s};c.update=function(t){var n=c.easing,r=n.delay,s=n.duration,u=g(t),h=e.surface.frameMetrics.currentTime,f=t.easing.get(y);f||(f=new o.EasingProps({duration:s,end:u,start:u,startTime:h}),t.easing.set(y,f));var p=f,v=s,b=r;if(p.isTimeSet&&(v=p.duration||s,b=p.delay||0),!p.isManualStart){var w=1;switch(d){case i.AutoEasingLoopStyle.CONTINUOUS:w=(h-p.startTime)/v;break;case i.AutoEasingLoopStyle.REPEAT:w=(h-p.startTime)/v%1;break;case i.AutoEasingLoopStyle.REFLECT:var _=(h-p.startTime)/v;w=2*a(_/2%1-.5);break;case i.AutoEasingLoopStyle.NONE:default:w=(h-p.startTime)/v}p.start=l(p.start,p.end,w)}return p.startTime=h+b,p.end=u,m.values=p,e.animationEndTime=Math.max(e.animationEndTime,p.startTime+v),u},c.childAttributes=[];var b={name:"_"+p+"_start",parentAttribute:c,size:v,update:function(e){return m.values.start}};c.childAttributes.push(b),t.push(b);var w={name:"_"+p+"_start_time",parentAttribute:c,size:r.InstanceAttributeSize.ONE,update:function(e){return[m.values.startTime]}};c.childAttributes.push(w),t.push(w);var _={name:"_"+p+"_duration",parentAttribute:c,size:r.InstanceAttributeSize.ONE,update:function(e){return[m.values.duration]}};c.childAttributes.push(_),t.push(_)},p=0,v=u;p<v.length;p++){var g;f(g=v[p])}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(0),o=new r.Texture;t.generateAtlasResourceUniforms=function(e,t){var n=[],r=new Map;t.forEach(function(e){if(function(e){return Boolean(e)&&e.atlas}(e)){e.size=i.InstanceAttributeSize.FOUR,e.blockIndex=i.InstanceBlockIndex.ONE;var t=e.atlas.shaderInjection||i.ShaderInjectionTarget.FRAGMENT,o=r.get(e.atlas.name);o?r.set(e.atlas.name,[o[0]||t===i.ShaderInjectionTarget.VERTEX||t===i.ShaderInjectionTarget.ALL,o[1]||t===i.ShaderInjectionTarget.FRAGMENT||t===i.ShaderInjectionTarget.ALL]):(n.push(e),r.set(e.atlas.name,[t===i.ShaderInjectionTarget.VERTEX||t===i.ShaderInjectionTarget.ALL,t===i.ShaderInjectionTarget.FRAGMENT||t===i.ShaderInjectionTarget.ALL]))}});var a=[];return n.map(function(t){var n=i.ShaderInjectionTarget.FRAGMENT;if(t.atlas){var a=r.get(t.atlas.name);a&&(n=a[0]&&a[1]&&i.ShaderInjectionTarget.ALL||a[0]&&!a[1]&&i.ShaderInjectionTarget.VERTEX||!a[0]&&a[1]&&i.ShaderInjectionTarget.FRAGMENT||n)}return[{name:t.atlas.name,shaderInjection:n,size:i.UniformSize.ATLAS,update:function(){return e.resource.getAtlasTexture(t.atlas.key)||o}},{name:t.atlas.name+"_size",shaderInjection:n,size:i.UniformSize.TWO,update:function(){var n=e.resource.getAtlasTexture(t.atlas.key);if(n&&n.image){var r=n.image,i=r.width,o=r.height;return[i||1,o||1]}return[1,1]}}]}).forEach(function(e){return e.forEach(function(e){return a.push(e)})}),a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(38),i=n(9),o=n(0),a=n(17),s=n(29),c=n(91),u=n(89),l=n(88),d=n(37),h=n(50),f=function(){function e(){this.easingProcessing=new u.EasingProcessing,this.metricsProcessing=new l.MetricsProcessing,this.uniformProcessing=new h.UniformProcessing(this.metricsProcessing),this.attributeProcessing=new c.AttributeProcessing(this.uniformProcessing,this.metricsProcessing)}return e.prototype.process=function(e,t){var n;try{this.uniformProcessing.materialUniforms=[];var c=this.processImports(e,t);if(!c)return null;var u=r.injectShaderIO(e.surface.gl,e,t,c),l=u.vertexAttributes,d=u.instanceAttributes,h=u.uniforms;i.getLayerBufferType(e.surface.gl,e,l,d),this.metricsProcessing.process(d,h);var f=this.attributeProcessing.process(e,l,d);if(null===f)return null;var p=this.uniformProcessing.process(h,o.ShaderInjectionTarget.VERTEX);if(null===p)return null;var v=this.uniformProcessing.process(h,o.ShaderInjectionTarget.FRAGMENT);if(null===v)return null;var g=this.easingProcessing.process(d);if(null===g)return null;var y="precision highp float;\n\n"+f.declarations+p+g+c.vs,m="precision highp float;\n\n"+v+c.fs,b=((n={})[s.templateVars.attributes]=f.destructuring,n),w=a.shaderTemplate({options:b,required:void 0,shader:y});return b={},{fs:a.shaderTemplate({options:b,required:void 0,shader:m}).shader.trim(),materialUniforms:this.uniformProcessing.materialUniforms,maxInstancesPerBuffer:this.metricsProcessing.maxInstancesPerBuffer,modules:Array.from(c.shaderModuleUnits),vs:w.shader.trim(),vertexAttributes:l,instanceAttributes:d,uniforms:h}}catch(t){return console.warn("An unknown error occurred while processing the shaders for layer:",e.id),console.warn("Error:"),console.warn(t&&(t.stack||t.message)),null}},e.prototype.processImports=function(e,t){var n=new Set,r=e.baseShaderModules(t),i=d.ShaderModule.process(e.id,t.vs,o.ShaderInjectionTarget.VERTEX,r.vs);if(i.errors.length>0)return console.warn.apply(console,["Error processing imports for the vertex shader of layer:",e.id,"Errors"].concat(i.errors.reverse())),null;var a=d.ShaderModule.process(e.id,t.fs,o.ShaderInjectionTarget.FRAGMENT,r.fs);return a.errors.length>0?(console.warn.apply(console,["Error processing imports for the fragment shader of layer:",e.id,"Errors"].concat(a.errors.reverse())),null):(i.shaderModuleUnits.forEach(function(e){return n.add(e)}),a.shaderModuleUnits.forEach(function(e){return n.add(e)}),{fs:a.shader||"",vs:i.shader||"",shaderModuleUnits:n})},e}();t.ShaderProcessor=f},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(1),s=n(46),c=n(39),u=n(4),l=n(95),d=n(0),h=n(87),f=n(47),p=n(86),v=n(35),g=n(34),y=n(33),m=n(14),b=n(9),w=n(32),_=n(21),T=n(15),x=n(84),A=n(20),I=new o.Color(1,1,1);function S(e){return Boolean(e.getContext)}t.createLayer=function(e,t){return[e,t]};var M=function(){function e(){var e=this;this.atlasManager=new T.AtlasManager,this.currentViewport=new Map,this.frameMetrics={currentFrame:0,currentTime:0|Date.now(),previousTime:0|Date.now()},this.isBufferingAtlas=!1,this.layers=new Map,this.pixelRatio=window.devicePixelRatio,this.scenes=new Map,this.sceneViews=[],this.willDisposeLayer=new Map,this.viewDrawDependencies=new Map,this.loadReady=new Promise(function(t){return e.loadReadyResolve=t})}return Object.defineProperty(e.prototype,"gl",{get:function(){return this.context},enumerable:!0,configurable:!0}),e.prototype.addLayer=function(e){if(!e.id)return console.warn("All layers must have an id"),e;if(this.layers.get(e.id))return console.warn("All layer's ids must be unique per layer manager"),e;this.layers.set(e.id,e);var t=e.id;return this.initLayer(e)?e:(this.layers.delete(t),null)},e.prototype.commit=function(e,t,n){return r(this,void 0,void 0,function(){var r,o,a,s,c,l,h,f,p,v,g,y,m,b,w,_,T,x,A,I;return i(this,function(i){if(!this.gl)return[2];for(r=!1,t&&this.frameMetrics.currentFrame++,this.frameMetrics.previousTime=this.frameMetrics.currentTime,void 0===e?this.frameMetrics.currentTime=0|Date.now():(this.frameMetrics.previousTime===this.frameMetrics.currentTime&&(this.frameMetrics.previousTime=e),this.frameMetrics.currentTime=e),o=Array.from(this.scenes.values()),a={},s={},c=new Map,y=0,m=o.length;y<m;++y)for(b=o[y],w=Array.from(b.viewById.values()),l=b.layers,b.sortLayers(),_=0,T=w.length;_<T;++_){for(x=w[_],h=[],x.fitViewtoViewport(new u.Bounds({height:this.context.canvas.height,width:this.context.canvas.width,x:0,y:0})),f=0,p=l.length;f<p;++f){(v=l[f]).view=x;try{v.draw(),v.needsViewDrawn&&(x.needsDraw=!0),a[v.id]=v,x.animationEndTime=Math.max(x.animationEndTime,v.animationEndTime)}catch(e){s[v.id]||(s[v.id]=[v,e])}v.picking.type===d.PickType.SINGLE&&h.push(v)}(x.needsDraw||e&&e<x.animationEndTime||x.camera.needsViewDrawn)&&(x.needsDraw=!0,r=!0,(g=this.viewDrawDependencies.get(x))&&g.forEach(function(e){e.needsDraw=!0})),c.set(x,h)}for(y=0,m=o.length;y<m;++y)if((b=o[y]).container)for(w=Array.from(b.viewById.values()),_=0,T=w.length;_<T;++_)x=w[_],n&&n(r,b,x,c.get(x)||[]);return(A=Object.values(s)).length>0&&(I=Object.values(a),console.warn("Some layers errored during their draw update. These layers will be removed. They can be re-added if render() is called again:",A.map(function(e){return e[0].id})),A.forEach(function(e){console.warn("Layer "+e[0].id+" removed for the following error:"),e[1]&&console.error(e[1].stack||e[1].message)}),this.render(I.map(function(e){return e.initializer}))),[2]})})},e.prototype.destroy=function(){this.layers.forEach(function(e){return e.destroy()}),this.resourceManager.destroy(),this.mouseManager.destroy(),this.sceneViews.forEach(function(e){return e.scene.destroy()}),this.renderer.dispose(),this.pickingRenderer.dispose(),this.currentViewport.clear(),c.LabelInstance.destroy(),s.ImageInstance.destroy()},e.prototype.draw=function(e){return r(this,void 0,void 0,function(){var t,n=this;return i(this,function(r){switch(r.label){case 0:return this.gl?[4,this.commit(e,!0,function(e,t,r,i){if(t.container&&(e&&n.drawSceneView(t.container,r),i.length>0&&n.updateColorPick)){var o=n.updateColorPick.mouse;if(n.updateColorPick.views.indexOf(r)>-1){r.pixelRatio=1;var a=r.clearFlags.slice(0);r.clearFlags=[A.ClearFlags.COLOR,A.ClearFlags.DEPTH],r.fitViewtoViewport(new u.Bounds({height:n.context.canvas.height/n.pixelRatio,width:n.context.canvas.width/n.pixelRatio,x:0,y:0}));for(var s=0,c=i.length;s<c;++s){(p=i[s]).picking.currentPickMode=d.PickType.SINGLE;try{p.updateUniforms()}catch(e){console.warn(e)}p.picking.currentPickMode=d.PickType.NONE}n.drawSceneView(t.pickingContainer,r,n.pickingRenderer,n.pickingTarget);var l=new Uint8Array(100);n.pickingRenderer.readRenderTargetPixels(n.pickingTarget,o[0]-r.screenBounds.x-2.5,r.screenBounds.height-(o[1]-r.screenBounds.y)-2.5,5,5,l);var f=h.analyzeColorPickingRendering([o[0]-r.screenBounds.x,o[1]-r.screenBounds.y],l,5,5);for(s=0,c=i.length;s<c;++s){var p;(p=i[s]).picking.type===d.PickType.SINGLE&&(p.interactions.colorPicking=f)}r.pixelRatio=n.pixelRatio,r.clearFlags=a,r.fitViewtoViewport(new u.Bounds({height:n.context.canvas.height,width:n.context.canvas.width,x:0,y:0}))}}})]:[2];case 1:return r.sent(),this.mouseManager.waitingForRender&&(this.sceneViews.forEach(function(e){e.bounds=new f.DataBounds(e.view.screenBounds),e.bounds.data=e}),this.mouseManager.waitingForRender=!1),this.isBufferingAtlas?[3,3]:(this.isBufferingAtlas=!0,[4,this.resourceManager.dequeueRequests()]);case 2:t=r.sent(),this.isBufferingAtlas=!1,t&&(this.loadReadyResolve(),this.loadReady=new Promise(function(e){return n.loadReadyResolve=e}),this.draw()),r.label=3;case 3:return delete this.updateColorPick,this.sceneViews.forEach(function(e){e.view.needsDraw=!1,e.view.camera.resolve()}),this.layers.forEach(function(e){e.needsViewDrawn=!1,e.props.data.resolveContext=""}),[2]}})})},e.prototype.drawSceneView=function(e,t,n,r){n=n||this.renderer;var i=t.viewBounds.left,o=t.viewBounds.top,a=t.viewBounds,s=n.getSize(),c=n.getPixelRatio();s.width*=c,s.height*=c;var u=t.background,l=n.getContext();r||(n.setScissorTest(!0),n.setScissor(i/c,o/c,a.width/c,a.height/c),t.background&&l.clearColor(u[0],u[1],u[2],u[3])),t.clearFlags?r?(r.setSize(a.width,a.height),n.setRenderTarget(r),n.clear(t.clearFlags.indexOf(A.ClearFlags.COLOR)>-1,t.clearFlags.indexOf(A.ClearFlags.DEPTH)>-1,t.clearFlags.indexOf(A.ClearFlags.STENCIL)>-1)):n.getContext().clear((t.clearFlags.indexOf(A.ClearFlags.COLOR)>-1?l.COLOR_BUFFER_BIT:0)|(t.clearFlags.indexOf(A.ClearFlags.DEPTH)>-1?l.DEPTH_BUFFER_BIT:0)|(t.clearFlags.indexOf(A.ClearFlags.STENCIL)>-1?l.STENCIL_BUFFER_BIT:0)):r?(r.setSize(a.width,a.height),n.setRenderTarget(r),n.clear(!0,!0)):l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),n.setViewport(i/c,o/c,a.width,a.height),n.render(e,t.viewCamera.baseCamera,r)},e.prototype.gatherViewDrawDependencies=function(){this.viewDrawDependencies.clear();for(var e=0,t=this.sceneViews.length;e<t;e++)this.sceneViews[e].view.fitViewtoViewport(new u.Bounds({height:this.context.canvas.height,width:this.context.canvas.width,x:0,y:0}));for(e=0,t=this.sceneViews.length;e<t;e++){for(var n=this.sceneViews[e].view,r=[],i=0,o=this.sceneViews.length;i<o;i++)if(i!==e){var a=this.sceneViews[i].view;n.viewBounds.hitBounds(a.viewBounds)&&r.push(a)}this.viewDrawDependencies.set(n,r)}},e.prototype.getViewSize=function(e){for(var t=0,n=this.sceneViews;t<n.length;t++){var r=n[t];if(r.view.id===e)return r.view.screenBounds}return null},e.prototype.getViewWorldBounds=function(e){for(var t=0,n=this.sceneViews;t<n.length;t++){var r=n[t];if(r.view.id===e){var i=r.view;if(i.screenBounds){var o=i.viewToWorld([0,0]),a=i.screenToWorld([i.screenBounds.right,i.screenBounds.bottom]);return new u.Bounds({bottom:a[1],left:o[0],right:a[0],top:o[1]})}return null}}return null},e.prototype.init=function(e){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.pixelRatio=e.pixelRatio||this.pixelRatio,this.pixelRatio<1&&(this.pixelRatio=1),this.setContext(e.context),this.gl?(this.initGL(e),this.initMouseManager(e),[4,this.initResources(e)]):[3,2];case 1:return t.sent(),[3,3];case 2:console.warn("Could not establish a GL context. Layer Surface will be unable to render"),t.label=3;case 3:return[2,this]}})})},e.prototype.initGL=function(e){var t=this;if(this.context){var n=this.context.canvas,r=n.width,i=n.height;this.renderer=new o.WebGLRenderer({alpha:e.background&&e.background[3]<1,antialias:!0,canvas:n,preserveDrawingBuffer:!0}),this.pickingRenderer=new o.WebGLRenderer({alpha:!1,antialias:!1,preserveDrawingBuffer:!0}),this.renderer.autoClear=!1,this.setRendererSize(r,i),this.renderer.setPixelRatio(this.pixelRatio),e.background?this.renderer.setClearColor(new o.Color(e.background[0],e.background[1],e.background[2]),e.background[3]):this.renderer.setClearColor(I),this.pickingRenderer.autoClear=!1,this.pickingRenderer.setPixelRatio(1),this.pickingRenderer.setClearColor(new o.Color(0,0,0),1);var a=0;this.context.enable(this.context.SCISSOR_TEST),e.scenes&&(e.scenes.forEach(function(e){var n=new _.Scene(e),r=v.generateDefaultScene(t.context);e.views.forEach(function(e){var i=new A.View(e);i.camera=i.camera||r.camera,i.viewCamera=i.viewCamera||r.viewCamera,i.pixelRatio=t.pixelRatio,n.addView(i);for(var o=0,s=t.sceneViews;o<s.length;o++){s[o].view.id===i.id&&console.warn("You can NOT have two views with the same id. Please use unique identifiers for every view generated.")}t.sceneViews.push({depth:++a,scene:n,view:i})}),t.scenes.set(e.key,n)}),this.gatherViewDrawDependencies())}else console.error("Can not initialize Layer Surface as a valid GL context was not established.")},e.prototype.initLayer=function(e){e.surface=this,e.resource=this.resourceManager;var t=this.addLayerToScene(e);if(!t)return null;var n=e.initShader();n.instanceAttributes=(n.instanceAttributes||[]).filter(Boolean),n.vertexAttributes=(n.vertexAttributes||[]).filter(Boolean),n.uniforms=(n.uniforms||[]).filter(Boolean);var r=(new l.ShaderProcessor).process(e,n);if(!r)return null;var i=r.vertexAttributes,o=r.instanceAttributes,a=r.uniforms,s=g.generateLayerGeometry(e,r.maxInstancesPerBuffer,i,n.vertexCount),c=y.generateLayerMaterial(e,r.vs,r.fs,a,r.materialUniforms),u=m.generateLayerModel(e,s,c);return e.geometry=s,e.instanceAttributes=o,e.instanceVertexCount=n.vertexCount,e.material=c,e.maxInstancesPerBuffer=r.maxInstancesPerBuffer,e.model=u,e.uniforms=a,e.vertexAttributes=i,b.makeLayerBufferManager(this.gl,e,t),e.props.printShader&&(console.warn("A Layer requested its shader be debugged. Do not leave this active for production:","Layer:",e.props.key,"Shader Metrics",r),console.warn("\n\nVERTEX SHADER\n--------------\n\n",r.vs),console.warn("\n\nFRAGMENT SHADER\n--------------\n\n",r.fs)),e},e.prototype.initMouseManager=function(e){var t=[new p.LayerMouseEvents(this)].concat(e.eventManagers||[]);this.mouseManager=new w.MouseEventManager(this.context.canvas,this.sceneViews,t,e.handlesWheelEvents)},e.prototype.initResources=function(e){return r(this,void 0,void 0,function(){var t,n,r;return i(this,function(i){switch(i.label){case 0:if(!e.atlasResources)return[3,4];t=0,n=e.atlasResources,i.label=1;case 1:return t<n.length?(r=n[t],[4,this.atlasManager.createAtlas(r)]):[3,4];case 2:i.sent(),i.label=3;case 3:return t++,[3,1];case 4:return this.resourceManager=new x.AtlasResourceManager({atlasManager:this.atlasManager}),[2]}})})},e.prototype.addLayerToScene=function(e){var t=this.scenes.get(e.props.scene||"");return t?t.addLayer(e):console.warn("No scene is specified by the layer, or the scene identifier is invalid"),t},e.prototype.removeLayer=function(e){return e?this.layers.get(e&&e.id)?(e.destroy(),this.layers.delete(e.id),e):(console.warn("Tried to remove a layer that is not in the manager.",e),e):null},e.prototype.render=function(e){var t=this;this.gl&&(e&&e.length>0&&e.forEach(function(e){var n=e[0],r=e[1],i=t.layers.get(r.key);if(i)i.willUpdateProps(r),r.data!==i.props.data&&r.data.sync(),i.shouldDrawView(i.props,r)&&(i.needsViewDrawn=!0),Object.assign(i.props,r),i.initializer[1]=i.props,i.didUpdateProps();else{var o=new n(Object.assign({},n.defaultProps,r));if(o.initializer=e,o.props.data.sync(),!t.addLayer(o))return void console.warn("Error initializing layer:",r.key,"A layer was unable to be added to the surface. See previous warnings (if any) to determine why they could not be instantiated")}t.willDisposeLayer.set(r.key,!1)}),this.willDisposeLayer.forEach(function(e,n){if(e){var r=t.layers.get(n);r?t.removeLayer(r):console.warn("this.willDisposeLayer applied to a layer that does not exist in the existing layer check.")}}),this.willDisposeLayer.clear(),this.layers.forEach(function(e,n){t.willDisposeLayer.set(n,!0)}))},e.prototype.fitContainer=function(e){var t=this.context.canvas.parentElement;if(t){var n=this.context.canvas;n.className="",n.setAttribute("style",""),t.style.position="relative",n.style.position="absolute",n.style.left="0xp",n.style.top="0xp",n.style.width="100%",n.style.height="100%",n.setAttribute("width",""),n.setAttribute("height","");var r=t.getBoundingClientRect(),i=n.getBoundingClientRect();this.resize(i.width||100,r.height||100)}},e.prototype.resize=function(e,t,n){var r=this;this.pixelRatio=n||this.pixelRatio,this.pixelRatio<1&&(this.pixelRatio=1),this.sceneViews.forEach(function(e){return e.view.pixelRatio=r.pixelRatio}),this.setRendererSize(e,t),this.renderer.setPixelRatio(this.pixelRatio),this.pickingRenderer.setPixelRatio(1),this.mouseManager.resize(),this.gatherViewDrawDependencies()},e.prototype.setContext=function(e){if(e)if(function(e){return Boolean(e.canvas)}(e))this.context=e;else if(S(e)){var t=e.getContext("webgl")||e.getContext("experimental-webgl");t?this.context=t:console.warn("A valid GL context was not found for the context provided to the surface. This surface will not be able to operate.")}else if(function(e){return Boolean(e.substr)}(e)){var n=document.getElementById(e);S(n)&&this.setContext(n)}},e.prototype.setRendererSize=function(e,t){e=e||100,t=t||100,this.renderer.setSize(e,t),this.pickingRenderer.setSize(e,t),this.pickingTarget||(this.pickingTarget=new a.WebGLRenderTarget(e,t,{magFilter:o.LinearFilter,minFilter:o.LinearFilter,stencilBuffer:!1})),this.pickingTarget.setSize(e,t)},e.prototype.updateColorPickRange=function(e,t){this.updateColorPick={mouse:e,views:t}},e}();t.LayerSurface=M},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(96)),r(n(31)),r(n(35)),r(n(34)),r(n(33)),r(n(14)),r(n(38)),r(n(7)),r(n(32)),r(n(21)),r(n(15)),r(n(20))},function(e,t){e.exports="precision highp float;\n\n${import: projection}\n\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float borderSize;\nvarying vec2 pointCoord;\n${extendHeader}\n\nvarying float scale;\n\nvoid main() {\n  ${attributes}\n\n  scale = scaleFactor;\n\n  vertexColor = color;\n  float size = radius * scaleFactor;\n\n  float ringWidth = mix(2.0 , thickness, float(thickness > 2.0));\n\n  borderSize = mix(\n    (ringWidth) / size,\n    ((ringWidth * pixelRatio) / size),\n    float(pixelRatio > 1.0)\n  );\n\n  edgeSharpness = min(0.2 / (ringWidth * scale),  0.1);\n\n  pointCoord = (position.xy + vec2(1.0, 1.0)) / 2.0;\n\n  // Center within clip space\n  vec4 clipCenter = clipSpace(vec3(center, depth));\n  // Center in screen space\n  vec2 screenCenter = (clipCenter.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\n  // Position in screen space\n  vec2 vertex = (position.xy * size) + screenCenter;\n  // Position back to clip space\n  gl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), clipCenter.zw);\n  ${extend}\n}\n"},function(e,t){e.exports="precision highp float;\n\n/** This is the color of the ring */\nvarying vec4 vertexColor;\n/**\n * This is how sharp the ring renders. For tiny rings, it's best to have\n * less sharpness to better convey the shape of a circle. A good starter setting:\n * edgeSharpness = mix(0.8, 0.01, min(gl_PointSize / 45.0, 1.0));\n */\nvarying float edgeSharpness;\n/**\n * This should be a value that sets the thickness of the ring in normal space\n * relative to the PointSize\n */\nvarying float borderSize;\n/**\n * Since this is now a quad instead of a point sprite, this provides what gl_PointCoord\n * used to provide.\n */\nvarying vec2 pointCoord;\n\nvarying float scale;\n\nfloat circle(vec2 coord, float radius){\n  vec2 dist = coord - vec2(0.5);\n\n  return 1.0 - smoothstep(\n    radius - (radius * edgeSharpness),\n    radius,\n    dot(dist, dist) * 4.0\n  );\n\n}\n\n${extendHeader}\n\nvoid main() {\n  float outer_step_factor = circle(pointCoord, 1.0);\n  float inner_step_factor = circle(pointCoord, 1.0 - borderSize * scale);\n\n  setColor(mix(\n    mix(                        // Select the outer color outside of the inner radius\n      vec4(0.0, 0.0, 0.0, 0.0),    // Select invisible outside of inner and outer radius\n      vertexColor,                  // Select outer color outside of inner, but inside outer\n      outer_step_factor\n    ),\n    vec4(0.0, 0.0, 0.0, 0.0),                 // Select inner color inside inner\n    inner_step_factor\n  ));\n\n  ${extend}\n}\n"},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(3),a=n(11),s=n(7),c=n(0),u=n(2),l=Math.max,d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getInstancePickingMethods=function(){return{boundsAccessor:function(e){return new a.Bounds({height:2*e.radius,width:2*e.radius,x:e.center[0]-e.radius,y:e.center[1]-e.radius})},hitTest:function(e,t,n){var r=e.radius/l.apply(void 0,n.camera.scale),i=u.subtract2(t,e.center);return u.dot2(i,i)<r*r}}},t.prototype.initShader=function(){var e=this.props.scaleFactor||function(){return 1},r=this.props.animate||{},i=r.color,o=r.center,a=r.radius,s={0:1,1:1,2:-1,3:1,4:-1,5:-1},u={0:-1,1:-1,2:-1,3:1,4:1,5:1};return{fs:n(99),instanceAttributes:[{easing:o,name:t.attributeNames.center,size:c.InstanceAttributeSize.TWO,update:function(e){return e.center}},{easing:a,name:t.attributeNames.radius,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.radius]}},{name:t.attributeNames.depth,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{easing:i,name:t.attributeNames.color,size:c.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.thickness,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.thickness]}}],uniforms:[{name:"scaleFactor",size:c.UniformSize.ONE,update:function(t){return[e()]}}],vertexAttributes:[{name:"position",size:c.VertexAttributeSize.THREE,update:function(e){return[s[e],u[e],0]}}],vertexCount:6,vs:n(98)}},t.prototype.getModelType=function(){return{drawMode:i.TriangleStripDrawMode,modelType:i.Mesh}},t.prototype.getMaterialOptions=function(){return u.CommonMaterialOptions.transparentShape},t.defaultProps={key:"",data:new o.InstanceProvider,scene:"default"},t.attributeNames={center:"center",radius:"radius",depth:"depth",color:"color",thickness:"thickness"},t}(s.Layer);t.RingLayer=d},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(19),s=function(e){function t(t){var n=e.call(this,t)||this;return n.color=[1,1,1,1],n.depth=0,n.radius=0,n.thickness=1,n.center=[0,0],n.color=t.color||n.color,n.depth=t.depth||n.depth,n.radius=t.radius||n.radius,n.thickness=t.thickness||n.thickness,n.center=t.center||n.center,n}return r(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerRadius",{get:function(){return this.radius-this.thickness},enumerable:!0,configurable:!0}),i([a.observable],t.prototype,"color",void 0),i([a.observable],t.prototype,"depth",void 0),i([a.observable],t.prototype,"radius",void 0),i([a.observable],t.prototype,"thickness",void 0),i([a.observable],t.prototype,"center",void 0),t}(o.Instance);t.RingInstance=s},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(101)),r(n(100))},function(e,t,n){"use strict";var r,i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),s=n(6),c=n(8),u=((r={})[c.AnchorType.TopLeft]=function(e,t){e.x=-e.padding,e.y=-e.padding},r[c.AnchorType.TopMiddle]=function(e,t){e.x=t.width/2,e.y=-e.padding},r[c.AnchorType.TopRight]=function(e,t){e.x=t.width+e.padding,e.y=-e.padding},r[c.AnchorType.MiddleLeft]=function(e,t){e.x=-e.padding,e.y=t.height/2},r[c.AnchorType.Middle]=function(e,t){e.x=t.width/2,e.y=t.height/2},r[c.AnchorType.MiddleRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height/2},r[c.AnchorType.BottomLeft]=function(e,t){e.x=-e.padding,e.y=t.height+e.padding},r[c.AnchorType.BottomMiddle]=function(e,t){e.x=t.width/2,e.y=t.height+e.padding},r[c.AnchorType.BottomRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height+e.padding},r[c.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},r),l=function(e){function t(t){var n=e.call(this,t)||this;return n.color=[0,0,0,1],n.depth=0,n.height=1,n.maxScale=1,n.scale=1,n.scaling=c.ScaleType.BOUND_MAX,n.width=1,n.x=0,n.y=0,n._anchor={padding:0,type:c.AnchorType.TopLeft,x:0,y:0},n.depth=t.depth||n.depth,n.color=t.color||n.color,n.scaling=t.scaling||n.scaling,n.x=t.x||n.x,n.y=t.y||n.y,n.width=t.width||1,n.height=t.height||1,t.anchor&&n.setAnchor(t.anchor),n}return i(t,e),Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},enumerable:!0,configurable:!0}),t.prototype.setAnchor=function(e){var t={padding:e.padding||0,type:e.type,x:e.x||0,y:e.y||0};u[t.type](t,this),this._anchor=t},o([a.observable],t.prototype,"color",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"height",void 0),o([a.observable],t.prototype,"maxScale",void 0),o([a.observable],t.prototype,"scale",void 0),o([a.observable],t.prototype,"scaling",void 0),o([a.observable],t.prototype,"width",void 0),o([a.observable],t.prototype,"x",void 0),o([a.observable],t.prototype,"y",void 0),o([a.observable],t.prototype,"_anchor",void 0),t}(s.Instance);t.RectangleInstance=l},function(e,t){e.exports="${import: projection}\n\nprecision highp float;\n\nvarying vec4 vertexColor;\n${extendHeader}\n\nvoid main() {\n  ${attributes}\n\n  // Determine final screen size of label\n  vec3 screenSize = cameraSpaceSize(vec3(size * scale / maxScale, 1.0));\n\n  // Test whether the label is larger on the screen than the font size\n  bool largerOnScreen = screenSize.y > size.y || screenSize.x > size.x;\n\n  // Determines if a scale mode should be used or not for the vertex\n  float useScaleMode = float(\n    (\n      scaling == 3.0 ||                  // NEVER mode - keep the image the same size always\n      (largerOnScreen && scaling == 2.0) // BOUND_MAX mode - only if we're larger than the font size do we scale down\n    ) &&\n    scaling != 1.0                       // ALWAYS mode - the image stays completely in world space allowing it to scale freely\n  );\n\n  // Correct aspect ratio. Sufficient fix for most applications.\n  // Will need another solution in the case of:\n  // (cameraScale y != cameraScale.x) && (cameraScale.x != 1 && cameraScale.y != 1)\n\n  // If zooms are unequal, assume one is filtered to be 1.0\n  float unequalZooms = float(cameraScale.x != cameraScale.y);\n\n  vec2 adjustedSize = mix(\n    size,\n    (size * cameraScale.yx),\n    unequalZooms\n  );\n\n  // Destructure threejs's bug with the position requirement\n  float normal = position.x;\n  float side = position.y;\n\n  vec2 scaledAnchor = anchor * scale;\n\n  // Get the location of the anchor in world space\n  vec2 worldAnchor = location + scaledAnchor;\n\n  vec2 adjustedAnchor = mix(\n    scaledAnchor,\n    (scaledAnchor * cameraScale.yx),\n    unequalZooms\n  );\n\n  // Get the position of the current vertex\n  vec2 vertex = vec2(side, float(normal == 1.0)) * scale * adjustedSize + location - adjustedAnchor;\n\n  // See how scaled the size on screen will be from the actual height of the label\n  float labelScreenScale = mix(\n    screenSize.y / adjustedSize.y,\n    screenSize.x / adjustedSize.x,\n    float((cameraScale.x != 1.0))\n  );\n\n  float currentScale = labelScreenScale * scale;\n\n  // If our screen rendering is larger than the size the label is supposed to be, then we automagically\n  // scale down our label to stay the correct size, centered on the anchor point\n  vec2 anchorToVertex = vertex - location;\n\n  // We now choose between keeping the same image size or keeping it in world space\n  vertex = mix(\n    // This option keeps the image size in world space\n    vertex,\n    // This option counters the scaling of the image on the screen keeping it a static size\n    (anchorToVertex / labelScreenScale) + location,\n    // This is the flag determining if a scale mode should be applied to the vertex\n    useScaleMode\n  );\n\n  // --Texture and Color\n  // Apply the label's color as a tint to the label (all labels are rendered white to the base texture)\n  vertexColor = color;\n\n  gl_Position = clipSpace(vec3(vertex, depth));\n  ${extend}\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying vec4 vertexColor;\n${extendHeader}\n\nvoid main() {\n  setColor(vertexColor);\n  ${extend}\n}\n"},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(3),a=n(11),s=n(7),c=n(0),u=n(2),l=n(8),d=Math.min,h=Math.max,f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getInstancePickingMethods=function(){return{boundsAccessor:function(e){var t=[0,0];e.anchor&&(t[0]=e.anchor.x||0,t[1]=e.anchor.y||0);var n=[e.x-t[0],e.y-t[1]];return new a.Bounds({height:e.height,width:e.width,x:n[0],y:n[1]})},hitTest:function(e,t,n){var r=h.apply(void 0,n.camera.scale),i=d.apply(void 0,n.camera.scale);if(e.scaling===l.ScaleType.ALWAYS)return!0;if(e.scaling===l.ScaleType.BOUND_MAX){if(i<=1&&r<=1)return!0;var o=[0,0];e.anchor&&(o[0]=e.anchor.x||0,o[1]=e.anchor.y||0);var s=[e.x-o[0]/r,e.y-o[1]/r];return new a.Bounds({height:e.height/r,width:e.width/r,x:s[0],y:s[1]}).containsPoint(t)}if(e.scaling===l.ScaleType.NEVER){o=[0,0];e.anchor&&(o[0]=e.anchor.x||0,o[1]=e.anchor.y||0);s=u.subtract2([e.x,e.y],u.divide2(o,n.camera.scale));var c=n.worldToScreen(t);return new a.Bounds({height:e.height,width:e.width,x:s[0],y:s[1]}).containsPoint(c)}return!0}}},t.prototype.initShader=function(){var e={0:1,1:1,2:-1,3:1,4:-1,5:-1},r={0:0,1:0,2:0,3:1,4:1,5:1};return{fs:n(105),instanceAttributes:[{name:t.attributeNames.location,size:c.InstanceAttributeSize.TWO,update:function(e){return[e.x,e.y]}},{name:t.attributeNames.anchor,size:c.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x||0,e.anchor.y||0]}},{name:t.attributeNames.size,size:c.InstanceAttributeSize.TWO,update:function(e){return[e.width,e.height]}},{name:t.attributeNames.depth,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:t.attributeNames.scaling,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{name:t.attributeNames.color,size:c.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.scale,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.scale]}},{name:t.attributeNames.maxScale,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.maxScale]}}],uniforms:[{name:"scaleFactor",size:c.UniformSize.ONE,update:function(e){return[1]}}],vertexAttributes:[{name:"position",size:c.VertexAttributeSize.THREE,update:function(t){return[e[t],r[t],0]}}],vertexCount:6,vs:n(104)}},t.prototype.getModelType=function(){return{drawMode:i.TriangleStripDrawMode,modelType:i.Mesh}},t.prototype.getMaterialOptions=function(){return u.CommonMaterialOptions.transparentShape},t.defaultProps={key:"",data:new o.InstanceProvider,scene:"default"},t.attributeNames={anchor:"anchor",color:"color",depth:"depth",location:"location",maxScale:"maxScale",scale:"scale",scaling:"scaling",size:"size"},t}(s.Layer);t.RectangleLayer=f},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(106)),r(n(103))},function(e,t,n){"use strict";var r,i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),s=n(6),c=n(15),u=n(8),l=new Map,d=((r={})[u.AnchorType.TopLeft]=function(e,t){e.x=-e.padding,e.y=-e.padding},r[u.AnchorType.TopMiddle]=function(e,t){e.x=t.width/2,e.y=-e.padding},r[u.AnchorType.TopRight]=function(e,t){e.x=t.width+e.padding,e.y=-e.padding},r[u.AnchorType.MiddleLeft]=function(e,t){e.x=-e.padding,e.y=t.height/2},r[u.AnchorType.Middle]=function(e,t){e.x=t.width/2,e.y=t.height/2},r[u.AnchorType.MiddleRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height/2},r[u.AnchorType.BottomLeft]=function(e,t){e.x=-e.padding,e.y=t.height+e.padding},r[u.AnchorType.BottomMiddle]=function(e,t){e.x=t.width/2,e.y=t.height+e.padding},r[u.AnchorType.BottomRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height+e.padding},r[u.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},r),h=function(e){function t(t){var n=e.call(this,t)||this;n.color=[0,0,0,1],n.depth=0,n.maxScale=1,n.scaling=u.ScaleType.BOUND_MAX,n.scale=1,n.position=[0,0],n._cssFont="",n._fontFamily="Arial",n._fontSize=12,n._fontStyle="normal",n._fontWeight=400,n._maxWidth=0,n._text="",n._width=0,n._height=0,n._isDestroyed=!1,n._anchor={padding:0,type:u.AnchorType.TopLeft,x:0,y:0},n.depth=t.depth||n.depth,n.color=t.color||n.color,n.maxScale=t.maxScale||n.maxScale,n.scaling=t.scaling||n.scaling,n.scale=t.scale||n.scale,n.position=t.position,n._fontFamily=t.fontFamily||n._fontFamily,n._fontSize=t.fontSize||n._fontSize,n._fontStyle=t.fontStyle||n._fontStyle,n._fontWeight=t.fontWeight||n._fontWeight,n._maxWidth=t.maxWidth||0,n._text=t.text||n._text,n._cssFont=c.LabelRasterizer.makeCSSFont(n,1);var r,i=n._cssFont+"_"+n._maxWidth,o=l.get(n._text);return o?(r=o.get(i))&&r.references++:o=new Map,r||(r={references:1,resource:new c.LabelAtlasResource(n)},t.rasterization&&(r.resource.sampleScale=t.rasterization.scale||1),r.resource.sampleScale=r.resource.sampleScale||1,c.LabelRasterizer.renderSync(r.resource),l.set(n._text,o),o.set(i,r)),n._rasterization=r,n._width=r.resource.rasterization.world.width,n._height=r.resource.rasterization.world.height,t.anchor&&n.setAnchor(t.anchor),n}return i(t,e),t.destroy=function(){l.clear()},Object.defineProperty(t.prototype,"cssFont",{get:function(){return this._cssFont},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDestroyed",{get:function(){return this._isDestroyed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontFamily},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxWidth",{get:function(){return this._maxWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resource",{get:function(){return this._rasterization.resource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"truncatedText",{get:function(){return this._rasterization.resource.truncatedText||this.text},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,this._rasterization.references--,0===this._rasterization.references&&this._rasterization.resource)},t.prototype.resourceTrigger=function(){this._rasterization=this._rasterization,this._width=this._width,this.position=this.position,this.color=this.color,this.depth=this.depth,this.maxScale=this.maxScale,this.scaling=this.scaling,this.scale=this.scale},t.prototype.setAnchor=function(e){var t={padding:e.padding||0,type:e.type,x:e.x||0,y:e.y||0};d[t.type](t,this),this._anchor=t},o([a.observable],t.prototype,"color",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"maxScale",void 0),o([a.observable],t.prototype,"scaling",void 0),o([a.observable],t.prototype,"scale",void 0),o([a.observable],t.prototype,"position",void 0),o([a.observable],t.prototype,"_width",void 0),o([a.observable],t.prototype,"_height",void 0),o([a.observable],t.prototype,"_rasterization",void 0),o([a.observable],t.prototype,"_anchor",void 0),t}(s.Instance);t.LabelInstance=h},function(e,t){e.exports="precision highp float;\n\n${import: projection}\n\nvarying vec4 vertexColor;\nvarying vec2 texCoord;\n${extendHeader}\n\nvoid main() {\n  ${attributes}\n\n  // Determine final screen size of label\n  vec3 screenSize = cameraSpaceSize(vec3(size * scale / maxScale, 1.0));\n\n  // Test whether the label is larger on the screen than the font size\n  bool largerOnScreen = screenSize.y > size.y || screenSize.x > size.x;\n\n  // Determines if a scale mode should be used or not for the vertex\n  float useScaleMode = float(\n    (\n      scaling == 3.0 ||                  // NEVER mode - keep the image the same size always\n      (largerOnScreen && scaling == 2.0) // BOUND_MAX mode - only if we're larger than the font size do we scale down\n    ) &&\n    scaling != 1.0                       // ALWAYS mode - the image stays completely in world space allowing it to scale freely\n  );\n\n  // Correct aspect ratio.  Sufficient fix for most applications.\n  // Will need another solution in the case of:\n  //  (cameraScale y != cameraScale.x) && (cameraScale.x != 1 && cameraScale.y != 1)\n\n  // If zooms are unequal, assume one is filtered to be 1.0\n  float unequalZooms = float(cameraScale.x != cameraScale.y);\n\n  vec2 adjustedSize = mix(\n    size,\n    (size * cameraScale.yx),\n    unequalZooms\n  );\n\n  // Destructure threejs's bug with the position requirement\n  float normal = position.x;\n  float side = position.y;\n\n  vec2 scaledAnchor = anchor * scale;\n\n  // Get the location of the anchor in world space\n  vec2 worldAnchor = location + scaledAnchor;\n\n  vec2 adjustedAnchor = mix(\n    scaledAnchor,\n    (scaledAnchor * cameraScale.yx),\n    unequalZooms\n  );\n\n  // Get the position of the current vertex\n  vec2 vertex = vec2(side, float(normal == 1.0)) * scale * adjustedSize + location - adjustedAnchor;\n\n  // See how scaled the size on screen will be from the actual height of the label\n  float labelScreenScale = mix(\n    screenSize.y / adjustedSize.y,\n    screenSize.x / adjustedSize.x,\n    float((cameraScale.x != 1.0))\n  );\n\n  float currentScale = labelScreenScale * scale;\n\n  // If our screen rendering is larger than the size the label is supposed to be, then we automagically\n  // scale down our label to stay the correct size, centered on the anchor point\n  vec2 anchorToVertex = vertex - location;\n\n  // We now choose between keeping the same image size or keeping it in world space\n  vertex = mix(\n    // This option keeps the image size in world space\n    vertex,\n    // This option counters the scaling of the image on the screen keeping it a static size\n    (anchorToVertex / labelScreenScale) + location,\n    // This is the flag determining if a scale mode should be applied to the vertex\n    useScaleMode\n  );\n\n  // --Texture and Color\n  // Get the tex coord from our inject texture info\n  texCoord = texture.xy + ((texture.zw - texture.xy) * vec2(side, float(normal == -1.0)));\n  // Apply the label's color as a tint to the label (all labels are rendered white to the base texture)\n  vertexColor = color * color.a;\n\n  gl_Position = clipSpace(vec3(vertex, depth));\n  ${extend}\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying vec4 vertexColor;\nvarying vec2 texCoord;\n${extendHeader}\n\nvoid main() {\n  gl_FragColor = texture2D(labelAtlas, texCoord) * vertexColor;\n  setColor(gl_FragColor);\n  ${extend}\n}\n"},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(3),a=n(11),s=n(7),c=n(0),u=n(2),l=n(8),d=Math.max,h=Math.min,f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getInstancePickingMethods=function(){return{boundsAccessor:function(e){var t=[e.anchor.x||0,e.anchor.y||0],n=u.subtract2(e.position,t);return new a.Bounds({height:e.height,width:e.width,x:n[0],y:n[1]})},hitTest:function(e,t,n){var r=d.apply(void 0,n.camera.scale),i=h.apply(void 0,n.camera.scale);if(e.scaling===l.ScaleType.ALWAYS)return!0;if(e.scaling===l.ScaleType.BOUND_MAX){if(i<=1&&r<=1)return!0;var o=[e.anchor.x||0,e.anchor.y||0],s=u.subtract2(e.position,u.divide2(o,n.camera.scale)),c=n.worldToScreen(t);return new a.Bounds({height:e.height,width:e.width,x:s[0],y:s[1]}).containsPoint(c)}if(e.scaling===l.ScaleType.NEVER){o=[e.anchor.x||0,e.anchor.y||0],s=u.subtract2(e.position,u.divide2(o,n.camera.scale)),c=n.worldToScreen(t);return new a.Bounds({height:e.height,width:e.width,x:s[0],y:s[1]}).containsPoint(c)}return!0}}},t.prototype.initShader=function(){var e=this,r=this.props.animate||{},i=r.color,o=r.location,a=r.size,s={0:1,1:1,2:-1,3:1,4:-1,5:-1},u={0:0,1:0,2:0,3:1,4:1,5:1};return{fs:n(110),instanceAttributes:[{easing:o,name:t.attributeNames.location,size:c.InstanceAttributeSize.TWO,update:function(e){return e.position}},{name:t.attributeNames.anchor,size:c.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x||0,e.anchor.y||0]}},{easing:a,name:t.attributeNames.size,size:c.InstanceAttributeSize.TWO,update:function(e){return[e.width,e.height]}},{name:t.attributeNames.depth,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:t.attributeNames.scaling,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{atlas:{key:this.props.atlas||"",name:"labelAtlas"},name:t.attributeNames.texture,update:function(t){return e.resource.request(e,t,t.resource)}},{easing:i,name:t.attributeNames.color,size:c.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.scale,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.scale]}},{name:t.attributeNames.maxScale,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.maxScale]}}],uniforms:[{name:"scaleFactor",size:c.UniformSize.ONE,update:function(e){return[1]}}],vertexAttributes:[{name:"position",size:c.VertexAttributeSize.THREE,update:function(e){return[s[e],u[e],0]}}],vertexCount:6,vs:n(109)}},t.prototype.getModelType=function(){return{drawMode:i.TriangleStripDrawMode,modelType:i.Mesh}},t.prototype.getMaterialOptions=function(){return u.CommonMaterialOptions.transparentImage},t.defaultProps={key:"",data:new o.InstanceProvider,scene:"default"},t.attributeNames={location:"location",anchor:"anchor",size:"size",depth:"depth",scaling:"scaling",texture:"texture",color:"color",scale:"scale",maxScale:"maxScale"},t}(s.Layer);t.LabelLayer=f},function(e,t,n){"use strict";var r,i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.awaitContext=function(){return i(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return r?[3,2]:(this.getContext(),[4,new Promise(function(e){return setTimeout(e,10)})]);case 1:return e.sent(),[3,0];case 2:return[2]}})})},e.getContext=function(){return r||(r=document.createElement("canvas").getContext("2d")),r},e.calculateImageSize=function(e,t){var n=e.image.element;n?r?0!==n.width&&0!==n.height?(r.canvas.width=100,r.canvas.height=100,r.drawImage(n,0,0),e.rasterization=e.rasterization||{texture:{height:0,width:0},world:{height:0,width:0}},e.rasterization.texture={height:n.height*e.sampleScale,width:n.width*e.sampleScale},e.rasterization.world={height:n.height,width:n.width},e.rasterization.image=n):console.warn("Images provided shoud have valid dimensions! Please ensure the image is loaded first."):console.warn("The Image rasterizer was unable to establish a valid canvas context. Please ensure the system supports contexts and ensure the document is ready first."):console.warn("Image does not exist! Please ensure the resource contains a valid image.")},e.render=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this.awaitContext()];case 1:return t.sent(),this.calculateImageSize(e,e.sampleScale),[2,e]}})})},e.renderSync=function(e){return this.getContext(),r?(this.calculateImageSize(e,e.sampleScale),e):(console.warn("Can not render a image synchronously without the canvas context being ready."),e)},e}();t.ImageRasterizer=a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(45),s=n(43),c=n(42),u=n(41),l=n(22),d=n(40),h=n(44),f=n(12)("webgl-surface:Atlas"),p={aspectRatio:0,atlasBL:[0,0],atlasBR:[0,0],atlasReferenceID:"",atlasTexture:null,atlasTL:[0,0],atlasTR:[0,0],heightOnAtlas:0,isValid:!1,pixelHeight:0,pixelWidth:0,widthOnAtlas:0};var v=function(){function e(){this.allAtlas=new Map}return e.prototype.createAtlas=function(e,t){return r(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return(n=new a.Atlas(e)).setManager(this),this.allAtlas.set(n.id,n),t?[4,this.updateAtlas(n.id,t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return f("Atlas Created-> %o",n),[2,n]}})})},e.prototype.destroy=function(){this.allAtlas.forEach(function(e){return e.destroy()})},e.prototype.destroyAtlas=function(e){var t=this.allAtlas.get(e);t&&t.destroy()},e.prototype.setDefaultImage=function(e,t){return e=Object.assign(e,p,{atlasReferenceID:t})},e.prototype.draw=function(e,t){return r(this,void 0,void 0,function(){var n,r,a,s,c,u,l,d,h,p,v,g,y,m,b,w,_,T,x;return i(this,function(i){switch(i.label){case 0:return n=e.texture.image,r=e.id,e.registerResource(t)?[4,this.loadImage(t)]:(console.warn("Could not draw resource to the atlas as the resource was not properly registered to the atlas first",e,t),[2,Promise.resolve(!1)]);case 1:return(a=i.sent())&&function(e){var t=!1;return e&&e.isValid&&e.pixelWidth&&e.pixelHeight&&(t=!0),t}(t.texture)?(s=t.rasterization,c=t.texture,u=new o.Bounds({bottom:s.texture.height,left:0,right:s.texture.width,top:0}),(l={first:c,second:u}).second.width+=1,l.second.height+=1,d=e.packing,(h=d.insert(l))?(f("Atlas location determined: %o",h),h.nodeImage=c,p=h.nodeDimensions.x/e.width,v=h.nodeDimensions.y/e.height,g=h.nodeDimensions.width/e.width,y=h.nodeDimensions.height/e.height,m=1/e.width,b=new o.Bounds({bottom:1-v,left:p,right:p+g,top:1-(v+y)}),w=b.bottom,_=b.y,T=b.x,x=b.x+b.width-m,c.atlasReferenceID=r,c.atlasTL=[T,_],c.atlasBR=[x,w],c.atlasBL=[T,w],c.atlasTR=[x,_],c.widthOnAtlas=Math.abs(c.atlasTR[0]-c.atlasTL[0]),c.heightOnAtlas=Math.abs(c.atlasTR[1]-c.atlasBR[1]),c.pixelWidth=s.texture.width,c.pixelHeight=s.texture.height,n.getContext("2d").drawImage(a,h.nodeDimensions.x,h.nodeDimensions.y),[2,!0]):(console.error("Could not fit resource into atlas",t),t.texture=this.setDefaultImage(t.texture,r),[2,!1])):(t.texture.isValid?console.error("Could not load resource:",t):f("Resource was invalidated during load:",t),t.texture=this.setDefaultImage(t.texture,r),[2,!1])}})})},e.prototype.getAtlasTexture=function(e){return this.allAtlas.get(e)},e.prototype.loadImage=function(e){return r(this,void 0,void 0,function(){var t,n,r;return i(this,function(i){switch(i.label){case 0:return t="",n=e.texture||new h.SubTexture,e.texture=n,!1===e.texture.isValid?[2,null]:e instanceof u.ImageAtlasResource?e.image.element?0!==e.image.element.width&&0!==e.image.element.height?(r=e.image.element,n.pixelWidth=r.width,n.pixelHeight=r.height,n.aspectRatio=r.width/r.height,[2,r]):[4,new Promise(function(t){var r=e.image.element;r?(r.onload=function(){n.pixelWidth=r.width,n.pixelHeight=r.height,n.aspectRatio=r.width/r.height,t(r)},r.onerror=function(){t(null)}):t(null)})]:[3,2]:[3,4];case 1:return[2,i.sent()];case 2:e.image.path&&(t=e.image.path),i.label=3;case 3:return[3,10];case 4:return e instanceof l.LabelAtlasResource?e.rasterization.canvas?[3,6]:[4,d.LabelRasterizer.render(e)]:[3,7];case 5:i.sent(),i.label=6;case 6:return e.rasterization.canvas?(f("Rasterized label %o",e.rasterization),t=e.rasterization.canvas.toDataURL("image/png")):console.warn("The label was not able to be rasterized"),[3,10];case 7:return e instanceof s.ColorAtlasResource?e.rasterization.canvas?[3,9]:[4,c.ColorRasterizer.render(e)]:[3,10];case 8:i.sent(),i.label=9;case 9:e.rasterization.canvas?(f("Rasterized color %o",e.rasterization),t=e.rasterization.canvas.toDataURL("image/png")):console.warn("The color was not able to be rasterized"),i.label=10;case 10:return t?[4,new Promise(function(e){var r=new Image;r.onload=function(){n.pixelWidth=r.width,n.pixelHeight=r.height,n.aspectRatio=r.width/r.height,e(r)},r.onerror=function(){e(null)},r.src=t})]:[3,12];case 11:return[2,i.sent()];case 12:return[2,null]}})})},e.prototype.updateAtlas=function(e,t){return r(this,void 0,void 0,function(){var n,r,o,a;return i(this,function(i){switch(i.label){case 0:if(!(n=this.allAtlas.get(e)))return[3,5];r=0,o=t,i.label=1;case 1:return r<o.length?(a=o[r],[4,this.draw(n,a)]):[3,4];case 2:i.sent(),i.label=3;case 3:return r++,[3,1];case 4:return n.updateTexture(),[3,6];case 5:console.warn("Can not update non-existing atlas:",e,"These resources will not be loaded:",t),i.label=6;case 6:return[2]}})})},e}();t.AtlasManager=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=function(){function e(e,t,n,i){this.child=[null,null],this.isLeaf=!0,this.nodeImage=null,this.nodeDimensions=new r.Bounds({height:i,width:n,x:e,y:t})}return e.prototype.destroy=function(){var e=this.child[0],t=this.child[1];this.nodeImage=null,e&&e.destroy(),t&&t.destroy(),this.child[0]=null,this.child[1]=null},e.prototype.hasChild=function(){var e=this.child[0],t=this.child[1];return e&&!e.nodeImage?!e.isLeaf:!(!t||t.nodeImage)&&!t.isLeaf},e.prototype.insert=function(t){var n=this.child[0],r=this.child[1];if(!this.isLeaf&&n&&r){var i=n.insert(t);return null!==i?i:r.insert(t)}if(this.nodeImage)return null;var o=this.nodeDimensions.fits(t.second);if(0===o)return null;if(1===o)return this;this.isLeaf=!1;var a=t.second.width,s=t.second.height,c=this.nodeDimensions.width-a,u=this.nodeDimensions.height-t.second.height;return c>u?(n=this.child[0]=new e(this.nodeDimensions.x,this.nodeDimensions.y,a,this.nodeDimensions.height),r=this.child[1]=new e(this.nodeDimensions.x+a,this.nodeDimensions.y,c,this.nodeDimensions.height)):(n=this.child[0]=new e(this.nodeDimensions.x,this.nodeDimensions.y,this.nodeDimensions.width,s),r=this.child[1]=new e(this.nodeDimensions.x,this.nodeDimensions.y+s,this.nodeDimensions.width,u)),n.insert(t)},e.prototype.remove=function(e){var t=this.child[0],n=this.child[1];if(n&&t&&!this.isLeaf){var r=t.remove(e);return!!r||(r=n.remove(e),t.hasChild()||n.hasChild()||(this.child[0]=null,this.child[1]=null),r)}return this.nodeImage===e&&(this.nodeImage=null,delete e.atlasReferenceID,e.pixelWidth=0,!0)},e}();t.PackNode=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),s=n(6),c=n(15),u=n(8),l=Math.max,d=new Map,h=((r={})[u.AnchorType.TopLeft]=function(e,t){e.x=-e.padding,e.y=-e.padding},r[u.AnchorType.TopMiddle]=function(e,t){e.x=t.width/2,e.y=-e.padding},r[u.AnchorType.TopRight]=function(e,t){e.x=t.width+e.padding,e.y=-e.padding},r[u.AnchorType.MiddleLeft]=function(e,t){e.x=-e.padding,e.y=t.height/2},r[u.AnchorType.Middle]=function(e,t){e.x=t.width/2,e.y=t.height/2},r[u.AnchorType.MiddleRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height/2},r[u.AnchorType.BottomLeft]=function(e,t){e.x=-e.padding,e.y=t.height+e.padding},r[u.AnchorType.BottomMiddle]=function(e,t){e.x=t.width/2,e.y=t.height+e.padding},r[u.AnchorType.BottomRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height+e.padding},r[u.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},r),f=function(e){function t(t){var n=e.call(this,t)||this;n.tint=[0,0,0,1],n.depth=0,n.height=1,n.position=[0,0],n.scaling=u.ScaleType.BOUND_MAX,n.width=1,n._sourceWidth=0,n._sourceHeight=0,n._isDestroyed=!1,n._anchor={padding:0,type:u.AnchorType.TopLeft,x:0,y:0},n.depth=t.depth||n.depth,n.tint=t.tint||n.tint,n.scaling=t.scaling||n.scaling,n.position=t.position||n.position,n._element=t.element;var r=d.get(n._path||n._element);return r&&r.references++,r||((r={references:1,resource:new c.ImageAtlasResource(n)}).resource.sampleScale=r.resource.sampleScale||1,c.ImageRasterizer.renderSync(r.resource),d.set(n._path||n._element,r)),n._rasterization=r,n._sourceWidth=r.resource.rasterization.world.width,n._sourceHeight=r.resource.rasterization.world.height,n.width=t.width||n._sourceWidth||1,n.height=t.height||n._sourceHeight||1,t.anchor&&n.setAnchor(t.anchor),n}return i(t,e),t.destroy=function(){d.clear()},Object.defineProperty(t.prototype,"size",{get:function(){return l(this.width,this.height)},set:function(e){var t=this.width/this.height;this.width=e*t,this.height=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDestroyed",{get:function(){return this._isDestroyed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resource",{get:function(){return this._rasterization.resource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sourceWidth",{get:function(){return this._sourceWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sourceHeight",{get:function(){return this._sourceHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,this._rasterization.references--,0===this._rasterization.references&&(this._rasterization.resource,console.warn("The destroy method still needs completion")))},t.prototype.resourceTrigger=function(){this._rasterization=this._rasterization,this.tint=this.tint,this.depth=this.depth,this.height=this.height,this.scaling=this.scaling,this.width=this.width,this.position=this.position},t.prototype.setAnchor=function(e){var t={padding:e.padding||0,type:e.type,x:e.x||0,y:e.y||0};h[t.type](t,this),this._anchor=t},o([a.observable],t.prototype,"tint",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"height",void 0),o([a.observable],t.prototype,"position",void 0),o([a.observable],t.prototype,"scaling",void 0),o([a.observable],t.prototype,"width",void 0),o([a.observable],t.prototype,"_rasterization",void 0),o([a.observable],t.prototype,"_anchor",void 0),t}(s.Instance);t.ImageInstance=f},function(e,t){e.exports="precision highp float;\n\n${import: projection}\n\nvarying vec4 vertexColor;\nvarying vec2 texCoord;\n\n${extendHeader}\n\nvoid main() {\n  ${attributes}\n\n  // Figure out the size of the image as it'd show on the screen\n  vec3 screenSize = cameraSpaceSize(vec3(size, 1.0));\n  // Do the test for when the image is larger on the screen than the font size\n  bool largerOnScreen = screenSize.y > size.y;\n\n  // Determines if a scale mode should be used or not for the vertex\n  float useScaleMode = float(\n    (\n      scaling == 3.0 ||                  // NEVER mode - keep the image the same size always\n      (largerOnScreen && scaling == 2.0) // BOUND_MAX mode - only if we're larger than the font size do we scale down\n    ) &&\n    scaling != 1.0                       // ALWAYS mode - the image stays completely in world space allowing it to scale freely\n  );\n  // If zooms are unequal, assume one is filtered to be 1.0\n  float unequalZooms = float(cameraScale.x != cameraScale.y);\n\n  // Destructure threejs's bug with the position requirement\n  float normal = position.x;\n  float side = position.y;\n\n  // Get the location of the anchor in world space\n  vec2 worldAnchor = location + anchor;\n\n  // Get the tex coord from our inject texture info\n  texCoord = texture.xy + ((texture.zw - texture.xy) * vec2(side, float(normal == -1.0)));\n  // Apply the image's tint as a tint to the image\n  vertexColor = tint;\n\n  // Correct aspect ratio.\n  vec2 adjustedSize = mix(\n    size,\n    (size * cameraScale.yx),\n    unequalZooms\n  );\n\n  vec2 adjustedAnchor = mix(\n    anchor,\n    (anchor * cameraScale.yx),\n    unequalZooms\n  );\n\n  vec2 vertex = vec2(side, float(normal == 1.0)) * adjustedSize + location - adjustedAnchor;\n\n  // See how scaled the size on screen will be from the actual height of the image\n  float imageScreenScale = mix(\n    screenSize.y / adjustedSize.y,\n    screenSize.x / adjustedSize.x,\n    float((cameraScale.x < 1.0) || (cameraScale.x > 1.0))\n  );\n\n  // If our screen rendering is larger than the size the image is supposed to be, then we automagically\n  // scale down our image to stay the correct size, centered on the anchor point\n  vec2 anchorToVertex = vertex - location;\n\n  // We now choose between keeping the same image size or keeping it in world space\n  vertex = mix(\n    // This option keeps the image size in world space\n    vertex,\n    // This option counters the scaling of the image on the screen keeping it a static size\n    (anchorToVertex / imageScreenScale) + location,\n    // This is the flag determining if a scale mode should be applied to the vertex\n    useScaleMode\n  );\n\n  gl_Position = clipSpace(vec3(vertex, depth));\n\n  ${extend}\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying vec4 vertexColor;\nvarying vec2 texCoord;\n${extendHeader}\n\nvoid main() {\n  gl_FragColor = texture2D(imageAtlas, texCoord) * vertexColor;\n  setColor(gl_FragColor * gl_FragColor.a);\n  ${extend}\n}\n"},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(3),a=n(11),s=n(7),c=n(0),u=n(2),l=n(56),d=n(8),h=Math.min,f=Math.max,p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getInstancePickingMethods=function(){return{boundsAccessor:function(e){var t=[0,0];e.anchor&&(t[0]=e.anchor.x||0,t[1]=e.anchor.y||0);var n=u.subtract2(e.position,t);return new a.Bounds({height:e.height,width:e.width,x:n[0],y:n[1]})},hitTest:function(e,t,n){var r=f.apply(void 0,n.camera.scale),i=h.apply(void 0,n.camera.scale);if(e.scaling===d.ScaleType.ALWAYS)return!0;if(e.scaling===d.ScaleType.BOUND_MAX){if(i<=1&&r<=1)return!0;var o=[0,0];e.anchor&&(o[0]=e.anchor.x||0,o[1]=e.anchor.y||0);var s=u.subtract2(e.position,u.divide2(o,n.camera.scale)),c=n.worldToScreen(t);return new a.Bounds({height:e.height,width:e.width,x:s[0],y:s[1]}).containsPoint(c)}if(e.scaling===d.ScaleType.NEVER){o=[0,0];e.anchor&&(o[0]=e.anchor.x||0,o[1]=e.anchor.y||0);s=n.worldToScreen(u.subtract2(e.position,u.divide2(o,n.camera.scale))),c=n.worldToScreen(t);return new a.Bounds({height:e.height,width:e.width,x:s[0],y:s[1]}).containsPoint(c)}return!0}}},t.prototype.initShader=function(){var e=this,r=this.props.animate||{},i=r.tint,o=r.location,a=r.size,s={0:1,1:1,2:-1,3:1,4:-1,5:-1},u={0:0,1:0,2:0,3:1,4:1,5:1};return{fs:n(117),instanceAttributes:[{easing:o,name:t.attributeNames.location,size:c.InstanceAttributeSize.TWO,update:function(e){return e.position}},{name:t.attributeNames.anchor,size:c.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x||0,e.anchor.y||0]}},{easing:a,name:t.attributeNames.size,size:c.InstanceAttributeSize.TWO,update:function(e){return[e.width,e.height]}},{name:t.attributeNames.depth,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:t.attributeNames.scaling,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{atlas:{key:this.props.atlas||"",name:"imageAtlas"},name:t.attributeNames.texture,update:function(t){return e.resource.request(e,t,t.resource)}},{easing:i,name:t.attributeNames.tint,size:c.InstanceAttributeSize.FOUR,update:function(e){return e.tint}}],uniforms:[{name:"scaleFactor",size:c.UniformSize.ONE,update:function(e){return[1]}}],vertexAttributes:[{name:"position",size:c.VertexAttributeSize.THREE,update:function(e){return[s[e],u[e],0]}}],vertexCount:6,vs:n(116)}},t.prototype.getModelType=function(){return{drawMode:i.TriangleStripDrawMode,modelType:i.Mesh}},t.prototype.getMaterialOptions=function(){return l.CommonMaterialOptions.transparentImage},t.defaultProps={key:"",data:new o.InstanceProvider,scene:"default"},t.attributeNames={location:"location",anchor:"anchor",size:"size",depth:"depth",scaling:"scaling",texture:"texture",tint:"tint"},t}(s.Layer);t.ImageLayer=p},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),a=n(19),s=function(e){function t(t){var n=e.call(this,t)||this;return n.colorStart=[1,1,1,1],n.colorEnd=[1,1,1,1],n.control=[[0,0],[0,0]],n.depth=0,n.end=[0,0],n.start=[0,0],n.widthStart=1,n.widthEnd=1,n.colorStart=t.colorStart||n.colorStart,n.colorEnd=t.colorEnd||n.colorEnd,n.control=t.control||n.control,n.depth=t.depth||n.depth,n.end=t.end||n.end,n.widthStart=t.widthStart||n.widthStart,n.widthEnd=t.widthEnd||n.widthEnd,n.start=t.start||n.start,n}return r(t,e),Object.defineProperty(t.prototype,"length",{get:function(){var e=[this.end[0]-this.start[0],this.end[1]-this.start[1]];return Math.sqrt(e[0]*e[0]+e[1]*e[1])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"midpoint",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"perpendicular",{get:function(){var e=this.length;return[(this.end[1]-this.start[1])/e,-(this.end[0]-this.start[0])/e]},enumerable:!0,configurable:!0}),t.prototype.setEdgeWidth=function(e){e&&(this.widthEnd=e,this.widthStart=e)},t.prototype.setColor=function(e){this.colorStart=e,this.colorEnd=e},i([a.observable],t.prototype,"colorStart",void 0),i([a.observable],t.prototype,"colorEnd",void 0),i([a.observable],t.prototype,"control",void 0),i([a.observable],t.prototype,"depth",void 0),i([a.observable],t.prototype,"end",void 0),i([a.observable],t.prototype,"start",void 0),i([a.observable],t.prototype,"widthStart",void 0),i([a.observable],t.prototype,"widthEnd",void 0),t}(o.Instance);t.EdgeInstance=s},function(e,t){e.exports="precision highp float;\n\nvarying vec4 vertexColor;\n${extendHeader}\n\nvoid main() {\n  setColor(vertexColor);\n  ${extend}\n}\n"},function(e,t){e.exports="/**\n  This vertex shader calculates edges based in world space to make an edge based on\n  bezier curves with 0, 1, and 2 control points.\n**/\nprecision highp float;\n\n${import: projection}\n\nvarying vec4 vertexColor;\n\n// Interpolation type injection\n${interpolation}\n\n${extendHeader}\n\nvoid main() {\n  ${attributes}\n\n  // Destructure threejs's bug with the position requirement\n  float normal = position.x;\n  float interpolationTime = position.y;\n  float interpolationIncrement = 1.0 / position.z;\n\n  // Convert our world points to screen space\n  vec4 startClip = clipSpace(vec3(start, depth));\n  vec4 endClip = clipSpace(vec3(end, depth));\n  vec2 startScreen = (startClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\n  vec2 endScreen = (endClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\n  // Controls for this mode are screen space deltas from the end points\n  vec2 control1 = startScreen + vec2(control.x, -control.y) * scaleFactor;\n  vec2 control2 = endScreen + vec2(control.z, -control.w) * scaleFactor;\n\n  // Get the position of the current vertex\n  vec2 currentPosition = interpolation(interpolationTime, startScreen, endScreen, control1, control2);\n  // Calculate the next and previous segment's location on the line\n  vec2 prePosition = interpolation(interpolationTime - interpolationIncrement, startScreen, endScreen, control1, control2);\n  vec2 nextPosition = interpolation(interpolationTime + interpolationIncrement, startScreen, endScreen, control1, control2);\n\n  vec2 preLine = prePosition - currentPosition;\n  vec2 nextLine = nextPosition - currentPosition;\n\n  // Get a spliced nromal at the joining of two segments to make a crisper curve\n  vec2 currentNormal = mix(\n    // Pick this value if we're at the beginning of the line\n    normalize(vec2(preLine.y, -preLine.x)),\n    mix(\n      // Pick this value when we're between the ends\n      normalize(vec2(preLine.y, -preLine.x) + vec2(-nextLine.y, nextLine.x)),\n      // Pick this value if we're at the end of the line\n      normalize(vec2(-nextLine.y, nextLine.x)),\n      float(position.x >= 1.0)\n    ),\n    float(position.x > 0.0)\n  );\n\n  // Get the thickness based on the side we're on\n  float lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;\n  // Start on the calculated line and push out by the normal's value\n  vec2 vertex = currentPosition + currentNormal * (-normal * lineThickness * scaleFactor);\n  // Get the color based on where we are on the line\n  vertexColor = mix(colorStart, colorEnd, interpolationTime);\n  vertexColor.a *= vertexColor.a * layerOpacity;\n\n  gl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), startClip.zw);\n  gl_PointSize = 5.0;\n\n  ${extend}\n}\n"},function(e,t){e.exports="${import: projection}\n\nprecision highp float;\n\n/**\n  This vertex shader calculates edges whose curve and width is in screen space where the curve is\n  bezier curves with 0, 1, and 2 control points.\n**/\nvarying vec4 vertexColor;\n\n// Interpolation type injection\n${interpolation}\n\n${extendHeader}\n\nvoid main() {\n  ${attributes}\n\n  // Destructure threejs's bug with the position requirement\n  float normal = position.x;\n  float interpolationTime = position.y;\n  float interpolationIncrement = 1.0 / position.z;\n  // Get the position of the current vertex\n  vec2 currentPosition = interpolation(interpolationTime, start, end, control.xy, control.zw);\n  // Calculate the next and previous segment's location on the line\n  vec2 prePosition = interpolation(interpolationTime - interpolationIncrement, start, end, control.xy, control.zw);\n  vec2 nextPosition = interpolation(interpolationTime + interpolationIncrement, start, end, control.xy, control.zw);\n\n  vec2 preLine = prePosition - currentPosition;\n  vec2 nextLine = nextPosition - currentPosition;\n\n  // Get a spliced nromal at the joining of two segments to make a crisper curve\n  vec2 currentNormal = mix(\n    // Pick this value if we're at the beginning of the line\n    normalize(vec2(preLine.y, -preLine.x)),\n    mix(\n      // Pick this value when we're between the ends\n      normalize(vec2(preLine.y, -preLine.x) + vec2(-nextLine.y, nextLine.x)),\n      // Pick this value if we're at the end of the line\n      normalize(vec2(-nextLine.y, nextLine.x)),\n      float(position.x >= 1.0)\n    ),\n    float(position.x > 0.0)\n  );\n\n  // Get the thickness based on the side we're on\n  float lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;\n  // Start on the calculated line and push out by the normal's value\n  vec2 vertex = currentPosition + currentNormal * (normal * lineThickness);\n  // Get the color based on where we are on the line\n  vertexColor = mix(colorStart, colorEnd, interpolationTime);\n  vertexColor.a *= layerOpacity;\n\n  gl_Position = clipSpace(vec3(vertex, depth));\n  gl_PointSize = 5.0;\n\n  ${extend}\n}\n"},function(e,t){e.exports="/**\n * Makes a linear interpolation between two points\n *\n * @param {vec2} s The start point\n * @param {vec2} e The end point\n * @param {vec2} c The bezier control point\n * @param {float} t The interpolation value [0, 1]\n *\n * @returns {vec2} A point interpolated between the two provided points\n */\nvec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\n  float t1 = 1.0 - t;\n  return pow(t1, 3.0) * p1 + 3.0 * t * pow(t1, 2.0) * c1 + 3.0 * pow(t, 2.0) * t1 * c2 + pow(t, 3.0) * p2;\n}\n"},function(e,t){e.exports="/**\n * Makes a linear interpolation between two points\n *\n * @param {vec2} s The start point\n * @param {vec2} e The end point\n * @param {vec2} c The bezier control point\n * @param {float} t The interpolation value [0, 1]\n *\n * @returns {vec2} A point interpolated between the two provided points\n */\nvec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\n  return (1.0 - t) * (1.0 - t) * p1 + 2.0 * t * (1.0 - t) * c1 + t * t * p2;\n}\n"},function(e,t){e.exports="/**\n * Makes a linear interpolation between two points\n *\n * @param {vec2} s The start point\n * @param {vec2} e The end point\n * @param {vec2} c The bezier control point\n * @param {float} t The interpolation value [0, 1]\n *\n * @returns {vec2} A point interpolated between the two provided points\n */\nvec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\n  return p1 + (p2 - p1) * t;\n}\n"},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),o=n(13),a=n(24),s=Math.pow;var c=((r={})[a.EdgeType.LINE]=function(e,t,n,r,i){return o.add2(o.scale2(o.subtract2(n,t),e),t)},r[a.EdgeType.BEZIER]=function(e,t,n,r,i){return[(1-e)*(1-e)*t[0]+2*e*(1-e)*r[0]+e*e*n[0],(1-e)*(1-e)*t[1]+2*e*(1-e)*r[1]+e*e*n[1]]},r[a.EdgeType.BEZIER2]=function(e,t,n,r,i){var o=1-e;return[s(o,3)*t[0]+3*e*s(o,2)*r[0]+3*s(e,2)*o*i[0]+s(e,3)*n[0],s(o,3)*t[1]+3*e*s(o,2)*r[1]+3*s(e,2)*o*i[1]+s(e,3)*n[1]]},r);var u=50;t.edgePicking=function(e){var t=e.broadphase,n=e.minPickDistance,r=void 0===n?0:n,s=e.scaleType,l=e.type,d=c[e.type],h=function(n){var o=n.widthStart/2+r,s=n.widthEnd/2+r,c=new i.Bounds({height:n.widthStart,width:n.widthStart,x:n.start[0]-o,y:n.start[1]-o});return c.encapsulate(new i.Bounds({height:n.widthEnd,width:n.widthEnd,x:n.end[0]-s,y:n.end[1]-s})),e.type===a.EdgeType.BEZIER?c.encapsulate(n.control[0]):e.type===a.EdgeType.BEZIER2&&(c.encapsulate(n.control[0]),c.encapsulate(n.control[1])),t===a.EdgeBroadphase.PASS_X&&(c.x=Number.MIN_SAFE_INTEGER/2,c.width=Number.MAX_SAFE_INTEGER),t===a.EdgeBroadphase.PASS_Y&&(c.y=Number.MIN_SAFE_INTEGER/2,c.height=Number.MAX_SAFE_INTEGER),c};return s===a.EdgeScaleType.SCREEN_CURVE?{boundsAccessor:h,hitTest:function(e,t,n){var i=t=n.worldToScreen(t),s=0,c=Number.MAX_VALUE,h=0,f=Number.MAX_VALUE,p=n.worldToScreen(e.start),v=n.worldToScreen(e.end),g=[0,0],y=[0,0];l===a.EdgeType.BEZIER?g=o.add2(p,e.control[0]):l===a.EdgeType.BEZIER2&&(g=o.add2(p,e.control[0]),y=o.add2(v,e.control[1]));var m=o.copy2(p),b=o.copy2(v);g=e.control.length>0?g:[0,0],y=e.control.length>1?y:[0,0];for(var w=0;w<u;++w){var _=d(w/u,m,b,g,y),T=o.length2(o.subtract2(i,_));T<c?(h=s,f=c,s=w,c=T):T<f&&(h=w,c=T)}var x=s/u,A=(e.widthEnd-e.widthStart)*x+e.widthStart;if(s===h)return!1;var I=d(s/u,m,b,g,y),S=d(h/u,m,b,g,y);return c=function(e,t,n){var r=o.subtract2(e,n),i=o.subtract2(t,e),a=[i[1],-i[0]];return Math.abs(o.dot2(r,a))/o.length2(i)}(I,S,i),!(o.dot2(o.subtract2(S,I),o.subtract2(i,I))<0)&&c<A/2+r}}:{boundsAccessor:h,hitTest:function(e,t,n){for(var r=t,i=0,a=Number.MAX_VALUE,s=0;s<u;++s){var c=d(s/u,e.start,e.end,e.control.length>0?e.control[0]:[0,0],e.control.length>1?e.control[1]:[0,0]),l=o.length2(o.subtract2(r,c));l<a&&(i=s,a=l)}var h=i/u;return a<((e.widthEnd-e.widthStart)*h+e.widthStart)/2}}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(3),s=n(7),c=n(0),u=n(2),l=n(126),d=n(24);var h=((r={})[d.EdgeType.LINE]=n(125),r[d.EdgeType.BEZIER]=n(124),r[d.EdgeType.BEZIER2]=n(123),r),f=n(122),p=n(121),v=n(120),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getInstancePickingMethods=function(){return l.edgePicking(this.props)},t.prototype.initShader=function(){for(var e,n,r=this,i=this.props,o=i.animate,a=void 0===o?{}:o,s=i.scaleFactor,l=void 0===s?function(){return 1}:s,g=i.type,y=i.scaleType,m=void 0===y?d.EdgeScaleType.NONE:y,b=a.end,w=a.start,_=a.colorStart,T=a.colorEnd,x=a.control,A=g===d.EdgeType.LINE?2:50,I=((e={0:1})[2*A+2]=-1,e),S=((n={0:0})[2*A+2]=1,n),M=1,E=0;E<2*A;++E)I[E+1]=M,S[E+1]=Math.floor(E/2)/(A-1),M*=-1;var O={interpolation:h[g]},P=u.shaderTemplate({options:O,required:{name:"Edge Layer",values:["interpolation"]},shader:m===d.EdgeScaleType.NONE?f:p,onToken:function(e,t){return e in O?t:"${"+e+"}"}});return{fs:v,instanceAttributes:[{easing:w,name:t.attributeNames.start,size:c.InstanceAttributeSize.TWO,update:function(e){return e.start}},{easing:b,name:t.attributeNames.end,size:c.InstanceAttributeSize.TWO,update:function(e){return e.end}},{name:t.attributeNames.widthStart,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.widthStart]}},{name:t.attributeNames.widthEnd,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.widthEnd]}},{name:t.attributeNames.depth,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{easing:_,name:t.attributeNames.colorStart,size:c.InstanceAttributeSize.FOUR,update:function(e){return e.colorStart}},{easing:T,name:t.attributeNames.colorEnd,size:c.InstanceAttributeSize.FOUR,update:function(e){return e.colorEnd}},g===d.EdgeType.LINE?{easing:x,name:t.attributeNames.control,size:c.InstanceAttributeSize.FOUR,update:function(e){return[0,0,0,0]}}:null,g===d.EdgeType.BEZIER?{easing:x,name:t.attributeNames.control,size:c.InstanceAttributeSize.FOUR,update:function(e){return[e.control[0][0],e.control[0][1],0,0]}}:null,g===d.EdgeType.BEZIER2?{easing:x,name:t.attributeNames.control,size:c.InstanceAttributeSize.FOUR,update:function(e){return function(e){return[e[0][0],e[0][1],e[1][0],e[1][1]]}(e.control)}}:null],uniforms:[{name:"scaleFactor",size:c.UniformSize.ONE,update:function(e){return[l()]}},{name:"layerOpacity",size:c.UniformSize.ONE,update:function(e){return[void 0===r.props.opacity?1:r.props.opacity]}}],vertexAttributes:[{name:"position",size:c.VertexAttributeSize.THREE,update:function(e){return[I[e],S[e],2*A]}}],vertexCount:2*A+2,vs:P.shader}},t.prototype.getModelType=function(){return{drawMode:o.TriangleStripDrawMode,modelType:o.Mesh}},t.prototype.getMaterialOptions=function(){return u.CommonMaterialOptions.transparentShape},t.defaultProps={broadphase:d.EdgeBroadphase.ALL,data:new a.InstanceProvider,key:"none",scaleType:d.EdgeScaleType.NONE,scene:"default",type:d.EdgeType.LINE},t.attributeNames={start:"start",end:"end",widthStart:"widthStart",widthEnd:"widthEnd",depth:"depth",colorStart:"colorStart",colorEnd:"colorEnd",control:"control"},t}(s.Layer);t.EdgeLayer=g},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(127)),r(n(119)),r(n(24))},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=function(e){function t(t){var n=e.call(this,t)||this;return n.color=[1,1,1,1],n.depth=0,n.radius=0,n.center=[0,0],n.color=t.color||n.color,n.radius=t.radius||n.radius,n.center=t.center||n.center,n.depth=t.depth||n.depth,n}return r(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),i([o.observable],t.prototype,"color",void 0),i([o.observable],t.prototype,"depth",void 0),i([o.observable],t.prototype,"radius",void 0),i([o.observable],t.prototype,"center",void 0),t}(n(6).Instance);t.CircleInstance=a},function(e,t){e.exports="precision highp float;\n\n${import: projection}\n\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nvarying vec2 pointCoord;\n\n${extendHeader}\n\nvoid main() {\n  ${attributes}\n\n  vertexColor = color;\n  vertexColor.a *= layerOpacity;\n  float size = radius * scaleFactor;\n  edgeSharpness = mix(0.8, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\n  edgeSharpnessBase = mix(0.1, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\n  pointCoord = (position.xy + vec2(1.0, 1.0)) / 2.0;\n\n  // Center within clip space\n  vec4 clipCenter = clipSpace(vec3(center, depth));\n  // Center in screen space\n  vec2 screenCenter = (clipCenter.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\n  // Position in screen space\n  vec2 vertex = (position.xy * size) + screenCenter;\n  // Position back to clip space\n  gl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), clipCenter.zw);\n\n  ${extend}\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nvarying vec2 pointCoord;\n\nfloat circle(vec2 coord, float radius){\n  vec2 dist = coord - vec2(0.5);\n\n  return 1.0 - smoothstep(\n    radius - (radius * edgeSharpness),\n    radius + (radius * edgeSharpnessBase),\n    dot(dist, dist) * 4.0\n  );\n}\n\n${extendHeader}\n\nvoid main() {\n  float step_factor = circle(pointCoord.xy, 1.0);\n\n  setColor(mix(\n    vec4(0.0, 0.0, 0.0, 0.0),\n    vertexColor,\n    step_factor\n  ));\n\n  ${extend}\n}\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);function i(e,t){var n=r.subtract2(e,t),i=n[0],o=n[1];return i*i+o*o}var o=function(){function e(){}return e.add=function(e,t,n){var i=r.add2(e,t);return n?(n[0]=i[0],n[1]=i[1],n):i},e.getClosest=function(e,t){var n,r=Number.MAX_VALUE,o=e;return t.forEach(function(t){(n=i(t,e))<r&&(r=n,o=t)}),o},e.getClosestIndex=function(e,t){var n,r=Number.MAX_VALUE,o=0;return t.forEach(function(t,a){(n=i(t,e))<r&&(r=n,o=a)}),o},e.subtract=function(e,t,n){void 0===n&&(n=!1);var i=r.subtract2(t,e),o=i[0],a=i[1];if(n){var s=Math.sqrt(o*o+a*a);o/=s,a/=s}return[o,a]},e.getDistance=function(e,t,n){return void 0===n&&(n=!1),n?i(e,t):Math.sqrt(i(e,t))},e.getMidpoint=function(e,t){var n=r.scale2(r.subtract2(t,e),.5);return r.add2(n,e)},e.make=function(e,t){return{x:e,y:t}},e.scale=function(e,t,n){return n?(n[0]=e[0]*t,n[1]=e[1]*t,n):[e[0]*t,e[1]*t]},e.zero=function(){return[0,0]},e}();t.Point=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(3),a=n(11),s=n(7),c=n(0),u=n(2),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getInstancePickingMethods=function(){var e=this;return{boundsAccessor:function(e){return new a.Bounds({height:2*e.radius,width:2*e.radius,x:e.center[0]-e.radius,y:e.center[1]-e.radius})},hitTest:function(t,n,r){var i=r.worldToScreen(t.center),o=r.worldToScreen(n),a=t.radius*(e.props.scaleFactor||function(){return 1})(),s=u.subtract2(o,i);return s[0]*s[0]+s[1]*s[1]<a*a}}},t.prototype.initShader=function(){var e=this,r=this.props.scaleFactor||function(){return 1},i=this.props.animate||{},o=i.center,a=i.radius,s=i.color,u={0:1,1:1,2:-1,3:1,4:-1,5:-1},l={0:-1,1:-1,2:-1,3:1,4:1,5:1};return{fs:n(131),instanceAttributes:[{easing:o,name:t.attributeNames.center,size:c.InstanceAttributeSize.TWO,update:function(e){return e.center}},{easing:a,name:t.attributeNames.radius,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.radius]}},{name:t.attributeNames.depth,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{easing:s,name:t.attributeNames.color,size:c.InstanceAttributeSize.FOUR,update:function(e){return e.color}}],uniforms:[{name:"scaleFactor",size:c.UniformSize.ONE,update:function(e){return[r()]}},{name:"layerOpacity",size:c.UniformSize.ONE,update:function(t){return[void 0===e.props.opacity?1:e.props.opacity]}}],vertexAttributes:[{name:"position",size:c.VertexAttributeSize.THREE,update:function(e){return[u[e],l[e],0]}}],vertexCount:6,vs:n(130)}},t.prototype.getModelType=function(){return{drawMode:i.TriangleStripDrawMode,modelType:i.Mesh}},t.prototype.getMaterialOptions=function(){return u.CommonMaterialOptions.transparentShape},t.defaultProps={data:new o.InstanceProvider,fadeOutOversized:-1,key:"",scaleFactor:function(){return 1},scene:"default"},t.attributeNames={center:"center",radius:"radius",depth:"depth",color:"color"},t}(s.Layer);t.CircleLayer=l},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(133)),r(n(129))},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=function(e){function t(t){var n=e.call(this,t)||this;return n.angle=[0,Math.PI],n.colorEnd=[0,0,0,1],n.colorStart=[0,0,0,1],n.center=[0,0],n.depth=0,n.radius=1,n.thickness=[1,1],n.angle=t.angle||n.angle,n.colorEnd=t.colorEnd||n.colorEnd,n.colorStart=t.colorStart||n.colorStart,n.center=t.center||n.center,n.depth=t.depth||n.depth,n.radius=t.radius||n.radius,n.thickness=t.thickness||n.thickness,n}return r(t,e),i([o.observable],t.prototype,"angle",void 0),i([o.observable],t.prototype,"colorEnd",void 0),i([o.observable],t.prototype,"colorStart",void 0),i([o.observable],t.prototype,"center",void 0),i([o.observable],t.prototype,"depth",void 0),i([o.observable],t.prototype,"radius",void 0),i([o.observable],t.prototype,"thickness",void 0),t}(n(6).Instance);t.ArcInstance=a},function(e,t){e.exports="precision highp float;\n\nvarying vec4 vertexColor;\n${extendHeader}\n\nvoid main() {\n  setColor(vertexColor);\n  gl_FragColor = vertexColor;\n  ${extend}\n}\n"},function(e,t){e.exports="precision highp float;\n\n/**\n  This vertex shader calculates edges whose curve and width is in screen space where the curve is\n  bezier curves with 0, 1, and 2 control points.\n**/\nvarying vec4 vertexColor;\n\nvec2 interpolation(float t, vec2 center, float radius, float start, float end) {\n  float angle = (end - start) * t + start;\n  return center + vec2(cos(angle) * radius, sin(angle) * radius);\n}\n\n${extendHeader}\n\nvoid main() {\n  ${attributes}\n\n  // Destructure some of the vec injections\n  float startAngle = angle.x;\n  float endAngle = angle.y;\n  float widthStart = thickness.x;\n  float widthEnd = thickness.y;\n\n  // Convert world points to screen space\n  vec4 centerClip = clipSpace(vec3(center, depth));\n  vec2 centerScreen = (centerClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\n  // Destructure threejs's bug with the position requirement\n  float normal = position.x;\n  float interpolationTime = position.y;\n  float interpolationIncrement = 1.0 / position.z;\n  // Get the position of the current vertex\n  vec2 currentPosition = interpolation(interpolationTime, centerScreen, radius, startAngle, endAngle);\n  // Get normal with currentPosition and center\n  vec2 currentNormal = normalize(currentPosition - centerScreen);\n  // Get the thickness based on the side we're on\n  float lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;\n  // Start on the calculated line and push out by the normal's value\n  vec2 vertex = currentPosition + currentNormal * (normal * lineThickness);\n  // Get the color based on where we are on the line\n  vertexColor = mix(colorStart, colorEnd, interpolationTime);\n  vertexColor *= vertexColor.a;\n\n  gl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), centerClip.zw);\n  gl_PointSize = 5.0;\n\n  ${extend}\n}\n"},function(e,t){e.exports="${import: circularArc, projection}\nprecision highp float;\n\n/**\n  This vertex shader calculates edges whose curve and width is in screen space where the curve is\n  bezier curves with 0, 1, and 2 control points.\n**/\nvarying vec4 vertexColor;\n\n${extendHeader}\n\nvoid main() {\n  ${attributes}\n\n  // Destructure some of the vec injections\n  float startAngle = angle.x;\n  float endAngle = angle.y;\n  float widthStart = thickness.x;\n  float widthEnd = thickness.y;\n  // Destructure threejs's bug with the position requirement\n  float normal = position.x;\n  float interpolationTime = position.y;\n  float interpolationIncrement = 1.0 / position.z;\n  // Get the position of the current vertex\n  vec2 currentPosition = circularArc(interpolationTime, center, radius, startAngle, endAngle);\n  // Get normal with currentPosition and center\n  vec2 currentNormal = normalize(currentPosition - center);\n  // Get the thickness based on the side we're on\n  float lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;\n  // Start on the calculated line and push out by the normal's value\n  vec2 vertex = currentPosition + currentNormal * (normal * lineThickness);\n  // Get the color based on where we are on the line\n  vertexColor = mix(colorStart, colorEnd, interpolationTime);\n\n  gl_Position = clipSpace(vec3(vertex, depth));\n\n  ${extend}\n}\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);var i=function(){function e(e){this.isMouseOver=new Map,this.isMouseDown=new Map,this.layer=e}return e.prototype.getColorPickInstance=function(){return this.colorPicking&&function(e){return e&&e.colorPicking}(this.layer.diffManager.processor)?this.layer.diffManager.processor.colorPicking.uidToInstance.get(16777215-this.colorPicking.nearestColor):null},e.prototype.handleMouseOver=function(e,t){},e.prototype.handleMouseDown=function(e,t,n){var i=this;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var o=this.layer.props.onMouseDown;if(o){var a,s,c=e.viewToWorld(t),u=void 0,l=[];if(this.layer.picking.type===r.PickType.ALL)a=this.layer.picking.hitTest,u=function(t){return s(t).filter(function(t){return a(t,c,e)})},l=(s=this.layer.picking.quadTree.query.bind(this.layer.picking.quadTree))(c).filter(function(t){return a(t,c,e)});else if(this.layer.picking.type===r.PickType.SINGLE){var d=this.getColorPickInstance();d&&l.push(d)}o({button:n,instances:l,layer:this.layer.id,projection:e,querySpace:u,screen:t,world:c}),this.isMouseDown.clear(),l.forEach(function(e){return i.isMouseDown.set(e,!0)})}}},e.prototype.handleMouseOut=function(e,t){if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var n=this.layer.props.onMouseOut;if(n){var i,o,a=e.viewToWorld(t),s=void 0;this.layer.picking.type===r.PickType.ALL&&(i=this.layer.picking.hitTest,o=this.layer.picking.quadTree.query.bind(this.layer.picking.quadTree),s=function(t){return o(t).filter(function(t){return i(t,a,e)})}),n({instances:Array.from(this.isMouseOver.keys()),layer:this.layer.id,projection:e,querySpace:s,screen:t,world:a})}}this.isMouseOver.clear(),this.isMouseDown.clear()},e.prototype.handleMouseUp=function(e,t,n){if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var i=this.layer.props.onMouseUp;if(i){var o,a,s=e.viewToWorld(t),c=void 0,u=[];if(this.layer.picking.type===r.PickType.ALL)o=this.layer.picking.hitTest,c=function(t){return a(t).filter(function(t){return o(t,s,e)})},u=(a=this.layer.picking.quadTree.query.bind(this.layer.picking.quadTree))(s).filter(function(t){return o(t,s,e)});else if(this.layer.picking.type===r.PickType.SINGLE){var l=this.getColorPickInstance();l&&u.push(l)}i({button:n,instances:u,layer:this.layer.id,projection:e,querySpace:c,screen:t,world:s})}}},e.prototype.handleMouseMove=function(e,t){var n=this,i=this.layer.props,o=i.onMouseOver,a=i.onMouseMove,s=i.onMouseOut;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE&&(o||a||s)){var c,u,l=void 0,d=e.viewToWorld(t),h=void 0,f=[];if(this.layer.picking.type===r.PickType.ALL)c=this.layer.picking.hitTest,h=function(t){return u(t).filter(function(t){return c(t,d,e)})},f=(u=this.layer.picking.quadTree.query.bind(this.layer.picking.quadTree))(d).filter(function(t){return c(t,d,e)});else if(this.layer.picking.type===r.PickType.SINGLE){var p=this.getColorPickInstance();p&&f.push(p)}if(o){var v=f.filter(function(e){return!n.isMouseOver.get(e)});l={instances:v,layer:this.layer.id,projection:e,querySpace:h,screen:t,world:d},v.length>0&&o(l)}a&&a(l={instances:f,layer:this.layer.id,projection:e,querySpace:h,screen:t,world:d});var g=new Map;if(f.forEach(function(e){return g.set(e,!0)}),s){var y=Array.from(this.isMouseOver.keys()).filter(function(e){return!g.get(e)});l={instances:y,layer:this.layer.id,projection:e,querySpace:h,screen:t,world:d},y.length>0&&s(l)}this.isMouseOver=g}},e.prototype.handleMouseClick=function(e,t,n){if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var i=this.layer.props.onMouseClick;if(i){var o,a,s=e.viewToWorld(t),c=void 0,u=[];if(this.layer.picking.type===r.PickType.ALL)o=this.layer.picking.hitTest,c=function(t){return a(t).filter(function(t){return o(t,s,e)})},u=(a=this.layer.picking.quadTree.query.bind(this.layer.picking.quadTree))(s).filter(function(t){return o(t,s,e)});else if(this.layer.picking.type===r.PickType.SINGLE){var l=this.getColorPickInstance();l&&u.push(l)}i({button:n,instances:u,layer:this.layer.id,projection:e,querySpace:c,screen:t,world:s})}}},e.prototype.handleMouseDrag=function(e,t){},e}();t.LayerInteractionHandler=i},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(5),a=[],s=function(e){function t(t,n){var r=e.call(this,t,n)||this;return t.picking.type===i.PickType.ALL?r.quadPicking=t.picking:console.warn("Diff Processing Error: A layer has a diff processor requesting Quad Processing but the picking type is not valid."),r}return r(t,e),t.prototype.addInstance=function(e,t,n,r){if(r)e.changeInstance(e,t,a,r);else{var i=e.layer.bufferManager.add(t);o.isBufferLocation(i)&&(t.active=!0,t.easingId=e.layer.easingId,e.updateInstance(e.layer,t,i),e.quadPicking.quadTree.remove(t),e.quadPicking.quadTree.add(t))}},t.prototype.changeInstance=function(e,t,n,r){r?(e.updateInstance(e.layer,t,r),e.quadPicking.quadTree.remove(t),e.quadPicking.quadTree.add(t)):e.addInstance(e,t,a,r)},t.prototype.removeInstance=function(e,t,n,r){r&&(t.active=!1,t.clearEasing(),e.updateInstance(e.layer,t,r),e.layer.bufferManager.remove(t),e.quadPicking.quadTree.remove(t))},t}(n(25).UniformDiffProcessor);t.UniformQuadDiffProcessor=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(5),a=[],s=function(e){function t(t,n){var r=e.call(this,t,n)||this;return t.picking.type===i.PickType.SINGLE?(r.colorPicking=t.picking,r.colorPicking.uidToInstance=new Map):console.warn("Diff Processing Error: A layer has a diff processor requesting Color Processing but the picking type is not valid."),r}return r(t,e),t.prototype.addInstance=function(e,t,n,r){if(r)e.changeInstance(e,t,a,r);else{var i=e.layer.bufferManager.add(t);o.isBufferLocation(i)?(t.active=!0,t.easingId=e.layer.easingId,e.updateInstance(e.layer,t,i),e.colorPicking.uidToInstance.set(t.uid,t)):console.warn("A data cluster was not provided by the manager to associate an instance with.")}},t.prototype.changeInstance=function(e,t,n,r){r?e.updateInstance(e.layer,t,r):e.addInstance(e,t,a,r)},t.prototype.removeInstance=function(e,t,n,r){r&&(t.active=!1,t.clearEasing(),e.updateInstance(e.layer,t,r),e.layer.bufferManager.remove(t),e.colorPicking.uidToInstance.delete(t.uid))},t}(n(25).UniformDiffProcessor);t.UniformColorDiffProcessor=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(5),a=[],s=function(e){function t(t,n){var r=e.call(this,t,n)||this;return t.picking.type===i.PickType.ALL?r.quadPicking=t.picking:console.warn("Diff Processing Error: A layer has a diff processor requesting Quad Processing but the picking type is not valid."),r}return r(t,e),t.prototype.addInstance=function(e,t,n,r){if(r)e.changeInstance(e,t,a,r);else{var i=e.layer.bufferManager.add(t);o.isBufferLocationGroup(i)&&(t.active=!0,t.easingId=e.layer.easingId,e.updateInstance(e.layer,t,a,i),e.quadPicking.quadTree.remove(t),e.quadPicking.quadTree.add(t))}},t.prototype.changeInstance=function(e,t,n,r){r?(e.updateInstance(e.layer,t,n,r),e.quadPicking.quadTree.remove(t),e.quadPicking.quadTree.add(t)):e.addInstance(e,t,a,r)},t.prototype.removeInstance=function(e,t,n,r){r&&(t.active=!1,t.clearEasing(),e.updateInstance(e.layer,t,a,r),e.layer.bufferManager.remove(t),e.quadPicking.quadTree.remove(t))},t}(n(26).InstanceAttributeDiffProcessor);t.InstanceAttributeQuadDiffProcessor=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(5),a=[],s=function(e){function t(t,n){var r=e.call(this,t,n)||this;return t.picking.type===i.PickType.SINGLE?(r.colorPicking=t.picking,r.colorPicking.uidToInstance=new Map):console.warn("Diff Processing Error: A layer has a diff processor requesting Color Processing but the picking type is not valid."),r}return r(t,e),t.prototype.addInstance=function(e,t,n,r){if(r)e.changeInstance(e,t,a,r);else{var i=e.layer.bufferManager.add(t);o.isBufferLocationGroup(i)?(t.active=!0,t.easingId=e.layer.easingId,e.updateInstance(e.layer,t,a,i),e.colorPicking.uidToInstance.set(t.uid,t)):console.warn("A data cluster was not provided by the manager to associate an instance with.")}},t.prototype.changeInstance=function(e,t,n,r){r?e.updateInstance(e.layer,t,n,r):e.addInstance(e,t,a,r)},t.prototype.removeInstance=function(e,t,n,r){r&&(t.active=!1,t.clearEasing(),e.updateInstance(e.layer,t,a,r),e.layer.bufferManager.remove(t),e.colorPicking.uidToInstance.delete(t.uid))},t}(n(26).InstanceAttributeDiffProcessor);t.InstanceAttributeColorDiffProcessor=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(50),a=n(0),s=n(2),c=n(14),u=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.buffers=[],r.availableClusters=[],r.instanceToCluster={},r.clusterToBuffer=new Map,r.add=function(e){this.availableClusters.length<=0&&this.makeNewBuffer();var t=this.availableClusters.pop();return t?this.instanceToCluster[e.uid]=t:console.warn("No valid cluster available for instance added to uniform manager."),t},r.remove=function(e){var t=this.instanceToCluster[e.uid];return t&&(delete this.instanceToCluster[e.uid],this.availableClusters.push(t)),e};var i=0;return t.instanceAttributes.forEach(function(e){i=Math.max(e.block||0,i)}),r.uniformBlocksPerInstance=i+1,r}return r(t,e),t.prototype.destroy=function(){this.buffers.forEach(function(e){e.geometry.dispose(),e.material.dispose()})},t.prototype.getBufferLocations=function(e){return this.instanceToCluster[e.uid]},t.prototype.getActiveAttributePropertyId=function(){return-1},t.prototype.getInstanceCount=function(){return-1},t.prototype.getUpdateAllPropertyIdList=function(){return[]},t.prototype.removeFromScene=function(){var e=this.scene;if(e.container){for(var t=0,n=this.buffers.length;t<n;++t){var r=this.buffers[t];e.container.remove(r.model),r.pickModel&&this.scene.pickingContainer.remove(r.pickModel)}delete this.scene}},t.prototype.setScene=function(e){if(e.container){for(var t=0,n=this.buffers.length;t<n;++t){var r=this.buffers[t];e.container.add(r.model),r.pickModel&&e.pickingContainer.add(r.pickModel)}this.scene=e}else console.warn("Can not set a scene that has an undefined container.")},t.prototype.makeNewBuffer=function(){var e=new i.BufferGeometry;this.layer.vertexAttributes.forEach(function(t){t.materialAttribute&&e.addAttribute(t.name,t.materialAttribute)}),e.drawRange.start=0,e.drawRange.count=this.layer.maxInstancesPerBuffer*this.layer.instanceVertexCount;var t=this.layer.material.clone(),n=c.generateLayerModel(this.layer,e,t);n.frustumCulled=!1;var r={activeInstances:[],clusters:[],firstInstance:0,geometry:e,lastInstance:0,material:t,model:n,pickModel:this.layer.picking.type===a.PickType.SINGLE?n.clone():void 0};this.buffers.push(r);var u=0,l=o.UniformProcessing.uniformPackingBufferName(),d=t.uniforms[l];d.value=d.value.map(function(){return new i.Vector4(0,0,0,0)});for(var h=Object.assign({},this.layer.instanceAttributes[0],{bufferAttribute:new i.InstancedBufferAttribute(new Float32Array(1),1),uid:s.uid()}),f=0,p=this.layer.maxInstancesPerBuffer;f<p;++f){var v={attribute:h,buffer:d,instanceIndex:f,range:[u,0]};u+=this.uniformBlocksPerInstance,v.range[1]=u,r.clusters.push(v),this.availableClusters.push(v),this.clusterToBuffer.set(v,r)}for(f=0,p=this.layer.uniforms.length;f<p;++f){var g=this.layer.uniforms[f];g.materialUniforms.push(t.uniforms[g.name])}this.scene&&this.scene.container&&(this.scene.container.add(r.model),r.pickModel&&this.scene.pickingContainer.add(r.pickModel))},t}(n(5).BufferManagerBase);t.UniformBufferManager=u},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(3),a=n(0),s=n(2),c=n(51),u=n(14),l=n(5),d=Math.max,h=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.allBufferLocations={},r.availableLocations=[],r.currentInstancedCount=0,r.instanceToBufferLocation={},r.growthCount=0,r.maxInstancedCount=1e3,r.blockSubAttributesLookup=new Map,r.attributeToPropertyIds=new Map,r.updateAllPropertyIdList=[],r.activePropertyId=-1,r.remove=function(e){var t=r.instanceToBufferLocation[e.uid];return t&&(delete r.instanceToBufferLocation[e.uid],r.availableLocations.push(t)),e},r.add=r.doAddWithRegistration,r}return r(t,e),t.prototype.doAddWithRegistration=function(e){var t=this;this.layer.instanceAttributes.forEach(function(n){if(!n.parentAttribute){o.ObservableMonitoring.setObservableMonitor(!0),n.update(e);var r=o.ObservableMonitoring.getObservableMonitorIds(!0);t.attributeToPropertyIds.set(n,r),n===t.layer.activeAttribute&&(t.activePropertyId=r[0])}}),o.ObservableMonitoring.setObservableMonitor(!1),this.makeUpdateAllPropertyIdList();var n=this.resizeBuffer();return this.gatherLocationsIntoGroups(n.newLocations,n.growth),this.add=this.doAdd,this.doAdd(e)},t.prototype.doAdd=function(e){if(this.availableLocations.length<=0){var t=this.resizeBuffer();this.gatherLocationsIntoGroups(t.newLocations,t.growth)}var n=this.availableLocations.shift();return n&&this.geometry?(this.instanceToBufferLocation[e.uid]=n,this.currentInstancedCount=this.geometry.maxInstancedCount=d(this.currentInstancedCount,n.instanceIndex+1),this.geometry.drawRange={count:this.currentInstancedCount*this.layer.instanceVertexCount,start:0}):console.error("Add Error: Instance Attribute Buffer Manager failed to pair an instance with a buffer location"),n},t.prototype.destroy=function(){this.geometry&&this.geometry.dispose(),this.material&&this.material.dispose(),this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model)},t.prototype.getBufferLocations=function(e){return this.instanceToBufferLocation[e.uid]},t.prototype.getActiveAttributePropertyId=function(){return this.activePropertyId},t.prototype.getUpdateAllPropertyIdList=function(){return this.updateAllPropertyIdList},t.prototype.makeUpdateAllPropertyIdList=function(){var e={};this.attributeToPropertyIds.forEach(function(t){e[t[0]]=t[0]}),this.updateAllPropertyIdList=Object.values(e).filter(Boolean)},t.prototype.removeFromScene=function(){this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model),this.pickModel&&this.scene.pickingContainer.remove(this.pickModel),delete this.scene},t.prototype.resizeBuffer=function(){var e=0,t=new Map;if(this.geometry){this.geometry.dispose(),this.geometry=new i.InstancedBufferGeometry;for(var n=this.maxInstancedCount,r=0,o=this.layer.vertexAttributes;r<o.length;r++){(P=o[r]).materialAttribute&&this.geometry.addAttribute(P.name,P.materialAttribute)}this.growthCount=Math.min(1,this.growthCount+1),e=1e3*Math.pow(10,this.growthCount),this.maxInstancedCount+=e,this.attributes=this.attributes||[],this.blockAttributes=this.blockAttributes||[];for(w=0,b=this.blockAttributes.length;w<b;++w){A=(P=this.blockAttributes[w]).bufferAttribute;var c=P.size||0;if(A.array instanceof Float32Array){(S=new Float32Array(this.maxInstancedCount*c)).set(A.array,0);var l=new i.InstancedBufferAttribute(S,c);l.setDynamic(!0),P.bufferAttribute=A=l,this.geometry.addAttribute(P.name,l);I=this.blockSubAttributesLookup.get(w),_=P.size||0;if(I)for(M=0,E=I.length;M<E;++M){var d=I[M];(O=t.get(d.name))||(O=[],t.set(d.name,O));C=this.allBufferLocations[d.name]||[];this.allBufferLocations[d.name]=C;L=Object.assign({},d,{uid:s.uid(),packUID:P.packUID,bufferAttribute:A}),k=d.blockIndex||0,R=d.size||1;for(var h=0,f=C.length;h<f;++h){C[h].attribute=L}for(m=n;m<this.maxInstancedCount;++m){z={attribute:L,block:w,buffer:{value:S},instanceIndex:m,range:[m*_+k,m*_+k+R]};O.push(z),C.push(z)}}}}}else{e=this.maxInstancedCount,this.geometry=new i.InstancedBufferGeometry;for(var p=0,v=this.layer.vertexAttributes;p<v.length;p++){(P=v[p]).materialAttribute&&this.geometry.addAttribute(P.name,P.materialAttribute)}this.attributes=[],this.blockAttributes=[];var g=new Map,y=new Map;this.blockSubAttributesLookup=y;for(var m=0,b=this.layer.instanceAttributes.length;m<b;++m){var w=(P=this.layer.instanceAttributes[m]).block||0,_=g.get(w)||0;_=Math.max(_,(P.blockIndex||0)+(P.size||0)),g.set(w,_);var T=y.get(w);T||(T=[],y.set(w,T)),T.push(P)}y.forEach(function(e){return e.sort(function(e,t){return(e.blockIndex||0)-(t.blockIndex||0)})});for(var w=0,b=g.size;w<b;++w){var _=g.get(w)||0,x=s.uid();_||console.warn("Instance Attribute Packing Error: The system tried to build an attribute with a size of zero.","These are the attributes used:",this.layer.instanceAttributes,"These are the block sizes calculated",g,"This is the block to attribute lookup generated",y);var A,I,S=new Float32Array(_*this.maxInstancedCount);if((A=new i.InstancedBufferAttribute(S,_)).setDynamic(!0),this.geometry.addAttribute("block"+w,A),I=y.get(w)){for(var M=0,E=I.length;M<E;++M){var O,P=I[M];(O=t.get(P.name))||(O=[],t.set(P.name,O));var C=this.allBufferLocations[P.name]||[];this.allBufferLocations[P.name]=C;for(var L=Object.assign({},P,{uid:w,packUID:x,bufferAttribute:A,size:_}),k=P.blockIndex||0,R=P.size||1,m=0;m<this.maxInstancedCount;++m){var z={attribute:L,block:w,buffer:{value:S},instanceIndex:m,range:[m*_+k,m*_+k+R]};O.push(z),C.push(z)}this.attributes.push(L)}this.blockAttributes.push({uid:s.uid(),packUID:x,bufferAttribute:A,name:"block"+w,size:a.InstanceAttributeSize.FOUR,update:function(){return[0]}})}else console.warn("Instance Attribute Packing Buffer Error: Somehow there are no attributes associated with a block.","These are the attributes used:",this.layer.instanceAttributes,"These are the block sizes calculated",g,"This is the block to attribute lookup generated",y)}this.geometry.maxInstancedCount=0,this.material=this.layer.material.clone();m=0;for(var B=this.layer.uniforms.length;m<B;++m){var N=this.layer.uniforms[m];N.materialUniforms.push(this.material.uniforms[N.name])}}return this.scene&&this.model&&this.scene.container&&this.scene.container.remove(this.model),this.scene&&this.scene.pickingContainer&&this.pickModel&&this.scene.pickingContainer.remove(this.pickModel),this.material=this.material||this.layer.material.clone(),this.model=u.generateLayerModel(this.layer,this.geometry,this.material),this.model.frustumCulled=!1,this.pickModel=this.layer.picking.type===a.PickType.SINGLE?this.model.clone():void 0,this.scene&&this.scene.container&&(this.scene.container.add(this.model),this.pickModel&&this.scene.pickingContainer.add(this.pickModel)),{growth:e,newLocations:t}},t.prototype.gatherLocationsIntoGroups=function(e,t){if(0!==this.attributeToPropertyIds.size){var n=[];this.attributeToPropertyIds.forEach(function(t,r){n.push({attribute:r,bufferLocationsForAttribute:e.get(r.name)||[],childBufferLocations:(r.childAttributes||[]).map(function(t){return e.get(t.name)||[]}),ids:t})});for(var r=0;r<t;++r){for(var i={instanceIndex:-1,propertyToBufferLocation:{}},o=function(e,t){var r=n[e],o=r.attribute,a=r.ids,s=r.bufferLocationsForAttribute;if(!s)return c.emitOnce("Instance Attribute Buffer Error",function(e,t){console.warn(t+": There is an error in forming buffer location groups in InstanceAttributePackingBufferManager. Error count: "+e)}),"continue";var u=s.shift();if(!u)return c.emitOnce("Instance Attribute Buffer Error",function(e,t){console.warn(t+": There is an error in forming buffer location groups in InstanceAttributePackingBufferManager. Error count: "+e)}),"continue";if(-1===i.instanceIndex)i.instanceIndex=u.instanceIndex;else if(u.instanceIndex!==i.instanceIndex)return c.emitOnce("Instance Attribute Parallelism Error",function(e,t){console.warn(t+": A buffer location does not have a matching instance index which means the buffer locations are not in parallel with each other somehow. Error count: "+e),console.warn(o.name,u)}),"continue";if(o.childAttributes){for(var l=[],d=function(e,t){var n=o.childAttributes[e],i=r.childBufferLocations[e];if(i){var a=i.shift();a?l.push(a):c.emitOnce("Instance Attribute Child Attribute Error",function(e,t){console.warn(t+": A child attribute does not have a buffer location available. Error count: "+e),console.warn("Parent Attribute: "+o.name+" Child Attribute: "+n.name)})}},h=0,f=o.childAttributes.length;h<f;++h)d(h);u.childLocations=l}for(h=0,f=a.length;h<f;++h){var p=a[h];i.propertyToBufferLocation[p]=u}},a=0,s=n.length;a<s;++a)o(a);this.availableLocations.push(i)}c.flushEmitOnce()}},t.prototype.getInstanceCount=function(){return this.maxInstancedCount},t}(l.BufferManagerBase);t.InstanceAttributePackingBufferManager=h},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(3),a=n(52),s=n(0),c=n(51),u=n(18),l=n(14),d=n(5),h=Math.max,f=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.allBufferLocations={},r.availableLocations=[],r.currentInstancedCount=0,r.instanceToBufferLocation={},r.growthCount=0,r.maxInstancedCount=1e3,r.attributeToPropertyIds=new Map,r.updateAllPropertyIdList=[],r.activePropertyId=-1,r.remove=function(e){var t=r.instanceToBufferLocation[e.uid];return t&&(delete r.instanceToBufferLocation[e.uid],r.availableLocations.push(t)),e},r.add=r.doAddWithRegistration,r}return r(t,e),t.prototype.doAddWithRegistration=function(e){var t=this;this.layer.instanceAttributes.forEach(function(n){if(!n.parentAttribute){o.ObservableMonitoring.setObservableMonitor(!0),n.update(e);var r=o.ObservableMonitoring.getObservableMonitorIds(!0);t.attributeToPropertyIds.set(n,r),n===t.layer.activeAttribute&&(t.activePropertyId=r[0])}}),o.ObservableMonitoring.setObservableMonitor(!1),this.makeUpdateAllPropertyIdList();var n=this.resizeBuffer();return this.gatherLocationsIntoGroups(n.newLocations,n.growth),this.add=this.doAdd,this.doAdd(e)},t.prototype.doAdd=function(e){if(this.availableLocations.length<=0){var t=this.resizeBuffer();this.gatherLocationsIntoGroups(t.newLocations,t.growth)}var n=this.availableLocations.shift();return n&&this.geometry?(this.instanceToBufferLocation[e.uid]=n,this.currentInstancedCount=this.geometry.maxInstancedCount=h(this.currentInstancedCount,n.instanceIndex+1),this.geometry.drawRange={count:this.currentInstancedCount*this.layer.instanceVertexCount,start:0}):console.error("Add Error: Instance Attribute Buffer Manager failed to pair an instance with a buffer location"),n},t.prototype.destroy=function(){this.geometry&&this.geometry.dispose(),this.material&&this.material.dispose(),this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model)},t.prototype.getBufferLocations=function(e){return this.instanceToBufferLocation[e.uid]},t.prototype.getActiveAttributePropertyId=function(){return this.activePropertyId},t.prototype.getUpdateAllPropertyIdList=function(){return this.updateAllPropertyIdList},t.prototype.makeUpdateAllPropertyIdList=function(){var e={};this.attributeToPropertyIds.forEach(function(t){e[t[0]]=t[0]}),this.updateAllPropertyIdList=Object.values(e).filter(Boolean)},t.prototype.removeFromScene=function(){this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model),this.pickModel&&this.scene.pickingContainer.remove(this.pickModel),delete this.scene},t.prototype.resizeBuffer=function(){var e=0,t=new Map;if(this.geometry){this.geometry.dispose(),this.geometry=new i.InstancedBufferGeometry;for(var n=this.maxInstancedCount,r=0,o=this.layer.vertexAttributes;r<o.length;r++){(b=o[r]).materialAttribute&&this.geometry.addAttribute(b.name,b.materialAttribute)}this.growthCount=Math.min(1,this.growthCount+1),e=1e3*Math.pow(10,this.growthCount),this.maxInstancedCount+=e,this.attributes=this.attributes||[];for(var c=0,d=this.attributes;c<d.length;c++){w=(b=d[c]).bufferAttribute,T=b.size||0;if(w.array instanceof Float32Array){(x=new Float32Array(this.maxInstancedCount*T)).set(w.array,0);var h=new i.InstancedBufferAttribute(x,T);h.setDynamic(!0),b.bufferAttribute=h,this.geometry.addAttribute(a.getAttributeShaderName(b),h);_=t.get(b.name),A=this.allBufferLocations[b.name]||[];this.allBufferLocations[b.name]=A;for(var f=0,p=A.length;f<p;++f)A[f].buffer.value=x;_||(_=[],t.set(b.name,_));for(S=n,E=this.maxInstancedCount;S<E;++S){M={attribute:b,buffer:{value:x},instanceIndex:S,range:[S*T,S*T+T]};_.push(M),A.push(M)}}}this.scene.container&&this.model&&this.scene.container.remove(this.model)}else{e=this.maxInstancedCount,this.geometry=new i.InstancedBufferGeometry;for(var v=0,g=this.layer.vertexAttributes;v<g.length;v++){(b=g[v]).materialAttribute&&this.geometry.addAttribute(b.name,b.materialAttribute)}this.attributes=[];for(var y=0,m=this.layer.instanceAttributes;y<m.length;y++){var b,w,_,T=(b=m[y]).size||0,x=new Float32Array(T*this.maxInstancedCount);(w=new i.InstancedBufferAttribute(x,T)).setDynamic(!0),this.geometry.addAttribute(a.getAttributeShaderName(b),w),(_=t.get(b.name))||(_=[],t.set(b.name,_));var A=this.allBufferLocations[b.name]||[];this.allBufferLocations[b.name]=A;for(var I=Object.assign({},b,{uid:u.uid(),bufferAttribute:w}),S=0;S<this.maxInstancedCount;++S){var M={attribute:I,buffer:{value:x},instanceIndex:S,range:[S*T,S*T+T]};_.push(M),A.push(M)}this.attributes.push(I)}this.geometry.maxInstancedCount=0,this.material=this.layer.material.clone();for(var S=0,E=this.layer.uniforms.length;S<E;++S){var O=this.layer.uniforms[S];O.materialUniforms.push(this.material.uniforms[O.name])}}return this.scene&&this.model&&this.scene.container&&this.scene.container.remove(this.model),this.scene&&this.scene.pickingContainer&&this.pickModel&&this.scene.pickingContainer.remove(this.pickModel),this.material=this.material||this.layer.material.clone(),this.model=l.generateLayerModel(this.layer,this.geometry,this.material),this.model.frustumCulled=!1,this.pickModel=this.layer.picking.type===s.PickType.SINGLE?this.model.clone():void 0,this.scene&&this.scene.container&&(this.scene.container.add(this.model),this.pickModel&&this.scene.pickingContainer.add(this.pickModel)),{growth:e,newLocations:t}},t.prototype.gatherLocationsIntoGroups=function(e,t){if(0!==this.attributeToPropertyIds.size){var n=[];this.attributeToPropertyIds.forEach(function(t,r){n.push({attribute:r,bufferLocationsForAttribute:e.get(r.name)||[],childBufferLocations:(r.childAttributes||[]).map(function(t){return e.get(t.name)||[]}),ids:t})});for(var r=0;r<t;++r){for(var i={instanceIndex:-1,propertyToBufferLocation:{}},o=function(e,t){var r=n[e],o=r.attribute,a=r.ids,s=r.bufferLocationsForAttribute;if(!s)return c.emitOnce("Instance Attribute Buffer Error",function(e,t){console.warn(t+": There is an error in forming buffer location groups in InstanceAttributeBufferManager. Error count: "+e)}),"continue";var u=s.shift();if(!u)return c.emitOnce("Instance Attribute Buffer Error",function(e,t){console.warn(t+": There is an error in forming buffer location groups in InstanceAttributeBufferManager. Error count: "+e)}),"continue";if(-1===i.instanceIndex)i.instanceIndex=u.instanceIndex;else if(u.instanceIndex!==i.instanceIndex)return c.emitOnce("Instance Attribute Parallelism Error",function(e,t){console.warn(t+": A buffer location does not have a matching instance index which means the buffer locations are not in parallel with each other somehow. Error count: "+e),console.warn(o.name,u)}),"continue";if(o.childAttributes){for(var l=[],d=function(e,t){var n=o.childAttributes[e],i=r.childBufferLocations[e];if(i){var a=i.shift();a?l.push(a):c.emitOnce("Instance Attribute Child Attribute Error",function(e,t){console.warn(t+": A child attribute does not have a buffer location available. Error count: "+e),console.warn("Parent Attribute: "+o.name+" Child Attribute: "+n.name)})}},h=0,f=o.childAttributes.length;h<f;++h)d(h);u.childLocations=l}for(h=0,f=a.length;h<f;++h){var p=a[h];i.propertyToBufferLocation[p]=u}},a=0,s=n.length;a<s;++a)o(a);this.availableLocations.push(i)}c.flushEmitOnce()}},t.prototype.getInstanceCount=function(){return this.maxInstancedCount},t}(d.BufferManagerBase);t.InstanceAttributeBufferManager=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(9),o=n(143),a=n(26),s=n(142),c=n(141),u=n(25),l=n(140),d=function(){function e(e,t){this.layer=e,this.bufferManager=t}return e.prototype.makeProcessor=function(){return this.processing?this.processing:(this.layer.bufferType===i.LayerBufferType.INSTANCE_ATTRIBUTE||this.layer.bufferType===i.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING?(this.layer.picking&&(this.layer.picking.type===r.PickType.SINGLE?this.processor=new o.InstanceAttributeColorDiffProcessor(this.layer,this.bufferManager):this.layer.picking.type===r.PickType.ALL&&(this.processor=new s.InstanceAttributeQuadDiffProcessor(this.layer,this.bufferManager))),this.processor||(this.processor=new a.InstanceAttributeDiffProcessor(this.layer,this.bufferManager))):(this.layer.picking&&(this.layer.picking.type===r.PickType.ALL?this.processor=new l.UniformQuadDiffProcessor(this.layer,this.bufferManager):this.layer.picking.type===r.PickType.SINGLE&&(this.processor=new c.UniformColorDiffProcessor(this.layer,this.bufferManager))),this.processor||(this.processor=new u.UniformDiffProcessor(this.layer,this.bufferManager))),this.processing=[this.processor.changeInstance,this.processor.addInstance,this.processor.removeInstance],this.processing)},e}();t.InstanceDiffManager=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(){this.cleanObservation=new Map,this.instanceChanges=new Map,this.allowChanges=!0,this.resolveContext=""}return Object.defineProperty(e.prototype,"changeList",{get:function(){return this.allowChanges=!1,Array.from(this.instanceChanges.values())},enumerable:!0,configurable:!0}),e.prototype.add=function(e){if(this.cleanObservation.get(e.uid))return e;if(this.allowChanges){e.observer=this;var t=e.observableDisposer;this.cleanObservation.set(e.uid,[e,t]),this.instanceChanges.set(e.uid,[e,r.InstanceDiffType.INSERT,e.changes])}return e},e.prototype.clear=function(){var e=this;this.cleanObservation.forEach(function(t){e.remove(t[0])})},e.prototype.destroy=function(){this.cleanObservation.forEach(function(e){e[1]()}),this.cleanObservation.clear(),this.instanceChanges.clear()},e.prototype.instanceUpdated=function(e){this.allowChanges&&this.instanceChanges.set(e.uid,[e,r.InstanceDiffType.CHANGE,e.changes])},e.prototype.remove=function(e){if(this.allowChanges){var t=this.cleanObservation.get(e.uid);t&&(t[1](),this.cleanObservation.delete(e.uid),this.instanceChanges.set(e.uid,[e,r.InstanceDiffType.REMOVE,{}]))}return!1},e.prototype.resolve=function(e){if(this.allowChanges=!0,this.instanceChanges.clear(),this.resolveContext&&this.resolveContext!==e)throw new Error("An instance provider has been issued to two layers. This is not a suppported feature yet and will cause issues.");this.resolveContext=e},e.prototype.sync=function(){var e=this,t=[];this.cleanObservation.forEach(function(n){var i=n[0];e.instanceChanges.set(i.uid,[i,r.InstanceDiffType.INSERT,t])})},e}();t.InstanceProvider=i},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(1),a=n(3),s=n(7),c=n(0),u=n(2);!function(e){e[e.NONE=0]="NONE",e[e.SCREEN_CURVE=1]="SCREEN_CURVE"}(i=t.ArcScaleType||(t.ArcScaleType={}));var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.initShader=function(){for(var e,r,o=this.props.scaleType,a=this.props.animate||{},s=a.angle,u=a.center,l=a.radius,d=a.thickness,h=a.colorStart,f=a.colorEnd,p=((e={0:1})[302]=-1,e),v=((r={0:0})[302]=1,r),g=1,y=0;y<300;++y)p[y+1]=g,v[y+1]=Math.floor(y/2)/149,g*=-1;var m=o===i.NONE?n(138):n(137);return{fs:n(136),instanceAttributes:[{easing:u,name:t.attributeNames.center,size:c.InstanceAttributeSize.TWO,update:function(e){return e.center}},{easing:l,name:t.attributeNames.radius,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.radius]}},{name:t.attributeNames.depth,size:c.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{easing:d,name:t.attributeNames.thickness,size:c.InstanceAttributeSize.TWO,update:function(e){return e.thickness}},{easing:s,name:t.attributeNames.angle,size:c.InstanceAttributeSize.TWO,update:function(e){return e.angle}},{easing:h,name:t.attributeNames.colorStart,size:c.InstanceAttributeSize.FOUR,update:function(e){return e.colorStart}},{easing:f,name:t.attributeNames.colorEnd,size:c.InstanceAttributeSize.FOUR,update:function(e){return e.colorEnd}}],uniforms:[{name:"scaleFactor",size:c.UniformSize.ONE,update:function(e){return[1]}}],vertexAttributes:[{name:"position",size:c.VertexAttributeSize.THREE,update:function(e){return[p[e],v[e],300]}}],vertexCount:302,vs:m}},t.prototype.getModelType=function(){return{drawMode:o.TriangleStripDrawMode,modelType:o.Mesh}},t.prototype.getMaterialOptions=function(){return Object.assign({},u.CommonMaterialOptions.transparentShape,{side:o.DoubleSide})},t.defaultProps={data:new a.InstanceProvider,key:"",scaleType:i.NONE,scene:"default"},t.attributeNames={angle:"angle",center:"center",colorEnd:"colorEnd",colorStart:"colorStart",depth:"depth",radius:"radius",thickness:"thickness"},t}(s.Layer);t.ArcLayer=l},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(149)),r(n(135))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(150)),r(n(134)),r(n(128)),r(n(46)),r(n(39)),r(n(107)),r(n(102)),r(n(8))},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),o=n(13),a=function(){function e(e,t,n,r,i){var o=e.mid;this.TL=new s(e.x,o[0],e.y,o[1],n,t),this.TR=new s(o[0],e.right,e.y,o[1],n,t),this.BL=new s(e.x,o[0],o[1],e.bottom,n,t),this.BR=new s(o[0],e.right,o[1],e.bottom,n,t),this.TL.childToNode=r,this.TR.childToNode=r,this.BL.childToNode=r,this.BR.childToNode=r,this.TL.childToBounds=i,this.TR.childToBounds=i,this.BL.childToBounds=i,this.BR.childToBounds=i}return e.prototype.destroy=function(){this.TL.destroy(),this.TR.destroy(),this.BL.destroy(),this.BR.destroy(),delete this.TL,delete this.TR,delete this.BL,delete this.BR},e}();t.Quadrants=a;var s=function(){function e(e,t,n,r,o,a){void 0===a&&(a=0),this.children=[],this.depth=0,this.nodes=null,arguments.length>=4?this.bounds=new i.Bounds({left:e,right:t,top:n,bottom:r}):this.bounds=new i.Bounds({left:0,right:1,top:1,bottom:0}),this.depth=a,this.getBounds=o,0===this.depth&&(this.nullBounded=[],this.childToNode=new Map,this.childToBounds=new Map)}return e.prototype.destroy=function(){delete this.children,delete this.bounds,this.nodes&&(this.nodes.destroy(),this.nodes=null)},e.prototype.add=function(e){var t=this.childToBounds.get(e);return t||(t=this.getBounds(e),this.childToBounds.set(e,t)),!t||t.isInside(this.bounds)?this.doAdd(e,t):(this.cover(t),this.add(e))},e.prototype.addAll=function(e){var t=this,n=Number.MAX_VALUE,r=Number.MAX_VALUE,o=-Number.MAX_VALUE,a=-Number.MAX_VALUE;e.forEach(function(e){var i=t.getBounds(e);t.childToBounds.set(e,i),i&&(i.x<n&&(n=i.x),i.right>o&&(o=i.right),i.bottom>a&&(a=i.bottom),i.y<r&&(r=i.y))}),n!==Number.MAX_VALUE&&r!==Number.MAX_VALUE&&o!==-Number.MAX_VALUE&&a!==-Number.MAX_VALUE&&this.cover(new i.Bounds({left:n,right:o,bottom:a,top:r})),e.forEach(function(e){return t.doAdd(e,t.childToBounds.get(e)||null,!0)})},e.prototype.cover=function(e){var t=this;if(!e.isInside(this.bounds)){this.bounds.encapsulate(e),this.bounds.x-=1,this.bounds.y-=1,this.bounds.width+=2,this.bounds.height+=2;var n=this.gatherChildren([]);this.children=[],this.nodes&&(this.nodes.destroy(),this.nodes=null),this.childToNode.clear(),n.forEach(function(e){return t.doAdd(e,t.childToBounds.get(e)||null)})}},e.prototype.doAdd=function(e,t,n){return t||0!==this.depth?t?this.nodes?t.isInside(this.nodes.TL.bounds)?this.nodes.TL.doAdd(e,t,n):t.isInside(this.nodes.TR.bounds)?this.nodes.TR.doAdd(e,t,n):t.isInside(this.nodes.BL.bounds)?this.nodes.BL.doAdd(e,t,n):t.isInside(this.nodes.BR.bounds)?this.nodes.BR.doAdd(e,t,n):(this.children.push(e),this.childToNode.set(e,this),!0):t.isInside(this.bounds)?(this.children.push(e),this.childToNode.set(e,this),this.children.length>5&&this.depth<10&&this.split(),!0):(isNaN(t.width+t.height+t.x+t.y)?console.error("Child did not fit into bounds because a dimension is NaN",e,t):0===t.area?console.error("Child did not fit into bounds because the area is zero",e,t):console.error("Child did not get insertted.","Parent:",this.bounds.toString(),"Child:",t.toString(),"Inside Checks:",t.x>=this.bounds.x,t.right<=this.bounds.right,t.y>=this.bounds.y,t.bottom<=this.bounds.bottom),!0):(console.warn("A null bounds was added to a Quad Tree node below the top node, which is invalid."),!1):(this.nullBounded.push(e),this.childToNode.set(e,this),!0)},e.prototype.doRemove=function(e){var t=this.children.indexOf(e);t>-1&&(this.children.splice(t,1),this.childToNode.delete(e),this.childToBounds.delete(e))},e.prototype.gatherChildren=function(e){return this.children.forEach(function(t){return e.push(t)}),this.nodes&&(this.nodes.TL.gatherChildren(e),this.nodes.TR.gatherChildren(e),this.nodes.BL.gatherChildren(e),this.nodes.BR.gatherChildren(e)),e},e.prototype.query=function(e,t){var n=[];return 0===this.depth&&(n=this.nullBounded.slice(0)),e instanceof i.Bounds&&e.hitBounds(this.bounds)?this.queryBounds(e,n,t):o.isVec2(e)&&this.bounds.containsPoint(e)?this.queryPoint(e,n,t):n},e.prototype.queryBounds=function(e,t,n){var r=this;return this.children.forEach(function(n){var i=r.childToBounds.get(n);i&&i.hitBounds(e)&&t.push(n)}),n&&n(this),this.nodes&&(e.hitBounds(this.nodes.TL.bounds)&&this.nodes.TL.queryBounds(e,t,n),e.hitBounds(this.nodes.TR.bounds)&&this.nodes.TR.queryBounds(e,t,n),e.hitBounds(this.nodes.BL.bounds)&&this.nodes.BL.queryBounds(e,t,n),e.hitBounds(this.nodes.BR.bounds)&&this.nodes.BR.queryBounds(e,t,n)),t},e.prototype.queryPoint=function(e,t,n){var r=this;return this.children.forEach(function(n){var i=r.childToBounds.get(n);i&&i.containsPoint(e)&&t.push(n)}),n&&n(this),this.nodes&&(this.nodes.TL.bounds.containsPoint(e)&&this.nodes.TL.queryPoint(e,t,n),this.nodes.TR.bounds.containsPoint(e)&&this.nodes.TR.queryPoint(e,t,n),this.nodes.BL.bounds.containsPoint(e)&&this.nodes.BL.queryPoint(e,t,n),this.nodes.BR.bounds.containsPoint(e)&&this.nodes.BR.queryPoint(e,t,n)),t},e.prototype.remove=function(e){if(this.childToNode){var t=this.childToNode.get(e);if(t&&0===t.depth){var n=t.nullBounded.indexOf(e);if(n>-1)return t.nullBounded.splice(n),this.childToNode.delete(e),void this.childToBounds.delete(e)}t&&t.doRemove(e)}},e.prototype.split=function(){var e=this.gatherChildren([]);this.nodes=new a(this.bounds,this.depth+1,this.getBounds,this.childToNode,this.childToBounds),this.children=[];for(var t=0,n=e.length;t<n;++t){var r=e[t];this.doAdd(r,this.childToBounds.get(r)||null,!0)}},e.prototype.visit=function(e){var t=Boolean(e(this));this.nodes&&!t&&(this.nodes.TL.visit(e),this.nodes.TR.visit(e),this.nodes.BL.visit(e),this.nodes.BR.visit(e))},e}();t.Node=s;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(s);t.TrackedQuadTree=c},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){var n=e.call(this)||this;return n.offsetFilter=function(e){return e},n.scaleFilter=function(e){return e},Object.assign(n,t),n}return r(t,e),Object.defineProperty(t.prototype,"offset",{get:function(){return this.offsetFilter(this.base.offset)},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.scaleFilter(this.base.scale)},set:function(e){},enumerable:!0,configurable:!0}),t}(n(30).ChartCamera);t.ReferenceCamera=i},function(e,t){var n=1e3,r=60*n,i=60*r,o=24*i,a=365.25*o;function s(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return s*a;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(e);if("number"===c&&!1===isNaN(e))return t.long?function(e){return s(e,o,"day")||s(e,i,"hour")||s(e,r,"minute")||s(e,n,"second")||e+" ms"}(e):function(e){if(e>=o)return Math.round(e/o)+"d";if(e>=i)return Math.round(e/i)+"h";if(e>=r)return Math.round(e/r)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){function r(e){var n;function r(){if(r.enabled){var e=r,i=+new Date,o=i-(n||i);e.diff=o,e.prev=n,e.curr=i,n=i;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var i=t.formatters[r];if("function"==typeof i){var o=a[c];n=i.call(e,o),a.splice(c,1),c--}return n}),t.formatArgs.call(e,a),(r.log||t.log||console.log.bind(console)).apply(e,a)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=i,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(154),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c,u=[],l=!1,d=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&f())}function f(){if(!l){var e=s(h);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||l||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(54);t.extendShaderInitialization=function(e,t){var n=r.extendShader(e,t.vs,t.fs);return{fs:n.fs,instanceAttributes:(e.instanceAttributes||[]).concat(t.instanceAttributes||[]),uniforms:(e.uniforms||[]).concat(t.uniforms||[]),vertexAttributes:(e.vertexAttributes||[]).concat(t.vertexAttributes||[]),vertexCount:e.vertexCount,vs:n.vs}}},function(e,t,n){"use strict";function r(e){return!isNaN(e)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.surface=e}return e.prototype.groupAnimation=function(e,t,n,i,o){var a=this.surface.frameMetrics.currentTime;this.surface.commit(a);for(var s=0;s<t;++s){var c=r(i)?i:i(s,e.delay);e.delay=n+c*s,o(s),this.surface.commit(a)}},e}();t.AnimationHelper=i},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(4),a=n(31),s=n(2);!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_MIDDLE=1]="TOP_MIDDLE",e[e.TOP_RIGHT=2]="TOP_RIGHT",e[e.MIDDLE_LEFT=3]="MIDDLE_LEFT",e[e.MIDDLE=4]="MIDDLE",e[e.MIDDLE_RIGHT=5]="MIDDLE_RIGHT",e[e.BOTTOM_LEFT=6]="BOTTOM_LEFT",e[e.BOTTOM_MIDDLE=7]="BOTTOM_MIDDLE",e[e.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(i=t.CameraBoundsAnchor||(t.CameraBoundsAnchor={}));var c=function(e){function t(t){var n=e.call(this)||this;return n.isPanning=!1,n.panFilter=function(e,t,n){return e},n.scaleFilter=function(e,t,n){return e},n.startViews=[],n.onRangeChanged=function(e,t){},n.startViewDidStart=!1,n.applyBounds=function(){if(n.bounds&&n.camera){var e=n.getView(n.bounds.view);n.applyScaleBounds(),e&&(n.camera.offset[0]=n.boundsHorizontalOffset(e,n.bounds),n.camera.offset[1]=n.boundsVerticalOffset(e,n.bounds))}},n.applyScaleBounds=function(){n.camera&&n.bounds&&(n.bounds.scaleMin&&n.camera.setScale(s.max3(n.camera.scale,n.bounds.scaleMin)),n.bounds.scaleMax&&n.camera.setScale(s.min3(n.camera.scale,n.bounds.scaleMax)))},t.bounds&&n.setBounds(t.bounds),n.camera=t.camera,n.scaleFactor=t.scaleFactor||1e3,n.ignoreCoverViews=t.ignoreCoverViews||!1,t.startView&&(n.startViews=Array.isArray(t.startView)?t.startView:[t.startView]),n.panFilter=t.panFilter||n.panFilter,n.scaleFilter=t.scaleFilter||n.scaleFilter,n.onRangeChanged=t.onRangeChanged||n.onRangeChanged,t.wheelShouldScroll&&(n.wheelShouldScroll=t.wheelShouldScroll),n}return r(t,e),t.prototype.anchoredByBoundsHorizontal=function(e,t){switch(t.anchor){case i.TOP_LEFT:case i.MIDDLE_LEFT:case i.BOTTOM_LEFT:return-(t.worldBounds.left-t.screenPadding.left/this.camera.scale[0]);case i.TOP_MIDDLE:case i.MIDDLE:case i.BOTTOM_MIDDLE:return-(t.worldBounds.right-t.worldBounds.width/2-(e.screenBounds.width+t.screenPadding.right)/this.camera.scale[0]*.5);case i.TOP_RIGHT:case i.MIDDLE_RIGHT:case i.BOTTOM_RIGHT:return-(t.worldBounds.right-(e.screenBounds.width-t.screenPadding.right)/this.camera.scale[0])}},t.prototype.anchoredByBoundsVertical=function(e,t){switch(t.anchor){case i.TOP_LEFT:case i.TOP_MIDDLE:case i.TOP_RIGHT:return-t.worldBounds.top- -t.screenPadding.top/this.scale[1];case i.MIDDLE_LEFT:case i.MIDDLE:case i.MIDDLE_RIGHT:return-(t.worldBounds.bottom-t.worldBounds.height/2)+.5*(e.screenBounds.height-t.screenPadding.bottom)/this.scale[1];case i.BOTTOM_LEFT:case i.BOTTOM_MIDDLE:case i.BOTTOM_RIGHT:return-(t.worldBounds.bottom-(e.screenBounds.height-t.screenPadding.bottom)/this.scale[1])}},t.prototype.boundsHorizontalOffset=function(e,t){var n=e.worldToScreen([t.worldBounds.left,t.worldBounds.top]),r=e.worldToScreen([t.worldBounds.right,t.worldBounds.bottom]);return r[0]-n[0]+t.screenPadding.left+t.screenPadding.right-e.screenBounds.width<0?this.anchoredByBoundsHorizontal(e,t):r[0]<e.screenBounds.right-t.screenPadding.right?-t.worldBounds.right+(e.screenBounds.width-t.screenPadding.right)/this.camera.scale[0]:n[0]>e.screenBounds.left+t.screenPadding.left?-t.worldBounds.left+t.screenPadding.left/this.camera.scale[0]:this.camera.offset[0]},t.prototype.boundsVerticalOffset=function(e,t){var n=e.worldToScreen([t.worldBounds.left,t.worldBounds.top]),r=e.worldToScreen([t.worldBounds.right,t.worldBounds.bottom]);return r[1]-n[1]+t.screenPadding.top+t.screenPadding.bottom-e.screenBounds.height<0?this.anchoredByBoundsVertical(e,t):n[1]>e.screenBounds.top-t.screenPadding.top?-(t.worldBounds.top-t.screenPadding.top/this.camera.scale[1]):r[1]<e.screenBounds.bottom+t.screenPadding.bottom?-(t.worldBounds.bottom+(-e.screenBounds.height+t.screenPadding.bottom)/this.camera.scale[1]):this.camera.offset[1]},t.prototype.canStart=function(e){return 0===this.startViews.length||this.startViews&&this.startViews.indexOf(e)>-1||this.startViewDidStart&&this.ignoreCoverViews},t.prototype.findCoveredStartView=function(e){var t=this,n=e.viewsUnderMouse.find(function(e){return t.startViews.indexOf(e.view.id)>-1});this.startViewDidStart=Boolean(n),n&&(this.coveredStartView=n.view)},t.prototype.getTargetView=function(e){return this.startViews&&!this.ignoreCoverViews?e.target.view:this.coveredStartView},t.prototype.handleMouseDown=function(e,t){this.startViews&&(this.findCoveredStartView(e),e.start&&(this.isPanning=this.canStart(e.start.view.id)||this.isPanning))},t.prototype.handleMouseUp=function(e){this.startViewDidStart=!1,this.isPanning=!1},t.prototype.doPan=function(e,t,n,r){var i=s.vec3(s.divide2(n,this.camera.scale),0);this.panFilter&&(i=this.panFilter(i,t,e.viewsUnderMouse.map(function(e){return e.view}))),r&&(this.camera.offset[0]+=i[0]),this.camera.offset[1]+=i[1],this.applyBounds(),e.start&&this.onRangeChanged(this.camera,e.start.view),this.applyBounds(),this.camera.update()},t.prototype.handleDrag=function(e,t){e.start&&this.canStart(e.start.view.id)&&this.doPan(e,e.start.view,t.screen.delta,!0)},t.prototype.handleWheel=function(e,t){if(this.findCoveredStartView(e),this.canStart(e.target.view.id))if(this.wheelShouldScroll){var n=this.getTargetView(e),r=this.camera.scale[0]||1,i=this.camera.scale[1]||1,o=[100*t.wheel[1]/this.scaleFactor*r,100*t.wheel[1]/this.scaleFactor*i];this.doPan(e,n,o,!1)}else{var a=(n=this.getTargetView(e)).screenToWorld(e.screen.mouse);r=this.camera.scale[0]||1,i=this.camera.scale[1]||1,o=[t.wheel[1]/this.scaleFactor*r,t.wheel[1]/this.scaleFactor*i,1];this.scaleFilter&&(o=this.scaleFilter(o,n,e.viewsUnderMouse.map(function(e){return e.view}))),this.camera.scale[0]=r+o[0],this.camera.scale[1]=i+o[1],this.applyScaleBounds();var c=n.screenToWorld(e.screen.mouse),u=s.subtract2(a,c);this.camera.offset[0]-=u[0],this.camera.offset[1]-=u[1],this.applyBounds(),this.onRangeChanged(this.camera,n),this.applyBounds(),this.camera.update()}},t.prototype.handleMouseOut=function(e){},t.prototype.handleClick=function(e){},t.prototype.handleMouseMove=function(e){},t.prototype.handleMouseOver=function(e){},t.prototype.getRange=function(e){var t=this.getProjection(e),n=this.getViewScreenBounds(e);if(t&&n){var r=t.screenToWorld([n.x,n.y]),i=t.screenToWorld([n.right,n.bottom]);return new o.Bounds({height:i[1]-r[1],width:i[0]-r[0],x:r[0],y:r[1]})}return new o.Bounds({x:0,y:0,width:1,height:1})},Object.defineProperty(t.prototype,"pan",{get:function(){return this.camera.offset},enumerable:!0,configurable:!0}),t.prototype.setBounds=function(e){this.wheelShouldScroll||(this.bounds=e,this.applyBounds())},Object.defineProperty(t.prototype,"scale",{get:function(){return this.camera.scale},enumerable:!0,configurable:!0}),t.prototype.setRange=function(e,t){console.warn("setRange");var n=this.getProjection(t),r=this.getViewScreenBounds(t),i=this.getView(t);if(n&&r&&i){var o=s.subtract3([r.width/e.width,r.height/e.height,1],this.camera.scale);this.camera.setScale(s.add3(this.camera.scale,this.scaleFilter(o,i,[i])));var a=s.subtract3([-e.x,-e.y,0],this.camera.offset);this.camera.setOffset(s.add3(this.camera.offset,this.scaleFilter(a,i,[i]))),this.applyBounds(),this.onRangeChanged(this.camera,i),this.applyBounds()}},t}(a.EventManager);t.BasicCameraController=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(160))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(161)),r(n(151)),r(n(3)),r(n(11)),r(n(97)),r(n(0)),r(n(2)),r(n(83))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(162))}])});
//# sourceMappingURL=index.js.map