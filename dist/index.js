!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["network-bubble-chart"]=t():e["network-bubble-chart"]=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=133)}([function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR"}(t.InstanceBlockIndex||(t.InstanceBlockIndex={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR",e[e.MAT4X4=16]="MAT4X4",e[e.ATLAS=99]="ATLAS"}(i=t.InstanceAttributeSize||(t.InstanceAttributeSize={})),t.instanceAttributeSizeFloatCount=((r={})[i.ONE]=1,r[i.TWO]=2,r[i.THREE]=3,r[i.FOUR]=4,r[i.MAT4X4]=16,r[i.ATLAS]=4,r),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR",e[e.MATRIX3=9]="MATRIX3",e[e.MATRIX4=16]="MATRIX4",e[e.FLOAT_ARRAY=97]="FLOAT_ARRAY",e[e.VEC4_ARRAY=98]="VEC4_ARRAY",e[e.TEXTURE=99]="TEXTURE"}(t.UniformSize||(t.UniformSize={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR"}(t.VertexAttributeSize||(t.VertexAttributeSize={})),function(e){e[e.SCREEN_256TH=-256]="SCREEN_256TH",e[e.SCREEN_128TH=-128]="SCREEN_128TH",e[e.SCREEN_64TH=-64]="SCREEN_64TH",e[e.SCREEN_32ND=-32]="SCREEN_32ND",e[e.SCREEN_16TH=-16]="SCREEN_16TH",e[e.SCREEN_8TH=-8]="SCREEN_8TH",e[e.SCREEN_QUARTER=-4]="SCREEN_QUARTER",e[e.SCREEN_HALF=-2]="SCREEN_HALF",e[e.SCREEN=-1]="SCREEN",e[e._2=2]="_2",e[e._4=4]="_4",e[e._8=8]="_8",e[e._16=16]="_16",e[e._32=32]="_32",e[e._64=64]="_64",e[e._128=128]="_128",e[e._256=256]="_256",e[e._512=512]="_512",e[e._1024=1024]="_1024",e[e._2048=2048]="_2048",e[e._4096=4096]="_4096"}(t.TextureSize||(t.TextureSize={})),function(e){e[e.ATLAS=0]="ATLAS",e[e.FONT=1]="FONT",e[e.TEXTURE=2]="TEXTURE",e[e.COLOR_BUFFER=3]="COLOR_BUFFER"}(t.ResourceType||(t.ResourceType={})),function(e){e[e.zyx=0]="zyx",e[e.zyz=1]="zyz",e[e.zxy=2]="zxy",e[e.zxz=3]="zxz",e[e.yxz=4]="yxz",e[e.yxy=5]="yxy",e[e.yzx=6]="yzx",e[e.yzy=7]="yzy",e[e.xyz=8]="xyz",e[e.xyx=9]="xyx",e[e.xzy=10]="xzy",e[e.xzx=11]="xzx"}(t.EulerOrder||(t.EulerOrder={})),t.isInstanceAttributeVector=function(e){return void 0!==e.size&&e.size<=4},t.isResourceAttribute=function(e){return Boolean(e&&e.resource)},function(e){e[e.VERTEX=1]="VERTEX",e[e.FRAGMENT=2]="FRAGMENT",e[e.ALL=3]="ALL"}(t.ShaderInjectionTarget||(t.ShaderInjectionTarget={})),t.NOOP=function(){},t.whiteSpaceRegEx=/\s/g,t.whiteSpaceCharRegEx=/\s/,t.isWhiteSpace=t.whiteSpaceCharRegEx.test.bind(t.whiteSpaceCharRegEx),t.newLineRegEx=/\n\r|\n|\r/g,t.newLineCharRegEx=/\n\r|\n|\r/,t.isNewline=t.newLineCharRegEx.test.bind(t.newLineCharRegEx),t.createMaterialOptions=function(e){return e},function(e){e[e.NONE=0]="NONE",e[e.SINGLE=1]="SINGLE"}(t.PickType||(t.PickType={})),function(e){e[e.CHANGE=0]="CHANGE",e[e.INSERT=1]="INSERT",e[e.REMOVE=2]="REMOVE"}(t.InstanceDiffType||(t.InstanceDiffType={})),function(e){e[e.NO_WEBGL_CONTEXT=0]="NO_WEBGL_CONTEXT"}(t.SurfaceErrorType||(t.SurfaceErrorType={})),function(e){e[e.UNIFORM=0]="UNIFORM",e[e.INSTANCE_ATTRIBUTE=1]="INSTANCE_ATTRIBUTE",e[e.INSTANCE_ATTRIBUTE_PACKING=2]="INSTANCE_ATTRIBUTE_PACKING"}(t.LayerBufferType||(t.LayerBufferType={})),function(e){e[e.LINEAR=0]="LINEAR"}(t.StreamChangeStrategy||(t.StreamChangeStrategy={})),t.isString=function(e){return void 0!==e&&void 0!==e.charCodeAt},t.isNumber=function(e){return void 0!==e&&void 0!==e.toExponential},t.isFunction=function(e){return void 0!==e&&void 0!==e.call&&void 0!==e.apply},t.isBoolean=function(e){return!0===e||!1===e},function(e){e[e.NONE=0]="NONE",e[e.BLANK=1]="BLANK",e[e.COLOR=2]="COLOR",e[e.DEPTH=3]="DEPTH",e[e.NORMAL=4]="NORMAL",e[e.PICKING=5]="PICKING",e[e.POSITION=6]="POSITION",e[e.POSITION_X=7]="POSITION_X",e[e.POSITION_Y=8]="POSITION_Y",e[e.POSITION_Z=9]="POSITION_Z",e[e.LIGHTS=10]="LIGHTS",e[e.LIGHTS2=11]="LIGHTS2",e[e.LIGHTS3=12]="LIGHTS3",e[e.ALPHA=13]="ALPHA",e[e.BETA=14]="BETA",e[e.GAMMA=15]="GAMMA",e[e.DELTA=16]="DELTA",e[e.ACCUMULATION1=17]="ACCUMULATION1",e[e.ACCUMULATION2=18]="ACCUMULATION2",e[e.ACCUMULATION3=19]="ACCUMULATION3",e[e.ACCUMULATION4=20]="ACCUMULATION4",e[e.COEFFICIENT1=21]="COEFFICIENT1",e[e.COEFFICIENT2=22]="COEFFICIENT2",e[e.COEFFICIENT3=23]="COEFFICIENT3",e[e.COEFFICIENT4=24]="COEFFICIENT4",e[e.ANGLE1=25]="ANGLE1",e[e.ANGLE2=26]="ANGLE2",e[e.ANGLE3=27]="ANGLE3",e[e.ANGLE4=28]="ANGLE4",e[e.COLOR2=29]="COLOR2",e[e.COLOR3=30]="COLOR3",e[e.COLOR4=31]="COLOR4",e[e.GLOW=32]="GLOW",e[e.BLUR=33]="BLUR"}(t.FragmentOutputType||(t.FragmentOutputType={}))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(20)),r(n(35)),r(n(11)),r(n(143))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Math.sqrt,i=Math.max,o=Math.min,a=Math.floor,s=Math.ceil,u=Math.abs,c=Math.acos,l=Math.sin;function h(e,t){return(e=e||[])[0]=t,e}function f(e,t,n){return h(n,e[0]+t[0])}function d(e,t){return h(t,s(e[0]))}function p(e,t){return e[0]===t[0]}function g(e,t){return h(t,e[0])}function v(){return[0]}function y(e,t,n){return h(n,0)}function m(e,t,n){return h(n,e[0]/t[0])}function b(e){return h(e,0)}function T(e,t){t=t||[];for(var n=0,r=e.length;n<r;++n)t.push(e[n][0]);return t}function _(e,t){return h(t,a(e[0]))}function x(e,t){return h(t,1/e[0])}function w(e,t,n){return h(n,e[0]*t)}function E(e,t,n){return h(n,e[0]-t[0])}function O(e,t,n){return h(n,i(e[0],t[0]))}function R(e,t,n){return h(n,o(e[0],t[0]))}function S(e,t,n){return h(n,e[0]*t[0])}function A(e,t){return h(t,1)}function M(e,t){return e[0]*t[0]}function I(e,t,n,r){return f(w(E(t,e),n),e,r)}function P(e){return e[0]}function L(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(n=n||[],(t=Array.isArray(e)?e.slice(0,1):[e]).length<1)for(var i=0,o=n.length;i<o&&t.length<1;++i){var a=n[i];Array.isArray(a)?t.push.apply(t,a.slice(0,1-t.length)):t.push(a)}for(;t.length<1;)t.push(0);return t}function C(e,t,n){return(e=e||new Array(2))[0]=t,e[1]=n,e}function B(e,t,n){return C(n,e[0]+t[0],e[1]+t[1])}function F(e,t){return C(t,s(e[0]),s(e[1]))}function D(e,t){return C(t,e[0],e[1])}function N(e){return C(e,1,0)}function U(e,t,n){return C(n,0,0)}function j(e,t){return e[0]===t[0]&&e[1]===t[1]}function G(e,t,n){return C(n,e[0]/t[0],e[1]/t[1])}function z(e){return C(e,0,0)}function k(e,t){t=t||new Array(2*e.length);for(var n=0,r=0,i=e.length;n<i;++n,r+=2){var o=e[n];t[r]=o[0],t[r+1]=o[1]}return t}function V(e,t){return C(t,a(e[0]),a(e[1]))}function W(e,t){return C(t,1/e[0],1/e[1])}function H(e,t,n){return C(n,i(e[0],t[0]),i(e[1],t[1]))}function q(e,t,n){return C(n,o(e[0],t[0]),o(e[1],t[1]))}function X(e,t,n){return C(n,e[0]*t,e[1]*t)}function Q(e,t,n){return C(n,e[0]-t[0],e[1]-t[1])}function Y(e,t,n){return C(n,e[0]*t[0],e[1]*t[1])}function K(e,t){var n=J(e);return C(t,e[0]/n,e[1]/n)}function $(e,t){return e[0]*t[0]+e[1]*t[1]}function Z(e,t,n,r){return B(X(Q(t,e),n),e,r)}function J(e){return ee(e[0],e[1])}function ee(e,t){return r(e*e+t*t)}function te(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(n=n||[],(t=Array.isArray(e)?e.slice(0,2):[e]).length<2)for(var i=0,o=n.length;i<o&&t.length<2;++i){var a=n[i];Array.isArray(a)?t.push.apply(t,a.slice(0,2-t.length)):t.push(a)}for(;t.length<2;)t.push(0);return t}function ne(e,t,n,r){return(e=e||new Array(3))[0]=t,e[1]=n,e[2]=r,e}function re(e,t,n){return ne(n,e[0]+t[0],e[1]+t[1],e[2]+t[2])}function ie(e,t){return ne(t,s(e[0]),s(e[1]),s(e[2]))}function oe(e,t){return ne(t,e[0],e[1],e[2])}function ae(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function se(e){return ne(e,0,0,-1)}function ue(e,t,n){return(n=n||new Array(3))[0]=e[1]*t[2]-e[2]*t[1],n[1]=e[2]*t[0]-e[0]*t[2],n[2]=e[0]*t[1]-e[1]*t[0],n}function ce(e,t,n){return ne(n,e[0]/t[0],e[1]/t[1],e[2]/t[2])}function le(e){return ne(e,0,0,0)}function he(e,t){t=t||new Array(3*e.length);for(var n=0,r=0,i=e.length;n<i;++n,r+=3){var o=e[n];t[r]=o[0],t[r+1]=o[1],t[r+2]=o[2]}return t}function fe(e,t){return ne(t,a(e[0]),a(e[1]),a(e[2]))}function de(e,t){return ne(t,1/e[0],1/e[1],1/e[2])}function pe(e,t,n){return ne(n,e[0]*t,e[1]*t,e[2]*t)}function ge(e,t,n){return ne(n,e[0]-t[0],e[1]-t[1],e[2]-t[2])}function ve(e,t,n){return ne(n,e[0]*t[0],e[1]*t[1],e[2]*t[2])}function ye(e,t,n,r){return re(pe(ge(t,e),n),e,r)}function me(e){return be(e[0],e[1],e[2])}function be(e,t,n){return r(e*e+t*t+n*n)}function Te(e,t,n){return ne(n,i(e[0],t[0]),i(e[1],t[1]),i(e[2],t[2]))}function _e(e,t,n){return ne(n,o(e[0],t[0]),o(e[1],t[1]),o(e[2],t[2]))}function xe(e,t){t=t||new Array(3);var n=me(e);return t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n,t}function we(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ee(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(n=n||[],(t=Array.isArray(e)?e.slice(0,3):[e]).length<3)for(var i=0,o=n.length;i<o&&t.length<3;++i){var a=n[i];Array.isArray(a)?t.push.apply(t,a.slice(0,3-t.length)):t.push(a)}for(;t.length<3;)t.push(0);return t}function Oe(e,t,n,r,i){return(e=e||new Array(4))[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function Re(e,t,n){return Oe(n,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3])}function Se(e,t){return Oe(t,s(e[0]),s(e[1]),s(e[2]),s(e[3]))}function Ae(e,t){return Oe(t,e[0],e[1],e[2],e[3])}function Me(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Ie(e){return Oe(e,0,0,-1,0)}function Pe(e,t,n){return Oe(n,0,0,0,1)}function Le(e,t,n){return Oe(n,e[0]/t[0],e[1]/t[1],e[2]/t[2],e[3]/t[3])}function Ce(e){return Oe(e,0,0,0,0)}function Be(e,t){t=t||new Array(4);for(var n=0,r=0,i=e.length;n<i;++n,r+=4){var o=e[n];t[r]=o[0],t[r+1]=o[1],t[r+2]=o[2],t[r+3]=o[3]}return t}function Fe(e,t){return Oe(t,a(e[0]),a(e[1]),a(e[2]),a(e[3]))}function De(e,t){return Oe(t,1/e[0],1/e[1],1/e[2],1/e[3])}function Ne(e,t,n){return Oe(n,e[0]*t,e[1]*t,e[2]*t,e[3]*t)}function Ue(e,t,n){return Oe(n,e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function je(e,t,n){return Oe(n,e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3])}function Ge(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function ze(e,t,n,r){return Re(Ne(Ue(t,e),n),e,r)}function ke(e){return Ve(e[0],e[1],e[2],e[3])}function Ve(e,t,n,i){return r(e*e+t*t+n*n+i*i)}function We(e,t,n){return Oe(n,i(e[0],t[0]),i(e[1],t[1]),i(e[2],t[2]),i(e[3],t[3]))}function He(e,t,n){return Oe(n,o(e[0],t[0]),o(e[1],t[1]),o(e[2],t[2]),o(e[3],t[3]))}function qe(e,t){var n=ke(e);return Oe(t,e[0]/n,e[1]/n,e[2]/n,e[3]/n)}function Xe(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(n=n||[],(t=Array.isArray(e)?e.slice(0,4):[e]).length<4)for(var i=0,o=n.length;i<o&&t.length<4;++i){var a=n[i];Array.isArray(a)?t.push.apply(t,a.slice(0,4-t.length)):t.push(a)}for(;t.length<4;)t.push(0);return t}function Qe(e,t,n,r){r=r||[0,0,0,0];var i,o,a,s,u,h=[0,0,0,0];return(o=e[1]*t[1]+e[2]*t[2]+e[3]*t[3]+e[0]*t[0])<0?(o=-o,h[0]=-t[0],h[1]=-t[1],h[2]=-t[2],h[3]=-t[3]):(h[0]=t[0],h[1]=t[1],h[2]=t[2],h[3]=t[3]),1-o>1e-7?(i=c(o),a=l(i),s=l((1-n)*i)/a,u=l(n*i)/a):(s=1-n,u=n),r[1]=s*e[1]+u*h[1],r[2]=s*e[2]+u*h[2],r[3]=s*e[3]+u*h[3],r[0]=s*e[0]+u*h[0],r}t.V3R=new Array(20).fill(0).map((function(e){return[0,0,0]})),t.V4R=new Array(20).fill(0).map((function(e){return[0,0,0,0]})),t.isVec1=function(e){return e&&Array.isArray(e)&&1===e.length},t.isVec2=function(e){return e&&Array.isArray(e)&&2===e.length},t.isVec3=function(e){return e&&Array.isArray(e)&&3===e.length},t.isVec4=function(e){return e&&Array.isArray(e)&&4===e.length},t.apply1=h,t.add1=f,t.ceil1=d,t.compare1=p,t.fuzzyCompare1=function(e,t,n){return u(e[0]-t[0])<=n},t.copy1=g,t.forward1=v,t.cross1=y,t.divide1=m,t.empty1=b,t.flatten1=T,t.floor1=_,t.inverse1=x,t.scale1=w,t.subtract1=E,t.max1=O,t.min1=R,t.multiply1=S,t.normalize1=A,t.dot1=M,t.linear1=I,t.length1=P,t.length1Components=function(e){return e},t.vec1=L,t.apply2=C,t.add2=B,t.ceil2=F,t.copy2=D,t.forward2=N,t.cross2=U,t.compare2=j,t.fuzzyCompare2=function(e,t,n){return u(e[0]-t[0])<=n&&u(e[1]-t[1])<=n},t.divide2=G,t.empty2=z,t.flatten2=k,t.floor2=V,t.inverse2=W,t.max2=H,t.min2=q,t.scale2=X,t.subtract2=Q,t.multiply2=Y,t.normalize2=K,t.dot2=$,t.linear2=Z,t.length2=J,t.length2Components=ee,t.vec2=te,t.apply3=ne,t.add3=re,t.ceil3=ie,t.copy3=oe,t.compare3=ae,t.fuzzyCompare3=function(e,t,n){return u(e[0]-t[0])<=n&&u(e[1]-t[1])<=n&&u(e[2]-t[2])<=n},t.forward3=se,t.cross3=ue,t.divide3=ce,t.empty3=le,t.flatten3=he,t.floor3=fe,t.inverse3=de,t.scale3=pe,t.subtract3=ge,t.multiply3=ve,t.linear3=ye,t.length3=me,t.length3Components=be,t.max3=Te,t.min3=_e,t.normalize3=xe,t.dot3=we,t.vec3=Ee,t.up3=function(e,t,n){return xe(ue(ue(e,t,n=n||[0,0,0]),e,n),n)},t.right3=function(e,t,n){return xe(ue(e,t,n=n||[0,0,0]),n)},t.left3=function(e,t,n){return xe(ue(t,e,n=n||[0,0,0]),n)},t.down3=function(e,t,n){return xe(ue(e,ue(e,t,n=n||[0,0,0]),n),n)},t.apply4=Oe,t.add4=Re,t.add4by3=function(e,t,n){return Oe(n,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3])},t.ceil4=Se,t.copy4=Ae,t.compare4=Me,t.fuzzyCompare4=function(e,t,n){return u(e[0]-t[0])<=n&&u(e[1]-t[1])<=n&&u(e[2]-t[2])<=n&&u(e[3]-t[3])<=n},t.forward4=Ie,t.cross4=Pe,t.divide4=Le,t.empty4=Ce,t.flatten4=Be,t.floor4=Fe,t.inverse4=De,t.scale4=Ne,t.subtract4=Ue,t.multiply4=je,t.dot4=Ge,t.linear4=ze,t.length4=ke,t.length4Components=Ve,t.max4=We,t.min4=He,t.normalize4=qe,t.vec4=Xe,t.color4FromHex3=function(e,t){return Oe(t=t||[0,0,0,0],((16711680&e)>>16)/255,((65280&e)>>8)/255,(255&e)/255,1)},t.color4FromHex4=function(e,t){return Oe(t=t||[0,0,0,0],((4278190080&e)>>24)/255,((16711680&e)>>16)/255,((65280&e)>>8)/255,(255&e)/255)},t.slerpQuat=Qe,t.vec1Methods={add:f,ceil:d,copy:g,compare:p,cross:y,divide:m,dot:M,empty:b,flatten:T,floor:_,forward:v,inverse:x,length:P,linear:I,max:O,min:R,multiply:S,normalize:A,scale:w,subtract:E,vec:L},t.vec2Methods={add:B,ceil:F,copy:D,compare:j,cross:U,divide:G,dot:$,empty:z,flatten:k,floor:V,forward:N,inverse:W,length:J,linear:Z,max:H,min:q,multiply:Y,normalize:K,scale:X,subtract:Q,vec:te},t.vec3Methods={add:re,ceil:ie,copy:oe,compare:ae,cross:ue,divide:ce,dot:we,empty:le,flatten:he,floor:fe,forward:se,inverse:de,length:me,linear:ye,max:Te,min:_e,multiply:ve,normalize:xe,scale:pe,subtract:ge,vec:Ee},t.vec4Methods={add:Re,ceil:Se,copy:Ae,compare:Me,cross:Pe,divide:Le,dot:Ge,empty:Ce,flatten:Be,floor:Fe,forward:Ie,inverse:De,length:ke,linear:ze,max:We,min:He,multiply:je,normalize:qe,scale:Ne,subtract:Ue,vec:Xe,slerpQuat:Qe},t.VecMath=function(e){return 1===e.length?t.vec1Methods:2===e.length?t.vec2Methods:3===e.length?t.vec3Methods:t.vec4Methods},t.toString1=function(e){return"["+e[0]+"]"},t.toString2=function(e){return"["+e[0]+", "+e[1]+"]"},t.toString3=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"},t.toString4=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(16)),r(n(55)),r(n(56)),r(n(62)),r(n(168)),r(n(28)),r(n(95)),r(n(29)),r(n(96)),r(n(61)),r(n(38)),r(n(79)),r(n(8)),r(n(169)),r(n(101)),r(n(170)),r(n(57)),r(n(18)),r(n(102)),r(n(103))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(137)),r(n(138)),r(n(44)),r(n(68)),r(n(10)),r(n(71)),r(n(141)),r(n(142)),r(n(45)),r(n(72)),r(n(15)),r(n(26)),r(n(73)),r(n(14))},function(e,t,n){(function(r){function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(139)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))})),e.splice(o,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(70))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.baseShaderModules=function(t){var n=e.prototype.baseShaderModules.call(this,t);return n.vs.push("world2D"),n},t}(n(13).Layer);t.Layer2D=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Math.min,i=Math.max,o=function(){function e(e){this.x=0,this.y=0,this.width=0,this.height=0,this.x=e.x||e.left||0,this.y=e.y||e.top||0,this.height=e.height||(e.bottom||0)-this.y||0,this.width=e.width||(e.right||0)-this.x||0}return Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mid",{get:function(){return[this.x+this.width/2,this.y+this.height/2]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),e.emptyBounds=function(){return new e({height:0,width:0,x:0,y:0})},e.prototype.containsPoint=function(e){return!(e[0]<this.x||e[1]<this.y||e[0]>this.right||e[1]>this.bottom)},e.prototype.encapsulate=function(t){return t instanceof e?(t.x<this.x&&(this.width+=Math.abs(t.x-this.x),this.x=t.x),t.y<this.y&&(this.height+=Math.abs(t.y-this.y),this.y=t.y),this.right<t.right&&(this.width+=t.right-this.right),this.bottom<t.bottom&&(this.height+=t.bottom-this.bottom),!0):(t[0]<this.x&&(this.width+=this.x-t[0],this.x=t[0]),t[0]>this.right&&(this.width+=t[0]-this.x),t[1]<this.y&&(this.height+=this.y-t[1],this.y=t[1]),t[1]>this.bottom&&(this.height+=t[1]-this.y),!0)},e.prototype.encapsulateAll=function(t){if(!(t.length<=0)){var n=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;if(t[0]instanceof e)for(var u=t,c=0,l=u.length;c<l;++c){var h=u[c];n=r(n,h.left),o=i(o,h.right),a=r(a,h.top),s=i(s,h.bottom)}else{var f=t;for(c=0,l=f.length;c<l;++c){var d=f[c],p=d[0],g=d[1];n=r(n,p),o=i(o,p),a=r(a,g),s=i(s,g)}}this.x=Math.min(this.x,n),this.y=Math.min(this.y,a),this.width=Math.max(this.width,o-n),this.height=Math.max(this.height,s-a)}},e.prototype.fits=function(e){return this.width===e.width&&this.height===e.height?1:this.width>=e.width&&this.height>=e.height?2:0},e.prototype.hitBounds=function(e){return!(this.right<e.x||this.x>e.right||this.bottom<e.y||this.y>e.bottom)},e.prototype.isInside=function(e){return this.x>=e.x&&this.right<=e.right&&this.y>=e.y&&this.bottom<=e.bottom},Object.defineProperty(e.prototype,"location",{get:function(){return[this.x,this.y]},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"{x: "+this.x+" y:"+this.y+" w:"+this.width+" h:"+this.height+"}"},e}();t.Bounds=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=1;t.uid=function(){return++r};var i=0;t.colorUID=function(){return++i%16777215}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(87)),r(n(84)),r(n(83)),r(n(81)),r(n(82)),r(n(98))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){!function(e){!function(e){e[e.RGBA4=0]="RGBA4",e[e.RGB565=1]="RGB565",e[e.RGB5_A1=2]="RGB5_A1",e[e.R8=3]="R8",e[e.R8UI=4]="R8UI",e[e.R8I=5]="R8I",e[e.R16UI=6]="R16UI",e[e.R16I=7]="R16I",e[e.R32UI=8]="R32UI",e[e.R32I=9]="R32I",e[e.RG8=10]="RG8",e[e.RG8UI=11]="RG8UI",e[e.RG8I=12]="RG8I",e[e.RG16UI=13]="RG16UI",e[e.RG16I=14]="RG16I",e[e.RG32UI=15]="RG32UI",e[e.RG32I=16]="RG32I",e[e.RGB8=17]="RGB8",e[e.RGBA8=18]="RGBA8",e[e.SRGB8_ALPHA8=19]="SRGB8_ALPHA8",e[e.RGB10_A2=20]="RGB10_A2",e[e.RGBA8UI=21]="RGBA8UI",e[e.RGBA8I=22]="RGBA8I",e[e.RGB10_A2UI=23]="RGB10_A2UI",e[e.RGBA16UI=24]="RGBA16UI",e[e.RGBA16I=25]="RGBA16I",e[e.RGBA32I=26]="RGBA32I",e[e.RGBA32UI=27]="RGBA32UI"}(e.ColorBufferFormat||(e.ColorBufferFormat={})),function(e){e[e.DEPTH_COMPONENT16=0]="DEPTH_COMPONENT16",e[e.DEPTH_STENCIL=1]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=2]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=3]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=4]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=5]="DEPTH32F_STENCIL8"}(e.DepthBufferFormat||(e.DepthBufferFormat={})),function(e){e[e.STENCIL_INDEX8=0]="STENCIL_INDEX8"}(e.StencilBufferFormat||(e.StencilBufferFormat={}))}(e.RenderTarget||(e.RenderTarget={})),function(e){!function(e){e[e.NoBlending=-1]="NoBlending",e[e.NormalBlending=1]="NormalBlending",e[e.AdditiveBlending=2]="AdditiveBlending",e[e.SubtractiveBlending=3]="SubtractiveBlending",e[e.MultiplyBlending=4]="MultiplyBlending"}(e.Blending||(e.Blending={})),function(e){e[e.Zero=-1]="Zero",e[e.One=1]="One",e[e.SrcColor=2]="SrcColor",e[e.OneMinusSrcColor=3]="OneMinusSrcColor",e[e.SrcAlpha=4]="SrcAlpha",e[e.OneMinusSrcAlpha=5]="OneMinusSrcAlpha",e[e.DstAlpha=6]="DstAlpha",e[e.OneMinusDstAlpha=7]="OneMinusDstAlpha",e[e.DstColor=8]="DstColor",e[e.OneMinusDstColor=9]="OneMinusDstColor"}(e.BlendingDstFactor||(e.BlendingDstFactor={})),function(e){e[e.Zero=-1]="Zero",e[e.One=1]="One",e[e.SrcColor=2]="SrcColor",e[e.OneMinusSrcColor=3]="OneMinusSrcColor",e[e.SrcAlpha=4]="SrcAlpha",e[e.OneMinusSrcAlpha=5]="OneMinusSrcAlpha",e[e.DstAlpha=6]="DstAlpha",e[e.OneMinusDstAlpha=7]="OneMinusDstAlpha",e[e.DstColor=8]="DstColor",e[e.OneMinusDstColor=9]="OneMinusDstColor",e[e.SrcAlphaSaturate=10]="SrcAlphaSaturate"}(e.BlendingSrcFactor||(e.BlendingSrcFactor={})),function(e){e[e.Add=-1]="Add",e[e.Subtract=1]="Subtract",e[e.ReverseSubtract=2]="ReverseSubtract"}(e.BlendingEquations||(e.BlendingEquations={})),function(e){e[e.NEVER=-1]="NEVER",e[e.LESS=1]="LESS",e[e.EQUAL=2]="EQUAL",e[e.LESS_OR_EQUAL=3]="LESS_OR_EQUAL",e[e.GREATER=4]="GREATER",e[e.NOTEQUAL=5]="NOTEQUAL",e[e.GREATER_OR_EQUAL=6]="GREATER_OR_EQUAL",e[e.ALWAYS=7]="ALWAYS"}(e.DepthFunctions||(e.DepthFunctions={})),function(e){e[e.NONE=-1]="NONE",e[e.CW=1]="CW",e[e.CCW=2]="CCW",e[e.BOTH=3]="BOTH"}(e.CullSide||(e.CullSide={}))}(e.Material||(e.Material={})),function(e){!function(e){e[e.LINE_LOOP=0]="LINE_LOOP",e[e.LINE_STRIP=1]="LINE_STRIP",e[e.LINES=2]="LINES",e[e.POINTS=3]="POINTS",e[e.TRIANGLE_FAN=4]="TRIANGLE_FAN",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLES=6]="TRIANGLES"}(e.DrawMode||(e.DrawMode={}))}(e.Model||(e.Model={})),function(e){!function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.CUBE_MAP=1]="CUBE_MAP"}(e.TextureBindingTarget||(e.TextureBindingTarget={})),function(e){e[e.REPEAT=-1]="REPEAT",e[e.CLAMP_TO_EDGE=1]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"}(e.Wrapping||(e.Wrapping={})),function(e){e[e.Nearest=-1]="Nearest",e[e.NearestMipMapNearest=1]="NearestMipMapNearest",e[e.NearestMipMapLinear=2]="NearestMipMapLinear",e[e.Linear=3]="Linear",e[e.LinearMipMapNearest=4]="LinearMipMapNearest",e[e.LinearMipMapLinear=5]="LinearMipMapLinear"}(e.TextureMinFilter||(e.TextureMinFilter={})),function(e){e[e.Nearest=-1]="Nearest",e[e.Linear=1]="Linear"}(e.TextureMagFilter||(e.TextureMagFilter={})),function(e){e[e.UnsignedByte=-1]="UnsignedByte",e[e.UnsignedShort_5_6_5=1]="UnsignedShort_5_6_5",e[e.UnsignedShort_4_4_4_4=2]="UnsignedShort_4_4_4_4",e[e.UnsignedShort_5_5_5_1=3]="UnsignedShort_5_5_5_1",e[e.UnsignedShort=4]="UnsignedShort",e[e.UnsignedInt=5]="UnsignedInt",e[e.UnsignedInt_24_8=6]="UnsignedInt_24_8",e[e.Byte=7]="Byte",e[e.Short=8]="Short",e[e.Int=9]="Int",e[e.Float=10]="Float",e[e.HalfFloat=11]="HalfFloat",e[e.UnsignedInt_2_10_10_10_REV=12]="UnsignedInt_2_10_10_10_REV",e[e.UnsignedInt_10F_11F_11F_REV=13]="UnsignedInt_10F_11F_11F_REV",e[e.UnsignedInt_5_9_9_9_REV=14]="UnsignedInt_5_9_9_9_REV",e[e.Float32UnsignedInt_24_8_REV=15]="Float32UnsignedInt_24_8_REV"}(e.SourcePixelFormat||(e.SourcePixelFormat={})),function(e){e[e.Alpha=-1]="Alpha",e[e.DepthComponent=1]="DepthComponent",e[e.DepthStencil=2]="DepthStencil",e[e.Luminance=3]="Luminance",e[e.LuminanceAlpha=4]="LuminanceAlpha",e[e.RGB=5]="RGB",e[e.RGBA=6]="RGBA",e[e.RGBE=7]="RGBE",e[e.R8=8]="R8",e[e.R16F=9]="R16F",e[e.R32F=10]="R32F",e[e.R8UI=11]="R8UI",e[e.RG8=12]="RG8",e[e.RG16F=13]="RG16F",e[e.RG32F=14]="RG32F",e[e.RG8UI=15]="RG8UI",e[e.RG16UI=16]="RG16UI",e[e.RG32UI=17]="RG32UI",e[e.RGB8=18]="RGB8",e[e.SRGB8=19]="SRGB8",e[e.RGB565=20]="RGB565",e[e.R11F_G11F_B10F=21]="R11F_G11F_B10F",e[e.RGB9_E5=22]="RGB9_E5",e[e.RGB16F=23]="RGB16F",e[e.RGB32F=24]="RGB32F",e[e.RGB8UI=25]="RGB8UI",e[e.RGBA8=26]="RGBA8",e[e.SRGB8_ALPHA8=27]="SRGB8_ALPHA8",e[e.RGB5_A1=28]="RGB5_A1",e[e.RGB10_A2=29]="RGB10_A2",e[e.RGBA4=30]="RGBA4",e[e.RGBA16F=31]="RGBA16F",e[e.RGBA32F=32]="RGBA32F",e[e.RGBA8UI=33]="RGBA8UI",e[e.DEPTH_COMPONENT16=34]="DEPTH_COMPONENT16",e[e.DEPTH_COMPONENT24=35]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36]="DEPTH_COMPONENT32F",e[e.RGBA32UI=37]="RGBA32UI",e[e.RGB32UI=38]="RGB32UI",e[e.RGBA16UI=39]="RGBA16UI",e[e.RGB16UI=40]="RGB16UI",e[e.RGBA32I=41]="RGBA32I",e[e.RGB32I=42]="RGB32I",e[e.RGBA16I=43]="RGBA16I",e[e.RGB16I=44]="RGB16I",e[e.RGBA8I=45]="RGBA8I",e[e.RGB8I=46]="RGB8I",e[e.RED_INTEGER=47]="RED_INTEGER",e[e.RG_INTEGER=48]="RG_INTEGER",e[e.RGB_INTEGER=49]="RGB_INTEGER",e[e.RGBA_INTEGER=50]="RGBA_INTEGER"}(e.TexelDataType||(e.TexelDataType={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.FOUR=4]="FOUR",e[e.EIGHT=8]="EIGHT"}(e.PackAlignment||(e.PackAlignment={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.FOUR=4]="FOUR",e[e.EIGHT=8]="EIGHT"}(e.UnpackAlignment||(e.UnpackAlignment={}))}(e.Texture||(e.Texture={})),function(e){!function(e){e[e.ALPHA=0]="ALPHA",e[e.RGB=1]="RGB",e[e.RGBA=2]="RGBA"}(e.ReadFilter||(e.ReadFilter={})),function(e){e[e.UNSIGNED_BYTE=0]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT_5_6_5=1]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=2]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=3]="UNSIGNED_SHORT_5_5_5_1",e[e.FLOAT=4]="FLOAT"}(e.ReadTargetArrayFormat||(e.ReadTargetArrayFormat={}))}(e.Renderer||(e.Renderer={}))}(t.GLSettings||(t.GLSettings={}))},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var i=n(75),o=n(20),a=0,s=function(){function e(t){this.changes={},this.observableStorage=[],this._uid=e.newUID,this.reactivate=!1,t&&(this.active=t.active||this.active)}return Object.defineProperty(e,"newUID",{get:function(){return a=++a%16777215},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"active",{get:function(){return this._active},set:function(e){this._active=e,this.reactivate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"observableDisposer",{get:function(){var e=this;return function(){return delete e._observer}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"observer",{get:function(){return this._observer||null},set:function(e){var t=this._observer;t&&t!==e&&(this.easing&&this.easing.clear(),t.remove(this)),this._observer=e},enumerable:!0,configurable:!0}),e.prototype.getEasing=function(e){if(this.easingId){var t=this.easingId["_"+e+"_end"];if(t&&this.easing){var n=this.easing.get(t);if(n instanceof i.EasingProps)return n}}},Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),e.prototype.resourceTrigger=function(){console.warn("resourceTrigger called on an instance that did not override resourceTrigger. resourceTrigger MUST be overridden for instances","that utilize a resource. The observable that is tied to committing the resource should be 'triggered' in this method.")},r([o.observable],e.prototype,"_active",void 0),r([o.observable],e.prototype,"_uid",void 0),e}();t.Instance=s},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0}),r(n(52)),r(n(47)),r(n(36)),r(n(77)),r(n(2)),r(n(46)),r(n(78));var o=i(n(36)),a=i(n(77)),s=i(n(78)),u=i(n(2));t.MatrixMath=o,t.QuaternionMath=a,t.RayMath=s,t.VectorMath=u},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(94)),r(n(60)),r(n(37)),r(n(166)),r(n(27)),r(n(85)),r(n(180)),r(n(58)),r(n(181))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProgramInfo=function(e,t){for(var n={attributeCount:0,attributes:new Array,uniformCount:0,uniforms:new Array},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o={35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT"},a={35664:1,35665:1,35666:1,35667:1,35668:1,35669:1,35670:1,35671:1,35672:1,35673:1,35674:1,35675:3,35676:4,35678:1,35680:1,5120:1,5121:1,5122:1,5123:1,5124:1,5125:1,5126:1},s=0;s<r;++s){var u=e.getActiveUniform(t,s);u.typeName=o[u.type],n.uniforms.push(u),n.uniformCount+=u.size,u.size=u.size*a[u.type]}for(s=0;s<i;s++){var c=e.getActiveAttrib(t,s);c.typeName=o[c.type],n.attributes.push(c),n.attributeCount+=c.size}return n};var r=function(){function e(){}return e.print=function(){return Object.assign({},e)},e.VAO=!1,e.DEPTH_TEXTURE=!1,e.MAX_VERTEX_UNIFORMS=0,e.MAX_FRAGMENT_UNIFORMS=0,e.MAX_VERTEX_ATTRIBUTES=0,e.WEBGL_SUPPORTED=!1,e.MAX_TEXTURE_SIZE=0,e.HARDWARE_INSTANCING=!1,e.MRT_EXTENSION=!1,e.MRT=!1,e.MAX_COLOR_ATTACHMENTS=0,e.SHADERS_3_0=!1,e.WEBGL_VERSION="none",e.FLOAT_TEXTURE_READ={half:!1,full:!1,halfLinearFilter:!1,fullLinearFilter:!1},e.FLOAT_TEXTURE_WRITE={half:!1,full:!1},e}();t.WebGLStat=r,function(){var e=function(){try{var e=document.createElement("canvas"),t=void 0;return(t=e.getContext("webgl2"))?(r.WEBGL_VERSION="webgl2",t):(t=e.getContext("webgl"))?(r.WEBGL_VERSION="webgl",t):(t=e.getContext("experimental-webgl"))?(r.WEBGL_VERSION="experimental-webgl",t):null}catch(e){return null}}();if(e)if(r.WEBGL_SUPPORTED=!0,r.MAX_VERTEX_UNIFORMS=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),r.MAX_FRAGMENT_UNIFORMS=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),r.MAX_VERTEX_ATTRIBUTES=e.getParameter(e.MAX_VERTEX_ATTRIBS),r.MAX_TEXTURE_SIZE=e.getParameter(e.MAX_TEXTURE_SIZE),function(e){r.FLOAT_TEXTURE_READ.fullLinearFilter=Boolean(e.getExtension("OES_texture_float_linear")),r.FLOAT_TEXTURE_READ.halfLinearFilter=Boolean(e.getExtension("OES_texture_half_float_linear"));var t=e.createTexture();if(e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.getError()!==e.NO_ERROR)throw new Error("WebGLStat could not create a texture");var n=e.getExtension("OES_texture_float")||e.getExtension("EXT_color_buffer_float");if(e.getExtension("WEBGL_color_buffer_float"),n){var i=2,o=2;e.texImage2D(e.TEXTURE_2D,0,e instanceof WebGL2RenderingContext?e.RGBA32F:e.RGBA,i,o,0,e.RGBA,e.FLOAT,null),e.getError()===e.NO_ERROR&&(r.FLOAT_TEXTURE_READ.full=!0);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),e.bindTexture(e.TEXTURE_2D,null),e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&(r.FLOAT_TEXTURE_WRITE.full=!0),e.deleteFramebuffer(a),e.deleteTexture(t)}var s=e.createTexture();if(e.bindTexture(e.TEXTURE_2D,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.getError()!==e.NO_ERROR)throw new Error("WebGLStat could not create a texture");var u=e.getExtension("OES_texture_half_float")||e.getExtension("EXT_color_buffer_float");if(u){i=2,o=2;e.texImage2D(e.TEXTURE_2D,0,e instanceof WebGL2RenderingContext?e.RGBA16F:e.RGBA,i,o,0,e.RGBA,e instanceof WebGL2RenderingContext?e.HALF_FLOAT:u.HALF_FLOAT_OES,null),e.getError()===e.NO_ERROR&&(r.FLOAT_TEXTURE_READ.full=!0);a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0),e.bindTexture(e.TEXTURE_2D,null),e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&(r.FLOAT_TEXTURE_WRITE.full=!0),e.deleteFramebuffer(a),e.deleteTexture(s)}}(e),e instanceof WebGL2RenderingContext)r.VAO=!0,r.MRT=!0,r.HARDWARE_INSTANCING=!0,r.SHADERS_3_0=!0,r.HARDWARE_INSTANCING=!0,r.DEPTH_TEXTURE=!0,r.MAX_COLOR_ATTACHMENTS=e.getParameter(e.MAX_COLOR_ATTACHMENTS);else{r.VAO=Boolean(e.getExtension("OES_vertex_array_object")),r.HARDWARE_INSTANCING=Boolean(e.getExtension("ANGLE_instanced_arrays"));var t=e.getExtension("WEBGL_draw_buffers");r.MRT_EXTENSION=Boolean(t),r.MRT=Boolean(t),r.DEPTH_TEXTURE=Boolean(e.getExtension("WEBGL_depth_texture")),t&&(r.MAX_COLOR_ATTACHMENTS=e.getParameter(t.MAX_COLOR_ATTACHMENTS_WEBGL))}window.WebGLStat=r}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=n(10),o=function(){function e(e){this._uid=r.uid(),this._destroyed=!1,this._flipY=!1,this._format=i.GLSettings.Texture.TexelDataType.RGBA,this._generateMipmaps=!1,this._internalFormat=i.GLSettings.Texture.TexelDataType.RGBA,this._magFilter=i.GLSettings.Texture.TextureMagFilter.Linear,this._minFilter=i.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear,this.needsDataUpload=!1,this.needsPartialDataUpload=!1,this.needsSettingsUpdate=!1,this._packAlignment=i.GLSettings.Texture.PackAlignment.FOUR,this._premultiplyAlpha=!1,this._type=i.GLSettings.Texture.SourcePixelFormat.UnsignedByte,this._unpackAlignment=i.GLSettings.Texture.UnpackAlignment.FOUR,this._updateRegions=[],this._wrapHorizontal=i.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE,this._wrapVertical=i.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE,this.anisotropy=e.anisotropy||this.anisotropy,this.data=e.data||this.data,this.flipY=e.flipY||this.flipY,this.format=e.format||this.format,this.internalFormat=e.internalFormat||this.format,this.generateMipMaps=e.generateMipMaps||this.generateMipMaps,this.magFilter=e.magFilter||this.magFilter,this.minFilter=e.minFilter||this.minFilter,this.packAlignment=e.packAlignment||this.packAlignment,this.premultiplyAlpha=e.premultiplyAlpha||this.premultiplyAlpha,this.type=e.type||this.type,this.unpackAlignment=e.unpackAlignment||this.unpackAlignment,this.wrapHorizontal=e.wrapHorizontal||this.wrapHorizontal,this.wrapVertical=e.wrapVertical||this.wrapVertical}return Object.defineProperty(e,"emptyTexture",{get:function(){return a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anisotropy",{get:function(){return this._anisotropy},set:function(e){this.needsSettingsUpdate=!0,this._anisotropy=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this.needsDataUpload=!0,this._data=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flipY",{get:function(){return this._flipY},set:function(e){this.needsDataUpload=!0,this._flipY=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"format",{get:function(){return this._format},set:function(e){this.needsDataUpload=!0,this._format=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"generateMipMaps",{get:function(){return this._generateMipmaps},set:function(e){this.needsSettingsUpdate=!0,this._generateMipmaps=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"internalFormat",{get:function(){return this._internalFormat},set:function(e){this.needsDataUpload=!0,this._internalFormat=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"magFilter",{get:function(){return this._magFilter},set:function(e){this.needsSettingsUpdate=!0,this._magFilter=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minFilter",{get:function(){return this._minFilter},set:function(e){this.needsSettingsUpdate=!0,this._minFilter=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"packAlignment",{get:function(){return this._packAlignment},set:function(e){this.needsSettingsUpdate=!0,this._packAlignment=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"premultiplyAlpha",{get:function(){return this._premultiplyAlpha},set:function(e){this.needsSettingsUpdate=!0,this._premultiplyAlpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){this.needsDataUpload=!0,this._type=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unpackAlignment",{get:function(){return this._unpackAlignment},set:function(e){this.needsSettingsUpdate=!0,this._unpackAlignment=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updateRegions",{get:function(){return this._updateRegions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wrapHorizontal",{get:function(){return this._wrapHorizontal},set:function(e){this.needsSettingsUpdate=!0,this._wrapHorizontal=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wrapVertical",{get:function(){return this._wrapVertical},set:function(e){this.needsSettingsUpdate=!0,this._wrapVertical=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isHalfFloatTexture",{get:function(){switch(this._internalFormat){case i.GLSettings.Texture.TexelDataType.R16F:case i.GLSettings.Texture.TexelDataType.RG16F:case i.GLSettings.Texture.TexelDataType.RGB16F:return!0}switch(this._type){case i.GLSettings.Texture.SourcePixelFormat.HalfFloat:return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFloatTexture",{get:function(){switch(this._internalFormat){case i.GLSettings.Texture.TexelDataType.R11F_G11F_B10F:case i.GLSettings.Texture.TexelDataType.R16F:case i.GLSettings.Texture.TexelDataType.RG16F:case i.GLSettings.Texture.TexelDataType.R32F:case i.GLSettings.Texture.TexelDataType.RG32F:case i.GLSettings.Texture.TexelDataType.RGB16F:case i.GLSettings.Texture.TexelDataType.RGB32F:return!0}switch(this._type){case i.GLSettings.Texture.SourcePixelFormat.Float:case i.GLSettings.Texture.SourcePixelFormat.HalfFloat:return!0}return!1},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.gl&&this.gl.proxy.disposeTexture(this),this._destroyed=!0,delete this._data},e.prototype.resolve=function(){this.needsDataUpload=!1,this.needsPartialDataUpload=!1,this.needsSettingsUpdate=!1,this._updateRegions=[]},e.prototype.update=function(e,t){this.needsPartialDataUpload=!0,this._updateRegions.push([e,t])},e}();t.Texture=o;var a=new o({data:{width:2,height:2,buffer:new Uint8Array(16)}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(51),o=n(36),a=n(2),s=n(79),u=n(8);function c(e){return e.projectionOptions.type===r.ORTHOGRAPHIC&&"left"in e.projectionOptions}function l(e){return e.projectionOptions.type===r.PERSPECTIVE&&"fov"in e.projectionOptions}!function(e){e[e.PERSPECTIVE=0]="PERSPECTIVE",e[e.ORTHOGRAPHIC=1]="ORTHOGRAPHIC"}(r=t.CameraProjectionType||(t.CameraProjectionType={})),t.isOrthographic=c,t.isPerspective=l;var h=function(){function e(e){this._id=u.uid(),this.animationEndTime=0,this.needsViewDrawn=!0,this.needsBroadcast=!1,this.viewChangeViewId="",this.transform=new i.Transform,this._projection=o.identity4(),this._needsUpdate=!0,this._viewProjection=o.identity4(),this._projectionOptions=e,this._needsUpdate=!0,this.onChange=e.onViewChange,this.update()}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.broadcast=function(e){this.onChange&&this.onChange(this,e)},e.makeOrthographic=function(t){return new e(Object.assign({left:-100,right:100,top:-100,bottom:100,near:-100,far:1e5,type:r.ORTHOGRAPHIC},t))},e.makePerspective=function(t){return new e(Object.assign({type:r.PERSPECTIVE,far:1e4,near:1,fov:90*Math.PI/180,height:1e3,width:1e3},t))},Object.defineProperty(e.prototype,"projectionType",{get:function(){return this._projectionOptions.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projection",{get:function(){return this.update(!0),this._projection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this.transform.viewMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsUpdate",{get:function(){return this._needsUpdate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(e){this._needsUpdate=this._needsUpdate||!a.compare3(e,this.transform.position),this.transform.position=e},enumerable:!0,configurable:!0}),e.prototype.lookAt=function(e,t){var n=o.copy4x4(this.transform.matrix);this.transform.lookAtLocal(e,t||[0,1,0]),this._needsUpdate=this._needsUpdate||!o.compare4x4(n,this.transform.matrix)},Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(e){this._needsUpdate=this._needsUpdate||!a.compare3(e,this.transform.scale),this.transform.scale=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionOptions",{get:function(){return this._projectionOptions},set:function(e){this._needsUpdate=this._needsUpdate||!s.shallowCompare(e,this._projectionOptions),this._projectionOptions=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjection",{get:function(){return this.update(!0),this._viewProjection},enumerable:!0,configurable:!0}),e.prototype.setOrthographic=function(e){this._projectionOptions=Object.assign({left:-100,right:100,top:-100,bottom:100,near:-100,far:1e5,type:r.ORTHOGRAPHIC},e)},e.prototype.setPerspective=function(e){this._projectionOptions=Object.assign({type:r.PERSPECTIVE,far:1e4,near:1,fov:90*Math.PI/180,height:1e3,width:1e3},e)},e.prototype.resolve=function(){this._needsUpdate=!1,this.needsViewDrawn=!1,this.needsBroadcast=!1},e.prototype.update=function(e){(this._needsUpdate||e)&&(this.updateProjection(),this._needsUpdate=!1,this.needsViewDrawn=!0)},e.prototype.updateProjection=function(){c(this)?o.orthographic4x4(this.projectionOptions.left,this.projectionOptions.right,this.projectionOptions.bottom,this.projectionOptions.top,this.projectionOptions.near,this.projectionOptions.far,this._projection):l(this)&&o.perspective4x4(this.projectionOptions.fov,this.projectionOptions.width,this.projectionOptions.height,this.projectionOptions.near,this.projectionOptions.far,this._projection),o.multiply4x4(this._projection,this.transform.viewMatrix,this._viewProjection)},e}();t.Camera=h},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this._key=e.key}return Object.defineProperty(e.prototype,"id",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),e}();t.IdentifyByKey=o;var a=function(e){function t(t){var n=e.call(this,t)||this;return n.data=t.data,n}return i(t,e),t}(o);t.IdentifiableData=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createLayer=function(e,t){return{get key(){return t.key||""},init:[e,Object.assign(t,{key:t.key||e.defaultProps.key,data:t.data||e.defaultProps.data})]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.BottomLeft=0]="BottomLeft",e[e.BottomMiddle=1]="BottomMiddle",e[e.BottomRight=2]="BottomRight",e[e.Custom=3]="Custom",e[e.Middle=4]="Middle",e[e.MiddleLeft=5]="MiddleLeft",e[e.MiddleRight=6]="MiddleRight",e[e.TopLeft=7]="TopLeft",e[e.TopMiddle=8]="TopMiddle",e[e.TopRight=9]="TopRight"}(t.AnchorType||(t.AnchorType={})),function(e){e[e.ALWAYS=1]="ALWAYS",e[e.BOUND_MAX=2]="BOUND_MAX",e[e.NEVER=3]="NEVER"}(t.ScaleMode||(t.ScaleMode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=function(){function e(){}return e.setObservableMonitor=function(t){e.gatherIds=t,e.observableIds=[]},e.getObservableMonitorIds=function(t){var n=e.observableIds.slice(0);return t&&(e.observableIds=[]),n},e.setCycle=!1,e.gatherIds=!1,e.observableIds=[],e.observableNamesToUID=new Map,e}();t.ObservableMonitoring=i;var o=i;t.observable=function(e,t){var n=i.observableNamesToUID.get(t)||0;0===n&&(n=r.uid(),i.observableNamesToUID.set(t,n)),Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return o.gatherIds&&(o.setCycle||o.observableIds.push(n)),this.observableStorage[n]},set:function(e){o.gatherIds&&(o.setCycle=!0),this.observableStorage[n]=e,this.changes[n]=n,this.observer&&this.observer.instanceUpdated(this),o.gatherIds&&(o.setCycle=!1)}})}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){}return e.prototype.getIOExpansion=function(){return[]},e.prototype.resize=function(){},e.prototype.setAttributeContext=function(e){},e}();t.BaseResourceManager=s;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resources=new Map,t}return i(t,e),t.prototype.dequeueRequests=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2,!1]}))}))},t.prototype.destroy=function(){},t.prototype.destroyResource=function(e){this.resources.delete(e.key)},t.prototype.getResource=function(e){return this.resources.get(e)||{key:"",type:-1}},t.prototype.initResource=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){return this.resources.set(e.key,e),[2]}))}))},t.prototype.request=function(e,t,n){return[0,0,0,0]},t.prototype.updateResource=function(e){},t}(s);t.InvalidResourceManager=u,t.INVALID_RESOURCE_MANAGER=new u},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(164),r(n(19)),r(n(114)),r(n(186))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0});var i=n(48),o=n(99),a=n(107);r(n(21)),r(n(175)),r(n(99)),r(n(107)),t.RESOURCE={createFont:o.createFont,createAtlas:a.createAtlas,createTexture:a.createTexture,createColorBuffer:i.createColorBuffer},t.REQUEST={textureRequest:a.textureRequest,atlasRequest:a.atlasRequest,fontRequest:o.fontRequest,colorBufferRequest:i.colorBufferRequest}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(3);t.subTextureIOValue=function(e){return e?[e.atlasTL[0],e.atlasTL[1],e.atlasBR[0],e.atlasBR[1]]:[0,0,0,0]};var o=function(){function e(e){this._uid=i.uid(),this.aspectRatio=1,this.atlasTL=[0,0],this.atlasTR=[0,0],this.atlasBL=[0,0],this.atlasBR=[0,0],this.heightOnAtlas=0,this.isValid=!1,this.pixelWidth=0,this.pixelHeight=0,this.texture=null,this.widthOnAtlas=0,Object.assign(this,e)}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),e.fromRegion=function(t,n){if(!t.data)return null;var i=n.x/t.data.width,o=n.y/t.data.height,a=n.width/t.data.width,s=n.height/t.data.height,u=new r.Bounds({bottom:o+s,left:i,right:i+a,top:o}),c=u.bottom,l=u.y,h=u.x,f=u.x+u.width,d=new e;return d.atlasTL=[h,l],d.atlasBR=[f,c],d.atlasBL=[h,c],d.atlasTR=[f,l],d},e.prototype.update=function(){this.texture&&this.source&&this.atlasRegion&&this.texture.update(this.source,this.atlasRegion)},e.prototype.toString=function(){return JSON.stringify({atlas:{TL:this.atlasTL,TR:this.atlasTR,BL:this.atlasBL,BR:this.atlasBR},width:this.pixelWidth,height:this.pixelHeight},null,2)},e}();t.SubTexture=o},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(22),o=n(27),a=n(0),s=n(18),u=n(301);t.postProcess=function(e){return e.uniforms&&e.uniforms.forEach((function(e){e.shaderInjection=a.ShaderInjectionTarget.FRAGMENT})),{views:{screen:o.createView(i.View2D,r({camera:new i.Camera2D,viewport:{left:0,top:0,width:"100%",height:"100%"}},e.view))},layers:{screen:s.createLayer(u.PostProcessLayer,{printShader:e.printShader,baseShaderModules:function(){return{fs:[],vs:[]}},buffers:e.buffers,fs:e.shader,uniforms:e.uniforms,materialOptions:e.material})}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0);!function(e){e[e.FLOAT=0]="FLOAT",e[e.VEC2=1]="VEC2",e[e.VEC3=2]="VEC3",e[e.VEC4=3]="VEC4",e[e.VEC4_ARRAY=4]="VEC4_ARRAY",e[e.FLOAT_ARRAY=5]="FLOAT_ARRAY",e[e.MATRIX3x3=6]="MATRIX3x3",e[e.MATRIX4x4=7]="MATRIX4x4",e[e.TEXTURE=8]="TEXTURE"}(r=t.MaterialUniformType||(t.MaterialUniformType={})),t.isUniformVec2=function(e){return e.type===r.VEC2},t.isUniformVec3=function(e){return e.type===r.VEC3},t.isUniformVec4=function(e){return e.type===r.VEC4},t.isUniformVec4Array=function(e){return e.type===r.VEC4_ARRAY},t.isUniformMat3=function(e){return e.type===r.MATRIX3x3},t.isUniformMat4=function(e){return e.type===r.MATRIX4x4},t.isUniformTexture=function(e){return e.type===r.TEXTURE},t.isUniformFloat=function(e){return e.type===r.FLOAT};var o=window.OffscreenCanvas||i.NOOP;t.isOffscreenCanvas=function(e){return e instanceof o},function(e){e[e.INVALID=0]="INVALID",e[e.VALID=1]="VALID",e[e.NO_RENDER_TARGET_MATCHES=2]="NO_RENDER_TARGET_MATCHES"}(t.UseMaterialStatus||(t.UseMaterialStatus={}))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(1),s=n(47),u=n(7),c=n(48),l=n(49),h=n(50),f=n(0),d=n(16),p=n(17),g=n(37),v=n(60);!function(e){e[e.COLOR=1]="COLOR",e[e.DEPTH=2]="DEPTH",e[e.STENCIL=4]="STENCIL"}(t.ClearFlags||(t.ClearFlags={})),t.createView=function(e,t){return{get key(){return t.key||""},init:[e,Object.assign(t,{key:t.key||"",viewport:t.viewport||{left:0,right:0,top:0,bottom:0}})]}};var y=function(e){function t(n,r){var i=e.call(this,r)||this;return i.animationEndTime=0,i.depth=0,i.lastFrameTime=0,i.needsDraw=!1,i.optimizeRendering=!1,i._pixelRatio=1,i.scene=n,i.props=Object.assign({},t.defaultProps||{},r),i}return i(t,e),Object.defineProperty(t.prototype,"pixelRatio",{get:function(){var e;return null!==(e=this.props.pixelRatio)&&void 0!==e?e:this._pixelRatio},set:function(e){this._pixelRatio=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"screenBounds",{get:function(){return this.projection.screenBounds},set:function(e){this.projection.screenBounds=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewBounds",{get:function(){return this.projection.viewBounds},set:function(e){this.projection.viewBounds=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clearFlags",{get:function(){return this.props.clearFlags||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"order",{get:function(){return this.props.order||0},enumerable:!0,configurable:!0}),t.prototype.getOutputTargets=function(){var e=this.props.output,t=[];return e?(l.isRenderTextureResource(e.buffers)||c.isColorBufferResource(e.buffers)?t=[{outputType:f.FragmentOutputType.COLOR,resource:e.buffers}]:Object.keys(e.buffers).forEach((function(n){var r=Number.parseFloat(n),i=e.buffers[r];i&&t.push({outputType:r,resource:i})})),t):null},t.prototype.getRenderTargets=function(){return this.renderTarget?[this.renderTarget]:[]},t.prototype.createRenderTarget=function(){this.renderTarget&&(Array.isArray(this.renderTarget)?this.renderTarget.forEach((function(e){return e.dispose()})):this.renderTarget.dispose());var e=this.props.output,t=this.scene.surface;if(e&&t){for(var n=new Set,r=0,i=this.scene.layers.length;r<i;++r){var s=this.scene.layers[r].shaderIOInfo.fs.get(this);s&&s.outputTypes.forEach((function(e){return n.add(e)}))}var u,f,d,p=new Map,v=new g.Layer(t,this.scene,{key:"",data:new a.InstanceProvider}),y=new a.Instance({}),m=this.getOutputTargets()||[];for(r=0,i=m.length;r<i;++r){var b=m[r],T=b.resource;if(n.has(b.outputType))if(l.isRenderTextureResource(T)){var _=h.textureRequest({key:b.resource.key});if(this.resource.request(v,y,_),!_.texture)throw console.warn("A view has a RenderTexture output target with key:",b.resource.key,"however, no RenderTexture was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createTexture()"),new Error("Output target unable to be constructed for view "+this.id);p.set(b.outputType,_.texture)}else{_=c.colorBufferRequest({key:b.resource.key});if(this.resource.request(v,y,_),!_.colorBuffer)throw console.warn("A view has a ColorBuffer output target with key:",b.resource.key,"however, no ColorBuffer was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createColorBuffer()"),new Error("Output target unable to be constructed for view "+this.id);p.set(b.outputType,_.colorBuffer)}}if(p.forEach((function(e){var t,n,r;if(e instanceof o.Texture){if(void 0!==u&&void 0!==f||(u=(null===(t=e.data)||void 0===t?void 0:t.width)||0,f=(null===(n=e.data)||void 0===n?void 0:n.height)||0),0===u||0===f)throw new Error("RenderTexture for View can NOT have a width or height of zero.");if((null===(r=e.data)||void 0===r?void 0:r.width)!==u||e.data.height!==f)throw new Error("When a view has multiple output targets: ALL RenderTextures and ColorBuffers that a view references MUST have the same dimensions")}else{if(void 0!==u&&void 0!==f||(u=e.size[0]||0,f=e.size[1]||0),0===u||0===f)throw new Error("RenderTexture for View can NOT have a width or height of zero.");if(e.size[0]!==u||e.size[1]!==f)throw new Error("When a view has multiple output targets: ALL RenderTextures and ColorBuffers that a view references MUST have the same dimensions")}})),e.depth)if(l.isRenderTextureResource(e.depth)){_=h.textureRequest({key:e.depth.key});if(this.resource.request(v,y,_),!_.texture)throw console.warn("A view has a depth buffer output target with key:",e.depth,"however, no RenderTexture was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createTexture()"),new Error("Output target unable to be constructed for view "+this.id);d=_.texture}else if(c.isColorBufferResource(e.depth)){_=c.colorBufferRequest({key:e.depth.key});if(this.resource.request(v,y,_),!_.colorBuffer)throw console.warn("A view has a depth buffer output target with key:",e.depth.key,"however, no ColorBuffer was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createColorBuffer()"),new Error("Output target unable to be constructed for view "+this.id);d=_.colorBuffer}else d=o.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT16;if(!o.WebGLStat.MRT)throw new Error("MRT for non-MRT systems not supported yet.");var x=[];p.forEach((function(e,t){return x.push({buffer:e,outputType:t})})),this.renderTarget=new o.RenderTarget({buffers:{color:x,depth:d},retainTextureTargets:!0})}},t.prototype.willUseView=function(){var e=this.getRenderTargets();this.props.screenScale&&(this.projection.screenScale=this.props.screenScale),e.some((function(e){return e.getBuffers().some((function(e){return!!e.buffer.destroyed}))}))&&this.createRenderTarget()},t.prototype.shouldDrawView=function(e,t){for(var n in t)if(t[n]!==e[n])return!0;return!1},t.prototype.willUpdateProps=function(e){},t.prototype.didUpdateProps=function(){},t.defaultProps={key:"",camera:d.Camera.makeOrthographic(),viewport:{left:0,right:0,top:0,bottom:0}},t}(p.IdentifyByKey);t.View=y;var m=function(e){function t(){var t=e.call(this,new v.LayerScene(void 0,{key:"error",layers:[],views:[]}),{key:"error",viewport:{},camera:d.Camera.makeOrthographic()})||this;return t.projection=new s.SimpleProjection,t.screenBounds=new u.Bounds({x:0,y:0,width:100,height:100}),t}return i(t,e),t.prototype.screenToWorld=function(e,t){return[0,0]},t.prototype.worldToScreen=function(e,t){return[0,0]},t.prototype.viewToWorld=function(e,t){return[0,0]},t.prototype.worldToView=function(e,t){return[0,0]},t.prototype.fitViewtoViewport=function(e,t){this.screenBounds=e},t}(y);t.NoView=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(29),i=-1,o=0,a=[],s=[],u=[],c=new Map,l=function e(t){o=t;var n=!1,r=[];c.forEach((function(e,i){n=!0;var o=e[0],a=e[1],s=e[2],u=e[3],c=e[4];if(-1!==u&&(-1===c&&(c=t,e[4]=t),t-c>=u))return r.push(i),void o(t,c+u);if(-1!==a){if(-1===s&&(e[2]=t,s=t),t-s>=a)for(o(t);t-s>=a;)e[2]+=a,s+=a}else o(t)}));for(var l=0,h=r.length;l<h;++l){var f=r[l];c.delete(f)}var d=s.slice();s=[];for(l=0,h=d.length;l<h;++l){var p=d[l],g=p[0],v=p[1],y=p[2];v<=0?g&&g(t):t-y>v?g(t):(n=!0,s.push(d[l]))}for(l=0,h=u.length;l<h;++l){(g=u[l])&&(n=!0,g(t))}u=a.slice(0),a=[],u.length>0&&(n=!0),i=n?requestAnimationFrame(e):-1};i=requestAnimationFrame(l),t.nextFrame=function(e){var t=new r.PromiseResolver;return a.push((function(n){e&&e(n),t.resolve(n)})),-1===i&&(i=requestAnimationFrame(l)),t.promise},t.onFrame=function(e,t){var n=new r.PromiseResolver;return s.push([function(t){e&&e(t),n.resolve(t)},t||-1,o]),-1===i&&(i=requestAnimationFrame(l)),n.promise},t.onAnimationLoop=function(e,t,n){var o=new r.PromiseResolver;return c.set(o.promise,[function(t,r){e(t),void 0!==n&&n>0?void 0!==r&&o.resolve(r):o.resolve(t)},t||-1,-1,n||-1,-1]),-1===i&&(i=requestAnimationFrame(l)),o.promise},t.stopAnimationLoop=function(e){c.delete(e),-1===i&&(i=requestAnimationFrame(l))},t.stopAllFrameCommands=function(){c.forEach((function(e){return e[0](o,o)})),c.clear(),s=[],a=[],u=[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){var e=this;this.promise=new Promise((function(t,n){return e.resolver=t,e.rejector=n}))}return e.prototype.resolve=function(e){this.resolver(e)},e.prototype.reject=function(e){this.rejector(e)},e}();t.PromiseResolver=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(58);t.isBufferLocation=function(e){return e&&e.buffer&&e.buffer.value},t.isBufferLocationGroup=function(e){return e&&e.propertyToBufferLocation};var i=function(){function e(e,t){this.layer=e,this.scene=t}return e.prototype.changesProcessed=function(){delete this.changeListContext},e.prototype.incomingChangeList=function(e){this.changeListContext=e},e.prototype.makeLayerMaterial=function(){var e=this.layer.shaderIOInfo;return r.generateLayerMaterial(this.layer,e.vs,e.fs,e.uniforms,e.materialUniforms)},e}();t.BufferManagerBase=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.expand=function(e,t,n,r){return{instanceAttributes:[],uniforms:[],vertexAttributes:[]}},t.prototype.validate=function(e,t,n,r){return!0},t.prototype.processHeaderInjection=function(e,t,n,r,i,o,a){return{injection:""}},t.prototype.processAttributeDestructuring=function(e,t,n,r,i,o){return""},t}(n(87).BaseShaderIOInjection);t.BaseIOExpansion=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=function(){function e(e,t,n,i){this.child=[null,null],this.isLeaf=!0,this.data=null,this.bounds=new r.Bounds({height:i,width:n,x:e,y:t})}return e.prototype.destroy=function(){var e=this.child[0],t=this.child[1];this.data=null,e&&e.destroy(),t&&t.destroy(),this.child[0]=null,this.child[1]=null},e.prototype.hasChild=function(){var e=this.child[0],t=this.child[1];return e&&!e.data?!e.isLeaf:!(!t||t.data)&&!t.isLeaf},e.prototype.insert=function(t){var n=this.child[0],r=this.child[1];if(!this.isLeaf&&n&&r){var i=n.insert(t);return null!==i?i:r.insert(t)}if(this.data)return null;var o=this.bounds.fits(t.bounds);if(0===o)return null;if(1===o)return this.data=t.data,this;this.isLeaf=!1;var a=t.bounds.width,s=t.bounds.height,u=this.bounds.width-a,c=this.bounds.height-t.bounds.height;return u>c?(n=this.child[0]=new e(this.bounds.x,this.bounds.y,a,this.bounds.height),r=this.child[1]=new e(this.bounds.x+a,this.bounds.y,u,this.bounds.height)):(n=this.child[0]=new e(this.bounds.x,this.bounds.y,this.bounds.width,s),r=this.child[1]=new e(this.bounds.x,this.bounds.y+s,this.bounds.width,c)),n.insert(t)},e.prototype.remove=function(e){var t=this.child[0],n=this.child[1];if(n&&t&&!this.isLeaf){var r=t.remove(e);return!!r||(r=n.remove(e),t.hasChild()||n.hasChild()||(this.child[0]=null,this.child[1]=null),r)}return this.data===e&&(this.data=null,!0)},e.applyToSubTexture=function(t,n,i,o,a){if(i){o=o||{top:0,left:0,bottom:0,right:0};var s,u=n instanceof e?n.bounds:n,c=(u.x+o.left)/t.bounds.width,l=(u.y+o.top)/t.bounds.height,h=(u.width-o.left-o.right)/t.bounds.width,f=(u.height-o.top-o.bottom)/t.bounds.height,d=(s=a?new r.Bounds({bottom:1-l,left:c,right:c+h,top:1-(l+f)}):new r.Bounds({top:1-l,left:c,right:c+h,bottom:1-(l+f)})).bottom,p=s.y,g=s.x,v=s.x+s.width;i.atlasTL=[g,p],i.atlasBR=[v,d],i.atlasBL=[g,d],i.atlasTR=[v,p],i.widthOnAtlas=Math.abs(i.atlasTR[0]-i.atlasTL[0]),i.heightOnAtlas=Math.abs(i.atlasTR[1]-i.atlasBR[1]),i.pixelWidth=h*t.bounds.width,i.pixelHeight=f*t.bounds.height}},e}();t.PackNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(244),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(9))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return Object.defineProperty(e.prototype,"surface",{get:function(){return this.userInputManager.surface},enumerable:!0,configurable:!0}),e.prototype.getProjection=function(e){var t=this.userInputManager.getView(e);return t?t.projection:null},e.prototype.getView=function(e){return this.userInputManager&&this.userInputManager.getView(e)||null},e.prototype.getViewScreenBounds=function(e){var t=this.userInputManager.getView(e);return t?t.screenBounds:null},e.prototype.setUserInputManager=function(e){this.userInputManager=e},e.prototype.willRender=function(){},e.prototype.didRender=function(){},e}();t.EventManager=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(8),o=function(){function e(e){if(this._uid=i.uid(),this.cleanObservation=new Map,this.instanceChanges=new Map,this.allowChanges=!0,this.resolveContext="",e)for(var t=0,n=e.length;t<n;++t){var r=e[t];this.add(r)}}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changeList",{get:function(){this.allowChanges=!1;var e=[];return this.instanceChanges.forEach((function(t){return e.push(t)})),e},enumerable:!0,configurable:!0}),e.prototype.add=function(e){if(this.cleanObservation.get(e.uid))return e;if(this.allowChanges){e.observer=this;var t=e.observableDisposer;this.cleanObservation.set(e.uid,[e,t]),this.instanceChanges.set(e.uid,[e,r.InstanceDiffType.INSERT,e.changes])}return e},e.prototype.clear=function(){var e=this;this.cleanObservation.forEach((function(t){e.remove(t[0])}))},e.prototype.destroy=function(){this.cleanObservation.forEach((function(e){e[1]()})),this.cleanObservation.clear(),this.instanceChanges.clear()},e.prototype.instanceUpdated=function(e){this.allowChanges&&this.instanceChanges.set(e.uid,[e,r.InstanceDiffType.CHANGE,e.changes])},e.prototype.remove=function(e){if(this.allowChanges){var t=this.cleanObservation.get(e.uid);t&&(t[1](),this.cleanObservation.delete(e.uid),this.instanceChanges.set(e.uid,[e,r.InstanceDiffType.REMOVE,{}]))}return!1},e.prototype.resolve=function(e){if(this.allowChanges=!0,this.instanceChanges.clear(),this.resolveContext&&this.resolveContext!==e)throw new Error("An instance provider has been issued to two layers. This is not a suppported feature yet and can cause issues.");this.resolveContext=e},e.prototype.sync=function(){var e=this,t=[];this.cleanObservation.forEach((function(n){var i=n[0];e.instanceChanges.set(i.uid,[i,r.InstanceDiffType.INSERT,t])}))},e}();t.InstanceProvider=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=Math.cos,o=Math.sin,a=Math.tan,s=Math.PI/2;function u(e,t,n,r,i){return(e=e||new Array(4))[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function c(e,t,n,r,i,o,a,s,u,c){return(e=e||new Array(9))[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=c,e}function l(e,t,n,r,i,o,a,s,u,c,l,h,f,d,p,g,v){return(e=e||new Array(16))[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=h,e[11]=f,e[12]=d,e[13]=p,e[14]=g,e[15]=v,e}t.M200=0,t.M201=1,t.M210=2,t.M211=3,t.M300=0,t.M301=1,t.M302=2,t.M310=3,t.M311=4,t.M312=5,t.M320=6,t.M321=7,t.M322=8,t.M400=0,t.M401=1,t.M402=2,t.M403=3,t.M410=4,t.M411=5,t.M412=6,t.M413=7,t.M420=8,t.M421=9,t.M422=10,t.M423=11,t.M430=12,t.M431=13,t.M432=14,t.M433=15,t.M3R=new Array(20).fill(0).map((function(e){return b()})),t.M4R=new Array(20).fill(0).map((function(e){return T()})),t.apply2x2=u,t.apply3x3=c,t.apply4x4=l;var h=b(),f=b(),d=b(),p=b();function g(e){return e[3]*e[0]-e[1]*e[2]}function v(e){return e[0]*e[4]*e[8]-e[0]*e[5]*e[7]+e[1]*e[5]*e[6]-e[1]*e[3]*e[8]+e[2]*e[3]*e[7]-e[2]*e[4]*e[6]}function y(e){return c(h,e[5],e[6],e[7],e[9],e[10],e[11],e[13],e[14],e[15]),c(f,e[4],e[6],e[7],e[8],e[10],e[11],e[12],e[14],e[15]),c(d,e[4],e[5],e[7],e[8],e[9],e[11],e[12],e[13],e[15]),c(d,e[4],e[5],e[6],e[8],e[9],e[10],e[12],e[13],e[14]),e[0]*v(h)-e[1]*v(f)+e[2]*v(d)-e[3]*v(p)}function m(e){return u(e,1,0,0,1)}function b(e){return c(e,1,0,0,0,1,0,0,0,1)}function T(e){return l(e,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}function _(e,t,n){return(n=n||[])[0]=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],n[1]=t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],n[2]=t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],n[3]=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],n[4]=t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],n[5]=t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],n[6]=t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],n[7]=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],n[8]=t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],n[9]=t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],n[10]=t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],n[11]=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],n[12]=t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],n[13]=t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],n[14]=t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],n[15]=t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15],n}function x(e,n,i){return r.apply4(i,e[t.M400]*n[0]+e[t.M410]*n[1]+e[t.M420]*n[2]+e[t.M430]*n[3],e[t.M401]*n[0]+e[t.M411]*n[1]+e[t.M421]*n[2]+e[t.M431]*n[3],e[t.M402]*n[0]+e[t.M412]*n[1]+e[t.M422]*n[2]+e[t.M432]*n[3],e[t.M403]*n[0]+e[t.M413]*n[1]+e[t.M423]*n[2]+e[t.M433]*n[3])}function w(e,t,n,r){if(e){if(t){if(n){var a=i(e),s=i(t),u=i(n),c=o(e),h=o(t);return l(r,s*u,s*(f=o(n)),-h,0,c*h*u-a*f,c*h*f+a*u,c*s,0,a*h*u+c*f,a*h*f-c*u,a*s,0,0,0,0,1)}a=i(e),s=i(t),c=o(e);return l(r,s,0,-(h=o(t)),0,c*h,a,c*s,0,a*h,-c,a*s,0,0,0,0,1)}if(n){a=i(e),u=i(n),c=o(e);return l(r,u,f=o(n),0,0,-a*f,a*u,c,0,c*f,-c*u,a,0,0,0,0,1)}return l(r,1,0,0,0,0,a=i(e),c=o(e),0,0,-c,a,0,0,0,0,1)}if(t){if(n){s=i(t),u=i(n),h=o(t);return l(r,s*u,s*(f=o(n)),-h,0,-f,u,0,0,h*u,h*f,s,0,0,0,0,1)}return l(r,s=i(t),0,-(h=o(t)),0,0,1,0,0,h,0,s,0,0,0,0,1)}var f;return n?l(r,u=i(n),f=o(n),0,0,-f,u,0,0,0,0,1,0,0,0,0,1):T(r)}function E(e,t,n,r){return l(r,e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1)}function O(e,t,n,r){return l(r,1,0,0,0,0,1,0,0,0,0,1,0,e,t,n,1)}function R(e,t,n,r,i,o,a){return l(a=a||T(),2*e/(r-n),0,0,0,0,2*e/(i-o),0,0,(r+n)/(r-n),(i+o)/(i-o),-(t+e)/(t-e),-1,0,0,-2*t*e/(t-e),0)}function S(e,t,n,i,o){return x(e,t,o=o||[0,0,0,0]),r.apply4(o,.5*(o[0]/o[3]+1)*n,.5*(o[1]/o[3]+1)*i,o[2]/o[3],1)}function A(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t):[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}t.determinant2x2=g,t.determinant3x3=v,t.determinant4x4=y,t.affineInverse2x2=function(e,t){var n=g(e);return 0===n?null:u(t,e[3]/n,-e[1]/n,-e[2]/n,e[0]/n)},t.affineInverse3x3=function(e,t){var n=v(e);if(0===n)return null;var r=g([e[4],e[5],e[7],e[8]]),i=g([e[3],e[5],e[6],e[8]]),o=g([e[3],e[4],e[6],e[7]]),a=g([e[1],e[2],e[7],e[8]]),s=g([e[0],e[2],e[6],e[8]]),u=g([e[0],e[1],e[6],e[7]]);return c(t,r/n,-a/n,g([e[1],e[2],e[4],e[5]])/n,-i/n,s/n,g([e[0],e[2],e[3],e[5]])/n,o/n,-u/n,g([e[0],e[1],e[3],e[4]])/n)},t.affineInverse4x4=function(e,t){var n=y(e);if(0===n)return null;var r=g([e[0],e[1],e[4],e[5]]),i=g([e[0],e[2],e[4],e[6]]),o=g([e[0],e[3],e[4],e[7]]),a=g([e[1],e[2],e[5],e[6]]),s=g([e[1],e[3],e[5],e[7]]),u=g([e[2],e[3],e[6],e[7]]),c=g([e[10],e[11],e[14],e[15]]),h=g([e[9],e[11],e[13],e[15]]),f=g([e[9],e[10],e[13],e[14]]),d=g([e[8],e[11],e[12],e[15]]),p=g([e[8],e[10],e[12],e[14]]),v=g([e[8],e[9],e[12],e[13]]);return l(t,(e[5]*c-e[6]*h+e[7]*f)/n,(-e[1]*c+e[2]*h-e[3]*f)/n,(e[12]*u-e[13]*s+e[14]*a)/n,(-e[9]*u+e[10]*s-e[11]*a)/n,(-e[4]*c+e[6]*d-e[7]*p)/n,(e[0]*c-e[2]*d+e[3]*p)/n,(-e[12]*u+e[14]*o-e[15]*i)/n,(e[8]*u-e[10]*o+e[11]*i)/n,(e[4]*h-e[5]*d+e[7]*v)/n,(-e[0]*h+e[1]*d-e[3]*v)/n,(e[12]*s-e[13]*o+e[15]*r)/n,(-e[8]*s+e[9]*o-e[11]*r)/n,(-e[4]*f+e[5]*p-e[6]*v)/n,(e[0]*f-e[1]*p+e[2]*v)/n,(-e[12]*a+e[13]*i-e[14]*r)/n,(e[8]*a-e[9]*i+e[10]*r)/n)},t.multiplyScalar2x2=function(e,t,n){return u(n,e[0]*t,e[1]*t,e[2]*t,e[3]*t)},t.multiplyScalar3x3=function(e,t,n){return c(n,e[0]*t,e[1]*t,e[2]*t,e[3]*t,e[4]*t,e[5]*t,e[6]*t,e[7]*t,e[8]*t)},t.multiplyScalar4x4=function(e,t,n){return l(n,e[0]*t,e[1]*t,e[2]*t,e[3]*t,e[4]*t,e[5]*t,e[6]*t,e[7]*t,e[8]*t,e[9]*t,e[10]*t,e[11]*t,e[12]*t,e[13]*t,e[14]*t,e[15]*t)},t.identity2=m,t.identity3=b,t.identity4=T,t.multiply2x2=function(e,n,r){return u(r,n[t.M200]*e[t.M200]+n[t.M201]*e[t.M210],n[t.M200]*e[t.M201]+n[t.M201]*e[t.M211],n[t.M210]*e[t.M200]+n[t.M211]*e[t.M210],n[t.M210]*e[t.M201]+n[t.M211]*e[t.M211])},t.multiply3x3=function(e,t,n){return c(n,t[0]*e[0]+t[1]*e[3]+t[2]*e[6],t[0]*e[1]+t[1]*e[4]+t[2]*e[7],t[0]*e[2]+t[1]*e[5]+t[2]*e[8],t[3]*e[0]+t[4]*e[3]+t[5]*e[6],t[3]*e[1]+t[4]*e[4]+t[5]*e[7],t[3]*e[2]+t[4]*e[5]+t[5]*e[8],t[6]*e[0]+t[7]*e[3]+t[8]*e[6],t[6]*e[1]+t[7]*e[4]+t[8]*e[7],t[6]*e[2]+t[7]*e[5]+t[8]*e[8])},t.multiply4x4=_,t.concat4x4=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(n.length<=0)return T();if(e=e||T(),1===n.length)return A(n[0],e);var i=n[0],o=t.M4R[t.M4R.length-1],a=t.M4R[t.M4R.length-2];e===o&&(o=t.M4R[t.M4R.length-3]),e===a&&(a=t.M4R[t.M4R.length-3]);for(var s=o,u=1,c=n.length-1;u<c;++u){var l=n[u];i=_(i,l,s),s=s===o?a:o}return _(i,n[n.length-1],e)},t.add2x2=function(e,t,n){return u(n,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3])},t.add3x3=function(e,t,n){return c(n,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3],e[4]+t[4],e[5]+t[5],e[6]+t[6],e[7]+t[7],e[8]+t[8])},t.add4x4=function(e,t,n){return l(n,e[0]+t[0],e[1]+t[1],e[2]+t[2],e[3]+t[3],e[4]+t[4],e[5]+t[5],e[6]+t[6],e[7]+t[7],e[8]+t[8],e[9]+t[9],e[10]+t[10],e[11]+t[11],e[12]+t[12],e[13]+t[13],e[14]+t[14],e[15]+t[15])},t.subtract2x2=function(e,t,n){return u(n,e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])},t.subtract3x3=function(e,t,n){return c(n,e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3],e[4]-t[4],e[5]-t[5],e[6]-t[6],e[7]-t[7],e[8]-t[8])},t.subtract4x4=function(e,t,n){return l(n,e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3],e[4]-t[4],e[5]-t[5],e[6]-t[6],e[7]-t[7],e[8]-t[8],e[9]-t[9],e[10]-t[10],e[11]-t[11],e[12]-t[12],e[13]-t[13],e[14]-t[14],e[15]-t[15])},t.Hadamard2x2=function(e,t,n){return u(n,e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3])},t.Hadamard3x3=function(e,t,n){return c(n,e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3],e[4]*t[4],e[5]*t[5],e[6]*t[6],e[7]*t[7],e[8]*t[8])},t.Hadamard4x4=function(e,t,n){return l(n,e[0]*t[0],e[1]*t[1],e[2]*t[2],e[3]*t[3],e[4]*t[4],e[5]*t[5],e[6]*t[6],e[7]*t[7],e[8]*t[8],e[9]*t[9],e[10]*t[10],e[11]*t[11],e[12]*t[12],e[13]*t[13],e[14]*t[14],e[15]*t[15])},t.transpose2x2=function(e,t){return u(t,e[0],e[2],e[1],e[3])},t.transpose3x3=function(e,t){return c(t,e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])},t.transpose4x4=function(e,t){return l(t,e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])},t.shearX2x2=function(e,t){return(e>=Math.PI/2||e<=-Math.PI/2)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),u(t=t||m(),1,0,a(e),1)},t.shearY2x2=function(e,t){return(e>=Math.PI/2||e<=-Math.PI/2)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),u(t=t||m(),1,a(e),0,1)},t.shearX4x4=function(e,t,n){(t>=s||t<=-s||e>=s||e<=-s)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),n=n||T();var r=a(t);return l(n,1,0,0,0,a(e),1,0,0,r,0,1,0,0,0,0,1)},t.shearY4x4=function(e,t,n){(t>=s||t<=-s||e>=s||e<=-s)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),n=n||T();var r=a(t);return l(n,1,a(e),0,0,0,1,0,0,0,r,1,0,0,0,0,1)},t.shearZ4x4=function(e,t,n){(t>=s||t<=-s||e>=s||e<=-s)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),n=n||T();var r=a(t);return l(n,1,0,a(e),0,0,1,r,0,0,0,1,0,0,0,0,1)},t.transform2=function(e,n,i){return r.apply2(i,e[t.M200]*n[0]+e[t.M210]*n[1],e[t.M201]*n[0]+e[t.M211]*n[1])},t.transform3=function(e,n,i){return r.apply3(i,e[t.M300]*n[0]+e[t.M310]*n[1]+e[t.M320]*n[2],e[t.M301]*n[0]+e[t.M311]*n[1]+e[t.M321]*n[2],e[t.M302]*n[0]+e[t.M312]*n[1]+e[t.M322]*n[2])},t.transform3as4=function(e,n,i){return r.apply4(i,e[t.M400]*n[0]+e[t.M410]*n[1]+e[t.M420]*n[2]+1*e[t.M430],e[t.M401]*n[0]+e[t.M411]*n[1]+e[t.M421]*n[2]+1*e[t.M431],e[t.M402]*n[0]+e[t.M412]*n[1]+e[t.M422]*n[2]+1*e[t.M432],e[t.M403]*n[0]+e[t.M413]*n[1]+e[t.M423]*n[2]+1*e[t.M433])},t.transform4=x,t.toString2x2=function(e){return"Matrix: [\n  "+e[0]+", "+e[1]+",\n  "+e[2]+", "+e[3]+",\n]"},t.toString3x3=function(e){return"Matrix: [\n  "+e[0]+", "+e[1]+", "+e[2]+",\n  "+e[3]+", "+e[4]+", "+e[5]+",\n  "+e[6]+", "+e[7]+", "+e[8]+",\n]"},t.toString4x4=function(e){return"Matrix: [\n  "+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+",\n  "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+",\n  "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+",\n  "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+",\n]"},t.rotation2x2=function(e,n){n=n||new Array(4);var r=Math.cos(e),i=Math.sin(e);return n[t.M200]=r,n[t.M201]=-i,n[t.M210]=i,n[t.M211]=r,n},t.rotation4x4=w,t.rotation4x4by3=function(e,t){return w(e[0],e[1],e[2],t)},t.scale4x4by3=function(e,t){return E(e[0],e[1],e[2],t)},t.scale4x4=E,t.translation4x4by3=function(e,t){return O(e[0],e[1],e[2],t)},t.translation4x4=O,t.perspectiveFrustum4x4=R,t.perspective4x4=function(e,t,n,r,i,o){var s=n/t,u=a(e/2)*r,c=s*u;return R(r,i,-u,u,c,-c,o)},t.perspectiveFOVY4x4=function(e,t,n,r,i,o){var s=t/n,u=a(e/2)*r,c=s*u;return R(r,i,-c,c,u,-u,o)},t.orthographic4x4=function(e,t,n,r,i,o,a){return l(a,2/(t-e),0,0,0,0,2/(r-n),0,0,0,0,-1/(o-i),0,(t+e)/(e-t),(r+n)/(n-r),-i/(i-o),1)},t.projectToScreen=S,t.project3As4ToScreen=function(e,t,n,r,i){return S(e,[t[0],t[1],t[2],1],n,r,i)},t.compare2x2=function(e,t){return Math.abs(e[0]-t[0])<=1e-7&&Math.abs(e[1]-t[1])<=1e-7&&Math.abs(e[2]-t[2])<=1e-7&&Math.abs(e[3]-t[3])<=1e-7},t.compare3x3=function(e,t){return Math.abs(e[0]-t[0])<=1e-7&&Math.abs(e[1]-t[1])<=1e-7&&Math.abs(e[2]-t[2])<=1e-7&&Math.abs(e[3]-t[3])<=1e-7&&Math.abs(e[4]-t[4])<=1e-7&&Math.abs(e[5]-t[5])<=1e-7&&Math.abs(e[6]-t[6])<=1e-7&&Math.abs(e[7]-t[7])<=1e-7&&Math.abs(e[8]-t[8])<=1e-7},t.compare4x4=function(e,t){return Math.abs(e[0]-t[0])<=1e-7&&Math.abs(e[1]-t[1])<=1e-7&&Math.abs(e[2]-t[2])<=1e-7&&Math.abs(e[3]-t[3])<=1e-7&&Math.abs(e[4]-t[4])<=1e-7&&Math.abs(e[5]-t[5])<=1e-7&&Math.abs(e[6]-t[6])<=1e-7&&Math.abs(e[7]-t[7])<=1e-7&&Math.abs(e[8]-t[8])<=1e-7&&Math.abs(e[9]-t[9])<=1e-7&&Math.abs(e[10]-t[10])<=1e-7&&Math.abs(e[11]-t[11])<=1e-7&&Math.abs(e[12]-t[12])<=1e-7&&Math.abs(e[13]-t[13])<=1e-7&&Math.abs(e[14]-t[14])<=1e-7&&Math.abs(e[15]-t[15])<=1e-7},t.copy2x2=function(e){return[e[0],e[1],e[2],e[3]]},t.copy3x3=function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},t.copy4x4=A,t.TRS4x4=function(e,n,r,i){i=i||[];var o=e[0],a=e[1],s=e[2],u=r[0],c=r[1],l=r[2],h=n[0],f=n[1],d=n[2],p=n[3],g=n[4],v=n[5],y=n[6],m=n[7],b=n[8];i[t.M400]=h*o,i[t.M401]=f*a,i[t.M402]=d*s,i[t.M403]=0,i[t.M410]=p*o,i[t.M411]=g*a,i[t.M412]=v*s,i[t.M413]=0,i[t.M420]=y*o,i[t.M421]=m*a,i[t.M422]=b*s,i[t.M423]=0,i[t.M430]=o*(h*u+p*c+y*l),i[t.M431]=a*(f*u+g*c+m*l),i[t.M432]=s*(d*u+v*c+b*l),i[t.M433]=1},t.SRT4x4=function(e,n,r,i){i=i||[];var o=e[0],a=e[1],s=e[2],u=r[0],c=r[1],l=r[2],h=n[0],f=n[1],d=n[2],p=n[3],g=n[4],v=n[5],y=n[6],m=n[7],b=n[8];i[t.M400]=h*o,i[t.M401]=f*o,i[t.M402]=d*o,i[t.M403]=0,i[t.M410]=p*a,i[t.M411]=g*a,i[t.M412]=v*a,i[t.M413]=0,i[t.M420]=y*s,i[t.M421]=m*s,i[t.M422]=b*s,i[t.M423]=0,i[t.M430]=u,i[t.M431]=c,i[t.M432]=l,i[t.M433]=1},t.TRS4x4_2D=function(e,n,r,i){i=i||[];var o=e[0],a=e[1],s=r[0],u=r[1],c=n[0],l=n[1],h=n[2],f=n[3];i[t.M400]=c*o,i[t.M401]=l*a,i[t.M402]=0,i[t.M403]=0,i[t.M410]=h*o,i[t.M411]=f*a,i[t.M412]=0,i[t.M413]=0,i[t.M420]=0,i[t.M421]=0,i[t.M422]=1,i[t.M423]=0,i[t.M430]=o*(c*s+h*u),i[t.M431]=a*(l*s+f*u),i[t.M432]=0,i[t.M433]=1},t.SRT4x4_2D=function(e,n,r,i){i=i||[];var o=e[0],a=e[1],s=r[0],u=r[1],c=n[0],l=n[1],h=n[2],f=n[3];i[t.M400]=c*o,i[t.M401]=l*o,i[t.M402]=0,i[t.M403]=0,i[t.M410]=h*a,i[t.M411]=f*a,i[t.M412]=0,i[t.M413]=0,i[t.M420]=0,i[t.M421]=0,i[t.M422]=1,i[t.M423]=0,i[t.M430]=s,i[t.M431]=u,i[t.M432]=0,i[t.M433]=1}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(14),s=n(20),u=n(146),c=n(0),l=n(0),h=n(55),f=n(56),d=n(57),p=n(28),g=n(17),v=n(29),y=n(8),m=n(85),b=n(155),T=n(94),_=n(58),x=n(5)("performance"),w=function(e){function t(n,r,i){var o=e.call(this,i)||this;return o.animationEndTime=0,o.isAnimationContinuous=!1,o.depth=0,o._easingManager={easingComplete:new v.PromiseResolver,complete:function(){return o._easingManager.easingComplete.promise}},o.lastFrameTime=0,o.needsViewDrawn=!1,o.shaderIOInfo={},o.streamChanges={locked:!1,streamIndex:0},o._uid=y.uid(),o.uidToInstance=new Map,o.willRebuildLayer=!1,o.surface=n,o.scene=r,o.props=Object.assign({},t.defaultProps||{},i),o}return i(t,e),Object.defineProperty(t.prototype,"bufferManager",{get:function(){return this._bufferManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"easingManager",{get:function(){return this._easingManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),t.createRef=function(){return{easing:null}},t.prototype.validateShaderIO=function(e){return e?e.fs&&e.vs?void 0:(console.warn("Layer needs to specify the fragment and vertex shaders:",this.id),!1):(this.picking.type=c.PickType.NONE,x("Shell layer initialized. Nothing will be rendered for this layer",this.id),!0)},t.prototype.cleanShaderIOElements=function(e){e.instanceAttributes=(e.instanceAttributes||[]).filter(h.isDefined),e.vertexAttributes=(e.vertexAttributes||[]).filter(h.isDefined),e.uniforms=(e.uniforms||[]).filter(h.isDefined)},t.prototype.checkForDuplicateOutputTypes=function(e){var t=this.props.mapOutput;c.isString(e.fs)&&(e.fs=[{outputType:c.FragmentOutputType.COLOR,source:e.fs}]),t=t||{};for(var n=new Set,r=!1,i=Number.MIN_SAFE_INTEGER,o=0,a=e.fs.length;o<a;++o){var s=e.fs[o],u=t[s.outputType];void 0!==u?(u===c.FragmentOutputType.NONE?s.outputType=i++:s.outputType=u,n.has(s.outputType)&&(r=!0),n.add(s.outputType)):(n.has(s.outputType)&&(r=!0),n.add(s.outputType))}if(r)return console.warn("Layer has duplicate fragment shader output types"),!1},t.prototype.processFragmentShadersForEachView=function(e,t){c.isString(e.fs)&&(e.fs=[{outputType:c.FragmentOutputType.COLOR,source:e.fs}]);var r=this.picking.type===c.PickType.SINGLE&&!Boolean(e.fs.find((function(e){return e.outputType===c.FragmentOutputType.PICKING})));if(this.picking.type===c.PickType.SINGLE&&!r)throw new Error("Do NOT specify picking prop on a layer when you have your own Picking output declared.");for(var i={outputType:c.FragmentOutputType.PICKING,source:n(158)},o=new Map,a={fs:new Map,vs:new Map,destructure:new Map},s=function(n,s){var l=t[n];if(r){var h=e.fs.findIndex((function(e){return e.outputType===c.FragmentOutputType.PICKING}));h>-1&&e.fs.splice(h,1)}var d=l.getOutputTargets(),p=0;e.fs.forEach((function(e,t){(null==d?void 0:d.find((function(t){return t.outputType===e.outputType})))&&(p=t)})),r&&e.fs.splice(p+1,0,i);var g=f.mapInjectDefault(a.fs,l,new Map);g||(g=new Map,a.fs.set(l,g));var v=u.ShaderProcessor.makeOutputFragmentShader(a.vs,g,d,e.fs);if(!v)return console.warn("Could not generate output fragment shaders for the view specified."),{value:!1};o.set(l,v)},l=0,h=t.length;l<h;++l){var d=s(l);if("object"==typeof d)return d.value}return{outputFragmentShaders:o,declarations:a}},t.prototype.processLayerShaders=function(e,t,n){var r;if(!(r=(new u.ShaderProcessor).process(this,e,t,n,this.surface.getIOExpanders(),this.surface.getShaderTransforms(),this.surface.getIOSorting())))return console.warn("The shader processor did not produce metrics for the layer."),!1;this.shaderIOInfo=Object.assign({activeAttribute:d.createAttribute({name:"active",size:c.InstanceAttributeSize.ONE,update:function(e){return[e.active?1:0]}}),instanceAttributes:r.instanceAttributes,instanceVertexCount:e.vertexCount,vs:r.vs,fs:r.fs,materialUniforms:r.materialUniforms,maxInstancesPerBuffer:r.maxInstancesPerBuffer,drawMode:e.drawMode||o.GLSettings.Model.DrawMode.TRIANGLE_STRIP,uniforms:r.uniforms,vertexAttributes:r.vertexAttributes},this.shaderIOInfo)},t.prototype.processVertexAttributes=function(e){_.generateLayerGeometry(this,this.shaderIOInfo.maxInstancesPerBuffer,this.shaderIOInfo.vertexAttributes,e.vertexCount)},t.prototype.init=function(e){var t=this.props.picking;(void 0===t?c.PickType.NONE:t)===c.PickType.SINGLE?this.picking={currentPickMode:c.PickType.NONE,type:c.PickType.SINGLE,uidToInstance:new Map}:this.picking={currentPickMode:c.PickType.NONE,type:c.PickType.NONE},this.resource=this.surface.resourceManager;var n=this.initShader();this.interactions=new T.LayerInteractionHandler(this);var r,i=this.validateShaderIO(n);return void 0!==i?i:!!n&&(r=this.cleanShaderIOElements(n),l.isBoolean(r)?r:(r=this.checkForDuplicateOutputTypes(n),l.isBoolean(r)?r:(r=this.processFragmentShadersForEachView(n,e),l.isBoolean(r)?r:(r=this.processLayerShaders(n,r.outputFragmentShaders,r.declarations),l.isBoolean(r)?r:(r=this.processVertexAttributes(n),l.isBoolean(r)?r:(r=this.makeLayerBufferManager(this.surface.gl,this.scene),l.isBoolean(r)?r:(r=this.updateDiffHandlers(),l.isBoolean(r)?r:(this.layerShaderDebugging(),this.props.ref&&(this.props.ref.easing=this.easingManager),!0))))))))},t.prototype.layerShaderDebugging=function(){this.props.printShader&&(console.warn("A Layer requested its shader be debugged. Do not leave this active for production:","Layer:",this.props.key,"Shader Metrics",this.shaderIOInfo),console.warn("\n\nVERTEX SHADER\n--------------\n\n",this.shaderIOInfo.vs),this.shaderIOInfo.fs.forEach((function(e,t){console.warn("\n\nFRAGMENT SHADER (view: "+t.id+"):\nOutput Targets"+JSON.stringify(e.outputNames)+"\n"+JSON.stringify(e.outputTypes)+"\n--------------\n\n",e.source)})))},t.prototype.baseShaderModules=function(e){var t=[];return t.push("instancing"),this.picking.type===c.PickType.SINGLE&&t.push("picking"),(e.instanceAttributes||[]).find((function(e){return Boolean(e&&e.easing)}))&&t.push("frame"),{fs:[],vs:t}},t.prototype.childLayers=function(){return[]},t.prototype.destroy=function(){this.bufferManager&&(this.bufferManager.scene&&this.bufferManager.scene.removeLayer(this),this.bufferManager.removeFromScene(),this.bufferManager.destroy())},t.prototype.didUpdateProps=function(){},t.prototype.draw=function(){this.updateStreamLock();var e,t,n,r=this.getChangeList();r.length>0&&(this.needsViewDrawn=!0);var i=this.diffManager,o=i.processing,a=i.processor;a.incomingChangeList(r),this.bufferManager.incomingChangeList(r);for(var s=0,u=r.length;s<u;++s)t=(e=r[s])[0],n=this.bufferManager.getBufferLocations(t),o[e[1]](a,t,Object.values(e[2]),n),t.changes={};a.commit(),this.bufferManager.changesProcessed(),this.updateEasingManager(),this.updateUniforms()},t.prototype.updateEasingManager=function(){if(this.props.streamChanges){if(!this.streamChanges.stream||this.streamChanges.stream.length<=0){var e=this._easingManager.easingComplete;this._easingManager.easingComplete=new v.PromiseResolver,p.onFrame((function(){e.resolve()}),this.animationEndTime-this.surface.frameMetrics.currentTime)}}else{var t=this._easingManager.easingComplete;this._easingManager.easingComplete=new v.PromiseResolver,p.onFrame((function(){t.resolve()}),this.animationEndTime-this.surface.frameMetrics.currentTime)}},t.prototype.getNextStreamChanges=function(){var e,t=this.props.streamChanges,n=void 0===t?{count:1e4,strategy:c.StreamChangeStrategy.LINEAR}:t,r=this.streamChanges,i=r.stream,o=void 0===i?[]:i,a=r.streamIndex;switch(void 0===n.count&&(n.count=1e4),n.count<=0&&(n.count=Number.MAX_SAFE_INTEGER),n.strategy){case c.StreamChangeStrategy.LINEAR:default:e=o.slice(a,a+n.count),this.streamChanges.streamIndex+=n.count}return this.streamChanges.stream&&this.streamChanges.streamIndex>=this.streamChanges.stream.length&&delete this.streamChanges.stream,e},t.prototype.updateStreamLock=function(){this.streamChanges.locked=Boolean(this.streamChanges.stream&&this.streamChanges.streamIndex<this.streamChanges.stream.length)},t.prototype.getChangeList=function(){var e;return this.streamChanges.locked?e=this.getNextStreamChanges():this.props.streamChanges?(this.streamChanges.streamIndex=0,this.streamChanges.locked=!0,this.streamChanges.stream=this.props.data.changeList,e=[],this.props.data.resolve(this.id)):(e=this.props.data.changeList,this.props.data.resolve(this.id)),this.updateStreamLock(),e},t.prototype.getInstanceObservableIds=function(e,t){for(var n={},r=0,i=t.length;r<i;++r){s.ObservableMonitoring.setObservableMonitor(!0),e[t[r]];var o=s.ObservableMonitoring.getObservableMonitorIds(!0);void 0!==o[0]&&(n[t[r]]=o[0])}return s.ObservableMonitoring.setObservableMonitor(!1),n},t.prototype.getMaterialOptions=function(){return{}},t.prototype.initShader=function(){return{fs:"${import: no-op}",instanceAttributes:[],uniforms:[],vertexAttributes:[],vertexCount:0,vs:"${import: no-op}"}},t.prototype.managesInstance=function(e){return this.bufferManager&&this.bufferManager.managesInstance(e)},t.prototype.getLayerBufferType=function(e,t,n){var r=c.LayerBufferType.UNIFORM,i=0;if(void 0!==this.bufferType)return this.bufferType;if(a.WebGLStat.HARDWARE_INSTANCING){for(var o=0,s=t.length;o<s;++o){var u=t[o];i+=Math.ceil(u.size/4)}for(o=0,s=n.length;o<s;++o){u=n[o];i+=Math.ceil(c.instanceAttributeSizeFloatCount[u.size||1]/4)}if(i>a.WebGLStat.MAX_VERTEX_ATTRIBUTES){i=0;for(o=0,s=n.length;o<s;++o){u=n[o];i=Math.max(i,u.block||0)}for(o=0,s=t.length;o<s;++o){u=t[o];i+=Math.ceil(u.size/4)}i<a.WebGLStat.MAX_VERTEX_ATTRIBUTES&&(r=c.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING,x("Performance Issue (Moderate):\n            Layer %o is utilizing too many vertex attributes and is now using vertex packing.\n            Max Vertex units %o\n            Used Vertex units %o\n            Instance Attributes %o\n            Vertex Attributes %o",this.id,a.WebGLStat.MAX_VERTEX_ATTRIBUTES,i,n,t))}else r=c.LayerBufferType.INSTANCE_ATTRIBUTE}return r===c.LayerBufferType.UNIFORM&&(x("Performance Issue (High):\n        Layer %o is utilizing too many vertex attributes and is now using a uniform buffer.\n        Max Vertex units %o\n        Used Vertex units %o\n        Instance Attributes %o\n        Vertex Attributes %o",this.id,a.WebGLStat.MAX_VERTEX_ATTRIBUTES,i,n,t),r=c.LayerBufferType.UNIFORM),this.setBufferType(r),r},t.prototype.makeLayerBufferManager=function(e,t){switch(this.getLayerBufferType(e,this.shaderIOInfo.vertexAttributes,this.shaderIOInfo.instanceAttributes)){case c.LayerBufferType.INSTANCE_ATTRIBUTE:this.setBufferManager(new m.InstanceAttributeBufferManager(this,t));break;case c.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING:this.setBufferManager(new m.InstanceAttributePackingBufferManager(this,t));break;default:this.setBufferManager(new m.UniformBufferManager(this,t))}},t.prototype.updateDiffHandlers=function(){(this.shaderIOInfo.instanceAttributes||[]).find((function(e){return Boolean(e&&e.easing)}))?this.picking.type===c.PickType.SINGLE?(this.onDiffAdd=this.handleDiffAddWithPickingAndEasing,this.onDiffRemove=this.handleDiffRemoveWithPickingAndEasing):(this.onDiffAdd=this.handleDiffAddWithEasing,this.onDiffRemove=this.handleDiffRemoveWithEasing):this.picking.type===c.PickType.SINGLE&&(this.onDiffAdd=this.handleDiffAddWithPicking,this.onDiffRemove=this.handleDiffRemoveWithPicking)},t.prototype.handleDiffAddWithEasing=function(e){e.easingId=this.easingId},t.prototype.handleDiffAddWithPicking=function(e){this.uidToInstance.set(e.uid,e)},t.prototype.handleDiffAddWithPickingAndEasing=function(e){this.uidToInstance.set(e.uid,e),e.easingId=this.easingId},t.prototype.handleDiffRemoveWithEasing=function(e){e.easing&&delete e.easing,delete e.easingId},t.prototype.handleDiffRemoveWithPicking=function(e){this.uidToInstance.delete(e.uid)},t.prototype.handleDiffRemoveWithPickingAndEasing=function(e){this.uidToInstance.delete(e.uid),e.easing&&delete e.easing,delete e.easingId},t.prototype.rebuildLayer=function(){if(this.willRebuildLayer=!0,this.children)for(var e=0,t=this.children.length;e<t;++e){this.children[e].rebuildLayer()}},t.prototype.resolveChanges=function(e){var t=this.props.data.changeList;t.length>0&&(this.needsViewDrawn=!0),e||this.props.data.resolve(this.id);for(var n=0,r=t.length;n<r;++n)t[n][0].changes={};return t},t.prototype.setBufferManager=function(e){this._bufferManager?console.warn("You can not change a layer's buffer strategy once it has been instantiated."):(this._bufferManager=e,this.diffManager=new b.InstanceDiffManager,this.diffManager.makeProcessor(this,e))},t.prototype.setBufferType=function(e){void 0===this._bufferType?this._bufferType=e:console.warn("You can not change a layers buffer strategy once it has been instantiated.")},t.prototype.shouldDrawView=function(e,t){for(var n in t)if(t[n]!==e[n])return!0;return!1},t.prototype.updateUniforms=function(){for(var e,t,n=0,r=this.shaderIOInfo.uniforms.length;n<r;++n)e=this.shaderIOInfo.uniforms[n],t=e.update(e),e.materialUniforms.forEach((function(e){return e.value=t}))},t.prototype.willUpdateProps=function(e){e.picking!==this.props.picking&&this.rebuildLayer(),e.ref!==this.props.ref&&this.props.ref&&(this.props.ref.easing=this.easingManager)},t.defaultProps={},t}(g.IdentifyByKey);t.Layer=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shaderTemplate=function(e){var t=e.shader,n=e.options,r=void 0===n?{}:n,i=e.required,o=e.onError,a=e.onToken,s=e.onMain,u=new Map,c=new Map,l=new Map,h=new Map,f=t.replace(/\$\{([^\}]*)\}/g,(function(e,t){var n="";return h.set(t,(h.get(t)||0)+1),t in r?(u.set(t,(u.get(t)||0)+1),n=r[t]):c.set(t,(c.get(t)||0)+1),a&&(n=a(t,n)),n}));Object.keys(r).forEach((function(e){u.get(e)||l.set(e,(l.get(e)||0)+1)}));var d={resolvedShaderOptions:u,shader:f,shaderProvidedOptions:h,unresolvedProvidedOptions:l,unresolvedShaderOptions:c};if(i&&i.values.forEach((function(e){if(d.unresolvedProvidedOptions.get(e)){var t=i.name+": Could not resolve all the required inputs. Input: "+e;o?o(t):console.error(t)}else if(d.unresolvedShaderOptions.get(e)){t=i.name+": A required option was not provided in the options parameter. Option: "+e;o?o(t):console.error(t)}else if(!d.resolvedShaderOptions.get(e)){t=i.name+": A required option was not provided in the options parameter. Option: "+e;o?o(t):console.error(t)}})),s){var p=d.shader,g=p.match(/void((.+)|\s)(main(\s+)\(\)|main\(\))(((.+)(\s*)\{)|(\s*)\{)/gm);if(g&&g.length>0){var v=p.indexOf(g[0]);if(v<0)s(null);else{for(var y=p.substr(0,v),m=p.substr(v+g[0].length),b=!1,T=!1,_=1,x=0,w=-1,E=0,O=m.length;E<O;++E){var R=m[E],S=m[E+1];switch(R){case"/":switch(S){case"*":b||T||(b=!0,E++);break;case"/":b||T||(T=!0,E++)}break;case"*":"/"===S&&(T||(b=!1,E++));break;case"\n":case"\r":b||(T=!1);break;case"{":b||T||_++;break;case"}":b||T||x++,_===x&&(w=E)}if(-1!==w)break}if(-1!==w){var A=s(m.substr(0,w),y+"\n"+m.substr(w+1));d.shader="string"==typeof A?p.substr(0,v+g[0].length)+A+p.substr(v+g[0].length+w):p.substr(0,v)+A.header+p.substr(v,g[0].length)+A.main+p.substr(v+g[0].length+w)}else s(null)}}}return d}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4);t.generateLayerModel=function(e,t,n){var i=new r.Model(e,t);return i.drawMode=n||r.GLSettings.Model.DrawMode.TRIANGLE_STRIP,i}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(16),a=n(41),s=function(e){function t(t){var n=e.call(this,{left:-100,right:100,top:-100,bottom:100,near:-100,far:1e5,type:o.CameraProjectionType.ORTHOGRAPHIC})||this;return n.control2D=new a.Control2D(n,t),n}return i(t,e),Object.defineProperty(t.prototype,"scale2D",{get:function(){return this.control2D.scale},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offset",{get:function(){return this.control2D.offset},enumerable:!0,configurable:!0}),t}(o.Camera);t.Camera2D=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(52),i=n(2),o=n(8),a=r.AutoEasingMethod.immediate(0),s=function(){function e(e,t){this._id=o.uid(),this.animation=r.AutoEasingMethod.immediate(0),this.animationEndTime=0,this.offsetBroadcastTime=0,this.scaleBroadcastTime=0,this._offset=[0,0,0],this.startOffset=[0,0,0],this.startOffsetTime=0,this.offsetEndTime=0,this._scale=[1,1,1],this.startScale=[1,1,1],this.startScaleTime=0,this.scaleEndTime=0,this.needsBroadcast=!1,this.camera=e,t&&(this._offset=i.copy3(t.offset||this._offset),this._scale=i.copy3(t.scale||this._scale))}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.broadcast=function(e){this.offset,this.scale,this.needsBroadcast&&(this.needsBroadcast=!1,this.onViewChange&&this.onViewChange(this.camera,e))},e.prototype.centerOn=function(e,t){var n=this.surface.getViewSize(e);if(n){var r=[n.width/2,n.height/2,0],o=i.subtract3(t,i.divide3(r,this._scale)),s=this.animation;this.setOffset(i.copy3(this.offset)),this.animation=a,this.setOffset(i.scale3(o,-1)),this.animation=s}},e.prototype.getCurrentTime=function(){return this.surface?this.surface.frameMetrics.currentTime:0},e.prototype.getOffset=function(){return this._offset},e.prototype.getScale=function(){return this._scale},Object.defineProperty(e.prototype,"offset",{get:function(){var e=this.getCurrentTime();return this.onViewChange&&this.offsetBroadcastTime<this.offsetEndTime&&(this.offsetBroadcastTime=e,this.needsBroadcast=!0),this.animation.cpu(this.startOffset,this._offset,(e-this.startOffsetTime)/this.animation.duration)},enumerable:!0,configurable:!0}),e.prototype.setId=function(e){this._id=e,this.camera.needsViewDrawn=!0},e.prototype.setOffset=function(e){this.startOffset=i.copy3(this.offset),this._offset=i.copy3(e),this.startOffsetTime=this.getCurrentTime(),this.offsetEndTime=this.startOffsetTime+this.animation.duration,this.updateEndTime(),this.camera.needsViewDrawn=!0,this.onViewChange&&(this.offsetBroadcastTime=this.startOffsetTime,this.needsBroadcast=!0)},Object.defineProperty(e.prototype,"scale",{get:function(){var e=this.getCurrentTime();return this.onViewChange&&this.scaleBroadcastTime<this.scaleEndTime&&(this.scaleBroadcastTime=e,this.needsBroadcast=!0),this.animation.cpu(this.startScale,this._scale,(e-this.startScaleTime)/this.animation.duration)},enumerable:!0,configurable:!0}),e.prototype.setViewChangeHandler=function(e){this.onViewChange=e},e.prototype.setScale=function(e){this.startScale=i.copy3(this.scale),this._scale=i.copy3(e),this.startScaleTime=this.getCurrentTime(),this.scaleEndTime=this.startScaleTime+this.animation.duration,this.updateEndTime(),this.camera.needsViewDrawn=!0,this.onViewChange&&(this.scaleBroadcastTime=this.startScaleTime,this.needsBroadcast=!0)},e.prototype.resolve=function(){this.camera.needsViewDrawn=!1,this.needsBroadcast=!1},e.prototype.update=function(){this.camera.needsViewDrawn=!0},e.prototype.updateEndTime=function(){this.animationEndTime=Math.max(this.scaleEndTime,this.offsetEndTime)},e}();t.Control2D=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(15),a=n(31),s=n(0);var u=function(e){function t(t,n){var r=e.call(this)||this;return r.manager=n,r.resourceType=t,r}return i(t,e),t.prototype.expand=function(e,t,n,r){var i=this,a=this.manager,u=[],c=new Map;t.forEach((function(e){if(r=e,o=i.manager.router,a=i.resourceType,r&&r.resource&&o.getResourceType(r.resource.key())===a&&void 0!==r.resource.name&&void 0!==r.resource.key){void 0===e.size&&(e.size=s.InstanceAttributeSize.FOUR);var t=e.resource.shaderInjection||s.ShaderInjectionTarget.FRAGMENT,n=c.get(e.resource.name);n?c.set(e.resource.name,[n[0]||t===s.ShaderInjectionTarget.VERTEX||t===s.ShaderInjectionTarget.ALL,n[1]||t===s.ShaderInjectionTarget.FRAGMENT||t===s.ShaderInjectionTarget.ALL]):(u.push(e),c.set(e.resource.name,[t===s.ShaderInjectionTarget.VERTEX||t===s.ShaderInjectionTarget.ALL,t===s.ShaderInjectionTarget.FRAGMENT||t===s.ShaderInjectionTarget.ALL]))}var r,o,a}));var l=u.map((function(e){var t=s.ShaderInjectionTarget.FRAGMENT;if(e.resource){var n=c.get(e.resource.name);n&&(t=n[0]&&n[1]&&s.ShaderInjectionTarget.ALL||n[0]&&!n[1]&&s.ShaderInjectionTarget.VERTEX||!n[0]&&n[1]&&s.ShaderInjectionTarget.FRAGMENT||t)}return[{name:e.resource.name,shaderInjection:t,size:s.UniformSize.TEXTURE,update:function(){var t=a.getResource(e.resource.key());return t&&t.texture||o.Texture.emptyTexture}},{name:e.resource.name+"_size",shaderInjection:t,size:s.UniformSize.TWO,update:function(){var t=a.getResource(e.resource.key());if(t){var n=t.texture;if(n&&n.data){var r=n.data;return[r.width||1,r.height||1]}}return[1,1]}}]})),h=[];return l.forEach((function(e){return e.forEach((function(e){return h.push(e)}))})),{instanceAttributes:[],vertexAttributes:[],uniforms:h}},t.prototype.validate=function(e,t,n,r){var i=!1;return t.forEach((function(e){e.easing&&e.resource&&(console.warn("An instance attribute can not have both easing and resource properties. Undefined behavior will occur."),console.warn(e),i=!0)})),!i},t.prototype.processHeaderInjection=function(e,t,n,r,i,o,a){for(var u=0,c=a.length;u<c;++u){var l=a[u],h=l.shaderInjection||s.ShaderInjectionTarget.VERTEX;l.size===s.UniformSize.TEXTURE&&h===e&&this.setDeclaration(t,l.name,"uniform sampler2D "+l.name+";\n","TextureIOExpansion")}return{injection:""}},t}(a.BaseIOExpansion);t.TextureIOExpansion=u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this)||this;return Object.assign(n,t),n}return i(t,e),t.prototype.handleMouseDown=function(e){},t.prototype.handleMouseUp=function(e){},t.prototype.handleMouseOver=function(e){},t.prototype.handleMouseOut=function(e){},t.prototype.handleMouseMove=function(e){},t.prototype.handleClick=function(e){},t.prototype.handleDrag=function(e){},t.prototype.handleWheel=function(e){},t.prototype.handleTouchCancelled=function(e){},t.prototype.handleTouchDown=function(e){},t.prototype.handleTouchUp=function(e){},t.prototype.handleTouchOut=function(e){},t.prototype.handleTouchDrag=function(e){},t.prototype.handleTap=function(e){},t.prototype.handleDoubleTap=function(e){},t.prototype.handleLongTouch=function(e){},t.prototype.handleLongTap=function(e){},t.prototype.handlePinch=function(e){},t.prototype.handleSpread=function(e){},t.prototype.handleTouchRotate=function(e){},t.prototype.handleSwipe=function(e){},t}(n(34).EventManager);t.SimpleEventHandler=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=n(14);t.drawMode=function(e,t){switch(t){case r.GLSettings.Model.DrawMode.LINES:return e.LINES;case r.GLSettings.Model.DrawMode.LINE_LOOP:return e.LINE_LOOP;case r.GLSettings.Model.DrawMode.LINE_STRIP:return e.LINE_STRIP;case r.GLSettings.Model.DrawMode.POINTS:return e.POINTS;case r.GLSettings.Model.DrawMode.TRIANGLES:return e.TRIANGLES;case r.GLSettings.Model.DrawMode.TRIANGLE_FAN:return e.TRIANGLE_FAN;case r.GLSettings.Model.DrawMode.TRIANGLE_STRIP:return e.TRIANGLE_STRIP;default:return e.TRIANGLES}},t.texelFormat=function(e,t){switch(t){case r.GLSettings.Texture.TexelDataType.Alpha:return e.ALPHA;case r.GLSettings.Texture.TexelDataType.DepthComponent:return e.DEPTH_COMPONENT;case r.GLSettings.Texture.TexelDataType.DepthStencil:return e.DEPTH_STENCIL;case r.GLSettings.Texture.TexelDataType.Luminance:return e.LUMINANCE;case r.GLSettings.Texture.TexelDataType.LuminanceAlpha:return e.LUMINANCE_ALPHA;case r.GLSettings.Texture.TexelDataType.RGB:return e.RGB;case r.GLSettings.Texture.TexelDataType.RGBA:return e.RGBA;default:if(e instanceof WebGL2RenderingContext)switch(t){case r.GLSettings.Texture.TexelDataType.R8:return e.R8;case r.GLSettings.Texture.TexelDataType.R16F:return e.R16F;case r.GLSettings.Texture.TexelDataType.R32F:return e.R32F;case r.GLSettings.Texture.TexelDataType.R8UI:return e.R8UI;case r.GLSettings.Texture.TexelDataType.RG8:return e.RG8;case r.GLSettings.Texture.TexelDataType.RG16F:return e.RG16F;case r.GLSettings.Texture.TexelDataType.RG32F:return e.RG32F;case r.GLSettings.Texture.TexelDataType.RG8UI:return e.RG8UI;case r.GLSettings.Texture.TexelDataType.RG16UI:return e.RG16UI;case r.GLSettings.Texture.TexelDataType.RG32UI:return e.RG32UI;case r.GLSettings.Texture.TexelDataType.RGB8:return e.RGB8;case r.GLSettings.Texture.TexelDataType.SRGB8:return e.SRGB8;case r.GLSettings.Texture.TexelDataType.RGB565:return e.RGB565;case r.GLSettings.Texture.TexelDataType.R11F_G11F_B10F:return e.R11F_G11F_B10F;case r.GLSettings.Texture.TexelDataType.RGB9_E5:return e.RGB9_E5;case r.GLSettings.Texture.TexelDataType.RGB16F:return e.RGB16F;case r.GLSettings.Texture.TexelDataType.RGB32F:return e.RGB32F;case r.GLSettings.Texture.TexelDataType.RGB8UI:return e.RGB8UI;case r.GLSettings.Texture.TexelDataType.RGBA8:return e.RGBA8;case r.GLSettings.Texture.TexelDataType.SRGB8_ALPHA8:return e.SRGB8_ALPHA8;case r.GLSettings.Texture.TexelDataType.RGB5_A1:return e.RGB5_A1;case r.GLSettings.Texture.TexelDataType.RGB10_A2:return e.RGB10_A2;case r.GLSettings.Texture.TexelDataType.RGBA4:return e.RGBA4;case r.GLSettings.Texture.TexelDataType.RGBA16F:return e.RGBA16F;case r.GLSettings.Texture.TexelDataType.RGBA32F:return i.WebGLStat.FLOAT_TEXTURE_READ.full&&i.WebGLStat.FLOAT_TEXTURE_WRITE.full?e.RGBA32F:e.RGBA16F;case r.GLSettings.Texture.TexelDataType.RGBA8UI:return e.RGBA8UI;case r.GLSettings.Texture.TexelDataType.DEPTH_COMPONENT16:return e.DEPTH_COMPONENT16;case r.GLSettings.Texture.TexelDataType.DEPTH_COMPONENT24:return e.DEPTH_COMPONENT24;case r.GLSettings.Texture.TexelDataType.DEPTH_COMPONENT32F:return e.DEPTH_COMPONENT32F;case r.GLSettings.Texture.TexelDataType.RGBA32UI:return e.RGBA32UI;case r.GLSettings.Texture.TexelDataType.RGB32UI:return e.RGB32UI;case r.GLSettings.Texture.TexelDataType.RGBA16UI:return e.RGBA16UI;case r.GLSettings.Texture.TexelDataType.RGB16UI:return e.RGB16UI;case r.GLSettings.Texture.TexelDataType.RGBA32I:return e.RGBA32I;case r.GLSettings.Texture.TexelDataType.RGB32I:return e.RGB32I;case r.GLSettings.Texture.TexelDataType.RGBA16I:return e.RGBA16I;case r.GLSettings.Texture.TexelDataType.RGB16I:return e.RGB16I;case r.GLSettings.Texture.TexelDataType.RGBA8I:return e.RGBA8I;case r.GLSettings.Texture.TexelDataType.RGB8I:return e.RGB8I;default:return console.warn("An unsupported texel format was provided that is not supported in WebGL 1 or 2"),e.RGBA}return console.warn("An Unsupported texel format was provided. Some formats are only available in WebGL 2",t),e.RGBA}},t.inputImageFormat=function(e,t){switch(t){case r.GLSettings.Texture.SourcePixelFormat.Byte:return e.BYTE;case r.GLSettings.Texture.SourcePixelFormat.Float:return e.FLOAT;case r.GLSettings.Texture.SourcePixelFormat.HalfFloat:return console.warn("Unsupported HALF_FLOAT"),e.BYTE;case r.GLSettings.Texture.SourcePixelFormat.Int:return e.INT;case r.GLSettings.Texture.SourcePixelFormat.Short:return e.SHORT;case r.GLSettings.Texture.SourcePixelFormat.UnsignedByte:return e.UNSIGNED_BYTE;case r.GLSettings.Texture.SourcePixelFormat.UnsignedInt:return e.UNSIGNED_INT;case r.GLSettings.Texture.SourcePixelFormat.UnsignedShort:return e.UNSIGNED_SHORT;case r.GLSettings.Texture.SourcePixelFormat.UnsignedShort_4_4_4_4:return e.UNSIGNED_SHORT_4_4_4_4;case r.GLSettings.Texture.SourcePixelFormat.UnsignedShort_5_5_5_1:return e.UNSIGNED_SHORT_5_5_5_1;case r.GLSettings.Texture.SourcePixelFormat.UnsignedShort_5_6_5:return e.UNSIGNED_SHORT_5_6_5;default:return console.warn("An Unsupported input image format was provided",t),e.BYTE}},t.magFilter=function(e,t){switch(t){case r.GLSettings.Texture.TextureMagFilter.Linear:return e.LINEAR;case r.GLSettings.Texture.TextureMagFilter.Nearest:return e.NEAREST}},t.minFilter=function(e,t,n){switch(t){case r.GLSettings.Texture.TextureMinFilter.Linear:return e.LINEAR;case r.GLSettings.Texture.TextureMinFilter.Nearest:return e.NEAREST;case r.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear:return n?e.LINEAR_MIPMAP_LINEAR:e.LINEAR;case r.GLSettings.Texture.TextureMinFilter.LinearMipMapNearest:return n?e.LINEAR_MIPMAP_NEAREST:e.LINEAR;case r.GLSettings.Texture.TextureMinFilter.NearestMipMapLinear:return n?e.NEAREST_MIPMAP_LINEAR:e.NEAREST;case r.GLSettings.Texture.TextureMinFilter.NearestMipMapNearest:return n?e.NEAREST_MIPMAP_NEAREST:e.NEAREST;default:return e.LINEAR}},t.colorBufferFormat=function(e,t){switch(t){case r.GLSettings.RenderTarget.ColorBufferFormat.RGB565:return e.RGB565;case r.GLSettings.RenderTarget.ColorBufferFormat.RGB5_A1:return e.RGB5_A1;case r.GLSettings.RenderTarget.ColorBufferFormat.RGBA4:return e.RGBA4;default:if(e instanceof WebGL2RenderingContext)switch(t){case r.GLSettings.RenderTarget.ColorBufferFormat.R8:return e.R8;case r.GLSettings.RenderTarget.ColorBufferFormat.R8UI:return e.R8UI;case r.GLSettings.RenderTarget.ColorBufferFormat.R8I:return e.R8I;case r.GLSettings.RenderTarget.ColorBufferFormat.R16UI:return e.R16UI;case r.GLSettings.RenderTarget.ColorBufferFormat.R16I:return e.R16I;case r.GLSettings.RenderTarget.ColorBufferFormat.R32UI:return e.R32UI;case r.GLSettings.RenderTarget.ColorBufferFormat.R32I:return e.R32I;case r.GLSettings.RenderTarget.ColorBufferFormat.RG8:return e.RG8;case r.GLSettings.RenderTarget.ColorBufferFormat.RG8UI:return e.RG8UI;case r.GLSettings.RenderTarget.ColorBufferFormat.RG8I:return e.RG8I;case r.GLSettings.RenderTarget.ColorBufferFormat.RG16UI:return e.RG16UI;case r.GLSettings.RenderTarget.ColorBufferFormat.RG16I:return e.RG16I;case r.GLSettings.RenderTarget.ColorBufferFormat.RG32UI:return e.RG32UI;case r.GLSettings.RenderTarget.ColorBufferFormat.RG32I:return e.RG32I;case r.GLSettings.RenderTarget.ColorBufferFormat.RGB8:return e.RGB8;case r.GLSettings.RenderTarget.ColorBufferFormat.RGBA8:return e.RGBA8;case r.GLSettings.RenderTarget.ColorBufferFormat.SRGB8_ALPHA8:return e.SRGB8_ALPHA8;case r.GLSettings.RenderTarget.ColorBufferFormat.RGB10_A2:return e.RGB10_A2;case r.GLSettings.RenderTarget.ColorBufferFormat.RGBA8UI:return e.RGBA8UI;case r.GLSettings.RenderTarget.ColorBufferFormat.RGBA8I:return e.RGBA8I;case r.GLSettings.RenderTarget.ColorBufferFormat.RGB10_A2UI:return e.RGB10_A2UI;case r.GLSettings.RenderTarget.ColorBufferFormat.RGBA16UI:return e.RGBA16UI;case r.GLSettings.RenderTarget.ColorBufferFormat.RGBA16I:return e.RGBA16I;case r.GLSettings.RenderTarget.ColorBufferFormat.RGBA32I:return e.RGBA32I;case r.GLSettings.RenderTarget.ColorBufferFormat.RGBA32UI:return e.RGBA32UI}return e.RGBA4}},t.depthBufferFormat=function(e,t){switch(t){case r.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT16:return e.DEPTH_COMPONENT16;case r.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_STENCIL:return e.DEPTH_STENCIL;default:if(e instanceof WebGL2RenderingContext)switch(t){case r.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT24:return e.DEPTH_COMPONENT24;case r.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT32F:return e.DEPTH_COMPONENT32F;case r.GLSettings.RenderTarget.DepthBufferFormat.DEPTH24_STENCIL8:return e.DEPTH24_STENCIL8;case r.GLSettings.RenderTarget.DepthBufferFormat.DEPTH32F_STENCIL8:return e.DEPTH32F_STENCIL8}return e.DEPTH_COMPONENT16}},t.stencilBufferFormat=function(e,t){switch(t){case r.GLSettings.RenderTarget.StencilBufferFormat.STENCIL_INDEX8:default:return e.STENCIL_INDEX8}},t.wrapMode=function(e,t){switch(t){case r.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE:return e.CLAMP_TO_EDGE;case r.GLSettings.Texture.Wrapping.MIRRORED_REPEAT:return e.MIRRORED_REPEAT;case r.GLSettings.Texture.Wrapping.REPEAT:return e.REPEAT}},t.indexToColorAttachment=function(e,t,n,r,i){if(r)return e.COLOR_ATTACHMENT0;var o=t.drawBuffers;if(i){if(o instanceof WebGL2RenderingContext)switch(n){case-2:return e.BACK;case-1:return e.NONE;case 0:return o.DRAW_BUFFER0;case 1:return o.DRAW_BUFFER1;case 2:return o.DRAW_BUFFER2;case 3:return o.DRAW_BUFFER3;case 4:return o.DRAW_BUFFER4;case 5:return o.DRAW_BUFFER5;case 6:return o.DRAW_BUFFER6;case 7:return o.DRAW_BUFFER7;case 8:return o.DRAW_BUFFER8;case 9:return o.DRAW_BUFFER9;case 10:return o.DRAW_BUFFER10;case 11:return o.DRAW_BUFFER11;case 12:return o.DRAW_BUFFER12;case 13:return o.DRAW_BUFFER13;case 14:return o.DRAW_BUFFER14;case 15:return o.DRAW_BUFFER15;default:console.warn("Attachments are only available for -2 - 15")}else if(o)switch(n){case-2:return e.BACK;case-1:return e.NONE;case 0:return o.DRAW_BUFFER0_WEBGL;case 1:return o.DRAW_BUFFER1_WEBGL;case 2:return o.DRAW_BUFFER2_WEBGL;case 3:return o.DRAW_BUFFER3_WEBGL;case 4:return o.DRAW_BUFFER4_WEBGL;case 5:return o.DRAW_BUFFER5_WEBGL;case 6:return o.DRAW_BUFFER6_WEBGL;case 7:return o.DRAW_BUFFER7_WEBGL;case 8:return o.DRAW_BUFFER8_WEBGL;case 9:return o.DRAW_BUFFER9_WEBGL;case 10:return o.DRAW_BUFFER10_WEBGL;case 11:return o.DRAW_BUFFER11_WEBGL;case 12:return o.DRAW_BUFFER12_WEBGL;case 13:return o.DRAW_BUFFER13_WEBGL;case 14:return o.DRAW_BUFFER14_WEBGL;case 15:return o.DRAW_BUFFER15_WEBGL;default:console.warn("Attachments are only available for 0 - 15")}}else if(o instanceof WebGL2RenderingContext)switch(n){case-2:return e.BACK;case-1:return e.NONE;case 0:return o.COLOR_ATTACHMENT0;case 1:return o.COLOR_ATTACHMENT1;case 2:return o.COLOR_ATTACHMENT2;case 3:return o.COLOR_ATTACHMENT3;case 4:return o.COLOR_ATTACHMENT4;case 5:return o.COLOR_ATTACHMENT5;case 6:return o.COLOR_ATTACHMENT6;case 7:return o.COLOR_ATTACHMENT7;case 8:return o.COLOR_ATTACHMENT8;case 9:return o.COLOR_ATTACHMENT9;case 10:return o.COLOR_ATTACHMENT10;case 11:return o.COLOR_ATTACHMENT11;case 12:return o.COLOR_ATTACHMENT12;case 13:return o.COLOR_ATTACHMENT13;case 14:return o.COLOR_ATTACHMENT14;case 15:return o.COLOR_ATTACHMENT15;default:console.warn("Attachments are only available for -2 - 15")}else if(o)switch(n){case-2:return e.BACK;case-1:return e.NONE;case 0:return o.COLOR_ATTACHMENT0_WEBGL;case 1:return o.COLOR_ATTACHMENT1_WEBGL;case 2:return o.COLOR_ATTACHMENT2_WEBGL;case 3:return o.COLOR_ATTACHMENT3_WEBGL;case 4:return o.COLOR_ATTACHMENT4_WEBGL;case 5:return o.COLOR_ATTACHMENT5_WEBGL;case 6:return o.COLOR_ATTACHMENT6_WEBGL;case 7:return o.COLOR_ATTACHMENT7_WEBGL;case 8:return o.COLOR_ATTACHMENT8_WEBGL;case 9:return o.COLOR_ATTACHMENT9_WEBGL;case 10:return o.COLOR_ATTACHMENT10_WEBGL;case 11:return o.COLOR_ATTACHMENT11_WEBGL;case 12:return o.COLOR_ATTACHMENT12_WEBGL;case 13:return o.COLOR_ATTACHMENT13_WEBGL;case 14:return o.COLOR_ATTACHMENT14_WEBGL;case 15:return o.COLOR_ATTACHMENT15_WEBGL;default:console.warn("Attachments are only available for 0 - 15")}return e.COLOR_ATTACHMENT0},t.indexToTextureUnit=function(e,t){return e.TEXTURE0+t},t.textureUnitToIndex=function(e,t){return t-e.TEXTURE0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(8),o=n(15),a=function(){function e(e){this.isInvalid=!1,this._uid=i.uid(),this._validFramebuffer=!1,this._disabledTargets=new Set,this.retainTextureTargets=!1,this._buffers={color:Array.isArray(e.buffers.color)?e.buffers.color.slice(0):e.buffers.color,depth:e.buffers.depth,stencil:e.buffers.stencil},this._width=e.width||0,this._height=e.height||0,this.retainTextureTargets=e.retainTextureTargets||!1,this.calculateDimensions()}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffers",{get:function(){return{color:Array.isArray(this._buffers.color)?this._buffers.color.slice(0):this._buffers.color,depth:this._buffers.depth,stencil:this._buffers.stencil}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"validFramebuffer",{get:function(){return this._validFramebuffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disabledTargets",{get:function(){return this._disabledTargets},set:function(e){this._disabledTargets=e},enumerable:!0,configurable:!0}),e.prototype.calculateDimensions=function(){var e=[];if(this._buffers.color instanceof o.Texture)e.push(this._buffers.color);else if(Array.isArray(this._buffers.color))for(var t=0,n=this._buffers.color.length;t<n;++t){var r=this._buffers.color[t];r.buffer instanceof o.Texture&&e.push(r.buffer)}else this._buffers.color&&this._buffers.color.buffer instanceof o.Texture&&e.push(this._buffers.color.buffer);if(this._buffers.depth instanceof o.Texture&&e.push(this._buffers.depth),this._buffers.stencil instanceof o.Texture&&e.push(this._buffers.stencil),e.length>0&&e[0].data){var i=e[0].data,a=i.width,s=i.height;for(t=0,n=e.length;t<n;++t){var u=e[t];if(!u.data)return void console.warn("A texture specified for thie RenderTarget did not have any data associated with it.");var c=u.data,l=c.width,h=c.height;l===a&&h===s||(console.warn("Texture applied to the render target is invalid as it does not match dimensions of all textures applied:",u,e,"The texture will be removed as a target for the render target"),this.removeTextureFromBuffer(u))}this._width=a,this._height=s}this._width&&this._height||console.warn("A RenderTarget was not able to establish valid dimensions. This target had no texture buffers and did not specify valid width and height values.",this)},e.prototype.dispose=function(){this.gl&&this.gl.proxy.disposeRenderTarget(this)},e.prototype.getBuffers=function(){return Array.isArray(this.buffers.color)?this.buffers.color:this.buffers.color?[this.buffers.color]:[]},e.prototype.getGLBuffers=function(){return this.gl?Array.isArray(this.gl.colorBufferId)?this.gl.colorBufferId:[this.gl.colorBufferId]:(this.isInvalid||console.warn("Attempted to retrieve gl buffers before the render target was compiled."),[])},e.prototype.getOutputTypes=function(){return this.getBuffers().map((function(e){return e.outputType}))},e.prototype.getSize=function(){return[this._width,this._height]},e.prototype.getTextures=function(){var e=[];return Array.isArray(this.buffers.color)?this.buffers.color.forEach((function(t){t.buffer instanceof o.Texture&&e.push(t.buffer)})):this.buffers.color&&this.buffers.color.buffer instanceof o.Texture&&e.push(this.buffers.color.buffer),this.buffers.depth instanceof o.Texture&&e.push(this.buffers.depth),this.buffers.stencil instanceof o.Texture&&e.push(this.buffers.stencil),e},e.prototype.isColorTarget=function(){var e;return Array.isArray(this.buffers.color)?1===this.buffers.color.length&&this.buffers.color[0].outputType===r.FragmentOutputType.COLOR:(null===(e=this.buffers.color)||void 0===e?void 0:e.outputType)===r.FragmentOutputType.COLOR},e.prototype.removeTextureFromBuffer=function(e){var t;if(Array.isArray(this._buffers.color)){var n=this._buffers.color.find((function(t){return t.buffer===e}));if(!n)return;var r=this._buffers.color.indexOf(n);r>-1&&this._buffers.color.splice(r,1)}else(null===(t=this._buffers.color)||void 0===t?void 0:t.buffer)===e&&delete this._buffers.color;this._buffers.depth===e&&delete this._buffers.depth,this._buffers.stencil===e&&delete this._buffers.stencil},e.prototype.setSize=function(e,t){this.dispose(),this._width=e,this._height=t,this.getTextures().forEach((function(n){n.data={buffer:null,height:t,width:e}}))},e.prototype.setAsValid=function(){this._validFramebuffer=!0},e}();t.RenderTarget=a},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(74)),r(n(7))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),a=n(7),s=n(2),u=function(){function e(){this._uid=o.uid(),this.id="",this.pixelRatio=1,this._screenScale=[1,1]}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenBounds",{get:function(){return this._scaledScreenBounds||(this._scaledScreenBounds=new a.Bounds({x:this._screenBounds.x*this._screenScale[0],y:this._screenBounds.y*this._screenScale[1],width:this._screenBounds.width*this._screenScale[0],height:this._screenBounds.height*this._screenScale[1]})),this._scaledScreenBounds},set:function(e){delete this._scaledScreenBounds,this._screenBounds=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenScale",{get:function(){return this._screenScale},set:function(e){s.compare2(e,this._screenScale)||(delete this._scaledScreenBounds,this._screenScale=e)},enumerable:!0,configurable:!0}),e.prototype.screenToRenderSpace=function(e,t){return t=this.screenToView(e,t),s.apply2(t,e[0]*this.pixelRatio,e[1]*this.pixelRatio)},e.prototype.renderSpaceToScreen=function(e,t){return t=t||[0,0],s.apply2(t,e[0]/this.pixelRatio-this.screenBounds.x,e[1]/this.pixelRatio-this.screenBounds.y)},e.prototype.screenToView=function(e,t){return t=t||[0,0],s.apply2(t,e[0]-this.screenBounds.x,e[1]-this.screenBounds.y)},e.prototype.viewToScreen=function(e,t){return t=t||[0,0],s.apply2(t,e[0]+this.screenBounds.x,e[1]+this.screenBounds.y)},e}();t.BaseProjection=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.screenToWorld=function(e,t){return e},t.prototype.screenRay=function(e){return[[0,0,-1],[0,0,-2]]},t.prototype.worldToScreen=function(e,t){return e},t.prototype.viewToWorld=function(e,t){return e},t.prototype.worldToView=function(e,t){return e},t}(u);t.SimpleProjection=c},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(76)),r(n(144)),r(n(145))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=n(0),u=n(17);t.createTexture=function(e){return o({key:"",type:s.ResourceType.TEXTURE},e)},t.isRenderTextureResource=function(e){return e&&void 0!==e.key&&e.type===s.ResourceType.TEXTURE};var c=function(e){function t(t,n){var r=e.call(this,t)||this;return r.type=s.ResourceType.TEXTURE,r.height=t.height,r.width=t.width,r.textureSettings=t.textureSettings,r.createTexture(n),r}return i(t,e),t.prototype.destroy=function(){this.texture.destroy()},t.prototype.createTexture=function(e){var t;if(!this.texture){var n,r;this.textureSettings=o({generateMipMaps:!0,premultiplyAlpha:!1},this.textureSettings);var i=(null==e?void 0:e.getRenderSize())||[1,1];if(this.width<=s.TextureSize.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");n=i[0]/-this.width}else n=this.width;if(this.height<=s.TextureSize.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");r=i[1]/-this.width}else r=this.height;this.texture=new a.Texture(o({data:(null===(t=this.textureSettings)||void 0===t?void 0:t.data)||{width:n,height:r,buffer:null}},this.textureSettings))}},t}(u.IdentifyByKey);t.RenderTexture=c},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.textureRequest=function(e){return r({type:i.ResourceType.TEXTURE},e)}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(53),s=function(e){function t(t){var n=e.call(this)||this;return n.isQueuedForUpdate=!1,n.needsWorldOrientation=!1,n.needsWorldDecomposition=!1,n.hasViewMatrix=!1,n._instance=null,n._matrix={value:o.identity4()},n._localMatrix={value:n._matrix.value},n._rotation={value:o.oneQuat()},n._localRotation={value:n._rotation.value},n.localRotationMatrix=o.identity3(),n._scale={value:[1,1,1]},n._localScale={value:n._scale.value},n._position={value:[0,0,0]},n._localPosition={value:n._position.value},n._forward={value:o.forward3()},n._localForward={value:n._forward.value},n.needsForwardUpdate=!1,t?(t.localPosition&&(n.localPosition=t.localPosition),t.localRotation&&(n.localRotation=t.localRotation),t.localScale&&(n.localScale=t.localScale),t.parent&&(n.parent=t.parent),n):n}return i(t,e),Object.defineProperty(t.prototype,"instance",{set:function(e){this._instance!==e&&this._instance&&(this._instance.transform.instance=null,e&&(e.transform=this)),this._instance=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"matrix",{get:function(){return this.update(),this._matrix.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localMatrix",{get:function(){return this.update(),this._localMatrix.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewMatrix",{get:function(){return this.hasViewMatrix=!0,void 0===this._viewMatrix&&this.invalidate(),this.update(),void 0===this._viewMatrix?o.identity4():this._viewMatrix.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localViewMatrix",{get:function(){return this.hasViewMatrix=!0,void 0===this._localViewMatrix&&this.invalidate(),this.update(),void 0===this._localViewMatrix?o.identity4():this._localViewMatrix.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localTransform",{get:function(){var e;return null===(e=this._localTransform)||void 0===e?void 0:e.value},set:function(e){e?(this._localTransform||(this._localTransform={value:o.identity4()}),o.copy4x4(e,this._localTransform.value),this._localTransform.didUpdate=!0):delete this._localTransform,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localViewTransform",{get:function(){var e;return null===(e=this._localViewTransform)||void 0===e?void 0:e.value},set:function(e){e?(this._localViewTransform||(this._localViewTransform={value:o.identity4()}),o.copy4x4(e,this._localViewTransform.value),this._localViewTransform.didUpdate=!0):delete this._localViewTransform,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.needsWorldOrientation=!0,this.update(),this._rotation.value},set:function(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world rotation when a parent is present is not supported yet. Use localRotation for now."):this.localRotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localRotation",{get:function(){return this._localRotation.value},set:function(e){o.apply4(this._localRotation.value,e[0],e[1],e[2],e[3]),this._localRotation.didUpdate=!0,this.invalidate(),this.needsForwardUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.needsWorldOrientation=!0,this.update(),this._scale.value},set:function(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world scale is not supported yet. Use localScale for now."):this.localScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localScale",{get:function(){return this._localScale.value},set:function(e){o.apply3(this._localScale.value,e[0],e[1],e[2]),this._localScale.didUpdate=!0,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.needsWorldOrientation=!0,this.update(),this._position.value},set:function(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world position is not supported yet. Use localPosition for now."):this.localPosition=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localPosition",{get:function(){return this._localPosition.value},set:function(e){this._localPosition.value[0]=e[0],this._localPosition.value[1]=e[1],this._localPosition.value[2]=e[2],this._localPosition.didUpdate=!0,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"forward",{get:function(){var e;return(this.needsForwardUpdate||(null===(e=this.parent)||void 0===e?void 0:e.childUpdate.has(this)))&&(this.needsForwardUpdate=!1,o.rotateVectorByUnitQuat(o.forward3(),this._rotation.value,this._forward.value)),this._forward.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localForward",{get:function(){return this.needsForwardUpdate&&(this.needsForwardUpdate=!1,o.rotateVectorByUnitQuat(o.forward3(),this._localRotation.value,this._localForward.value)),this._localForward.value},enumerable:!0,configurable:!0}),t.prototype.applyLocalSRT=function(e,t,n){this._localScale.value=e,this._localPosition.value=n,this._localRotation.value=t,this._localScale.didUpdate=!0,this._localPosition.didUpdate=!0,this._localRotation.didUpdate=!0,this.invalidate(),this._instance&&(this._instance.transform=this)},t.prototype.decomposeWorldMatrix=function(){if(this.needsWorldDecomposition&&this.parent&&this._matrix.didUpdate&&this._matrix.value!==this._localMatrix.value){if(this._instance){if(!this._instance.needsWorldUpdate||!this.needsWorldOrientation)return}else if(!this.needsWorldOrientation)return;this.needsWorldDecomposition=!1;var e=this._matrix.value,t=this._position.value,n=this._scale.value;this._position.didUpdate=t[0]!==e[12]||t[1]!==e[13]||t[2]!==e[14],this._position.didUpdate&&o.apply3(t,e[12],e[13],e[14]);var r=o.length4Components(e[0],e[1],e[2],e[3]),i=o.length4Components(e[4],e[5],e[6],e[7]),a=o.length4Components(e[8],e[9],e[10],e[11]);this._scale.didUpdate=n[0]!==r||n[1]!==i||n[2]!==a,o.apply3(n,r,i,a),this._scale.didUpdate=!0;var s=this._rotation.value,u=s[0],c=s[1],l=s[2],h=s[3];o.decomposeRotation(this._matrix.value,r,i,a,this._rotation.value);var f=this._rotation.value;this._rotation.didUpdate=f[0]!==u||f[1]!==c||f[2]!==l||f[3]!==h}},t.prototype.lookAtLocal=function(e,t){o.lookAtQuat(o.subtract3(e,this._localPosition.value,o.V3R[0]),t||[0,1,0],this._localRotation.value),this._localRotation.didUpdate=!0,this.invalidate(),this.needsForwardUpdate=!0},t.prototype.divideMemory=function(){this._forward.value=o.forward3(),this._matrix.value=o.identity4(),this._rotation.value=o.oneQuat(),this._scale.value=[1,1,1],this._position.value=[0,0,0],this.hasViewMatrix&&this._viewMatrix&&this._localViewMatrix&&(this._viewMatrix.value=o.identity4())},t.prototype.mergeMemory=function(){this._forward.value=this._localForward.value,this._matrix.value=this._localMatrix.value,this._rotation.value=this._localRotation.value,this._scale.value=this._localScale.value,this._position.value=this._localPosition.value,this.hasViewMatrix&&this._viewMatrix&&this._localViewMatrix&&(this._viewMatrix.value=this._localViewMatrix.value)},t.prototype.setParent=function(t,n){t!==this.parent&&(t?this.parent||this.divideMemory():this.mergeMemory(),this.invalidate(),this.needsForwardUpdate=!0,this._localScale.didUpdate=!0,this._localRotation.didUpdate=!0,this._localPosition.didUpdate=!0,e.prototype.setParent.call(this,t,n))},t.prototype.invalidate=function(){return this.queueForUpdate(),e.prototype.invalidate.call(this)},t.prototype.optimize=function(){this.needsWorldOrientation=!1},t.prototype.queueForUpdate=function(){!this.isQueuedForUpdate&&this._instance&&this._instance.active&&(this.isQueuedForUpdate=!0,a.scheduleUpdate(this))},t.prototype.update=function(e){var t=!1;if(this.isQueuedForUpdate&&(a.resolveUpdate(this),this.isQueuedForUpdate=!1),this.needsUpdate){var n=this.localRotationMatrix;this._localRotation.didUpdate&&o.matrix3x3FromUnitQuatModel(this._localRotation.value,n),this._localTransform?(o.SRT4x4(this._localScale.value,n,this._localPosition.value,o.M4R[0]),o.multiply4x4(this._localTransform.value,o.M4R[0],this._localMatrix.value)):o.SRT4x4(this._localScale.value,n,this._localPosition.value,this._localMatrix.value),this._localMatrix.didUpdate=!0,t=!0,this.hasViewMatrix&&(void 0===this._viewMatrix&&(this._viewMatrix={value:o.identity4()}),void 0===this._localViewMatrix&&(this.parent?this._localViewMatrix={value:o.identity4()}:this._localViewMatrix={value:this._viewMatrix.value}),this._localViewTransform?(o.TRS4x4(o.inverse3(this._localScale.value,o.V3R[0]),o.transpose3x3(n,o.M3R[1]),o.scale3(this._localPosition.value,-1,o.V3R[1]),o.M4R[0]),o.multiply4x4(this._localViewTransform.value,o.M4R[0],this._localViewMatrix.value)):o.TRS4x4(o.inverse3(this._localScale.value,o.V3R[0]),o.transpose3x3(n,o.M3R[1]),o.scale3(this._localPosition.value,-1,o.V3R[1]),this._localViewMatrix.value),this._localViewMatrix.didUpdate=!0)}this.parent&&(this.parent.needsUpdate?(e||this.processParentUpdates((function(e){e.update(!0)})),t=!0):this.parent.childUpdate.has(this)&&(t=!0),t&&(o.multiply4x4(this.parent._matrix.value,this._localMatrix.value,this._matrix.value),this._matrix.didUpdate=!0,this.needsWorldDecomposition=!0,this.hasViewMatrix&&this._viewMatrix&&this._localViewMatrix&&(this.parent.hasViewMatrix&&this.parent._viewMatrix&&this.parent._localViewMatrix?o.multiply4x4(this.parent._viewMatrix.value,this._localViewMatrix.value,this._viewMatrix.value):(o.matrix3x3FromUnitQuatModel(this.parent.rotation,o.M3R[0]),o.TRS4x4(o.inverse3(this.parent._scale.value,o.V3R[0]),o.transpose3x3(o.M3R[0],o.M3R[1]),o.scale3(this.parent._position.value,-1,o.V3R[1]),o.M4R[0]),o.multiply4x4(this._localViewMatrix.value,o.M4R[0],this._viewMatrix.value)),this._viewMatrix.didUpdate=!0))),this.decomposeWorldMatrix(),this._instance&&this._instance.active&&(this._localMatrix.didUpdate||this._matrix.didUpdate)&&(this._instance.needsLocalUpdate&&(this._localRotation.didUpdate&&(this._instance._localRotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._localPosition=this._localPosition.value),this._localScale.didUpdate&&(this._instance._localScale=this._localScale.value)),this._instance.needsWorldUpdate&&(this.parent?(this._rotation.didUpdate&&(this._instance._rotation=this._rotation.value),this._scale.didUpdate&&(this._instance._scale=this._scale.value),this._position.didUpdate&&(this._instance._position=this._position.value)):(this._localRotation.didUpdate&&(this._instance._rotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._position=this._localPosition.value),this._localScale.didUpdate&&(this._instance._scale=this._localScale.value))),this._matrix.didUpdate&&(this._instance._matrix=this._matrix.value),this._localMatrix.didUpdate&&(this._instance._localMatrix=this._localMatrix.value,this.parent||(this._instance._matrix=this._matrix.value))),this._localScale.didUpdate=!1,this._localRotation.didUpdate=!1,this._localPosition.didUpdate=!1,this._rotation.didUpdate=!1,this._scale.didUpdate=!1,this._position.didUpdate=!1,this._matrix.didUpdate=!1,this._localMatrix.didUpdate=!1,this.resolve()},t}(n(54).TreeNode);t.Transform=s,t.IdentityTransform=new s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(8),o=n(2),a=Math.min,s=Math.max,u=Math.pow,c=Math.round,l=Math.sin,h=Math.PI,f=c(1e3*h)/1e3;function d(e,t,n){return a(s(e,t),n)}!function(e){e[e.NONE=1]="NONE",e[e.CONTINUOUS=4]="CONTINUOUS",e[e.REPEAT=2]="REPEAT",e[e.REFLECT=3]="REFLECT"}(r=t.AutoEasingLoopStyle||(t.AutoEasingLoopStyle={}));var p="\n${easingMethod} {\n  float p = 0.3;\n  float time = pow(2.0, -10.0 * t) * sin((t - p / 4.0) * (2.0 * "+f+") / p) + 1.0;\n  return (end - start) * time + start;\n}\n",g="\n${easingMethod} {\n  float time = t * t * t - t * 1.05 * sin(t * "+f+");\n  return (end - start) * time + start;\n}\n",v="\n${easingMethod} {\n  ${T} direction = end - start;\n  return start + direction * 0.5 + direction * sin(t * "+f+" * 2.0) * 0.5;\n}\n",y="\n${easingMethod} {\n  float p = 0.3;\n  float time = pow(2.0, -10.0 * t) * sin((t - p / 4.0) * (2.0 * "+f+") / p) + 1.0;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",m="\n${easingMethod} {\n  float time = t * t * t - t * 1.05 * sin(t * "+f+");\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",b=function(){function e(e,t,n,o){this.uid=i.uid(),this.delay=0,this.duration=500,this.loop=r.NONE,this.cpu=e,this.gpu=t,this.duration=n||500,this.methodName=o||"easingMethod"}return e.immediate=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){return(0,o.VecMath(e).copy)(t,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  return end;\n}\n",loop:n,methodName:"immediate"}},e.linear=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=o.VecMath(e),a=i.add,s=i.scale,u=i.subtract;return n=d(n,0,1),a(s(u(t,e),n),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  return (end - start) * t + start;\n}\n",loop:n,methodName:"linear"}},e.easeInQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=d(n,0,1))*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInQuad"}},e.easeOutQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=d(n,0,1))*(2-n),a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * (2.0 - t);\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeOutQuad"}},e.easeInOutQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=d(n,0,1))<.5?2*n*n:(4-2*n)*n-1,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t < 0.5 ? 2.0 * t * t : -1.0 + (4.0 - 2.0 * t) * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInOutQuad"}},e.easeInCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=d(n,0,1))*n*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInCubic"}},e.easeOutCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){n=d(n,0,1);var i=--n*n*n+1,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t1 * t1 * t1 + 1.0;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeOutCubic"}},e.easeInOutCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=d(n,0,1))<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t < 0.5 ? 4.0 * t * t * t : (t - 1.0) * (2.0 * t - 2.0) * (2.0 * t - 2.0) + 1.0;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInOutCubic"}},e.easeInQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=d(n,0,1))*n*n*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInQuart"}},e.easeOutQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){n=d(n,0,1);var i=1- --n*n*n*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = 1.0 - t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeOutQuart"}},e.easeInOutQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=d(n,0,1))<.5?8*n*n*n*n:1-8*--n*n*n*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t < 0.5 ? 8.0 * t * t * t * t : 1.0 - 8.0 * t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInOutQuart"}},e.easeInQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=d(n,0,1))*n*n*n*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t * t * t;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInQuint"}},e.easeOutQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){n=d(n,0,1);var i=1+--n*n*n*n*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = 1.0 + t1 * t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeOutQuint"}},e.easeInOutQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=d(n,0,1))<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t < 0.5 ? 16.0 * t * t * t * t * t : 1.0 + 16.0 * t1 * t1 * t1 * t1 * t1;\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeInOutQuint"}},e.easeOutElastic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){n=d(n,0,1);var i=u(2,-10*n)*l(2*h*(n-.075)/.3)+1,a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:p,loop:n,methodName:"easeOutElastic"}},e.easeBackIn=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=d(n,0,1))*n*n-1.05*n*l(n*h),a=o.VecMath(e);return(0,a.add)((0,a.scale)((0,a.subtract)(t,e),i),e,r)},delay:t,duration:e,gpu:g,loop:n,methodName:"easeBackIn"}},e.easeBackOut=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=(n=d(n,0,1))-1,a=i*i*(2.7*i+1.7)+1,s=o.VecMath(e);return(0,s.add)((0,s.scale)((0,s.subtract)(t,e),a),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float a = 1.7;\n  float time = (t1 * t1 * ((a + 1.0) * t1 + a) + 1.0);\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeBackOut"}},e.easeBackInOut=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){var i=2.5925,a=(n=d(n,0,1))/.5,s=a-2,u=a<1?.5*(a*a*(i+1)*a-i):.5*(s*s*((i+1)*s+i)+2),c=o.VecMath(e);return(0,c.add)((0,c.scale)((0,c.subtract)(t,e),u),e,r)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float a = 1.4;\n  float a1 = a * 1.525;\n  float t1 = t / 0.5;\n  float t2 = t1 - 2.0;\n  float time =\n    (t1 < 1.0) ? 0.5 * (t1 * t1 * (a1 + 1.0) * t1 - a1) :\n    0.5 * (t2 * t2 * ((a1 + 1.0) * t2 + a1) + 2.0)\n  ;\n\n  return (end - start) * time + start;\n}\n",loop:n,methodName:"easeBackInOut"}},e.continuousSinusoidal=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.CONTINUOUS),{uid:i.uid(),cpu:function(e,t,n,r){var i=o.VecMath(e),a=i.add,s=i.scale,u=i.subtract;n=d(n,0,1);var c=s(u(t,e),.5);return a(a(e,c),s(c,1*l(n*h*2)),r)},delay:t,duration:e,gpu:v,loop:n,methodName:"repeatingSinusoidal",validation:{ignoreEndValueCheck:!0,ignoreOverTimeCheck:!0}}},e.slerpQuatLinear=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}n=d(n,0,1);var a=o.VecMath(e),s=a.slerpQuat,u=a.vec;return s?s(e,t,n,r):u(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - t, t),\n    vec2(sin((1.0 - t) * omega) / sinom, sin(t * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatLinear"}},e.slerpQuatInQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=d(n,0,1))*n,s=o.VecMath(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,r):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatInQuad"}},e.slerpQuatOutQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=d(n,0,1))*(2-n),s=o.VecMath(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,r):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * (2.0 - t);\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatOutQuad"}},e.slerpQuatInOutQuad=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=d(n,0,1))<.5?2*n*n:(4-2*n)*n-1,s=o.VecMath(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,r):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t < 0.5 ? 2.0 * t * t : -1.0 + (4.0 - 2.0 * t) * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatInOutQuad"}},e.slerpQuatInCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=d(n,0,1))*n*n,s=o.VecMath(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,r):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatInCubic"}},e.slerpQuatOutCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}n=d(n,0,1);var a=--n*n*n+1,s=o.VecMath(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,r):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t1 * t1 * t1 + 1.0;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatOutCubic"}},e.slerpQuatInOutCubic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=d(n,0,1))<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,s=o.VecMath(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,r):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t < 0.5 ? 4.0 * t * t * t : (t - 1.0) * (2.0 * t - 2.0) * (2.0 * t - 2.0) + 1.0;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatInOutCubic"}},e.slerpQuatInQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=d(n,0,1))*n*n*n,s=o.VecMath(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,r):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatInQuart"}},e.slerpQuatOutQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}n=d(n,0,1);var a=1- --n*n*n*n,s=o.VecMath(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,r):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = 1.0 - t1 * t1 * t1 * t1;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatOutQuart"}},e.slerpQuatInOutQuart=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=d(n,0,1))<.5?8*n*n*n*n:1-8*--n*n*n*n,s=o.VecMath(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,r):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t < 0.5 ? 8.0 * t * t * t * t : 1.0 - 8.0 * t1 * t1 * t1 * t1;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatInOutQuart"}},e.slerpQuatInQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=d(n,0,1))*n*n*n*n,s=o.VecMath(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,r):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float time = t * t * t * t * t;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatInQuint"}},e.slerpQuatOutQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}n=d(n,0,1);var a=1+--n*n*n*n*n,s=o.VecMath(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,r):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = 1.0 + t1 * t1 * t1 * t1 * t1;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatOutQuint"}},e.slerpQuatInOutQuint=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=d(n,0,1))<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,s=o.VecMath(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,r):c(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float time = t < 0.5 ? 16.0 * t * t * t * t * t : 1.0 + 16.0 * t1 * t1 * t1 * t1 * t1;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatInOutQuint"}},e.slerpQuatOutElastic=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}n=d(n,0,1);var a=u(2,-10*n)*l(2*h*(n-.075)/.3)+1,s=o.VecMath(e),c=s.slerpQuat,f=s.vec;return c?c(e,t,a,r):f(1,0,0,0)},delay:t,duration:e,gpu:y,loop:n,methodName:"slerpQuatOutElastic"}},e.slerpQuatBackIn=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=d(n,0,1))*n*n-1.05*n*l(n*h),s=o.VecMath(e),u=s.slerpQuat,c=s.vec;return u?u(e,t,a,r):c(1,0,0,0)},delay:t,duration:e,gpu:m,loop:n,methodName:"slerpQuatBackIn"}},e.slerpQuatBackOut=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=(n=d(n,0,1))-1,s=a*a*(2.7*a+1.7)+1,u=o.VecMath(e),c=u.slerpQuat,l=u.vec;return c?c(e,t,s,r):l(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float t1 = t - 1.0;\n  float a = 1.7;\n  float time = (t1 * t1 * ((a + 1.0) * t1 + a) + 1.0);\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatBackOut"}},e.slerpQuatBackInOut=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=r.NONE),{uid:i.uid(),cpu:function(e,t,n,r){if(!o.isVec4(e)||!o.isVec4(t)||!o.isVec4(r)){var i=o.VecMath(t).vec;return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),i(1,0,0,0)}var a=2.5925,s=(n=d(n,0,1))/.5,u=s-2,c=s<1?.5*(s*s*(a+1)*s-a):.5*(u*u*((a+1)*u+a)+2),l=o.VecMath(e),h=l.slerpQuat,f=l.vec;return h?h(e,t,c,r):f(1,0,0,0)},delay:t,duration:e,gpu:"\n${easingMethod} {\n  float a = 1.4;\n  float a1 = a * 1.525;\n  float t1 = t / 0.5;\n  float t2 = t1 - 2.0;\n  float time =\n    (t1 < 1.0) ? 0.5 * (t1 * t1 * (a1 + 1.0) * t1 - a1) :\n    0.5 * (t2 * t2 * ((a1 + 1.0) * t2 + a1) + 2.0)\n  ;\n  float cosom = dot(start, end);\n  ${T} end1 = mix(end, -end, float(cosom < 0.0));\n  cosom = mix(cosom, -cosom, float(cosom < 0.0));\n\n  float omega = acos(cosom);\n  float sinom = sin(omega);\n\n  vec2 scale = mix(\n    vec2(1.0 - time, time),\n    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),\n    float(1.0 - cosom > 0.0000001)\n  );\n\n  return scale.x * start + scale.y * end1;\n}\n",loop:n,methodName:"slerpQuatBackInOut"}},e}();t.AutoEasingMethod=b},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(28),a=new Set;t.scheduleUpdate=a.add.bind(a),t.resolveUpdate=a.delete.bind(a);!function e(){return r(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,o.onAnimationLoop((function(){0!==a.size&&(a.forEach((function(e){return e.update()})),a.clear())}),void 0,Number.POSITIVE_INFINITY)];case 1:return t.sent(),e(),[2]}}))}))}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._children=[],this._needsUpdate=!1,this._childUpdate=new Set}return Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(e){this.setParent(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsUpdate",{get:function(){return this._needsUpdate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"childUpdate",{get:function(){return this._childUpdate},enumerable:!0,configurable:!0}),e.prototype.addChild=function(e,t){e.parent!==this&&(t||e.setParent(this,!0),this._children.push(e),this._childUpdate.add(e),e.invalidate())},e.prototype.invalidate=function(){if(this._needsUpdate)return!1;this._needsUpdate=!0;for(var e=0,t=this._children.length;e<t;++e){var n=this._children[e];this._childUpdate.add(n),n.invalidate()}return!0},e.prototype.processParentUpdates=function(e){if(this._parent&&this._parent._needsUpdate){for(var t=[],n=this._parent;n&&(t.push(n),n._parent&&n._parent.needsUpdate);)n=n._parent;for(var r=t.length-1;r>=0;--r){var i=t[r];e(i),i.resolve()}}},e.prototype.removeChild=function(e,t){e._parent===this&&(void 0===e._parent||t||e.setParent(void 0,!0),this._children.splice(this._children.indexOf(e),1),this._childUpdate.delete(e))},e.prototype.resolve=function(){this._needsUpdate&&(this._needsUpdate=!1,this._parent&&this._parent._childUpdate.delete(this))},e.prototype.setParent=function(e,t){this._parent!==e&&(t||(void 0!==e&&e.addChild(this,!0),this._parent&&this._parent.removeChild(this,!0)),this._parent=e,this.invalidate())},e}();t.TreeNode=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDefined=function(e){return null!=e},t.touchesHasStartView=function(e){return Array.isArray(e)?function(t){return e.indexOf(t.start.view.id)>=0}:function(t){return t.start.view.id===e}},t.touchesContainsStartView=function(e){return Array.isArray(e)?function(t){return t.start.views.find((function(t){return e.indexOf(t.view.id)>=0}))}:function(t){return t.start.views.find((function(t){return t.view.id===e}))}}},function(e,t,n){"use strict";function r(e){return e&&void 0!==e.call&&void 0!==e.apply}Object.defineProperty(t,"__esModule",{value:!0}),t.mapInjectDefault=function(e,t,n){var i=e.get(t);return void 0===i&&(i=r(n)?n():n,e.set(t,i)),i},t.mapGetWithDefault=function(e,t,n){var i=e.get(t);return void 0===i&&(i=r(n)?n():n),i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createAttribute=function(e){return e}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(86)),r(n(149)),r(n(31)),r(n(150)),r(n(39)),r(n(151))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uniformBufferInstanceBufferName="instanceData",t.activeAttributeName="_active",t.TO_RADIANS=Math.PI/180,t.TO_DEGREES=180/Math.PI},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(72),u=n(17),c=n(61),l=n(86),h=n(5)("performance"),f=function(e){function t(t,n){var r=e.call(this,n)||this;return r.container=new s.Scene,r.surface=t,r.init(n),r}return i(t,e),Object.defineProperty(t.prototype,"layers",{get:function(){return this.layerDiffs.items},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"views",{get:function(){return this.viewDiffs.items},enumerable:!0,configurable:!0}),t.prototype.init=function(e){var t=this;if(this.surface&&this.surface.gl){this.container=new s.Scene;var n=l.generateDefaultElements(this.surface.gl);this.layerDiffs=new c.ReactiveDiff({buildItem:function(e){return o(t,void 0,void 0,(function(){var t,n,r,i;return a(this,(function(o){return h("Building layer",e.key),this.surface?(t=e.init[0],n=e.init[1],(r=new t(this.surface,this,Object.assign({},t.defaultProps,n))).initializer=e,r.props.data.sync(),r.parent=n.parent,n.parent&&(n.parent.children?n.parent.children.push(r):n.parent.children=[r]),r.init(this.views)?(i=r.childLayers(),this.layerDiffs.inline(i),[2,r]):(console.warn("Error initializing layer:",n.key,"A layer was unable to be added to the surface. See previous warnings (if any) to determine why they could not be instantiated"),[2,null])):[2,null]}))}))},destroyItem:function(e,n){return o(t,void 0,void 0,(function(){return a(this,(function(t){return h("Destroying layer",e.key),n.destroy(),[2,!0]}))}))},updateItem:function(e,n){return o(t,void 0,void 0,(function(){var t,r,i;return a(this,(function(o){return t=e.init[1],n.willUpdateProps(t),t.data!==n.props.data&&t.data.sync(),n.shouldDrawView(n.props,t)&&(n.needsViewDrawn=!0),Object.assign(n.props,t),n.initializer.init[1]=n.props,n.didUpdateProps(),t.parent&&n.parent&&n.parent!==t.parent&&(r=n.parent.children||[],(i=r.indexOf(n)||-1)>-1&&r.splice(i,1)),n.parent=t.parent,n.willRebuildLayer?(this.layerDiffs.rebuild(),n.willRebuildLayer=!1):this.layerDiffs.inline(n.childLayers()),[2]}))}))}}),this.viewDiffs=new c.ReactiveDiff({buildItem:function(e){return o(t,void 0,void 0,(function(){var t;return a(this,(function(r){return this.surface?((t=new e.init[0](this,e.init[1])).props.camera=t.props.camera||n.camera,t.pixelRatio=this.surface.pixelRatio,t.resource=this.surface.resourceManager,this.surface.userInputManager.waitingForRender=!0,[2,t]):[2,null]}))}))},destroyItem:function(e,n){return o(t,void 0,void 0,(function(){return a(this,(function(e){return[2,!0]}))}))},updateItem:function(e,n){return o(t,void 0,void 0,(function(){var t;return a(this,(function(r){return t=e.init[1],n.willUpdateProps(t),n.shouldDrawView(n.props,t)&&(n.needsDraw=!0),Object.assign(n.props,t),n.didUpdateProps(),this.surface&&(this.surface.userInputManager.waitingForRender=!0),[2]}))}))}}),this.update(e)}},t.prototype.destroy=function(){delete this.container,this.layerDiffs.destroy(),this.viewDiffs.destroy()},t.prototype.removeLayer=function(e){if(this.layers){var t=this.layers.indexOf(e);if(t>=0)return void this.layers.splice(t,1)}},t.prototype.update=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.order=e.order,[4,this.viewDiffs.diff(e.views)];case 1:return t.sent(),[4,this.layerDiffs.diff(e.layers)];case 2:return t.sent(),this.views.forEach((function(e){return e.createRenderTarget()})),[2]}}))}))},t.DEFAULT_SCENE_ID="__default__",t}(u.IdentifyByKey);t.LayerScene=f},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r};Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){var t=this;this.willDispose=new Set,this.keyToItem=new Map,this.keyToInitializer=new Map,this.currentInitalizerIndex=0,this.currentInitializers=[],this._items=[],this.inlineDeferred=function(e){t.deferredInlining=e},this.inlineImmediate=function(e){var n;if(e.length>0&&t.currentInitializers&&t.currentItem){(n=t.currentInitializers).splice.apply(n,o([t.currentInitalizerIndex+1,0],e));for(var r=0,i=e.length;r<i;++r){e[r].parent=t.currentItem}}},this.inline=this.inlineImmediate,this.options=e}return Object.defineProperty(e.prototype,"items",{get:function(){return this._items.slice(0)},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,o;return i(this,(function(i){switch(i.label){case 0:for(e=[],t=0,n=this.currentInitializers.length;t<n;++t)r=this.currentInitializers[t],(o=this.keyToItem.get(r.key))&&e.push(this.options.destroyItem(r,o));return[4,Promise.all(e)];case 1:return i.sent(),[2]}}))}))},e.prototype.diff=function(e){return r(this,void 0,void 0,(function(){var t,n,o,a,s=this;return i(this,(function(u){switch(u.label){case 0:t=e.slice(0),this.currentInitializers=t,this._items=[],n=0,u.label=1;case 1:return n<t.length?(o=t[n],this.currentInitalizerIndex=n,this.currentInitializer=o,this.willDispose.has(o.key)?(a=this.keyToItem.get(o.key)||null)?(this.currentItem=a,[4,this.options.updateItem(o,a)]):[3,3]:[3,6]):[3,9];case 2:return u.sent(),[3,5];case 3:return[4,this.options.buildItem(o)];case 4:a=u.sent(),u.label=5;case 5:return a&&(this.keyToInitializer.set(o.key,o),this.willDispose.delete(o.key),this._items.push(a)),[3,8];case 6:return this.inline=this.inlineDeferred,[4,this.options.buildItem(o)];case 7:a=u.sent(),this.inline=this.inlineImmediate,a&&(this.currentItem=a,this.deferredInlining&&(this.inline(this.deferredInlining),delete this.deferredInlining),this.keyToItem.set(o.key,a),this.keyToInitializer.set(o.key,o),this._items.push(a)),u.label=8;case 8:return delete this.currentItem,n++,[3,1];case 9:return this.willDispose.forEach((function(e){return r(s,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t=this.keyToItem.get(e),n=this.keyToInitializer.get(e),t&&n?[4,this.options.destroyItem(n,t)]:[2];case 1:return r.sent()&&(this.keyToItem.delete(e),this.keyToInitializer.delete(e)),[2]}}))}))})),this.willDispose.clear(),this.keyToInitializer.forEach((function(e){s.willDispose.add(e.key)})),this.currentInitializers=[],delete this.currentItem,delete this.currentInitializer,[2]}}))}))},e.prototype.getByKey=function(e){return this.keyToItem.get(e)},e.prototype.rebuild=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.currentItem&&this.currentInitializer?(this.keyToItem.delete(this.currentItem.id),this.keyToInitializer.delete(this.currentItem.id),this.options.destroyItem(this.currentInitializer,this.currentItem),[4,this.options.buildItem(this.currentInitializer)]):[2];case 1:return(e=t.sent())&&(this.keyToItem.set(this.currentItem.id,e),this.keyToInitializer.set(this.currentItem.id,this.currentInitializer)),[2]}}))}))},e}();t.ReactiveDiff=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=function(){function e(){}return e.transparentShapeBlending={blending:{blendDst:r.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:r.GLSettings.Material.BlendingEquations.Add,blendSrc:r.GLSettings.Material.BlendingSrcFactor.SrcAlpha},culling:r.GLSettings.Material.CullSide.NONE},e.transparentImageBlending={blending:{blendSrc:r.GLSettings.Material.BlendingSrcFactor.One,blendDst:r.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:r.GLSettings.Material.BlendingEquations.Add},culling:r.GLSettings.Material.CullSide.NONE},e}();t.CommonMaterialOptions=i},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);!function(e){e[e.TEXCOORDS=0]="TEXCOORDS",e[e.IMAGE_SIZE=1]="IMAGE_SIZE"}(t.FontResourceRequestFetch||(t.FontResourceRequestFetch={})),t.fontRequest=function(e){return r({type:i.ResourceType.FONT},e)},t.preloadNumber=function(){return".101112131415161718191.202122232425262728292.303132333435363738393.404142434445464748494.505152535455565758595.606162636465666768696.707172737475767778797.808182838485868788898.909192939495969798999.000102030405060708090.$0$1$2$3$4$5$6$7$8$9$%0%1%2%3%4%5%6%7%8%9%-0-1-2-3-4-5-6-7-8-9-+0+1+2+3+4+5+6+7+8+9+)0)1)2)3)4)5)6)7)8)9)(0(1(2(3(4(5(6(7(8(9("}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(15),s=n(0),u=n(17),c=n(32),l=n(24),h=n(5)("performance");t.createAtlas=function(e){return o({key:"",type:s.ResourceType.ATLAS},e)},t.isAtlasResource=function(e){return e&&e.type===s.ResourceType.ATLAS};var f=function(e){function t(t){var n=e.call(this,t)||this;n.resourceReferences=new Map,n.type=s.ResourceType.ATLAS;var r=document.createElement("canvas");if(n.width=r.width=t.width,n.height=r.height=t.height,n.textureSettings=t.textureSettings,t.width<0||t.height<0)throw new Error("TextureSize Error: An atlas does NOT support Screen Texture sizing.");return n.packing=new c.PackNode(0,0,t.width,t.height),n.createTexture(r),n}return i(t,e),t.prototype.createTexture=function(e){var t;this.texture||(t=this.textureSettings?o({generateMipMaps:!0,premultiplyAlpha:!0},this.textureSettings):{generateMipMaps:!0,premultiplyAlpha:!0},this.texture=new a.Texture(o({data:e},t)))},t.prototype.destroy=function(){var e=this;this.texture.destroy(),this.resourceReferences.forEach((function(t){e.invalidateTexture(t.subtexture)}))},t.prototype.invalidateTexture=function(e){var t=[0,0];e.aspectRatio=1,e.atlasBL=t,e.atlasBR=t,e.atlasTL=t,e.atlasTR=t,e.isValid=!1,e.texture=null,e.pixelHeight=0,e.pixelWidth=0,delete e.source,e.video&&(e.video.monitor.destroy(),delete e.video)},t.prototype.resolveResources=function(){var e=this,t=[];this.resourceReferences.forEach((function(n,r){n.count<=0&&n.subtexture&&(h("A subtexture on an atlas has been invalidated as it is deemed no longer used: %o",n.subtexture),e.invalidateTexture(n.subtexture),t.push(r))}));for(var n=0,r=t.length;n<r;++n)this.resourceReferences.delete(t[n])},t.prototype.stopUsingResource=function(e){(this.resourceReferences.get(e.source)||{subtexture:e.texture||new l.SubTexture,count:0}).count--},t.prototype.useResource=function(e){(this.resourceReferences.get(e.source)||{subtexture:e.texture,count:0}).count++},t}(u.IdentifyByKey);t.Atlas=f},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(11),u=n(0),c=n(19),l=function(e){function t(t){var n=e.call(this,t)||this;return n.color=[0,0,0,1],n.depth=0,n.fontSize=12,n.maxScale=1,n.maxWidth=0,n.origin=[0,0],n.scale=1,n.text="",n.letterSpacing=0,n.preload=!1,n.glyphs=[],n.size=[0,0],n.truncatedText="",n.anchor={padding:0,paddingDirection:[0,0],type:c.AnchorType.TopLeft,x:0,y:0},n.anchor=t.anchor||n.anchor,n.color=t.color||n.color,n.depth=t.depth||n.depth,n.fontSize=t.fontSize||n.fontSize,n.maxScale=t.maxScale||n.maxScale,n.maxWidth=t.maxWidth||0,n.onReady=t.onReady,n.origin=t.origin,n.preload=t.preload||!1,n.scale=t.scale||n.scale,n.text=t.text||n.text,n.letterSpacing=t.letterSpacing||n.letterSpacing,t.anchor&&n.setAnchor(t.anchor),n}return i(t,e),t.prototype.getWidth=function(){return this.size[0]},t.prototype.setAnchor=function(e){var t={padding:e.padding||0,paddingDirection:e.paddingDirection,type:e.type,x:e.x||0,y:e.y||0};this.anchor=t},t.prototype.subTextGlyphs=function(e){var t=[],n=this.text.indexOf(e);if(n<0)return t;for(var r=0,i=0,o=Math.min(this.text.length,n+e.length);i<o;++i)u.isWhiteSpace(this.text[i])||(r++,i>=n&&t.push(this.glyphs[r]));return t},t.prototype.resourceTrigger=function(){},o([a.observable],t.prototype,"color",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"fontSize",void 0),o([a.observable],t.prototype,"maxScale",void 0),o([a.observable],t.prototype,"maxWidth",void 0),o([a.observable],t.prototype,"origin",void 0),o([a.observable],t.prototype,"scale",void 0),o([a.observable],t.prototype,"text",void 0),o([a.observable],t.prototype,"letterSpacing",void 0),o([a.observable],t.prototype,"anchor",void 0),t}(s.Instance);t.LabelInstance=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(0),o=n(25);!function(e){e[e.DOWN=0]="DOWN",e[e.UP=1]="UP"}(r=t.BoxSampleDirection||(t.BoxSampleDirection={})),t.boxSample=function(e){var t,a=e.output,s=e.input;return o.postProcess({printShader:e.printShader,view:Object.assign(a?{output:{buffers:(t={},t[i.FragmentOutputType.COLOR]=a,t),depth:!1}}:{},e.view),buffers:{color:s},shader:n(308),material:e.material,uniforms:[{name:"delta",size:i.UniformSize.ONE,update:function(){return e.direction===r.DOWN?1:.5}}]})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=n(46),o=n(2),a=n(27),s=n(55),u=n(95),c=n(96),l=new a.NoView;function h(e,t){return t.d&&e.d?t.d.depth-e.d.depth:0}function f(e,t){return e.touch.identifier-t.touch.identifier}l.fitViewtoViewport(new i.Bounds({x:0,y:0,width:100,height:100}),new i.Bounds({x:0,y:0,width:100,height:100}));var d=function(){function e(e,t,n,r){var i=this;this.eventCleanup=[],this._waitingForRender=!0,this.getViewsUnderPosition=function(e){var t=i.quadTree.query(e);return t.sort(h),t},this.resize=function(){i._waitingForRender=!0},this.context=e,this.surface=t,this.setControllers(n),this.addContextListeners(r)}return Object.defineProperty(e.prototype,"waitingForRender",{get:function(){return this._waitingForRender},set:function(e){if(this._waitingForRender=e,!e){this.quadTree=new c.QuadTree(0,0,0,0);for(var t=this.scenes,n=[],r=0,i=t.length;r<i;++r)for(var o=t[r],a=0,s=o.views.length;a<s;++a){var u=o.views[a];n.push(u.screenBounds)}this.quadTree.addAll(n)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scenes",{get:function(){return this.surface&&this.surface.sceneDiffs?this.surface.sceneDiffs.items:[]},enumerable:!0,configurable:!0}),e.prototype.addContextListeners=function(e){this.addMouseContextListeners(e),this.addTouchContextListeners()},e.prototype.addMouseContextListeners=function(e){var t=this,n=this.context;if(!r.isOffscreenCanvas(n)){var i,a=!1;if(e){var s=function(e){var r=u.eventElementPosition(e,n),o=t.getViewsUnderPosition(r);if(!(o.length<=0)){i={canClick:!1,currentPosition:r,deltaPosition:[0,0],previousPosition:r,start:r,startTime:Date.now(),startView:o[0].d,event:e,wheel:t.makeWheel(e),button:-1};var a=t.makeMouseInteraction(i);t.eventManagers.forEach((function(e){e.handleWheel(a)})),e.stopPropagation(),e.preventDefault()}};"onwheel"in n&&(n.onwheel=s),"addEventListener"in n&&(n.addEventListener("DOMMouseScroll",s),this.eventCleanup.push(["DOMMouseScroll",s]))}n.onmouseleave=function(e){if(!t.waitingForRender&&i){var r=u.eventElementPosition(e,n);i.deltaPosition=o.subtract2(r,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=r;var a=t.makeMouseInteraction(i);t.eventManagers.forEach((function(e){e.handleMouseOut(a)}))}},n.onmousemove=function(e){if(!t.waitingForRender){var r=u.eventElementPosition(e,n);if(!i){var s=t.getViewsUnderPosition(r);i={canClick:!1,currentPosition:r,deltaPosition:[0,0],previousPosition:r,start:r,startTime:Date.now(),startView:s[0].d,event:e,wheel:t.makeWheel(),button:-1}}i.deltaPosition=o.subtract2(r,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=r,i.canClick=!1;var c=t.makeMouseInteraction(i);t.eventManagers.forEach((function(e){e.handleMouseMove(c)})),a=!0}},n.onmousedown=function(e){if(!t.waitingForRender){var r=u.eventElementPosition(e,n),s=t.getViewsUnderPosition(r);if(!(s.length<=0)){i={canClick:!0,currentPosition:r,deltaPosition:[0,0],previousPosition:r,start:r,startTime:Date.now(),startView:s[0].d,event:e,wheel:t.makeWheel(),button:e.button};var c=t.makeMouseInteraction(i);t.eventManagers.forEach((function(e){e.handleMouseDown(c)})),e.stopPropagation(),document.onmousemove=function(e){if(i){if(!a){var r=u.eventElementPosition(e,n);i.deltaPosition=o.subtract2(r,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=r,i.canClick=!1}var s=t.makeMouseInteraction(i);t.eventManagers.forEach((function(e){e.handleDrag(s)})),e.preventDefault(),e.stopPropagation(),a=!1}},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null,document.onmouseover=null,i=void 0},document.onmouseover=function(e){if(i){var r=u.eventElementPosition(e,n);i.deltaPosition=o.subtract2(r,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=r;var a=t.makeMouseInteraction(i);t.eventManagers.forEach((function(e){e.handleMouseOver(a)})),e.stopPropagation()}},n.onmouseup=function(e){if(i){var r=u.eventElementPosition(e,n);i.deltaPosition=o.subtract2(r,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=r,i.button=e.button;var a=t.makeMouseInteraction(i);t.eventManagers.forEach((function(e){e.handleMouseUp(a)})),i.canClick&&Date.now()-i.startTime<1e3&&t.eventManagers.forEach((function(e){e.handleClick(a)})),i=void 0}};var l=n;void 0!==l.onselectstart?l.onselectstart=function(){return!1}:n.addEventListener("selectstart",(function(){e.preventDefault()}))}}}}},e.prototype.addTouchContextListeners=function(){var e=this,t=this.context;if(!r.isOffscreenCanvas(t)){var n=new Map,i=new Map,a={center:function(t){return t.length<=0?[0,0]:e.getTouchCenter(d(t))},centerDelta:function(t){if(t.length<=0)return[0,0];var n=d(t),r=e.getTouchCenter(n,(function(e){return e.previousPosition})),i=e.getTouchCenter(n);return o.subtract2(i,r)},centerStart:function(t){if(t.length<=0)return[0,0];var n=p(t).touch;return e.getTouchCenter(d(t),(function(e){return e===n?e.start:e.startRelative.get(n)||[0,0]}))},id:function(e){return d(e).sort(f).map((function(e){return e.touch.identifier})).join("_")},rotation:function(t){if(t.length<=0)return 0;var n=d(t),r=e.getTouchCenter(n);return e.getAverageAngle(n,r)},rotationDelta:function(t){if(t.length<=0)return 0;var n=d(t),r=e.getTouchCenter(n,(function(e){return e.previousPosition})),i=e.getAverageAngle(n,r,(function(e){return e.previousPosition})),o=e.getTouchCenter(n);return e.getAverageAngle(n,o)-i},rotationStart:function(t){if(t.length<=0)return 0;var n=p(t).touch,r=d(t),i=e.getTouchCenter(r,(function(e){return e===n?e.start:e.startRelative.get(n)||[0,0]}));return e.getAverageAngle(r,i,(function(e){return e===n?e.start:e.startRelative.get(n)||[0,0]}))},spread:function(t){if(t.length<=0)return 0;var n=d(t),r=e.getTouchCenter(n);return e.getAverageDistance(n,r)},spreadDelta:function(t){if(t.length<=0)return 0;var n=d(t),r=e.getTouchCenter(n,(function(e){return e.previousPosition})),i=e.getAverageDistance(n,r,(function(e){return e.previousPosition})),o=e.getTouchCenter(n);return e.getAverageDistance(n,o)-i},spreadStart:function(t){if(t.length<=0)return 0;var n=p(t).touch,r=d(t),i=e.getTouchCenter(r,(function(e){return e===n?e.start:e.startRelative.get(n)||[0,0]}));return e.getAverageDistance(r,i,(function(e){return e===n?e.start:e.startRelative.get(n)||[0,0]}))}};t.ontouchstart=function(t){t.preventDefault(),t.stopPropagation();for(var r=e.getTouches(t),o=[],f=[],d=0,p=r.length;d<p;++d){var g=r[d],v=n.get(g.identifier);if(v)o.push(v);else{var y=u.eventElementPosition(g),m=e.getViewsUnderPosition(y);if(m.length<=0)continue;var b=m[0].d,T={canTap:!0,currentPosition:y,deltaPosition:[0,0],startTime:Date.now(),start:y,startView:b,previousPosition:y,startRelative:new Map,touch:g};n.set(g.identifier,T),f.push(T)}}if(f.length>0){var _=f.concat(o),x=[];for(d=0,p=f.length;d<p;++d){for(var w=f[d],E=0,O=_.length;E<O;++E){w!==(g=_[E])&&g.startRelative.set(w,g.currentPosition)}var R=e.makeSingleTouchInteraction(w);x.push(R),i.set(w.touch.identifier,R)}var S={touches:x,allTouches:_.map((function(e){return i.get(e.touch.identifier)})).filter(s.isDefined),multitouch:a};e.eventManagers.forEach((function(e){e.handleTouchDown(S)}))}document.ontouchend=function(e){c.call(document,e),document.ontouchend=null,document.ontouchcancel=null,document.ontouchmove=null},document.ontouchcancel=function(e){h.call(document,e),document.ontouchend=null,document.ontouchcancel=null,document.ontouchmove=null},document.ontouchmove=l};var c=t.ontouchend=function(t){t.stopPropagation(),t.preventDefault();for(var r=e.getTouches(t,"changed"),o=Array.from(i.values()),s=[],u=function(t,u){var c=r[t],l=n.get(c.identifier);if(!l)return"continue";if(l.canTap&&Date.now()-l.startTime<200){var h={touches:[e.makeSingleTouchInteraction(l)],allTouches:o,multitouch:a};e.eventManagers.forEach((function(e){e.handleTap(h)}))}s.push(l),n.delete(c.identifier),i.delete(c.identifier)},c=0,l=r.length;c<l;++c)u(c);if(s.length>0){var h={touches:s.map((function(t){return e.makeSingleTouchInteraction(t)})),allTouches:o,multitouch:a};e.eventManagers.forEach((function(e){e.handleTouchUp(h)}))}},l=t.ontouchmove=function(t){t.stopPropagation(),t.preventDefault();for(var r=e.getTouches(t),c=[],l=[],h=0,f=r.length;h<f;++h){var d=r[h],p=n.get(d.identifier);if(p){var g=u.eventElementPosition(d),v=o.subtract2(g,p.currentPosition);if(o.length2(v)<=0){l.push(p),Object.assign(p,{currentPosition:g,deltaPosition:v,previousPosition:p.currentPosition,touch:d});continue}c.push(p),Object.assign(p,{canTap:!1,currentPosition:g,deltaPosition:v,previousPosition:p.currentPosition,touch:d})}}if(c.length>0){var y=c.concat(l),m={touches:c.map((function(t){return e.makeSingleTouchInteraction(t)})),allTouches:y.map((function(e){return i.get(e.touch.identifier)})).filter(s.isDefined),multitouch:a};e.eventManagers.forEach((function(e){e.handleTouchDrag(m)}))}},h=t.ontouchcancel=function(t){t.stopPropagation(),t.preventDefault();for(var r=e.getTouches(t,"changed"),o=Array.from(i.values()),s=[],u=0,c=r.length;u<c;++u){var l=r[u],h=n.get(l.identifier);h&&(s.push(h),n.delete(l.identifier),i.delete(l.identifier))}if(s.length>0){var f={touches:s.map((function(t){return e.makeSingleTouchInteraction(t)})),allTouches:o,multitouch:a};e.eventManagers.forEach((function(e){e.handleTouchCancelled(f)}))}}}function d(e){return e.map((function(e){return e.touch}))}function p(e){return e.reduce((function(e,t){return t.touch.startTime>e.touch.startTime?t:e}),e[0])}},e.prototype.getAverageDistance=function(e,t,n){var r=0;if(e.length<=0)return r;n||(n=function(e){return e.currentPosition});for(var i=0,a=e.length;i<a;++i){var s=e[i];r+=o.length2(o.subtract2(n(s),t))}return r/e.length},e.prototype.getAverageAngle=function(e,t,n){var r=0;if(e.length<=0)return r;n||(n=function(e){return e.currentPosition});for(var i=0,a=e.length;i<a;++i){var s=e[i],u=o.subtract2(n(s),t),c=Math.atan2(u[1],u[0]);c<0&&(c+=2*Math.PI),r+=c}return r/e.length},e.prototype.getTouchCenter=function(e,t){var n=[0,0];if(e.length<=0)return n;t||(t=function(e){return e.currentPosition});for(var r=0,i=e.length;r<i;++r){var a=t(e[r]);n=o.add2(n,a)}return o.scale2(n,1/e.length)},e.prototype.getTouches=function(e,t){var n=new Map;if(e.touches&&e.touches.length>0&&(!t||"touches"===t))for(var r=0,i=e.touches.length;r<i;++r){(o=e.touches.item(r))&&n.set(o.identifier,o)}if(e.changedTouches&&e.changedTouches.length>0&&(!t||"changed"===t))for(r=0,i=e.changedTouches.length;r<i;++r){(o=e.changedTouches.item(r))&&n.set(o.identifier,o)}if(e.targetTouches&&e.targetTouches.length>0&&(!t||"target"===t))for(r=0,i=e.targetTouches.length;r<i;++r){var o;(o=e.targetTouches.item(r))&&n.set(o.identifier,o)}return Array.from(n.values())},e.prototype.getView=function(e){for(var t=this.scenes,n=0,r=t.length;n<r;++n){var i=t[n].viewDiffs.getByKey(e);if(i)return i}return null},e.prototype.makeMouseInteraction=function(e){var t=this.getViewsUnderPosition(e.currentPosition),n=t[0]&&t[0].d;n||(n=l);var i=this.getViewsUnderPosition(e.start),o=e.startView;o||(o=l);var a={canvas:r.isOffscreenCanvas(this.context)?void 0:this.context,mouse:e,screen:{position:e.currentPosition},start:{position:o.projection.screenToView(e.start),view:o,views:i.map((function(t){return t.d||(t.d=l),{position:t.d.projection.screenToView(e.start),view:t.d}}))},target:{position:n.projection.screenToView(e.currentPosition),view:n,views:t.map((function(t){return t.d||(t.d=l),{position:t.d.projection.screenToView(e.currentPosition),view:t.d}}))}};return this.currentInteraction=a,a},e.prototype.makeSingleTouchInteraction=function(e){var t=e.currentPosition,n=this.getViewsUnderPosition(t),i=n[0]&&n[0].d;i||(i=l);var o=e.startView;o||(o=l);var a={canvas:r.isOffscreenCanvas(this.context)?void 0:this.context,touch:e,screen:{position:t},start:{position:o.projection.screenToView(e.start),view:o,views:this.getViewsUnderPosition(e.start).map((function(t){return t.d||(t.d=l),{position:t.d.projection.screenToView(e.start),view:t.d}}))},target:{position:i.projection.screenToView(t),view:i,views:n.map((function(e){return e.d||(e.d=l),{position:e.d.projection.screenToView(t),view:e.d}}))}};return this.currentInteraction=a,a},e.prototype.makeMultiTouchInteractions=function(e,t){e.sort(f);for(var n=this.allTouchCombinations(e),r=0,i=n.length;r<i;++r){var o=n[r],a=o.map((function(e){return e.touch.identifier})).join("_"),s=t.get(a);if(!s){var u=this.getTouchCenter(o);s={touches:o,averageSpreadDelta:0,startCenter:u,currentCenter:u,currentRotation:this.getAverageAngle(o,u),centerDelta:[0,0],rotationDelta:0},t.set(a,s)}}},e.prototype.updateMultiTouchInteractions=function(e,t){e.sort(f);for(var n=this.allTouchCombinations(e),r=0,i=n.length;r<i;++r){var a=n[r],s=a.map((function(e){return e.touch.identifier})).join("_"),u=t.get(s);if(u){var c=this.getTouchCenter(a),l=this.getAverageAngle(a,c);u.centerDelta=o.subtract2(c,u.currentCenter),u.currentCenter=c,u.rotationDelta=l-u.currentRotation,u.currentRotation=l}}},e.prototype.allTouchCombinations=function(e){for(var t=[],n=e.length,r=1<<n,i=1;i<r;i++){for(var o=[],a=0;a<n;a++)i&1<<a&&o.push(e[a]);t.push(o)}return t},e.prototype.makeWheel=function(e){if(!e)return{delta:[0,0]};var t=u.normalizeWheel(e);return{delta:[t.pixelX,t.pixelY]}},e.prototype.setControllers=function(e){this.eventManagers=e;for(var t=0,n=this.eventManagers;t<n.length;t++){n[t].setUserInputManager(this)}},e.prototype.destroy=function(){var e=this;delete this.quadTree,r.isOffscreenCanvas(this.context)||(this.context.onmousedown=null,this.context.onmousemove=null,this.context.onmouseleave=null);var t=this.context;t.onmousewheel&&(t.onmousewheel=null),this.eventCleanup.forEach((function(t){e.context.removeEventListener(t[0],t[1])}))},e}();t.UserInputEventManager=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(69),o=n(44),a=n(10),s=n(15),u=n(14),c=n(5)("performance");function l(e){return e&&e.buffer&&void 0!==e.buffer.byteOffset&&e.buffer.byteLength||null===e.buffer}function h(e){return 0==(e&e-1)}function f(e){return Boolean(e.gl&&e.gl.textureId&&e.gl.textureUnit>-1)}var d=function(){function e(e,t,n){this.debugContext="",this.fragmentShaders=new Map,this.vertexShaders=new Map,this.programs=new Map,this.gl=e,this.state=t,this.extensions=n}return e.addExtensions=function(e){var t=e.getExtension("ANGLE_instanced_arrays"),n=e.getExtension("WEBGL_draw_buffers"),r=e.getExtension("OES_texture_float"),i=e.getExtension("OES_texture_float_linear"),o=e.getExtension("OES_texture_half_float"),a=e.getExtension("OES_texture_half_float_linear"),s=e.getExtension("EXT_texture_filter_anisotropic"),u=e.getExtension("EXT_color_buffer_float"),l=e.getExtension("OES_vertex_array_object"),h={maxAnistropicFilter:0};return t||e instanceof WebGL2RenderingContext||c("This device does not have hardware instancing. All buffering strategies will be utilizing compatibility modes."),n||e instanceof WebGL2RenderingContext||c("This device does not have hardware multi-render target capabilities. The system will have to fallback to multiple render passes to multiple FBOs to achieve the same result."),s?h.maxAnistropicFilter=e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT):c("This device does not have hardware anisotropic filtering for textures. This property will be ignored when setting texture settings."),l||e instanceof WebGL2RenderingContext||c("This device does not support Vertex Array Objects. This could cause performance issues for high numbers of draw calls."),{instancing:(e instanceof WebGL2RenderingContext?e:t)||void 0,drawBuffers:(e instanceof WebGL2RenderingContext?e:n)||void 0,anisotropicFiltering:s?{ext:s,stat:h}:void 0,renderFloatTexture:u,floatTex:(e instanceof WebGL2RenderingContext?e:r)||void 0,floatTexFilterLinear:(e instanceof WebGL2RenderingContext?e:i)||void 0,halfFloatTex:(e instanceof WebGL2RenderingContext?e:o)||void 0,halfFloatTexFilterLinear:(e instanceof WebGL2RenderingContext?e:a)||void 0,vao:(e instanceof WebGL2RenderingContext?e:l)||void 0}},e.prototype.clear=function(e,t,n){var r=0;e&&(r|=this.gl.COLOR_BUFFER_BIT),t&&(r|=this.gl.DEPTH_BUFFER_BIT),n&&(r|=this.gl.STENCIL_BUFFER_BIT),this.gl.clear(r)},e.prototype.compileAttribute=function(e){if(!e.gl){var t=this.gl,n=t.createBuffer();return n?(this.state.bindVBO(n),t.bufferData(t.ARRAY_BUFFER,e.data,e.isDynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW),e.gl={bufferId:n,type:t.ARRAY_BUFFER,proxy:this},e.resolve(),!0):(console.warn(this.debugContext,"Could bot create WebGLBuffer. Printing any existing gl errors:"),void this.printError())}},e.prototype.compileGeometry=function(e){var t=this;if(!e.gl){var n=!0;if(e.gl={proxy:this},this.extensions.vao){var r=void 0;(r=this.extensions.vao instanceof WebGL2RenderingContext?this.extensions.vao.createVertexArray():this.extensions.vao.createVertexArrayOES())?(this.state.disableVertexAttributeArray(),this.state.bindVAO(r),e.attributes.forEach((function(n,r){t.updateAttribute(n)&&t.useAttribute(r,n,e)})),e.gl.vao=r,this.state.bindVAO(null)):c("WARNING: Could not make VAO for Geometry. This is fine, but this could cause a hit on performance.")}return e.attributes.forEach((function(e){n=Boolean(t.compileAttribute(e)&&n)})),n}},e.prototype.compileMaterial=function(e){var t=this;if(!e.gl){var n=this.vertexShaders.get(e.vertexShader)||null;if(!n){if(!(n=this.gl.createShader(this.gl.VERTEX_SHADER)))return console.warn(this.debugContext,"Could not create a Vertex WebGLShader. Printing GL Errors:"),void this.printError();if(this.gl.shaderSource(n,e.vertexShader),this.gl.compileShader(n),this.gl.isContextLost()&&console.warn("Context was lost during compilation"),!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS))return console.error(this.debugContext,"VERTEX SHADER COMPILER ERROR",e.name),console.warn("Could not compile provided shader. Printing logs and errors:"),console.warn(this.lineFormatShader(e.vertexShader)),console.warn("LOGS:"),console.warn(this.gl.getShaderInfoLog(n)),this.printError(),void this.gl.deleteShader(n)}var r=this.programs.get(n);r||(r=new Map,this.programs.set(n,r));var i={vsId:n,fsId:[],programId:[],proxy:this,programByTarget:new WeakMap,outputsByProgram:new WeakMap},o=new Set;e.fragmentShader.forEach((function(a){var s,u;if(r&&n){var c=t.fragmentShaders.get(a.source)||null;if(!c){if(!(c=t.gl.createShader(t.gl.FRAGMENT_SHADER)))return console.warn(t.debugContext,"Could not create a Fragment WebGLShader. Printing GL Errors:"),void t.printError();if(t.gl.shaderSource(c,a.source),t.gl.compileShader(c),t.gl.isContextLost()&&console.warn("Context was lost during compilation"),!t.gl.getShaderParameter(c,t.gl.COMPILE_STATUS))return console.error(t.debugContext,"FRAGMENT SHADER COMPILER ERROR:",e.name),console.warn("Could not compile provided shader. Printing logs and errors:"),console.warn(t.lineFormatShader(a.source)),console.warn("LOGS:"),console.warn(t.gl.getShaderInfoLog(c)),t.printError(),void t.gl.deleteShader(c)}var l=r.get(c)||null;if(l)l.useCount++;else{var h=t.gl.createProgram();if(!h)return console.warn(t.debugContext,"Could not create a WebGLProgram. Printing GL Errors:"),void t.printError();if(l={useCount:1,program:h},t.gl.attachShader(h,n),t.gl.attachShader(h,c),t.gl.linkProgram(h),t.gl.validateProgram(h),!t.gl.getProgramParameter(h,t.gl.LINK_STATUS)||!t.gl.getProgramParameter(h,t.gl.VALIDATE_STATUS)){var f=t.gl.getProgramInfoLog(h);return console.warn(t.debugContext,"Could not compile WebGL program. \n\n",f),t.printError(),void t.gl.deleteProgram(h)}r.set(c,l)}null===(s=i.fsId)||void 0===s||s.push({id:c,outputTypes:a.outputTypes}),null===(u=i.programId)||void 0===u||u.push({id:l.program,outputTypes:a.outputTypes}),i.outputsByProgram.set(l.program,a.outputTypes),t.state.useProgram(l.program);var d=t.state.currentProgram;if(!d)return!1;for(var p=t.gl.getProgramParameter(d,t.gl.ACTIVE_UNIFORMS),g=0;g<p;g++){var v=t.gl.getActiveUniform(d,g);v&&o.add(v.name.replace("[0]",""))}}})),e.gl=i;var a=new Set;return Object.keys(e.uniforms).forEach((function(e){o.has(e)||a.add(e)})),a.forEach((function(t){delete e.uniforms[t]})),Object.keys(e.uniforms).length===o.size||(console.warn(this.debugContext,"A program is requesting a set of uniforms:",Array.from(o.values()),"but our material only provides",Object.keys(e.uniforms),"thus the expected rendering will be considered invalid."),!1)}},e.prototype.compileRenderTarget=function(e){var t=this;if(e.isInvalid)return!1;if(e.gl)return!0;var n=this.gl,r=n.createFramebuffer();if(!r)return console.warn(this.debugContext,"Could not generate a frame buffer object. Printing GL errors:"),this.printError(),!1;this.state.bindFBO(r);var a={fboId:r,proxy:this,fboByMaterial:new WeakMap};if(Array.isArray(e.buffers.color)){if(!this.extensions.drawBuffers)return console.warn("Attempted to manage a render target with MRT but the hardware does not support MRT. Use multiple render targets instead."),!1;var u=[],c=!0;a.colorBufferId=u;var l=e.buffers.color.length<=1;if(e.buffers.color.forEach((function(r,i){if(c)if(r.buffer instanceof s.Texture){var a=o.indexToColorAttachment(n,t.extensions,i,l,!1);u.push({data:r.buffer,outputType:r.outputType,attachment:a}),f(r.buffer)?n.framebufferTexture2D(n.FRAMEBUFFER,a,n.TEXTURE_2D,r.buffer.gl.textureId,0):(console.warn(t.debugContext,"Attempted to compile render target whose target texture was not ready for use."),c=!1)}else{var h=t.compileColorBuffer(r.buffer,e.width,e.height);if(h){a=o.indexToColorAttachment(n,t.extensions,i,l,!1);u.push({data:h,outputType:r.outputType,attachment:a}),n.framebufferRenderbuffer(n.FRAMEBUFFER,a,n.RENDERBUFFER,h)}}})),!c)return!1}else if(void 0!==e.buffers.color){var h;if((h=e.buffers.color).buffer instanceof s.Texture){var d=o.indexToColorAttachment(n,this.extensions,0,!0,!1);if(a.colorBufferId={data:h.buffer,outputType:h.outputType,attachment:d},!f(h.buffer))return console.warn(this.debugContext,"Attempted to compile render target whose target texture was not ready for use."),!1;n.framebufferTexture2D(n.FRAMEBUFFER,d,n.TEXTURE_2D,h.buffer.gl.textureId,0)}else{if(p=this.compileColorBuffer(h.buffer,e.width,e.height)){d=o.indexToColorAttachment(n,this.extensions,0,!0,!1);a.colorBufferId={data:p,outputType:h.outputType,attachment:d},n.framebufferRenderbuffer(n.FRAMEBUFFER,d,n.RENDERBUFFER,p)}}}if(void 0!==e.buffers.depth)if((h=e.buffers.depth)instanceof s.Texture)a.depthBufferId=h,f(h)&&n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,h.gl.textureId,0);else if(h instanceof i.ColorBuffer){(p=this.compileDepthBuffer(o.depthBufferFormat(n,h.internalFormat),e.width,e.height))&&(a.depthBufferId=p,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,p))}else{var p;(p=this.compileDepthBuffer(h,e.width,e.height))&&(a.depthBufferId=p,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,p))}void 0!==e.buffers.stencil&&((h=e.buffers.stencil)instanceof s.Texture?(a.stencilBufferId=h,f(h)&&n.framebufferTexture2D(n.FRAMEBUFFER,n.STENCIL_ATTACHMENT,n.TEXTURE_2D,h.gl.textureId,0)):(p=this.compileStencilBuffer(h,e.width,e.height))&&(a.stencilBufferId=p,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.STENCIL_ATTACHMENT,n.RENDERBUFFER,p)));e.gl=a;var g=n.checkFramebufferStatus(n.FRAMEBUFFER),v=!1,y=!1,m="";switch(g){case n.FRAMEBUFFER_COMPLETE:e.setAsValid();break;case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:m="FRAMEBUFFER_INCOMPLETE_ATTACHMENT";break;case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:m="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";break;case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:m="FRAMEBUFFER_INCOMPLETE_DIMENSIONS";break;case n.FRAMEBUFFER_UNSUPPORTED:m="FRAMEBUFFER_UNSUPPORTED";break;default:v=!0}if(n instanceof WebGL2RenderingContext)switch(g){case n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:m="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE";break;case n.RENDERBUFFER_SAMPLES:m="RENDERBUFFER_SAMPLES";break;default:y=!0}return v&&y&&(console.warn(this.debugContext,"A framebuffer check failed to return a known result. This FBO for render target will be assumed failed"),console.warn("Result:",g,"Render Target:",e),m="UNKNOWN"),!m||(console.warn(this.debugContext,"When creating a new FrameBuffer Object, the check on the framebuffer failed. Printing Errors:"),console.warn(m),this.printError(),console.warn("FAILED RENDER TARGET:",e),delete e.gl,e.isInvalid=!0,!1)},e.prototype.compileDepthBuffer=function(e,t,n){var r=this.gl,i=r.createRenderbuffer();return i?(this.state.bindRBO(i),r.renderbufferStorage(r.RENDERBUFFER,o.depthBufferFormat(r,e),t,n),i):(console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),void this.printError())},e.prototype.compileStencilBuffer=function(e,t,n){var r=this.gl,i=r.createRenderbuffer();return i?(this.state.bindRBO(i),r.renderbufferStorage(r.RENDERBUFFER,o.stencilBufferFormat(r,e),t,n),i):(console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),void this.printError())},e.prototype.compileColorBuffer=function(e,t,n){var r=this.gl,i=r.createRenderbuffer();return i?(this.state.bindRBO(i),r.renderbufferStorage(r.RENDERBUFFER,o.colorBufferFormat(r,e.internalFormat),t,n),e.gl={bufferId:i,proxy:this},i):(console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),void this.printError())},e.prototype.compileTexture=function(e){if(e.gl&&!e.gl.textureId){if(!(e.gl.textureUnit<0)){this.state.setActiveTextureUnit(e.gl.textureUnit);var t=this.gl.createTexture();return t?(e.gl.textureId=t,e.needsDataUpload=!0,e.needsSettingsUpdate=!0,this.updateTextureData(e),this.updateTextureSettings(e),!0):(console.warn(this.debugContext,"Could not generate a texture object on the GPU. Printing any gl errors:"),void this.printError())}console.warn(this.debugContext,"A Texture object attempted to be compiled without an established Texture Unit.",e)}},e.prototype.draw=function(e){var t,n=this,r=[0,0];r=e.vertexDrawRange&&e.vertexDrawRange[0]>=0&&e.vertexDrawRange[1]>=0?[e.vertexDrawRange[0],e.vertexDrawRange[1]-e.vertexDrawRange[0]]:[0,e.vertexCount],e.drawInstances>=0&&e.geometry.isInstanced&&(t=this.extensions.instancing),(u.WebGLStat.MRT||u.WebGLStat.MRT_EXTENSION)&&this.state.renderTarget&&!this.state.drawBuffers.find((function(e){return e!==n.gl.NONE}))||(t&&t instanceof WebGL2RenderingContext?t.drawArraysInstanced(o.drawMode(this.gl,e.drawMode),r[0],r[1],e.drawInstances):t?t.drawArraysInstancedANGLE(o.drawMode(this.gl,e.drawMode),r[0],r[1],e.drawInstances):this.gl.drawArrays(o.drawMode(this.gl,e.drawMode),r[0],r[1]),this.state.setDrawBuffers([],!0))},e.prototype.disposeAttribute=function(e){e.gl&&(this.gl.deleteBuffer(e.gl.bufferId),delete e.gl)},e.prototype.disposeColorBuffer=function(e){e.gl&&(e.gl.bufferId&&this.disposeRenderBuffer(e.gl.bufferId),delete e.gl)},e.prototype.disposeGeometry=function(e){e.gl&&this.extensions.vao&&e.gl.vao&&(this.extensions.vao instanceof WebGL2RenderingContext?this.extensions.vao.deleteVertexArray(e.gl.vao):this.extensions.vao.deleteVertexArrayOES(e.gl.vao))},e.prototype.disposeMaterial=function(e){if(e.gl){var t=e.gl,n=t.vsId,r=t.fsId,i=t.programId,o=this.programs.get(n);o||(o=new Map,this.gl.deleteShader(n));for(var a=function(e,t){var a=r[e],u=o.get(a);u||(u={useCount:0,program:i}),u.useCount--,u.useCount<1&&(s.gl.deleteProgram(u.program),o.delete(a),o.size<=0&&s.gl.deleteShader(n));var c=!1;s.programs.forEach((function(e){e.has(a)&&(c=!0)})),c||s.gl.deleteShader(a)},s=this,u=0,c=r.length;u<c;++u)a(u)}delete e.gl},e.prototype.disposeRenderBuffer=function(e){this.gl.deleteRenderbuffer(e)},e.prototype.disposeRenderTarget=function(e){var t=this;e.gl&&(Array.isArray(e.gl.colorBufferId)?e.gl.colorBufferId.forEach((function(n){n.data instanceof s.Texture&&!e.retainTextureTargets?t.disposeTexture(n.data):n.data instanceof WebGLRenderbuffer&&t.disposeRenderBuffer(n.data)})):e.gl.colorBufferId&&e.gl.colorBufferId.data instanceof s.Texture&&!e.retainTextureTargets?this.disposeTexture(e.gl.colorBufferId.data):e.gl.colorBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.colorBufferId.data),e.gl.depthBufferId instanceof s.Texture&&!e.retainTextureTargets?this.disposeTexture(e.gl.depthBufferId):e.gl.depthBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.depthBufferId),e.gl.stencilBufferId instanceof s.Texture&&!e.retainTextureTargets?this.disposeTexture(e.gl.stencilBufferId):e.gl.stencilBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.stencilBufferId),this.gl.deleteFramebuffer(e.gl.fboId),delete e.gl)},e.prototype.disposeTexture=function(e){e.gl&&!e.destroyed&&(this.gl.deleteTexture(e.gl.textureId),this.state.freeTextureUnit(e)),delete e.gl},e.getContext=function(t,n){for(var r=[u.WebGLStat.WEBGL_VERSION,"webgl","webgl2","experimental-webgl"],i=null,o={},a=0;a<r.length;++a){var s=r[a],l=t.getContext(s,n);if(l&&(l instanceof WebGLRenderingContext||l instanceof WebGL2RenderingContext)){c("Generated GL Context of version with attributes:",s,n),i=l,o=e.addExtensions(i);break}}return{context:i,extensions:o}},e.prototype.printError=function(){var e=this.gl.getError();switch(e){case this.gl.NO_ERROR:console.warn("GL Error: No Error");break;case this.gl.INVALID_ENUM:console.warn("GL Error: INVALID ENUM");break;case this.gl.INVALID_VALUE:console.warn("GL Error: INVALID_VALUE");break;case this.gl.INVALID_OPERATION:console.warn("GL Error: INVALID OPERATION");break;case this.gl.INVALID_FRAMEBUFFER_OPERATION:console.warn("GL Error: INVALID FRAMEBUFFER OPERATION");break;case this.gl.OUT_OF_MEMORY:console.warn("GL Error: OUT OF MEMORY");break;case this.gl.CONTEXT_LOST_WEBGL:console.warn("GL Error: CONTEXT LOST WEBGL");break;default:console.warn("GL Error: GL Context output an unrecognized error value:",e)}},e.prototype.lineFormat=function(e){var t=e.split("\n"),n=String(t.length).length+1;return"\n"+t.map((function(e,t){return""+Array(n-String(t+1).length).join(" ")+(t+1)+": "+e})).join("\n")},e.prototype.lineFormatShader=function(e){var t=this;return r.isString(e)?this.lineFormat(e):e.forEach((function(e){return"\nSHADER FOR OUTPUT TYPES: "+e.outputTypes+" "+t.lineFormat(e.source)}))},e.prototype.updateTexture=function(e){!e.gl||e.gl.textureUnit<0?console.warn(this.debugContext,"Can not update or compile a texture that does not have an established texture unit.",e):(this.compileTexture(e),this.updateTextureData(e),this.updateTexturePartialData(e),this.updateTextureSettings(e),e.resolve())},e.prototype.updateTextureData=function(e){if(e.needsDataUpload&&e.gl&&e.gl.textureId)if(e.gl.textureUnit<0)console.warn(this.debugContext,"A Texture object attempted to update it's data without an established Texture Unit.",e);else{var t=this.gl;if(this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,a.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D),e.needsSettingsUpdate=!0,this.updateTextureSettings(e),t instanceof WebGLRenderingContext||t instanceof WebGL2RenderingContext){if(l(e.data)){h(e.data.width)&&h(e.data.height)||c("Created a texture that is not using power of 2 dimensions.");var n=o.texelFormat(t,e.internalFormat),r=o.texelFormat(t,e.format);t instanceof WebGLRenderingContext&&n!==r&&console.warn("WebGL 1 requires format and data format to be identical"),t.texImage2D(t.TEXTURE_2D,0,n,e.data.width,e.data.height,0,r,o.inputImageFormat(t,e.type),e.data.buffer)}else e.data&&(h(e.data.width)&&h(e.data.height)||c("Created a texture that is not using power of 2 dimensions. %o",e),t.texImage2D(t.TEXTURE_2D,0,o.texelFormat(t,e.internalFormat),o.texelFormat(t,e.format),o.inputImageFormat(t,e.type),e.data));e.generateMipMaps&&t.generateMipmap(t.TEXTURE_2D)}e.data&&(e.data={width:e.data.width,height:e.data.height,buffer:null}),e.needsDataUpload=!1}},e.prototype.updateTexturePartialData=function(e){if(e.needsPartialDataUpload&&e.gl&&e.gl.textureId)if(e.gl.textureUnit<0)console.warn(this.debugContext,"A Texture object attempted to update it's data without an established Texture Unit.",e);else{var t=this.gl;this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,a.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D),e.updateRegions.forEach((function(n){var r=n[0],i=n[1];(t instanceof WebGLRenderingContext||t instanceof WebGL2RenderingContext)&&(l(r)?t.texSubImage2D(t.TEXTURE_2D,0,i.x,i.y,r.width,r.height,o.texelFormat(t,e.format),o.inputImageFormat(t,e.type),r.buffer):r&&t.texSubImage2D(t.TEXTURE_2D,0,i.x,i.y,o.texelFormat(t,e.format),o.inputImageFormat(t,e.type),r),e.generateMipMaps&&t.generateMipmap(t.TEXTURE_2D))})),e.needsPartialDataUpload=!1}},e.prototype.updateTextureSettings=function(e){if(e.needsSettingsUpdate&&e.gl&&e.data&&e.gl.textureId)if(e.gl.textureUnit<0)console.warn(this.debugContext,"A Texture object attempted to update it's settings without an established Texture Unit.",e);else{var t,n,r=h(e.data.width)&&h(e.data.height),i=this.gl;if(this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,a.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D),e.isHalfFloatTexture)if(u.WebGLStat.FLOAT_TEXTURE_READ.halfLinearFilter)switch(t=o.magFilter(i,e.magFilter),e.minFilter){case a.GLSettings.Texture.TextureMinFilter.Nearest:case a.GLSettings.Texture.TextureMinFilter.NearestMipMapLinear:case a.GLSettings.Texture.TextureMinFilter.NearestMipMapNearest:n=o.minFilter(i,a.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);break;case a.GLSettings.Texture.TextureMinFilter.Linear:case a.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear:case a.GLSettings.Texture.TextureMinFilter.LinearMipMapNearest:n=o.minFilter(i,a.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps)}else t=o.magFilter(i,a.GLSettings.Texture.TextureMagFilter.Nearest),n=o.minFilter(i,a.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);else if(e.isFloatTexture)if(u.WebGLStat.FLOAT_TEXTURE_READ.fullLinearFilter)switch(t=o.magFilter(i,e.magFilter),e.minFilter){case a.GLSettings.Texture.TextureMinFilter.Nearest:case a.GLSettings.Texture.TextureMinFilter.NearestMipMapLinear:case a.GLSettings.Texture.TextureMinFilter.NearestMipMapNearest:n=o.minFilter(i,a.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);break;case a.GLSettings.Texture.TextureMinFilter.Linear:case a.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear:case a.GLSettings.Texture.TextureMinFilter.LinearMipMapNearest:n=o.minFilter(i,a.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps)}else t=o.magFilter(i,a.GLSettings.Texture.TextureMagFilter.Nearest),n=o.minFilter(i,a.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);else!r&&i instanceof WebGLRenderingContext?(t=o.magFilter(i,a.GLSettings.Texture.TextureMagFilter.Linear),n=o.minFilter(i,a.GLSettings.Texture.TextureMinFilter.Linear,e.generateMipMaps)):(t=o.magFilter(i,e.magFilter),n=o.minFilter(i,e.minFilter,e.generateMipMaps));if(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n),e.isFloatTexture||(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,o.wrapMode(i,e.wrapHorizontal)),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,o.wrapMode(i,e.wrapVertical))),e.isFloatTexture||(i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e.flipY)),this.extensions.anisotropicFiltering){var s=this.extensions.anisotropicFiltering,c=s.ext,l=s.stat,f=Math.min(l.maxAnistropicFilter,Math.floor(e.anisotropy));isNaN(f)||e.isFloatTexture||i.texParameterf(i.TEXTURE_2D,c.TEXTURE_MAX_ANISOTROPY_EXT,f)}e.needsSettingsUpdate=!1}},e.prototype.updateAttribute=function(e){if(!e.gl)return this.compileAttribute(e);if(!e.fullUpdate&&!e.needsUpdate)return!0;var t=this.gl;if(e.fullUpdate||e.updateRange.count<0||e.updateRange.offset<0)this.state.bindVBO(e.gl.bufferId),t.bufferData(t.ARRAY_BUFFER,e.data,e.isDynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW);else if(e.updateRange.count>0){this.state.bindVBO(e.gl.bufferId);var n=e.updateRange.offset;t.bufferSubData(t.ARRAY_BUFFER,4*n,e.data.subarray(n,n+e.updateRange.count))}return e.resolve(),!0},e.prototype.useAttribute=function(e,t,n){if(!this.state.currentProgram)return!1;if(!t.gl)return!1;t.gl.locations=t.gl.locations||new Map;var r=t.gl.locations.get(this.state.currentProgram);if(void 0===r&&(-1===(r=this.gl.getAttribLocation(this.state.currentProgram,e))&&c("WARN: An attribute is not being used with the current material: %o",e,t),t.gl.locations.set(this.state.currentProgram,r)),-1!==r){switch(this.state.bindVBO(t.gl.bufferId),t.size){case 1:case 2:case 3:case 4:this.state.willUseVertexAttributeArray(r),this.gl.vertexAttribPointer(r,t.size,this.gl.FLOAT,t.normalize,0,0),n.isInstanced&&t.isInstanced&&this.extensions.instancing?this.state.setVertexAttributeArrayDivisor(r,1):this.state.setVertexAttributeArrayDivisor(r,0);break;default:for(var i=Math.ceil(t.size/4),o=0;o<i;++o)this.state.willUseVertexAttributeArray(r+o),this.gl.vertexAttribPointer(r+o,4,this.gl.FLOAT,t.normalize,4*i*4,16*o),n.isInstanced&&t.isInstanced&&this.extensions.instancing?this.state.setVertexAttributeArrayDivisor(r+o,1):this.state.setVertexAttributeArrayDivisor(r+o,0)}return!0}},e}();t.GLProxy=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=function(){function e(e){var t;this._destroyed=!1,this._internalFormat=r.GLSettings.RenderTarget.ColorBufferFormat.RGBA4,this.needsSettingsUpdate=!1,this._size=[0,0],this.size=e.size||this.size,this.internalFormat=null!==(t=e.internalFormat)&&void 0!==t?t:this.internalFormat}return Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"internalFormat",{get:function(){return this._internalFormat},set:function(e){this.needsSettingsUpdate=!0,this._internalFormat=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){this.needsSettingsUpdate=!0,this._size=e},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.gl&&this.gl.proxy.disposeColorBuffer(this),this._destroyed=!0},e}();t.ColorBuffer=i},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,c=[],l=!1,h=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&d())}function d(){if(!l){var e=s(f);l=!0;for(var t=c.length;t;){for(u=c,c=[];++h<t;)u&&u[h].run();h=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||l||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(0),o=n(44),a=n(10),s=n(45),u=n(26),c=n(5)("performance"),l=function(){function e(e,t){this.debugContext="",this._textureUnitToTexture=new Map,this._freeUnits=[],this._blendingEnabled=!0,this._blendDstFactor=a.GLSettings.Material.BlendingDstFactor.One,this._blendSrcFactor=a.GLSettings.Material.BlendingDstFactor.One,this._blendEquation=a.GLSettings.Material.BlendingEquations.Add,this._cullFace=a.GLSettings.Material.CullSide.NONE,this._colorMask=[!0,!0,!0,!0],this._clearColor=[0,0,0,1],this._depthFunc=a.GLSettings.Material.DepthFunctions.ALWAYS,this._depthTestEnabled=!0,this._depthMask=!0,this._ditheringEnabled=!0,this._boundFBO=null,this._boundRBO=null,this._boundVAO=null,this._boundVBO=null,this._boundTexture={id:null,unit:-1},this._currentProgram=null,this._scissorTestEnabled=!1,this._scissorBounds={x:0,y:0,width:1,height:1},this._activeTextureUnit=-1,this._drawBuffers=[],this._textureWillBeUsed=new Map,this._viewport={x:0,y:0,width:100,height:100},this._enabledVertexAttributeArray=[],this._willUseVertexAttributeArray=[],this._vertexAttributeArrayDivisor=new Map,this.gl=e,this.extensions=t;for(var n=this.gl.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),r=0;r<n;++r)this._freeUnits.push(o.indexToTextureUnit(e,r));this._activeTextureUnit=e.TEXTURE0}return Object.defineProperty(e.prototype,"blendingEnabled",{get:function(){return this._blendingEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendDstFactor",{get:function(){return this._blendDstFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendSrcFactor",{get:function(){return this._blendSrcFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendEquation",{get:function(){return this._blendEquation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorMask",{get:function(){return this._colorMask},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clearColor",{get:function(){return this._clearColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTestEnabled",{get:function(){return this._depthTestEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ditheringEnabled",{get:function(){return this._ditheringEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundFBO",{get:function(){return this._boundFBO},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundRBO",{get:function(){return this._boundRBO},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundVAO",{get:function(){return this._boundVAO},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundVBO",{get:function(){return this._boundVBO},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundTexture",{get:function(){return this._boundTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentProgram",{get:function(){return this._currentProgram},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scissorTestEnabled",{get:function(){return this._scissorTestEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scissorBounds",{get:function(){return this._scissorBounds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentUniforms",{get:function(){return this._currentUniforms},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeTextureUnit",{get:function(){return this._activeTextureUnit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawBuffers",{get:function(){return this._drawBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureWillBeUsed",{get:function(){return this._textureWillBeUsed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabledVertexAttributeArray",{get:function(){return this._enabledVertexAttributeArray.slice(0).filter((function(e){return void 0!==e}))},enumerable:!0,configurable:!0}),e.prototype.bindVAO=function(e){this._boundVAO!==e&&(this._boundVAO=e,this.extensions.vao&&(this.extensions.vao instanceof WebGL2RenderingContext?this.extensions.vao.bindVertexArray(e):this.extensions.vao.bindVertexArrayOES(e)))},e.prototype.bindVBO=function(e){this._boundVBO!==e&&(this._boundVBO=e,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e))},e.prototype.bindRBO=function(e){this._boundRBO!==e&&(this._boundRBO=e,this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,e))},e.prototype.bindFBO=function(e){this._boundFBO!==e&&(this._boundFBO=e,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e))},e.prototype.bindTexture=function(e,t){if(e.gl&&e.gl.textureId&&(!e||this._boundTexture.id!==e.gl.textureId||this._boundTexture.unit!==this._activeTextureUnit)){switch(this._boundTexture={id:e.gl.textureId,unit:this._activeTextureUnit},t){case a.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D:this.gl.bindTexture(this.gl.TEXTURE_2D,e.gl.textureId);break;case a.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D:this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,e.gl.textureId)}var n=this._textureUnitToTexture.get(this._activeTextureUnit);n&&n.gl&&(n.gl.textureUnit=-1),this._textureUnitToTexture.set(this._activeTextureUnit,e),e.gl.textureUnit=this._activeTextureUnit}},e.prototype.disableVertexAttributeArray=function(){for(var e=0,t=this._enabledVertexAttributeArray.length;e<t;++e){var n=this._enabledVertexAttributeArray[e];this.gl.disableVertexAttribArray(n)}this._enabledVertexAttributeArray=[],this._willUseVertexAttributeArray=[],this._vertexAttributeArrayDivisor.clear()},e.prototype.willUseVertexAttributeArray=function(e){this._willUseVertexAttributeArray[e]=e,void 0===this._enabledVertexAttributeArray[e]&&(this._enabledVertexAttributeArray[e]=e,this.gl.enableVertexAttribArray(e))},e.prototype.applyVertexAttributeArrays=function(){for(var e=0,t=this._enabledVertexAttributeArray.length;e<t;++e){var n=this._enabledVertexAttributeArray[e];if(void 0!==n){if(void 0!==this._willUseVertexAttributeArray[n])return;this.gl.disableVertexAttribArray(n),delete this._enabledVertexAttributeArray[n]}}this._willUseVertexAttributeArray=[]},e.prototype.setVertexAttributeArrayDivisor=function(e,t){this.extensions.instancing&&void 0!==this._enabledVertexAttributeArray[e]&&this._vertexAttributeArrayDivisor.get(e)!==t&&(this.extensions.instancing instanceof WebGL2RenderingContext?this.extensions.instancing.vertexAttribDivisor(e,t):this.extensions.instancing.vertexAttribDivisorANGLE(e,t),this._vertexAttributeArrayDivisor.set(e,t))},e.prototype.freeTextureUnit=function(e){e.gl&&e.gl.textureUnit>-1&&(this._freeUnits.unshift(e.gl.textureUnit),e.gl.textureUnit=-1)},e.prototype.setActiveTextureUnit=function(e){this._activeTextureUnit!==e&&(this._activeTextureUnit=e,this.gl.activeTexture(e))},e.prototype.setClearColor=function(e){r.compare4(e,this._clearColor)||(this._clearColor=r.copy4(e),this.applyClearColor())},e.prototype.setDrawBuffers=function(e,t){var n=e.length!==this._drawBuffers.length;if(!n)for(var r=0,i=e.length;r<i;++r)if(this._drawBuffers[r]!==e[r]){n=!0;break}if(n){if(this.glProxy.extensions.drawBuffers instanceof WebGL2RenderingContext)t||this.glProxy.extensions.drawBuffers.drawBuffers(e);else{if(!this.glProxy.extensions.drawBuffers)return void console.warn("Attempted to use drawBuffers for MRT, but MRT is NOT supported by this hardware. Use multiple render targets instead");t||this.glProxy.extensions.drawBuffers.drawBuffersWEBGL(e)}this._drawBuffers=e}},e.prototype.setProxy=function(e){this.glProxy=e},e.prototype.setScissor=function(e){e?(this._scissorTestEnabled||(this._scissorTestEnabled=!0,this.gl.enable(this.gl.SCISSOR_TEST)),e.x===this._scissorBounds.x&&e.y===this._scissorBounds.y&&e.width===this._scissorBounds.width&&e.height===this._scissorBounds.height||(this._scissorBounds=e,this.applyScissorBounds())):this._scissorTestEnabled&&(this._scissorTestEnabled=!1,this.gl.disable(this.gl.SCISSOR_TEST))},e.prototype.setViewport=function(e,t,n,r){e===this._viewport.x&&t===this._viewport.y&&n===this._viewport.width&&r===this._viewport.height||(this._viewport={x:e,y:t,width:n,height:r},this.applyViewport())},e.prototype.useProgram=function(e){this._currentProgram!==e&&(this._currentProgram=e,this.gl.useProgram(this._currentProgram))},e.prototype.useMaterial=function(e){if(!e.gl){if(!this.glProxy.compileMaterial(e))return u.UseMaterialStatus.INVALID;if(!e.gl)return u.UseMaterialStatus.INVALID}if(!e.gl.programId||0===e.gl.programId.length)return u.UseMaterialStatus.INVALID;var t=this.findMaterialProgram(e);if(void 0===t)return console.warn("Could NOT determine a program for the given material that would appropriately match with the current RenderTarget"),u.UseMaterialStatus.NO_RENDER_TARGET_MATCHES;if(this._renderTarget&&(e.gl.programByTarget.set(this._renderTarget,t),this.glProxy.extensions.drawBuffers)){var n=e.gl.outputsByProgram.get(t),r=this._renderTarget.getGLBuffers();if(!n||!r)return console.warn("Could not establish the buffers to utilize for the render target"),u.UseMaterialStatus.NO_RENDER_TARGET_MATCHES;for(var i=[],o=function(e,t){var o=r[e];void 0===n.find((function(e){return(null==o?void 0:o.outputType)===e}))||a._renderTarget.disabledTargets.has((null==o?void 0:o.outputType)||0)?i.push(a.gl.NONE):i.push((null==o?void 0:o.attachment)||a.gl.NONE)},a=this,s=0,c=r.length;s<c;++s)o(s);this.setDrawBuffers(i)}return this.useProgram(t),this.syncMaterial(e),u.UseMaterialStatus.VALID},e.prototype.findMaterialProgram=function(e){if(e.gl){if(!this._renderTarget||this._renderTarget.isColorTarget()){var t;if(this._renderTarget&&void 0!==(t=e.gl.programByTarget.get(this._renderTarget)))return t;for(var n=Number.MAX_SAFE_INTEGER,r=0,o=e.gl.programId.length;r<o;++r){var a=e.gl.programId[r];a.outputTypes.length<n&&a.outputTypes.indexOf(i.FragmentOutputType.COLOR)>=0&&(t=a.id,n=a.outputTypes.length)}return t||(t=e.gl.programId[e.gl.programId.length-1]),t}var s=e.gl.programByTarget.get(this._renderTarget);if(void 0!==s)return s;var u=new Set,c=this._renderTarget.getBuffers();for(r=0,o=c.length;r<o;++r){var l=c[r];l&&u.add(l.outputType)}var h=0,f=[];for(r=0,o=e.gl.programId.length;r<o;++r){for(var d=e.gl.programId[r],p=0,g=0,v=d.outputTypes.length;g<v;++g){var y=d.outputTypes[g];u.has(y)&&p++}p>h?(h=p,f=[d]):p===h&&f.push(d)}if(0!==f.length)return 1===f.length?s=f[0].id:f.length>1&&(s=f.reduce((function(e,t){return t.outputTypes.length<e.outputTypes.length?t:e}))),s}},e.prototype.useRenderTarget=function(e){return e?!!e.gl&&(this.bindFBO(e.gl.fboId),this._renderTarget=e,!0):(this.bindFBO(null),this._renderTarget=null,!0)},e.prototype.syncMaterial=function(e){var t=this,n=this.gl,r=Boolean(e.depthWrite);return this._depthMask!==r&&(this._depthMask=r,n.depthMask(this._depthMask)),this._depthTestEnabled!==e.depthTest&&(this._depthTestEnabled=e.depthTest,this._depthTestEnabled?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST)),this._depthFunc!==e.depthFunc&&(this._depthFunc=e.depthFunc,this.applyDepthFunc()),e.blending?(this._blendingEnabled||(n.enable(n.BLEND),this._blendingEnabled=!0),this._blendDstFactor===e.blending.blendDst&&this._blendSrcFactor===e.blending.blendSrc&&this._blendEquation===e.blending.blendEquation||(this._blendDstFactor=e.blending.blendDst||this._blendDstFactor,this._blendSrcFactor=e.blending.blendSrc||this._blendSrcFactor,this._blendEquation=e.blending.blendEquation||this._blendEquation,this.applyBlendFactors())):this._blendingEnabled&&(n.disable(n.BLEND),this._blendingEnabled=!1),this._cullFace!==e.culling&&(this._cullFace=e.culling,this.applyCullFace()),this._colorMask[0]===e.colorWrite[0]&&this._colorMask[1]===e.colorWrite[1]&&this._colorMask[2]===e.colorWrite[2]&&this._colorMask[3]===e.colorWrite[3]||(this._colorMask=e.colorWrite,this.applyColorMask()),this._ditheringEnabled!==e.dithering&&(this._ditheringEnabled=e.dithering,this._ditheringEnabled?n.enable(n.DITHER):n.disable(n.DITHER)),this._currentUniforms=e.uniforms,!!this._currentProgram&&(Object.entries(e.uniforms).forEach((function(e){var n=e[0],r=e[1];if(t._currentProgram){r.gl||(r.gl=new Map);var i=r.gl.get(t._currentProgram);if(!i){var o=t.gl.getUniformLocation(t._currentProgram,n);if(!o)return i={location:void 0},void c(t.debugContext,"A Material specified a uniform "+n+", but none was found in the current program.");i={location:o},r.gl.set(t._currentProgram,i)}i.location&&t.uploadUniform(i.location,r)}})),!(this._textureWillBeUsed.size>0&&!this.applyUsedTextures()))},e.prototype.uploadUniform=function(e,t){var n;switch(t.type){case u.MaterialUniformType.FLOAT:n=t.value,this.gl.uniform1f(e,n);break;case u.MaterialUniformType.VEC2:n=t.value,this.gl.uniform2f(e,n[0],n[1]);break;case u.MaterialUniformType.VEC3:n=t.value,this.gl.uniform3f(e,n[0],n[1],n[2]);break;case u.MaterialUniformType.VEC4:n=t.value,this.gl.uniform4f(e,n[0],n[1],n[2],n[3]);break;case u.MaterialUniformType.VEC4_ARRAY:n=t.value,this.gl.uniform4fv(e,r.flatten4(n));break;case u.MaterialUniformType.MATRIX3x3:n=t.value,this.gl.uniformMatrix3fv(e,!1,n);break;case u.MaterialUniformType.MATRIX4x4:n=t.value,this.gl.uniformMatrix4fv(e,!1,n);break;case u.MaterialUniformType.FLOAT_ARRAY:n=t.value,this.gl.uniform1fv(e,n);break;case u.MaterialUniformType.TEXTURE:n=t.value,this.willUseTextureUnit(n,e);break;default:console.warn(this.debugContext,"A uniform specified an unrecognized type. It will not sync with the GPU:",t)}},e.prototype.applyUsedTextures=function(){var e=this,t=this.assignTextureUnits(Array.from(this._textureWillBeUsed.keys()));t.forEach((function(t){t.gl?t.gl.textureUnit=e.gl.TEXTURE0:t.gl={textureId:null,textureUnit:e.gl.TEXTURE0,proxy:e.glProxy}}));var n=new Map,r=new Set;return this._textureWillBeUsed.forEach((function(e,t){e instanceof s.RenderTarget?r.add(e):n.set(t,e)})),r.forEach((function(n){n.getTextures().some((function(n){return!(t.indexOf(n)<0)||(e.glProxy.updateTexture(n),!1)}))?console.warn(e.debugContext,"A RenderTarget can not be used because all of it's textures could not be compiled."):e.glProxy.compileRenderTarget(n)})),n.forEach((function(n,r){t.indexOf(r)<0?(e.glProxy.updateTexture(r),n.forEach((function(t){e.uploadTextureToUniform(t,r)}))):n.forEach((function(t){e.gl.uniform1i(t,o.textureUnitToIndex(e.gl,0))}))})),this._textureWillBeUsed.clear(),!0},e.prototype.assignTextureUnits=function(e){var t=[],n=[];for(e.forEach((function(e){!e.gl||e.gl.textureUnit<0?t.push(e):n.push(e)}));this._freeUnits.length>0&&t.length>0;){if(o=t.shift())void 0!==(a=this._freeUnits.shift())?(o.gl?o.gl.textureUnit=a:o.gl={textureId:null,textureUnit:a,proxy:this.glProxy},n.push(o)):t.unshift(o)}if(t.length<=0)return t;c("WARNING: Too many textures in use are causing texture units to be swapped. Doing this occasionally is fine, but handling this on a frame loop can have serious performance concerns.");var r=new Map;this._textureUnitToTexture.forEach((function(e){e&&r.set(e,!1)})),n.forEach((function(e){r.set(e,!0)}));var i=[];if(r.forEach((function(e,t){e||i.push(t)})),0===i.length)return console.warn(this.debugContext,"There are too many textures being used for a single draw call. These textures will not be utilized on the GPU",t),console.warn("Current GL State:",this),t;for(;i.length>0&&t.length>0;){var o,a;if(o=t.shift())void 0===(a=i.shift())||!a.gl||a.gl.textureUnit<0?t.unshift(o):(o.gl?o.gl.textureUnit=a.gl.textureUnit:o.gl={textureId:null,textureUnit:a.gl.textureUnit,proxy:this.glProxy},n.push(o))}return t.length>0&&(console.error(this.debugContext,"There are too many textures being used for a single draw call. These textures will not be utilized on the GPU",t),console.warn("Current GL State:",this)),t},e.prototype.uploadTextureToUniform=function(e,t){t.gl&&t.gl.textureUnit>=0?this.gl.uniform1i(e,o.textureUnitToIndex(this.gl,t.gl.textureUnit)):console.warn(this.debugContext,"Attempted to set a Texture Object to a uniform, but the Texture object did not have a valid texture unit.",t)},e.prototype.willUseTextureUnit=function(e,t){var n=this._textureWillBeUsed.get(e);t instanceof s.RenderTarget?n?n instanceof s.RenderTarget&&n!==t&&console.warn(this.debugContext,"A Texture is attempting to be used by two different render targets in a single draw."):this._textureWillBeUsed.set(e,t):n?n instanceof s.RenderTarget?console.warn(this.debugContext,"A texture in a single draw is attempting to attach to a uniform AND a render target which is invalid."):n.add(t):this._textureWillBeUsed.set(e,new Set([t]))},e.prototype.syncState=function(){var e=this.gl;this._blendingEnabled?e.enable(e.BLEND):e.disable(e.BLEND),this._ditheringEnabled?e.enable(e.DITHER):e.disable(e.DITHER),this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.setActiveTextureUnit(this._activeTextureUnit),this.applyClearColor(),this.applyCullFace(),this.applyBlendFactors(),this.applyBlendEquation(),this.applyColorMask(),this.applyDepthFunc(),this.applyScissorBounds(),this.applyViewport(),e.depthMask(this._depthMask)},e.prototype.applyClearColor=function(){this.gl.clearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3])},e.prototype.applyDepthFunc=function(){var e=this.gl;switch(this._depthFunc){case a.GLSettings.Material.DepthFunctions.ALWAYS:e.depthFunc(e.ALWAYS);break;case a.GLSettings.Material.DepthFunctions.EQUAL:e.depthFunc(e.EQUAL);break;case a.GLSettings.Material.DepthFunctions.GREATER:e.depthFunc(e.GREATER);break;case a.GLSettings.Material.DepthFunctions.GREATER_OR_EQUAL:e.depthFunc(e.GEQUAL);break;case a.GLSettings.Material.DepthFunctions.LESS:e.depthFunc(e.LESS);break;case a.GLSettings.Material.DepthFunctions.LESS_OR_EQUAL:e.depthFunc(e.LEQUAL);break;case a.GLSettings.Material.DepthFunctions.NEVER:e.depthFunc(e.NEVER);break;case a.GLSettings.Material.DepthFunctions.NOTEQUAL:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.ALWAYS)}},e.prototype.applyScissorBounds=function(){this.gl.scissor(this._scissorBounds.x,this._scissorBounds.y,this._scissorBounds.width,this._scissorBounds.height)},e.prototype.applyColorMask=function(){this.gl.colorMask(this.colorMask[0]||!1,this.colorMask[1]||!1,this.colorMask[2]||!1,this.colorMask[3]||!1)},e.prototype.applyBlendEquation=function(){var e=this.gl;switch(this._blendEquation){case a.GLSettings.Material.BlendingEquations.Add:e.blendEquation(e.FUNC_ADD);break;case a.GLSettings.Material.BlendingEquations.Subtract:e.blendEquation(e.FUNC_SUBTRACT);break;case a.GLSettings.Material.BlendingEquations.ReverseSubtract:e.blendEquation(e.FUNC_REVERSE_SUBTRACT)}},e.prototype.applyBlendFactors=function(){var e,t,n=this.gl;switch(this._blendDstFactor){case a.GLSettings.Material.BlendingDstFactor.DstAlpha:e=n.BLEND_DST_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.DstColor:e=n.BLEND_DST_RGB;break;case a.GLSettings.Material.BlendingDstFactor.One:e=n.ONE;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusDstAlpha:e=n.ONE_MINUS_DST_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusDstColor:e=n.ONE_MINUS_DST_COLOR;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha:e=n.ONE_MINUS_SRC_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusSrcColor:e=n.ONE_MINUS_SRC_COLOR;break;case a.GLSettings.Material.BlendingDstFactor.SrcAlpha:e=n.SRC_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.SrcColor:e=n.SRC_COLOR;break;case a.GLSettings.Material.BlendingDstFactor.Zero:e=n.ZERO;break;default:e=n.ONE}switch(this._blendSrcFactor){case a.GLSettings.Material.BlendingDstFactor.DstAlpha:t=n.BLEND_DST_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.DstColor:t=n.BLEND_DST_RGB;break;case a.GLSettings.Material.BlendingDstFactor.One:t=n.ONE;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusDstAlpha:t=n.ONE_MINUS_DST_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusDstColor:t=n.ONE_MINUS_DST_COLOR;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha:t=n.ONE_MINUS_SRC_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.OneMinusSrcColor:t=n.ONE_MINUS_SRC_COLOR;break;case a.GLSettings.Material.BlendingDstFactor.SrcAlpha:t=n.SRC_ALPHA;break;case a.GLSettings.Material.BlendingDstFactor.SrcColor:t=n.SRC_COLOR;break;case a.GLSettings.Material.BlendingDstFactor.Zero:t=n.ZERO;break;case a.GLSettings.Material.BlendingSrcFactor.SrcAlphaSaturate:t=n.SRC_ALPHA_SATURATE;break;default:t=n.ONE}n.blendFunc(t,e)},e.prototype.applyCullFace=function(){var e=this.gl;switch(this._cullFace!==a.GLSettings.Material.CullSide.NONE&&e.enable(e.CULL_FACE),this._cullFace){case a.GLSettings.Material.CullSide.CW:e.frontFace(e.CW),e.cullFace(e.FRONT);break;case a.GLSettings.Material.CullSide.CCW:e.frontFace(e.CCW),e.cullFace(e.FRONT);break;case a.GLSettings.Material.CullSide.BOTH:e.frontFace(e.CW),e.cullFace(e.FRONT_AND_BACK);break;default:e.disable(e.CULL_FACE)}},e.prototype.applyViewport=function(){this.gl.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)},e}();t.GLState=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.models=new Set}return e.prototype.add=function(e){this.models.add(e)},e.prototype.remove=function(e){this.models.delete(e)},e}();t.Scene=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(68),i=n(71),o=n(26),a=n(14),s=n(5)("performance"),u=function(){function e(e){this.state={clearMask:[!1,!1,!1],currentRenderTarget:null,displaySize:[1,1],pixelRatio:1,renderSize:[1,1]},this.options=Object.assign({alpha:!1,antialias:!1,preserveDrawingBuffer:!1},e),this.options.canvas||console.warn("WebGLRenderer ERROR: A canvas is REQUIRED as a parameter."),this.getContext()}return Object.defineProperty(e.prototype,"debugContext",{set:function(e){this.glProxy&&(this.glProxy.debugContext=e),this.glState&&(this.glState.debugContext=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gl",{get:function(){return this._gl},enumerable:!0,configurable:!0}),e.prototype.clear=function(e,t,n){var r=this.state.clearMask;this.state.clearMask=[r[0]||e||!1,r[1]||t||!1,r[2]||n||!1]},e.prototype.clearColor=function(e){e&&this.glState.setClearColor(e)},e.prototype.dispose=function(){},e.prototype.getContext=function(){if(this._gl)return this._gl;var e=r.GLProxy.getContext(this.options.canvas,{alpha:this.options.alpha||!1,antialias:this.options.antialias||!1,premultipliedAlpha:this.options.premultipliedAlpha||!1,preserveDrawingBuffer:this.options.preserveDrawingBuffer||!1});return e.context?(this._gl=e.context,this.glState=new i.GLState(e.context,e.extensions),this.glProxy=new r.GLProxy(e.context,this.glState,e.extensions),this.glState.setProxy(this.glProxy),this.glState.syncState()):this.options.onNoContext?this.options.onNoContext():console.warn("No context was able to be produced, and the handler onNoContext was not implemented for such cases."),this._gl},e.prototype.getDisplaySize=function(){return this.state.displaySize},e.prototype.getPixelRatio=function(){return this.state.pixelRatio},e.prototype.getRenderSize=function(){return this.state.renderSize},e.prototype.getFullViewport=function(){var e=this.state.currentRenderTarget;if(Array.isArray(e))return{x:0,y:0,width:e[0].width,height:e[0].height};if(e)return{x:0,y:0,width:e.width,height:e.height};var t=this.getRenderSize();return{x:0,y:0,width:t[0],height:t[1]}},e.prototype.prepareAttribute=function(e,t,n){return this.glProxy.updateAttribute(t)?(e.gl&&e.gl.vao||this.glProxy.useAttribute(n,t,e),!0):(console.warn("Could not update attribute",t),!1)},e.prototype.render=function(e,t){var n=this;if(void 0===t&&(t=null),this.gl){this.setRenderTarget(t);var r=[];if(t&&!Array.isArray(t)&&(a.WebGLStat.MRT||a.WebGLStat.MRT_EXTENSION)){var i=t.getGLBuffers();this.glState.setDrawBuffers(i.map((function(e){return(null==e?void 0:e.attachment)||0})))}var o=this.state.clearMask;if((o[0]||o[1]||o[2])&&(this.glProxy.clear(o[0],o[1],o[2]),this.state.clearMask=[!1,!1,!1]),Array.isArray(t))for(var s=0,u=t.length;s<u;++s){var c=t[s];if(this.glState.useRenderTarget(c),c&&!c.gl)return;e.models.forEach((function(e){n.renderModel(e,r)}))}else{if(t&&!t.gl)return;e.models.forEach((function(e){n.renderModel(e,r)}))}r.forEach((function(t){e.remove(t)}))}},e.prototype.renderModel=function(e,t){var n,r=this,i=e.geometry,a=e.material;switch(this.glState.useMaterial(a)){case o.UseMaterialStatus.VALID:this.glProxy.compileGeometry(i);var u=!0;i.attributes.forEach((function(e,t){u=r.prepareAttribute(i,e,t)&&u})),(null===(n=i.gl)||void 0===n?void 0:n.vao)?this.glState.bindVAO(i.gl.vao):this.glState.applyVertexAttributeArrays(),u?this.glProxy.draw(e):(console.warn("Geometry was unable to update correctly, thus we are skipping the drawing of",e),t.push(e)),this.glState.bindVAO(null);break;case o.UseMaterialStatus.INVALID:console.warn("Could not utilize material. Skipping draw call for:",a,i),t.push(e);break;case o.UseMaterialStatus.NO_RENDER_TARGET_MATCHES:s("Skipped draw for material due to no output matches for the current render target");break;default:s("Skipped draw for material due to unknown reasons")}},e.prototype.readPixels=function(e,t,n,r,i,o){if(void 0===o&&(o=0),this.gl){var a,s=this.state.currentRenderTarget,u=!0;if(Array.isArray(s))a=s.find((function(e){var t;return Array.isArray(e.buffers.color)?e.buffers.color.find((function(e){return e.outputType===o})):(null===(t=e.buffers.color)||void 0===t?void 0:t.outputType)===o}));else if(s&&Array.isArray(null==s?void 0:s.buffers.color)){if(s.buffers.color.length>1)return void console.warn("It is not yet implemented to read the pixels from a RenderTarget with multiple color buffers");a=s}else a=s;if(a&&(u=a.validFramebuffer),u)if(e=Math.max(0,e),t=Math.max(0,t),a){e+n>a.width&&(n=a.width-e),t+r>a.height&&(r=a.height-t);var c=a.height;this.gl.readPixels(e,c-t-r,n,r,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i)}else{var l=this.getRenderSize();c=l[1];e+n>l[0]&&(n=l[0]-e),t+r>l[1]&&(r=l[1]-t),this.gl.readPixels(e,c-t-r,n,r,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i)}else console.warn("Framebuffer is incomplete. Can not read pixels at this time.")}},e.prototype.setClearColor=function(e){this.glState.setClearColor(e)},e.prototype.setPixelRatio=function(e){var t=this.options.canvas,n=this.getDisplaySize();t.width=n[0]*e,t.height=n[1]*e,this.state.pixelRatio=e},e.prototype.setScissor=function(e,t){if(t=t||this.state.currentRenderTarget||null,Array.isArray(t)){var n=t[0].height;if(e){var r=e.x,i=e.y,o=e.width,a=e.height;this.glState.setScissor({x:r,y:n-i-a,width:o,height:a})}else this.glState.setScissor(null)}else if(t){n=t.height;if(e){r=e.x,i=e.y,o=e.width,a=e.height;this.glState.setScissor({x:r,y:n-i-a,width:o,height:a})}else this.glState.setScissor(null)}else{n=this.state.renderSize[1];if(e){r=e.x,i=e.y,o=e.width,a=e.height;this.glState.setScissor({x:r,y:n-i-a,width:o,height:a})}else this.glState.setScissor(null)}},e.prototype.setSize=function(e,t){var n=this.options.canvas,r=this.state.pixelRatio;n.width=Math.min(e*r,a.WebGLStat.MAX_TEXTURE_SIZE),n.height=Math.min(t*r,a.WebGLStat.MAX_TEXTURE_SIZE),n.style.width=e+"px",n.style.height=t+"px",this.state.renderSize=[n.width,n.height],this.state.displaySize=[e,t]},e.prototype.setRenderTarget=function(e){var t=this;this.state.currentRenderTarget!==e&&(Array.isArray(e)?e.forEach((function(e){e.gl||t.glProxy.compileRenderTarget(e)})):!this.glState.useRenderTarget(e)&&e&&(e.getTextures().forEach((function(n){t.glState.willUseTextureUnit(n,e)})),this.glState.applyUsedTextures(),this.glProxy.compileRenderTarget(e)&&this.glState.useRenderTarget(e)),this.state.currentRenderTarget=e)},e.prototype.setViewport=function(e){var t=this.state.currentRenderTarget,n=e.x,r=e.y,i=e.width,o=e.height;if(Array.isArray(t)){var a=t[0].height;this.glState.setViewport(n,a-r-o,i,o)}else if(t){a=t.height;this.glState.setViewport(n,a-r-o,i,o)}else{a=this.state.renderSize[1];this.glState.setViewport(n,a-r-o,i,o)}},e}();t.WebGLRenderer=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7);function i(e,t,n){var r=""+e,i=parseFloat(r);return isNaN(i)?0:r.indexOf("%")>-1?i/100*t:i*n}t.getAbsolutePositionBounds=function(e,t,n){0!==t.width&&0!==t.height||console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are non-zero.","item:",e,"reference:",t.toString());var o,a,s=r.Bounds.emptyBounds();if(e.width)s.width=i(e.width,t.width,n),void 0!==e.left?s.x=i(e.left,t.width,n):void 0!==e.right&&(s.x=t.width-i(e.right,t.width,n)-s.width);else{var u=i(e.left||0,t.width,n);(o=t.width-i(e.right||0,t.width,n)-u)<0&&console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are greater than zero.","item:",e,"reference:",t.toString()),s.x=u,s.width=o}if(e.height)s.height=i(e.height,t.height,n),void 0!==e.top?s.y=i(e.top,t.height,n):void 0!==e.bottom&&(s.y=t.height-i(e.bottom,t.height,n)-s.height);else{var c=i(e.top||0,t.height,n);(void 0===(a=t.height-i(e.bottom||0,t.height,n)-c)||a<0)&&console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are greater than zero.","item:",e,"reference:",t.toString()),s.y=c,s.height=a}return(0===s.width||0===s.height||isNaN(s.x+s.y+s.width+s.height))&&(s.x=0,s.y=0,s.width=t.width,s.height=t.height),s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.delay=0,this.isManualStart=!1,this.isTimeSet=!1,Object.assign(this,e)}return e.prototype.setAutomatic=function(){this.isManualStart=!1,this.isTimeSet=!1},e.prototype.setStart=function(e){e&&(this.start.length!==e.length?console.warn("A manual easing adjustment provided an incompatible value for the easing type."):(this.start=e,this.isManualStart=!0))},e.prototype.setTiming=function(e,t){this.delay=void 0===e?this.delay:e,this.duration=void 0===t?this.duration:t,this.isTimeSet=!0},e}();t.EasingProps=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),s=n(69),u=n(0),c=n(17);t.createColorBuffer=function(e){return o({key:"",type:u.ResourceType.COLOR_BUFFER},e)},t.isColorBufferResource=function(e){return void 0!==e&&void 0!==e.key&&e.type===u.ResourceType.COLOR_BUFFER};var l=function(e){function t(t,n){var r=e.call(this,t)||this;return r.type=u.ResourceType.COLOR_BUFFER,r.height=t.height,r.width=t.width,r.colorBufferSettings=t.colorBufferSettings,r.createColorBuffer(n),r}return i(t,e),t.prototype.destroy=function(){this.colorBuffer.destroy()},t.prototype.createColorBuffer=function(e){if(!this.colorBuffer){var t,n;this.colorBufferSettings=o({},this.colorBufferSettings);var r=(null==e?void 0:e.getRenderSize())||[1,1];if(this.width<=u.TextureSize.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");t=r[0]/-this.width}else t=this.width;if(this.height<=u.TextureSize.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");n=r[1]/-this.width}else n=this.height;this.colorBuffer=new s.ColorBuffer(o({internalFormat:a.GLSettings.RenderTarget.ColorBufferFormat.RGBA4,size:[t,n]},this.colorBufferSettings))}},t}(c.IdentifyByKey);t.ColorBufferResource=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,o,a,s,u,c,l,h,f,d,p,g,v,y,m,b,T,_=n(0),x=n(36),w=n(2),E=Math.cos,O=Math.sin,R=Math.sqrt,S=Math.exp,A=Math.acos,M=Math.atan2,I=Math.PI;function P(e,t,n){return e>n?n:e<t?t:e}function L(e){return e?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):[0,0,0,0]}function C(e,t,n){n=n||L();var r=e[0],i=t[0],o=e[1],a=t[1],s=e[2],u=t[2],c=e[3],l=t[3];return n[0]=r*i-o*a-s*u-c*l,n[1]=r*a+o*i+s*l-c*u,n[2]=r*u-o*l+s*i+c*a,n[3]=r*l+o*u-s*a+c*i,n}function B(e,t,n){return(n=n||L())[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function F(e,t){return(t=t||L())[0]=e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function D(e){var t=e[0],n=e[1],r=e[2],i=e[3];return R(t*t+n*n+r*r+i*i)}function N(e,t,n){n=n||L();var r=e[0],i=e[1],o=e[2],a=Math.cos,s=Math.sin,u=a(r/2),c=a(i/2),l=a(o/2),h=s(r/2),f=s(i/2),d=s(o/2);switch(t){case _.EulerOrder.xyz:n[1]=h*c*l+u*f*d,n[2]=u*f*l-h*c*d,n[3]=u*c*d+h*f*l,n[0]=u*c*l-h*f*d;break;case _.EulerOrder.yxz:n[0]=u*c*l+h*f*d,n[1]=h*c*l+u*f*d,n[2]=u*f*l-h*c*d,n[3]=u*c*d-h*f*l;break;case _.EulerOrder.zxy:n[0]=u*c*l-h*f*d,n[1]=h*c*l-u*f*d,n[2]=u*f*l+h*c*d,n[3]=u*c*d+h*f*l;break;case _.EulerOrder.zyx:n[0]=u*c*l+h*f*d,n[1]=h*c*l-u*f*d,n[2]=u*f*l+h*c*d,n[3]=u*c*d-h*f*l;break;case _.EulerOrder.yzx:n[0]=u*c*l-h*f*d,n[1]=h*c*l+u*f*d,n[2]=u*f*l+h*c*d,n[3]=u*c*d-h*f*l;break;case _.EulerOrder.xzy:n[0]=u*c*l+h*f*d,n[1]=h*c*l-u*f*d,n[2]=u*f*l-h*c*d,n[3]=u*c*d+h*f*l}return n}function U(e,t,n,r,i,o){o[0]=M(e,t),o[1]=A(n),o[2]=M(r,i)}function j(e,t,n){n=n||[0,0,0];var r=e[0],i=e[1],o=e[2],a=e[3],s=G(e),u=s[0],c=s[4],l=s[8],h=s[1],f=s[5],d=s[9],p=s[2],g=s[6],v=s[10];switch(t){case _.EulerOrder.zyx:n[1]=Math.asin(-P(p,-1,1)),Math.abs(p)<.99999?(n[0]=Math.atan2(g,v),n[2]=Math.atan2(h,u)):(n[0]=0,n[2]=Math.atan2(-c,f));break;case _.EulerOrder.zyz:U(2*o*a+2*r*i,2*r*o-2*i*a,a*a-o*o-i*i+r*r,2*o*a-2*r*i,2*i*a+2*r*o,n);break;case _.EulerOrder.zxy:n[0]=Math.asin(P(g,-1,1)),Math.abs(g)<.99999?(n[1]=Math.atan2(-p,v),n[2]=Math.atan2(-c,f)):(n[1]=0,n[2]=Math.atan2(h,u));break;case _.EulerOrder.zxz:U(2*i*a-2*r*o,2*o*a+2*r*i,a*a-o*o-i*i+r*r,2*i*a+2*r*o,2*r*i-2*o*a,n);break;case _.EulerOrder.yxz:n[0]=Math.asin(-P(d,-1,1)),Math.abs(d)<.9999?(n[1]=Math.atan2(l,v),n[2]=Math.atan2(h,f)):(n[1]=Math.atan2(-p,u),n[2]=0);break;case _.EulerOrder.yxy:U(2*i*o+2*r*a,2*r*i-2*o*a,o*o-a*a+r*r-i*i,2*i*o-2*r*a,2*o*a+2*r*i,n);break;case _.EulerOrder.yzx:n[2]=Math.asin(P(h,-1,1)),Math.abs(h)<.99999?(n[0]=Math.atan2(-d,f),n[1]=Math.atan2(-p,u)):(n[0]=0,n[1]=Math.atan2(l,v));break;case _.EulerOrder.yzy:U(2*o*a-2*r*i,2*i*o+2*r*a,o*o-a*a+r*r-i*i,2*o*a+2*r*i,2*r*a-2*i*o,n);break;case _.EulerOrder.xyz:n[1]=Math.asin(P(l,-1,1)),Math.abs(l)<.99999?(n[0]=Math.atan2(-d,v),n[2]=Math.atan2(-c,u)):(n[0]=Math.atan2(g,f),n[2]=0);break;case _.EulerOrder.xyx:U(2*i*o-2*r*a,2*i*a+2*r*o,i*i+r*r-a*a-o*o,2*i*o+2*r*a,2*r*o-2*i*a,n);break;case _.EulerOrder.xzy:n[2]=Math.asin(-P(c,-1,1)),Math.abs(c)<.99999?(n[0]=Math.atan2(g,f),n[1]=Math.atan2(l,u)):(n[0]=Math.atan2(-d,v),n[1]=0);break;case _.EulerOrder.xzx:U(2*i*a+2*r*o,2*r*a-2*i*o,i*i+r*r-a*a-o*o,2*i*a-2*r*o,2*i*o+2*r*a,n);break;default:console.warn("Invalid Euler rotation order.")}return n}function G(e,t){var n,r,i,o,a,s,u,c,l,h,f,d;return t=t||x.identity4(),h=e[1]+e[1],f=e[2]+e[2],d=e[3]+e[3],o=e[1]*h,u=e[1]*f,c=e[1]*d,a=e[2]*f,s=e[2]*d,l=e[3]*d,n=e[0]*h,r=e[0]*f,i=e[0]*d,t[x.M400]=1-(a+l),t[x.M410]=u-i,t[x.M420]=c+r,t[x.M430]=0,t[x.M401]=u+i,t[x.M411]=1-(o+l),t[x.M421]=s-n,t[x.M431]=0,t[x.M402]=c-r,t[x.M412]=s+n,t[x.M422]=1-(o+a),t[x.M432]=0,t[x.M403]=0,t[x.M413]=0,t[x.M423]=0,t[x.M433]=1,t}t.QR1=L(),t.QR2=L(),t.QR3=L(),t.QR4=L(),t.QX=1,t.QY=2,t.QZ=3,t.QW=0,t.clamp=P,t.zeroQuat=L,t.addQuat=function(e,t,n){return(n=n||L())[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},t.multiplyQuat=C,t.divideQuat=function(e,t,n){n=n||L();var r=e[0],i=e[1],o=e[2],a=e[3],s=t[0],u=t[1],c=t[2],l=t[3],h=s*s+u*u+c*c+l*l;if(0===h)n[0]=0,n[1]=0,n[2]=0,n[3]=0;else{var f=1/h;n[0]=(r*s+i*u+o*c+a*l)*f,n[1]=(i*s-r*u-o*l+a*c)*f,n[2]=(o*s-r*c-a*u+i*l)*f,n[3]=(a*s-r*l-i*c+o*u)*f}return n},t.exponentQuat=function(e,t){t=t||L();var n=e[0],r=e[1],i=e[2],o=e[3],a=R(r*r+i*i+o*o),s=S(n),u=s/a*O(a);return 0===a?(t[0]=S(n),t[1]=0,t[2]=0,t[3]=0):(t[0]=s*E(a),t[1]=r*u,t[2]=i*u,t[3]=o*u),t},t.scaleQuat=B,t.diffUnitQuat=function(e,t,n){return n=n||L(),C(t,F(e),n)},t.conjugateQuat=F,t.inverseQuat=function(e,t){t=t||L();var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;if(0===a)t[0]=0,t[1]=0,t[2]=0,t[3]=0;else{var s=1/a;t[0]=n*s,t[1]=-r*s,t[2]=-i*s,t[3]=-o*s}return t},t.lengthQuat=D,t.normalizeQuat=function(e,t){t=t||L();var n=D(e);return 0===n?[0,0,0,0]:B(e,1/n,t)},t.realQuat=function(e){return e[0]},t.imaginaryQuat=function(e){return[e[1],e[2],e[3]]},t.dotQuat=function(e,t){return w.dot4(e,t)},t.fromEulerAxisAngleToQuat=function(e,t,n){n=n||L();var r=e[0],i=e[1],o=e[2],a=1/R(r*r+i*i+o*o),s=O(t/2);return n[0]=E(t/2),n[1]=s*r*a,n[2]=s*i*a,n[3]=s*o*a,n},t.fromOrderedEulerToQuat=N,t.toEulerXYZfromOrderedEuler=function(e,t,n){return n=n||[0,0,0],j(N(e,t),_.EulerOrder.xyz,n),n},t.toEulerFromQuat=function(e,t){return j(e,_.EulerOrder.zyx,t)},t.toOrderedEulerFromQuat=j,t.toOrderedEulerFromQuat2=function(e,t,n){n=n||[0,0,0];var r=G(e),i=r[0],o=r[4],a=r[8],s=r[1],u=r[5],c=r[9],l=r[2],h=r[6],f=r[10];switch(t){case _.EulerOrder.xyz:n[1]=Math.asin(P(a,-1,1)),Math.abs(a)<.99999?(n[0]=Math.atan2(-c,f),n[2]=Math.atan2(-o,i)):(n[0]=Math.atan2(h,u),n[2]=0);break;case _.EulerOrder.yxz:n[0]=Math.asin(-P(c,-1,1)),Math.abs(c)<.9999?(n[1]=Math.atan2(a,f),n[2]=Math.atan2(s,u)):(n[1]=Math.atan2(-l,i),n[2]=0);break;case _.EulerOrder.zxy:n[0]=Math.asin(P(h,-1,1)),Math.abs(h)<.99999?(n[1]=Math.atan2(-l,f),n[2]=Math.atan2(-o,u)):(n[1]=0,n[2]=Math.atan2(s,i));break;case _.EulerOrder.zyx:n[1]=Math.asin(-P(l,-1,1)),Math.abs(l)<.99999?(n[0]=Math.atan2(h,f),n[2]=Math.atan2(s,i)):(n[0]=0,n[2]=Math.atan2(-o,u));break;case _.EulerOrder.yzx:n[2]=Math.asin(P(s,-1,1)),Math.abs(s)<.99999?(n[0]=Math.atan2(-c,u),n[1]=Math.atan2(-l,i)):(n[0]=0,n[1]=Math.atan2(a,f));break;case _.EulerOrder.xzy:n[2]=Math.asin(-P(o,-1,1)),Math.abs(o)<.99999?(n[0]=Math.atan2(h,u),n[1]=Math.atan2(a,i)):(n[0]=Math.atan2(-c,f),n[1]=0)}},t.angleQuat=function(e){var t=e[0];if(t<-1||t>1)return 0;var n=2*A(t);return n>I?n-2*I:n},t.axisQuat=function(e){var t=e[1],n=e[2],r=e[3];if(0===R(t*t+n*n+r*r))return[0,0,0];var i=1/R(t*t+n*n+r*r);return[t*i,n*i,r*i]},t.matrix3x3FromUnitQuatModel=function(e,t){var n,r,i,o,a,s,u,c,l,h,f,d;return t=t||x.identity3(),h=e[1]+e[1],f=e[2]+e[2],d=e[3]+e[3],o=e[1]*h,u=e[1]*f,c=e[1]*d,a=e[2]*f,s=e[2]*d,l=e[3]*d,n=e[0]*h,r=e[0]*f,i=e[0]*d,t[x.M300]=1-(a+l),t[x.M301]=u-i,t[x.M302]=c+r,t[x.M310]=u+i,t[x.M311]=1-(o+l),t[x.M312]=s-n,t[x.M320]=c-r,t[x.M321]=s+n,t[x.M322]=1-(o+a),t},t.matrix4x4FromUnitQuatModel=function(e,t){var n,r,i,o,a,s,u,c,l,h,f,d;return t=t||x.identity4(),h=e[1]+e[1],f=e[2]+e[2],d=e[3]+e[3],o=e[1]*h,u=e[1]*f,c=e[1]*d,a=e[2]*f,s=e[2]*d,l=e[3]*d,n=e[0]*h,r=e[0]*f,i=e[0]*d,t[x.M400]=1-(a+l),t[x.M401]=u-i,t[x.M402]=c+r,t[x.M403]=0,t[x.M410]=u+i,t[x.M411]=1-(o+l),t[x.M412]=s-n,t[x.M413]=0,t[x.M420]=c-r,t[x.M421]=s+n,t[x.M422]=1-(o+a),t[x.M423]=0,t[x.M430]=0,t[x.M431]=0,t[x.M432]=0,t[x.M433]=1,t},t.matrix3x3FromUnitQuatView=function(e,t){var n,r,i,o,a,s,u,c,l,h,f,d;return t=t||x.identity3(),h=e[1]+e[1],f=e[2]+e[2],d=e[3]+e[3],o=e[1]*h,u=e[1]*f,c=e[1]*d,a=e[2]*f,s=e[2]*d,l=e[3]*d,n=e[0]*h,r=e[0]*f,i=e[0]*d,t[x.M300]=1-(a+l),t[x.M310]=u-i,t[x.M320]=c+r,t[x.M301]=u+i,t[x.M311]=1-(o+l),t[x.M321]=s-n,t[x.M302]=c-r,t[x.M312]=s+n,t[x.M322]=1-(o+a),t},t.matrix4x4FromUnitQuatView=G,t.eulerToQuat=function(e,t){var n,r,i,o,a,s,u,c,l,h;t=t||L();var f=e[0],d=e[1],p=e[2];return n=E(f/2),r=E(d/2),i=E(p/2),o=O(f/2),u=r*i,c=(a=O(d/2))*(s=O(p/2)),l=r*s,h=a*i,t[0]=n*u+o*c,t[1]=o*u-n*c,t[2]=n*h+o*l,t[3]=n*l-o*h,t},t.lookAtQuat=function(e,t,n){return n=n||L(),T=w.normalize3([-e[0],-e[1],-e[2]],w.V3R[w.V3R.length-1]),m=w.normalize3(w.cross3(t,T,w.V3R[w.V3R.length-2])),b=w.cross3(T,m,w.V3R[w.V3R.length-3]),s=m[0],u=b[0],c=T[0],h=m[1],f=b[1],d=T[1],p=m[2],g=b[2],v=T[2],(y=.25*(1+s+f+v))>0?(y=Math.sqrt(y),n[0]=y,y=1/(4*y),n[1]=(d-g)*y,n[2]=(p-c)*y,n[3]=(u-h)*y):(n[0]=0,(y=-.5*(f+v))>0?(y=Math.sqrt(y),n[1]=y,y*=2,n[2]=u/y,n[3]=c/y):(n[1]=0,(y=.5*(1-v))>0?(y=Math.sqrt(y),n[2]=y,n[3]=d/(2*y)):(n[2]=0,n[3]=1))),n},t.matrix3x3ToQuaternion=function(e,t){if(t=t||L(),r=e[0],i=e[3],o=e[6],a=e[1],s=e[4],u=e[7],l=e[2],h=e[5],f=e[8],(y=r+s+f)>0){var n=2*R(y+1);return t[0]=.25*n,t[1]=(h-u)/n,t[2]=(o-l)/n,t[3]=(a-i)/n,t}if(r>s&&r>f){var c=2*R(1+r-s-f);return t[0]=(h-u)/c,t[1]=.25*c,t[2]=(i+a)/c,t[3]=(o+l)/c,t}if(s>f){var d=2*R(1+s-r-f);return t[0]=(o-l)/d,t[1]=(a+i)/d,t[2]=.25*d,t[3]=(h+u)/d,t}var p=2*R(1+f-r-s);return t[0]=(a-i)/p,t[1]=(l+o)/p,t[2]=(h+u)/p,t[3]=.25*p,t},t.matrix4x4ToQuaternion=function(e,t){if(t=t||L(),r=e[0],i=e[4],o=e[8],a=e[1],s=e[5],u=e[9],l=e[2],h=e[6],f=e[10],(y=r+s+f)>0){var n=2*R(y+1);return t[0]=.25*n,t[1]=(h-u)/n,t[2]=(o-l)/n,t[3]=(a-i)/n,t}if(r>s&&r>f){var c=2*R(1+r-s-f);return t[0]=(h-u)/c,t[1]=.25*c,t[2]=(i+a)/c,t[3]=(o+l)/c,t}if(s>f){var d=2*R(1+s-r-f);return t[0]=(o-l)/d,t[1]=(a+i)/d,t[2]=.25*d,t[3]=(h+u)/d,t}var p=2*R(1+f-r-s);return t[0]=(a-i)/p,t[1]=(l+o)/p,t[2]=(h+u)/p,t[3]=.25*p,t},t.decomposeRotation=function(e,t,n,r,i){return i=i||L(),s=e[0]/t,u=e[4]/n,c=e[8]/r,h=e[1]/t,f=e[5]/n,d=e[9]/r,p=e[2]/t,g=e[6]/n,v=e[10]/r,(y=.25*(1+s+f+v))>0?(y=Math.sqrt(y),i[0]=y,y=1/(4*y),i[1]=(d-g)*y,i[2]=(p-c)*y,i[3]=(u-h)*y):(i[0]=0,(y=-.5*(f+v))>0?(y=Math.sqrt(y),i[1]=y,y*=2,i[2]=u/y,i[3]=c/y):(i[1]=0,(y=.5*(1-v))>0?(y=Math.sqrt(y),i[2]=y,i[3]=d/(2*y)):(i[2]=0,i[3]=1))),i},t.lookAtMatrix=function(e,t,n){n=n||x.identity4();var r=w.normalize3([-e[0],-e[1],-e[2]]),i=w.normalize3(w.cross3(t,r)),o=w.cross3(r,i);return n[0]=i[0],n[1]=o[0],n[2]=r[0],n[3]=0,n[4]=i[1],n[5]=o[1],n[6]=r[1],n[7]=0,n[8]=i[2],n[9]=o[2],n[10]=r[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},t.rotateVectorByUnitQuat=function(e,t,n){return m=w.vec3(t[1],t[2],t[3]),y=t[0],w.add3(w.add3(w.scale3(m,2*w.dot3(m,e)),w.scale3(e,y*y-w.dot3(m,m))),w.scale3(w.cross3(m,e),2*y),n)},t.slerpUnitQuat=function(e,t,n,r){r=r||L();var i,o,a,s,u,c=[0,0,0,0];return(o=e[1]*t[1]+e[2]*t[2]+e[3]*t[3]+e[0]*t[0])<0?(o=-o,c[0]=-t[1],c[1]=-t[2],c[2]=-t[3],c[3]=-t[0]):(c[0]=t[1],c[1]=t[2],c[2]=t[3],c[3]=t[0]),1-o>1e-7?(i=A(o),a=O(i),s=O((1-n)*i)/a,u=O(n*i)/a):(s=1-n,u=n),r[1]=s*e[1]+u*c[0],r[2]=s*e[2]+u*c[1],r[3]=s*e[3]+u*c[2],r[0]=s*e[0]+u*c[3],r},t.oneQuat=function(){return[1,0,0,0]},t.iQuat=function(){return[0,1,0,0]},t.jQuat=function(){return[0,0,1,0]},t.kQuat=function(){return[0,0,0,1]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);t.ray=function(e,t){return[e,t]},t.rayToLocation=function(e,t,n){return n=n||[0,0,0],r.add3(e[0],r.scale3(e[1],t),n)},t.rayFromPoints=function(e,t,n){return n=n||[[0,0,0],[0,0,0]],r.copy3(e,n[0]),r.normalize3(r.subtract3(t,e),n[1]),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shallowCompare=function(e,t){return e&&t?!Boolean(Object.keys(Object.assign({},e,t)).find((function(n){return e[n]!==t[n]}))):e===t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeComments=function(e){for(var t=!1,n=!1,r=[],i={start:-1,stop:-1},o={start:-1,stop:-1},a=0,s=e.length;a<s;++a){var u=e[a],c=e[a+1];switch(u){case"/":switch(c){case"*":n||t||(i.start=a,t=!0,a++);break;case"/":t||n||(o.start=a,n=!0,a++)}break;case"*":"/"===c&&t&&(i.stop=a+2,r.push(i),i={start:-1,stop:-1},t=!1,a++);break;case"\n":case"\r":n&&(o.stop=a,r.push(o),o={start:-1,stop:-1},n=!1)}}return r.reverse(),r.forEach((function(t){e=function(e,t,n,r){return t<0&&(t=e.length+t)<0&&(t=0),e.slice(0,t)+(r||"")+e.slice(t+n)}(e,t.start,t.stop-t.start)})),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(82);function i(e){return Boolean(e)}function o(e){return Boolean(e)}function a(e){return Boolean(e)}function s(e){return Object.assign({},e,{materialAttribute:null})}function u(e){return Object.assign({},e,{materialUniforms:[]})}t.injectShaderIO=function(e,t,n,c,l,h){!function(e,t,n){if(n){var r=t.instanceAttributes||[],i=t.uniforms||[],o=t.vertexAttributes||[];n.shaderModuleUnits.forEach((function(t){t.instanceAttributes&&(r=r.concat(t.instanceAttributes(e))),t.uniforms&&(i=i.concat(t.uniforms(e))),t.vertexAttributes&&(o=o.concat(t.vertexAttributes(e)))}));var a=new Set,s=new Set,u=new Set;i.filter((function(e){return!!e&&(a.has(e.name)?(console.warn("Included shader modules has introduced duplicate uniform names:",e.name,"One will be overridden thus causing a potential crash of the shader."),!1):(a.add(e.name),!0))})),r.filter((function(e){return!!e&&(s.has(e.name)?(console.warn("Included shader modules has introduced duplicate Instance Attribute names:",e.name,"One will be overridden thus causing a potential crash of the shader."),!1):(s.add(e.name),!0))})),o.filter((function(e){return!!e&&(u.has(e.name)?(console.warn("Included shader modules has introduced duplicate Vertex Attribute names:",e.name,"One will be overridden thus causing a potential crash of the shader."),!1):(u.add(e.name),!0))})),t.instanceAttributes=r,t.uniforms=i,t.vertexAttributes=o}}(t,n,h);for(var f=(n.instanceAttributes||[]).filter(i),d=(n.vertexAttributes||[]).filter(o),p=(n.uniforms||[]).filter(a),g=0,v=c.length;g<v;++g){var y=c[g];if(y.validate(t,f,d,p)){var m=y.expand(t,f,d,p);m.instanceAttributes.filter(i).forEach((function(e){return f.push(e)})),m.vertexAttributes.filter(o).forEach((function(e){return d.push(e)})),m.uniforms.filter(a).forEach((function(e){return p.push(e)}))}}!function(e,t,n,r){t.forEach((function(r){void 0===r.name&&console.warn("All instance attributes MUST have a name on Layer:",e.id),t.find((function(e){return e!==r&&e.name===r.name}))&&console.warn("An instance attribute can not have the same name used more than once:",r.name),n.find((function(e){return e.name===r.name}))&&console.warn("An instance attribute and a vertex attribute in a layer can not share the same name:",r.name),r.resource||void 0===r.size&&(console.warn("An instance attribute requires the size to be defined."),console.warn(r))}))}(t,f,d);var b=f.slice(0),T=(d||[]).map(s),_=p.map(u);return b.sort(l.sortInstanceAttributes),_.sort(l.sortUniforms),T.sort(l.sortVertexAttributes),r.packAttributes(b),t.getLayerBufferType(e,d,b),{instanceAttributes:b,uniforms:_,vertexAttributes:T}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(0),o=function(){function e(e){this.index=0,this.available=4,this.index=e}return e.prototype.setAttribute=function(e){return(e.size||0)<=this.available&&(e.block=this.index,e.blockIndex=4-this.available,this.available-=e.size||0,!0)},e}();t.packAttributes=function(e){!function(e){e.forEach((function(e){if(e.resource&&void 0===e.size&&(e.size=i.InstanceAttributeSize.FOUR),!e.size)try{var t=e.update(new r.Instance({}));t.length>0&&t.length<=i.InstanceAttributeSize.FOUR&&(e.size=t.length)}catch(t){console.warn("The system could not determine the size of the provided attribute. Please provide the size of the attribute:",e)}}))}(e);var t=[];e.forEach((function(e){if(e.size&&e.size===i.InstanceAttributeSize.MAT4X4){e.block=t.length,e.blockIndex=0;for(var n=0;n<4;++n){(r=new o(t.length)).available=0,r.index=0,t.push(r)}}else{if(!t.find((function(t){return!!t.setAttribute(e)&&Boolean(t)}))){var r=new o(t.length);t.push(r),r.setAttribute(e)||console.warn("There was a problem packing an attribute into a block. No block would accommodate it:",e)}}}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(38),o=n(84),a=n(5)("performance"),s=n(5)("shader-module-vs"),u=n(5)("shader-module-fs");function c(e,t){return Boolean(e)&&(e.compatibility===t||e.compatibility===r.ShaderInjectionTarget.ALL)}var l=function(){function e(){}return e.register=function(t){if(!(t instanceof o.ShaderModuleUnit)){if(Array.isArray(t)){var n="";return t.forEach((function(t){var r=e.register(t);r&&(n+=r+"\n")})),n||null}return e.register(new o.ShaderModuleUnit(t))}var i=e.modules.get(t.moduleId);i||(i={},e.modules.set(t.moduleId,i));var s=i.fs,u=i.vs,l=c(t,r.ShaderInjectionTarget.FRAGMENT),h=c(t,r.ShaderInjectionTarget.VERTEX);if(s&&l){if(s.isFinal)return"Module ID: "+t.moduleId+" Can not override the module's existing Fragment registration as the exisitng module is marked as final";a("A Shader Module Unit has overridden an existing module for the Fragment Shader Module ID: %o",t.moduleId)}if(u&&h){if(u.isFinal)return"Module ID: "+t.moduleId+" Can not override the module's existing Vertex registration as the exisitng module is marked as final";a("A Shader Module Unit has overridden an existing module for the Vertex Shader Module ID: %o",t.moduleId)}return l&&(i.fs=t),h&&(i.vs=t),t.lock(),null},e.analyzeDependents=function(t){if(t.dependents&&t.isLocked)return[];var n=[],o=[],a=new Set,s=t.compatibility,u=t.moduleId,c=i.shaderTemplate({options:{},shader:t.content,onToken:function(t){var i=t.trim();if(0===i.indexOf("import")){var c=i.substr("import".length).trim();if(":"===c[0]){var l=!1,h=c.substr(":".length).trim().split(",");return 0===h[h.length-1].trim().length&&h.pop(),h.forEach((function(t){t=t.trim();var i=e.modules.get(t);i?(s!==r.ShaderInjectionTarget.FRAGMENT&&s!==r.ShaderInjectionTarget.ALL||(i.fs?(l=!0,a.has(t)||o.push(t)):n.push("Could not find requested target fragment module for Module ID: "+t+" requested by module: "+u)),s!==r.ShaderInjectionTarget.VERTEX&&s!==r.ShaderInjectionTarget.ALL||(i.vs?(l=!0,a.has(t)||o.push(t)):n.push("Could not find requested target vertex module for Module ID: "+t+" requested by module: "+u)),i.vs||i.fs||n.push("Could not find a vertex or fragment shader within exisitng module"),l||n.push("Error Processing module Module ID: "+t+" requested by module: "+u)):n.push("Could not find requested module: "+t+" requested by module: "+u)})),""}}return"${"+t+"}"}});return t.applyAnalyzedContent(c.shader),t.dependents=o,n},e.process=function(t,n,i,a){var c=new Set,l=new Set,h=[],f=[],d=i===r.ShaderInjectionTarget.VERTEX?s:u;d("Processing Shader for context %o:",t);var p=n;if(a){var g="";a.forEach((function(e){g+="${import: "+e+"}\n"})),p=g+n}var v=new o.ShaderModuleUnit({content:p,compatibility:i,moduleId:'Layer "'+t+'" '+(i===r.ShaderInjectionTarget.ALL?"fs vs":i===r.ShaderInjectionTarget.VERTEX?"vs":"fs")});return{errors:f,shader:function t(n){var o=n.moduleId;if(!function(e){var t=e.moduleId;d("%o: %o",t,h.slice(0).reverse().join(" -> "));var n=h.indexOf(t);if(h.unshift(t),n>-1){var r=h.slice(0,n+2).reverse();return f.push("A Shader has detected a Circular dependency in import requests: "+r.join(" -> ")),h.shift(),!1}return!0}(n))return null;if(o&&l.has(o))return h.shift(),"";var a="";e.analyzeDependents(n).forEach((function(e){return f.push(e)}));var s=n.dependents;if(d("Module dependencies detected %o",s),s&&s.length>0)for(var u=0,p=s.length;u<p;++u){var g=s[u],v=e.modules.get(g);if(v){var y=void 0;i!==r.ShaderInjectionTarget.FRAGMENT&&i!==r.ShaderInjectionTarget.ALL||(v.fs?(c.add(v.fs),y=t(v.fs)):f.push("Could not find requested target fragment module for Module ID: "+g+" requested by module: "+o)),i!==r.ShaderInjectionTarget.VERTEX&&i!==r.ShaderInjectionTarget.ALL||(v.vs?(c.add(v.vs),y=t(v.vs)):f.push("Could not find requested target vertex module for Module ID: "+g+" requested by module: "+o)),v.vs||v.fs||f.push("Could not find a vertex or fragment shader within exisitng module"),null===y&&f.push("Error Processing module Module ID: "+g+" requested by module: "+o),a+=y||""}else f.push("Could not find requested module: "+g+" requested by module: "+o)}return h.shift(),l.add(o||""),a.trim()+"\n\n"+n.content.trim()}(v),shaderModuleUnits:c}},e.modules=new Map,e}();t.ShaderModule=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="Once a ShaderModuleUnit has been registered, you CAN NOT modify it! Module ID:",i=function(){function e(e){this._dependents=null,Object.assign(this,e)}return Object.defineProperty(e.prototype,"content",{get:function(){return this._content},set:function(e){this._isLocked?console.warn(r,this._moduleId):this._content=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compatibility",{get:function(){return this._compatibility},set:function(e){this._isLocked?console.warn(r,this._moduleId):this._compatibility=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dependents",{get:function(){return this._dependents},set:function(e){this._isLocked&&null!==this._dependents?console.warn(r,this._moduleId):this._dependents=e},enumerable:!0,configurable:!0}),e.prototype.isLocked=function(){return this._isLocked},Object.defineProperty(e.prototype,"moduleId",{get:function(){return this._moduleId},set:function(e){this._isLocked?console.warn(r,this._moduleId):this._moduleId=e},enumerable:!0,configurable:!0}),e.prototype.applyAnalyzedContent=function(e){this._isLocked&&null!==this.dependents?console.warn(r,this._moduleId):this._content=e},e.prototype.lock=function(){this._isLocked=!0},e}();t.ShaderModuleUnit=i},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(30)),r(n(153)),r(n(154)),r(n(92))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(16);t.generateDefaultElements=function(e){var t=e.canvas.height,n=e.canvas.width,i={aspectRatio:n/t,bottom:-t/2,far:1e7,left:-n/2,near:-100,right:n/2,top:t/2,viewSize:t},o=new r.Camera({type:r.CameraProjectionType.ORTHOGRAPHIC,left:i.left,right:i.right,top:i.top,bottom:i.bottom,near:i.near,far:i.far});return o.scale=[1,-1,1],o.position=[0,0,-300],o.update(),{camera:o,viewport:{bottom:0,left:0,right:0,top:0}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5)("performance"),i=function(){function e(){}return e.prototype.setDeclaration=function(e,t,n,i){e.has(t)&&r("%s: Overriding declaration %s\nSetting new value: %s",i||"Expand IO Declarations",t,n),e.set(t,n)},e}();t.BaseShaderIOInjection=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(52),a=n(2),s=n(0),u=n(75),c=n(38),l=n(31),h="EasingIOExpansion",f=Math.abs,d=Math.max,p={duration:0,start:[0],end:[0],startTime:0},g={1:"float",2:"vec2",3:"vec3",4:"vec4",9:"mat3",16:"mat4",99:"vec4"},v="easingMethod",y="T";t.createEasingAttribute=function(e){return e};var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.baseAttributeName=new Map,t}return i(t,e),t.prototype.expand=function(e,t,n,r){for(var i,c=new Set,l=[],h=[],g=0,v=t;g<v.length;g++){var y=v[g];i=y,Boolean(i)&&i.easing&&void 0!==i.size&&i.size<=4&&l.push(y)}var m={};e.easingId=m;for(var b=function(t,n){var r=l[t],i=r.easing,g=i.cpu,v=i.loop,y=i.uid,b=r.name,_=r.size,x=r.update,w=y;T.baseAttributeName.set(r,r.name),r.name="_"+r.name+"_end",m[r.name]=w,c.has(w)&&console.error("Undefined behavior occurs if you reuse an IAutoEasingMethod. Please ensure you are using uid() from the util to give the IAutoEasingMethod its uid, or just use the default provided methods"),c.add(w);var E,O,R,S,A,M,I,P,L,C,B,F,D,N={values:p};r.update=function(t){if(L=e.surface.frameMetrics,O=r.easing.delay,R=r.easing.duration,I=x(t),P=L.currentTime,t.easing=F=t.easing||new Map,C=F.get(w),B&&C?t.reactivate&&(B.copy(I,C.end),B.copy(I,C.end),C.startTime=P):(B=a.VecMath(I),C=new u.EasingProps({duration:R,end:B.copy(I),start:B.copy(I),startTime:P}),F.set(w,C)),S=R,E=O,(A=C).isTimeSet&&(S=A.duration||R,E=A.delay||0),!A.isManualStart){switch(M=1,v){case o.AutoEasingLoopStyle.CONTINUOUS:M=(P-A.startTime)/S,D=!0;break;case o.AutoEasingLoopStyle.REPEAT:M=(P-A.startTime)/S%1,D=!0;break;case o.AutoEasingLoopStyle.REFLECT:var n=(P-A.startTime)/S;M=2*f(n/2%1-.5),D=!0;break;case o.AutoEasingLoopStyle.NONE:default:M=(P-A.startTime)/S,D=!1}A.start=g(A.start,A.end,M,A.start)}return A.startTime=P+E,B.copy(I,A.end),N.values=A,e.animationEndTime=d(e.animationEndTime,A.startTime+S+L.frameDuration),e.isAnimationContinuous=D,I},r.childAttributes=r.childAttributes||[];var U={name:"_"+b+"_start",parentAttribute:r,size:_,update:function(e){return N.values.start}};r.childAttributes.push(U),h.push(U);var j={name:"_"+b+"_start_time",parentAttribute:r,size:s.InstanceAttributeSize.ONE,update:function(e){return[N.values.startTime]}};r.childAttributes.push(j),h.push(j);var G={name:"_"+b+"_duration",parentAttribute:r,size:s.InstanceAttributeSize.ONE,update:function(e){return[N.values.duration]}};r.childAttributes.push(G),h.push(G)},T=this,_=0,x=l.length;_<x;++_)b(_);return{instanceAttributes:h,vertexAttributes:[],uniforms:[]}},t.prototype.validate=function(e,t,n,r){var i=!1;return t.forEach((function(e){e.easing&&e.resource&&(console.warn("An instance attribute can not have both easing and resource properties. Undefined behavior will occur."),console.warn(e),i=!0),e.easing&&void 0===e.size&&console.warn("An Instance Attribute with easing MUST have a size declared")})),!i},t.prototype.processAttributeDestructuring=function(e,t,n,r,i,a){for(var s=0,u=i.length;s<u;++s){var c=i[s];if(c.easing&&c.size){var l=this.baseAttributeName.get(c);if(l){this.baseAttributeName.delete(c);var f="_"+l+"_time",d="_"+l+"_duration",p="_"+l+"_start_time";switch(c.easing.loop){case o.AutoEasingLoopStyle.CONTINUOUS:this.setDeclaration(t,f,"  float "+f+" = (currentTime - "+p+") / "+d+";\n",h);break;case o.AutoEasingLoopStyle.REPEAT:this.setDeclaration(t,f,"  float "+f+" = clamp(fract((currentTime - "+p+") / "+d+"), 0.0, 1.0);\n",h);break;case o.AutoEasingLoopStyle.REFLECT:var v="_"+l+"_timePassed",y="_"+l+"_pingPong";this.setDeclaration(t,v,"  float "+v+" = (currentTime - "+p+") / "+d+";\n",h),this.setDeclaration(t,y,"  float "+y+" = abs((fract("+v+" / 2.0)) - 0.5) * 2.0;\n",h),this.setDeclaration(t,f,"  float "+f+" = clamp("+y+", 0.0, 1.0);\n",h);break;case o.AutoEasingLoopStyle.NONE:default:this.setDeclaration(t,f,"  float "+f+" = clamp((currentTime - "+p+") / "+d+", 0.0, 1.0);\n",h)}this.setDeclaration(t,l,"  "+g[c.size]+" "+l+" = "+c.easing.methodName+"(_"+l+"_start, _"+l+"_end, _"+l+"_time);\n",h)}else console.warn("Could not determine a base name for an easing attribute.")}}return""},t.prototype.processHeaderInjection=function(e,t,n,r,i,o,a){var u=this,l={injection:""};if(e!==s.ShaderInjectionTarget.VERTEX)return l;var f=new Map;if(l.injection="// Auto Easing Methods specified by the layer\n",o.forEach((function(e){if(e.easing&&e.size){var t=f.get(e.easing.methodName);t||(t=new Map,f.set(e.easing.methodName,t)),t.set(e.size,e.easing.gpu)}})),0===f.size)return l.injection="",l;var d={name:"Easing Method Generation",values:[v]};return f.forEach((function(e,n){e.forEach((function(e,r){var i,o=g[r],a=((i={})[v]=o+" "+n+"("+o+" start, "+o+" end, float t)",i[y]=""+o,i),s=c.shaderTemplate({options:a,required:d,shader:e});u.setDeclaration(t,o+" "+n,s.shader+"\n",h)}))})),l},t}(l.BaseIOExpansion);t.EasingIOExpansion=m},function(e,t,n){"use strict";var r,i,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(59),u=n(4),c=n(26),l=n(31),h=n(0),f="BasicIOExpansion",d=["x","y","z","w"],p=((i={})[h.UniformSize.ONE]="float",i[h.UniformSize.TWO]="vec2",i[h.UniformSize.THREE]="vec3",i[h.UniformSize.FOUR]="vec4",i[h.UniformSize.MATRIX3]="mat3",i[h.UniformSize.MATRIX4]="mat4",i[h.UniformSize.FLOAT_ARRAY]="float",i[h.UniformSize.VEC4_ARRAY]="vec4",i[h.UniformSize.TEXTURE]="vec4",i);function g(e){return e&&e.length}var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.generateUniformAttributePacking=function(e,t){return this.setDeclaration(e,s.uniformBufferInstanceBufferName,"\n// Instance Attributes as a packed Uniform Buffer\nuniform vec4 "+s.uniformBufferInstanceBufferName+"["+t.totalInstanceUniformBlocks+"];\n",f),this.setDeclaration(e,"instanceSize","int instanceSize = "+t.totalInstanceUniformBlocks+";",f),this.setDeclaration(e,"getBlock","vec4 getBlock(int index, int instanceIndex) { return "+s.uniformBufferInstanceBufferName+"[(instanceSize * instanceIndex) + index]; }",f),{injection:"",material:{uniforms:[{name:s.uniformBufferInstanceBufferName,type:c.MaterialUniformType.VEC4_ARRAY,value:new Array(t.totalInstanceUniformBlocks).fill(0).map((function(){return[0,0,0,0]}))}]}}},t.prototype.processAttributeDestructuring=function(e,t,n,r,i,o){var a="",s=i.slice(0);switch(e.bufferType){case h.LayerBufferType.INSTANCE_ATTRIBUTE:a=this.processDestructuringInstanceAttribute(t,s);break;case h.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING:a=this.processDestructuringInstanceAttributePacking(t,s);break;case h.LayerBufferType.UNIFORM:a=this.processDestructuringUniformBuffer(t,s,n.blocksPerInstance)}return e.picking.type===h.PickType.SINGLE&&(a+="\n// This portion is where the shader assigns the picking color that gets passed to the fragment shader\n_picking_color_pass_ = _pickingColor;\n"),a},t.prototype.processDestructuringInstanceAttribute=function(e,t){return""},t.prototype.processDestructuringInstanceAttributePacking=function(e,t){var n="";return n+=this.processDestructureBlocks(e,t)},t.prototype.processDestructuringUniformBuffer=function(e,t,n){this.setDeclaration(e,"instanceIndex","int instanceIndex = int(instance);",f);for(var r=0;r<n;++r)this.setDeclaration(e,"block"+r,"  vec4 block"+r+" = getBlock("+r+", instanceIndex);\n",f);return this.processDestructureBlocks(e,t)},t.prototype.processDestructureBlocks=function(e,t){var n=this;return t.forEach((function(t){var r,i,o=t.block||0;t.size===h.InstanceAttributeSize.MAT4X4?n.setDeclaration(e,t.name,"  "+p[t.size]+" "+t.name+" = mat4(block"+o+", block"+(o+1)+", block"+(o+2)+", block"+(o+3)+");\n",f):t.size===h.InstanceAttributeSize.FOUR?n.setDeclaration(e,t.name,"  "+p[t.size]+" "+t.name+" = block"+o+";\n",f):n.setDeclaration(e,t.name,"  "+p[t.size||1]+" "+t.name+" = block"+o+"."+(r=t.blockIndex||0,i=t.size||1,d.slice(r,r+i).join("")+";\n"),f)})),""},t.prototype.processHeaderInjection=function(e,t,n,r,i,o,s){var u={injection:""};e===h.ShaderInjectionTarget.VERTEX&&(u=this.processAttributeHeader(t,n,r,i,o));var c=this.processUniformHeader(t,s,e);return a(a({},u),{injection:u.injection+c})},t.prototype.processAttributeHeader=function(e,t,n,r,i){var o=void 0,a="// Shader input\n";if(t.bufferType===h.LayerBufferType.UNIFORM&&i.length>0){var s=this.generateUniformAttributePacking(e,n);o=s.material,a+=s.injection}return a+=this.processVertexAttributes(e,r),t.bufferType===h.LayerBufferType.INSTANCE_ATTRIBUTE&&i.length>0&&(a+=this.processInstanceAttributeBufferStrategy(e,i)),t.bufferType===h.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING&&i.length>0&&(a+=this.processInstanceAttributePackingBufferStrategy(e,n.instanceMaxBlock)),{injection:a,material:o}},t.prototype.processUniformHeader=function(e,t,n){var r=this,i=n||h.ShaderInjectionTarget.VERTEX;return t.forEach((function(t){t.shaderInjection=t.shaderInjection||h.ShaderInjectionTarget.VERTEX,t.shaderInjection!==i&&t.shaderInjection!==h.ShaderInjectionTarget.ALL||r.setDeclaration(e,t.name,function(e){var t=e.size;if(t===h.UniformSize.FLOAT_ARRAY||t===h.UniformSize.VEC4_ARRAY){var n=e.update(e);if(g(n))return"#define "+e.name+"_length "+n.length+"\n"}return""}(t)+"uniform "+(t.qualifier||"")+(t.qualifier?" ":"")+p[t.size]+" "+t.name+function(e){var t=e.size;return t!==h.UniformSize.FLOAT_ARRAY&&t!==h.UniformSize.VEC4_ARRAY||!g(e.update(e))?"":"["+e.name+"_length]"}(t)+";\n",f)})),""},t.prototype.processInstanceAttributeBufferStrategy=function(e,t){var n=this,r="attribute";return u.WebGLStat.SHADERS_3_0&&(r="in"),t.forEach((function(t){n.setDeclaration(e,t.name,r+" "+p[t.size||1]+" "+(t.qualifier||"")+(t.qualifier?" ":"")+" "+t.name+";\n",f)})),""},t.prototype.processInstanceAttributePackingBufferStrategy=function(e,t){var n="attribute";u.WebGLStat.SHADERS_3_0&&(n="in");for(var r=0,i=t+1;r<i;++r)this.setDeclaration(e,"block"+r,n+" "+p[h.InstanceAttributeSize.FOUR]+" block"+r+";\n",f);return""},t.prototype.processVertexAttributes=function(e,t){var n=this,r="attribute";return u.WebGLStat.SHADERS_3_0&&(r="in"),t.forEach((function(t){n.setDeclaration(e,t.name,r+" "+p[t.size]+" "+(t.qualifier||"")+(t.qualifier?" ":"")+t.name+";\n",f)})),""},t}(l.BaseIOExpansion);t.BasicIOExpansion=v},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(59),a=n(31),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.processAttributeDestructuring=function(e,t,r,i,a,s){return a.find((function(e){return e.name===o.activeAttributeName}))?(this.setDeclaration(t,"__active_attribute_handler__",n(152),"ActiveIOExpansion"),""):""},t}(a.BaseIOExpansion);t.ActiveIOExpansion=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};t.emitOnce=function(e,t){var n=r[e]||[t,-1,0];r[e]=n,n[2]++,clearTimeout(n[1]),n[1]=window.setTimeout((function(){t(n[2],e),delete r[e]}),1)},t.flushEmitOnce=function(){for(var e in r){var t=r[e];clearTimeout(t[1]),t[0](t[2],e)}r={}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(59),a=n(4),s=n(26),u=n(8),c=n(39),l=n(30);t.isUniformBufferLocation=function(e){return e&&e.buffer&&e.buffer.value&&e.type===s.MaterialUniformType.VEC4_ARRAY};var h=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.buffers=[],r.availableClusters=[],r.instanceToCluster={},r.clusterToBuffer=new Map,r.add=function(e){r.availableClusters.length<=0&&r.makeNewBuffer();var t=r.availableClusters.pop();return t?r.instanceToCluster[e.uid]=t:console.warn("No valid cluster available for instance added to uniform manager."),t},r.remove=function(e){var t=this.instanceToCluster[e.uid];return t&&(delete this.instanceToCluster[e.uid],this.availableClusters.push(t)),e};var i=0;return t.shaderIOInfo.instanceAttributes.forEach((function(e){i=Math.max(e.block||0,i)})),r.uniformBlocksPerInstance=i+1,r}return i(t,e),t.prototype.destroy=function(){this.buffers.forEach((function(e){e.geometry.destroy(),e.material.dispose()}))},t.prototype.getBufferLocations=function(e){return this.instanceToCluster[e.uid]},t.prototype.getActiveAttributePropertyId=function(){return-1},t.prototype.getInstanceCount=function(){return-1},t.prototype.getUpdateAllPropertyIdList=function(){return[]},t.prototype.managesInstance=function(e){return void 0===this.instanceToCluster[e.uid]},t.prototype.removeFromScene=function(){var e=this.scene;if(e.container){for(var t=0,n=this.buffers.length;t<n;++t){var r=this.buffers[t];e.container.remove(r.model)}delete this.scene}},t.prototype.setScene=function(e){if(e.container){for(var t=0,n=this.buffers.length;t<n;++t){var r=this.buffers[t];e.container.add(r.model)}this.scene=e}else console.warn("Can not set a scene that has an undefined container.")},t.prototype.makeNewBuffer=function(){var e=this.layer.shaderIOInfo,t=new a.Geometry;e.vertexAttributes.forEach((function(e){e.materialAttribute&&t.addAttribute(e.name,e.materialAttribute)}));var n=this.makeLayerMaterial(),r=c.generateLayerModel(t,n,e.drawMode);r.vertexDrawRange=[0,e.maxInstancesPerBuffer*e.instanceVertexCount];var i={activeInstances:[],clusters:[],firstInstance:0,geometry:t,lastInstance:0,material:n,model:r};this.buffers.push(i);var l=0,h=o.uniformBufferInstanceBufferName,f=n.uniforms[h];if(s.isUniformVec4Array(f)){f.value=f.value.map((function(){return[0,0,0,0]}));for(var d=Object.assign({},e.instanceAttributes[0],{bufferAttribute:new a.Attribute(new Float32Array(1),1),uid:u.uid()}),p=0,g=e.maxInstancesPerBuffer;p<g;++p){var v={attribute:d,buffer:f,instanceIndex:p,range:[l,0]};l+=this.uniformBlocksPerInstance,v.range[1]=l,i.clusters.push(v),this.availableClusters.push(v),this.clusterToBuffer.set(v,i)}for(p=0,g=e.uniforms.length;p<g;++p){var y=e.uniforms[p];y.materialUniforms.push(n.uniforms[y.name])}this.scene&&this.scene.container&&this.scene.container.add(i.model)}else console.warn("Material is utilizing an invalid uniform type for Uniform Buffer Management. Buffering will not be possible.")},t}(l.BufferManagerBase);t.UniformBufferManager=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t){this.layer=e,this.bufferManager=t};t.BaseDiffProcessor=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(56),o=function(){function e(e){this.isMouseOver=new Set,this.isMouseDown=new Set,this.isTouchOver=new Map,this.isTouchDown=new Map,this.layer=e}return e.prototype.getColorPickInstance=function(e){return this.colorPicking&&this.layer.picking.type===r.PickType.SINGLE&&this.colorPicking.view===e?this.layer.uidToInstance.get(16777215-this.colorPicking.nearestColor):null},e.prototype.handleMouseOver=function(e,t){},e.prototype.handleTouchOver=function(e,t,n){},e.prototype.handleMouseDown=function(e,t){var n=this;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var i=this.layer.props.onMouseDown;if(i){var o=e.projection.screenToWorld(t.screen.position),a=[];if(this.layer.picking.type===r.PickType.SINGLE){var s=this.getColorPickInstance(e);s&&a.push(s)}i({interaction:t,instances:a,layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:o}),this.isMouseDown.clear(),a.forEach((function(e){return n.isMouseDown.add(e)}))}}},e.prototype.handleTouchDown=function(e,t,n){var o=this.layer.props,a=o.onTouchDown,s=o.onTouchOver;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE&&(a||s)){var u=e.projection.screenToWorld(n.screen.position),c=[];if(this.layer.picking.type===r.PickType.SINGLE){var l=this.getColorPickInstance(e);l&&c.push(l)}var h={interaction:t,touch:n,instances:c,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:u},f=i.mapInjectDefault(this.isTouchDown,n.touch.touch.identifier,(function(){return new Set})),d=i.mapInjectDefault(this.isTouchOver,n.touch.touch.identifier,(function(){return new Set}));c.forEach((function(e){f.add(e),d.add(e)})),s&&s(h),a&&a(h)}},e.prototype.handleMouseOut=function(e,t){if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var n=this.layer.props.onMouseOut;if(n){var i=e.projection.screenToWorld(t.screen.position);n({interaction:t,instances:Array.from(this.isMouseOver.keys()),layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:i})}}this.isMouseOver.clear()},e.prototype.handleTouchOut=function(e,t,n){var i=this.layer.props.onTouchOut;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE&&i){var o=e.projection.screenToWorld(n.screen.position);i({interaction:t,touch:n,instances:Array.from(this.isMouseOver.keys()),layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:o}),this.isTouchOver.delete(n.touch.touch.identifier)}},e.prototype.handleMouseUp=function(e,t){var n=this,i=this.layer.props,o=i.onMouseUp,a=i.onMouseUpOutside;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE&&o){var s=e.projection.screenToWorld(t.screen.position),u=[];if(this.layer.picking.type===r.PickType.SINGLE){var c=this.getColorPickInstance(e);c&&u.push(c)}var l={interaction:t,instances:u,layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:s};o(l),u.forEach((function(e){return n.isMouseDown.delete(e)})),this.isMouseDown.size<=0||!a||a(l={interaction:t,instances:Array.from(this.isMouseDown.values()),layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:s})}},e.prototype.handleTouchUp=function(e,t,n){var o=this.layer.props,a=o.onTouchUp,s=o.onTouchUpOutside,u=o.onTouchOut,c=o.onTouchAllEnd;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE&&(a||s||u||c)){var l=e.projection.screenToWorld(n.screen.position),h=[];if(this.layer.picking.type===r.PickType.SINGLE){var f=this.getColorPickInstance(e);f&&h.push(f)}var d={interaction:t,touch:n,instances:h,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:l};u&&u(d),a&&a(d);var p=i.mapGetWithDefault(this.isTouchDown,n.touch.touch.identifier,new Set);h.forEach((function(e){return p.delete(e)})),p.size>0&&s&&s(d={interaction:t,touch:n,instances:Array.from(p.values()),layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:l}),this.isTouchDown.delete(n.touch.touch.identifier),this.isTouchDown.size<=0&&c&&c(d={interaction:t,touch:n,instances:[],layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:l})}},e.prototype.handleMouseMove=function(e,t){var n=this,i=this.layer.props,o=i.onMouseOver,a=i.onMouseMove,s=i.onMouseOut;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE&&(o||a||s)){var u=void 0,c=e.projection.screenToWorld(t.screen.position),l=[];if(this.layer.picking.type===r.PickType.SINGLE){var h=this.getColorPickInstance(e);h&&l.push(h)}var f=new Set;if(l.forEach((function(e){return f.add(e)})),s){var d=[];this.isMouseOver.forEach((function(e){f.has(e)||d.push(e)})),u={interaction:t,instances:d,layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:c},d.length>0&&s(u)}if(o){var p=l.filter((function(e){return!n.isMouseOver.has(e)}));u={interaction:t,instances:p,layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:c},p.length>0&&o(u)}a&&a(u={interaction:t,instances:l,layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:c}),this.isMouseOver=f}},e.prototype.handleTouchMove=function(e,t,n){var o=this.layer.props,a=o.onTouchOver,s=o.onTouchMove,u=o.onTouchOut;if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE&&(a||s||u)){var c=void 0,l=e.projection.screenToWorld(n.screen.position),h=[];if(this.layer.picking.type===r.PickType.SINGLE){var f=this.getColorPickInstance(e);f&&h.push(f)}var d=i.mapGetWithDefault(this.isTouchOver,n.touch.touch.identifier,new Set),p=new Set;if(h.forEach((function(e){return p.add(e)})),u){var g=[];d.forEach((function(e){p.has(e)||g.push(e)})),c={interaction:t,touch:n,instances:g,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:l},g.length>0&&u(c)}if(a){var v=h.filter((function(e){return!d.has(e)}));c={interaction:t,touch:n,instances:v,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:l},v.length>0&&a(c)}s&&s(c={interaction:t,touch:n,instances:h,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:l}),this.isMouseOver=p}},e.prototype.handleMouseClick=function(e,t){if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var n=this.layer.props.onMouseClick;if(n){var i=e.projection.screenToWorld(t.screen.position),o=[];if(this.layer.picking.type===r.PickType.SINGLE){var a=this.getColorPickInstance(e);a&&o.push(a)}n({interaction:t,instances:o,layer:this.layer.id,projection:e.projection,screen:t.screen.position,world:i})}}},e.prototype.handleTap=function(e,t,n){if(this.layer.picking&&this.layer.picking.type!==r.PickType.NONE){var i=this.layer.props.onTap;if(i){var o=e.projection.screenToWorld(n.screen.position),a=[];if(this.layer.picking.type===r.PickType.SINGLE){var s=this.getColorPickInstance(e);s&&a.push(s)}i({interaction:t,touch:n,instances:a,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:o})}}},e.prototype.handleMouseDrag=function(e,t){},e}();t.LayerInteractionHandler=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(159);t.normalizeWheel=r.normalizeWheel,t.eventElementPosition=function(e,t){var n=0,r=0,i=0,o=0,a=t||e.nativeEvent&&e.nativeEvent.target||e.target;if(e||(e=window.event),e.pageX||e.pageY)n=e.pageX,r=e.pageY;else if(e.clientX||e.clientY){var s=0,u=0;document.documentElement&&(s=document.documentElement.scrollLeft,u=document.documentElement.scrollTop),n=e.clientX+document.body.scrollLeft+s,r=e.clientY+document.body.scrollTop+u}if(a.offsetParent)do{i+=a.offsetLeft,o+=a.offsetTop,a=a.offsetParent}while(a);return[n-i,r-o]}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=n(2);t.filterQuery=function(e,t){var n=[];return t.forEach((function(t){e.find((function(e){return t instanceof e}))&&n.push(t)})),n};var s=function(){function e(e,t){var n=e.mid;this.TL=new u(e.x,n[0],e.y,n[1],t),this.TR=new u(n[0],e.right,e.y,n[1],t),this.BL=new u(e.x,n[0],n[1],e.bottom,t),this.BR=new u(n[0],e.right,n[1],e.bottom,t)}return e.prototype.destroy=function(){this.TL.destroy(),this.TR.destroy(),this.BL.destroy(),this.BR.destroy(),delete this.TL,delete this.TR,delete this.BL,delete this.BR},e}();t.QuadTreeQuadrants=s;var u=function(){function e(e,t,n,r,i){this.children=[],this.depth=0,this.bounds=arguments.length>=4?new o.Bounds({left:e,right:t,top:n,bottom:r}):new o.Bounds({left:0,right:1,top:0,bottom:1}),this.depth=i||0}return e.prototype.destroy=function(){delete this.children,delete this.bounds,this.nodes&&(this.nodes.destroy(),delete this.nodes)},e.prototype.add=function(e,t){return e.isInside(this.bounds)?this.doAdd(e):(this.cover(e),this.add(e,t))},e.prototype.addAll=function(e){for(var t=this,n=Number.MAX_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,a=Number.MIN_SAFE_INTEGER,s=Math.min,u=Math.max,c=0,l=e.length;c<l;++c){var h=e[c];n=s(n,h.x),i=u(h.right,i),r=s(r,h.y),a=u(a,h.bottom)}this.cover(new o.Bounds({left:n,right:i,top:r,bottom:a})),e.forEach((function(e){return t.doAdd(e)}))},e.prototype.cover=function(e){var t=this;if(!e.isInside(this.bounds)){this.bounds.encapsulate(e),this.bounds.x-=1,this.bounds.y-=1,this.bounds.width+=2,this.bounds.height+=2;var n=this.gatherChildren([]);this.nodes&&(this.nodes.destroy(),delete this.nodes),n.forEach((function(e){return t.doAdd(e)}))}},e.prototype.doAdd=function(e){return this.nodes?e.isInside(this.nodes.TL.bounds)?this.nodes.TL.doAdd(e):e.isInside(this.nodes.TR.bounds)?this.nodes.TR.doAdd(e):e.isInside(this.nodes.BL.bounds)?this.nodes.BL.doAdd(e):e.isInside(this.nodes.BR.bounds)?this.nodes.BR.doAdd(e):(this.children.push(e),!0):e.isInside(this.bounds)?(this.children.push(e),this.children.length>5&&this.depth<10&&this.split(),!0):(isNaN(e.width+e.height+e.x+e.y)?console.error("Child did not fit into bounds because a dimension is NaN",e):0===e.area&&console.error("Child did not fit into bounds because the area is zero",e),!0)},e.prototype.gatherChildren=function(e,t){t&&t(this);for(var n=0,r=this.children.length;n<r;++n)e.push(this.children[n]);return this.nodes&&(this.nodes.TL.gatherChildren(e,t),this.nodes.TR.gatherChildren(e,t),this.nodes.BL.gatherChildren(e,t),this.nodes.BR.gatherChildren(e,t)),e},e.prototype.query=function(e,t){return e instanceof o.Bounds?e.hitBounds(this.bounds)?this.queryBounds(e,[],t):[]:a.isVec2(e)&&this.bounds.containsPoint(e)?this.queryPoint(e,[],t):[]},e.prototype.queryBounds=function(e,t,n){return this.bounds.isInside(e)?(this.gatherChildren(t,n),t):(this.children.forEach((function(n){n.hitBounds(e)&&t.push(n)})),n&&n(this),this.nodes&&(e.hitBounds(this.nodes.TL.bounds)&&this.nodes.TL.queryBounds(e,t,n),e.hitBounds(this.nodes.TR.bounds)&&this.nodes.TR.queryBounds(e,t,n),e.hitBounds(this.nodes.BL.bounds)&&this.nodes.BL.queryBounds(e,t,n),e.hitBounds(this.nodes.BR.bounds)&&this.nodes.BR.queryBounds(e,t,n)),t)},e.prototype.queryPoint=function(e,t,n){return this.children.forEach((function(n){n.containsPoint(e)&&t.push(n)})),n&&n(this),this.nodes&&(this.nodes.TL.bounds.containsPoint(e)&&this.nodes.TL.queryPoint(e,t,n),this.nodes.TR.bounds.containsPoint(e)&&this.nodes.TR.queryPoint(e,t,n),this.nodes.BL.bounds.containsPoint(e)&&this.nodes.BL.queryPoint(e,t,n),this.nodes.BR.bounds.containsPoint(e)&&this.nodes.BR.queryPoint(e,t,n)),t},e.prototype.split=function(){var e=[];this.gatherChildren(e),this.nodes=new s(this.bounds,this.depth+1),this.children=[];for(var t=0,n=e.length;t<n;++t){var r=e[t];r&&this.doAdd(r)}},e.prototype.visit=function(e){var t=Boolean(e(this));this.nodes&&!t&&(this.nodes.TL.visit(e),this.nodes.TR.visit(e),this.nodes.BL.visit(e),this.nodes.BR.visit(e))},e}();t.QuadTreeNode=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(u);t.QuadTree=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(34),a=n(43),s=function(e){function t(t,n){void 0===n&&(n=!1);var r=e.call(this)||this;return r.preserveQueueMouse=[],r.singleQueueMouse=new Map,r.preserveQueueTouch=[],r.singleQueueTouch=new Map,r.preserveEvents=!1,r.handlers=new a.SimpleEventHandler(t),r.preserveEvents=n,r}return i(t,e),t.prototype.dequeue=function(){try{this.preserveEvents?(this.preserveQueueMouse.forEach((function(e){e[0](e[1])})),this.preserveQueueTouch.forEach((function(e){e[0](e[1])}))):(this.singleQueueMouse.forEach((function(e,t){t(e)})),this.singleQueueTouch.forEach((function(e,t){t(e)})))}catch(e){console.error("Queued events had errors. Further events aborted"),console.error(e.stack||e.message)}this.preserveQueueMouse=[],this.singleQueueMouse.clear(),this.preserveQueueTouch=[],this.singleQueueTouch.clear()},t.prototype.handleMouseDown=function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseDown,e]):this.singleQueueMouse.set(this.handlers.handleMouseDown,e)},t.prototype.handleMouseUp=function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseUp,e]):this.singleQueueMouse.set(this.handlers.handleMouseUp,e)},t.prototype.handleMouseOver=function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseOver,e]):this.singleQueueMouse.set(this.handlers.handleMouseOver,e)},t.prototype.handleMouseOut=function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseOut,e]):this.singleQueueMouse.set(this.handlers.handleMouseOut,e)},t.prototype.handleMouseMove=function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseMove,e]):this.singleQueueMouse.set(this.handlers.handleMouseMove,e)},t.prototype.handleClick=function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleClick,e]):this.singleQueueMouse.set(this.handlers.handleClick,e)},t.prototype.handleDrag=function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleDrag,e]):this.singleQueueMouse.set(this.handlers.handleDrag,e)},t.prototype.handleWheel=function(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleWheel,e]):this.singleQueueMouse.set(this.handlers.handleWheel,e)},t.prototype.handleTouchCancelled=function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchCancelled,e]):this.singleQueueTouch.set(this.handlers.handleTouchCancelled,e)},t.prototype.handleTouchDown=function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchDown,e]):this.singleQueueTouch.set(this.handlers.handleTouchDown,e)},t.prototype.handleTouchUp=function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchUp,e]):this.singleQueueTouch.set(this.handlers.handleTouchUp,e)},t.prototype.handleTouchOut=function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchOut,e]):this.singleQueueTouch.set(this.handlers.handleTouchOut,e)},t.prototype.handleTouchDrag=function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchDrag,e]):this.singleQueueTouch.set(this.handlers.handleTouchDrag,e)},t.prototype.handleTap=function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTap,e]):this.singleQueueTouch.set(this.handlers.handleTap,e)},t.prototype.handleDoubleTap=function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleDoubleTap,e]):this.singleQueueTouch.set(this.handlers.handleDoubleTap,e)},t.prototype.handleLongTouch=function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleLongTouch,e]):this.singleQueueTouch.set(this.handlers.handleLongTouch,e)},t.prototype.handleLongTap=function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleLongTap,e]):this.singleQueueTouch.set(this.handlers.handleLongTap,e)},t.prototype.handlePinch=function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handlePinch,e]):this.singleQueueTouch.set(this.handlers.handlePinch,e)},t.prototype.handleSpread=function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleSpread,e]):this.singleQueueTouch.set(this.handlers.handleSpread,e)},t.prototype.handleTouchRotate=function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchRotate,e]):this.singleQueueTouch.set(this.handlers.handleTouchRotate,e)},t.prototype.handleSwipe=function(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleSwipe,e]):this.singleQueueTouch.set(this.handlers.handleSwipe,e)},t}(o.EventManager);t.QueuedEventHandler=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.sortInstanceAttributes=function(e,t){return e.resource&&!t.resource||e.easing&&!t.easing?-1:1},e.prototype.sortVertexAttributes=function(e,t){return 1},e.prototype.sortUniforms=function(e,t){return 1},e}();t.BaseIOSorting=r},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(167)),r(n(100)),r(n(104)),r(n(105)),r(n(172)),r(n(63)),r(n(106))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(46),s=n(32),u=n(0),c=n(24),l=n(104),h=n(105),f=n(63),d=n(5)("performance");!function(e){e[e._16=16]="_16",e[e._32=32]="_32",e[e._64=64]="_64",e[e._128=128]="_128"}(t.FontGlyphRenderSize||(t.FontGlyphRenderSize={})),t.isFontResource=function(e){return e&&e.type===u.ResourceType.FONT},t.createFont=function(e){return r({key:"",type:u.ResourceType.FONT},e)};var p=function(){function e(){this.fontMaps=new Map,this.fontRenderer=new h.FontRenderer}return e.prototype.calculateMetrics=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,a,s,u;return o(this,(function(o){switch(o.label){case 0:if(d("Calculating metrics for requests"),!(n=this.fontMaps.get(e)))return[2];r=0,i=t.length,o.label=1;case 1:return r<i?(a=t[r],(s=a.metrics)?(s.layout=n.getStringLayout(s.text,s.fontSize,s.letterSpacing),s.maxWidth?(d("Calculating truncation for",s.text,s.maxWidth),u=s,[4,n.getTruncatedLayout(s.layout,s.truncation||"",s.maxWidth,s.fontSize,s.letterSpacing,this.fontRenderer)]):[3,3]):[3,3]):[3,4];case 2:u.layout=o.sent(),s.truncatedText=s.layout.text,o.label=3;case 3:return++r,[3,1];case 4:return[2]}}))}))},e.prototype.characterFilterToCharacters=function(e){for(var t=new Set,n="",r=0,i=e.length;r<i;++r){var o=e[r];t.has(o)||(t.add(o),n+=o)}return n},e.prototype.createFontMap=function(e){return i(this,void 0,void 0,(function(){var t,n,i,a;return o(this,(function(o){switch(o.label){case 0:return t=this.characterFilterToCharacters(e.characterFilter||""),i=e.fontSource,a=l.FontMapGlyphType.SDF,i&&(a=(s=i)&&void 0===s.type?l.FontMapGlyphType.BITMAP:i.type||a),n=new l.FontMap(r(r({},e),{glyphType:a})),[4,this.updateFontMapCharacters(t,n)];case 1:return o.sent(),this.fontMaps.set(e.key,n),e.fontSource.preload&&this.updateFontMap(e.key,[f.fontRequest({key:e.key,character:"",kerningPairs:[e.fontSource.preload],metrics:{fontSize:12,text:e.fontSource.preload,letterSpacing:0}})]),[2,n]}var s}))}))},e.prototype.destroy=function(){this.fontMaps.forEach((function(e){return e.destroy()}))},e.prototype.destroyFontMap=function(e){var t=this.fontMaps.get(e);t&&t.destroy()},e.prototype.updateFontMap=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,a,s,u,c,l,h,f;return o(this,(function(o){switch(o.label){case 0:if(!(n=this.fontMaps.get(e)))return[2];for(r=[],i=new Set,h=0,f=t.length;h<f;++h)if((a=t[h]).character&&i.add(a.character),a.kerningPairs&&(r=r.concat(a.kerningPairs)),a.metrics&&a.metrics.truncation)for(s=a.metrics.truncation.replace(/\s/g,""),r.push(s),u=0,c=a.metrics.truncation.length;u<c;++u)i.add(s);for(h=0,f=r.length;h<f;++h)i.add(r[h]);return l="",i.forEach((function(e){return l+=e})),[4,this.updateFontMapCharacters(l,n)];case 1:return o.sent(),[4,this.updateKerningPairs(r,n)];case 2:for(o.sent(),h=0,f=t.length;h<f;++h)t[h].fontMap=n;return[2]}}))}))},e.prototype.updateKerningPairs=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return t?[4,this.fontRenderer.estimateKerning(e,t.fontString,t.fontSource.size,t.kerning,!t.spaceWidth)]:[2];case 1:return n=r.sent(),t.addKerning(n.pairs),t.spaceWidth=t.spaceWidth||n.spaceWidth,[2]}}))}))},e.prototype.updateFontMapCharacters=function(e,t){return i(this,void 0,void 0,(function(){var n,i,u,l,h,f,d,p;return o(this,(function(o){if(!t)return[2];if(n=t.texture,(i=t.findMissingCharacters(e)).length<=0)return[2];for(l in u=this.fontRenderer.makeBitmapGlyphs(i,t.fontString,t.fontSource.size))if(h=u[l],n.data){if(f=new a.Bounds({x:0,y:0,width:h.glyph.width,height:h.glyph.height}),d=new c.SubTexture,!(p=t.packing.insert({data:d,bounds:f})))return console.warn("Font map is full and could not pack in any more glyphs"),[2];s.PackNode.applyToSubTexture(t.packing,p,d,void 0,!0),n.update(h.glyph,r(r({},p.bounds),{y:t.packing.bounds.height-p.bounds.y-p.bounds.height})),d?t.registerGlyph(l,d):console.warn("Could not generate a subtexture for the font map registration.")}else console.warn("Can not update font map as the maps texture data is not defined.");return[2]}))}))},e.prototype.getPrerenderedImageData=function(e,t,n){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){switch(i.label){case 0:return r=[],n.forEach((function(n){var i=e.glyphs[n];if(i||(i=e.errorGlyph),!e.errorGlyph)return console.warn("The prerendered source provided did NOT provide a proper glyph for rendering when a glyph could not be located."),[];var o,a=new Image,s=new Promise((function(e){return o=e}));return a.onload=function(){var e=document.createElement("canvas"),n=e.getContext("2d");if(n){e.width=t,e.height=t,n.drawImage(a,0,0,t,t);var r=n.getImageData(0,0,t,t);o(r)}},a.onerror=function(){console.warn("There was an issue with loading the glyph data for character:",n),o(null)},a.src=e.glyphs[n],r.push(s),[]})),[4,Promise.all(r)];case 1:return[2,i.sent()]}}))}))},e}();t.FontManager=p},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(28),a=n(29);t.waitForValidDimensions=function(e){var t=this,n=0,s=[];return Object.assign((function(u){return r(t,void 0,Promise,(function(){var t,r,c,l,h,f,d;return i(this,(function(i){switch(i.label){case 0:return void 0!==u&&u!==e&&(s.forEach((function(e){return e.resolve(!1)})),e=u),e?(t=++n,r=new a.PromiseResolver,c=e.getBoundingClientRect(),s.push(r),0!==c.width&&0!==c.height?[3,2]:(h=!0,f={attributes:!0},(l=new MutationObserver((function(i){if(h)for(var o=0,a=i;o<a.length;o++){if("attributes"===a[o].type){if(!e)return;0!==(c=e.getBoundingClientRect()).width&&0!==c.height&&(l&&(l.disconnect(),l=void 0),h=!1,r.resolve(t===n))}}}))).observe(e,f),[4,o.nextFrame()])):[2,!1];case 1:return i.sent(),c=e.getBoundingClientRect(),h&&0!==c.width&&0!==c.height&&(l.disconnect(),h=!1,r.resolve(t===n)),[3,4];case 2:return[4,o.nextFrame()];case 3:i.sent(),r.resolve(t===n),i.label=4;case 4:return[4,r.promise];case 5:return d=i.sent(),l&&(l.disconnect(),l=void 0),d&&(s.forEach((function(e){return e.resolve(!1)})),s=[]),[2,d]}}))}))}),{cancel:function(){s.forEach((function(e){return e.resolve(!1)})),s=[]}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createUniform=function(e){return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createVertex=function(e){return e}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var u,c=n(4),l=n(2),h=n(0),f=n(17),d=n(32),p=n(5)("performance");!function(e){e[e.BITMAP=0]="BITMAP",e[e.SDF=1]="SDF",e[e.MSDF=2]="MSDF"}(u=t.FontMapGlyphType||(t.FontMapGlyphType={}));var g=function(e){function t(t){var n=e.call(this,t)||this;n.dynamic=!1,n.glyphMap={},n.kerning={},n.spaceWidth=0,n.type=h.ResourceType.FONT,n.dynamic=t.dynamic||!1,n.fontSource=t.fontSource,t.characters&&t.characters.forEach((function(e){n.doRegisterGlyph(e[0],e[1])}));var r=t.fontMapSize?t.fontMapSize:[h.TextureSize._1024,h.TextureSize._1024];return n.makeGlyphTypeTextureSettings(t.glyphType),n.createTexture(r),n.packing=new d.PackNode(0,0,r[0],r[1]),n.addCachedKerning(),n}return i(t,e),Object.defineProperty(t.prototype,"fontString",{get:function(){return this.fontSource.size+"px "+this.fontSource.family},enumerable:!0,configurable:!0}),t.prototype.getKerningCacheName=function(){return"__deltav_kerning_cache_"+this.fontSource.family+"__"},t.prototype.addCachedKerning=function(){if(this.fontSource.localKerningCache){var e=localStorage.getItem(this.getKerningCacheName());if(e){p("Loading cached kerning items:",this.getKerningCacheName());try{var t=JSON.parse(e),n=0;for(var r in t){var i="string"==typeof r&&1===r.length;if(i){var o=t[r],a=this.kerning[r]||{};for(var s in this.kerning[r]=a,o)(i="string"==typeof r&&1===r.length)&&(a[s]=o[s],n++)}}p("Found kerning items in the cache!","Count:",n)}catch(e){}}}},t.prototype.addKerning=function(e){var t=!1;for(var n in e){var r=e[n],i=this.kerning[n]||{};for(var o in this.kerning[n]||(t=!0),this.kerning[n]=i,r)i[o]||(t=!0),i[o]=r[o]}if(t&&this.fontSource.localKerningCache)try{p("Storing kerning info in cache...");var a=JSON.stringify(this.kerning);localStorage.setItem(this.getKerningCacheName(),a)}catch(e){p("Could not cache kerning info")}},t.prototype.createTexture=function(e){var t;this.texture||(t=this.textureSettings?o({generateMipMaps:!0,premultiplyAlpha:!0},this.textureSettings):{generateMipMaps:!0,premultiplyAlpha:!0},this.texture=new c.Texture(o({data:{width:e[0],height:e[1],buffer:null}},t)))},t.prototype.destroy=function(){this.texture.destroy()},t.prototype.doRegisterGlyph=function(e,t){var n=e[0];this.glyphMap[n]?console.warn("A Glyph is already registered with a rendering"):this.glyphMap[n]=t},t.prototype.findMissingCharacters=function(e){for(var t=new Set,n="",r=0,i=e.length;r<i;++r){var o=e[r];this.glyphMap[o]||t.has(o)||(t.add(o),n+=o)}return n},t.prototype.getGlyphTexture=function(e){return this.glyphMap[e[0]]||null},t.prototype.getGlyphKerning=function(e,t){var n=this.kerning[e];return n&&n[t]||[0,0]},t.prototype.getGlyphWidth=function(e,t,n){var r=e.positions[t],i=e.positions[n];if(!t||!n)return 0;var o=this.glyphMap[e.glyphs[n]];return o?i[0]+o.pixelWidth-r[0]:0},t.prototype.getTruncatedLayout=function(e,t,n,r,i,o){return a(this,void 0,void 0,(function(){var a,u,c,l,f,d,p,g,v,y,m,b,T,_,x;return s(this,(function(s){switch(s.label){case 0:if(!(e.size[0]>n))return[3,5];for(a="",u=0,T=0,_=t.length;T<_;++T)u+=this.glyphMap[t[T]].pixelWidth;if(u>n)return[2,{fontScale:1,glyphs:"",positions:[],size:[0,0],text:""}];for(c=0,l=e.positions.length,f=0,d=0,p="";c!==l;){if(f=Math.floor((l-c)/2)+c,p=e.glyphs[f],(d=e.positions[f][0]+this.glyphMap[p].pixelWidth+u)>n)l=f;else{if(!(d<n))break;c=f}if(Math.abs(c-l)<=1){if(d<n)break;for(;d>n&&f>=0;)f--,d=e.positions[f][0]+this.glyphMap[p].pixelWidth+u;break}}if(!((d=e.positions[f][0]+this.glyphMap[p].pixelWidth+u)<n))return[3,3];for(g=0,v=0,T=0,_=e.text.length;T<_&&g<=f;++T)y=e.text[T],v++,h.isWhiteSpace(y)||g++;for(m=e.text[v-1],b=void 0,T=0,_=t.length;T<_;++T)if(!h.isWhiteSpace(t[T])){b=t[T];break}return m&&b&&!this.kerning[m][b]?[4,o.estimateKerning([m+b],this.fontString,this.fontSource.size,this.kerning,!1)]:[3,2];case 1:x=s.sent(),this.addKerning(x.pairs),s.label=2;case 2:return a=""+e.text.substr(0,v)+t,[3,4];case 3:a=t,s.label=4;case 4:return[2,this.getStringLayout(a,r,i)];case 5:return[2,e]}}))}))},t.prototype.getStringWidth=function(e,t,n){var r=e.text,i=0,o=r.length;if("string"==typeof t){var a=r.indexOf(t);if(a<0)return 0;o=(i=a)+t.length}else i=t;void 0!==n&&(o=n);for(var s=0,u=Math.min(r.length,i),c=Math.min(r.length,o);s<u;++s)h.isWhiteSpace(r[s])&&(i--,o--);for(;s<c;++s)h.isWhiteSpace(r[s])&&o--;var l=this.glyphMap[e.text[o]||""];return l?(e.positions[o]||[0,0])[0]-(e.positions[i]||[0,0])[0]+l.pixelWidth:0},t.prototype.getStringLayout=function(e,t,n){for(var r,i,o=[],a="",s=t/this.fontSource.size,u=Number.MAX_SAFE_INTEGER,c=0,f=0,d=[0,0],p=this.spaceWidth,g=0,v="",y=0,m=e.length;y<m;++y){var b=e[y];h.isWhiteSpace(b)?g++:(r=[0,0],v&&(r=this.kerning[v][b]||[0,0]),d=l.add2(l.add2(d,l.scale2(r,s)),[g*p*s+(0===y?0:n),0]),o.push([d[0],d[1]]),a+=b,i=this.glyphMap[b],u=Math.min(d[1],u),c=Math.max(d[1]+i.pixelHeight*s,c),v=b,f=d[0]+i.pixelWidth*s,g=0)}var T=[f,c-u];for(y=0,m=o.length;y<m;++y)(d=o[y])[1]-=u;return{fontScale:s,glyphs:a,positions:o,size:T,text:e}},t.prototype.makeGlyphTypeTextureSettings=function(e){switch(e){case u.BITMAP:this.textureSettings={magFilter:c.GLSettings.Texture.TextureMagFilter.Linear,minFilter:c.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear,internalFormat:c.GLSettings.Texture.TexelDataType.LuminanceAlpha,format:c.GLSettings.Texture.TexelDataType.LuminanceAlpha};break;case u.SDF:this.textureSettings={magFilter:c.GLSettings.Texture.TextureMagFilter.Linear,minFilter:c.GLSettings.Texture.TextureMinFilter.Linear,internalFormat:c.GLSettings.Texture.TexelDataType.Luminance,format:c.GLSettings.Texture.TexelDataType.Luminance};break;case u.MSDF:this.textureSettings={magFilter:c.GLSettings.Texture.TextureMagFilter.Linear,minFilter:c.GLSettings.Texture.TextureMinFilter.Linear,internalFormat:c.GLSettings.Texture.TexelDataType.RGB,format:c.GLSettings.Texture.TexelDataType.RGB}}},t.prototype.registerGlyph=function(e,t){this.dynamic?this.doRegisterGlyph(e,t):console.warn("Attempted to register a new glyph with a non-dynamic FontMap")},t.prototype.supportsKerning=function(e){for(var t=1,n=e.length;t<n;++t){var r=e[t],i=e[t-1];if(!this.kerning[i])return!1;if(!this.kerning[i][r])return!1}return!0},t}(f.IdentifyByKey);t.FontMap=g},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(14),a=n(12),s=n(106),u=n(171),c=n(5)("performance"),l=Math.floor;function h(e,t,n,h){return r(this,void 0,void 0,(function(){var r,f,d,p,g,v,y,m,b,T,_,x,w,E,O,R,S,A,M,I,P,L,C,B,F,D,N,U,j,G,z,k,V,W,H,q,X,Q,Y,K,$,Z,J,ee,te,ne,re,ie,oe,ae,se,ue,ce,le,he,fe,de,pe,ge,ve;return i(this,(function(i){switch(i.label){case 0:for(r="http://www.w3.org/2000/svg",f=o.WebGLStat.MAX_TEXTURE_SIZE/window.devicePixelRatio,p=1.3*t,g=l(f/(d=2*t)),(v=document.createElementNS(r,"svg")).setAttribute("width",f+"px"),v.style.font=e,v.style.position="relative",v.style.left="0px",v.style.top="0px",y=[],m=Math.floor(f/p),b=0,T=0,_=0,E=0;T<n.all.length;){for(N=document.createElementNS(r,"g"),x=N,b=Math.floor(y.length/m),N.setAttribute("transform","translate(0, "+(y.length-b*m)*p+")"),y.push(N),O=f,_=0;_<g&&T<n.all.length;_++)(L=document.createElementNS(r,"text")).setAttribute("x",""+_*d),L.setAttribute("dy","1em"),le=n.all[T],T++,R=le[0],S=le[1],B=document.createElementNS(r,"tspan"),D=document.createElementNS(r,"tspan"),B.setAttribute("fill","#ff0000"),D.setAttribute("fill","#0000ff"),B.textContent=R,D.textContent=S,L.appendChild(B),L.appendChild(D),N.appendChild(L),O-=d;O>=0?((L=document.createElementNS(r,"text")).setAttribute("width",O+"px"),N.appendChild(L),w=L):w=null,E=O}for(A=[],ue=0;ue<n.all.length;ue++)A.push([Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER]);return M=0,I=!1,h?(P="M",(L=document.createElementNS(r,"text")).setAttribute("dy","1em"),L.style.width=""+d,L.style.height=""+p,L.setAttribute("x",""+d*_),L.style.font=e,[4,s.renderGlyph(P,128,128,e)]):[3,2];case 1:(C=i.sent())&&(M=C.size[0],B=document.createElementNS(r,"tspan"),F=document.createElementNS(r,"tspan"),D=document.createElementNS(r,"tspan"),B.setAttribute("fill","#ff0000"),D.setAttribute("fill","#0000ff"),B.textContent=P,D.textContent=P,F.textContent=" ",L.appendChild(B),L.appendChild(F),L.appendChild(D),_<g&&x?(x.appendChild(L),E-=d,w&&(w.remove(),E>0&&(x.style.width=E+"px",x.appendChild(w)))):(N=document.createElement("g"),b=Math.floor(y.length/m),N.setAttribute("transform","translate(0, "+(y.length-b*m)*p+")"),(x=N).appendChild(L),y.push(N),w=document.createElementNS(r,"text"),N.appendChild(w)),A.push([Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER]),I=!0),i.label=2;case 2:U=y.length*p,j=Math.ceil(U/f),G=null,c("Rendering table canvas batches for font kerning analysis",n,y),ue=0,i.label=3;case 3:if(!(ue<j))return[3,8];for(z=y.splice(0,m),k=z.length*p,v.setAttribute("height",k+"px");v.lastElementChild;)v.lastElementChild.remove();for(V=0,W=z.length;V<W;++V)H=z[V],v.appendChild(H);return G?[3,5]:[4,u.svgToData(v)];case 4:return G=i.sent(),[3,7];case 5:return[4,u.svgToData(v)];case 6:if(!(q=i.sent()))return console.warn("Font Renderer: Could not generate image data for analyzing font kerning"),[3,7];(X=new Uint8ClampedArray(G.data.length+q.data.length)).set(G.data),X.set(q.data,G.data.length),G=new ImageData(X,f*window.devicePixelRatio,G.height+q.height),i.label=7;case 7:return++ue,[3,3];case 8:if(c("Analyzing rendered data",G),Q=d*window.devicePixelRatio,Y=p*window.devicePixelRatio,G){for(K=G.data,$=void 0,Z=void 0,J=void 0,ee=void 0,te=void 0,ne=void 0,re=0,ie=G.height;re<ie;re++)for(oe=0,ae=G.width;oe<ae;oe++)Z=K[($=4*(ae*re+oe))+0],J=K[$+1],ee=K[$+2],(ne=l(re/Y)*g+l(oe/Q))<A.length&&(te=A[ne],Z>0&&0===J&&0===ee&&(oe<te[0]&&(te[0]=oe),re<te[1]&&(te[1]=re)),0===Z&&0===J&&ee>0&&(oe<te[2]&&(te[2]=oe),re<te[3]&&(te[3]=re)));for(I&&(se=A.pop())&&(pe=[se[2]-se[0],0],ve=a.scale2(pe,1/window.devicePixelRatio),n.spaceWidth=Math.ceil(ve[0])-M),ue=0,ce=A.length;ue<ce;ue++)le=n.all[ue],he=le[0],fe=le[1],de=A[ue],pe=[de[2]-de[0],de[3]-de[1]],(ge=n.pairs[he])&&(ve=a.scale2(pe,1/window.devicePixelRatio),ge[fe]=[Math.ceil(ve[0]),ve[1]])}else console.warn("html2canvas did not produce a valid canvas context to analyze");return c("Kerning rendering analysis complete",n.pairs),[2]}}))}))}function f(e,t,n){e=e.replace(/\s/g,"");for(var r=n&&n.all||[],i=n&&n.pairs||{},o=0;o<e.length-1;o++){var a=e[o],s=e[o+1],u=i[a];u||(u=i[a]={}),t[a]&&t[a][s]||u[s]||(u[s]=[0,0],r.push(""+a+s))}return{all:r,pairs:i,spaceWidth:0}}var d=function(){function e(){}return e.prototype.makeBitmapGlyphs=function(e,t,n){for(var r={},i=new Set,o=0,a=e.length;o<a;++o)i.add(e[o]);var u=Array.from(i.values());for(o=0,a=u.length;o<a;++o){var c=u[o],l=s.renderGlyph(c,2*n,2*n,t);l?r[c]={glyph:l.data,glyphIndex:o}:console.warn("Unable to render character",c,"to font map for rendering.")}return r},e.prototype.estimateKerning=function(e,t,n,o,a){return r(this,void 0,void 0,(function(){var r,s,u;return i(this,(function(i){switch(i.label){case 0:for(r={all:[],pairs:{},spaceWidth:0},c("Estimating Kerning for",e),s=0,u=e.length;s<u;++s)f(e[s],o,r);return r.all.length>0||a?[4,h(t,n,r,a)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2,r]}}))}))},e}();t.FontRenderer=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=Math.min,o=Math.max,a=document.createElement("canvas");t.renderGlyph=function(e,t,n,s){if(e=e[0],(a.width<t||a.height<n)&&(a.width=t,a.height=n),!r){var u=a.getContext("2d");if(!u)return null;r=u}r.clearRect(0,0,a.width,a.height),r.font=s,r.fillStyle="white",r.fillText(e,t/2,n/2);var c=function(e){for(var t=e.canvas,n=t.width,r=t.height,a=e.getImageData(0,0,n,r).data,s=!1,u=Number.MAX_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER,f=0;f<n;++f)for(var d=0;d<r;++d){a[d*(4*n)+4*f]>0&&(s=!0,u=i(u,d),c=i(c,f),l=o(l,f),h=o(h,d))}return s?(h+=2,l+=2,c-=1,u=o(u-=1,0),{minX:c=o(c,0),minY:u,maxX:l,maxY:h}):null}(r);if(!c)return{data:r.getImageData(0,0,1,1),size:[0,0]};var l=c.maxX-c.minX,h=c.maxY-c.minY;return{data:r.getImageData(c.minX,c.minY,l,h),size:[l,h]}}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(108)),r(n(110)),r(n(174)),r(n(64)),r(n(109)),r(n(32)),r(n(24)),r(n(42)),r(n(49)),r(n(111)),r(n(50))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),s=n(7),u=n(109),c=n(173),l=n(0),h=n(64),f=n(32),d=n(24),p=n(5)("performance"),g=new d.SubTexture({aspectRatio:0,atlasBL:[0,0],atlasBR:[0,0],texture:null,atlasTL:[0,0],atlasTR:[0,0],heightOnAtlas:0,isValid:!1,pixelHeight:0,pixelWidth:0,widthOnAtlas:0});var v=function(){function e(){this.allAtlas=new Map}return e.prototype.createAtlas=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){return t=new h.Atlas(e),this.allAtlas.set(t.id,t),p("Atlas Created-> %o",t),[2,t]}))}))},e.prototype.destroy=function(){this.allAtlas.forEach((function(e){return e.destroy()}))},e.prototype.destroyAtlas=function(e){var t=this.allAtlas.get(e);t&&t.destroy()},e.prototype.setDefaultImage=function(e,t){return e=Object.assign(e,g,{atlasReferenceID:t})},e.prototype.draw=function(e,t){return i(this,void 0,Promise,(function(){var n,i,a,u,l,h,g,v;return o(this,(function(o){switch(o.label){case 0:return n=e.id,t.disposeResource?[2,!0]:(i=e.resourceReferences.get(t.source))?(t.texture=i.subtexture,[2,!0]):(t.texture=new d.SubTexture,t.texture.isValid=!0,e.resourceReferences.set(t.source,{subtexture:t.texture,count:0}),[4,this.loadImage(t)]);case 1:if(a=o.sent(),u=t.texture,a&&((y=u)&&y.isValid&&y.pixelWidth&&y.pixelHeight)){if(l=new s.Bounds({bottom:u.pixelHeight,left:0,right:u.pixelWidth,top:0}),(h={data:u,bounds:l}).bounds.width+=0,h.bounds.height+=0,g=e.packing,!(v=g.insert(h))){if(!this.repackResources(e))return console.error("Repacking the atlas failed. Some resources may be in an undefined state. Consider making another atlas."),[2,!1];g=e.packing,v=g.insert(h)}return v?(v.data=u,f.PackNode.applyToSubTexture(g,v,u,{top:.5,left:.5,right:.5,bottom:.5}),u.texture=e.texture,u.source=a,u.atlasRegion=r(r({},v.bounds),{y:e.height-v.bounds.y-v.bounds.height}),e.texture.update(a,u.atlasRegion),a instanceof HTMLVideoElement&&(u.video={monitor:new c.VideoTextureMonitor(a,u)}),[2,!0]):(console.error("Could not fit resource into atlas",t),t.texture=this.setDefaultImage(u,n),[2,!1])}return u&&!u.isValid?p("Resource was invalidated during load:",t):console.error("Could not load resource:",t),t.texture&&(t.texture=this.setDefaultImage(t.texture,n)),[2,!1]}var y}))}))},e.prototype.getAtlasTexture=function(e){return this.allAtlas.get(e)},e.prototype.loadImage=function(e){return i(this,void 0,Promise,(function(){var t,n,r,i;return o(this,(function(o){switch(o.label){case 0:return t=e.texture||new d.SubTexture,n=e.source,e.texture=t,!1===e.texture.isValid?[2,null]:n instanceof HTMLImageElement?[4,new Promise((function(e){if(n instanceof HTMLImageElement){var r=n;if(r.width&&r.height)return u.ImageRasterizer.calculateImageSize(r),t.pixelWidth=r.width,t.pixelHeight=r.height,t.aspectRatio=r.width/r.height,void e(r);r?(r.onload=function(){t.pixelWidth=r.width,t.pixelHeight=r.height,t.aspectRatio=r.width/r.height,r.onload=null,e(r)},r.onerror=function(){console.error("Error generating Image element for source:",n),r.onload=null,e(null)}):e(null)}}))]:[3,4];case 1:return(i=o.sent())&&void 0!==e.rasterizationScale&&1!==e.rasterizationScale?[4,u.ImageRasterizer.resizeImage(i,e.rasterizationScale||1)]:[3,3];case 2:i=o.sent(),o.label=3;case 3:return[2,i];case 4:return n instanceof HTMLVideoElement?0===n.videoHeight||0===n.videoWidth?(console.warn("Video requests to the atlas manager MUST have the video completely loaded and ready for loading","There are too many caveats to automate video loading at this low of a level to have it prepped properly for","use in the texture for all browsers. Consider handling video resources at the layer level to have them","prepped for use."),[2,null]):(t.pixelWidth=n.videoWidth,t.pixelHeight=n.videoHeight,t.aspectRatio=n.videoWidth/n.videoHeight,[2,n]):[3,5];case 5:return l.isString(n)?(r=n,[4,new Promise((function(e){var i=new Image;i.onload=function(){t.pixelWidth=i.width,t.pixelHeight=i.height,t.aspectRatio=i.width/i.height,i.onload=null,e(i)},i.onerror=function(){console.error("Error generating Image element for source:",n),e(null)},i.src=r}))]):[3,9];case 6:return(i=o.sent())&&void 0!==e.rasterizationScale&&1!==e.rasterizationScale?[4,u.ImageRasterizer.resizeImage(i,e.rasterizationScale||1)]:[3,8];case 7:i=o.sent(),o.label=8;case 8:return[2,i];case 9:return(i=n)&&void 0!==e.rasterizationScale&&1!==e.rasterizationScale?[4,u.ImageRasterizer.resizeImage(i,e.rasterizationScale||1)]:[3,11];case 10:i=o.sent(),o.label=11;case 11:return[2,i]}}))}))},e.prototype.repackResources=function(e){if(!this.renderer)return console.warn("Attempted to repack resources for an atlas, but no renderer has been specified for this manager yet."),!1;for(var t=[e.packing],n=[],r=0,i=new Map;r<t.length;){var o=t[r];r++,o.data&&o.data.texture&&(n.push(o),i.set(o.bounds,new s.Bounds(o.bounds))),o.child[0]&&t.push(o.child[0]),o.child[1]&&t.push(o.child[1])}if(n.sort((function(e,t){return Math.max(t.bounds.width,t.bounds.height)-Math.max(e.bounds.width,e.bounds.height)})),n.length<=0)return e.packing=new f.PackNode(0,0,e.width,e.height),!0;var u=new a.Texture(e.texture);u.data={buffer:new Uint8Array(e.width*e.height*4),width:e.width,height:e.height};for(var c=new f.PackNode(0,0,e.width,e.height),l=!1,h=0,p=n.length;h<p;++h){if((b=n[h]).data){b.bounds.x=0,b.bounds.y=0;var g=c.insert({bounds:b.bounds,data:b.data});g?f.PackNode.applyToSubTexture(c,g,b.data):(console.warn("When repacking the atlas, an existing node was unable to be repacked",b),l=!0)}else console.warn("Attempted to repack a node with no valid data.")}if(l)return!1;var v=new Float32Array(2*n.length*6),y=new Float32Array(2*n.length*6),m=new d.SubTexture;for(h=0,p=n.length;h<p;++h){var b=n[h],T=i.get(b.bounds),_=b.data;if(T&&_){f.PackNode.applyToSubTexture(c,T,m);var x=2*h*6;v[x]=2*_.atlasTL[0]-1,v[x+1]=2*_.atlasTL[1]-1,v[x+2]=2*_.atlasTR[0]-1,v[x+3]=2*_.atlasTR[1]-1,v[x+4]=2*_.atlasBL[0]-1,v[x+5]=2*_.atlasBL[1]-1,v[x+6]=2*_.atlasTR[0]-1,v[x+7]=2*_.atlasTR[1]-1,v[x+8]=2*_.atlasBR[0]-1,v[x+9]=2*_.atlasBR[1]-1,v[x+10]=2*_.atlasBL[0]-1,v[x+11]=2*_.atlasBL[1]-1,y[x]=m.atlasTL[0],y[x+1]=m.atlasTL[1],y[x+2]=m.atlasTR[0],y[x+3]=m.atlasTR[1],y[x+4]=m.atlasBL[0],y[x+5]=m.atlasBL[1],y[x+6]=m.atlasTR[0],y[x+7]=m.atlasTR[1],y[x+8]=m.atlasBR[0],y[x+9]=m.atlasBR[1],y[x+10]=m.atlasBL[0],y[x+11]=m.atlasBL[1],_.texture=u}else console.warn("While repacking there was an issue finding the previous bounds and the next texture to use",T,_)}var w=new a.Geometry,E=new a.Attribute(v,2),O=new a.Attribute(y,2);w.addAttribute("position",E),w.addAttribute("texCoord",O);var R=new a.RenderTarget({buffers:{color:{buffer:u,outputType:0}},retainTextureTargets:!0}),S=new a.Material({culling:a.GLSettings.Material.CullSide.NONE,uniforms:{texture:{type:a.MaterialUniformType.TEXTURE,value:e.texture}},fragmentShader:new Map([[R,{outputNames:[],outputTypes:[0],source:"\n          precision highp float;\n\n          uniform sampler2D texture;\n          varying vec2 _texCoord;\n\n          void main() {\n            gl_FragColor = texture2D(texture, _texCoord);\n          }\n        "}]]),vertexShader:"\n        precision highp float;\n\n        attribute vec2 position;\n        attribute vec2 texCoord;\n        varying vec2 _texCoord;\n\n        void main() {\n          _texCoord = texCoord;\n          gl_Position = vec4(position, 0.0, 1.0);\n        }\n      "}),A=new a.Model(w,S);A.vertexCount=6*n.length,A.drawMode=a.GLSettings.Model.DrawMode.TRIANGLES;var M=new a.Scene;return M.add(A),this.renderer.setRenderTarget(R),this.renderer.setViewport(this.renderer.getFullViewport()),this.renderer.setScissor(this.renderer.getFullViewport()),this.renderer.render(M,R),S.dispose(),w.destroy(),R.dispose(),e.texture.destroy(),e.texture=u,e.packing=c,!0},e.prototype.updateAtlas=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,a,s,u;return o(this,(function(o){switch(o.label){case 0:if(!(n=this.allAtlas.get(e)))return[3,5];r=0,i=t,o.label=1;case 1:return r<i.length?(u=i[r]).disposeResource?[3,3]:[4,this.draw(n,u)]:[3,4];case 2:o.sent(),o.label=3;case 3:return r++,[3,1];case 4:for(a=0,s=t.length;a<s;++a)(u=t[a]).disposeResource?n.stopUsingResource(u):n.useResource(u);return n.resolveResources(),[3,6];case 5:console.warn("Can not update non-existing atlas:",e,"These resources will not be loaded:",t),o.label=6;case 6:return[2,n]}}))}))},e}();t.AtlasManager=v},function(e,t,n){"use strict";var r,i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.awaitContext=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return r?[3,2]:(this.getContext(),[4,new Promise((function(e){return setTimeout(e,10)}))]);case 1:return e.sent(),[3,0];case 2:return[2]}}))}))},e.getContext=function(){r||(r=document.createElement("canvas").getContext("2d"))},e.calculateImageSize=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this.awaitContext()];case 1:return t.sent(),r?0===e.width||0===e.height?(console.warn("Images provided shoud have valid dimensions! Please ensure the image is loaded first."),[2]):(r.canvas.width=100,r.canvas.height=100,r.drawImage(e,0,0,1,1),[2,[e.width,e.height]]):(console.warn("The Image rasterizer was unable to establish a valid canvas context. Please ensure the system supports contexts and ensure the document is ready first."),[2])}}))}))},e.resizeImage=function(t,n){return i(this,void 0,void 0,(function(){var i;return o(this,(function(o){switch(o.label){case 0:return[4,this.awaitContext()];case 1:return o.sent(),r?0===t.width||0===t.height?(console.warn("Images provided shoud have valid dimensions! Please ensure the image is loaded first."),[2,t]):(r.canvas.width=Math.floor(t.width*n),r.canvas.height=Math.floor(t.height*n),t instanceof ImageData?r.putImageData(t,0,0,0,0,r.canvas.width,r.canvas.height):r.drawImage(t,0,0,r.canvas.width,r.canvas.height),(i=new Image).src=r.canvas.toDataURL("image/png"),[4,e.calculateImageSize(i)]):(console.warn("The Image rasterizer was unable to establish a valid canvas context. Please ensure the system supports contexts and ensure the document is ready first."),[2,t]);case 2:return o.sent(),[2,i]}}))}))},e}();t.ImageRasterizer=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),u=n(3),c=n(21),l=n(64),h=n(108),f=n(24),d=n(42),p=function(e){function t(t){var n=e.call(this)||this;return n.resources=new Map,n.requestQueue=new Map,n.requestLookup=new Map,n.atlasManager=t&&t.atlasManager||new h.AtlasManager,n}return i(t,e),Object.defineProperty(t.prototype,"webGLRenderer",{get:function(){return this._webGLRenderer},set:function(e){this._webGLRenderer=e,this.atlasManager.renderer=e},enumerable:!0,configurable:!0}),t.prototype.dequeueRequests=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,i,o,s,c,l;return a(this,(function(h){switch(h.label){case 0:e=!1,t=[],this.requestQueue.forEach((function(e,n){t.push([n,e])})),this.requestQueue.clear(),n=function(t,n){var i,o,s;return a(this,(function(a){switch(a.label){case 0:return n.length>0?(e=!0,i=n.slice(0),n.length=0,[4,r.atlasManager.updateAtlas(t,i)]):[3,2];case 1:a.sent(),(o=r.requestLookup.get(t))&&(s=new Set,i.forEach((function(e){var t=o.get(e);if(o.delete(e),t&&!e.disposeResource)for(var n=0,r=t.length;n<r;++n){var i=t[n],a=i[0],u=i[1];a.managesInstance(u)&&(u.active=!0),s.add(u)}})),u.nextFrame((function(){s.forEach((function(e){e.active=!0,e.resourceTrigger()}))}))),a.label=2;case 2:return[2]}}))},r=this,i=0,o=t,h.label=1;case 1:return i<o.length?(s=o[i],c=s[0],l=s[1],[5,n(c,l)]):[3,4];case 2:h.sent(),h.label=3;case 3:return i++,[3,1];case 4:return[2,e]}}))}))},t.prototype.destroy=function(){this.atlasManager.destroy()},t.prototype.destroyResource=function(e){this.resources.get(e.key)&&(this.atlasManager.destroyAtlas(e.key),this.resources.delete(e.key))},t.prototype.getAtlasTexture=function(e){var t=this.atlasManager.getAtlasTexture(e);return t?t.texture:null},t.prototype.getResource=function(e){return this.resources.get(e)||null},t.prototype.getIOExpansion=function(){return[new d.TextureIOExpansion(s.ResourceType.ATLAS,this)]},t.prototype.initResource=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return l.isAtlasResource(e)?[4,this.atlasManager.createAtlas(e)]:[3,2];case 1:t=n.sent(),this.resources.set(e.key,t),n.label=2;case 2:return[2]}}))}))},t.prototype.request=function(e,t,n,r){var i=n.key||"",o=n.texture;if(o)return f.subTextureIOValue(o);var a=this.requestLookup.get(i);if(a){var s=a.get(n);if(s)return s.push([e,t]),t.active=!1,f.subTextureIOValue(n.texture)}else a=new Map,this.requestLookup.set(i,a);n.disposeResource||(t.active=!1);var u=this.requestQueue.get(i);return u||(u=[],this.requestQueue.set(i,u)),u.push(n),a.set(n,[[e,t]]),f.subTextureIOValue(o)},t.prototype.updateResource=function(e){l.isAtlasResource(e)},t}(c.BaseResourceManager);t.AtlasResourceManager=p},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),u=n(21),c=n(49),l=n(42),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resources=new Map,t}return i(t,e),t.prototype.dequeueRequests=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2,!1]}))}))},t.prototype.destroy=function(){this.resources.forEach((function(e){return e.destroy()})),this.resources.clear()},t.prototype.getIOExpansion=function(){return[new l.TextureIOExpansion(s.ResourceType.TEXTURE,this)]},t.prototype.getResource=function(e){return this.resources.get(e)||null},t.prototype.destroyResource=function(e){var t=this.resources.get(e.key);t&&(t.destroy(),this.resources.delete(e.key))},t.prototype.initResource=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){return(t=this.resources.get(e.key))?(console.warn("Attempted to generate a RenderTexture that already exists for key",e.key),[2]):(t=new c.RenderTexture(e,this.webGLRenderer),this.resources.set(e.key,t),[2])}))}))},t.prototype.request=function(e,t,n,r){var i=this.resources.get(n.key);return i?(n.texture=i.texture,[0,0,1,1]):[0,0,0,0]},t.prototype.resize=function(){var e=this,t=new Map;this.resources.forEach((function(n,r){n.width>s.TextureSize.SCREEN&&n.height>s.TextureSize.SCREEN||(n.texture.destroy(),n=new c.RenderTexture(n,e.webGLRenderer),t.set(r,n))})),t.forEach((function(t,n){return e.resources.set(n,t)}))},t.prototype.updateResource=function(e){this.resources.get(e.key)&&console.warn("UPDATING AN EXISTING RENDER TEXTURE IS NOT SUPPORTED YET")},t}(u.BaseResourceManager);t.RenderTextureResourceManager=h},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(97),u=n(0),c=n(3),l=function(e){function t(){var t=e.call(this,{handleClick:function(e){return o(t,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.enablePicking(),[4,this.willRenderResolver.promise];case 1:return t.sent(),this.enablePicking(),[4,this.didRenderResolver.promise];case 2:return t.sent(),this.handleInteraction(e,(function(t,n){t.interactions.handleMouseClick(n,e)})),[2]}}))}))},handleTap:function(e){return o(t,void 0,void 0,(function(){var t=this;return a(this,(function(n){switch(n.label){case 0:return this.enablePicking(),[4,this.willRenderResolver.promise];case 1:return n.sent(),this.enablePicking(),[4,this.didRenderResolver.promise];case 2:return n.sent(),e.touches.forEach((function(n){t.handleInteraction(n,(function(t,r){t.interactions.handleTap(r,e,n)}))})),[2]}}))}))},handleDrag:function(e){return o(t,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.willRenderResolver.promise];case 1:return t.sent(),this.handleInteraction(e,(function(t,n){t.interactions.handleMouseDrag(n,e)})),[2]}}))}))},handleMouseDown:function(e){return o(t,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.enablePicking(),[4,this.willRenderResolver.promise];case 1:return t.sent(),this.handleInteraction(e,(function(t,n){return t.interactions.handleMouseDown(n,e)})),[2]}}))}))},handleTouchDown:function(e){return o(t,void 0,void 0,(function(){var t=this;return a(this,(function(n){switch(n.label){case 0:return this.enablePicking(),[4,this.willRenderResolver.promise];case 1:return n.sent(),e.touches.forEach((function(n){t.handleInteraction(n,(function(t,r){return t.interactions.handleTouchDown(r,e,n)}))})),[2]}}))}))},handleMouseUp:function(e){return o(t,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.willRenderResolver.promise];case 1:return t.sent(),this.handleInteraction(e,(function(t,n){return t.interactions.handleMouseUp(n,e)})),[2]}}))}))},handleTouchUp:function(e){return o(t,void 0,void 0,(function(){var t=this;return a(this,(function(n){switch(n.label){case 0:return[4,this.willRenderResolver.promise];case 1:return n.sent(),e.touches.forEach((function(n){t.handleInteraction(n,(function(t,r){return t.interactions.handleTouchUp(r,e,n)}))})),[2]}}))}))},handleMouseOut:function(e){return o(t,void 0,void 0,(function(){var t=this;return a(this,(function(n){switch(n.label){case 0:return[4,this.willRenderResolver.promise];case 1:return n.sent(),this.isOver.forEach((function(n){t.handleView(n,(function(t,n){return t.interactions.handleMouseOut(n,e)}))})),this.isOver.clear(),[2]}}))}))},handleTouchOut:function(e){return o(t,void 0,void 0,(function(){var t=this;return a(this,(function(n){switch(n.label){case 0:return[4,this.willRenderResolver.promise];case 1:return n.sent(),e.touches.forEach((function(n){c.mapGetWithDefault(t.isTouchOver,n.touch.touch.identifier,new Set).forEach((function(r){t.handleView(r,(function(t,r){return t.interactions.handleTouchOut(r,e,n)}))})),t.isOver.clear()})),[2]}}))}))},handleMouseMove:function(e){return o(t,void 0,void 0,(function(){var t,n,r=this;return a(this,(function(i){switch(i.label){case 0:return this.enablePicking(),[4,this.willRenderResolver.promise];case 1:return i.sent(),t=this.handleInteraction(e,(function(t,n){return t.interactions.handleMouseMove(n,e)})),n=new Set,t.forEach((function(e){return n.add(e)})),this.isOver.forEach((function(t){n.has(t)||r.handleView(t,(function(t,n){return t.interactions.handleMouseOut(n,e)}))})),n.forEach((function(t){r.isOver.has(t)||r.handleView(t,(function(t,n){return t.interactions.handleMouseOver(n,e)}))})),this.isOver=n,[2]}}))}))},handleTouchDrag:function(e){return o(t,void 0,void 0,(function(){var t=this;return a(this,(function(n){switch(n.label){case 0:return this.enablePicking(),[4,this.willRenderResolver.promise];case 1:return n.sent(),e.touches.forEach((function(n){var r=t.handleInteraction(n,(function(t,r){return t.interactions.handleTouchMove(r,e,n)})),i=new Set;r.forEach((function(e){return i.add(e)}));var o=c.mapInjectDefault(t.isTouchOver,n.touch.touch.identifier,new Set);o.forEach((function(r){i.has(r)||t.handleView(r,(function(t,r){return t.interactions.handleTouchOut(r,e,n)}))})),i.forEach((function(r){o.has(r)||t.handleView(r,(function(t,r){return t.interactions.handleTouchOver(r,e,n)}))})),t.isTouchOver.set(n.touch.touch.identifier,i)})),[2]}}))}))}})||this;return t.isOver=new Set,t.isTouchOver=new Map,t}return i(t,e),Object.defineProperty(t.prototype,"scenes",{get:function(){return this.surface&&this.surface.sceneDiffs?this.surface.sceneDiffs.items:[]},enumerable:!0,configurable:!0}),t.prototype.enablePicking=function(){this.surface&&this.surface.enableOptimizedOutput(u.FragmentOutputType.PICKING)},t.prototype.willRender=function(){for(var e=0,t=this.scenes.length;e<t;++e)for(var n=this.scenes[e],r=0,i=n.layers.length;r<i;++r){delete n.layers[r].interactions.colorPicking}this.willRenderResolver&&this.willRenderResolver.resolve(),this.willRenderResolver=new c.PromiseResolver,this.dequeue()},t.prototype.didRender=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return this.didRenderResolver&&this.didRenderResolver.resolve(),this.didRenderResolver=new c.PromiseResolver,[2]}))}))},t.prototype.getSceneViewsUnderMouse=function(e){for(var t=new Map,n=0,r=this.scenes.length;n<r;++n)for(var i=this.scenes[n],o=0,a=i.views.length;o<a;++o){var s=i.views[o];t.set(s.id,s)}return e.target.views.map((function(e){return t.get(e.view.id)})).filter(c.isDefined)},t.prototype.handleInteraction=function(e,t){for(var n=this.getSceneViewsUnderMouse(e),r=0,i=n.length;r<i;++r){var o=n[r];this.handleView(o,t)}return n},t.prototype.handleView=function(e,t){for(var n=0,r=e.scene.layers.length;n<r;++n){var i=e.scene.layers[n];i.picking&&i.picking.type!==u.PickType.NONE&&t(i,e)}},t}(s.QueuedEventHandler);t.LayerMouseEvents=l},function(e,t){e.exports="vec3 cameraSpace(vec3 world) {\nreturn (world + cameraOffset) * cameraScale2D;\n}\nvec3 cameraSpaceSize(vec3 worldSize) {\nreturn worldSize * cameraScale2D;\n}\nvec4 clipSpace(vec3 world) {\nreturn (viewProjection) * vec4(cameraSpace(world), 1.0);\n}\nvec4 clipSpaceSize(vec3 worldSize) {\nreturn (viewProjection) * vec4(cameraSpaceSize(worldSize), 0.0);\n}"},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(182)),r(n(40)),r(n(41)),r(n(6)),r(n(183)),r(n(184))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.SCREEN_CURVE=1]="SCREEN_CURVE"}(t.EdgeScaleType||(t.EdgeScaleType={})),function(e){e[e.LINE=0]="LINE",e[e.BEZIER=1]="BEZIER",e[e.BEZIER2=2]="BEZIER2"}(t.EdgeType||(t.EdgeType={})),function(e){e[e.ALL=0]="ALL",e[e.PASS_Y=1]="PASS_Y",e[e.PASS_X=2]="PASS_X"}(t.EdgeBroadphase||(t.EdgeBroadphase={}))},function(e,t,n){"use strict";var r,i,o,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var u=n(35),c=n(2),l=n(23),h=n(0),f=n(3),d=n(19),p=n(6),g=n(117),v=n(118),y=((i={})[d.AnchorType.TopLeft]=function(e,t){e.x=0,e.y=0},i[d.AnchorType.TopMiddle]=function(e,t){e.x=t.size[0]/2,e.y=0},i[d.AnchorType.TopRight]=function(e,t){e.x=t.size[0],e.y=0},i[d.AnchorType.MiddleLeft]=function(e,t){e.x=0,e.y=t.size[1]/2},i[d.AnchorType.Middle]=function(e,t){e.x=t.size[0]/2,e.y=t.size[1]/2},i[d.AnchorType.MiddleRight]=function(e,t){e.x=t.size[0],e.y=t.size[1]/2},i[d.AnchorType.BottomLeft]=function(e,t){e.x=0,e.y=t.size[1]},i[d.AnchorType.BottomMiddle]=function(e,t){e.x=t.size[0]/2,e.y=t.size[1]},i[d.AnchorType.BottomRight]=function(e,t){e.x=t.size[0],e.y=t.size[1]},i[d.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},i),m=[[-1,-1],[0,-1],[1,-1],[-1,0],[0,0],[1,0],[-1,1],[0,1],[1,1]].map((function(e){var t=Math.sqrt(c.dot2(e,e));return c.scale2(e,1/-t)})),b=((o={})[d.AnchorType.TopLeft]=function(e){e.paddingDirection=c.scale2(m[0],e.padding)},o[d.AnchorType.TopMiddle]=function(e){e.paddingDirection=c.scale2(m[1],e.padding)},o[d.AnchorType.TopRight]=function(e){e.paddingDirection=c.scale2(m[2],e.padding)},o[d.AnchorType.MiddleLeft]=function(e){e.paddingDirection=c.scale2(m[3],e.padding)},o[d.AnchorType.Middle]=function(e){e.paddingDirection=[0,0]},o[d.AnchorType.MiddleRight]=function(e){e.paddingDirection=c.scale2(m[5],e.padding)},o[d.AnchorType.BottomLeft]=function(e){e.paddingDirection=c.scale2(m[6],e.padding)},o[d.AnchorType.BottomMiddle]=function(e){e.paddingDirection=c.scale2(m[7],e.padding)},o[d.AnchorType.BottomRight]=function(e){e.paddingDirection=c.scale2(m[8],e.padding)},o[d.AnchorType.Custom]=function(e){e.paddingDirection=e.paddingDirection},o);function T(e){if(e)return function(t){e(s(s({},t),{instances:t.instances.map((function(e){return e.parentLabel})).filter(f.isDefined)}))}}var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fullUpdate=!1,t.glyphProvider=new u.InstanceProvider,t.labelToGlyphs=new Map,t.labelToKerningRequest=new Map,t.labelWaitingOnGlyph=new Map,t.truncationWidth=-1,t.handleGlyphReady=function(e){if(e.parentLabel){var n=e.parentLabel,r=t.labelWaitingOnGlyph.get(e.parentLabel);if(r&&r.has(e)&&(r.delete(e),r.size<=0)){var i=n.onReady;i&&i(n)}}else delete e.onReady},t}return a(t,e),t.prototype.childLayers=function(){return[f.createLayer(this.props.customGlyphLayer||v.GlyphLayer,{animate:this.props.animate,data:this.glyphProvider,key:this.id+".glyphs",resourceKey:this.props.resourceKey,scaleMode:this.props.scaleMode||d.ScaleMode.BOUND_MAX,inTextArea:this.props.inTextArea,picking:this.props.picking,onMouseClick:T(this.props.onMouseClick),onMouseUp:T(this.props.onMouseUp),onMouseDown:T(this.props.onMouseDown),onMouseOut:T(this.props.onMouseOut),onMouseOver:T(this.props.onMouseOver),onMouseMove:T(this.props.onMouseMove),onMouseUpOutside:T(this.props.onMouseUpOutside),onTap:T(this.props.onTap),onTouchDown:T(this.props.onTouchDown),onTouchUp:T(this.props.onTouchUp),onTouchUpOutside:T(this.props.onTouchUpOutside),onTouchMove:T(this.props.onTouchMove),onTouchOut:T(this.props.onTouchOut),onTouchOver:T(this.props.onTouchOver),onTouchAllEnd:T(this.props.onTouchAllEnd),onTouchAllOut:T(this.props.onTouchAllOut)})]},t.prototype.draw=function(){var e=this.resolveChanges();if(!(e.length<=0)){if(!this.propertyIds){var t=e[0][0];this.propertyIds=this.getInstanceObservableIds(t,["text","active","anchor","color","origin","fontSize","maxWidth","maxScale","letterSpacing"])}for(var n=this.propertyIds,r=n.text,i=n.active,o=n.anchor,a=n.color,s=n.origin,u=n.fontSize,c=n.maxWidth,l=n.maxScale,f=n.letterSpacing,d=0,p=e.length;d<p;++d){var g=e[d],v=(t=g[0],g[1]),y=g[2];switch(v){case h.InstanceDiffType.CHANGE:if(!this.labelToGlyphs.get(t)){this.insert(t);continue}void 0!==y[r]?(this.invalidateRequest(t),this.layoutGlyphs(t)):void 0!==y[i]&&(t.active?(this.layoutGlyphs(t),this.showGlyphs(t)):this.hideGlyphs(t)),y[o]&&this.updateAnchor(t),void 0!==y[a]&&this.updateGlyphColors(t),void 0!==y[s]&&this.updateGlyphOrigins(t),void 0!==y[l]&&this.updateGlyphMaxScales(t),void 0!==y[u]&&(this.invalidateRequest(t),this.layoutGlyphs(t)),void 0!==y[c]&&(this.invalidateRequest(t),this.layoutGlyphs(t)),void 0!==y[f]&&(this.invalidateRequest(t),this.layoutGlyphs(t));break;case h.InstanceDiffType.INSERT:this.insert(t);break;case h.InstanceDiffType.REMOVE:var m=this.labelToGlyphs.get(t);if(m){for(var b=0,T=m.length;b<T;++b)this.glyphProvider.remove(m[b]);this.labelToGlyphs.delete(t),this.labelToKerningRequest.delete(t),this.labelWaitingOnGlyph.delete(t)}}}}},t.prototype.insert=function(e){e.preload?this.props.data.remove(e):this.labelToGlyphs.get(e)||this.labelToGlyphs.set(e,[]);this.layoutGlyphs(e)},t.prototype.hideGlyphs=function(e){var t=this.labelToGlyphs.get(e);if(t)for(var n=0,r=t.length;n<r;++n)this.glyphProvider.remove(t[n])},t.prototype.initShader=function(){return null},t.prototype.invalidateRequest=function(e){this.labelToKerningRequest.delete(e)},t.prototype.layoutGlyphs=function(e){if(this.updateKerning(e)&&e.active){var t=this.labelToKerningRequest.get(e);if(t&&t.fontMap){var n=t.metrics;if(n&&n.layout){var r=n.layout;this.updateGlyphs(e,r);var i=e.glyphs;e.size=r.size,y[e.anchor.type](e.anchor,e),b[e.anchor.type](e.anchor);for(var o=e.anchor,a=e.anchor.paddingDirection,s=0,u=Math.min(r.positions.length,i.length);s<u;++s){var l=r.positions[s],h=i[s];h.offset=l,h.fontScale=r.fontScale,h.anchor=[o.x||0,o.y||0],h.origin=c.copy2(e.origin),h.padding=a||[0,0],h.maxScale=e.maxScale}}}}},t.prototype.managesInstance=function(e){return Boolean(this.labelToGlyphs.get(e))},t.prototype.showGlyphs=function(e){var t=this.labelToGlyphs.get(e);if(t)for(var n=0,r=t.length;n<r;++n)this.glyphProvider.add(t[n])},t.prototype.updateAnchor=function(e){var t=e.glyphs;if(t){y[e.anchor.type](e.anchor,e),b[e.anchor.type](e.anchor);for(var n=e.anchor,r=e.anchor.paddingDirection,i=0,o=t.length;i<o;++i)t[i].anchor=[n.x||0,n.y||0],t[i].padding=r||[0,0]}},t.prototype.updateGlyphs=function(e,t){var n=this.labelToGlyphs.get(e);n||(n=[],this.labelToGlyphs.set(e,n));var r=this.labelWaitingOnGlyph.get(e);r||(r=new Set,this.labelWaitingOnGlyph.set(e,r));for(var i=0,o=Math.min(n.length,t.glyphs.length);i<o;++i){(u=n[i]).character!==t.glyphs[i]&&(u.character=t.glyphs[i],u.request&&u.request.fontMap&&u.request.fontMap.glyphMap[u.character]||r.add(u))}if(n.length<t.glyphs.length){var a=0;for(i=n.length,o=t.glyphs.length;i<o;++i,++a){var s=t.glyphs[i];(u=new g.GlyphInstance({character:s,color:e.color,origin:e.origin,maxScale:e.maxScale,onReady:this.handleGlyphReady})).parentLabel=e,n.push(u),e.active&&this.glyphProvider.add(u),r.add(u)}}else if(n.length>t.glyphs.length){for(i=t.glyphs.length,o=n.length;i<o;++i){var u=n[i];this.glyphProvider.remove(u)}for(;n.length>t.glyphs.length;)n.pop()}e.glyphs=n},t.prototype.updateGlyphColors=function(e){var t=e.glyphs;if(t)for(var n=0,r=t.length;n<r;++n)t[n].color=c.copy4(e.color)},t.prototype.updateGlyphOrigins=function(e){var t=e.glyphs;if(t)for(var n=e.origin,r=0,i=t.length;r<i;++r)t[r].origin=[n[0],n[1]]},t.prototype.updateGlyphMaxScales=function(e){var t=e.glyphs;if(t)for(var n=e.maxScale,r=0,i=t.length;r<i;++r)t[r].maxScale=n},t.prototype.updateKerning=function(e){var t=this.labelToKerningRequest.get(e),n=e.text;if(t){if(t.kerningPairs&&t.kerningPairs.indexOf(n)>-1)return Boolean(t.fontMap);if(!t.fontMap||t.fontMap.supportsKerning(n.replace(/\s/g,"")))return!0;this.labelToKerningRequest.delete(e),t=void 0}if(!t){var r={fontSize:e.fontSize,text:e.text,letterSpacing:e.letterSpacing};return e.maxWidth>0&&(r.maxWidth=e.maxWidth,r.truncation=this.props.truncation||"..."),t=l.fontRequest({key:this.props.resourceKey||"",character:"",kerningPairs:[n],metrics:r}),e.preload?(e.resourceTrigger=function(){e.onReady&&e.onReady(e)},this.resource.request(this,e,t)):(this.resource.request(this,e,t,{resource:{type:h.ResourceType.FONT,key:this.props.resourceKey||""}}),this.labelToKerningRequest.set(e,t)),!1}return!0},t.prototype.willUpdateProps=function(e){e.data!==this.props.data&&delete this.propertyIds,e.scaleMode!==this.props.scaleMode&&this.rebuildLayer(),e.resourceKey!==this.props.resourceKey&&(this.fullUpdate=!0)},t.defaultProps={key:"",data:new u.InstanceProvider},t}(p.Layer2D);t.LabelLayer=_},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=function(e){function t(t){var n=e.call(this,t)||this;return n.anchor=[0,0],n.character="a",n.color=[1,1,1,1],n.depth=0,n.fontScale=1,n.maxScale=1,n.offset=[0,0],n.origin=[0,0],n.padding=[0,0],n.origin=t.origin||n.origin,n.offset=t.offset||n.offset,n.character=t.character||n.character,n.color=t.color||n.color,n.maxScale=t.maxScale||n.maxScale,n.padding=t.padding||n.padding,n.anchor=t.anchor||n.anchor,n.onReady=t.onReady,n}return i(t,e),t.prototype.clone=function(){var e=new t(this);e.onReady=this.onReady,e.request=this.request},t.prototype.resourceTrigger=function(){this.offset=this.offset,this.origin=this.origin,this.character=this.character,this.color=this.color,this.onReady&&this.onReady(this)},o([a.observable],t.prototype,"anchor",void 0),o([a.observable],t.prototype,"character",void 0),o([a.observable],t.prototype,"color",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"fontScale",void 0),o([a.observable],t.prototype,"maxScale",void 0),o([a.observable],t.prototype,"offset",void 0),o([a.observable],t.prototype,"origin",void 0),o([a.observable],t.prototype,"padding",void 0),t}(a.Instance);t.GlyphInstance=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(23),s=n(0),u=n(3),c=n(19),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.glyphRequests={},t}return i(t,e),t.prototype.initShader=function(){var e,r,i=this,o=this.props.animate||{},u=o.anchor,l=o.color,h=o.offset,f=o.origin,d={0:[0,0],1:[0,0],2:[1,0],3:[0,1],4:[1,1],5:[1,1]},p={name:"texture",resource:{key:function(){return i.props.resourceKey||""},name:"fontMap"},update:function(e){var t=e.character;return e.request&&e.character===e.request.character||(i.glyphRequests[e.character]?e.request=i.glyphRequests[e.character]:(e.request=a.fontRequest({key:i.props.resourceKey||"",character:t}),i.glyphRequests[e.character]=e.request),e.request.fontMap&&e.onReady&&e.onReady(e)),e.request.fetch=a.FontResourceRequestFetch.TEXCOORDS,i.resource.request(i,e,e.request)}},g={name:"glyphSize",parentAttribute:p,resource:{key:function(){return i.props.resourceKey||""},name:"fontMap"},size:s.InstanceAttributeSize.TWO,update:function(e){var t=e.character;return e.request&&e.character===e.request.character||(i.glyphRequests[e.character]?e.request=i.glyphRequests[e.character]:(e.request=a.fontRequest({key:i.props.resourceKey||"",character:t}),i.glyphRequests[e.character]=e.request),e.request.fontMap&&e.onReady&&e.onReady(e)),e.request.fetch=a.FontResourceRequestFetch.IMAGE_SIZE,i.resource.request(i,e,e.request)}};switch(p.childAttributes=[g],this.props.scaleMode||c.ScaleMode.ALWAYS){case c.ScaleMode.BOUND_MAX:e=this.props.inTextArea?n(217):n(218),r=this.props.inTextArea?n(219):n(220);break;case c.ScaleMode.NEVER:e=this.props.inTextArea?n(221):n(222),r=this.props.inTextArea?n(223):n(224);break;case c.ScaleMode.ALWAYS:e=this.props.inTextArea?n(225):n(119),r=this.props.inTextArea?n(226):n(120);break;default:e=n(119),r=n(120)}return{fs:e,instanceAttributes:[{easing:l,name:t.attributeNames.color,size:s.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.depth,size:s.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:"fontScale",size:s.InstanceAttributeSize.ONE,update:function(e){return[e.fontScale]}},{easing:u,name:t.attributeNames.anchor,size:s.InstanceAttributeSize.TWO,update:function(e){return e.anchor}},{easing:f,name:t.attributeNames.origin,size:s.InstanceAttributeSize.TWO,update:function(e){return e.origin}},{easing:h,name:t.attributeNames.offset,size:s.InstanceAttributeSize.TWO,update:function(e){return e.offset}},{name:"padding",size:s.InstanceAttributeSize.TWO,update:function(e){return e.padding}},{name:"maxScale",size:s.InstanceAttributeSize.ONE,update:function(e){return[e.maxScale]}},g,p],uniforms:[],vertexAttributes:[{name:"normals",size:s.VertexAttributeSize.TWO,update:function(e){return d[e]}}],vertexCount:6,vs:r}},t.prototype.draw=function(){e.prototype.draw.call(this)},t.prototype.getMaterialOptions=function(){return Object.assign({},u.CommonMaterialOptions.transparentImageBlending,s.createMaterialOptions({depthTest:!1}))},t.prototype.willUpdateProps=function(e){e.resourceKey!==this.props.resourceKey&&(Object.values(this.glyphRequests).forEach((function(t){delete t.fontMap,t.key=e.resourceKey||""})),this.rebuildLayer())},t.defaultProps={key:"",data:new o.InstanceProvider,resourceKey:"No resource specified"},t.attributeNames={color:"color",depth:"depth",anchor:"anchor",origin:"origin",offset:"offset"},t}(n(6).Layer2D);t.GlyphLayer=l},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\ngl_FragColor = texColor * vertexColor;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 pushOut = normals * glyphSize * fontScale;\nvec3 position = vec3(origin + padding - anchor + offset + pushOut, depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a,s,u=n(20),c=n(65);!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.CENTERED=2]="CENTERED"}(a=t.TextAlignment||(t.TextAlignment={})),function(e){e[e.NONE=0]="NONE",e[e.CHARACTER=1]="CHARACTER",e[e.WORD=2]="WORD"}(s=t.WordWrap||(t.WordWrap={})),function(e){e[e.NEWLINE=0]="NEWLINE"}(t.NewLineCharacterMode||(t.NewLineCharacterMode={}));var l=function(e){function t(t){var n=e.call(this,t)||this;return n.maxHeight=0,n.lineHeight=0,n.wordWrap=s.NONE,n.alignment=a.LEFT,n.labels=[],n.newLabels=[],n.borders=[],n.padding=[0,0,0,0],n.borderWidth=6,n.hasBorder=!0,n.spaceWidth=0,n.color=t.color,n.origin=t.origin,n.oldOrigin=t.origin,n.text=t.text,n.fontSize=t.fontSize||n.fontSize,n.maxWidth=t.maxWidth||n.maxWidth,n.maxHeight=t.maxHeight||n.maxHeight,n.lineHeight=t.lineHeight||n.lineHeight,n.wordWrap=t.wordWrap||n.wordWrap,n.alignment=t.alignment||n.alignment,n.padding=t.padding||n.padding,n.borderWidth=t.borderWidth||n.borderWidth,n.hasBorder=void 0!==t.hasBorder?t.hasBorder:n.hasBorder,n.letterSpacing=t.letterSpacing||n.letterSpacing,n}return i(t,e),o([u.observable],t.prototype,"maxHeight",void 0),o([u.observable],t.prototype,"lineHeight",void 0),o([u.observable],t.prototype,"wordWrap",void 0),o([u.observable],t.prototype,"alignment",void 0),o([u.observable],t.prototype,"padding",void 0),o([u.observable],t.prototype,"borderWidth",void 0),o([u.observable],t.prototype,"hasBorder",void 0),t}(c.LabelInstance);t.TextAreaInstance=l},function(e,t,n){"use strict";var r,i,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),u=n(11),c=n(19),l=((i={})[c.AnchorType.TopLeft]=function(e,t){e.x=-e.padding,e.y=-e.padding},i[c.AnchorType.TopMiddle]=function(e,t){e.x=t.size[0]/2,e.y=-e.padding},i[c.AnchorType.TopRight]=function(e,t){e.x=t.size[0]+e.padding,e.y=-e.padding},i[c.AnchorType.MiddleLeft]=function(e,t){e.x=-e.padding,e.y=t.size[1]/2},i[c.AnchorType.Middle]=function(e,t){e.x=t.size[0]/2,e.y=t.size[1]/2},i[c.AnchorType.MiddleRight]=function(e,t){e.x=t.size[0]+e.padding,e.y=t.size[1]/2},i[c.AnchorType.BottomLeft]=function(e,t){e.x=-e.padding,e.y=t.size[1]+e.padding},i[c.AnchorType.BottomMiddle]=function(e,t){e.x=t.size[0]/2,e.y=t.size[1]+e.padding},i[c.AnchorType.BottomRight]=function(e,t){e.x=t.size[0]+e.padding,e.y=t.size[1]+e.padding},i[c.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},i),h=function(e){function t(t){var n=e.call(this,t)||this;return n.color=[0,0,0,1],n.depth=0,n.maxScale=1,n.scale=1,n.scaling=c.ScaleMode.BOUND_MAX,n.size=[1,1],n.position=[0,0],n._anchor={padding:0,type:c.AnchorType.TopLeft,x:0,y:0},n.depth=t.depth||n.depth,n.color=t.color||n.color,n.scaling=t.scaling||n.scaling,n.position=t.position||n.position,n.size=t.size||n.size,t.anchor&&n.setAnchor(t.anchor),n}return o(t,e),Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},enumerable:!0,configurable:!0}),t.prototype.setAnchor=function(e){var t={padding:e.padding||0,type:e.type,x:e.x||0,y:e.y||0};l[t.type](t,this),this._anchor=t},a([s.observable],t.prototype,"color",void 0),a([s.observable],t.prototype,"depth",void 0),a([s.observable],t.prototype,"maxScale",void 0),a([s.observable],t.prototype,"scale",void 0),a([s.observable],t.prototype,"scaling",void 0),a([s.observable],t.prototype,"size",void 0),a([s.observable],t.prototype,"position",void 0),a([s.observable],t.prototype,"_anchor",void 0),t}(u.Instance);t.RectangleInstance=h},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=n(13),s=n(16),u=n(124);var c=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.projection=new u.Projection3D,r.projection.camera=n.camera,r.projection.pixelRatio=r.pixelRatio,r}return i(t,e),t.prototype.fitViewtoViewport=function(e,t){if(s.isPerspective(this.props.camera)){var n=t.width,r=t.height,i={near:(a=this.props.camera).projectionOptions.near,far:a.projectionOptions.far,width:n,height:r};this.props.preventCameraAdjustment||(a.projectionOptions=Object.assign(a.projectionOptions,i),a.update()),this.projection.pixelRatio=this.pixelRatio,this.projection.viewBounds=t,this.projection.viewBounds.d=this,this.projection.screenBounds=new o.Bounds({height:this.projection.viewBounds.height/this.pixelRatio,width:this.projection.viewBounds.width/this.pixelRatio,x:this.projection.viewBounds.x/this.pixelRatio,y:this.projection.viewBounds.y/this.pixelRatio}),this.projection.screenBounds.d=this}else if(this.props.camera.projectionType===s.CameraProjectionType.ORTHOGRAPHIC){var a;n=t.width,r=t.height,i={near:(a=this.props.camera).projectionOptions.near,far:a.projectionOptions.far,left:-n/2,right:n/2,top:r/2,bottom:-r/2};this.props.preventCameraAdjustment||(a.projectionOptions=Object.assign(a.projectionOptions,i),a.update()),this.projection.pixelRatio=this.pixelRatio,this.projection.viewBounds=t,this.projection.viewBounds.d=this,this.projection.screenBounds=new o.Bounds({height:this.projection.viewBounds.height/this.pixelRatio,width:this.projection.viewBounds.width/this.pixelRatio,x:this.projection.viewBounds.x/this.pixelRatio,y:this.projection.viewBounds.y/this.pixelRatio}),this.projection.screenBounds.d=this}},t.prototype.willUpdateProps=function(e){this.projection.camera=e.camera},t.defaultProps={key:"",camera:new s.Camera({type:s.CameraProjectionType.PERSPECTIVE,width:100,height:100,fov:Math.PI/2,far:1e5,near:1}),viewport:{left:0,right:0,bottom:0,top:0}},t}(a.View);t.View3D=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(47),s=n(2),u=n(16),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.screenToWorld=function(e,t){return t=t||[0,0,0],this.viewToWorld(this.screenToView(e),t),t},t.prototype.screenRay=function(e){if(this.camera.projectionType===u.CameraProjectionType.ORTHOGRAPHIC){var t=s.vec3(this.screenToWorld(e));return o.ray(t,this.camera.transform.forward)}t=s.vec3(this.screenToWorld(e));return o.rayFromPoints(s.vec3(this.camera.transform.position),t)},t.prototype.worldToScreen=function(e,t){t=t||[0,0];var n=o.multiply4x4(this.camera.projection,this.camera.view),r=o.project3As4ToScreen(n,e,this.viewBounds.width,this.viewBounds.height);return s.apply2(t,r[0]/this.pixelRatio,r[1]/this.pixelRatio)},t.prototype.viewToWorld=function(e,t){t=t||[0,0,0];var n=this.viewBounds,r=n.width,i=n.height,a=this.camera.projectionOptions,c=s.scale2(e,this.pixelRatio),l=Math.tan;if(a.type===u.CameraProjectionType.PERSPECTIVE){var h=a.fov,f=a.near,d=i/r,p=l(h/2)*f,g=[((c[0]+.5)/r*2-1)*p,(1-(c[1]+.5)/i*2)*p*d,-1],v=o.transform4(this.camera.transform.matrix,s.vec4(g,1));s.apply3(t,v[0],v[1],v[2])}else{var y=s.subtract2(c,[r/2,i/2]);v=o.transform4(this.camera.transform.viewMatrix,s.vec4(y,-a.near));s.apply3(t,v[0],-v[1],v[2])}return t},t.prototype.worldToView=function(e,t){t=t||[0,0];var n=o.multiply4x4(this.camera.projection,this.camera.view),r=o.project3As4ToScreen(n,e,this.viewBounds.width,this.viewBounds.height);return s.apply2(t,r[0]/this.pixelRatio,r[1]/this.pixelRatio)},t}(a.BaseProjection);t.Projection3D=c},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(285),r(n(53)),r(n(51)),r(n(126)),r(n(54)),r(n(127)),r(n(286))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.baseShaderModules=function(t){var n=e.prototype.baseShaderModules.call(this,t);return n.vs.push("parent-transform"),n},t}(n(13).Layer);t.SceneGraphLayer=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(51),u=function(e){function t(n){var r=e.call(this,n)||this;r.needsLocalUpdate=!1,r.needsWorldUpdate=!1;var i=n.transform||new s.Transform;return r.transform=i,n.parent&&(n.parent instanceof t?r.parent=n.parent:r.transform.parent=n.parent),r}return i(t,e),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},set:function(e){this._transform||(this._position=e.position,this._rotation=e.rotation,this._scale=e.scale,this._localPosition=e.localPosition,this._localRotation=e.localRotation,this._localScale=e.localScale,this._matrix=e.matrix,this._localMatrix=e.localMatrix),e.instance=this,this._transform=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"matrix",{get:function(){return this._transform.update(),this._matrix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localMatrix",{get:function(){return this._transform.update(),this._localMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localPosition",{get:function(){return this.needsLocalUpdate=!0,this._localPosition},set:function(e){this.transform.localPosition=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localRotation",{get:function(){return this.needsLocalUpdate=!0,this._localRotation},set:function(e){this.transform.localRotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localScale",{get:function(){return this.needsLocalUpdate=!0,this._localScale},set:function(e){this.transform.localScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.needsWorldUpdate=!0,this.transform.update(),this._position},set:function(e){this.transform.position=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.needsWorldUpdate=!0,this.transform.update(),this._rotation},set:function(e){this.transform.rotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.needsWorldUpdate=!0,this.transform.update(),this._scale},set:function(e){this.transform.scale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{set:function(e){this.transform.parent=e.transform},enumerable:!0,configurable:!0}),t.prototype.optimize=function(){this.needsWorldUpdate=!1,this.needsLocalUpdate=!1,this.transform.optimize()},o([a.observable],t.prototype,"_matrix",void 0),o([a.observable],t.prototype,"_localMatrix",void 0),o([a.observable],t.prototype,"_localPosition",void 0),o([a.observable],t.prototype,"_localRotation",void 0),o([a.observable],t.prototype,"_localScale",void 0),o([a.observable],t.prototype,"_position",void 0),o([a.observable],t.prototype,"_rotation",void 0),o([a.observable],t.prototype,"_scale",void 0),t}(a.Instance);t.Instance3D=u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.screenToWorld=function(e,t){var n=this.screenToView(e),r=t||[0,0];return r[0]=n[0],r[1]=n[1],r},t.prototype.screenRay=function(e){var t=this.screenToWorld(e);return[[t[0],t[1],0],[t[0],t[1],-1]]},t.prototype.worldToScreen=function(e,t){var n=[0,0];return n[0]=e[0],n[1]=e[1],this.viewToScreen(n,t)},t.prototype.viewToWorld=function(e,t){var n=t||[0,0],r=e;return n[0]=r[0],n[1]=r[1],n},t.prototype.worldToView=function(e,t){var n=t||[0,0];return n[0]=e[0],n[1]=e[1],n},t}(n(12).BaseProjection);t.ProjectionScreen=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(25);t.gaussHorizontalBlur=function(e){var t=e.output,o=e.input;return i.postProcess({printShader:e.printShader,view:t?{output:{buffers:t,depth:!1}}:void 0,buffers:{color:o},shader:n(306),uniforms:[{name:"weight",size:r.UniformSize.FLOAT_ARRAY,update:function(){return[.299478,.22598,.097046,.023687,.003279,257e-6,11e-6]}}]})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(25);t.gaussVerticalBlur=function(e){var t=e.output,o=e.input;return i.postProcess({printShader:e.printShader,view:t?{output:{buffers:t,depth:!1}}:void 0,buffers:{color:o},shader:n(307),uniforms:[{name:"weight",size:r.UniformSize.FLOAT_ARRAY,update:function(){return[.299478,.22598,.097046,.023687,.003279,257e-6,11e-6]}}]})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=n(0),o=n(25),a=n(66);t.bloom=function(e){for(var t,s=e.compose,u=e.output,c=e.resources,l={blending:{blendDst:r.GLSettings.Material.BlendingDstFactor.One,blendSrc:r.GLSettings.Material.BlendingSrcFactor.One,blendEquation:r.GLSettings.Material.BlendingEquations.Add}},h={},f=0,d=e.samples;f<d;++f){var p=a.boxSample({printShader:e.printShader,input:c[f],output:c[f+1],direction:a.BoxSampleDirection.DOWN,material:{blending:void 0}});h["downSample"+f]=p}for(f=e.samples-1;f>0;--f){p=a.boxSample({printShader:e.printShader,input:c[f+1],output:c[f],direction:a.BoxSampleDirection.UP,material:l});h["upSample"+f]=p}return s&&(h.compose=o.postProcess({printShader:e.printShader,buffers:{color:s,glow:c[1]},material:{blending:null},view:u?{output:{buffers:(t={},t[i.FragmentOutputType.COLOR]=u,t),depth:!1}}:void 0,shader:n(309)})),h}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25),i=n(5)("performance");t.draw=function(e){var t=e.output,n=e.input,o=e.channel,a=e.grayScale;return n.textureSettings&&!n.textureSettings.generateMipMaps||i("POSSIBLE ERROR: for the draw post effect,","it is a common mistale to leave mipmaps enabled on the input texture.","Often the mipmaps are not available in the target resource and thus","you will get a blank output when rendering in certain scenarios."),r.postProcess({printShader:e.printShader,view:Object.assign(t?{output:{buffers:t,depth:!1}}:{},e.view),buffers:{color:n},shader:a&&o?"\n      varying vec2 texCoord;\n\n      void main() {\n        gl_FragColor = vec4(texture2D(color, texCoord)."+o+o+o+", 1.);\n      }\n    ":o?"\n      varying vec2 texCoord;\n\n      void main() {\n        gl_FragColor = vec4(texture2D(color, texCoord)."+o+", 0., 0., 1.);\n      }\n    ":"\n      varying vec2 texCoord;\n\n      void main() {\n        gl_FragColor = texture2D(color, texCoord);\n      }\n    ",material:e.material})}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(134),r(n(135)),r(n(22)),r(n(241)),r(n(1)),r(n(13)),r(n(0)),r(n(3)),r(n(33)),r(n(23)),r(n(4)),r(n(293)),r(n(298)),r(n(12)),r(n(300))},function(e,t){window.WebGL2RenderingContext=window.WebGL2RenderingContext||function(){}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(34)),r(n(43)),r(n(136)),r(n(67)),r(n(97))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=-1]="NONE",e[e.LEFT=0]="LEFT",e[e.AUX=1]="AUX",e[e.RIGHT=2]="RIGHT",e[e.FOURTH=3]="FOURTH",e[e.FIFTH=4]="FIFTH"}(t.MouseButton||(t.MouseButton={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1),this._isInstanced=!1,this._fullUpdate=!1,this.normalize=!1,this._updateRange={count:-1,offset:-1},this.data=e,this.size=t,this._isDynamic=n,this._isInstanced=r}return Object.defineProperty(e.prototype,"isDynamic",{get:function(){return this._isDynamic},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isInstanced",{get:function(){return this._isInstanced},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullUpdate",{get:function(){return this._fullUpdate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsUpdate",{get:function(){return this._needsUpdate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updateRange",{get:function(){return this._updateRange},set:function(e){this._updateRange=e,this._needsUpdate=!0},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.gl&&this.gl.proxy.disposeAttribute(this)},e.prototype.resolve=function(){this._needsUpdate=!1,this._fullUpdate=!1},e.prototype.setDynamic=function(e){this._isDynamic=e,this._needsUpdate=!0,this._fullUpdate=!0},e}();t.Attribute=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._attributes={},this.maxInstancedCount=0,this.isInstanced=!1}return Object.defineProperty(e.prototype,"attributes",{get:function(){return new Map(Object.entries(this._attributes))},enumerable:!0,configurable:!0}),e.prototype.addAttribute=function(e,t){var n,r=this;this._attributes[e]=t,this.isInstanced=!1,Object.values(this._attributes).forEach((function(e){var t=e.isInstanced?1:0;void 0===n&&(n=t),1==(n^t)&&(r.isInstanced=!0)}))},e.prototype.removeAttribute=function(e){delete this._attributes[e]},e.prototype.destroy=function(){this.attributes.forEach((function(e){return e.destroy()})),this.gl&&this.gl.proxy.disposeGeometry(this)},e}();t.Geometry=r},function(e,t,n){function r(e){var n;function r(){if(r.enabled){var e=r,i=+new Date,o=i-(n||i);e.diff=o,e.prev=n,e.curr=i,n=i;for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var u=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;u++;var i=t.formatters[r];if("function"==typeof i){var o=a[u];n=i.call(e,o),a.splice(u,1),u--}return n})),t.formatArgs.call(e,a);var c=r.log||t.log||console.log.bind(console);c.apply(e,a)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=i,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(140),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){var n=1e3,r=6e4,i=60*r,o=24*i;function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var s,u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*r;case"seconds":case"second":case"secs":case"sec":case"s":return a*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(e);if("number"===u&&!1===isNaN(e))return t.long?a(s=e,o,"day")||a(s,i,"hour")||a(s,r,"minute")||a(s,n,"second")||s+" ms":function(e){if(e>=o)return Math.round(e/o)+"d";if(e>=i)return Math.round(e/i)+"h";if(e>=r)return Math.round(e/r)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=function(){function e(e){this.blending={blendDst:r.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:r.GLSettings.Material.BlendingEquations.Add,blendSrc:r.GLSettings.Material.BlendingSrcFactor.SrcAlpha},this.colorWrite=[!0,!0,!0,!0],this.culling=r.GLSettings.Material.CullSide.CCW,this.depthFunc=r.GLSettings.Material.DepthFunctions.LESS_OR_EQUAL,this.depthTest=!0,this.depthWrite=!0,this.dithering=!0,this.name="",this.uniforms={},this.vertexShader="",Object.assign(this,e),delete this.gl}return e.prototype.clone=function(){var t=new e(this);t.blending=Object.assign({},this.blending),t.polygonOffset=Object.assign({},this.polygonOffset),t.uniforms=Object.assign({},this.uniforms);var n=function(e){var n=t.uniforms[e];if(n.gl){var r=new Map;n.gl.forEach((function(e,t){r.set(t,Object.assign({},e))}))}};for(var r in t.uniforms)n(r);return t},e.prototype.dispose=function(){this.gl&&this.gl.proxy.disposeMaterial(this)},e}();t.Material=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=function(e,t){this.drawMode=r.GLSettings.Model.DrawMode.TRIANGLES,this.vertexDrawRange=[-1,-1],this.drawInstances=-1,this.vertexCount=0,this.geometry=e,this.material=t};t.Model=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.resourceTrigger=function(){},t}(n(11).Instance);t.BasicInstance=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),u=n(21),c=n(76),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resources=new Map,t}return i(t,e),t.prototype.dequeueRequests=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2,!1]}))}))},t.prototype.destroy=function(){this.resources.forEach((function(e){return e.destroy()})),this.resources.clear()},t.prototype.getIOExpansion=function(){return[]},t.prototype.getResource=function(e){return this.resources.get(e)||null},t.prototype.destroyResource=function(e){var t=this.resources.get(e.key);t&&(t.destroy(),this.resources.delete(e.key))},t.prototype.initResource=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){return(t=this.resources.get(e.key))?(console.warn("Attempted to generate a RenderTexture that already exists for key",e.key),[2]):(t=new c.ColorBufferResource(e,this.webGLRenderer),this.resources.set(e.key,t),[2])}))}))},t.prototype.request=function(e,t,n,r){var i=this.resources.get(n.key);return i?(n.colorBuffer=i.colorBuffer,[0,0,1,1]):[0,0,0,0]},t.prototype.resize=function(){var e=this,t=new Map;this.resources.forEach((function(n,r){n.width>s.TextureSize.SCREEN&&n.height>s.TextureSize.SCREEN||(n.colorBuffer.destroy(),n=new c.ColorBufferResource(n,e.webGLRenderer),t.set(r,n))})),t.forEach((function(t,n){return e.resources.set(n,t)}))},t.prototype.updateResource=function(e){this.resources.get(e.key)&&console.warn("UPDATING AN EXISTING COLOR BUFFER IS NOT SUPPORTED YET")},t}(u.BaseResourceManager);t.ColorBufferResourceManager=l},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.colorBufferRequest=function(e){return r({type:i.ResourceType.COLOR_BUFFER},e)}},function(e,t,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r};Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),o=n(0),a=n(80),s=n(38),u=n(147),c=n(81),l=n(148),h=n(83),f=function(){function e(){this.metricsProcessing=new l.MetricsProcessing}return e.mergeFragmentOutputsForMRT=function(e,t,n,r,u,c){var l="",h="",f="",d=new Set,p=[],g=new Set;return i.WebGLStat.MRT||(f=" = gl_FragColor"),n.forEach((function(e,v){var y=!0,m=!1;if(u&&u.indexOf(e.outputType)<0&&(y=!1),c&&v<n.length-1&&(y=!1),!c&&r.indexOf(e.outputType)<0&&(y=!1),g.has(e.outputType))throw new Error("Can not use the same Output Fragment type multiple times");g.add(e.outputType);var b=r.indexOf(e.outputType);s.shaderTemplate({shader:a.removeComments(e.source),onToken:function(n){var r=n.trim();if(0===r.indexOf("out")){if(m)throw console.error("Found multiple ${out} tokens in a single fragment shader. This is not supported nor logical","If you need to use the declared output multiple times, use the assigned name","and don't wrap it repeatedly in the shader.","eg-","void main() {","  ${out: myOutput} = value;","  vec4 somethingElse = myOutput;","}"),new Error("Invalid Shader Format");m=!0;var o=r.substr("out".length).trim();if(":"===o[0]){var a=o.substr(":".length).trim();if(!a)throw new Error("Output in a shader requires an identifier ${out: <name required>}");if(d.has(a))throw new Error("You can not declare the same output name in subsequent fragment shader outputs");if("gl_FragColor"===a)throw new Error("DO not use gl_FragColor as an identifier for an out. Choose something not used by the WebGL spec.");var s="";if(y)if(d.add(a),p.push(e.outputType),i.WebGLStat.MRT_EXTENSION)f=" = gl_FragData["+b+"]",s="vec4 ";else{if(!i.WebGLStat.MRT||!i.WebGLStat.SHADERS_3_0)throw new Error("Could not generate a proper output declaration for the fragment shader output: "+a);t.set(a,"layout(location = "+b+") out vec4 "+a+";\n")}else s="vec4 ";return""+s+a+f}throw new Error("Output in a shader requires an identifier ${out: <name required>}")}return"${"+n+"}"},onMain:function(n,r){!m&&n&&(n.match("gl_FragColor")?(p.push(e.outputType),i.WebGLStat.MRT&&(i.WebGLStat.SHADERS_3_0?(t.set("_FragColor","layout(location = "+b+") out vec4 _FragColor;\n"),n=n.replace(/gl_FragColor/g,"_FragColor")):n=(n=(n=n.replace(/gl_FragColor\s+=/,"vec4 _FragColor = gl_FragData["+b+"] =")).replace(/gl_FragColor\s+=/g,"_FragColor = gl_FragData["+b+"] =")).replace(/gl_FragColor/g,"_FragColor")),d.add("_FragColor")):p.push(o.FragmentOutputType.NONE));return l+="\n"+(r||"").trim(),h+="\n  "+(n||"").trim(),(n||"").trim()}})})),{output:l+"\nvoid main() {\n"+h+"\n}",outputNames:Array.from(d.values()),outputTypes:p}},e.mergeOutputFragmentShaderForColor=function(e,t){if(t.length>1||t[0]!==o.FragmentOutputType.COLOR)throw new Error("Merging fragment shaders for only COLOR output is only valid when the view has a single COLOR output target.");o.isString(e)&&(e=[{outputType:o.FragmentOutputType.COLOR,source:e}]);var n="",r="",i=new Set,u=[];return e.some((function(e){var t=e.outputType===o.FragmentOutputType.COLOR,c=!1;return t&&u.push(o.FragmentOutputType.COLOR),s.shaderTemplate({shader:a.removeComments(e.source),onToken:function(e){var n=e.trim();if(0===n.indexOf("out")){if(c)throw console.error("Found multiple ${out} tokens in a single fragment shader. This is not supported nor logical","If you need to use the declared output multiple times, use the assigned name","and don't wrap it repeatedly in the shader.","eg-","void main() {","  ${out: myOutput} = value;","  vec4 somethingElse = myOutput;","}"),new Error("Invalid Shader Format");c=!0;var r=n.substr("out".length).trim();if(":"===r[0]){var o=r.substr(":".length).trim();if(!o)throw new Error("Output in a shader requires an identifier ${out: <name required>}");if(i.has(o))throw new Error("You can not declare the same output name in subsequent fragment shader outputs");if("gl_FragColor"===o)throw new Error("DO not use gl_FragColor as an identifier for an out. Choose something not used by the WebGL spec.");return t?(i.add("gl_FragColor"),"gl_FragColor"!==o?"vec4 "+o+" = gl_FragColor":"gl_FragColor"):"vec4 "+o}}return"${"+e+"}"},onMain:function(e,t){return r+="\n"+(t||"").trim(),n+="\n  "+(e||"").trim(),(e||"").trim()}}),!!t})),{output:r+"\nvoid main() {\n"+n+"\n}",outputNames:Array.from(i.values()),outputTypes:u}},e.makeOutputFragmentShader=function(e,t,n,r){if(!n||o.isString(n)){if(o.isString(r))return{source:(g=this.mergeOutputFragmentShaderForColor([{source:r,outputType:o.FragmentOutputType.COLOR}],[o.FragmentOutputType.COLOR])).output,outputTypes:[o.FragmentOutputType.COLOR],outputNames:g.outputNames};if(Array.isArray(r)){var a=r.find((function(e){return e.outputType===o.FragmentOutputType.COLOR})),s=-1;return s=a?r.indexOf(a):r.length-1,{source:(g=this.mergeOutputFragmentShaderForColor(r.slice(0,s+1),[o.FragmentOutputType.COLOR])).output,outputNames:g.outputNames,outputTypes:[o.FragmentOutputType.COLOR]}}return null}if(Array.isArray(n)){if(!i.WebGLStat.MRT)throw new Error("Multiple Render Targets were specified, but are not natively supported by user's hardware! MRT also does not have a fallback in deltav yet!");var u=n.map((function(e){return e.outputType}));if(Array.isArray(r)){for(var c=new Map,l=0,h=n.length;l<h;++l)for(var f=n[l],d=0,p=r.length;d<p;++d){if(r[d].outputType===f.outputType){c.set(f.outputType,d);break}}if(i.WebGLStat.MRT){var g,v=-1,y=[];return c.forEach((function(e,t){y.push(t),v=Math.max(e,v)})),-1===v?null:{source:(g=this.mergeFragmentOutputsForMRT(e,t,r.slice(0,v+1),u,y)).output,outputNames:g.outputNames,outputTypes:g.outputTypes}}throw new Error("Fragment shader generation not supported for MRT systems on non MRT hardware...yet")}if(n.find((function(e){return e.outputType===o.FragmentOutputType.COLOR}))&&r)return{source:(g=this.mergeFragmentOutputsForMRT(e,t,[{source:r,outputType:o.FragmentOutputType.COLOR}],u)).output,outputNames:g.outputNames,outputTypes:g.outputTypes}}return null},e.prototype.process=function(e,t,n,r,i,a,l){var h,f=this;try{var d=this.processImports(e,t,n);if(!d)return null;var p=c.injectShaderIO(e.surface.gl,e,t,i,l,d),g=p.vertexAttributes,v=p.instanceAttributes,y=p.uniforms;e.getLayerBufferType(e.surface.gl,g,v),this.metricsProcessing.process(v,y);for(var m="",b="",T="",_={uniforms:[]},x=r.vs||new Map,w=r.fs||new Map,E=r.destructure||new Map,O=0,R=i.length;O<R;++O){var S=i[O],A=S.processHeaderInjection(o.ShaderInjectionTarget.VERTEX,x,e,this.metricsProcessing,g,v,y);m+=A.injection,A.material&&(_.uniforms=_.uniforms.concat(A.material.uniforms||[])),T+=S.processAttributeDestructuring(e,E,this.metricsProcessing,g,v,y)}var M="";x.forEach((function(e){M+=e})),m=M+m,M="",E.forEach((function(e){M+=e})),T=M+T;var I=this.processExtensions(),P=I+"precision highp float;\n\n"+m+d.vs,L=((h={})[u.templateVars.attributes]=T,h),C=!1,B=s.shaderTemplate({options:L,required:void 0,shader:P,onToken:function(e,t){return e===u.templateVars.attributes&&(C=!0),t},onMain:function(e){return C?e||"":null===e?(console.warn("The body of void main() could not be determined."),""):T+"\n"+e}});return d.fs.forEach((function(t,n){L={},b="",M="";for(var r=w.get(n)||new Map,u=function(t,n){var a=i[t].processHeaderInjection(o.ShaderInjectionTarget.FRAGMENT,r,e,f.metricsProcessing,g,v,y);if(b+=a.injection,a.material){var s=new Set;_.uniforms.forEach((function(e){return s.add(e.name)})),_.uniforms.forEach((function(e){s.has(e.name)||_.uniforms.push(e)}))}},c=0,l=i.length;c<l;++c)u(c);r.forEach((function(e){M+=e}));var h=I+"precision highp float;\n\n"+(b=M+b)+t.source,d=s.shaderTemplate({options:L,required:void 0,shader:h});t.source=d.shader.trim();for(c=0,l=a.length;c<l;++c){var p=a[c];B.shader=p.vertex(B.shader),t.source=p.fragment(t.source)}})),{fs:d.fs,materialUniforms:_.uniforms,maxInstancesPerBuffer:this.metricsProcessing.maxInstancesPerUniformBuffer,modules:Array.from(d.shaderModuleUnits),vs:B.shader.trim(),vertexAttributes:g,instanceAttributes:v,uniforms:y}}catch(t){return console.warn("An unknown error occurred while processing the shaders for layer:",e.id),console.warn("Error:"),console.warn(t&&(t.stack||t.message)),null}},e.prototype.processExtensions=function(){var e="";return i.WebGLStat.SHADERS_3_0&&(e+="#version 300 es"),i.WebGLStat.MRT_EXTENSION&&(e+="#extension GL_EXT_draw_buffers : require"),e&&(e+="\n\n"),e},e.prototype.processImports=function(e,t,n){var i=new Set,a=e.baseShaderModules(t);e.props.baseShaderModules&&(a=e.props.baseShaderModules(t,a));var s=h.ShaderModule.process(e.id,t.vs,o.ShaderInjectionTarget.VERTEX,a.vs);if(s.errors.length>0)return console.warn.apply(console,r(["Error processing imports for the vertex shader of layer:",e.id,"Errors"],s.errors.reverse())),null;var u=new Map;return n.forEach((function(t,n){var s=h.ShaderModule.process(e.id,t.source,o.ShaderInjectionTarget.FRAGMENT,a.fs);if(s.errors.length>0)console.warn.apply(console,r(["Error processing imports for the fragment shader of layer:",e.id,"Errors"],s.errors.reverse()));else{s.shaderModuleUnits.forEach((function(e){return i.add(e)}));var c={source:s.shader||"",outputTypes:t.outputTypes,outputNames:t.outputNames};u.set(n,c)}})),s.shaderModuleUnits.forEach((function(e){return i.add(e)})),{fs:u,vs:s.shader||"",shaderModuleUnits:i}},e}();t.ShaderProcessor=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.templateVars={attributes:"attributes",easingMethod:"easingMethod",extend:"extend",extendHeader:"extendHeader",T:"T"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(14),i=function(){function e(){}return e.calculateUniformBlockUseage=function(e){for(var t=0,n=0,r=e.length;n<r;++n)t+=Math.ceil(e[n].size/4);return t},e.prototype.process=function(t,n){var i=this;this.instanceMaxBlock=0,t.forEach((function(e){i.instanceMaxBlock=Math.max(i.instanceMaxBlock,e.block||0)})),this.blocksPerInstance=this.instanceMaxBlock+1,this.maxUniforms=r.WebGLStat.MAX_VERTEX_UNIFORMS,this.maxUniformsForInstancing=this.maxUniforms-e.calculateUniformBlockUseage(n),this.maxInstancesPerUniformBuffer=Math.floor(this.maxUniformsForInstancing/this.blocksPerInstance),this.totalInstanceUniformBlocks=this.maxInstancesPerUniformBuffer*this.blocksPerInstance},e}();t.MetricsProcessing=i},function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(0),s=((r={})[a.UniformSize.ONE]=o.MaterialUniformType.FLOAT,r[a.UniformSize.TWO]=o.MaterialUniformType.VEC2,r[a.UniformSize.THREE]=o.MaterialUniformType.VEC3,r[a.UniformSize.FOUR]=o.MaterialUniformType.VEC4,r[a.UniformSize.MATRIX3]=o.MaterialUniformType.MATRIX3x3,r[a.UniformSize.MATRIX4]=o.MaterialUniformType.MATRIX4x4,r[a.UniformSize.FLOAT_ARRAY]=o.MaterialUniformType.FLOAT_ARRAY,r[a.UniformSize.TEXTURE]=o.MaterialUniformType.TEXTURE,r),u=((i={})[a.UniformSize.ONE]=[0],i[a.UniformSize.TWO]=[0,0],i[a.UniformSize.THREE]=[0,0,0],i[a.UniformSize.FOUR]=[0,0,0,0],i[a.UniformSize.MATRIX3]=[0,0,0,0,0,0,0,0,0],i[a.UniformSize.MATRIX4]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i);function c(e){return{type:s[e.size],value:u[e.size]}}t.generateLayerMaterial=function(e,t,n,r,i){var a=e.getMaterialOptions(),s=new Map;n.forEach((function(e,t){s.set(t.renderTarget||null,e)})),Object.assign(a,e.props.materialOptions||{}),a.vertexShader=t,a.fragmentShader=s,a.name=e.id,a.uniforms={};for(var u=0,l=r.length;u<l;++u){var h=r[u],f=c(h);a.uniforms[h.name]=f}for(u=0,l=i.length;u<l;++u){var d=i[u];a.uniforms[d.name]={type:d.type,value:d.value}}return new o.Material(a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=n(0);t.generateLayerGeometry=function(e,t,n,o){var a=[];e.bufferType!==i.LayerBufferType.INSTANCE_ATTRIBUTE&&e.bufferType!==i.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING||(t=1);for(var s=0,u=n.length;s<u;++s){var c=n[s];a.push(new Float32Array(c.size*o*t))}var l,h,f,d,p=n.length,g=!1;for(s=0,u=o;s<u;++s)for(var v=0;v<p;++v)if(h=n[v],l=a[v],f=h.update(s),d=f,Array.isArray(d[0]))g=!0;else for(var y=s*h.size,m=y+h.size,b=0;y<m;++y,++b)l[y]=f[b];for(g&&console.warn("A vertex buffer updating method should not use arrays of arrays of numbers."),s=0,u=n.length;s<u;++s)for(var T=n[s].size*o,_=(v=1,t);v<_;++v)a[s].copyWithin(T*v,0,T);if(e.bufferType===i.LayerBufferType.UNIFORM){var x=a[0];for(s=0,u=t;s<u;++s){var w=s*o;for(v=0;v<o;++v)x[v+w]=s}}var E=new r.Geometry;for(s=0,u=n.length;s<u;++s){var O=n[s],R=new r.Attribute(a[s],O.size);O.materialAttribute=R,E.addAttribute(O.name,R)}return E}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(88)),r(n(89)),r(n(90))},function(e,t){e.exports="if (_active < 0.5) {\ngl_Position = vec4(0.0, 0.0, 0.0, 1.0);\nreturn;\n}"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(1),s=n(0),u=n(91),c=n(8),l=n(39),h=n(30),f=n(5)("performance"),d=Math.max;t.isInstanceAttributeBufferLocation=function(e){return Boolean(e&&e.buffer&&e.buffer.value)};var p=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.allBufferLocations={},r.availableLocations=[],r.currentInstancedCount=0,r.instanceToBufferLocation={},r.maxInstancedCount=0,r.attributeToPropertyIds=new Map,r.updateAllPropertyIdList=[],r.activePropertyId=-1,r.currentAvailableLocation=-1,r.remove=function(e){var t=r.instanceToBufferLocation[e.uid];return t&&(delete r.instanceToBufferLocation[e.uid],r.availableLocations.push(t)),e},r.add=r.doAddWithRegistration,r}return i(t,e),t.prototype.changesProcessed=function(){e.prototype.changesProcessed.call(this),this.availableLocations.splice(0,this.currentAvailableLocation+1),this.currentAvailableLocation=-1},t.prototype.doAddWithRegistration=function(e){var t=this;a.ObservableMonitoring.setObservableMonitor(!0),this.layer.shaderIOInfo.instanceAttributes.forEach((function(n){if(!n.parentAttribute){n.update(e);var r=a.ObservableMonitoring.getObservableMonitorIds(!0);t.attributeToPropertyIds.set(n,[r[r.length-1]]),r.length>1&&f("Property has multiple observables. Only the last trigger will be retained as the feature is not complete yet"),n===t.layer.shaderIOInfo.activeAttribute&&(t.activePropertyId=r[0])}})),a.ObservableMonitoring.setObservableMonitor(!1),this.makeUpdateAllPropertyIdList();var n=this.resizeBuffer();return this.gatherLocationsIntoGroups(n.newLocations,n.growth),this.add=this.doAdd,this.doAdd(e)},t.prototype.doAdd=function(e){if(this.availableLocations.length<=0||this.currentAvailableLocation>=this.availableLocations.length-1){var t=this.resizeBuffer();this.gatherLocationsIntoGroups(t.newLocations,t.growth)}var n=this.availableLocations[++this.currentAvailableLocation];return n&&this.geometry?(this.instanceToBufferLocation[e.uid]=n,this.currentInstancedCount=this.geometry.maxInstancedCount=d(this.currentInstancedCount,n.instanceIndex+1),this.model&&(this.model.vertexDrawRange=[0,this.layer.shaderIOInfo.instanceVertexCount],this.model.drawInstances=this.currentInstancedCount,0===this.layer.shaderIOInfo.instanceVertexCount&&(this.model.vertexDrawRange[1]=this.model.drawInstances))):console.error("Add Error: Instance Attribute Buffer Manager failed to pair an instance with a buffer location"),n},t.prototype.destroy=function(){this.geometry&&this.geometry.destroy(),this.material&&this.material.dispose(),this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model)},t.prototype.getBufferLocations=function(e){return this.instanceToBufferLocation[e.uid]},t.prototype.getActiveAttributePropertyId=function(){return this.activePropertyId},t.prototype.getUpdateAllPropertyIdList=function(){return this.updateAllPropertyIdList},t.prototype.managesInstance=function(e){return void 0!==this.instanceToBufferLocation[e.uid]},t.prototype.makeUpdateAllPropertyIdList=function(){var e={};this.attributeToPropertyIds.forEach((function(t){e[t[0]]=t[0]})),this.updateAllPropertyIdList=Object.values(e).filter(Boolean)},t.prototype.removeFromScene=function(){this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model),delete this.scene},t.prototype.resizeBuffer=function(){f("Gathering resize growth amount...");var e=this.layer.shaderIOInfo,t=0,n=new Map;if(this.changeListContext){t=1e3;for(var r=0,i=this.changeListContext.length;r<i;++r){var a=this.changeListContext[r];switch(a[1]){case s.InstanceDiffType.CHANGE:case s.InstanceDiffType.INSERT:this.instanceToBufferLocation[a[0].uid]||t++}}}if(f("BEGIN: Resizing unpacked attribute buffer by %d instances",t),this.geometry){this.geometry.destroy(),this.geometry=new o.Geometry;for(var u=this.maxInstancedCount,h=0,d=e.vertexAttributes;h<d.length;h++){(O=d[h]).materialAttribute&&this.geometry.addAttribute(O.name,O.materialAttribute)}this.maxInstancedCount+=t,this.attributes=this.attributes||[];for(var p=0,g=this.attributes;p<g.length;p++){R=(O=g[p]).bufferAttribute,A=O.size||0;if(R.data instanceof Float32Array){(M=R.data).length<this.maxInstancedCount*A&&(M=new Float32Array(this.maxInstancedCount*A*2)).set(R.data,0);var v=new o.Attribute(M,A,!0,!0);v.setDynamic(!0),O.bufferAttribute=v,this.geometry.addAttribute(O.name,v);S=n.get(O.name),I=this.allBufferLocations[O.name]||[];this.allBufferLocations[O.name]=I;for(var y=0,m=I.length;y<m;++y)I[y].buffer.value=M;S||(S=[],n.set(O.name,S));L=void 0;var b=S.length,T=this.maxInstancedCount-u;S.length+=T,I.length+=T;for(r=u,C=this.maxInstancedCount;r<C;++r,++b)L={attribute:O,buffer:{value:M},instanceIndex:r,range:[r*A,r*A+A]},S[b]=L,I[r]=L}}this.scene.container&&this.model&&this.scene.container.remove(this.model)}else{this.maxInstancedCount+=t,this.geometry=new o.Geometry;for(var _=0,x=e.vertexAttributes;_<x.length;_++){(O=x[_]).materialAttribute&&this.geometry.addAttribute(O.name,O.materialAttribute)}this.attributes=[];for(var w=0,E=e.instanceAttributes;w<E.length;w++){var O,R,S,A=(O=E[w]).size||0,M=new Float32Array(A*this.maxInstancedCount);(R=new o.Attribute(M,A,!0,!0)).setDynamic(!0),this.geometry.addAttribute(O.name,R),(S=n.get(O.name))||(S=[],n.set(O.name,S));var I=this.allBufferLocations[O.name]||[];this.allBufferLocations[O.name]=I;for(var P=Object.assign({},O,{uid:c.uid(),bufferAttribute:R}),r=0;r<this.maxInstancedCount;++r){var L={attribute:P,buffer:{value:M},instanceIndex:r,range:[r*A,r*A+A]};S.push(L),I.push(L)}this.attributes.push(P)}this.geometry.maxInstancedCount=0,this.material=this.makeLayerMaterial();r=0;for(var C=e.uniforms.length;r<C;++r){var B=e.uniforms[r];B.materialUniforms.push(this.material.uniforms[B.name])}}return this.scene&&this.model&&this.scene.container&&this.scene.container.remove(this.model),this.material=this.material||this.makeLayerMaterial(),this.model=l.generateLayerModel(this.geometry,this.material,e.drawMode),this.scene&&this.scene.container&&this.model&&this.scene.container.add(this.model),f("COMPLETE: Resizing unpacked attribute buffer"),{growth:t,newLocations:n}},t.prototype.gatherLocationsIntoGroups=function(e,t){if(0!==this.attributeToPropertyIds.size){f("BEGIN: Unpacked attribute manager grouping new buffer locations");var n,r,i,o,a,s,c=[];this.attributeToPropertyIds.forEach((function(t,n){c.push({attribute:n,bufferLocationsForAttribute:e.get(n.name)||[],childBufferLocations:(n.childAttributes||[]).map((function(t){return{location:e.get(t.name)||[],bufferIndex:-1}})),ids:t,bufferIndex:-1})}));for(var l=0;l<t;++l){for(var h={instanceIndex:-1,propertyToBufferLocation:{}},d=0,p=c.length;d<p;++d)if(n=c[d],r=n.attribute,i=n.ids,o=n.bufferLocationsForAttribute)if(a=o[++n.bufferIndex]){if(-1===h.instanceIndex)h.instanceIndex=a.instanceIndex;else if(a.instanceIndex!==h.instanceIndex){u.emitOnce("Instance Attribute Parallelism Error",(function(e,t){console.warn(t+": A buffer location does not have a matching instance index which means the buffer locations are not in parallel with each other somehow. Error count: "+e),console.warn(r.name,a)}));continue}if(r.childAttributes){a.childLocations=[];for(var g=0,v=r.childAttributes.length;g<v;++g){var y=n.childBufferLocations[g];if(y){var m=y.location[++y.bufferIndex];m?a.childLocations.push(m):(s=r.childAttributes[g],u.emitOnce("Instance Attribute Child Attribute Error",(function(e,t){console.warn(t+": A child attribute does not have a buffer location available. Error count: "+e),console.warn("Parent Attribute: "+r.name+" Child Attribute: "+s.name)})))}}}for(g=0,v=i.length;g<v;++g)h.propertyToBufferLocation[i[g]]=a}else u.emitOnce("Instance Attribute Buffer Error",(function(e,t){console.warn(t+": There is an error in forming buffer location groups in InstanceAttributeBufferManager. Error count: "+e)}));else u.emitOnce("Instance Attribute Buffer Error",(function(e,t){console.warn(t+": There is an error in forming buffer location groups in InstanceAttributeBufferManager. Error count: "+e)}));this.availableLocations.push(h)}f("COMPLETE: Unpacked attribute buffer manager buffer location grouping"),u.flushEmitOnce()}},t.prototype.getInstanceCount=function(){return this.maxInstancedCount},t}(h.BufferManagerBase);t.InstanceAttributeBufferManager=p},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(1),s=n(0),u=n(91),c=n(8),l=n(39),h=n(30),f=Math.max,d=n(5)("performance"),p=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.allBufferLocations={},r.availableLocations=[],r.currentInstancedCount=0,r.instanceToBufferLocation={},r.maxInstancedCount=1e3,r.blockSubAttributesLookup=new Map,r.attributeToPropertyIds=new Map,r.updateAllPropertyIdList=[],r.activePropertyId=-1,r.currentAvailableLocation=-1,r.remove=function(e){var t=r.instanceToBufferLocation[e.uid];return t&&(delete r.instanceToBufferLocation[e.uid],r.availableLocations.push(t)),e},r.add=r.doAddWithRegistration,r}return i(t,e),t.prototype.changesProcessed=function(){e.prototype.changesProcessed.call(this),this.availableLocations.splice(0,this.currentAvailableLocation+1),this.currentAvailableLocation=-1},t.prototype.doAddWithRegistration=function(e){var t=this;this.layer.shaderIOInfo.instanceAttributes.forEach((function(n){if(!n.parentAttribute){a.ObservableMonitoring.setObservableMonitor(!0),n.update(e);var r=a.ObservableMonitoring.getObservableMonitorIds(!0);t.attributeToPropertyIds.set(n,[r[r.length-1]]),r.length>1&&d("Property has multiple observables. Only the last trigger will be retained as the feature is not complete yet"),n===t.layer.shaderIOInfo.activeAttribute&&(t.activePropertyId=r[0])}})),a.ObservableMonitoring.setObservableMonitor(!1),this.makeUpdateAllPropertyIdList();var n=this.resizeBuffer();return this.gatherLocationsIntoGroups(n.newLocations,n.growth),this.add=this.doAdd,this.doAdd(e)},t.prototype.doAdd=function(e){if(this.availableLocations.length<=0||this.currentAvailableLocation>=this.availableLocations.length-1){var t=this.resizeBuffer();this.gatherLocationsIntoGroups(t.newLocations,t.growth)}var n=this.availableLocations[++this.currentAvailableLocation];return n&&this.geometry?(this.instanceToBufferLocation[e.uid]=n,this.currentInstancedCount=this.geometry.maxInstancedCount=f(this.currentInstancedCount,n.instanceIndex+1),this.model&&(this.model.vertexDrawRange=[0,this.layer.shaderIOInfo.instanceVertexCount],this.model.drawInstances=this.currentInstancedCount,0===this.layer.shaderIOInfo.instanceVertexCount&&(this.model.vertexDrawRange[1]=this.model.drawInstances))):console.error("Add Error: Instance Attribute Buffer Manager failed to pair an instance with a buffer location"),n},t.prototype.destroy=function(){this.geometry&&this.geometry.destroy(),this.material&&this.material.dispose(),this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model)},t.prototype.getBufferLocations=function(e){return this.instanceToBufferLocation[e.uid]},t.prototype.getActiveAttributePropertyId=function(){return this.activePropertyId},t.prototype.getUpdateAllPropertyIdList=function(){return this.updateAllPropertyIdList},t.prototype.managesInstance=function(e){return void 0!==this.instanceToBufferLocation[e.uid]},t.prototype.makeUpdateAllPropertyIdList=function(){var e={};this.attributeToPropertyIds.forEach((function(t){e[t[0]]=t[0]})),this.updateAllPropertyIdList=Object.values(e).filter(Boolean)},t.prototype.removeFromScene=function(){this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model),delete this.scene},t.prototype.resizeBuffer=function(){var e=this.layer.shaderIOInfo,t=0,n=new Map;if(this.changeListContext){t=1e3;for(var r=0,i=this.changeListContext.length;r<i;++r){var a=this.changeListContext[r];switch(a[1]){case s.InstanceDiffType.CHANGE:case s.InstanceDiffType.INSERT:this.instanceToBufferLocation[a[0].uid]||t++}}}if(d("BEGIN: Resizing packed attribute buffer by %d instances",t),this.geometry){d("Info: Vertex packing buffer is being resized for layer "+this.layer.id),this.geometry.destroy(),this.geometry=new o.Geometry;for(var u=this.maxInstancedCount,h=0,f=e.vertexAttributes;h<f.length;h++){(D=f[h]).materialAttribute&&this.geometry.addAttribute(D.name,D.materialAttribute)}this.maxInstancedCount+=t,this.attributes=this.attributes||[],this.blockAttributes=this.blockAttributes||[];for(R=0,i=this.blockAttributes.length;R<i;++R){L=(D=this.blockAttributes[R]).bufferAttribute;var p=D.size||0;if(L.data instanceof Float32Array){(P=L.data).length<this.maxInstancedCount*p&&(P=new Float32Array(this.maxInstancedCount*p*2)).set(L.data,0),P.set(L.data,0);var g=new o.Attribute(P,p,!0,!0);D.bufferAttribute=L=g,this.geometry.addAttribute(D.name,g);I=this.blockSubAttributesLookup.get(R),S=D.size||0;if(I)for(C=0,B=I.length;C<B;++C){var v=I[C];(F=n.get(v.name))||(F=[],n.set(v.name,F));N=this.allBufferLocations[v.name]||[];this.allBufferLocations[v.name]=N;U=Object.assign({},v,{uid:c.uid(),packUID:D.packUID,bufferAttribute:L}),j=v.blockIndex||0,G=v.size||1;for(var y=void 0,m=0,b=N.length;m<b;++m)(y=N[m]).attribute=U,y.buffer.value=P;z=void 0;var T=F.length,_=this.maxInstancedCount-u;F.length+=_,N.length+=_;for(r=u;r<this.maxInstancedCount;++r,++T)z={attribute:U,block:R,buffer:{value:P},instanceIndex:r,range:[r*S+j,r*S+j+G]},F[T]=z,N[r]=z}}}}else{this.maxInstancedCount+=t,this.geometry=new o.Geometry;for(var x=0,w=e.vertexAttributes;x<w.length;x++){(D=w[x]).materialAttribute&&this.geometry.addAttribute(D.name,D.materialAttribute)}this.attributes=[],this.blockAttributes=[];var E=new Map,O=new Map;this.blockSubAttributesLookup=O;for(var r=0,i=e.instanceAttributes.length;r<i;++r){var R=(D=e.instanceAttributes[r]).block||0,S=E.get(R)||0;S=Math.max(S,(D.blockIndex||0)+(D.size||0)),E.set(R,S);var A=O.get(R);A||(A=[],O.set(R,A)),A.push(D)}O.forEach((function(e){return e.sort((function(e,t){return(e.blockIndex||0)-(t.blockIndex||0)}))}));var R=0;for(i=E.size;R<i;++R){var S=E.get(R)||0,M=c.uid();S||console.warn("Instance Attribute Packing Error: The system tried to build an attribute with a size of zero.","These are the attributes used:",e.instanceAttributes,"These are the block sizes calculated",E,"This is the block to attribute lookup generated",O);var I,P=new Float32Array(S*this.maxInstancedCount),L=new o.Attribute(P,S,!0,!0);if(this.geometry.addAttribute("block"+R,L),I=O.get(R)){for(var C=0,B=I.length;C<B;++C){var F,D=I[C];(F=n.get(D.name))||(F=[],n.set(D.name,F));var N=this.allBufferLocations[D.name]||[];this.allBufferLocations[D.name]=N;var U=Object.assign({},D,{uid:R,packUID:M,bufferAttribute:L,size:S}),j=D.blockIndex||0,G=D.size||1;for(r=0;r<this.maxInstancedCount;++r){var z={attribute:U,block:R,buffer:{value:P},instanceIndex:r,range:[r*S+j,r*S+j+G]};F.push(z),N.push(z)}this.attributes.push(U)}this.blockAttributes.push({uid:c.uid(),packUID:M,bufferAttribute:L,name:"block"+R,size:S,update:function(){return[0]}})}else console.warn("Instance Attribute Packing Buffer Error: Somehow there are no attributes associated with a block.","These are the attributes used:",e.instanceAttributes,"These are the block sizes calculated",E,"This is the block to attribute lookup generated",O)}this.geometry.maxInstancedCount=0,this.material=this.makeLayerMaterial();r=0;for(var k=e.uniforms.length;r<k;++r){var V=e.uniforms[r];V.materialUniforms.push(this.material.uniforms[V.name])}}return this.scene&&this.model&&this.scene.container&&this.scene.container.remove(this.model),this.material=this.material||this.makeLayerMaterial(),this.model=l.generateLayerModel(this.geometry,this.material,this.layer.shaderIOInfo.drawMode),this.scene&&this.scene.container&&this.model&&this.scene.container.add(this.model),d("COMPLETE: Resizing unpacked attribute buffer"),{growth:t,newLocations:n}},t.prototype.gatherLocationsIntoGroups=function(e,t){if(0!==this.attributeToPropertyIds.size){d("BEGIN: Packed attribute manager grouping new buffer locations");var n=[];this.attributeToPropertyIds.forEach((function(t,r){n.push({attribute:r,bufferLocationsForAttribute:e.get(r.name)||[],childBufferLocations:(r.childAttributes||[]).map((function(t){return{location:e.get(t.name)||[],bufferIndex:-1}})),ids:t,bufferIndex:-1})}));for(var r=0;r<t;++r){for(var i={instanceIndex:-1,propertyToBufferLocation:{}},o=function(e,t){var r=n[e],o=r.attribute,a=r.ids,s=r.bufferLocationsForAttribute;if(!s)return u.emitOnce("Instance Attribute Buffer Error",(function(e,t){console.warn(t+": There is an error in forming buffer location groups in InstanceAttributePackingBufferManager. Error count: "+e)})),"continue";var c=s[++r.bufferIndex];if(!c)return u.emitOnce("Instance Attribute Buffer Error",(function(e,t){console.warn(t+": There is an error in forming buffer location groups in InstanceAttributePackingBufferManager. Error count: "+e)})),"continue";if(-1===i.instanceIndex)i.instanceIndex=c.instanceIndex;else if(c.instanceIndex!==i.instanceIndex)return u.emitOnce("Instance Attribute Parallelism Error",(function(e,t){console.warn(t+": A buffer location does not have a matching instance index which means the buffer locations are not in parallel with each other somehow. Error count: "+e),console.warn(o.name,c)})),"continue";if(o.childAttributes){for(var l=[],h=function(e,t){var n=o.childAttributes[e],i=r.childBufferLocations[e];if(i){var a=i.location[++i.bufferIndex];a?l.push(a):u.emitOnce("Instance Attribute Child Attribute Error",(function(e,t){console.warn(t+": A child attribute does not have a buffer location available. Error count: "+e),console.warn("Parent Attribute: "+o.name+" Child Attribute: "+n.name)}))}},f=0,d=o.childAttributes.length;f<d;++f)h(f);c.childLocations=l}for(f=0,d=a.length;f<d;++f){var p=a[f];i.propertyToBufferLocation[p]=c}},a=0,s=n.length;a<s;++a)o(a);this.availableLocations.push(i)}d("COMPLETE: Packed attribute buffer manager buffer location grouping"),u.flushEmitOnce()}},t.prototype.getInstanceCount=function(){return this.maxInstancedCount},t}(h.BufferManagerBase);t.InstanceAttributePackingBufferManager=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(156),o=n(157),a=function(){function e(){}return e.prototype.makeProcessor=function(e,t){return this.processing||(e.bufferType===r.LayerBufferType.INSTANCE_ATTRIBUTE||e.bufferType===r.LayerBufferType.INSTANCE_ATTRIBUTE_PACKING?this.processor=new i.InstanceAttributeDiffProcessor(e,t):this.processor=new o.UniformDiffProcessor(e,t),this.processing=[this.processor.changeInstance,this.processor.addInstance,this.processor.removeInstance]),this.processing},e}();t.InstanceDiffManager=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(93),s=n(30),u=[],c=Math.min,l=Math.max;!function(e){e[e.PARTIAL=0]="PARTIAL",e[e.FULL=1]="FULL"}(o||(o={}));var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.diffMode=o.PARTIAL,t.bufferAttributeUpdateRange={},t.bufferAttributeWillUpdate={},t.updateInstance=t.updateInstancePartial,t}return i(t,e),t.prototype.addInstance=function(e,t,n,r){if(r)e.changeInstance(e,t,u,r);else{var i=e.layer.bufferManager.add(t);s.isBufferLocationGroup(i)&&(t.active=!0,e.layer.onDiffAdd&&e.layer.onDiffAdd(t),e.updateInstance(e.layer,t,u,i))}},t.prototype.changeInstance=function(e,t,n,r){r?e.updateInstance(e.layer,t,n,r):e.addInstance(e,t,u,r)},t.prototype.removeInstance=function(e,t,n,r){r&&(t.active=!1,e.layer.onDiffRemove&&e.layer.onDiffRemove(t),e.updateInstance(e.layer,t,u,r),e.layer.bufferManager.remove(t))},t.prototype.updateInstancePartial=function(e,t,n,r){var i,o,a,s,u,h,f=r.propertyToBufferLocation,d=this.bufferAttributeUpdateRange;if(t.active){(0===n.length||t.reactivate)&&(n=this.bufferManager.getUpdateAllPropertyIdList());for(var p=0,g=n.length;p<g;++p)if((i=f[n[p]])&&(h=(u=i.attribute).packUID||u.uid,o=u.update(t),i.buffer.value.set(o,i.range[0]),(a=d[h]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER])[0]=u,a[1]=c(i.range[0],a[1]),a[2]=l(i.range[1],a[2]),d[h]=a,i.childLocations))for(var v=0,y=(s=i.childLocations).length;v<y;++v)(i=s[v])&&(h=i.attribute.packUID||i.attribute.uid,o=i.attribute.update(t),i.buffer.value.set(o,i.range[0]),(a=d[h]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER])[0]=i.attribute,a[1]=c(i.range[0],a[1]),a[2]=l(i.range[1],a[2]),d[h]=a)}else h=(u=(i=f[this.bufferManager.getActiveAttributePropertyId()]).attribute).packUID||u.uid,o=u.update(t),i.buffer.value.set(o,i.range[0]),(a=d[h]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER])[0]=u,a[1]=c(i.range[0],a[1]),a[2]=l(i.range[1],a[2]),d[h]=a;t.reactivate=!1},t.prototype.updateInstanceFull=function(e,t,n,r){var i,o,a,s,u=r.propertyToBufferLocation,c=this.bufferAttributeWillUpdate;if(t.active){(0===n.length||t.reactivate)&&(n=this.bufferManager.getUpdateAllPropertyIdList());for(var l=0,h=n.length;l<h;++l)if((i=u[n[l]])&&(o=(s=i.attribute).update(t),i.buffer.value.set(o,i.range[0]),c[s.packUID||s.uid]=s,i.childLocations))for(var f=0,d=(a=i.childLocations).length;f<d;++f)(i=a[f])&&(o=(s=i.attribute).update(t),i.buffer.value.set(o,i.range[0]),c[s.packUID||s.uid]=s)}else o=(s=(i=u[this.bufferManager.getActiveAttributePropertyId()]).attribute).update(t),i.buffer.value.set(o,i.range[0]),c[s.packUID||s.uid]=s;t.reactivate=!1},t.prototype.commit=function(){if(this.diffMode===o.PARTIAL)for(var e=0,t=(r=Object.values(this.bufferAttributeUpdateRange)).length;e<t;++e){var n=r[e];n[0].bufferAttribute.updateRange={count:n[2]-n[1],offset:n[1]}}else{var r;for(e=0,t=(r=Object.values(this.bufferAttributeWillUpdate)).length;e<t;++e){r[e].bufferAttribute.updateRange={count:-1,offset:0}}}this.bufferAttributeUpdateRange={}},t.prototype.incomingChangeList=function(e){0===e.length?this.diffMode=o.PARTIAL:e.length>.7*this.bufferManager.getInstanceCount()?this.diffMode=o.FULL:this.diffMode=o.PARTIAL,this.diffMode===o.PARTIAL?this.updateInstance=this.updateInstancePartial:this.updateInstance=this.updateInstanceFull},t}(a.BaseDiffProcessor);t.InstanceAttributeDiffProcessor=h},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(93),a=n(92),s=[],u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.addInstance=function(e,t,n,r){if(r)e.changeInstance(e,t,s,r);else{var i=e.layer.bufferManager.add(t);a.isUniformBufferLocation(i)&&(t.active=!0,e.layer.onDiffAdd&&e.layer.onDiffAdd(t),e.updateInstance(e.layer,t,i))}},t.prototype.changeInstance=function(e,t,n,r){r?e.updateInstance(e.layer,t,r):e.addInstance(e,t,s,r)},t.prototype.removeInstance=function(e,t,n,r){r&&(t.active=!1,e.layer.onDiffRemove&&e.layer.onDiffRemove(t),e.updateInstance(e.layer,t,r),e.layer.bufferManager.remove(t))},t.prototype.updateInstance=function(e,t,n){if(t.active){for(var r=n.buffer,i=n.range[0],o=r.value,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0,h=void 0,f=0,d=e.shaderIOInfo.instanceAttributes.length;f<d;++f)if(s=(a=e.shaderIOInfo.instanceAttributes[f]).update(t),u=o[i+(a.block||0)],void 0!==(c=a.blockIndex))for(l=c,h=s.length+c;l<h;++l)u[l]=s[l-c];r.value=o}else{r=n.buffer,i=n.range[0],o=r.value,a=void 0,s=void 0,u=void 0,c=void 0;if(s=(a=e.shaderIOInfo.activeAttribute).update(t),u=o[i+(a.block||0)],void 0!==(c=a.blockIndex))for(l=c,h=s.length+c;l<h;++l)u[l]=s[l-c];r.value=o}},t.prototype.commit=function(){},t.prototype.incomingChangeList=function(e){},t}(o.BaseDiffProcessor);t.UniformDiffProcessor=u},function(e,t){e.exports="varying highp vec4 _picking_color_pass_;\nvoid main() {\n${out: _picking_fragment_} = _picking_color_pass_;\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(160);t.normalizeWheel=r.normalizeWheel},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(161),i=n(162);function o(e){var t=0,n=0,r=0,i=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0),r=10*t,i=10*n,"deltaY"in e&&(i=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||i)&&e.deltaMode&&(1===e.deltaMode?(r*=40,i*=40):(r*=800,i*=800)),r&&!t&&(t=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:t,spinY:-n,pixelX:r,pixelY:-i}}t.normalizeWheel=o,o.getEventType=function(){return r.firefox()?"DOMMouseScroll":i("wheel")?"wheel":"mousewheel"}},function(e,t){var n,r,i,o,a,s,u,c,l,h,f,d,p,g,v,y=!1;function m(){if(!y){y=!0;var e=navigator.userAgent,t=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(e),m=/(Mac OS X)|(Windows)|(Linux)/.exec(e);if(d=/\b(iPhone|iP[ao]d)/.exec(e),p=/\b(iP[ao]d)/.exec(e),h=/Android/i.exec(e),g=/FBAN\/\w+;/i.exec(e),v=/Mobile/i.exec(e),f=!!/Win64/.exec(e),t){(n=t[1]?parseFloat(t[1]):t[5]?parseFloat(t[5]):NaN)&&document&&document.documentMode&&(n=document.documentMode);var b=/(?:Trident\/(\d+.\d+))/.exec(e);s=b?parseFloat(b[1])+4:n,r=t[2]?parseFloat(t[2]):NaN,i=t[3]?parseFloat(t[3]):NaN,(o=t[4]?parseFloat(t[4]):NaN)?(t=/(?:Chrome\/(\d+\.\d+))/.exec(e),a=t&&t[1]?parseFloat(t[1]):NaN):a=NaN}else n=r=i=a=o=NaN;if(m){if(m[1]){var T=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(e);u=!T||parseFloat(T[1].replace("_","."))}else u=!1;c=!!m[2],l=!!m[3]}else u=c=l=!1}}var b={ie:function(){return m()||n},ieCompatibilityMode:function(){return m()||s>n},ie64:function(){return b.ie()&&f},firefox:function(){return m()||r},opera:function(){return m()||i},webkit:function(){return m()||o},safari:function(){return b.webkit()},chrome:function(){return m()||a},windows:function(){return m()||c},osx:function(){return m()||u},linux:function(){return m()||l},iphone:function(){return m()||d},mobile:function(){return m()||d||p||h||v},nativeApp:function(){return m()||g},android:function(){return m()||h},ipad:function(){return m()||p}};e.exports=b},function(e,t,n){"use strict";var r,i=n(163);i.canUseDOM&&(r=document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("",""))
/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */,e.exports=function(e,t){if(!i.canUseDOM||t&&!("addEventListener"in document))return!1;var n="on"+e,o=n in document;if(!o){var a=document.createElement("div");a.setAttribute(n,"return;"),o="function"==typeof a[n]}return!o&&r&&"wheel"===e&&(o=document.implementation.hasFeature("Events.wheel","3.0")),o}},function(e,t,n){"use strict";var r=!("undefined"==typeof window||!window.document||!window.document.createElement),i={canUseDOM:r,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:r&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:r&&!!window.screen,isInWorker:!r};e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(165)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(0),o=n(40),a=n(6);r.ShaderModule.register([{moduleId:"world2D",description:"\nThese are projection methods and camera\nrelated constants associated with a\nView2D.\n\nMethods:\nvec3 cameraSpace(vec3 world);\nvec3 cameraSpaceSize(vec3 worldSize);\nvec4 clipSpace(vec3 world);\nvec4 clipSpaceSize(vec3 worldSize);\n\nConstants:\nmat4 projection;\nmat4 view;\nmat4 viewProjection;\nvec3 cameraOffset;\nvec3 cameraPosition;\nvec3 cameraScale;\nvec3 cameraScale2D;\nvec3 cameraRotation;\nvec2 viewSize;\nfloat pixelRatio;\n",content:n(113),compatibility:i.ShaderInjectionTarget.ALL,uniforms:function(e){return e instanceof a.Layer2D?[{name:"projection",size:i.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"view",size:i.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"viewProjection",size:i.UniformSize.MATRIX4,update:function(){return e.view.props.camera.viewProjection}},{name:"cameraOffset",size:i.UniformSize.THREE,update:function(){return e.view.props.camera instanceof o.Camera2D?e.view.props.camera.control2D.offset:[0,0,0]}},{name:"cameraPosition",size:i.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:i.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraScale2D",size:i.UniformSize.THREE,update:function(){return e.view.props.camera instanceof o.Camera2D?e.view.props.camera.scale2D:[1,1,1]}},{name:"cameraRotation",size:i.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"viewSize",size:i.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:i.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]:(console.warn("A shader requested the module world2D; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}}])},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(67),a=n(4),s=n(73),u=n(74),c=n(7),l=n(23),h=n(48),f=n(110),d=n(111),p=n(98),g=n(90),v=n(0),y=n(3),m=n(61),b=n(112),T=n(89),_=n(88),x=n(176),w=n(60),E=n(178),O=n(27);t.DEFAULT_IO_EXPANSION=[new T.BasicIOExpansion,new g.ActiveIOExpansion,new _.EasingIOExpansion],t.DEFAULT_RESOURCE_MANAGEMENT=[{type:v.ResourceType.COLOR_BUFFER,manager:new h.ColorBufferResourceManager},{type:v.ResourceType.TEXTURE,manager:new d.RenderTextureResourceManager},{type:v.ResourceType.ATLAS,manager:new f.AtlasResourceManager({})},{type:v.ResourceType.FONT,manager:new l.FontResourceManager}],t.DEFAULT_SHADER_TRANSFORM=[new x.Shaders30CompatibilityTransform];var R,S=[0,0,0,0];function A(e,t){return(e.order||Number.MAX_SAFE_INTEGER)-(t.order||Number.MAX_SAFE_INTEGER)}!function(e){e[e.WILL_RENDER=0]="WILL_RENDER",e[e.DID_RENDER=1]="DID_RENDER"}(R||(R={}));var M=function(){function e(e){var t=this;this.commands=new E.SurfaceCommands({surface:this}),this.frameMetrics={currentFrame:0,currentTime:0|Date.now(),frameDuration:1e3/60,previousTime:0|Date.now()},this.isBufferingResources=!1,this.ioExpanders=[],this.shaderTransforms=[],this.optimizedOutputs=new Set([v.FragmentOutputType.PICKING]),this.ioSorting=new p.BaseIOSorting,this.pixelRatio=window.devicePixelRatio,this.enabledOptimizedOutputs=new Set,this.viewDrawDependencies=new Map,this.resourceDiffs=new m.ReactiveDiff({buildItem:function(e){return r(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.resourceManager.initResource(e)];case 1:return t.sent(),[2,{id:e.key}]}}))}))},destroyItem:function(e,n){return r(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.resourceManager.destroyResource(e)];case 1:return t.sent(),[2,!0]}}))}))},updateItem:function(e,n){return r(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.resourceManager.updateResource(e)];case 1:return t.sent(),[2]}}))}))}}),this.sceneDiffs=new m.ReactiveDiff({buildItem:function(e){return r(t,void 0,void 0,(function(){return i(this,(function(t){return[2,new w.LayerScene(this,{key:e.key,views:e.views,layers:e.layers})]}))}))},destroyItem:function(e,n){return r(t,void 0,void 0,(function(){return i(this,(function(e){return n.destroy(),[2,!0]}))}))},updateItem:function(e,n){return r(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,n.update(e)];case 1:return t.sent(),[2]}}))}))}}),this.readyResolver=new y.PromiseResolver,this.ready=this.readyResolver.promise,e&&this.init(e)}return Object.defineProperty(e.prototype,"gl",{get:function(){return this.context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scenes",{get:function(){return this.sceneDiffs.items},enumerable:!0,configurable:!0}),e.prototype.broadcastEventManagerCycle=function(e){for(var t=0,n=this.userInputManager.eventManagers.length;t<n;++t){var r=this.userInputManager.eventManagers[t];switch(e){case R.DID_RENDER:r.didRender();break;case R.WILL_RENDER:r.willRender()}}},e.prototype.commit=function(e,t,n){return r(this,void 0,void 0,(function(){var r,o,a,s,l,h,f,d,p,g,v,y,m,b,T,_,x,w,E,O,R,S,M;return i(this,(function(i){if(!this.gl)return[2];for(r=!1,t&&this.frameMetrics.currentFrame++,this.frameMetrics.frameDuration=this.frameMetrics.currentTime-this.frameMetrics.previousTime,this.frameMetrics.previousTime=this.frameMetrics.currentTime,void 0===e?this.frameMetrics.currentTime=0|Date.now():(this.frameMetrics.previousTime===this.frameMetrics.currentTime&&(this.frameMetrics.previousTime=e),this.frameMetrics.currentTime=e),e=this.frameMetrics.currentTime,(o=this.sceneDiffs.items).sort(A),a={},s=0,l=o.length;s<l;++s)for(h=o[s],f=h.views,d=h.layers,f.sort(A),d.sort(A),p=0,g=f.length;p<g;++p){for(v=f[p],y={},d.length>0&&v.willUseView(),m=this.renderer.getRenderSize(),b=new c.Bounds({width:m[0],height:m[1],x:0,y:0}),v.renderTarget&&(T=Array.isArray(v.renderTarget)?v.renderTarget[0]:v.renderTarget,_=T.getSize(),b=new c.Bounds({width:_[0],height:_[1],x:0,y:0})),x=u.getAbsolutePositionBounds(v.props.viewport,b,this.pixelRatio),v.fitViewtoViewport(b,x),w=0,E=d.length;w<E;++w){(O=d[w]).view=v;try{O.draw(),(O.needsViewDrawn||O.isAnimationContinuous)&&(v.needsDraw=!0),y[O.id]=O,v.animationEndTime=Math.max(v.animationEndTime,O.animationEndTime,v.props.camera.animationEndTime),O.lastFrameTime=e}catch(e){a[O.id]||(a[O.id]=[O,e])}}(v.needsDraw||e&&e<v.lastFrameTime||e&&e<v.animationEndTime||v.props.camera.needsViewDrawn)&&(v.needsDraw=!0,r=!0,(R=this.viewDrawDependencies.get(v))&&R.forEach((function(e){e.needsDraw=!0}))),S=Object.values(y),d.length!==S.length&&h.layerDiffs.diff(S.map((function(e){return e.initializer}))),h.container&&(n&&n(r,h,v))}return M=Object.values(a),this.printLayerErrors(M),[2]}))}))},e.prototype.destroy=function(){this.resourceManager.destroy(),this.userInputManager.destroy(),this.sceneDiffs.destroy(),this.renderer.dispose(),delete this.context},e.prototype.draw=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,a,s,u,c,l,h,f,d,p=this;return i(this,(function(i){switch(i.label){case 0:if(!this.gl)return[2];for(this.broadcastEventManagerCycle(R.WILL_RENDER),a=0,s=this.sceneDiffs.items.length;a<s;++a)for(u=this.sceneDiffs.items[a],t=0,n=u.views.length;t<n;++t)(h=u.views[t]).props.camera.broadcast(h.id);return[4,this.commit(e,!0,(function(e,t,n){t.container&&e&&p.drawSceneView(t.container,n)}))];case 1:return i.sent(),this.userInputManager.waitingForRender&&(this.userInputManager.waitingForRender=!1),this.isBufferingResources?[3,4]:(this.isBufferingResources=!0,[4,this.resourceManager.dequeueRequests()]);case 2:return r=i.sent(),this.isBufferingResources=!1,r?(o=this.draw,[4,y.onFrame()]):[3,4];case 3:o.apply(this,[i.sent()]),i.label=4;case 4:for(a=0,s=this.sceneDiffs.items.length;a<s;++a){for(u=this.sceneDiffs.items[a],c=0,l=u.views.length;c<l;++c)(h=u.views[c]).needsDraw=!1,h.props.camera.resolve();for(f=0,d=u.layers.length;f<d;++f)u.layers[f].needsViewDrawn=!1}return this.broadcastEventManagerCycle(R.DID_RENDER),this.enabledOptimizedOutputs.clear(),[2]}}))}))},e.prototype.drawSceneView=function(e,t,n,r){var i=this;n=n||this.renderer;var o={x:t.viewBounds.left,y:t.viewBounds.top},a=t.viewBounds,s=t.props.background||S,u=t.clearFlags.indexOf(O.ClearFlags.COLOR)>-1,c=r||t.renderTarget||null;t.renderTarget&&(t.getRenderTargets().forEach((function(e){return i.optimizedOutputs.forEach((function(t){return e.disabledTargets.add(t)}))})),this.enabledOptimizedOutputs.size>0&&t.getRenderTargets().forEach((function(e){return i.enabledOptimizedOutputs.forEach((function(t){return e.disabledTargets.delete(t)}))})));n.setRenderTarget(c),n.setScissor({x:o.x,y:o.y,width:a.width,height:a.height},c),u&&n.clearColor([s[0],s[1],s[2],s[3]]),n.setViewport({x:o.x,y:o.y,width:a.width,height:a.height}),t.clearFlags&&t.clearFlags.length>0?n.clear(u,t.clearFlags.indexOf(O.ClearFlags.DEPTH)>-1,t.clearFlags.indexOf(O.ClearFlags.STENCIL)>-1):n.clear(!1),n.render(e,c),t.lastFrameTime=this.frameMetrics.currentTime},e.prototype.fitContainer=function(e){if(!a.isOffscreenCanvas(this.context.canvas)){var t=this.context.canvas.parentElement;if(t){var n=this.context.canvas;n.className="",n.setAttribute("style",""),t.style.position="relative",n.style.position="absolute",n.style.left="0xp",n.style.top="0xp",n.style.width="100%",n.style.height="100%",n.setAttribute("width",""),n.setAttribute("height","");var r=t.getBoundingClientRect(),i=n.getBoundingClientRect();this.resize(i.width||100,r.height||100)}}},e.prototype.gatherViewDrawDependencies=function(){if(this.sceneDiffs){this.viewDrawDependencies.clear();for(var e=this.sceneDiffs.items,t=this.renderer.getRenderSize(),n=0,r=e.length;n<r;n++)for(var i=0,o=(f=e[n]).views.length;i<o;++i){var a=f.views[i];a.willUseView();var s=new c.Bounds({width:t[0],height:t[1],x:0,y:0});if(a.renderTarget){var l=(Array.isArray(a.renderTarget)?a.renderTarget[0]:a.renderTarget).getSize();s=new c.Bounds({width:l[0],height:l[1],x:0,y:0})}var h=u.getAbsolutePositionBounds(a.props.viewport,s,this.pixelRatio);a.fitViewtoViewport(s,h),a.props.camera.update(!0)}for(n=0,r=e.length;n<r;n++){var f;for(i=0,o=(f=e[n]).views.length;i<o;++i){for(var d=f.views[i],p=[],g=0,v=e.length;g<v;g++)if(g!==n)for(var y=e[g],m=0,b=y.views.length;m<b;++m){var T=y.views[m];d.viewBounds.hitBounds(T.viewBounds)&&p.push(T)}this.viewDrawDependencies.set(d,p)}}}},e.prototype.getCurrentInteraction=function(){return this.userInputManager.currentInteraction},e.prototype.getIOExpanders=function(){return this.ioExpanders},e.prototype.getIOSorting=function(){return this.ioSorting},e.prototype.getShaderTransforms=function(){return this.shaderTransforms},e.prototype.getOptimizedOutputs=function(){return this.enabledOptimizedOutputs},e.prototype.getViewSize=function(e){for(var t=0,n=this.sceneDiffs.items.length;t<n;++t){var r=this.sceneDiffs.items[t].viewDiffs.getByKey(e);if(r)return r.renderTarget?r.viewBounds:r.screenBounds}return null},e.prototype.getViewWorldBounds=function(e){for(var t=0,n=this.sceneDiffs.items.length;t<n;++t){var r=this.sceneDiffs.items[t].viewDiffs.getByKey(e);if(r){if(r.screenBounds){var i=r.projection.viewToWorld([0,0]),o=r.projection.screenToWorld([r.screenBounds.right,r.screenBounds.bottom]);return new c.Bounds({bottom:o[1],left:i[0],right:o[0],top:i[1]})}return null}}return null},e.prototype.getProjections=function(e){for(var t=0,n=this.sceneDiffs.items.length;t<n;++t){var r=this.sceneDiffs.items[t].viewDiffs.getByKey(e);if(r)return r.projection}return null},e.prototype.init=function(e){var t;return r(this,void 0,void 0,(function(){var n,r=this;return i(this,(function(i){switch(i.label){case 0:return this.context?[2,this]:(this.pixelRatio=e.pixelRatio||this.pixelRatio,this.pixelRatio<1&&(this.pixelRatio=1),(n=this.initGL(e))?(this.context=n,this.gl?(null===(t=e.optimizedOutputTargets)||void 0===t||t.forEach((function(e){return r.optimizedOutputs.add(e)})),this.initUserInputManager(e),[4,this.initResources(e)]):[3,4]):(this.readyResolver.reject({error:v.SurfaceErrorType.NO_WEBGL_CONTEXT,message:"Could not establish a webgl context. Surface is being destroyed to free resources."}),this.destroy(),[2,this]));case 1:return i.sent(),[4,this.initIOExpanders(e)];case 2:return i.sent(),[4,this.initShaderTransforms(e)];case 3:return i.sent(),[3,5];case 4:console.warn("Could not establish a GL context. Layer Surface will be unable to render"),i.label=5;case 5:return this.readyResolver.resolve(this),[2,this]}}))}))},e.prototype.initGL=function(e){var t=e.context;if(!t)return null;try{t.setAttribute("data-deltav",n(179).version)}catch(e){}var r=t.width,i=t.height,o=!0,a=Object.assign({alpha:!1,antialias:!1,preserveDrawingBuffer:!1,premultiplyAlpha:!1},e.rendererOptions);return this.renderer=new s.WebGLRenderer({alpha:a.alpha,antialias:a.antialias,canvas:t,preserveDrawingBuffer:a.preserveDrawingBuffer,premultipliedAlpha:a.premultipliedAlpha,onNoContext:function(){o=!1}}),o&&this.renderer.gl?(this.context=this.renderer.gl,this.resourceManager&&this.resourceManager.setWebGLRenderer(this.renderer),this.setRendererSize(r,i),this.renderer.setPixelRatio(this.pixelRatio),this.renderer.gl):null},e.prototype.initIOExpanders=function(e){Array.isArray(e.ioExpansion)||void 0===e.ioExpansion?this.ioExpanders=e.ioExpansion&&e.ioExpansion.slice(0)||t.DEFAULT_IO_EXPANSION&&t.DEFAULT_IO_EXPANSION.slice(0)||[]:e.ioExpansion instanceof Function&&(this.ioExpanders=e.ioExpansion(t.DEFAULT_IO_EXPANSION));var n=this.resourceManager.getIOExpansion();this.ioExpanders=this.ioExpanders.concat(n)},e.prototype.initShaderTransforms=function(e){Array.isArray(e.shaderTransforms)||void 0===e.shaderTransforms?this.shaderTransforms=e.shaderTransforms&&e.shaderTransforms.slice(0)||t.DEFAULT_SHADER_TRANSFORM&&t.DEFAULT_SHADER_TRANSFORM.slice(0)||[]:e.shaderTransforms instanceof Function&&(this.shaderTransforms=e.shaderTransforms(t.DEFAULT_SHADER_TRANSFORM))},e.prototype.initUserInputManager=function(e){var t=[new b.LayerMouseEvents].concat(e.eventManagers||[]);this.userInputManager=new o.UserInputEventManager(this.context.canvas,this,t,e.handlesWheelEvents)},e.prototype.initResources=function(e){return r(this,void 0,void 0,(function(){var n=this;return i(this,(function(r){return this.resourceManager=new l.ResourceRouter,this.resourceManager.setWebGLRenderer(this.renderer),(e.resourceManagers&&e.resourceManagers.slice(0)||t.DEFAULT_RESOURCE_MANAGEMENT&&t.DEFAULT_RESOURCE_MANAGEMENT.slice(0)||[]).forEach((function(e){n.resourceManager.setManager(e.type,e.manager)})),[2]}))}))},e.prototype.pipeline=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return e.resources?[4,this.resourceDiffs.diff(e.resources)]:[3,2];case 1:t.sent(),t.label=2;case 2:return e.scenes?[4,this.sceneDiffs.diff(e.scenes)]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.gatherViewDrawDependencies(),[2]}}))}))},e.prototype.printLayerErrors=function(e){e.length>0&&(console.warn("Some layers errored during their draw update. These layers will be removed. They can be re-added if render() is called again:",e.map((function(e){return e[0].id}))),e.forEach((function(e){if(console.warn("Layer "+e[0].id+" removed for the following error:"),e[1]){var t=e[1].stack||e[1].message;if(console.error(t),t.indexOf("RangeError")>-1||t.indexOf("Source is too large")>-1){for(var n,r=e[0],i=r.bufferManager.changeListContext,o=0,a=function(e,t){var a=i[e][0];r.shaderIOInfo.instanceAttributes.forEach((function(e){e.update(a).length!==e.size&&(n||(n=["Example instance returned the wrong sized value for an attribute:",a,e]),o++)}))},s=0,u=i.length;s<u;++s)a(s);n&&(console.error("The following output shows discovered issues related to the specified error"),console.error("Instances are returning too large IO for an attribute\n",n[0],n[1],n[2],"Total errors for too large IO values",o))}}})))},e.prototype.resize=function(e,t,n){if(this.pixelRatio=n||this.pixelRatio,this.pixelRatio<1&&(this.pixelRatio=1),this.setRendererSize(e,t),this.renderer.setPixelRatio(this.pixelRatio),this.userInputManager.resize(),this.resourceManager.resize(),this.sceneDiffs)for(var r=this.sceneDiffs.items,i=0,o=r.length;i<o;++i)for(var a=r[i],s=0,u=a.views.length;s<u;++s){var c=a.views[s];c.pixelRatio=this.pixelRatio,c.props.camera.update(!0)}this.gatherViewDrawDependencies()},e.prototype.redraw=function(){for(var e=0,t=this.sceneDiffs.items.length;e<t;++e)for(var n=this.sceneDiffs.items[e],r=0,i=n.views.length;r<i;++r){n.views[r].needsDraw=!0}},e.prototype.setRendererSize=function(e,t){e=e||100,t=t||100,this.renderer.setSize(e,t)},e.prototype.enableOptimizedOutput=function(e){this.enabledOptimizedOutputs.add(e)},e}();t.Surface=M},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=Math.ceil,o=Math.max,a=Math.log2,s=Math.pow,u=Math.sqrt,c=[-1,-1];function l(e,t,n){void 0===n&&(n=!1);for(var i,a,s,c,l=n?-1:1,h=[],f=-1,d=0,p=e.length;d<p;++d){var g=e[d];h[d]=[];for(var v=0,y=g.length;v<y;++v)(i=g[v])===t?c=256:(a=[d,v],s=r.subtract2(i,a),c=u(r.dot2(s,s))),h[d][v]=c,f=o(c,f)}for(d=0,p=e.length;d<p;++d)for(v=0,y=(g=e[d]).length;v<y;++v)c=h[d][v],h[d][v]=c/f*255*l;return h}function h(e,t,n,r){for(var i,o=l(e,n,!0),a=l(t,n,!1),s=o.length,u=o,c=0,h=o.length;c<h;++c)for(var f=o[c],d=a[c],p=0,g=f.length;p<g;++p){var v=f[p],y=d[p];f[p]=v+y}for(c=0,h=u.length;c<h;++c)for(p=0,g=(f=u[c]).length;p<g;++p){i=i=f[p];var m=p*(4*s)+4*c;r[m]=i,r[m+1]=i,r[m+2]=i,r[m+3]=255}}function f(e,t){for(var n,i,o,a,u,l,h,f,d,p=e.length,g=e[0].length,v=function(e){for(var t=[],n=0,r=e.length;n<r;++n)t[n]=[];return t}(e),y=e,m=0;m<t;++m){var b=v;v=y,y=b;var T=s(2,t-m-1);for(h=0;h<p;++h)for(f=0;f<g;++f){for(n=[h,f],o=[(v[h-T]||[])[f-T]||c,(v[h]||[])[f-T]||c,(v[h+T]||[])[f-T]||c,(v[h-T]||[])[f]||c,(v[h]||[])[f]||c,(v[h+T]||[])[f]||c,(v[h-T]||[])[f+T]||c,(v[h]||[])[f+T]||c,(v[h+T]||[])[f+T]||c],u=0,a=Number.MAX_VALUE,d=0;d<9;++d){var _=o[d];_!==c&&(i=r.subtract2(_,n),(l=r.dot2(i,i))<a&&(a=l,u=d))}y[h][f]=o[u]}}return y}t.convertToSDF=function(e,t){void 0===t&&(t=h);var n=e.width,r=e.height,s=e.getContext("2d");if(s){var u=s.getImageData(0,0,n,r).data,l=o(n,r),d=i(a(l)),p=function(e,t){for(var n=e.width,r=e.height,i=[],o=[],a=0;a<n;++a){i[a]=[],o[a]=[];for(var s=0;s<r;++s){t[s*(4*n)+4*a+3]?(i[a][s]=[a,s],o[a][s]=c):(i[a][s]=c,o[a][s]=[a,s])}}return{seed:i,inverse:o}}(e,u),g=f(p.seed,d),v=f(p.inverse,d),y=new ImageData(n,r);t(g,v,c,y.data),s.putImageData(y,0,0)}},t.makeFontSDF=function(e){}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(28),s=function(){function e(){}return e.modify=function(e,t,n){return r(this,void 0,void 0,(function(){var r,o,a,s,u,c,l;return i(this,(function(i){for(r=0,o=t.length;r<o;++r)for(a=t[r],s=0,u=e.length;s<u;++s)c=e[s],(l=c.getEasing(a))&&n(l,c,s,r);return[2]}))}))},e.all=function(e,t,n,s){return r(this,void 0,void 0,(function(){var r,u,c,l,h,f,d,p,g,v,y;return i(this,(function(i){for(r=o.NOOP,u=new Promise((function(e){return r=e})),c=0,l=0,h=n.length;l<h;++l)for(f=n[l],d=0,p=t.length;d<p;++d)g=t[d],(v=g.getEasing(f))&&(s&&s(v,g,d,l),c=Math.max((v.delay||0)+v.duration,c));return y=function(e){e<c?a.onFrame(y):r()},e?a.onFrame((function(e){c+=e,y(e)})):r(),[2,u]}))}))},e}();t.EasingUtil=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wait=function(e){return new Promise((function(t){return setTimeout(t,e)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(27),i=n(57),o=n(18),a=n(102),s=n(103);t.create={layer:o.createLayer,view:r.createView,vertex:s.createVertex,uniform:a.createUniform,attribute:i.createAttribute}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=document.createElement("img"),s=document.createElement("canvas");t.svgToData=function(e){return r(this,void 0,void 0,(function(){var t,n,r,u,c,l;return i(this,(function(i){switch(i.label){case 0:return t=new o.PromiseResolver,a&&s?(n=(new XMLSerializer).serializeToString(e),r=btoa(n),"data:image/svg+xml;base64,",u="data:image/svg+xml;base64,"+r,c=!1,l=function(){if(!c){c=!0,s.width=a.width*window.devicePixelRatio,s.height=a.height*window.devicePixelRatio;var e=s.getContext("2d");e?(e.clearRect(0,0,s.width,s.height),e.mozImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1,e.drawImage(a,0,0,a.width*window.devicePixelRatio,a.height*window.devicePixelRatio),t.resolve(e.getImageData(0,0,s.width,s.height)),a.src="",s.width=0,s.height=0,s.style.position="absolute",s.style.top="0px",s.style.zIndex="9999"):t.resolve(null)}},a.onload=l,a.src=u,a.width>0&&a.height>0&&l(),[4,t.promise]):[2,null];case 1:return[2,i.sent()]}}))}))}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(24),u=n(0),c=n(3),l=n(21),h=n(42),f=n(100),d=n(63),p=n(5)("performance"),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.requestLookup=new Map,t.requestQueue=new Map,t.resourceLookup=new Map,t.fontManager=new f.FontManager,t}return i(t,e),t.prototype.dequeueRequests=function(){return o(this,void 0,Promise,(function(){var e,t,n,r,i,o;return a(this,(function(s){switch(s.label){case 0:e=!1,t=[],this.requestQueue.forEach((function(e,n){t.push([n,e])})),this.requestQueue.clear(),n=function(n,i){var o,s,u,l,h;return a(this,(function(i){switch(i.label){case 0:return o=t[n],s=o[0],(u=o[1]).length>0?(e=!0,l=u.slice(0),u.length=0,p("Processing requests for resource '%s'",s),[4,r.fontManager.updateFontMap(s,l)]):[3,3];case 1:return i.sent(),[4,r.fontManager.calculateMetrics(s,l)];case 2:i.sent(),(h=r.requestLookup.get(s))?(l.forEach((function(e){var t=h.get(e);if(h.delete(e),t){for(var n=0,r=t.length;n<r;++n){var i=t[n],o=i[0],a=i[1];o.managesInstance(a)&&(a.active=!0)}c.nextFrame((function(){for(var e=new Set,n=0,r=t.length;n<r;++n){var i=t[n][1];e.has(i)||(e.add(i),i.resourceTrigger())}}))}})),p("All requests for resource '%s' are processed",s)):p("There were no Font requests waiting for completion for resource",s),i.label=3;case 3:return[2]}}))},r=this,i=0,o=t.length,s.label=1;case 1:return i<o?[5,n(i,o)]:[3,4];case 2:s.sent(),s.label=3;case 3:return++i,[3,1];case 4:return[2,e]}}))}))},t.prototype.destroy=function(){this.fontManager.destroy()},t.prototype.destroyResource=function(e){var t=this.resourceLookup.get(e.key);t&&(this.fontManager.destroyFontMap(t.id),this.resourceLookup.delete(e.key))},t.prototype.getResource=function(e){return this.resourceLookup.get(e)||null},t.prototype.getIOExpansion=function(){return[new h.TextureIOExpansion(u.ResourceType.FONT,this)]},t.prototype.initResource=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return f.isFontResource(e)?[4,this.fontManager.createFontMap(e)]:[3,2];case 1:(t=n.sent())&&this.resourceLookup.set(e.key,t),p("Font map created->",t),n.label=2;case 2:return[2]}}))}))},t.prototype.request=function(e,t,n,r){var i=n,o=i.fontMap,a=null;if(o)return i.character&&(a=o.getGlyphTexture(i.character)),a?i.fetch===d.FontResourceRequestFetch.IMAGE_SIZE?[a.pixelWidth,a.pixelHeight]:s.subTextureIOValue(a):i.fetch===d.FontResourceRequestFetch.IMAGE_SIZE?[0,0]:s.subTextureIOValue(null);var u=n.key,c=this.requestLookup.get(u);if(c){var l=c.get(i);if(l)return l.push([e,t]),t.active=!1,i.fetch===d.FontResourceRequestFetch.IMAGE_SIZE?[0,0]:s.subTextureIOValue(a)}else c=new Map,this.requestLookup.set(u,c);t.active=!1;var h=this.requestQueue.get(u);return h||(h=[],this.requestQueue.set(u,h)),h.push(i),c.set(i,[[e,t]]),i.fetch?[0,0]:s.subTextureIOValue(a)},t.prototype.updateResource=function(e){if(f.isFontResource(e)){var t=this.resourceLookup.get(e.key);t&&(c.shallowCompare(e.fontSource,t.fontSource)||p("Font resources currently do not update. To update their properties simply destroy and recreate for now."))}},t}(l.BaseResourceManager);t.FontResourceManager=g},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=function(){function e(e,t){var n=this;this.video=e,this.subTexture=t,this.isDestroyed=!1,this.renderedTime=-1,this.previousTime=-1,this.playedFrames=0,this.caughtFrames=0,this.timeFrame=0,this.doUpdate=function(){Math.abs(n.video.currentTime-n.renderedTime)<.015||(n.renderedTime=n.video.currentTime,n.subTexture.update())},this.loop=function(e){n.doUpdate(),n.isDestroyed||o.onFrame(n.loop)},this.addEventListeners()}return e.prototype.addEventListeners=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.isDestroyed?[2]:(e=this.loop,[4,o.onFrame()]);case 1:return e.apply(this,[t.sent()]),[2]}}))}))},e.prototype.destroy=function(){this.video.pause(),this.isDestroyed=!0,this.removeEventListeners()},e.prototype.removeEventListeners=function(){},e}();t.VideoTextureMonitor=a},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=new Image;t.atlasRequest=function(e){return r({type:i.ResourceType.ATLAS,source:o},e)}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(21),a=n(5)("performance"),s=function(){function e(){this.managers=new Map,this.resourceKeyToType=new Map}return e.prototype.dequeueRequests=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,o;return i(this,(function(i){switch(i.label){case 0:e=!1,t=Array.from(this.managers.values()),n=0,r=t.length,i.label=1;case 1:return n<r?[4,t[n].dequeueRequests()]:[3,4];case 2:o=i.sent(),e=e||o,i.label=3;case 3:return++n,[3,1];case 4:return[2,e]}}))}))},e.prototype.destroy=function(){this.managers.forEach((function(e){return e.destroy()})),this.resourceKeyToType.clear(),this.managers.clear(),delete this.webGLRenderer},e.prototype.destroyResource=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return(t=this.managers.get(e.type))?(this.resourceKeyToType.delete(e.key),[4,t.destroyResource(e)]):(console.warn("A Resource is trying to be destroyed but has no manager to facilitate the operation: "+e.type),[2]);case 1:return[2,n.sent()]}}))}))},e.prototype.getIOExpansion=function(){var e=[];return this.managers.forEach((function(t){e=e.concat(t.getIOExpansion())})),e},e.prototype.getManager=function(e){var t=this.managers.get(e);return t||(console.warn("A manager was requested that does not exist for type "+e),o.INVALID_RESOURCE_MANAGER)},e.prototype.getResourceType=function(e){return this.resourceKeyToType.get(e)},e.prototype.initResource=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return(t=this.managers.get(e.type))?this.resourceKeyToType.has(e.key)?(console.warn("Detected two resources with identical keys. The duplicate resource will not be generated:",e.key),[2]):(this.resourceKeyToType.set(e.key,e.type),[4,t.initResource(e)]):(console.warn("A Resource is trying to be created but has no manager to facilitate the operation: "+e.type),[2]);case 1:return[2,n.sent()]}}))}))},e.prototype.request=function(e,t,n,r){var i=this.managers.get(n.type);return i?i.request(e,t,n,r):(console.warn("A Layer is requesting a resource for which there is no manager set. Please make sure a Resource Manager is set for resource of type: "+n.type),[-1,-1,-1,-1])},e.prototype.resize=function(){this.managers.forEach((function(e){return e.resize()}))},e.prototype.setManager=function(e,t){this.managers.get(e)&&a("A manager was assigned to a resource type: "+e+" that overrides another manager already set to that type."),t.router=this,this.managers.set(e,t),t.webGLRenderer=this.webGLRenderer},e.prototype.setWebGLRenderer=function(e){this.webGLRenderer=e,this.managers.forEach((function(t){return t.webGLRenderer=e}))},e.prototype.updateResource=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return(t=this.managers.get(e.type))?[4,t.updateResource(e)]:(console.warn("A Resource is trying to be updated but has no manager to facilitate the operation: "+e.type),[2]);case 1:return[2,n.sent()]}}))}))},e}();t.ResourceRouter=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(14),a=n(177),s=n(80),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.vertex=function(e){var t=s.removeComments(e);return t=o.WebGLStat.SHADERS_3_0?(t=t.replace(/\s+varying\s+/g,"\nout ")).replace(/(texture2D(\s+)\(|texture2D\()/g,"texture("):(t=t.replace(/^#version 300 es/g,"")).replace(/\s+out\s+/g,"\nvarying ")},t.prototype.fragment=function(e){var t=s.removeComments(e);if(o.WebGLStat.SHADERS_3_0){if((t=(t=t.replace(/\s+varying\s+/g,"\nin ")).replace(/(texture2D(\s+)\(|texture2D\()/g,"texture(")).match(/gl_FragColor/g)&&!(t=t.replace(/gl_FragColor/g,"_FragColor")).match("out vec4 _FragColor")){var n=t.split("\n");n.splice(3,0,"layout(location = 0) out vec4 _FragColor;"),t=n.join("\n")}}else t=(t=t.replace(/^#version 300 es/g,"")).replace(/\s+in\s+/g,"\nvarying ");return t},t}(a.BaseShaderTransform);t.Shaders30CompatibilityTransform=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){};t.BaseShaderTransform=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(45),i=n(15),o=n(2),a=n(0);var s=function(){function e(e){this.pickingRenderTargets=new Map,this.surface=e.surface}return e.prototype.analyzePickedPixels=function(e,t){if(!t.optimizeRendering){var n=o.divide2(o.scale2(e,this.surface.pixelRatio),t.projection.screenScale),r=new Uint8Array(100);this.surface.renderer.readPixels(Math.floor(n[0]-2.5),Math.floor(n[1]-2.5),5,5,r);for(var i=function(e,t,n,r,i){for(var o={view:e,allColors:[],colorData:n,dataHeight:i,dataWidth:r,mouse:t,nearestColor:0,nearestColorBytes:[0,0,0,0]},a=new Map,s=0,u=[],c=r/2,l=i/2,h=0,f=[0,0,0,0],d=Number.MAX_SAFE_INTEGER,p=0;p<i;++p){var g=[];u.push(g);for(var v=0;v<r;++v){var y=n[s],m=n[s+1],b=n[s+2];s+=4;var T=y<<16|m<<8|b;if(a.set(T,!0),g.push(T),0!==T){var _=v-c,x=p-l,w=_*_+x*x;w<d&&(d=w,h=T,f=[y,m,b,255])}}}return o.allColors=Array.from(a.keys()),o.nearestColor=h,o.nearestColorBytes=f,o}(t,[n[0]-t.screenBounds.x,n[1]-t.screenBounds.y],r,5,5),s=0,u=t.scene.layers.length;s<u;++s){var c=t.scene.layers[s];c.picking.type===a.PickType.SINGLE&&(c.interactions.colorPicking=i)}}},e.prototype.decodePicking=function(){var e=this,t=this.surface.getCurrentInteraction();if(t){var n=t.screen.position,o=t.target.views.map((function(e){return e.view})),s=new Set;this.pickingRenderTargets.forEach((function(e,t){var n=e.getBuffers()[0].buffer;n instanceof i.Texture&&(n.gl&&!n.destroyed||(e.dispose(),s.add(t)))})),s.forEach((function(t){return e.pickingRenderTargets.delete(t)})),o.forEach((function(t){var i=e.pickingRenderTargets.get(t);if(i||t.getRenderTargets().forEach((function(n){n.gl&&n.getBuffers().forEach((function(n){if(n.outputType===a.FragmentOutputType.PICKING){if(0===(i=new r.RenderTarget({buffers:{color:n}})).width||0===i.height)return void(i=void 0);e.pickingRenderTargets.set(t,i)}}))})),i){var o=e.surface.renderer.state.currentRenderTarget,s=!1;o?(Array.isArray(o)||o.getBuffers()[0].buffer!==i.getBuffers()[0].buffer)&&(s=!0):s=!0,s&&e.surface.renderer.setRenderTarget(i),e.analyzePickedPixels(n,t)}}))}},e}();t.SurfaceCommands=s},function(e){e.exports={version:"2.1.0"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(112))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(35),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.draw=function(){this.props.commands(this.surface)},t.prototype.initShader=function(){return null},t.defaultProps={data:new o.InstanceProvider,key:"",commands:function(){}},t}(n(37).Layer);t.CommandLayer=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(43),s=n(12),u=n(7),c=n(3);!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_MIDDLE=1]="TOP_MIDDLE",e[e.TOP_RIGHT=2]="TOP_RIGHT",e[e.MIDDLE_LEFT=3]="MIDDLE_LEFT",e[e.MIDDLE=4]="MIDDLE",e[e.MIDDLE_RIGHT=5]="MIDDLE_RIGHT",e[e.BOTTOM_LEFT=6]="BOTTOM_LEFT",e[e.BOTTOM_MIDDLE=7]="BOTTOM_MIDDLE",e[e.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(o=t.CameraBoundsAnchor||(t.CameraBoundsAnchor={}));var l=function(e){function t(t){var n=e.call(this,{})||this;return n._uid=c.uid(),n.isPanning=!1,n.isScaling=!1,n.panFilter=function(e,t,n){return e},n.scaleFilter=function(e,t,n){return e},n.startViews=[],n.optimizedViews=new Set,n.cameraImmediateAnimation=s.AutoEasingMethod.immediate(0),n.targetTouches=new Set,n.onRangeChanged=function(e,t){},n.startViewDidStart=!1,n.applyBounds=function(){if(n.bounds&&n.camera){var e=n.getView(n.bounds.view);n.applyScaleBounds(),e&&(n.camera.control2D.getOffset()[0]=n.boundsHorizontalOffset(e,n.bounds),n.camera.control2D.getOffset()[1]=n.boundsVerticalOffset(e,n.bounds))}},n.applyScaleBounds=function(){n.camera&&n.bounds&&(n.bounds.scaleMin&&n.camera.control2D.setScale(s.max3(n.camera.control2D.getScale(),n.bounds.scaleMin)),n.bounds.scaleMax&&n.camera.control2D.setScale(s.min3(n.camera.control2D.getScale(),n.bounds.scaleMax)))},n.handleCameraViewChange=function(e,t){if(t===n.startViews[0]){var r=n.surface.getProjections(t);r&&n.onRangeChanged(e,r)}},t.bounds&&n.setBounds(t.bounds),n._camera=t.camera,n.scaleFactor=t.scaleFactor||1e3,n.ignoreCoverViews=t.ignoreCoverViews||!1,n.twoFingerPan=t.twoFingerPan||!1,t.startView&&(Array.isArray(t.startView)?(n.startViews=t.startView,n._camera.control2D.setViewChangeHandler(n.handleCameraViewChange)):(n.startViews=[t.startView],n._camera.control2D.setViewChangeHandler(n.handleCameraViewChange))),n.panFilter=t.panFilter||n.panFilter,n.scaleFilter=t.scaleFilter||n.scaleFilter,n.onRangeChanged=t.onRangeChanged||n.onRangeChanged,t.wheelShouldScroll&&(n.wheelShouldScroll=t.wheelShouldScroll),n}return i(t,e),Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),t.prototype.anchoredByBoundsHorizontal=function(e,t){switch(t.anchor){case o.TOP_LEFT:case o.MIDDLE_LEFT:case o.BOTTOM_LEFT:return-(t.worldBounds.left-t.screenPadding.left/this.camera.control2D.getScale()[0]);case o.TOP_MIDDLE:case o.MIDDLE:case o.BOTTOM_MIDDLE:return-(t.worldBounds.right-t.worldBounds.width/2-(e.screenBounds.width+t.screenPadding.right)/this.camera.control2D.getScale()[0]*.5);case o.TOP_RIGHT:case o.MIDDLE_RIGHT:case o.BOTTOM_RIGHT:return-(t.worldBounds.right-(e.screenBounds.width-t.screenPadding.right)/this.camera.control2D.getScale()[0])}},t.prototype.anchoredByBoundsVertical=function(e,t){switch(t.anchor){case o.TOP_LEFT:case o.TOP_MIDDLE:case o.TOP_RIGHT:return-(t.worldBounds.top-t.screenPadding.top/this.camera.control2D.getScale()[1]);case o.MIDDLE_LEFT:case o.MIDDLE:case o.MIDDLE_RIGHT:return-(t.worldBounds.bottom-t.worldBounds.height/2-(e.screenBounds.height+t.screenPadding.bottom)/this.camera.control2D.getScale()[1]*.5);case o.BOTTOM_LEFT:case o.BOTTOM_MIDDLE:case o.BOTTOM_RIGHT:return-(t.worldBounds.bottom-(e.screenBounds.height-t.screenPadding.bottom)/this.camera.control2D.getScale()[1])}},t.prototype.boundsHorizontalOffset=function(e,t){var n=e.projection.worldToScreen([t.worldBounds.left,t.worldBounds.top]),r=e.projection.worldToScreen([t.worldBounds.right,t.worldBounds.bottom]);return r[0]-n[0]+t.screenPadding.left+t.screenPadding.right-e.screenBounds.width<0?this.anchoredByBoundsHorizontal(e,t):r[0]<e.screenBounds.right-t.screenPadding.right?-t.worldBounds.right+(e.screenBounds.width-t.screenPadding.right)/this.camera.control2D.getScale()[0]:n[0]>e.screenBounds.left+t.screenPadding.left?-t.worldBounds.left+t.screenPadding.left/this.camera.control2D.getScale()[0]:this.camera.control2D.getOffset()[0]},t.prototype.boundsVerticalOffset=function(e,t){var n=e.projection.worldToScreen([t.worldBounds.left,t.worldBounds.top]),r=e.projection.worldToScreen([t.worldBounds.right,t.worldBounds.bottom]);return r[1]-n[1]+t.screenPadding.top+t.screenPadding.bottom-e.screenBounds.height<0?this.anchoredByBoundsVertical(e,t):r[1]<e.screenBounds.bottom-t.screenPadding.bottom?-t.worldBounds.bottom+(e.screenBounds.height-t.screenPadding.bottom)/this.camera.control2D.getScale()[1]:n[1]>e.screenBounds.top+t.screenPadding.top?-t.worldBounds.top+t.screenPadding.top/this.camera.control2D.getScale()[0]:this.camera.control2D.getOffset()[1]},t.prototype.canStart=function(e){return 0===this.startViews.length||this.startViews&&this.startViews.indexOf(e)>-1||this.startViewDidStart&&this.ignoreCoverViews},t.prototype.centerOn=function(e,t){if(this.camera.control2D.surface){var n=this.camera.control2D.surface.getViewSize(e);if(n){var r=[n.width/2,n.height/2,0],i=s.subtract3(t,s.divide3(r,this.camera.control2D.getScale())),o=s.scale3(i,-1);this.setOffset(e,o)}}},t.prototype.doPan=function(e,t,n){var r=s.vec3(s.divide2(n,this.camera.control2D.getScale()),0);this.panFilter&&(r=this.panFilter(r,t,e)),this.camera.control2D.getOffset()[0]+=r[0],this.camera.control2D.getOffset()[1]+=r[1],this.applyBounds(),this.onRangeChanged(this.camera,t.projection),this.applyBounds(),this.camera.control2D.update()},t.prototype.doScale=function(e,t,n,r){var i=t.projection.screenToWorld(e),o=this.camera.control2D.getScale()[0]||1,a=this.camera.control2D.getScale()[1]||1;this.scaleFilter&&(r=this.scaleFilter(r,t,n)),this.camera.control2D.getScale()[0]=o+r[0],this.camera.control2D.getScale()[1]=a+r[1],this.applyScaleBounds();var u=t.projection.screenToWorld(e),c=s.subtract2(i,u);this.camera.control2D.getOffset()[0]-=c[0],this.camera.control2D.getOffset()[1]-=c[1],this.applyBounds(),this.onRangeChanged(this.camera,t.projection),this.applyBounds(),this.camera.control2D.update(),this.camera.control2D.animation=this.cameraImmediateAnimation},t.prototype.filterTouchesByValidStart=function(e){return this.ignoreCoverViews?e.filter(c.touchesContainsStartView(this.startViews)):e.filter(c.touchesHasStartView(this.startViews))},t.prototype.findCoveredStartView=function(e){var t=this,n=e.target.views.find((function(e){return t.startViews.indexOf(e.view.id)>-1}));this.startViewDidStart=Boolean(n),n&&(this.coveredStartView=n.view)},t.prototype.getRange=function(e){var t=this.getProjection(e),n=this.getViewScreenBounds(e);if(t&&n){var r=t.screenToWorld([n.x,n.y]),i=t.screenToWorld([n.right,n.bottom]);return new u.Bounds({height:i[1]-r[1],width:i[0]-r[0],x:r[0],y:r[1]})}return new u.Bounds({x:0,y:0,width:1,height:1})},t.prototype.getTargetView=function(e){return this.startViews&&!this.ignoreCoverViews?e.target.view:this.coveredStartView},t.prototype.handleMouseDown=function(e){this.startViews&&(this.findCoveredStartView(e),e.start&&(this.isPanning=this.canStart(e.start.view.id)||this.isPanning))},t.prototype.handleTouchDown=function(e){if(this.startViews){var t=this.filterTouchesByValidStart(e.allTouches);this.twoFingerPan?t.length>1&&(this.isPanning=!0):t.length>0&&(this.isPanning=!0),t.length>1&&(this.isScaling=!0);for(var n=0,r=t.length;n<r;++n){var i=t[n];this.targetTouches.add(i.touch.touch.identifier)}}},t.prototype.handleMouseUp=function(e){this.startViewDidStart=!1,this.isPanning=!1,this.optimizedViews.forEach((function(e){return e.optimizeRendering=!1})),this.optimizedViews.clear()},t.prototype.handleTouchUp=function(e){var t=this;e.touches.forEach((function(e){t.targetTouches.delete(e.touch.touch.identifier),t.targetTouches.size<=0&&(t.startViewDidStart=!1,t.isPanning=!1,t.optimizedViews.forEach((function(e){return e.optimizeRendering=!1})),t.optimizedViews.clear())})),this.isPanning=!1,this.isScaling=!1,this.targetTouches.size>0&&(this.isPanning=!0),this.targetTouches.size>1&&(this.isScaling=!0)},t.prototype.handleTouchCancelled=function(e){var t=this;e.touches.forEach((function(e){t.targetTouches.delete(e.touch.touch.identifier),t.targetTouches.size<=0&&(t.startViewDidStart=!1,t.isPanning=!1,t.optimizedViews.forEach((function(e){return e.optimizeRendering=!1})),t.optimizedViews.clear())})),this.isPanning=!1,this.isScaling=!1,this.targetTouches.size>0&&(this.isPanning=!0),this.targetTouches.size>1&&(this.isScaling=!0)},t.prototype.handleDrag=function(e){var t=this;e.start&&this.canStart(e.start.view.id)&&(e.target.views.forEach((function(e){e.view.optimizeRendering=!0,t.optimizedViews.add(e.view)})),this.doPan(e.target.views.map((function(e){return e.view})),e.start.view,e.mouse.deltaPosition),this.camera.control2D.animation=this.cameraImmediateAnimation)},t.prototype.handleTouchDrag=function(e){var t=this,n=this.filterTouchesByValidStart(e.allTouches);if(n.length>0&&this.isPanning){for(var r=0,i=n.length;r<i;++r){n[r].target.views.forEach((function(e){e.view.optimizeRendering=!0,t.optimizedViews.add(e.view)}))}var o=new Set,a=n.reduce((function(e,t){for(var n=0,r=t.target.views.length;n<r;++n){var i=t.target.views[n];o.add(i.view)}return t.touch.startTime<e.touch.startTime?t:e}),n[0]).start.view;if(this.isPanning&&(this.doPan(Array.from(o.values()),a,e.multitouch.centerDelta(n)),this.camera.control2D.animation=this.cameraImmediateAnimation),this.isScaling){var u=e.multitouch.center(n),c=s.subtract2(n[0].touch.currentPosition,u),l=s.subtract2(u,e.multitouch.centerDelta(n)),h=s.subtract2(n[0].touch.previousPosition,l),f=s.length2(c)/s.length2(h),d=[f*this.camera.scale2D[0]-this.camera.scale2D[0],f*this.camera.scale2D[1]-this.camera.scale2D[1],0];1!==f&&this.doScale(u,a,Array.from(o.values()),d)}}},t.prototype.handleWheel=function(e){if(this.findCoveredStartView(e),this.canStart(e.target.view.id))if(this.wheelShouldScroll){var t=[-e.mouse.wheel.delta[0],e.mouse.wheel.delta[1]];e.start&&this.doPan(e.target.views.map((function(e){return e.view})),e.start.view,t)}else{var n=this.camera.control2D.getScale()[0]||1,r=this.camera.control2D.getScale()[1]||1,i=this.getTargetView(e),o=[e.mouse.wheel.delta[1]/this.scaleFactor*n,e.mouse.wheel.delta[1]/this.scaleFactor*r,1];this.doScale(e.screen.position,i,e.target.views.map((function(e){return e.view})),o)}},Object.defineProperty(t.prototype,"pan",{get:function(){return this.camera.control2D.offset},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.camera.control2D.getScale()},enumerable:!0,configurable:!0}),t.prototype.setBounds=function(e){this.bounds=e,this.applyBounds()},t.prototype.setOffset=function(e,t){var n=s.copy3(this.camera.control2D.offset);if(this.camera.control2D.getOffset()[0]=t[0],this.camera.control2D.getOffset()[1]=t[1],this.camera.control2D.getOffset()[2]=t[2],this.applyBounds(),this.camera.control2D.surface){var r=this.camera.control2D.surface.getProjections(e);r&&this.onRangeChanged(this.camera,r)}this.applyBounds();var i=s.copy3(this.camera.control2D.getOffset()),o=this.camera.control2D.animation;this.camera.control2D.setOffset(n),this.camera.control2D.animation=this.cameraImmediateAnimation,this.camera.control2D.setOffset(i),this.camera.control2D.animation=o},t.prototype.setRange=function(e,t){var n=this.getProjection(t),r=this.getViewScreenBounds(t),i=this.getView(t);if(n&&r&&i){var o=s.subtract3([r.width/e.width,r.height/e.height,1],this.camera.control2D.getScale());this.camera.control2D.setScale(s.add3(this.camera.control2D.getScale(),this.scaleFilter(o,i,[i])));var a=s.subtract3([-e.x,-e.y,0],this.camera.control2D.offset);this.camera.control2D.setOffset(s.add3(this.camera.control2D.offset,this.scaleFilter(a,i,[i]))),this.applyBounds(),this.onRangeChanged(this.camera,i.projection),this.applyBounds()}},t.prototype.setRangeChangeHandler=function(e){this.onRangeChanged=e},t}(a.SimpleEventHandler);t.BasicCamera2DController=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(40),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.offsetFilter=function(e){return e},r.scaleFilter=function(e){return e},r.base=n.base,r.offsetFilter=n.offsetFilter||r.offsetFilter,r.scaleFilter=n.scaleFilter||r.scaleFilter,r}return i(t,e),Object.defineProperty(t.prototype,"offset",{get:function(){return this.offsetFilter(this.base.offset)},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.scaleFilter(this.base.scale)},set:function(e){},enumerable:!0,configurable:!0}),t}(n(41).Control2D),s=function(e){function t(t){var n=e.call(this)||this;return n.base=t.base,n._control2D=new a(n.base,{base:n.base.control2D,offsetFilter:t.offsetFilter,scaleFilter:t.scaleFilter}),n}return i(t,e),Object.defineProperty(t.prototype,"control2D",{get:function(){return this._control2D},set:function(e){},enumerable:!0,configurable:!0}),t}(o.Camera2D);t.ReferenceCamera2D=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=n(2),s=n(13),u=n(16),c=n(40),l=n(185);function h(e){return e.projectionType===u.CameraProjectionType.ORTHOGRAPHIC}var f=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.projection=new l.Projection2D,r.projection.camera=n.camera||new c.Camera2D,r}return i(t,e),t.prototype.fitViewtoViewport=function(e,t){if(h(this.props.camera)){var n=t.width,r=t.height,i={bottom:-r/2,far:1e7,left:-n/2,near:-100,right:n/2,top:r/2},s=1/this.pixelRatio,u=1/this.pixelRatio,c=this.props.camera;c.projectionOptions=Object.assign(c.projectionOptions,i),c.position=[t.width/(2*this.pixelRatio),t.height/(2*this.pixelRatio),c.position[2]],c.scale=[s,-u,1],c.lookAt(a.add3(c.position,[0,0,-1]),[0,1,0]),c.update(),this.projection.viewBounds=t,t.d=this,this.projection.screenBounds=new o.Bounds({height:this.viewBounds.height/this.pixelRatio,width:this.viewBounds.width/this.pixelRatio,x:this.viewBounds.x/this.pixelRatio,y:this.viewBounds.y/this.pixelRatio}),this.screenBounds.d=this}else h(this.props.camera)||console.warn("View2D does not support non-orthographic cameras.")},t.prototype.willUpdateProps=function(e){this.projection.camera=e.camera},t.defaultProps={key:"",camera:new c.Camera2D,viewport:{left:0,right:0,bottom:0,top:0}},t}(s.View);t.View2D=f},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.screenToWorld=function(e,t){var n=this.screenToView(e),r=t||[0,0];return r[0]=(n[0]-this.camera.control2D.offset[0]*this.camera.scale2D[0])/this.camera.scale2D[0],r[1]=(n[1]-this.camera.control2D.offset[1]*this.camera.scale2D[1])/this.camera.scale2D[1],r},t.prototype.screenRay=function(e){var t=this.screenToWorld(e);return[[t[0],t[1],0],[t[0],t[1],-1]]},t.prototype.worldToScreen=function(e,t){var n=[0,0];return n[0]=(e[0]*this.camera.scale2D[0]+this.camera.control2D.offset[0]*this.camera.scale2D[0])*this.pixelRatio,n[1]=(e[1]*this.camera.scale2D[1]+this.camera.control2D.offset[1]*this.camera.scale2D[1])*this.pixelRatio,this.viewToScreen(n,t)},t.prototype.viewToWorld=function(e,t){var n=t||[0,0],r=e;return n[0]=(r[0]-this.camera.control2D.offset[0]*this.camera.scale2D[0])/this.camera.scale2D[0],n[1]=(r[1]-this.camera.control2D.offset[1]*this.camera.scale2D[1])/this.camera.scale2D[1],n},t.prototype.worldToView=function(e,t){var n=t||[0,0];return n[0]=e[0]*this.camera.scale2D[0]+this.camera.control2D.offset[0]*this.camera.scale2D[0],n[1]=e[1]*this.camera.scale2D[1]+this.camera.control2D.offset[1]*this.camera.scale2D[1],n},t}(n(12).BaseProjection);t.Projection2D=o},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(187)),r(n(193)),r(n(200)),r(n(209)),r(n(216)),r(n(232)),r(n(236))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(188)),r(n(192))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(4),s=n(1),u=n(0),c=n(3),l=n(6);!function(e){e[e.NONE=0]="NONE",e[e.SCREEN_CURVE=1]="SCREEN_CURVE"}(o=t.ArcScaleType||(t.ArcScaleType={}));var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){for(var e,r,i=this.props.scaleType,a=this.props.animate||{},s=a.angle,c=a.angleOffset,l=a.center,h=a.radius,f=a.thickness,d=a.colorStart,p=a.colorEnd,g=((e={0:1})[302]=-1,e),v=((r={0:0})[302]=1,r),y=1,m=0;m<300;++m)g[m+1]=y,v[m+1]=Math.floor(m/2)/149,y*=-1;var b=i===o.NONE?n(189):n(190);return{fs:n(191),instanceAttributes:[{easing:l,name:t.attributeNames.center,size:u.InstanceAttributeSize.TWO,update:function(e){return e.center}},{easing:h,name:t.attributeNames.radius,size:u.InstanceAttributeSize.ONE,update:function(e){return[e.radius]}},{name:t.attributeNames.depth,size:u.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{easing:f,name:t.attributeNames.thickness,size:u.InstanceAttributeSize.TWO,update:function(e){return e.thickness}},{easing:s,name:t.attributeNames.angle,size:u.InstanceAttributeSize.TWO,update:function(e){return e.angle}},{easing:c,name:t.attributeNames.angleOffset,size:u.InstanceAttributeSize.ONE,update:function(e){return[e.angleOffset]}},{easing:d,name:t.attributeNames.colorStart,size:u.InstanceAttributeSize.FOUR,update:function(e){return e.colorStart}},{easing:p,name:t.attributeNames.colorEnd,size:u.InstanceAttributeSize.FOUR,update:function(e){return e.colorEnd}}],uniforms:[{name:"scaleFactor",size:u.UniformSize.ONE,update:function(e){return[1]}}],vertexAttributes:[{name:"vertex",size:u.VertexAttributeSize.THREE,update:function(e){return[g[e],v[e],300]}}],vertexCount:302,vs:b}},t.prototype.getMaterialOptions=function(){return Object.assign({},c.CommonMaterialOptions.transparentShapeBlending,{culling:a.GLSettings.Material.CullSide.NONE})},t.defaultProps={data:new s.InstanceProvider,key:"",scaleType:o.NONE},t.attributeNames={angle:"angle",angleOffset:"angleOffset",center:"center",colorEnd:"colorEnd",colorStart:"colorStart",depth:"depth",radius:"radius",thickness:"thickness"},t}(l.Layer2D);t.ArcLayer=h},function(e,t){e.exports="${import: arc}\nprecision highp float;\nvarying vec4 vertexColor;\nvoid main() {\nfloat startAngle = angle.x + angleOffset;\nfloat endAngle = angle.y + angleOffset;\nfloat widthStart = thickness.x;\nfloat widthEnd = thickness.y;\nfloat normal = vertex.x;\nfloat interpolationTime = vertex.y;\nfloat interpolationIncrement = 1.0 / vertex.z;\nvec2 currentPosition = arc(interpolationTime, center, radius, startAngle, endAngle);\nvec2 currentNormal = normalize(currentPosition - center);\nfloat lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;\nvec2 vertex = currentPosition + currentNormal * (normal * lineThickness);\nvertexColor = mix(colorStart, colorEnd, interpolationTime);\ngl_Position = clipSpace(vec3(vertex, depth));\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvec2 interpolation(float t, vec2 center, float radius, float start, float end) {\nfloat angle = (end - start) * t + start;\nreturn center + vec2(cos(angle) * radius, sin(angle) * radius);\n}\nvoid main() {\nfloat startAngle = angle.x;\nfloat endAngle = angle.y;\nfloat widthStart = thickness.x;\nfloat widthEnd = thickness.y;\nvec4 centerClip = clipSpace(vec3(center, depth));\nvec2 centerScreen = (centerClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nfloat normal = position.x;\nfloat interpolationTime = position.y;\nfloat interpolationIncrement = 1.0 / position.z;\nvec2 currentPosition = interpolation(interpolationTime, centerScreen, radius, startAngle, endAngle);\nvec2 currentNormal = normalize(currentPosition - centerScreen);\nfloat lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;\nvec2 vertex = currentPosition + currentNormal * (normal * lineThickness);\nvertexColor = mix(colorStart, colorEnd, interpolationTime);\nvertexColor *= vertexColor.a;\ngl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), centerClip.zw);\ngl_PointSize = 5.0;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\ngl_FragColor = vertexColor;\n}"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=function(e){function t(t){var n=e.call(this,t)||this;return n.angle=[0,Math.PI],n.colorEnd=[1,1,1,1],n.colorStart=[1,1,1,1],n.center=[0,0],n.depth=0,n.angleOffset=0,n.radius=1,n.thickness=[5,5],n.angle=t.angle||n.angle,n.colorEnd=t.colorEnd||n.colorEnd,n.colorStart=t.colorStart||n.colorStart,n.center=t.center||n.center,n.depth=t.depth||n.depth,n.radius=t.radius||n.radius,n.thickness=t.thickness||n.thickness,n}return i(t,e),o([a.observable],t.prototype,"angle",void 0),o([a.observable],t.prototype,"colorEnd",void 0),o([a.observable],t.prototype,"colorStart",void 0),o([a.observable],t.prototype,"center",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"angleOffset",void 0),o([a.observable],t.prototype,"radius",void 0),o([a.observable],t.prototype,"thickness",void 0),t}(n(11).Instance);t.ArcInstance=s},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(194)),r(n(199))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(1),s=n(0),u=n(3),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){var e=this.props,r=e.animate,i=void 0===r?{}:r,a=e.usePoints,u=void 0!==a&&a,c=e.opacity,l=void 0===c?function(){return 1}:c,h=i.center,f=i.radius,d=i.color,p={0:1,1:1,2:-1,3:1,4:-1,5:-1},g={0:-1,1:-1,2:-1,3:1,4:1,5:1},v=[{name:"normals",size:s.VertexAttributeSize.TWO,update:function(e){return[p[e],g[e]]}}];return{drawMode:u?o.GLSettings.Model.DrawMode.POINTS:o.GLSettings.Model.DrawMode.TRIANGLE_STRIP,fs:u?[{outputType:s.FragmentOutputType.COLOR,source:n(195)},{outputType:s.FragmentOutputType.GLOW,source:"\n              void main() {\n                ${out: glow} = color;\n              }\n              "}]:[{outputType:s.FragmentOutputType.COLOR,source:n(196)},{outputType:s.FragmentOutputType.GLOW,source:"\n              void main() {\n                ${out: glow} = color;\n              }\n              "}],instanceAttributes:[{easing:h,name:t.attributeNames.center,size:s.InstanceAttributeSize.TWO,update:function(e){return e.center}},{easing:f,name:t.attributeNames.radius,size:s.InstanceAttributeSize.ONE,update:function(e){return[e.radius]}},{name:t.attributeNames.depth,size:s.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{easing:d,name:t.attributeNames.color,size:s.InstanceAttributeSize.FOUR,update:function(e){return e.color}}],uniforms:[{name:"layerOpacity",size:s.UniformSize.ONE,update:function(e){return[l()]}}],vertexAttributes:u?void 0:v,vertexCount:u?0:6,vs:n(u?197:198)}},t.prototype.getMaterialOptions=function(){return u.CommonMaterialOptions.transparentShapeBlending},t.defaultProps={data:new a.InstanceProvider,key:""},t.attributeNames={center:"center",color:"color",depth:"depth",radius:"radius"},t}(n(6).Layer2D);t.CircleLayer=c},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nfloat circle(vec2 coord, float radius){\nvec2 dist = coord - vec2(0.5);\nreturn 1.0 - smoothstep(\nradius - (radius * edgeSharpness),\nradius + (radius * edgeSharpnessBase),\ndot(dist, dist) * 4.0\n);\n}\nvoid main() {\nfloat step_factor = circle(gl_PointCoord, 1.0);\n${out: color} = mix(\nvec4(0.0, 0.0, 0.0, 0.0),\nvertexColor,\nstep_factor\n);\nif (color.a == 0.0) discard;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nvarying vec2 pointCoord;\nfloat circle(vec2 coord, float radius){\nvec2 dist = coord - vec2(0.5);\nreturn 1.0 - smoothstep(\nradius - (radius * edgeSharpness),\nradius + (radius * edgeSharpnessBase),\ndot(dist, dist) * 4.0\n);\n}\nvoid main() {\nfloat step_factor = circle(pointCoord, 1.0);\n${out: color} = mix(\nvec4(0.0, 0.0, 0.0, 0.0),\nvertexColor,\nstep_factor\n);\nif (color.a == 0.0) discard;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nvoid main() {\nvertexColor = color;\nvertexColor.a *= layerOpacity;\nfloat size = radius * cameraScale2D.x;\nedgeSharpness = mix(0.8, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\nedgeSharpnessBase = mix(0.1, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\ngl_Position = clipSpace(vec3(center, depth));\ngl_PointSize = size * 2.0 * pixelRatio;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float edgeSharpnessBase;\nvarying vec2 pointCoord;\nvoid main() {\nvertexColor = color;\nvertexColor.a *= layerOpacity;\nfloat size = radius * cameraScale2D.x * pixelRatio;\nedgeSharpness = mix(0.8, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\nedgeSharpnessBase = mix(0.1, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));\npointCoord = (normals.xy + vec2(1.0, 1.0)) / 2.0;\nvec4 clipCenter = clipSpace(vec3(center, depth));\nvec2 screenCenter = (clipCenter.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nvec2 vertex = (normals.xy * size) + screenCenter;\ngl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), clipCenter.zw);\n}"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=function(e){function t(t){var n=e.call(this,t)||this;return n.color=[1,1,1,1],n.depth=0,n.radius=0,n.center=[0,0],n.color=t.color||n.color,n.radius=t.radius||n.radius,n.center=t.center||n.center,n.depth=t.depth||n.depth,n}return i(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),o([a.observable],t.prototype,"color",void 0),o([a.observable],t.prototype,"depth",void 0),o([a.observable],t.prototype,"radius",void 0),o([a.observable],t.prototype,"center",void 0),t}(n(11).Instance);t.CircleInstance=s},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(201)),r(n(208)),r(n(115))},function(e,t,n){"use strict";var r,i,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(0),u=n(3),c=n(6),l=n(115);var h=((i={})[l.EdgeType.LINE]=n(202),i[l.EdgeType.BEZIER]=n(203),i[l.EdgeType.BEZIER2]=n(204),i),f=n(205),d=n(206),p=n(207),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.initShader=function(){for(var e,n,r=this,i=this.props,o=i.animate,a=void 0===o?{}:o,c=i.scaleFactor,g=void 0===c?function(){return 1}:c,v=i.type,y=i.scaleType,m=void 0===y?l.EdgeScaleType.NONE:y,b=a.end,T=a.start,_=a.startColor,x=a.endColor,w=a.control,E=a.thickness,O=v===l.EdgeType.LINE?2:50,R=((e={0:1})[2*O+2]=-1,e),S=((n={0:0})[2*O+2]=1,n),A=1,M=0;M<2*O;++M)R[M+1]=A,S[M+1]=Math.floor(M/2)/(O-1),A*=-1;var I={interpolation:h[v]},P=u.shaderTemplate({options:I,required:{name:"Edge Layer",values:["interpolation"]},shader:m===l.EdgeScaleType.NONE?f:d,onToken:function(e,t){return e in I?t:"${"+e+"}"}});return{fs:p,instanceAttributes:[{easing:_,name:t.attributeNames.startColor,size:s.InstanceAttributeSize.FOUR,update:function(e){return e.startColor}},{easing:x,name:t.attributeNames.endColor,size:s.InstanceAttributeSize.FOUR,update:function(e){return e.endColor}},{easing:T,name:t.attributeNames.start,size:s.InstanceAttributeSize.TWO,update:function(e){return e.start}},{easing:b,name:t.attributeNames.end,size:s.InstanceAttributeSize.TWO,update:function(e){return e.end}},{easing:E,name:t.attributeNames.thickness,size:s.InstanceAttributeSize.TWO,update:function(e){return e.thickness}},{name:t.attributeNames.depth,size:s.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},v===l.EdgeType.LINE?{easing:w,name:t.attributeNames.control,size:s.InstanceAttributeSize.FOUR,update:function(e){return[0,0,0,0]}}:null,v===l.EdgeType.BEZIER?{easing:w,name:t.attributeNames.control,size:s.InstanceAttributeSize.FOUR,update:function(e){return[e.control[0][0],e.control[0][1],0,0]}}:null,v===l.EdgeType.BEZIER2?{easing:w,name:t.attributeNames.control,size:s.InstanceAttributeSize.FOUR,update:function(e){return[(t=e.control)[0][0],t[0][1],t[1][0],t[1][1]];var t}}:null],uniforms:[{name:"scaleFactor",size:s.UniformSize.ONE,update:function(e){return[g()]}},{name:"layerOpacity",size:s.UniformSize.ONE,update:function(e){return[void 0===r.props.opacity?1:r.props.opacity]}}],vertexAttributes:[{name:"vertex",size:s.VertexAttributeSize.THREE,update:function(e){return[R[e],S[e],2*O]}}],vertexCount:2*O+2,vs:P.shader}},t.prototype.getMaterialOptions=function(){return u.CommonMaterialOptions.transparentShapeBlending},t.defaultProps={broadphase:l.EdgeBroadphase.ALL,data:new a.InstanceProvider,key:"none",scaleType:l.EdgeScaleType.NONE,type:l.EdgeType.LINE},t.attributeNames={control:"control",depth:"depth",end:"end",endColor:"endColor",start:"start",startColor:"startColor",thickness:"thickness"},t}(c.Layer2D);t.EdgeLayer=g},function(e,t){e.exports="vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\nreturn p1 + (p2 - p1) * t;\n}"},function(e,t){e.exports="vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\nreturn (1.0 - t) * (1.0 - t) * p1 + 2.0 * t * (1.0 - t) * c1 + t * t * p2;\n}"},function(e,t){e.exports="vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\nfloat t1 = 1.0 - t;\nreturn pow(t1, 3.0) * p1 + 3.0 * t * pow(t1, 2.0) * c1 + 3.0 * pow(t, 2.0) * t1 * c2 + pow(t, 3.0) * p2;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\n${interpolation}\nvoid main() {\nfloat normal = vertex.x;\nfloat interpolationTime = vertex.y;\nfloat interpolationIncrement = 1.0 / vertex.z;\nvec2 currentPosition = interpolation(interpolationTime, start, end, control.xy, control.zw);\nvec2 prePosition = interpolation(interpolationTime - interpolationIncrement, start, end, control.xy, control.zw);\nvec2 nextPosition = interpolation(interpolationTime + interpolationIncrement, start, end, control.xy, control.zw);\nvec2 preLine = prePosition - currentPosition;\nvec2 nextLine = nextPosition - currentPosition;\nvec2 currentNormal = mix(\nnormalize(vec2(preLine.y, -preLine.x)),\nmix(\nnormalize(vec2(preLine.y, -preLine.x) + vec2(-nextLine.y, nextLine.x)),\nnormalize(vec2(-nextLine.y, nextLine.x)),\nfloat(vertex.x >= 1.0)\n),\nfloat(vertex.x > 0.0)\n);\nfloat lineThickness = mix(thickness.x, thickness.y, interpolationTime) / 2.0;\nvec2 vertexPos = currentPosition + currentNormal * (normal * lineThickness);\nvertexColor = mix(startColor, endColor, interpolationTime);\ngl_Position = clipSpace(vec3(vertexPos, depth));\ngl_PointSize = 5.0;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\n${interpolation}\nvoid main() {\nfloat normal = vertex.x;\nfloat interpolationTime = vertex.y;\nfloat interpolationIncrement = 1.0 / vertex.z;\nvec4 startClip = clipSpace(vec3(start, depth));\nvec4 endClip = clipSpace(vec3(end, depth));\nvec2 startScreen = (startClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nvec2 endScreen = (endClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nvec2 control1 = startScreen + vec2(control.x, -control.y) * scaleFactor;\nvec2 control2 = endScreen + vec2(control.z, -control.w) * scaleFactor;\nvec2 currentPosition = interpolation(interpolationTime, startScreen, endScreen, control1, control2);\nvec2 prePosition = interpolation(interpolationTime - interpolationIncrement, startScreen, endScreen, control1, control2);\nvec2 nextPosition = interpolation(interpolationTime + interpolationIncrement, startScreen, endScreen, control1, control2);\nvec2 preLine = prePosition - currentPosition;\nvec2 nextLine = nextPosition - currentPosition;\nvec2 currentNormal = mix(\nnormalize(vec2(preLine.y, -preLine.x)),\nmix(\nnormalize(vec2(preLine.y, -preLine.x) + vec2(-nextLine.y, nextLine.x)),\nnormalize(vec2(-nextLine.y, nextLine.x)),\nfloat(vertex.x >= 1.0)\n),\nfloat(vertex.x > 0.0)\n);\nfloat lineThickness = mix(thickness.x, thickness.y, interpolationTime) / 2.0;\nvec2 vertexPos = currentPosition + currentNormal * (-normal * lineThickness * scaleFactor);\nvertexColor = mix(startColor, endColor, interpolationTime);\ngl_Position = vec4((vertexPos / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), startClip.zw);\ngl_PointSize = 5.0;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\ngl_FragColor = vertexColor;\n}"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(11),s=n(20),u=n(12),c=function(e){function t(t){var n=e.call(this,t)||this;return n.control=[[0,0],[0,0]],n.depth=0,n.end=[0,0],n.endColor=[1,1,1,1],n.start=[0,0],n.startColor=[1,1,1,1],n.thickness=[1,1],n.startColor=t.startColor||n.startColor,n.endColor=t.endColor||n.endColor,n.control=t.control||n.control,n.depth=t.depth||n.depth,n.end=t.end||n.end,n.thickness=t.thickness||n.thickness,n.start=t.start||n.start,n}return i(t,e),Object.defineProperty(t.prototype,"length",{get:function(){var e=[this.end[0]-this.start[0],this.end[1]-this.start[1]];return Math.sqrt(e[0]*e[0]+e[1]*e[1])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"midpoint",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"perpendicular",{get:function(){var e=this.length;return[(this.end[1]-this.start[1])/e,-(this.end[0]-this.start[0])/e]},enumerable:!0,configurable:!0}),t.prototype.setEdgeThickness=function(e){this.thickness=[e,e]},t.prototype.setColor=function(e){this.startColor=u.copy4(e),this.endColor=u.copy4(e)},o([s.observable],t.prototype,"control",void 0),o([s.observable],t.prototype,"depth",void 0),o([s.observable],t.prototype,"end",void 0),o([s.observable],t.prototype,"endColor",void 0),o([s.observable],t.prototype,"start",void 0),o([s.observable],t.prototype,"startColor",void 0),o([s.observable],t.prototype,"thickness",void 0),t}(a.Instance);t.EdgeInstance=c},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(210)),r(n(215))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(23),u=n(0),c=n(3),l=n(29),h=n(6),f=n(211),d=n(212);function p(e){return e&&e.videoSrc}t.isVideoResource=p;var g=new Image;g.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.childProvider=new a.InstanceProvider,t.imageToResource=new Map,t.sourceToRequest=new Map,t.sourceToVideo=new Map,t.usingVideo=new Map,t.waitingForVideo=new Map,t.waitForVideoSource=new Map,t.originalOnReadyCallbacks=new Map,t}return i(t,e),t.prototype.childLayers=function(){return[c.createLayer(d.ImageRenderLayer,o(o({},this.props),{key:this.props.key+".image-render-layer"}))]},t.prototype.destroy=function(){var t=this;e.prototype.destroy.call(this),this.sourceToVideo.forEach((function(e){e.pause(),t.sourceToVideo.clear(),t.waitingForVideo.clear(),t.waitForVideoSource.clear()}))},t.prototype.draw=function(){var e=this.resolveChanges(!0);if(this.updateAnimationState(),!(e.length<=0)){this.propertyIds||(this.propertyIds=this.getInstanceObservableIds(e[0][0],["source"]));for(var t=this.propertyIds.source,n=0,r=e.length;n<r;++n){var i=e[n],o=i[0],a=i[1],l=i[2];switch(a){case u.InstanceDiffType.CHANGE:if(void 0!==l[t]){var h=this.imageToResource.get(o),f=this.getAtlasSource(o);if(f===h)break;if(h instanceof HTMLVideoElement){if(y=this.waitForVideoSource.get(o))this.waitForVideoSource.delete(o),(m=this.waitingForVideo.get(y))&&m.delete(o);(b=this.usingVideo.get(h.getAttribute("data-source")||""))||(b=new Set),b.delete(o),b.size<=0&&this.sourceToVideo.delete(h.getAttribute("data-source")||""),o.onReady=this.originalOnReadyCallbacks.get(o)}if(p(o.source))this.prepareVideo(o,o.source),f=this.getAtlasSource(o),c.mapInjectDefault(this.usingVideo,o.source.videoSrc,new Set).add(o);if(this.imageToResource.set(o,f),this.resource.request(this,o,s.atlasRequest({key:this.props.atlas||"",disposeResource:!0,source:h})),f)(!(d=this.sourceToRequest.get(f))||d.texture&&!d.texture.isValid)&&(d=s.atlasRequest({key:this.props.atlas||"",source:f,rasterizationScale:this.props.rasterizationScale}),this.sourceToRequest.set(f,d)),o.request=d,this.resource.request(this,o,d)}break;case u.InstanceDiffType.INSERT:if(o.source){var d,g=this.getAtlasSource(o);if(p(o.source))this.prepareVideo(o,o.source),g=this.getAtlasSource(o),c.mapInjectDefault(this.usingVideo,o.source.videoSrc,new Set).add(o);(!(d=this.sourceToRequest.get(g))||d.texture&&!d.texture.isValid)&&(d=s.atlasRequest({key:this.props.atlas||"",source:g,rasterizationScale:this.props.rasterizationScale}),this.sourceToRequest.set(g,d)),o.request=d}break;case u.InstanceDiffType.REMOVE:var v=this.getAtlasSource(o);if(this.imageToResource.delete(o),p(o.source)){var y,m,b;if(y=this.waitForVideoSource.get(o))this.waitForVideoSource.delete(o),(m=this.waitingForVideo.get(y))&&m.delete(o);(b=this.usingVideo.get(o.source.videoSrc))||(b=new Set),b.delete(o),b.size<=0&&this.sourceToVideo.delete(o.source.videoSrc),this.originalOnReadyCallbacks.delete(o)}this.resource.request(this,o,s.atlasRequest({key:this.props.atlas||"",disposeResource:!0,source:v}))}}var T=[];this.usingVideo.forEach((function(e,t){e.size<=0&&T.push(t)}));for(n=0,r=T.length;n<r;++n){var _=T[n];this.usingVideo.delete(_),this.sourceToVideo.delete(_)}}},t.prototype.getAtlasSource=function(e){return p(e.source)?this.sourceToVideo.get(e.source.videoSrc)||g:e.source},t.prototype.prepareVideo=function(e,t){var n=this,r=this.sourceToVideo.get(t.videoSrc);if(this.originalOnReadyCallbacks.get(e)||this.originalOnReadyCallbacks.set(e,e.onReady),r){var i=this.waitingForVideo.get(t.videoSrc);if(i)i.add(e),this.waitForVideoSource.set(e,t.videoSrc),e.onReady=void 0,e.source=g,e.videoLoad=function(){r.load(),t.autoPlay&&r.play()};else{var o=this.originalOnReadyCallbacks.get(e)||e.onReady;if(!o)return;e.onReady=function(e){o(e,r)}}}else{var a=document.createElement("video");this.sourceToVideo.set(t.videoSrc,a),a.setAttribute("data-source",t.videoSrc),f.debugVideoEvents(a);var s=new l.PromiseResolver,u=new l.PromiseResolver,h=function(){a.removeEventListener("loadedmetadata",p),a.removeEventListener("loadeddata",d),a.removeEventListener("error",v),n.waitingForVideo.delete(t.videoSrc),n.waitForVideoSource.delete(e)},d=function(){u.resolve()},p=function(){s.resolve()},v=function(e){var t;e.path&&e.path[0]&&(t=e.path[0].error),e.originalTarget&&(t=e.originalTarget.error),console.warn("There was an error loading the video resource to the atlas texture context"),console.warn(t),s.reject({}),u.reject({})};a.addEventListener("loadedmetadata",p),a.addEventListener("loadeddata",d),a.addEventListener("error",v),e.onReady=void 0,c.mapInjectDefault(this.waitingForVideo,t.videoSrc,new Set).add(e),this.waitForVideoSource.set(e,t.videoSrc),e.source=g,e.videoLoad=function(){a.load(),t.autoPlay&&a.play()},a.muted=!0,a.src=t.videoSrc,Promise.all([s.promise,u.promise]).then((function(){a.currentTime=0,t.autoPlay&&a.play();var e=n.waitingForVideo.get(t.videoSrc);e&&e.forEach((function(e){e.source=t,e.onReady=n.originalOnReadyCallbacks.get(e)})),h()})).catch((function(){h()}))}},t.prototype.updateAnimationState=function(){var e=!1;this.sourceToVideo.forEach((function(t){t.paused||(e=!0)})),this.isAnimationContinuous=this.usingVideo.size>0&&e},t.prototype.initShader=function(){return null},t.defaultProps={atlas:"default",key:"",data:new a.InstanceProvider},t}(h.Layer2D);t.ImageLayer=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5)("video");t.debugVideoEvents=function(e){r.enabled&&(e.addEventListener("abort",(function(){return r("abort")})),e.addEventListener("canplay",(function(){return r("canplay")})),e.addEventListener("canplaythrough",(function(){return r("canplaythrough")})),e.addEventListener("durationchange",(function(){return r("durationchange")})),e.addEventListener("emptied",(function(){return r("emptied")})),e.addEventListener("ended",(function(){return r("ended")})),e.addEventListener("error",(function(){return r("error")})),e.addEventListener("loadeddata",(function(){return r("loadeddata")})),e.addEventListener("loadedmetadata",(function(){return r("loadedmetadata")})),e.addEventListener("loadstart",(function(){return r("loadstart")})),e.addEventListener("pause",(function(){return r("pause")})),e.addEventListener("play",(function(){return r("play")})),e.addEventListener("playing",(function(){return r("playing")})),e.addEventListener("progress",(function(){return r("progress")})),e.addEventListener("ratechange",(function(){return r("ratechange")})),e.addEventListener("seeked",(function(){return r("seeked")})),e.addEventListener("seeking",(function(){return r("seeking")})),e.addEventListener("stalled",(function(){return r("stalled")})),e.addEventListener("suspend",(function(){return r("suspend")})),e.addEventListener("timeupdate",(function(){return r("timeupdate")})),e.addEventListener("volumechange",(function(){return r("volumechange")})),e.addEventListener("waiting",(function(){return r("waiting")})))}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(0),s=n(62),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){var e=this,r=this.props.animate||{},i=r.tint,o=r.location,s=r.size,u={0:1,1:1,2:-1,3:1,4:-1,5:-1},c={0:0,1:0,2:0,3:1,4:1,5:1};return{fs:n(213),instanceAttributes:[{easing:o,name:t.attributeNames.location,size:a.InstanceAttributeSize.TWO,update:function(e){return e.origin}},{name:t.attributeNames.anchor,size:a.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x||0,e.anchor.y||0]}},{easing:s,name:t.attributeNames.size,size:a.InstanceAttributeSize.TWO,update:function(e){return[e.width,e.height]}},{name:t.attributeNames.depth,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:t.attributeNames.scaling,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{name:t.attributeNames.texture,resource:{key:function(){return e.props.atlas||""},name:"imageAtlas"},update:function(t){return t.source,t.request?e.resource.request(e,t,t.request):(console.warn("An image utilizing the image-render-layer does not have its request specified yet.","The image-render-layer does NOT manage requests and should be handled before this layer deals with the instance"),[0,0,0,0])}},{easing:i,name:t.attributeNames.tint,size:a.InstanceAttributeSize.FOUR,update:function(e){return e.tint}}],uniforms:[{name:"scaleFactor",size:a.UniformSize.ONE,update:function(e){return[1]}}],vertexAttributes:[{name:"normals",size:a.VertexAttributeSize.TWO,update:function(e){return[u[e],c[e]]}}],vertexCount:6,vs:n(214)}},t.prototype.getMaterialOptions=function(){return s.CommonMaterialOptions.transparentImageBlending},t.defaultProps={key:"",data:new o.InstanceProvider},t.attributeNames={location:"location",anchor:"anchor",size:"size",depth:"depth",scaling:"scaling",texture:"texture",tint:"tint"},t}(n(6).Layer2D);t.ImageRenderLayer=u},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\ngl_FragColor = texture2D(imageAtlas, texCoord) * vertexColor;\ngl_FragColor = gl_FragColor * gl_FragColor.a;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec3 screenSize = cameraSpaceSize(vec3(size, 1.0));\nbool largerOnScreen = screenSize.y > size.y;\nfloat useScaleMode = float(\n(\nscaling == 3.0 ||\n(largerOnScreen && scaling == 2.0)\n) &&\nscaling != 1.0\n);\nfloat unequalZooms = float(cameraScale2D.x != cameraScale2D.y);\nfloat normal = normals.x;\nfloat side = normals.y;\nvec2 worldAnchor = location + anchor;\ntexCoord = texture.xy + ((texture.zw - texture.xy) * vec2(side, float(normal == -1.0)));\nvertexColor = tint;\nvec2 adjustedSize = mix(\nsize,\n(size * cameraScale2D.yx),\nunequalZooms\n);\nvec2 adjustedAnchor = mix(\nanchor,\n(anchor * cameraScale2D.yx),\nunequalZooms\n);\nvec2 vertex = vec2(side, float(normal == 1.0)) * adjustedSize + location - adjustedAnchor;\nfloat imageScreenScale = mix(\nscreenSize.y / adjustedSize.y,\nscreenSize.x / adjustedSize.x,\nfloat((cameraScale2D.x < 1.0) || (cameraScale2D.x > 1.0))\n);\nvec2 anchorToVertex = vertex - location;\nvertex = mix(\nvertex,\n(anchorToVertex / imageScreenScale) + location,\nuseScaleMode\n);\ngl_Position = clipSpace(vec3(vertex, depth));\n}"},function(e,t,n){"use strict";var r,i,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),u=n(11),c=n(0),l=n(19),h=Math.max,f=((i={})[l.AnchorType.TopLeft]=function(e,t){e.x=-e.padding,e.y=-e.padding},i[l.AnchorType.TopMiddle]=function(e,t){e.x=t.width/2,e.y=-e.padding},i[l.AnchorType.TopRight]=function(e,t){e.x=t.width+e.padding,e.y=-e.padding},i[l.AnchorType.MiddleLeft]=function(e,t){e.x=-e.padding,e.y=t.height/2},i[l.AnchorType.Middle]=function(e,t){e.x=t.width/2,e.y=t.height/2},i[l.AnchorType.MiddleRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height/2},i[l.AnchorType.BottomLeft]=function(e,t){e.x=-e.padding,e.y=t.height+e.padding},i[l.AnchorType.BottomMiddle]=function(e,t){e.x=t.width/2,e.y=t.height+e.padding},i[l.AnchorType.BottomRight]=function(e,t){e.x=t.width+e.padding,e.y=t.height+e.padding},i[l.AnchorType.Custom]=function(e,t){e.x=e.x||0,e.y=e.y||0},i),d=function(e){function t(t){var n=e.call(this,t)||this;return n.tint=[0,0,0,1],n.depth=0,n.height=1,n.origin=[0,0],n.scaling=l.ScaleMode.BOUND_MAX,n.width=1,n.sourceWidth=0,n.sourceHeight=0,n._anchor={padding:0,type:l.AnchorType.TopLeft,x:0,y:0},n.videoLoad=c.NOOP,n.depth=t.depth||n.depth,n.tint=t.tint||n.tint,n.scaling=t.scaling||n.scaling,n.origin=t.origin||n.origin,n.width=t.width||1,n.height=t.height||1,n.source=t.source,n.onReady=t.onReady,t.anchor&&n.setAnchor(t.anchor),n}return o(t,e),Object.defineProperty(t.prototype,"maxSize",{get:function(){return h(this.width,this.height)},set:function(e){var t=this.width/this.height;this.width=e*t,this.height=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},enumerable:!0,configurable:!0}),t.prototype.resourceTrigger=function(){this.source=this.source,this.request&&this.request.texture&&(this.sourceWidth=this.request.texture.pixelWidth,this.sourceHeight=this.request.texture.pixelHeight),this.onReady&&this.onReady(this)},t.prototype.setAnchor=function(e){var t={padding:e.padding||0,type:e.type,x:e.x||0,y:e.y||0};f[t.type](t,this),this._anchor=t},a([s.observable],t.prototype,"tint",void 0),a([s.observable],t.prototype,"depth",void 0),a([s.observable],t.prototype,"height",void 0),a([s.observable],t.prototype,"origin",void 0),a([s.observable],t.prototype,"scaling",void 0),a([s.observable],t.prototype,"source",void 0),a([s.observable],t.prototype,"width",void 0),a([s.observable],t.prototype,"_anchor",void 0),t}(u.Instance);t.ImageInstance=d},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(116)),r(n(65)),r(n(117)),r(n(118)),r(n(121)),r(n(227))},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\ngl_FragColor = texColor * vertexColor;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\ngl_FragColor = texColor * vertexColor;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 scale = fontScale * cameraScale2D.xy;\nfloat scaleBy = max(scale.x, scale.y) / maxScale;\nvec2 pushOut = normals * glyphSize * fontScale;\nfloat vx = mix(\n(origin.x + padding.x + offset.x + pushOut.x),\norigin.x + anchor.x + (padding.x - anchor.x + offset.x + pushOut.x) / scaleBy,\nfloat(scale.x >= maxScale)\n);\nfloat vy = mix(\n(origin.y + padding.y + offset.y + pushOut.y),\norigin.y + anchor.y + (padding.y - anchor.y + offset.y + pushOut.y) / scaleBy,\nfloat(scale.y >= maxScale)\n);\nvec3 position = vec3(vec2(vx, vy), depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 scale = fontScale * cameraScale2D.xy;\nfloat scaleBy = max(scale.x, scale.y) / maxScale;\nvec2 pushOut = normals * glyphSize * fontScale;\nfloat vx = mix(\n(-anchor.x + offset.x + pushOut.x),\n(-anchor.x + offset.x + pushOut.x) / scaleBy,\nfloat(scale.x >= maxScale)\n);\nfloat vy = mix(\n(-anchor.y + offset.y + pushOut.y),\n(-anchor.y + offset.y + pushOut.y) / scaleBy,\nfloat(scale.y >= maxScale)\n);\nvec3 position = vec3(origin + padding + vec2(vx, vy), depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\ngl_FragColor = texColor * vertexColor;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\ngl_FragColor = texColor * vertexColor;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 pushOut = normals * glyphSize * fontScale;\nvec3 position = vec3(origin + anchor + (padding - anchor + offset + pushOut) / cameraScale2D.xy , depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 pushOut = normals * glyphSize * fontScale;\nvec3 position = vec3(origin + padding + (-anchor + offset + pushOut) / cameraScale2D.xy, depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec4 texColor = texture2D(fontMap, texCoord);\nif (texColor.r <= 0.0) discard;\ntexColor.a = texColor.r;\ngl_FragColor = texColor * vertexColor;\n}"},function(e,t){e.exports="varying vec4 vertexColor;\nvarying vec2 texCoord;\nvoid main() {\nvec2 pushOut = normals * glyphSize * fontScale;\nvec3 position = vec3(origin + padding + offset + pushOut, depth);\ngl_Position = clipSpace(position);\ntexCoord = texture.xy + (texture.zw - texture.xy) * normals;\nvertexColor = color * color.a;\n}"},function(e,t,n){"use strict";var r,i,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(35),s=n(2),u=n(23),c=n(0),l=n(18),h=n(19),f=n(6),d=n(228),p=n(229),g=n(65),v=n(116),y=n(121),m=((i={})[h.AnchorType.TopLeft]=function(e){return[0,0]},i[h.AnchorType.TopMiddle]=function(e){return[e.maxWidth/2,0]},i[h.AnchorType.TopRight]=function(e){return[e.maxWidth,0]},i[h.AnchorType.MiddleLeft]=function(e){return[0,e.maxHeight/2]},i[h.AnchorType.Middle]=function(e){return[e.maxWidth/2,e.maxHeight/2]},i[h.AnchorType.MiddleRight]=function(e){return[e.maxWidth,e.maxHeight/2]},i[h.AnchorType.BottomLeft]=function(e){return[0,e.maxHeight]},i[h.AnchorType.BottomMiddle]=function(e){return[e.maxWidth/2,e.maxHeight]},i[h.AnchorType.BottomRight]=function(e){return[e.maxWidth,e.maxHeight]},i[h.AnchorType.Custom]=function(e){return[e.anchor.x||0,e.anchor.y||0]},i);function b(e,t){for(var n=Number.MAX_SAFE_INTEGER,r=0,i=e.length;r<i;r++){var o=e[r],a=t.get(o);0===a?n=0:a&&a<n&&(n=a)}return n===Number.MAX_SAFE_INTEGER?0:n}function T(e,t,n){for(var r=[],i=n.fontMap?n.fontMap.fontSource.size:t.fontSize,o=t.fontSize/i,a="",u=0,c=[0,0],l=0,h=e.text.length;l<h;l++){var f=e.text[l];if(n.fontMap){var d=[0,0];a&&(d=n.fontMap.kerning[a][f]||[0,0]),c=s.add2(c,s.scale2(d,o)),0!==l&&(c=s.add2(c,[t.letterSpacing,0]));var p=n.fontMap.glyphMap[f];u=c[0]+p.pixelWidth*o,r.push(u),a=f}}return r}var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.providers={labels:new a.InstanceProvider,borders:new a.InstanceProvider},t.fullUpdate=!1,t.areaToLabels=new Map,t.areaToLines=new Map,t.areaWaitingOnLabel=new Map,t.areaTokerningRequest=new Map,t.areaToWords=new Map,t.labelsInLine=[],t.handleLabelReady=function(e){if(e.parentTextArea){var n=e.parentTextArea,r=t.areaWaitingOnLabel.get(n);if(r&&r.has(e)&&(r.delete(e),r.size<=0)){n.active=!0;var i=n.onReady;i&&i(n)}}else delete e.onReady},t}return o(t,e),t.prototype.childLayers=function(){var e=this.props.animateLabel||{},t=this.props.animateBorder||{},n=this.props.scaling;return[l.createLayer(v.LabelLayer,{animate:e,customGlyphLayer:this.props.customGlyphLayer,data:this.providers.labels,key:this.id+".labels",resourceKey:this.props.resourceKey,scaleMode:n,inTextArea:!0}),l.createLayer(p.BorderLayer,{animate:{color:t.color,location:t.location},data:this.providers.borders,key:this.id+".border"})]},t.prototype.draw=function(){var e=this.resolveChanges();if(!(e.length<=0)){if(!this.propertyIds){var t=e[0][0];this.propertyIds=this.getInstanceObservableIds(t,["active","alignment","borderWidth","color","fontSize","hasBorder","letterSpacing","lineHeight","maxHeight","maxWidth","origin","padding","text","wordWrap"])}for(var n=this.propertyIds,r=n.active,i=n.alignment,o=n.borderWidth,a=n.color,s=n.fontSize,u=n.hasBorder,l=n.letterSpacing,h=n.lineHeight,f=n.maxHeight,d=n.maxWidth,p=n.origin,v=n.padding,y=n.text,m=n.wordWrap,b=0,T=e.length;b<T;++b){var _=e[b],x=(t=_[0],_[1]),w=_[2];switch(x){case c.InstanceDiffType.CHANGE:if(!this.areaToLabels.get(t)){this.insert(t);continue}void 0!==w[y]?(this.clear(t),this.updateLabels(t),this.layout(t)):void 0!==w[r]&&(t.active?(this.layout(t),this.showLabels(t)):this.hideLabels(t)),void 0!==w[i]&&(this.clear(t),this.updateLabels(t),this.layoutLabels(t)),void 0!==w[a]&&this.updateLabelColors(t),void 0!==w[p]&&this.updateLabelOrigins(t),void 0!==w[s]&&this.updateLabelFontSizes(t),void 0!==w[m]&&this.updateLabelLineWrap(t),void 0!==w[h]&&this.updateLabelLineHeight(t),void 0!==w[d]&&this.updateTextAreaSize(t),void 0!==w[f]&&this.updateTextAreaSize(t),void 0!==w[v]&&this.updateTextAreaSize(t),void 0!==w[o]&&this.updateBorderWidth(t),void 0!==w[u]&&this.updateBorder(t),void 0!==w[l]&&this.updateLetterSpacing(t);break;case c.InstanceDiffType.INSERT:this.insert(t);break;case c.InstanceDiffType.REMOVE:var E=this.areaToLabels.get(t);if(E){for(var O=0,R=E.length;O<R;++O){var S=E[O];S instanceof g.LabelInstance&&this.providers.labels.remove(S)}this.areaToLabels.delete(t),this.areaWaitingOnLabel.delete(t)}}}}},t.prototype.insert=function(e){this.layout(e),this.updateLabels(e)},t.prototype.hideLabels=function(e){var t=this.areaToLabels.get(e);if(t)for(var n=0,r=t.length;n<r;++n){var i=t[n];i instanceof g.LabelInstance&&this.providers.labels.remove(i)}},t.prototype.initShader=function(){return null},t.prototype.clear=function(e){for(var t=e.labels,n=0,r=t.length;n<r;n++){(o=t[n])instanceof g.LabelInstance&&this.providers.labels.remove(o)}e.labels=[];var i=e.newLabels;for(n=0,r=i.length;n<r;n++){var o;(o=i[n])instanceof g.LabelInstance&&this.providers.labels.remove(o)}e.newLabels=[],this.areaToLabels.delete(e),this.areaWaitingOnLabel.delete(e),this.areaToWords.delete(e)},t.prototype.seperateLabel=function(e,t,n,r,i,o,a,s,u){var c=e.padding[0],l=e.padding[1]||0,f=e.padding[2]||0,d=e.padding[3]||0,p=e.maxWidth-d-l,v=e.maxHeight-c-f,T=e.origin[0],_=e.origin[1];t.active=!1;var x=r.substring(0,i+1),w=b(x,n),E=m[e.anchor.type](e),O=new g.LabelInstance({anchor:{padding:0,type:h.AnchorType.Custom,paddingDirection:[o+d,a+c+w],x:E[0],y:E[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[T,_],text:x});if(O.size=[u[i],t.size[1]],this.providers.labels.add(O),e.newLabels.push(O),this.labelsInLine.push(O),o+=O.getWidth()+s,e.wordWrap===y.WordWrap.CHARACTER||e.wordWrap===y.WordWrap.WORD){if(this.setTextAlignment(o,a,s,p,e.alignment),o=0,(a+=e.lineHeight)+e.lineHeight<=v){for(var R=u[u.length-1]-u[i];R>p&&a+e.lineHeight<=v;){for(var S=u.length-1;u[S]-u[i]>p;)S--;var A=r.substring(i+1,S+1),M=b(A,n),I=new g.LabelInstance({anchor:{padding:0,type:h.AnchorType.Custom,paddingDirection:[o+d,a+c+M],x:E[0],y:E[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[T,_],text:A});I.size=[u[S]-u[i],t.size[1]],o+=I.getWidth()+s,this.labelsInLine.push(I),this.providers.labels.add(I),e.newLabels.push(I),this.setTextAlignment(o,a,s,p,e.alignment),o=0,a+=e.lineHeight,i=S,R=u[u.length-1]-u[i]}if(a+e.lineHeight<=v){var P=r.substring(i+1),L=b(P,n),C=new g.LabelInstance({anchor:{padding:0,type:h.AnchorType.Custom,paddingDirection:[o+d,a+c+L],x:E[0],y:E[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[T,_],text:P});C.size=[u[u.length-1]-u[i],t.size[1]],this.labelsInLine.push(C);for(var B=[],F=i+1;F<u.length;F++)B.push(u[F]-u[i]);this.providers.labels.add(C),e.newLabels.push(C),o+=C.getWidth()+s}}}else e.wordWrap===y.WordWrap.NONE&&(o+=O.getWidth()+s);return[o,a]},t.prototype.updateLabelLineWrap=function(e){var t=this.areaToLabels.get(e);if(t){for(var n=0,r=t.length;n<r;++n){(i=t[n])instanceof g.LabelInstance&&(i.active=!0)}for(n=0,r=e.newLabels.length;n<r;++n){var i=e.newLabels[n];this.providers.labels.remove(i)}e.newLabels=[],this.layoutLabels(e)}},t.prototype.updateLabelLineHeight=function(e){var t=this.areaToLabels.get(e);if(t){for(var n=0,r=t.length;n<r;++n){(i=t[n])instanceof g.LabelInstance&&(i.active=!0)}for(n=0,r=e.newLabels.length;n<r;++n){var i=e.newLabels[n];this.providers.labels.remove(i)}e.newLabels=[],this.layoutLabels(e)}},t.prototype.updateTextAreaSize=function(e){var t=this.areaToLabels.get(e);if(t){for(var n=0,r=t.length;n<r;++n){(i=t[n])instanceof g.LabelInstance&&(i.active=!0)}for(n=0,r=e.newLabels.length;n<r;++n){var i=e.newLabels[n];this.providers.labels.remove(i)}e.newLabels=[];for(n=0,r=e.borders.length;n<r;++n){var o=e.borders[n];this.providers.borders.remove(o)}e.borders=[],this.layoutBorder(e),this.layoutLabels(e)}},t.prototype.updateBorderWidth=function(e){for(var t=0,n=e.borders.length;t<n;++t){var r=e.borders[t];this.providers.borders.remove(r)}e.borders=[],this.layoutBorder(e)},t.prototype.updateBorder=function(e){if(e.hasBorder)this.layoutBorder(e);else{for(var t=0,n=e.borders.length;t<n;++t){var r=e.borders[t];this.providers.borders.remove(r)}e.borders=[]}},t.prototype.updateLetterSpacing=function(e){this.clear(e),this.updateLabels(e),this.layout(e)},t.prototype.setTextAlignment=function(e,t,n,r,i){if(e-n<r&&i!==y.TextAlignment.LEFT){var o=r-e+n,a=i===y.TextAlignment.RIGHT?o:o/2;this.labelsInLine.forEach((function(e){var n=e.anchor;e.anchor={padding:n.padding,type:h.AnchorType.Custom,paddingDirection:[(n.paddingDirection?n.paddingDirection[0]:0)+a,n.paddingDirection?n.paddingDirection[1]:t],x:n.x,y:n.y}}))}this.labelsInLine=[]},t.prototype.layoutBorder=function(e){if(e.hasBorder){var t=this.areaTokerningRequest.get(e);if(!t)return;var n=t.fontMap?t.fontMap.fontSource.size:e.fontSize,r=e.fontSize/n,i=this.props.scaling,o=e.borderWidth,a=new d.BorderInstance({color:e.color,fontScale:r,scaling:i,size:[e.maxWidth+2*o,o],textAreaOrigin:e.origin,textAreaAnchor:m[e.anchor.type](e),position:[-o,-o]}),s=new d.BorderInstance({color:e.color,fontScale:r,scaling:i,size:[o,e.maxHeight+2*o],textAreaOrigin:e.origin,textAreaAnchor:m[e.anchor.type](e),position:[-o,-o]}),u=new d.BorderInstance({color:e.color,fontScale:r,scaling:i,size:[o,e.maxHeight+2*o],textAreaOrigin:e.origin,textAreaAnchor:m[e.anchor.type](e),position:[e.maxWidth,-o]}),c=new d.BorderInstance({color:e.color,fontScale:r,scaling:i,size:[e.maxWidth+2*o,o],textAreaOrigin:e.origin,textAreaAnchor:m[e.anchor.type](e),position:[-o,e.maxHeight]});this.providers.borders.add(a),this.providers.borders.add(s),this.providers.borders.add(u),this.providers.borders.add(c),e.borders.push(a),e.borders.push(s),e.borders.push(u),e.borders.push(c)}},t.prototype.layoutLabels=function(e){var t=this.areaTokerningRequest.get(e);if(t){var n=e.padding[0],r=e.padding[1]||0,i=e.padding[2]||0,o=e.padding[3]||0,a=e.maxWidth-o-r,s=e.maxHeight-n-i,u=e.origin[0],c=e.origin[1],l=0;if(e.spaceWidth)l=e.spaceWidth;else{if(t.fontMap){var f=t.fontMap.fontSource.size,d=e.fontSize/f;l=t.fontMap.spaceWidth*d}else l=this.props.whiteSpaceKerning||e.fontSize/2;e.spaceWidth=l}var p=function(e,t){var n=new Map;if(t.fontMap){for(var r=t.fontMap.fontSource.size,i=e.fontSize/r,o=t.fontMap,a=e.text.replace(/\s/g,""),s=Number.MAX_SAFE_INTEGER,u=0,c=void 0,l="",h=0,f=a.length;h<f;++h){var d=a[h];c=0,l&&(c=o.kerning[l][d][1]||0),u+=c*i,n.set(d,u),s=Math.min(u,s),l=d}n.forEach((function(e,t){n.set(t,e-s)}))}return n}(e,t),v=0,_=0;this.labelsInLine=[];for(var x=0,w=e.labels.length;x<w;++x){var E=e.labels[x];if(E instanceof g.LabelInstance){var O=E.getWidth(),R=b(E.text,p),S=T(E,e,t);if(_+e.lineHeight<=s&&S[0]<=a)if(v+O<=a){E.origin=[u,c];var A=m[e.anchor.type](e);E.anchor={padding:0,paddingDirection:[v+o,_+n+R],type:h.AnchorType.Custom,x:A[0],y:A[1]},v+=O+l,this.labelsInLine.push(E),v>=a&&e.wordWrap===y.WordWrap.CHARACTER&&x+1<w&&e.labels[x+1]!==y.NewLineCharacterMode.NEWLINE&&(this.setTextAlignment(v,_,l,a,e.alignment),v=0,_+=e.lineHeight)}else if(e.wordWrap===y.WordWrap.WORD&&E.getWidth()<=e.maxWidth)if(this.setTextAlignment(v,_,l,a,e.alignment),v=0,(_+=e.lineHeight)+e.lineHeight<=s){E.origin=[u,c];A=m[e.anchor.type](e);E.anchor={padding:0,paddingDirection:[v+o,_+n+R],type:h.AnchorType.Custom,x:A[0],y:A[1]},this.labelsInLine.push(E),v+=E.getWidth()+l}else E.active=!1;else{for(var M=a-v,I=S.length-1,P=E.text;S[I]>M;)I--;if(I>=0)v=(L=this.seperateLabel(e,E,p,P,I,v,_,l,S))[0],_=L[1];else if(e.wordWrap===y.WordWrap.CHARACTER||e.wordWrap===y.WordWrap.WORD)if(this.setTextAlignment(v,_,l,a,e.alignment),v=0,(_+=e.lineHeight)+e.lineHeight<s)if(v+E.getWidth()<=a){E.origin=[u,c];A=m[e.anchor.type](e);E.anchor={padding:0,paddingDirection:[v+o,_+n+R],type:h.AnchorType.Custom,x:A[0],y:A[1]},this.labelsInLine.push(E),(v+=E.getWidth()+l)>=a&&x+1<w&&e.labels[x+1]!==y.NewLineCharacterMode.NEWLINE&&(this.setTextAlignment(v,_,l,a,e.alignment),v=0,_+=e.lineHeight)}else{for(var L,C=a-v,B=S.length-1,F=E.text;S[B]>C;)B--;if(B>=0)v=(L=this.seperateLabel(e,E,p,F,B,v,_,l,S))[0],_=L[1]}else E.active=!1;else e.wordWrap===y.WordWrap.NONE&&(E.active=!1)}else E.active=!1}else E===y.NewLineCharacterMode.NEWLINE&&(this.setTextAlignment(v,_,l,a,e.alignment),v=0,_+=e.lineHeight)}this.setTextAlignment(v,_,l,a,e.alignment)}},t.prototype.layout=function(e){this.updateKerning(e);var t=this.areaTokerningRequest.get(e);if(t&&t.fontMap){var n=this.areaWaitingOnLabel.get(e);if(!(n&&n.size>0)&&e.active){var r=this.areaToLabels.get(e);r&&0!==r.length&&(this.updateLabels(e),this.layoutBorder(e),this.layoutLabels(e))}}},t.prototype.updateKerning=function(e){var t=this.areaTokerningRequest.get(e),n=e.text;if(!t){var r={fontSize:e.fontSize,text:e.text,letterSpacing:e.letterSpacing};return t=u.fontRequest({character:"",key:this.props.resourceKey||"",kerningPairs:[n],metrics:r}),e.preload?(e.resourceTrigger=function(){e.onReady&&e.onReady(e)},this.resource.request(this,e,t)):(this.resource.request(this,e,t),this.areaTokerningRequest.set(e,t)),!1}return t.kerningPairs&&t.kerningPairs.indexOf(n)>-1?Boolean(t.fontMap):!(!t.fontMap||t.fontMap.supportsKerning(n))&&(this.areaTokerningRequest.delete(e),t=void 0,!0)},t.prototype.managesInstance=function(e){return Boolean(this.areaToLabels.get(e))},t.prototype.showLabels=function(e){var t=this.areaToLabels.get(e);if(t)for(var n=0,r=t.length;n<r;++n){var i=t[n];i instanceof g.LabelInstance&&this.providers.labels.add(i)}},t.prototype.updateLabels=function(e){var t=this.areaToLabels.get(e),n=e.padding[0],r=e.padding[3]||0,i=e.origin[0]+r,o=e.origin[1]+n;t||(t=[],this.areaToLabels.set(e,t));var a=this.areaWaitingOnLabel.get(e);a||(a=new Set,this.areaWaitingOnLabel.set(e,a));var s=this.areaToWords.get(e);if(s||(s=function(e){for(var t=[],n=e.split(c.newLineRegEx),r=0,i=n.length-1;r<i;r++){n[r].split(" ").forEach((function(e){""!==e&&t.push(e)})),t.push("\n")}return n[n.length-1].split(" ").forEach((function(e){""!==e&&t.push(e)})),t}(e.text)),t.length<s.length)for(var u=t.length,l=s.length;u<l;++u){var h=s[u];if("\n"===h)t.push(y.NewLineCharacterMode.NEWLINE);else{var f=new g.LabelInstance({active:!1,color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,text:h,origin:[i,o],onReady:this.handleLabelReady});f.parentTextArea=e,t.push(f),this.providers.labels.add(f),a.add(f)}}e.labels=t},t.prototype.updateLabelColors=function(e){var t=this.areaToLabels.get(e);if(t){for(var n=0,r=t.length;n<r;++n){var i=t[n];i instanceof g.LabelInstance&&(i.color=s.copy4(e.color))}n=0;for(var o=e.newLabels.length;n<o;++n)e.newLabels[n].color=s.copy4(e.color);for(n=0,o=e.borders.length;n<o;++n)e.borders[n].color=s.copy4(e.color)}},t.prototype.updateLabelFontSizes=function(e){this.clear(e),this.updateLabels(e),this.areaTokerningRequest.delete(e),this.layout(e)},t.prototype.updateLabelOrigins=function(e){var t=this.areaToLabels.get(e);if(t){for(var n=e.origin,r=e.oldOrigin,i=0,o=t.length;i<o;++i){if((s=t[i])instanceof g.LabelInstance){var a=s.origin;s.origin=[a[0]+n[0]-r[0],a[1]+n[1]-r[1]]}}for(i=0,o=e.newLabels.length;i<o;++i){var s;if((s=e.newLabels[i])instanceof g.LabelInstance){a=s.origin;s.origin=[a[0]+n[0]-r[0],a[1]+n[1]-r[1]]}}for(i=0,o=e.borders.length;i<o;++i){var u=e.borders[i];u.position=[u.position[0]+n[0]-r[0],u.position[1]+n[1]-r[1]]}e.oldOrigin=e.origin}},t.prototype.willUpdateProps=function(e){e.data!==this.props.data&&delete this.propertyIds,e.resourceKey!==this.props.resourceKey&&(this.fullUpdate=!0)},t.defaultProps={key:"",data:new a.InstanceProvider,scaling:h.ScaleMode.ALWAYS},t}(f.Layer2D);t.TextAreaLayer=_},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=function(e){function t(t){var n=e.call(this,t)||this;return n.fontScale=1,n.textAreaOrigin=[0,0],n.textAreaAnchor=[0,0],n.fontScale=t.fontScale||n.fontScale,n.textAreaOrigin=t.textAreaOrigin||n.textAreaOrigin,n.textAreaAnchor=t.textAreaAnchor||n.textAreaAnchor,n}return i(t,e),o([a.observable],t.prototype,"fontScale",void 0),o([a.observable],t.prototype,"textAreaOrigin",void 0),o([a.observable],t.prototype,"textAreaAnchor",void 0),t}(n(122).RectangleInstance);t.BorderInstance=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(0),s=n(62),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){var e=this.props.animate||{},r={0:1,1:1,2:-1,3:1,4:-1,5:-1},i={0:0,1:0,2:0,3:1,4:1,5:1},o=this.props.scaleFactor,s=void 0===o?function(){return 1}:o;return{fs:n(230),instanceAttributes:[{easing:e.location,name:t.attributeNames.location,size:a.InstanceAttributeSize.TWO,update:function(e){return e.position}},{name:t.attributeNames.anchor,size:a.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x||0,e.anchor.y||0]}},{name:t.attributeNames.size,size:a.InstanceAttributeSize.TWO,update:function(e){return e.size}},{name:t.attributeNames.depth,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:t.attributeNames.scaling,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{easing:e.color,name:t.attributeNames.color,size:a.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.scale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scale]}},{name:t.attributeNames.maxScale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.maxScale]}},{name:t.attributeNames.fontScale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.fontScale]}},{name:"textAreaOrigin",size:a.InstanceAttributeSize.TWO,update:function(e){return e.textAreaOrigin}},{name:"textAreaAnchor",size:a.InstanceAttributeSize.TWO,update:function(e){return e.textAreaAnchor}}],uniforms:[{name:"scaleFactor",size:a.UniformSize.ONE,update:function(e){return[s()]}}],vertexAttributes:[{name:"normals",size:a.VertexAttributeSize.TWO,update:function(e){return[r[e],i[e]]}}],vertexCount:6,vs:n(231)}},t.prototype.getMaterialOptions=function(){return s.CommonMaterialOptions.transparentShapeBlending},t.defaultProps={key:"",data:new o.InstanceProvider},t.attributeNames={anchor:"anchor",color:"color",depth:"depth",fontScale:"fontScale",location:"location",maxScale:"maxScale",scale:"scale",scaling:"scaling",size:"size"},t}(n(114).Layer2D);t.BorderLayer=u},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\ngl_FragColor = vertexColor;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\nfloat borderScale = mix(fontScale, 1.0, float(scaling == 3.0));\nvec3 screenSize = cameraSpaceSize(vec3(size * scale * borderScale / scaleFactor / maxScale, 1.0));\nbool largerOnScreen = screenSize.y > size.y || screenSize.x > size.x;\nfloat useScaleMode = float(\n(\nscaling == 3.0 ||\n(largerOnScreen && scaling == 2.0)\n) &&\nscaling != 1.0\n);\nfloat unequalZooms = float(cameraScale2D.x != cameraScale2D.y);\nvec2 adjustedSize = mix(\nsize,\n(size * cameraScale2D.yx),\nunequalZooms\n);\nfloat normal = normals.x;\nfloat side = normals.y;\nvec2 scaledAnchor = anchor * scale;\nvec2 worldAnchor = location + scaledAnchor;\nvec2 adjustedAnchor = mix(\nscaledAnchor,\n(scaledAnchor * cameraScale2D.yx),\nunequalZooms\n);\nvec2 vertex = vec2(side, float(normal == 1.0)) * scale * adjustedSize + location - adjustedAnchor;\nfloat labelScreenScale = mix(\nscreenSize.y / adjustedSize.y,\nscreenSize.x / adjustedSize.x,\nfloat((cameraScale2D.x != 1.0))\n);\nfloat currentScale = labelScreenScale * scale;\nvec2 anchorToVertex = vertex - location;\nvertex = mix(\nvertex + textAreaOrigin,\n(anchorToVertex + location - textAreaAnchor) / labelScreenScale + textAreaOrigin + textAreaAnchor,\nuseScaleMode\n);\nvertexColor = color;\ngl_Position = clipSpace(vec3(vertex, depth));\n}"},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(233)),r(n(122))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(0),s=n(3),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){var e=this.props.animate||{},r={0:1,1:1,2:-1,3:1,4:-1,5:-1},i={0:0,1:0,2:0,3:1,4:1,5:1},o=this.props.scaleFactor,s=void 0===o?function(){return 1}:o;return{fs:n(234),instanceAttributes:[{easing:e.location,name:t.attributeNames.location,size:a.InstanceAttributeSize.TWO,update:function(e){return e.position}},{name:t.attributeNames.anchor,size:a.InstanceAttributeSize.TWO,update:function(e){return[e.anchor.x||0,e.anchor.y||0]}},{name:t.attributeNames.size,size:a.InstanceAttributeSize.TWO,update:function(e){return e.size}},{name:t.attributeNames.depth,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{name:t.attributeNames.scaling,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scaling]}},{easing:e.color,name:t.attributeNames.color,size:a.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.scale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.scale]}},{name:t.attributeNames.maxScale,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.maxScale]}}],uniforms:[{name:"scaleFactor",size:a.UniformSize.ONE,update:function(e){return[s()]}}],vertexAttributes:[{name:"normals",size:a.VertexAttributeSize.TWO,update:function(e){return[r[e],i[e]]}}],vertexCount:6,vs:n(235)}},t.prototype.getMaterialOptions=function(){return s.CommonMaterialOptions.transparentShapeBlending},t.defaultProps={key:"",data:new o.InstanceProvider},t.attributeNames={anchor:"anchor",color:"color",depth:"depth",location:"location",maxScale:"maxScale",scale:"scale",scaling:"scaling",size:"size"},t}(n(6).Layer2D);t.RectangleLayer=u},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\ngl_FragColor = vertexColor;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvoid main() {\nvec3 screenSize = cameraSpaceSize(vec3(size * scale / scaleFactor / maxScale, 1.0));\nbool largerOnScreen = screenSize.y > size.y || screenSize.x > size.x;\nfloat useScaleMode = float(\n(\nscaling == 3.0 ||\n(largerOnScreen && scaling == 2.0)\n) &&\nscaling != 1.0\n);\nfloat unequalZooms = float(cameraScale2D.x != cameraScale2D.y);\nvec2 adjustedSize = mix(\nsize,\n(size * cameraScale2D.yx),\nunequalZooms\n);\nfloat normal = normals.x;\nfloat side = normals.y;\nvec2 scaledAnchor = anchor * scale;\nvec2 worldAnchor = location + scaledAnchor;\nvec2 adjustedAnchor = mix(\nscaledAnchor,\n(scaledAnchor * cameraScale2D.yx),\nunequalZooms\n);\nvec2 vertex = vec2(side, float(normal == 1.0)) * scale * adjustedSize + location - adjustedAnchor;\nfloat labelScreenScale = mix(\nscreenSize.y / adjustedSize.y,\nscreenSize.x / adjustedSize.x,\nfloat((cameraScale2D.x != 1.0))\n);\nfloat currentScale = labelScreenScale * scale;\nvec2 anchorToVertex = vertex - location;\nvertex = mix(\nvertex,\n(anchorToVertex / labelScreenScale) + location,\nuseScaleMode\n);\nvertexColor = color;\ngl_Position = clipSpace(vec3(vertex, depth));\n}"},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(237)),r(n(238))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(11),s=n(20),u=function(e){function t(t){var n=e.call(this,t)||this;return n.color=[1,1,1,1],n.depth=0,n.radius=0,n.thickness=1,n.center=[0,0],n.color=t.color||n.color,n.depth=t.depth||n.depth,n.radius=t.radius||n.radius,n.thickness=t.thickness||n.thickness,n.center=t.center||n.center,n}return i(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return 2*this.radius},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerRadius",{get:function(){return this.radius-this.thickness},enumerable:!0,configurable:!0}),o([s.observable],t.prototype,"color",void 0),o([s.observable],t.prototype,"depth",void 0),o([s.observable],t.prototype,"radius",void 0),o([s.observable],t.prototype,"thickness",void 0),o([s.observable],t.prototype,"center",void 0),t}(a.Instance);t.RingInstance=u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(0),s=n(3),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){var e=this.props.scaleFactor||function(){return 1},r=this.props.animate||{},i=r.color,o=r.center,s=r.radius,u={0:1,1:1,2:-1,3:1,4:-1,5:-1},c={0:-1,1:-1,2:-1,3:1,4:1,5:1};return{fs:n(239),instanceAttributes:[{easing:o,name:t.attributeNames.center,size:a.InstanceAttributeSize.TWO,update:function(e){return e.center}},{easing:s,name:t.attributeNames.radius,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.radius]}},{name:t.attributeNames.depth,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.depth]}},{easing:i,name:t.attributeNames.color,size:a.InstanceAttributeSize.FOUR,update:function(e){return e.color}},{name:t.attributeNames.thickness,size:a.InstanceAttributeSize.ONE,update:function(e){return[e.thickness]}}],uniforms:[{name:"scaleFactor",size:a.UniformSize.ONE,update:function(t){return[e()]}}],vertexAttributes:[{name:"normals",size:a.VertexAttributeSize.TWO,update:function(e){return[u[e],c[e]]}}],vertexCount:6,vs:n(240)}},t.prototype.getMaterialOptions=function(){return s.CommonMaterialOptions.transparentShapeBlending},t.defaultProps={key:"",data:new o.InstanceProvider},t.attributeNames={center:"center",radius:"radius",depth:"depth",color:"color",thickness:"thickness"},t}(n(6).Layer2D);t.RingLayer=u},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float borderSize;\nvarying vec2 pointCoord;\nvarying float scale;\nfloat circle(vec2 coord, float radius){\nvec2 dist = coord - vec2(0.5);\nreturn 1.0 - smoothstep(\nradius - (radius * edgeSharpness),\nradius,\ndot(dist, dist) * 4.0\n);\n}\nvoid main() {\nfloat outer_step_factor = circle(pointCoord, 1.0);\nfloat inner_step_factor = circle(pointCoord, 1.0 - borderSize * scale);\ngl_FragColor = mix(\nmix(\nvec4(0.0, 0.0, 0.0, 0.0),\nvertexColor,\nouter_step_factor\n),\nvec4(0.0, 0.0, 0.0, 0.0),\ninner_step_factor\n);\n}"},function(e,t){e.exports="precision highp float;\nvarying vec4 vertexColor;\nvarying float edgeSharpness;\nvarying float borderSize;\nvarying vec2 pointCoord;\nvarying float scale;\nvoid main() {\nscale = scaleFactor;\nvertexColor = color;\nfloat size = radius * scaleFactor * pixelRatio;\nfloat ringWidth = mix(2.0 , thickness, float(thickness > 2.0));\nborderSize = mix(\n(ringWidth) / size,\n((ringWidth * pixelRatio) / size),\nfloat(pixelRatio > 1.0)\n);\nedgeSharpness = min(0.2 / (ringWidth * scale), 0.1);\npointCoord = (normals.xy + vec2(1.0, 1.0)) / 2.0;\nvec4 clipCenter = clipSpace(vec3(center, depth));\nvec2 screenCenter = (clipCenter.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;\nvec2 vertex = (normals.xy * size) + screenCenter;\ngl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), clipCenter.zw);\n}"},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(242),r(n(283)),r(n(125)),r(n(287))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(243),n(279),n(281)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),i=n(6),o=n(33),a=n(0);o.ShaderModule.register([{moduleId:"world2DXY",description:"\nThis is a special helper module used by\nthe system to map View2D content into\na 3D world space. The system utilizes\nthis module automatically for you when\nyou utilize createLayer2Din3D.\n",content:n(113),compatibility:a.ShaderInjectionTarget.ALL,uniforms:function(e){return e instanceof i.Layer2D?e.props.control2D?[{name:"projection",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"view",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"cameraOffset",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof r.Control2D?e.props.control2D.offset:[0,0,0]}},{name:"cameraPosition",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraScale2D",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof r.Control2D?e.props.control2D.scale:[1,1,1]}},{name:"cameraRotation",size:a.UniformSize.FOUR,update:function(){return e.view.props.camera.transform.rotation}},{name:"viewSize",size:a.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:a.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requested the module world2DXZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}}])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(245),n(247),n(248),n(250),n(251),n(267),n(272),n(274),n(276)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(9).ShaderModule.register([{moduleId:"camera",description:"\nThese are properties injected from the\ncurrent camera applied to the view.\n\nConstants:\nmat4 projection;\nmat4 view;\nmat4 viewProjection;\nvec3 cameraOffset;\nvec3 cameraPosition;\nvec3 cameraScale;\nvec3 cameraRotation;\nvec2 viewSize;\nfloat pixelRatio;\n",content:"",compatibility:r.ShaderInjectionTarget.ALL,uniforms:function(e){return[{name:"projection",size:r.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"viewProjection",size:r.UniformSize.MATRIX4,update:function(){return e.view.props.camera.viewProjection}},{name:"view",size:r.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"cameraPosition",size:r.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:r.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraRotation",size:r.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{shaderInjection:r.ShaderInjectionTarget.ALL,name:"viewSize",size:r.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{shaderInjection:r.ShaderInjectionTarget.ALL,name:"pixelRatio",size:r.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]}},{moduleId:"projection",content:n(246),compatibility:r.ShaderInjectionTarget.ALL}])},function(e,t){e.exports="${import: camera}\nvec3 cameraSpace(vec3 world) {\nreturn (view * vec4(world, 1.0)).xyz;\n}\nvec3 cameraSpace(vec4 world) {\nreturn (view * world).xyz;\n}\nvec3 cameraSpaceDirection(vec3 world) {\nreturn (view * vec4(world, 0.0)).xyz;\n}\nvec3 cameraSpaceDirection(vec4 world) {\nreturn (view * world).xyz;\n}\nvec3 cameraSpaceSize(vec3 worldSize) {\nreturn (view * vec4(worldSize, 0.0)).xyz;\n}\nvec4 clipSpace(vec3 world) {\nreturn (viewProjection) * vec4(world, 1.0);\n}\nvec4 clipSpace(vec4 world) {\nreturn (viewProjection) * world;\n}\nvec4 clipSpaceDirection(vec3 worldSize) {\nreturn (viewProjection) * vec4(worldSize, 0.0);\n}\nvec4 clipSpaceDirection(vec4 worldSize) {\nreturn (viewProjection) * worldSize;\n}\nvec4 clipSpaceSize(vec3 worldSize) {\nreturn (viewProjection) * vec4(worldSize, 0.0);\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(9).ShaderModule.register({moduleId:"frame",description:"\nThis provides frame timing information\nor how many frames have been rendered.\n\nConstants:\nfloat currentTime;\nfloat currentFrame;\n",content:"",compatibility:r.ShaderInjectionTarget.ALL,uniforms:function(e){return[{name:"currentTime",size:r.UniformSize.ONE,update:function(){return[e.surface.frameMetrics.currentTime]}},{name:"currentFrame",size:r.UniformSize.ONE,update:function(){return[e.surface.frameMetrics.currentFrame]}}]}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(9).ShaderModule.register({moduleId:"hsv",description:"\nProvides methods that converts colors to\nHSV values and back. This makes it\neasier to deal with hue saturation and\nlightness levels.\n\nMethods:\nvec3 rgb2hsv(vec3 c);\nvec3 hsv2rgb(vec3 c);\n",content:n(249),compatibility:r.ShaderInjectionTarget.ALL})},function(e,t){e.exports="vec3 rgb2hsv(vec3 c) {\nvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\nvec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\nfloat d = q.x - min(q.w, q.y);\nfloat e = 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(9).ShaderModule.register({moduleId:"instancing",description:"\nThis is an internal shader module that\nhelps establish the instancing system.\nNot recommended for use unless you\nreally know how to utilize it properly.\n\nAttributes:\nfloat _active;\nfloat instance;\n",content:"",compatibility:r.ShaderInjectionTarget.ALL,instanceAttributes:function(e){var t={name:"_active",size:r.InstanceAttributeSize.ONE,update:function(e){return[e.active?1:0]}};return e.shaderIOInfo.activeAttribute=t,[t]},vertexAttributes:function(e){return e.bufferType===r.LayerBufferType.UNIFORM?[{name:"instance",size:r.VertexAttributeSize.ONE,update:function(){return[0]}}]:[]}})},function(e,t,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(9),a=[{moduleId:"PI_INV",description:"Provides: float PI_INV = 1.0 / pi",content:n(252),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"PI2_INV",description:"Provides:\nfloat PI2_INV = 1.0 / (pi * 2.0)",content:n(253),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"PI_2",description:"Provides: float PI_2 = pi / 2.0",content:n(254),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"PI_4",description:"Provides: float PI_4 = pi / 4.0",content:n(255),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"PI",description:"Provides: float PI = pi",content:n(256),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"PI2",description:"Provides: float PI2 = pi * 2.0",content:n(257),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"toDegrees",description:"Provides: float toDegrees;\nCan be used to convert radians to degrees:\nradians * toDegrees",content:n(258),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"toRadians",description:"Provides: float toRadians;\nCan be used to convert degrees to radians:\ndegress * toRadians",content:n(259),compatibility:i.ShaderInjectionTarget.ALL}],s={moduleId:"constants",description:"\nProvides all the math constants you may\nneed as convenience. It's probably\nbetter to include them individually, but\nconvenience sometimes beats practicality\n\nConstants:\n"+a.map((function(e){return e.moduleId})).join("\n")+"\n",content:"${import: "+a.map((function(e){return e.moduleId})).join(", ")+"}",compatibility:i.ShaderInjectionTarget.ALL},u=[{moduleId:"bezier1",description:"Provides the 2D single control\npoint bezier method:\nvec2 bezier1(float t, vec2 p1, vec2 p2, vec2 c1)",content:n(260),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"bezier2",description:"Provides the 2D single control\npoint bezier method:\nvec2 bezier2(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2)",content:n(261),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"arc",description:"Provides the 2D\narc interpolation method:\nvec2 arc(float t,\n\tvec2 center,\n\tfloat radius,\n\tfloat start,\n\tfloat end\n)",content:n(262),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"fmod",description:"Provides the floating point\nmodulus method:\nfloat fmod(float x, float m, float m_inv)",content:n(263),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"wrap",description:"Provides a method that wraps\nvalue overflows:\nfloat wrap(float value, float start, float end)",content:n(264),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"fcos",description:"Provides a fcos method that also\nhas a higher precision than\nsome hardware cos implementations:\nfloat fcos(float x)",content:n(265),compatibility:i.ShaderInjectionTarget.ALL},{moduleId:"fsin",description:"Provides a fsin method that also\nhas a higher precision than\nsome hardware sin implementations:\nfloat fsin(float x)",content:n(266),compatibility:i.ShaderInjectionTarget.ALL}];o.ShaderModule.register(r(u,a,[s]))},function(e,t){e.exports="float PI_INV = 0.3183098862;"},function(e,t){e.exports="float PI2_INV = 0.1591549431;"},function(e,t){e.exports="float PI_2 = 1.5707963268;"},function(e,t){e.exports="float PI_4 = 0.7853981634;"},function(e,t){e.exports="float PI = 3.14159265;"},function(e,t){e.exports="float PI2 = 6.2831853;"},function(e,t){e.exports="float toDegrees = 57.2957795131;"},function(e,t){e.exports="float toRadians = 0.01745329252;"},function(e,t){e.exports="vec2 bezier1(float t, vec2 p1, vec2 p2, vec2 c1) {\nreturn (1.0 - t) * (1.0 - t) * p1 + 2.0 * t * (1.0 - t) * c1 + t * t * p2;\n}"},function(e,t){e.exports="vec2 bezier2(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {\nfloat t1 = 1.0 - t;\nreturn pow(t1, 3.0) * p1 + 3.0 * t * pow(t1, 2.0) * c1 + 3.0 * pow(t, 2.0) * t1 * c2 + pow(t, 3.0) * p2;\n}"},function(e,t){e.exports="${import: PI, PI2, fsin, fcos, wrap}\nvec2 arc(float t, vec2 center, float radius, float start, float end) {\nfloat angle = wrap((end - start) * t + start, 0.0, PI2);\nreturn center + vec2(fcos(angle), fsin(angle)) * radius;\n}"},function(e,t){e.exports="float fmod(float x, float m, float m_inv) {\nreturn x - m * floor(x * m_inv);\n}"},function(e,t){e.exports="float wrap(float value, float start, float end) {\nfloat width = end - start;\nfloat offsetValue = value - start;\nreturn (offsetValue - (floor(offsetValue / width) * width)) + start;\n}"},function(e,t){e.exports="${import: PI, PI2, PI_2}\nfloat fcos(float x) {\nfloat sine;\nx += PI_2;\nx += mix(\nmix(\n0.0,\n-PI2, float(x > PI)\n),\nPI2, float(x < -PI)\n);\nsine = 1.27323954 * x;\nsine += mix(-1.0, 1.0, float(x < 0.0)) * 0.405284735 * x * x;\nsine = 0.225 * (sine * (mix(1.0, -1.0, float(sine < 0.0)) * sine) - sine) + sine;\nreturn sine;\n}"},function(e,t){e.exports="${import: PI, PI2}\nfloat fsin(float x) {\nfloat sine;\nx += mix(\nmix(\n0.0,\n-PI2, float(x > PI)\n),\nPI2, float(x < -PI)\n);\nsine = 1.27323954 * x;\nsine += mix(-1.0, 1.0, float(x < 0.0)) * 0.405284735 * x * x;\nsine = 0.225 * (sine * (mix(1.0, -1.0, float(sine < 0.0)) * sine) - sine) + sine;\nreturn sine;\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(9).ShaderModule.register([{moduleId:"translation",description:"Generates a translation matrix\nfrom a vec3:\nmat4 transform(vec3 s, vec4 r, vec3 t)",compatibility:r.ShaderInjectionTarget.ALL,content:n(268)},{moduleId:"rotation",description:"Generates a rotation matrix\nfrom a quaternion:\nmat4 rotationFromQuaternion(vec4 q)",compatibility:r.ShaderInjectionTarget.ALL,content:n(269)},{moduleId:"scale",description:"Generates a scale matrix\nfrom a vec3:\nmat4 scale(vec3 s)",compatibility:r.ShaderInjectionTarget.ALL,content:n(270)},{moduleId:"transform",description:"Generates a full transform matrix\nfrom a scale, quaternion, translation:\nmat4 transform(vec3 s, vec4 r, vec3 t)",compatibility:r.ShaderInjectionTarget.ALL,content:n(271)}])},function(e,t){e.exports="mat4 translation(vec3 t) {\nreturn mat4(\n1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 0,\nt.x, t.y, t.z, 1\n);\n}"},function(e,t){e.exports="mat4 rotationFromQuaternion(vec4 q) {\nfloat x2 = q.y + q.y;\nfloat y2 = q.z + q.z;\nfloat z2 = q.w + q.w;\nfloat xx = q.y * x2;\nfloat xy = q.y * y2;\nfloat xz = q.y * z2;\nfloat yy = q.z * y2;\nfloat yz = q.z * z2;\nfloat zz = q.w * z2;\nfloat wx = q.x * x2;\nfloat wy = q.x * y2;\nfloat wz = q.x * z2;\nreturn mat4(\n1.0 - (yy + zz), xy - wz, xz + wy, 0.0,\nxy + wz, 1.0 - (xx + zz), yz - wx, 0.0,\nxz - wy, yz + wx, 1.0 - (xx + yy), 0.0,\n0, 0, 0, 1\n);\n}"},function(e,t){e.exports="mat4 scale(vec3 s) {\nreturn mat4(\ns.x, 0, 0, 0,\n0, s.y, 0, 0,\n0, 0, s.z, 0,\n0, 0, 0, 1\n);\n}"},function(e,t){e.exports="${import: translation, rotation, scale}\nmat4 transform(vec3 s, vec4 r, vec3 t) {\nreturn translation(t) * rotationFromQuaternion(r) * scale(s);\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(9).ShaderModule.register({moduleId:"packFloat",description:"\nThis provides the ability to pack\na float value into a color RGBA\nvalue. This is used to bypass the\nlack of support for float textures.\n\nConstants:\nfloat currentTime;\nfloat currentFrame;\n",content:n(273),compatibility:r.ShaderInjectionTarget.ALL})},function(e,t){e.exports="vec4 bitSh = vec4(16777216., 65536., 256., 1.);\nvec4 bitMsk = vec4(0., vec3(1. / 256.0));\nvec4 bitShifts = vec4(1.) / vec4(16777216., 65536., 256., 1.);\nvec4 packFloat(float value, float range) {\nvalue = (value + range) / (range * 2.);\nvec4 comp = fract(value * bitSh);\ncomp -= comp.xxyz * bitMsk;\nreturn comp;\n}\nfloat unpackFloat(vec4 color, float range) {\nreturn dot(color , bitShifts) * (range * 2.) - range;\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n(9).ShaderModule.register([{moduleId:"picking",description:"Internal use only. Provides methods\nand constants to make the picking processes work.",content:n(275),compatibility:r.ShaderInjectionTarget.VERTEX,instanceAttributes:function(e){return[{name:"_pickingColor",size:r.InstanceAttributeSize.FOUR,update:function(e){var t=16777215-e.uid;return[((16711680&t)>>16)/255,((65280&t)>>8)/255,(255&t)/255,1]}}]}}])},function(e,t){e.exports="varying highp vec4 _picking_color_pass_;"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i="\nMakes a no-op shader where gl_Position\nis [0, 0, 0, 0] and gl_FragColor is\n[0, 0, 0, 0].\n\nYou can not import this if you specify\nyour own main() method.\n";n(9).ShaderModule.register([{moduleId:"no-op",description:i,content:n(277),compatibility:r.ShaderInjectionTarget.VERTEX},{moduleId:"no-op",description:i,content:n(278),compatibility:r.ShaderInjectionTarget.FRAGMENT}])},function(e,t){e.exports="void main() {\ngl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n}"},function(e,t){e.exports="void main() {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),i=n(6),o=n(33),a=n(0);o.ShaderModule.register([{moduleId:"world2DXZ",description:"\nThis is a special helper module used by\nthe system to map View2D content into\na 3D world space. The system utilizes\nthis module automatically for you when\nyou utilize createLayer2Din3D.\n",content:n(280),compatibility:a.ShaderInjectionTarget.ALL,uniforms:function(e){return e instanceof i.Layer2D?e.props.control2D?[{name:"projection",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"view",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"cameraOffset",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof r.Control2D?e.props.control2D.offset:[0,0,0]}},{name:"cameraPosition",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraScale2D",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof r.Control2D?e.props.control2D.scale:[1,1,1]}},{name:"cameraRotation",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"viewSize",size:a.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:a.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requesed the module world2DXZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}}])},function(e,t){e.exports="vec3 cameraSpace(vec3 world) {\nreturn (world + cameraOffset) * cameraScale2D;\n}\nvec3 cameraSpaceSize(vec3 worldSize) {\nreturn worldSize * cameraScale2D;\n}\nvec4 clipSpace(vec3 world) {\nreturn ((projection * view) * vec4(cameraSpace(world.xzy), 1.0));\n}\nvec4 clipSpaceSize(vec3 worldSize) {\nreturn ((projection * view) * vec4(cameraSpaceSize(worldSize.xzy), 0.0));\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(41),i=n(6),o=n(33),a=n(0);o.ShaderModule.register([{moduleId:"world2DYZ",description:"\nThis is a special helper module used by\nthe system to map View2D content into\na 3D world space. The system utilizes\nthis module automatically for you when\nyou utilize createLayer2Din3D.\n",content:n(282),compatibility:a.ShaderInjectionTarget.ALL,uniforms:function(e){return e instanceof i.Layer2D?e.props.control2D?[{name:"projection",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.projection}},{name:"view",size:a.UniformSize.MATRIX4,update:function(){return e.view.props.camera.view}},{name:"cameraOffset",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof r.Control2D?e.props.control2D.offset:[0,0,0]}},{name:"cameraPosition",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.position}},{name:"cameraScale",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"cameraScale2D",size:a.UniformSize.THREE,update:function(){return e.props.control2D instanceof r.Control2D?e.props.control2D.scale:[1,1,1]}},{name:"cameraRotation",size:a.UniformSize.THREE,update:function(){return e.view.props.camera.scale}},{name:"viewSize",size:a.UniformSize.TWO,update:function(){return[e.view.viewBounds.width,e.view.viewBounds.height]}},{name:"pixelRatio",size:a.UniformSize.ONE,update:function(){return[e.view.pixelRatio]}}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requesed the module world2DYZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}}])},function(e,t){e.exports="vec3 cameraSpace(vec3 world) {\nreturn (world + cameraOffset) * cameraScale2D;\n}\nvec3 cameraSpaceSize(vec3 worldSize) {\nreturn worldSize * cameraScale2D;\n}\nvec4 clipSpace(vec3 world) {\nreturn ((projection * view) * vec4(cameraSpace(world.zyx), 1.0));\n}\nvec4 clipSpaceSize(vec3 worldSize) {\nreturn ((projection * view) * vec4(cameraSpaceSize(worldSize.zyx), 0.0));\n}"},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(123)),r(n(284)),r(n(124)),r(n(123))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(22),o=n(18);!function(e){e[e.XY=0]="XY",e[e.XZ=1]="XZ",e[e.YZ=2]="YZ"}(r=t.Axis2D||(t.Axis2D={})),t.createLayer2Din3D=function(e,t,n){var a;if(!(t===i.Layer2D||t.prototype instanceof i.Layer2D))return console.warn("A Layer type was specified for createLayer2din3D that is NOT a Layer2D type, which is invalid.","The layer will be used without being modified."),o.createLayer(t,n);switch(e){case r.XY:a="world2DXY";break;case r.XZ:a="world2DXZ";break;case r.YZ:a="world2DYZ";break;default:return o.createLayer(t,n)}var s=Object.assign({},n,{baseShaderModules:function(e,t){var n=t.vs.indexOf("world2D");return n>=0&&t.vs.splice(n,1,a),(n=t.fs.indexOf("world2D"))>=0&&t.fs.splice(n,1,a),t}});return o.createLayer(t,s)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),i=n(33),o=n(0),a=n(3),s=n(126);i.ShaderModule.register({moduleId:"parent-transform",description:"\nWhen working with SceneGraphLayers, the\nlayer can have a transform applied to\nthe layer. This makes that transform\navailable in the parentTransform\nconstant.\n\nmat4 parentTransform;\n",compatibility:o.ShaderInjectionTarget.VERTEX,content:"",uniforms:function(e){var t=e;if(!(t instanceof s.SceneGraphLayer))return console.warn("A shader requested the module parent-transform; however, the layer the","shader is generated from is NOT a SceneGraphLayer which is","required for the module to work."),[];var n=r.identity4();return[a.createUniform({name:"parentTransform",size:o.UniformSize.MATRIX4,update:function(){var e;return(null===(e=t.props.parent)||void 0===e?void 0:e.matrix)||n}})]}})},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),a=n(53),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isQueuedForUpdate=!1,t.needsWorldOrientation=!1,t.needsWorldDecomposition=!1,t._instance=null,t._matrix={value:o.identity4()},t._localMatrix={value:t._matrix.value},t._position={value:[0,0,0]},t._localPosition={value:t._position.value},t._rotation={value:o.oneQuat()},t._localRotation={value:0},t.localRotationMatrix=o.identity2(),t._scale={value:[1,1,1]},t._localScale={value:t._scale.value},t}return i(t,e),Object.defineProperty(t.prototype,"instance",{set:function(e){this._instance!==e&&this._instance&&(this._instance.transform.instance=null,e&&(e.transform=this)),this._instance=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"matrix",{get:function(){return this.update(),this._matrix.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.needsWorldOrientation=!0,this.update(),this._position.value},set:function(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world position is not supported yet. Use localPosition for now."):this.localPosition=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localPosition",{get:function(){return this._localPosition.value},set:function(e){this._localPosition.value[0]=e[0],this._localPosition.value[1]=e[1],this._localPosition.didUpdate=!0,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.needsWorldOrientation=!0,this.update(),this._rotation.value},set:function(e){console.warn("NOT IMPLEMENTED: Setting world rotation for a 2D transform is not supported yet.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localRotation",{get:function(){return this._localRotation.value},set:function(e){this._localRotation.value=e,this._localRotation.didUpdate=!0,this.invalidate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.needsWorldOrientation=!0,this.update(),this._scale.value},set:function(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world scale is not supported yet. Use localScale for now."):this.localScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localScale",{get:function(){return this._localScale.value},set:function(e){o.apply2(this._localScale.value,e[0],e[1]),this._localScale.didUpdate=!0,this.invalidate()},enumerable:!0,configurable:!0}),t.prototype.decomposeWorldMatrix=function(){if(this.parent&&this.needsWorldDecomposition&&this.needsWorldOrientation){this.needsWorldDecomposition=!1;var e=this._matrix.value,t=this._position.value,n=this._scale.value;this._position.didUpdate=t[0]!==e[12]||t[1]!==e[13]||t[2]!==e[14],this._position.didUpdate&&o.apply3(t,e[12],e[13],e[14]);var r=o.length4Components(e[0],e[1],e[2],e[3]),i=o.length4Components(e[4],e[5],e[6],e[7]),a=o.length4Components(e[8],e[9],e[10],e[11]);this._scale.didUpdate=n[0]!==r||n[1]!==i||n[2]!==a,o.apply3(n,r,i,a),this._scale.didUpdate=!0;var s=this._rotation.value,u=s[0],c=s[1],l=s[2],h=s[3];o.decomposeRotation(this._matrix.value,r,i,a,this._rotation.value);var f=this._rotation.value;this._rotation.didUpdate=f[0]!==u||f[1]!==c||f[2]!==l||f[3]!==h}},t.prototype.queueForUpdate=function(){!this.isQueuedForUpdate&&this._instance&&this._instance.active&&(this.isQueuedForUpdate=!0,a.scheduleUpdate(this))},t.prototype.update=function(e){var t=!1;if(this.isQueuedForUpdate&&(a.resolveUpdate(this),this.isQueuedForUpdate=!1),this.needsUpdate){var n=this.localRotationMatrix;this._localRotation.didUpdate&&o.rotation2x2(this._localRotation.value,n),o.SRT4x4_2D(this._localScale.value,n,this._localPosition.value,this._localMatrix.value),this._localMatrix.didUpdate=!0,t=!0}this.parent&&(this.parent.needsUpdate?(e||this.processParentUpdates((function(e){e.update(!0)})),t=!0):this.parent.childUpdate.has(this)&&(t=!0),t&&(o.multiply4x4(this.parent._matrix.value,this._localMatrix.value,this._matrix.value),this._matrix.didUpdate=!0,this.needsWorldDecomposition=!0)),this.decomposeWorldMatrix(),this._instance&&this._instance.active&&(this._localRotation.didUpdate&&(this._instance._localRotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._localPosition=this._localPosition.value),this._localScale.didUpdate&&(this._instance._localScale=this._localScale.value),this.parent?(this._rotation.didUpdate&&(this._instance._rotation=this._rotation.value),this._scale.didUpdate&&(this._instance._scale=this._scale.value),this._position.didUpdate&&(this._instance._position=this._position.value)):(this._localRotation.didUpdate&&(this._instance._rotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._position=this._localPosition.value),this._localScale.didUpdate&&(this._instance._scale=this._localScale.value)),(this._matrix.didUpdate||this._localMatrix.didUpdate)&&(this._instance.transform=this)),this._localScale.didUpdate=!1,this._localRotation.didUpdate=!1,this._localPosition.didUpdate=!1,this._rotation.didUpdate=!1,this._scale.didUpdate=!1,this._position.didUpdate=!1,this._matrix.didUpdate=!1,this._localMatrix.didUpdate=!1,this.resolve()},t}(n(54).TreeNode);t.Transform2D=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(288))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(289)),r(n(292))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(1),s=n(37),u=n(0),c=n(3),l=n(125),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){var e=[1,1,1],t=[1,1,-1],r=[1,-1,-1],i=[1,-1,1],a=[-1,1,1],s=[-1,1,-1],h=[-1,-1,-1],f=[-1,-1,1],d=[e,t,r,e,r,i,a,e,i,a,i,f,a,h,s,a,f,h,s,r,t,s,h,r,a,t,e,a,s,t,f,i,r,f,r,h],p=[1,0,0],g=[0,0,1],v=[-1,0,0],y=[0,0,-1],m=[0,1,0],b=[0,-1,0],T=[p,p,p,p,p,p,g,g,g,g,g,g,v,v,v,v,v,v,y,y,y,y,y,y,m,m,m,m,m,m,b,b,b,b,b,b],_=[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,0],[1,1],[0,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]];return{drawMode:o.GLSettings.Model.DrawMode.TRIANGLES,fs:[{outputType:u.FragmentOutputType.COLOR,source:n(290)}],instanceAttributes:[c.createAttribute({name:"transform",size:u.InstanceAttributeSize.MAT4X4,update:function(e){return(e.transform||l.IdentityTransform).matrix}}),c.createAttribute({name:"size",size:u.InstanceAttributeSize.THREE,update:function(e){return e.size}})],uniforms:[],vertexAttributes:[{name:"position",size:u.VertexAttributeSize.THREE,update:function(e){return d[e]}},{name:"normal",size:u.VertexAttributeSize.THREE,update:function(e){return T[e]}},{name:"texCoord",size:u.VertexAttributeSize.TWO,update:function(e){return _[e]}}],vertexCount:36,vs:n(291)}},t.prototype.getMaterialOptions=function(){return Object.assign({},c.CommonMaterialOptions.transparentShapeBlending,{cullSide:o.GLSettings.Material.CullSide.CCW})},t.defaultProps={data:new a.InstanceProvider,key:"",materialOptions:c.CommonMaterialOptions.transparentShapeBlending},t}(s.Layer);t.CubeLayer=h},function(e,t){e.exports="varying vec2 _texCoord;\nvoid main() {\ngl_FragColor = mix(\nvec4(1.0, 0.0, 0.0, 1.0),\nvec4(0.0, 0.0, 0.0, 1.0),\nfloat(_texCoord.x <= 0.01 || _texCoord.x > 0.99 || _texCoord.y < 0.01 || _texCoord.y > 0.99)\n);\n}"},function(e,t){e.exports="${import: projection}\nvarying vec2 _texCoord;\nvoid main() {\nvec4 pos = vec4(position * size, 1.0);\nvec4 world = transform * pos;\n_texCoord = texCoord;\ngl_Position = clipSpace(world.xyz);\n}"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=function(e){function t(t){var n=e.call(this,t)||this;return n.size=[1,1,1],n.color=[1,1,1,1],n.size=t.size||n.size,n.color=t.color||n.color,n}return i(t,e),o([a.observable],t.prototype,"size",void 0),o([a.observable],t.prototype,"color",void 0),t}(n(127).Instance3D);t.CubeInstance=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(294))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r};Object.defineProperty(t,"__esModule",{value:!0});var s=n(295),u=n(34),c=n(1),l=n(7),h=n(13),f=n(0),d=n(3),p=n(101);function g(e,t){for(var n=[],r=Object.values(t),i=0;i<r.length;++i){var o=r[i];o instanceof e?n.push(o):r.push.apply(r,Object.values(o))}return n}function v(e,t,n,r){for(var i=new Set,o=[],s=Object.keys(n).map((function(e){return[e,n[e]]})),u=function(n){var u=s[n];if(t(u[1]))o.push(r(u[0],u[1]));else{var c=!1,l=[];if(Object.keys(u[1]).forEach((function(t){var n=u[1][t];i.has(n)?(c=!0,console.warn("Invalid lookup for BasicSurface detected:",e)):(l.push([u[0]+"."+t,n]),i.add(n))})),l.length>0&&s.splice.apply(s,a([n+1,0],l)),c)return"break"}},c=0;c<s.length;++c){if("break"===u(c))break}return o}t.createScene=function(e){return e};var y=function(){function e(e){var t=this;this.currentTime=0,this.resizeTimer=0,this.visibility="visible",this.waitForSize=p.waitForValidDimensions(),this.destroy=function(){t.base&&(t.base.destroy(),delete t.base),t.context&&(t.context.remove(),delete t.context),d.stopAnimationLoop(t.drawRequestId),window.removeEventListener("resize",t.handleResize)},this.draw=function(e){return i(t,void 0,void 0,(function(){return o(this,(function(t){return this.base?(this.currentTime=e,this.base.draw(e),[2]):[2]}))}))},this.handleResize=function(){clearTimeout(t.resizeTimer),t.base&&(t.resizeTimer=window.setTimeout((function(){t.fitContainer()}),100))},this.handleVisibility=function(){var e;"visible"===document.visibilityState&&t.visibility!==document.visibilityState&&(null===(e=t.base)||void 0===e||e.redraw()),t.visibility=document.visibilityState},this.rebuild(e)}return e.prototype.createContext=function(){this.context||(this.context=document.createElement("canvas"),this.context.title="",this.context.width=(this.options.container.offsetWidth||0)*window.devicePixelRatio,this.context.height=(this.options.container.offsetHeight||0)*window.devicePixelRatio,this.context.style.width=(this.options.container.offsetWidth||0)+"px",this.context.style.height=(this.options.container.offsetHeight||0)+"px",this.options.container.appendChild(this.context))},e.prototype.init=function(){return i(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return this.base?[2]:[4,this.waitForSize(this.options.container)];case 1:if(!n.sent())return[2];this.createContext(),n.label=2;case 2:return n.trys.push([2,5,,6]),this.providers=this.options.providers,this.cameras=this.options.cameras,this.resources=this.options.resources||{},this.eventManagers=this.options.eventManagers(this.cameras),e=this,[4,new h.Surface({context:this.context,handlesWheelEvents:void 0===this.options.handlesWheelEvents||this.options.handlesWheelEvents,pixelRatio:window.devicePixelRatio,eventManagers:g(u.EventManager,this.eventManagers),rendererOptions:Object.assign({alpha:!0,antialias:!1},this.options.rendererOptions)}).ready];case 3:return e.base=n.sent(),this.fitContainer(!0),this.drawRequestId=d.onAnimationLoop(this.draw),[4,this.updatePipeline()];case 4:return n.sent(),window.addEventListener("resize",this.handleResize),document.addEventListener("visibilitychange",this.handleVisibility),[3,6];case 5:return(t=n.sent()).error===f.SurfaceErrorType.NO_WEBGL_CONTEXT?this.options.onNoWebGL&&this.options.onNoWebGL():(console.error("The Basic Surface could not be initialized"),console.error(t.stack||t.message)),[3,6];case 6:return[2]}}))}))},e.prototype.fitContainer=function(e){this.base&&(this.context.remove(),this.base.resize(this.options.container.offsetWidth||0,this.options.container.offsetHeight||0),this.options.container.appendChild(this.context),e||this.base.draw(this.currentTime))},e.prototype.getViewProjections=function(e){return this.base?this.base.getProjections(e):null},e.prototype.getViewScreenSize=function(e){if(!this.base)return[0,0];var t;if(s.isString(e)){if(!(t=this.base.getViewSize(e)))return[0,0]}else if(!(t=this.base.getViewSize(e(this.scenes).init[1].key)))return[0,0];return[t.width,t.height]},e.prototype.getViewScreenBounds=function(e){if(!this.base)return new l.Bounds({x:0,y:0,width:0,height:0});var t=this.base.getViewWorldBounds(e);return t||new l.Bounds({x:0,y:0,width:0,height:0})},e.prototype.getViewWorldBounds=function(e){if(!this.base)return new l.Bounds({x:0,y:0,width:0,height:0});var t=this.base.getViewWorldBounds(e);return t||new l.Bounds({x:0,y:0,width:0,height:0})},e.prototype.pipeline=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.options.scenes=e,this.base?[4,this.updatePipeline()]:[2];case 1:return t.sent(),[2]}}))}))},e.prototype.rebuild=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a;return o(this,(function(o){switch(o.label){case 0:if("boolean"==typeof e){if(e&&this.providers)for(n=g(c.InstanceProvider,this.providers),r=0,i=n.length;r<i;++r)n[r].clear()}else t=e;return this.options&&t&&console.warn("Ignoring options provided to rebuild method. The constructor is the only way to apply an options configuration object"),this.base&&this.base.destroy(),this.context&&(this.context.remove(),delete this.context),!this.options&&t&&(this.options=t),a=new d.PromiseResolver,this.ready=a.promise,[4,this.init()];case 1:return o.sent(),a.resolve(this),[2]}}))}))},e.prototype.setContainer=function(e){this.options.container=e,e.appendChild(this.context),this.fitContainer()},e.prototype.updatePipeline=function(){return i(this,void 0,void 0,(function(){var e,t,n,i;return o(this,(function(o){switch(o.label){case 0:return this.base?(e=v("resources",(function(e){return e&&void 0!==e.type}),this.resources||[],(function(e,t){var n=r(r({},t),{key:t.key||e});return t.key=n.key,n}))||[],t=this.options.scenes(this.resources||{},this.providers,this.cameras,this.eventManagers),this.scenes=t,n=v("scenes",(function(e){return e&&void 0!==e.views&&void 0!==e.layers}),t,(function(e,t){var n=v("views",(function(e){return e&&void 0!==e.init&&2===e.init.length}),t.views,(function(t,n){var i=r(r({},n),{key:e+"."+(n.key||t)});return i.init[1]=r(r({},i.init[1]),{key:i.key}),i})),i=v("layers",(function(e){return e&&void 0!==e.init}),t.layers,(function(e,t){var n={init:t.init,key:t.key||e};return t.init[1].key=n.key,n})),o={key:e,order:t.order,views:n,layers:i};return void 0===t.order&&delete o.order,o})),i={resources:e,scenes:n},[4,this.base.pipeline(i)]):[2];case 1:return[2,o.sent()]}}))}))},e}();t.BasicSurface=y},function(e,t,n){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},i=/%[sdj%]/g;t.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,a=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),u=r[n];n<o;u=r[++n])g(u)||!T(u)?a+=" "+u:a+=" "+s(u);return a},t.deprecate=function(n,r){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,r).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),i=!0}return n.apply(this,arguments)}};var o,a={};function s(e,n){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),p(n)?r.showHidden=n:n&&t._extend(r,n),m(r.showHidden)&&(r.showHidden=!1),m(r.depth)&&(r.depth=2),m(r.colors)&&(r.colors=!1),m(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),l(r,e,r.depth)}function u(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function l(e,n,r){if(e.customInspect&&n&&w(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return y(i)||(i=l(e,i,r)),i}var o=function(e,t){if(m(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(v(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(g(t))return e.stylize("null","null")}(e,n);if(o)return o;var a=Object.keys(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(n)),x(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return h(n);if(0===a.length){if(w(n)){var u=n.name?": "+n.name:"";return e.stylize("[Function"+u+"]","special")}if(b(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(_(n))return e.stylize(Date.prototype.toString.call(n),"date");if(x(n))return h(n)}var c,T="",E=!1,O=["{","}"];(d(n)&&(E=!0,O=["[","]"]),w(n))&&(T=" [Function"+(n.name?": "+n.name:"")+"]");return b(n)&&(T=" "+RegExp.prototype.toString.call(n)),_(n)&&(T=" "+Date.prototype.toUTCString.call(n)),x(n)&&(T=" "+h(n)),0!==a.length||E&&0!=n.length?r<0?b(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=E?function(e,t,n,r,i){for(var o=[],a=0,s=t.length;a<s;++a)A(t,String(a))?o.push(f(e,t,n,r,String(a),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(f(e,t,n,r,i,!0))})),o}(e,n,r,s,a):a.map((function(t){return f(e,n,r,s,t,E)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,T,O)):O[0]+T+O[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,i,o){var a,s,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),A(r,i)||(a="["+i+"]"),s||(e.seen.indexOf(u.value)<0?(s=g(n)?l(e,u.value,null):l(e,u.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),m(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function d(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function g(e){return null===e}function v(e){return"number"==typeof e}function y(e){return"string"==typeof e}function m(e){return void 0===e}function b(e){return T(e)&&"[object RegExp]"===E(e)}function T(e){return"object"==typeof e&&null!==e}function _(e){return T(e)&&"[object Date]"===E(e)}function x(e){return T(e)&&("[object Error]"===E(e)||e instanceof Error)}function w(e){return"function"==typeof e}function E(e){return Object.prototype.toString.call(e)}function O(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(m(o)&&(o=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!a[n])if(new RegExp("\\b"+n+"\\b","i").test(o)){var r=e.pid;a[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else a[n]=function(){};return a[n]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=d,t.isBoolean=p,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=v,t.isString=y,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=m,t.isRegExp=b,t.isObject=T,t.isDate=_,t.isError=x,t.isFunction=w,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(296);var R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function S(){var e=new Date,t=[O(e.getHours()),O(e.getMinutes()),O(e.getSeconds())].join(":");return[e.getDate(),R[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",S(),t.format.apply(t,arguments))},t.inherits=n(297),t._extend=function(e,t){if(!t||!T(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var M="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function I(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(M&&e[M]){var t;if("function"!=typeof(t=e[M]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,M,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,i)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),M&&Object.defineProperty(t,M,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=M,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var i=n.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var o=this,a=function(){return i.apply(o,arguments)};t.apply(this,n).then((function(t){e.nextTick(a,null,t)}),(function(t){e.nextTick(I,t,a)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,r(t)),n}}).call(this,n(70))},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(299))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(13),s=n(18),u=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return console.warn("Please ensure all debugLayer calls are removed for production:",r.key),i}return i(t,e),t.prototype.childLayers=function(){return this.props.wrap?(this.props.wrap.init[1].key="debug-wrapper."+this.props.key,[this.props.wrap]):[]},t.prototype.draw=function(){if(this.props.wrap){var e=this.resolveChanges(!0);if(0!==e.length){var t=this.props.messageHeader,n=void 0===t?function(){return""}:t;console.warn(n()+"\n",{totalChanges:e.length,changes:e})}}},t.prototype.initShader=function(){if(!this.props.wrap)return null;for(var e=new this.props.wrap.init[0](this.surface,this.scene,this.props.wrap.init[1]),t=e.childLayers(),n={};t.length>0;){var r=t.pop();if(r){var i=new r.init[0](this.surface,this.scene,r.init[1]);n[i.id]={shaderIO:i.initShader()},i.childLayers().forEach((function(e){return t.push(e)}))}}return console.warn("Shader IO: "+this.id+"\n",{shaderIO:e.initShader(),childLayers:n}),null},t.defaultProps={data:new o.InstanceProvider,key:"default",messageHeader:function(){return""},wrap:s.createLayer(a.Layer,{data:new o.InstanceProvider,scene:"default"})},t}(a.Layer);t.debugLayer=function(e,t){var n=s.createLayer(u,{messageHeader:function(){return"CHANGES FOR: "+n.init[1].key},wrap:s.createLayer(e,t),data:t.data});return n}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(25)),r(n(128)),r(n(304)),r(n(305)),r(n(310))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),s=n(15),u=n(1),c=n(50),l=n(13),h=n(0),f=n(3),d=n(302),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tint=[1,1,1,1],t}return i(t,e),o([u.observable],t.prototype,"tint",void 0),t}(u.Instance),g=new s.Texture({data:{width:2,height:2,buffer:new Uint8Array(16)}}),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.initShader=function(){var e=this,t=this.props,r=t.buffers,i=t.fs,o=new p({}),s=[[-1,-1],[1,-1],[-1,1],[1,1]],u=s.map((function(e){return[1===e[0]?1:0,1===e[1]?1:0]})),l=d.flatten2D(Object.keys(r).map((function(t){var n=r[t];if(n){var i=n.key,a=c.textureRequest({key:i});return[{name:t,shaderInjection:h.ShaderInjectionTarget.FRAGMENT,size:h.UniformSize.TEXTURE,update:function(){return e.resource.request(e,o,a),a.texture||g}},{name:t+"_size",shaderInjection:h.ShaderInjectionTarget.FRAGMENT,size:h.UniformSize.TWO,update:function(){e.resource.request(e,o,a);var t=(a.texture||g).data;return[(null==t?void 0:t.width)||1,(null==t?void 0:t.height)||1]}}]}})).filter(f.isDefined));return{drawMode:a.GLSettings.Model.DrawMode.TRIANGLE_STRIP,instanceAttributes:[{name:"tint",size:h.InstanceAttributeSize.FOUR,update:function(e){return e.tint}}],uniforms:l.concat(this.props.uniforms||[]),vertexAttributes:[{name:"vertex",size:h.VertexAttributeSize.TWO,update:function(e){return s[e]}},{name:"tex",size:h.VertexAttributeSize.TWO,update:function(e){return u[e]}}],vertexCount:4,vs:n(303),fs:i}},t.prototype.getMaterialOptions=function(){return f.CommonMaterialOptions.transparentImageBlending},t.defaultProps={key:"",data:new u.InstanceProvider([new p({})]),buffers:{},fs:"void main() { gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);"},t}(l.Layer);t.PostProcessLayer=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.flatten2D=function(e){for(var t=[],n=0,r=e.length;n<r;++n)for(var i=e[n],o=0,a=i.length;o<a;++o)t.push(i[o]);return t}},function(e,t){e.exports="varying vec2 texCoord;\nvoid main() {\ngl_Position = vec4(vertex, 0.0, 1.0);\ntexCoord = tex;\n}"},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=n(2),s=n(13),u=n(16),c=n(128);function l(e){return e.projectionType===u.CameraProjectionType.ORTHOGRAPHIC}var h=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.projection=new c.ProjectionScreen,r}return i(t,e),t.prototype.fitViewtoViewport=function(e,t){if(l(this.props.camera)){var n=t.width,r=t.height,i={bottom:-r/2,far:1e7,left:-n/2,near:-100,right:n/2,top:r/2},s=1/this.pixelRatio,u=1/this.pixelRatio,c=this.props.camera;c.projectionOptions=Object.assign(c.projectionOptions,i),c.position=[t.width/(2*this.pixelRatio),t.height/(2*this.pixelRatio),c.position[2]],c.scale=[s,-u,1],c.lookAt(a.add3(c.position,[0,0,-1]),[0,1,0]),c.update(),this.projection.viewBounds=t,t.d=this,this.projection.screenBounds=new o.Bounds({height:this.viewBounds.height/this.pixelRatio,width:this.viewBounds.width/this.pixelRatio,x:this.viewBounds.x/this.pixelRatio,y:this.viewBounds.y/this.pixelRatio}),this.screenBounds.d=this}else l(this.props.camera)||console.warn("ViewScreen does not support non-orthographic cameras.")},t.prototype.willUpdateProps=function(e){},t.defaultProps={key:"",camera:u.Camera.makeOrthographic(),viewport:{left:0,right:0,bottom:0,top:0}},t}(s.View);t.ViewScreen=h},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(129)),r(n(130)),r(n(66)),r(n(131)),r(n(132));var i=n(131),o=n(66),a=n(132),s=n(129),u=n(130);t.PostEffect={bloom:i.bloom,boxSample:o.boxSample,draw:a.draw,gaussHorizontalBlur:s.gaussHorizontalBlur,gaussVerticalBlur:u.gaussVerticalBlur}},function(e,t){e.exports="${import: camera}\nvarying vec2 texCoord;\nvoid main() {\nfloat dtx = 1.0 / viewSize.x;\nvec3 result = texture2D(color, texCoord).rgb * weight[0];\nfloat index = 1.0;\nvec2 delta = vec2(0.0, 0.0);\nfor(int i = 1; i < weight_length; ++i, index += 1.0) {\ndelta.x = dtx * index;\nresult += texture2D(color, texCoord + delta).rgb * weight[i];\nresult += texture2D(color, texCoord - delta).rgb * weight[i];\n}\ngl_FragColor = vec4(result, 1.0);\n}"},function(e,t){e.exports="${import: camera}\nvarying vec2 texCoord;\nvoid main() {\nfloat dty = 1.0 / viewSize.x;\nvec3 result = texture2D(color, texCoord).rgb * weight[0];\nfloat index = 1.0;\nvec2 delta = vec2(0.0, 0.0);\nfor(int i = 1; i < weight_length; ++i, index += 1.0) {\ndelta.y = dty * index;\nresult += texture2D(color, texCoord + delta).rgb * weight[i];\nresult += texture2D(color, texCoord - delta).rgb * weight[i];\n}\ngl_FragColor = vec4(result, 1.0);\n}"},function(e,t){e.exports="${import: camera}\nvarying vec2 texCoord;\nvoid main() {\nvec2 texelSize = 1.0 / viewSize;\nvec4 o = texelSize.xyxy * vec2(-delta, delta).xxyy;\nvec4 s =\ntexture2D(color, texCoord + o.xy) + texture2D(color, texCoord + o.zy) +\ntexture2D(color, texCoord + o.xw) + texture2D(color, texCoord + o.zw);\ngl_FragColor = s * 0.25;\n}"},function(e,t){e.exports="varying vec2 texCoord;\nvoid main() {\nvec3 result = texture2D(color, texCoord).rgb;\nresult += texture2D(glow, texCoord).rgb * 1.3;\ngl_FragColor = vec4(result, 1.0);\n}"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),i=n(13),o=n(18);t.commands=function(e){return{views:{screen:i.createView(r.View2D,{camera:new r.Camera2D,viewport:{left:0,top:0,width:1,height:1}})},layers:{screen:o.createLayer(i.CommandLayer,{commands:e})}}}}])}));
//# sourceMappingURL=index.js.map