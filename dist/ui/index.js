(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(".SurfaceJSX{flex:1 1 auto;display:flex;flex-direction:column;width:100%;height:100%;overflow:hidden}")),document.head.appendChild(e)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
(function(d,Di){var Fi=document.createElement("style");Fi.textContent=`.SurfaceJSX{flex:1 1 auto;display:flex;flex-direction:column;width:100%;height:100%;overflow:hidden}
`,document.head.appendChild(Fi),typeof exports=="object"&&typeof module<"u"?Di(exports):typeof define=="function"&&define.amd?define(["exports"],Di):(d=typeof globalThis<"u"?globalThis:d||self,Di(d.deltav={}))})(this,function(d){"use strict";window.WebGL2RenderingContext=window.WebGL2RenderingContext||function(){};class Di{get surface(){return this.userInputManager.surface}getProjection(e){const n=this.userInputManager.getView(e);return n?n.projection:null}getView(e){return this.userInputManager&&this.userInputManager.getView(e)||null}getViewScreenBounds(e){const n=this.userInputManager.getView(e);return n?n.screenBounds:null}setUserInputManager(e){this.userInputManager=e}willRender(){}didRender(){}}class Fi extends Di{constructor(e){super(),Object.assign(this,e)}handleMouseDown(e){}handleMouseUp(e){}handleMouseOver(e){}handleMouseOut(e){}handleMouseMove(e){}handleClick(e){}handleDrag(e){}handleWheel(e){}handleTouchCancelled(e){}handleTouchDown(e){}handleTouchUp(e){}handleTouchOut(e){}handleTouchDrag(e){}handleTap(e){}handleDoubleTap(e){}handleLongTouch(e){}handleLongTap(e){}handlePinch(e){}handleSpread(e){}handleTouchRotate(e){}handleSwipe(e){}}var Tu=(t=>(t[t.NONE=-1]="NONE",t[t.LEFT=0]="LEFT",t[t.AUX=1]="AUX",t[t.RIGHT=2]="RIGHT",t[t.FOURTH=3]="FOURTH",t[t.FIFTH=4]="FIFTH",t))(Tu||{});const{sqrt:To,max:jt,min:Ht,floor:Qt,ceil:Xt,abs:Yt,acos:Rg,sin:Eo}=Math,dt=new Array(20).fill(0).map(t=>[0,0,0]),Eu=new Array(20).fill(0).map(t=>[0,0,0,0]);function bu(t){return t&&Array.isArray(t)&&t.length===1}function bo(t){return t&&Array.isArray(t)&&t.length===2}function _u(t){return t&&Array.isArray(t)&&t.length===3}function Y(t){return t&&Array.isArray(t)&&t.length===4}function at(t,e){return t=t||[],t[0]=e,t}function Ws(t,e,n){return at(n,t[0]+e[0])}function _o(t,e){return at(e,Xt(t[0]))}function Ro(t,e){return t[0]===e[0]}function Ru(t,e,n){return Yt(t[0]-e[0])<=n}function Ao(t,e){return at(e,t[0])}function So(){return[0]}function Mo(t,e,n){return at(n,0)}function xo(t,e,n){return at(n,t[0]/e[0])}function Io(t){return at(t,0)}function Co(t,e){e=e||[];for(let n=0,i=t.length;n<i;++n)e.push(t[n][0]);return e}function Lo(t,e){return at(e,Qt(t[0]))}function Oo(t,e){return at(e,1/t[0])}function $s(t,e,n){return at(n,t[0]*e)}function js(t,e,n){return at(n,t[0]-e[0])}function No(t,e,n){return at(n,jt(t[0],e[0]))}function Po(t,e,n){return at(n,Ht(t[0],e[0]))}function Do(t,e,n){return at(n,t[0]*e[0])}function Fo(t,e){return at(e,1)}function Bo(t,e){return t[0]*e[0]}function Uo(t,e,n,i){return Ws($s(js(e,t),n),t,i)}function ko(t){return t[0]}function Au(t){return t}function Go(t,...e){let n;if(e=e||[],Array.isArray(t)?n=t.slice(0,1):n=[t],n.length<1)for(let i=0,r=e.length;i<r&&n.length<1;++i){const s=e[i];Array.isArray(s)?n.push(...s.slice(0,1-n.length)):n.push(s)}for(;n.length<1;)n.push(0);return n}function Le(t,e,n){return t=t||new Array(2),t[0]=e,t[1]=n,t}function Fn(t,e,n){return Le(n,t[0]+e[0],t[1]+e[1])}function zo(t,e){return Le(e,Xt(t[0]),Xt(t[1]))}function Hs(t,e){return Le(e,t[0],t[1])}function Vo(t){return Le(t,1,0)}function Wo(t,e,n){return Le(n,0,0)}function Qs(t,e){return t[0]===e[0]&&t[1]===e[1]}function Su(t,e,n){return Yt(t[0]-e[0])<=n&&Yt(t[1]-e[1])<=n}function jr(t,e,n){return Le(n,t[0]/e[0],t[1]/e[1])}function $o(t){return Le(t,0,0)}function jo(t,e){e=e||new Array(t.length*2);for(let n=0,i=0,r=t.length;n<r;++n,i+=2){const s=t[n];e[i]=s[0],e[i+1]=s[1]}return e}function Ho(t,e){return Le(e,Qt(t[0]),Qt(t[1]))}function Qo(t,e){return Le(e,1/t[0],1/t[1])}function Xo(t,e,n){return Le(n,jt(t[0],e[0]),jt(t[1],e[1]))}function Yo(t,e,n){return Le(n,Ht(t[0],e[0]),Ht(t[1],e[1]))}function He(t,e,n){return Le(n,t[0]*e,t[1]*e)}function $e(t,e,n){return Le(n,t[0]-e[0],t[1]-e[1])}function qo(t,e,n){return Le(n,t[0]*e[0],t[1]*e[1])}function Ko(t,e){const n=ii(t);return Le(e,t[0]/n,t[1]/n)}function gr(t,e){return t[0]*e[0]+t[1]*e[1]}function Zo(t,e,n,i){return Fn(He($e(e,t),n),t,i)}function ii(t){return Jo(t[0],t[1])}function Jo(t,e){return To(t*t+e*e)}function ec(t,...e){let n;if(e=e||[],Array.isArray(t)?n=t.slice(0,2):n=[t],n.length<2)for(let i=0,r=e.length;i<r&&n.length<2;++i){const s=e[i];Array.isArray(s)?n.push(...s.slice(0,2-n.length)):n.push(s)}for(;n.length<2;)n.push(0);return n}function Fe(t,e,n,i){return t=t||new Array(3),t[0]=e,t[1]=n,t[2]=i,t}function qt(t,e,n){return Fe(n,t[0]+e[0],t[1]+e[1],t[2]+e[2])}function tc(t,e){return Fe(e,Xt(t[0]),Xt(t[1]),Xt(t[2]))}function At(t,e){return Fe(e,t[0],t[1],t[2])}function Hr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Mu(t,e,n){return Yt(t[0]-e[0])<=n&&Yt(t[1]-e[1])<=n&&Yt(t[2]-e[2])<=n}function Bi(t){return Fe(t,0,0,-1)}function mt(t,e,n){return n=n||new Array(3),n[0]=t[1]*e[2]-t[2]*e[1],n[1]=t[2]*e[0]-t[0]*e[2],n[2]=t[0]*e[1]-t[1]*e[0],n}function Qr(t,e,n){return Fe(n,t[0]/e[0],t[1]/e[1],t[2]/e[2])}function nc(t){return Fe(t,0,0,0)}function ic(t,e){e=e||new Array(t.length*3);for(let n=0,i=0,r=t.length;n<r;++n,i+=3){const s=t[n];e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2]}return e}function rc(t,e){return Fe(e,Qt(t[0]),Qt(t[1]),Qt(t[2]))}function mr(t,e){return Fe(e,1/t[0],1/t[1],1/t[2])}function St(t,e,n){return Fe(n,t[0]*e,t[1]*e,t[2]*e)}function Kt(t,e,n){return Fe(n,t[0]-e[0],t[1]-e[1],t[2]-e[2])}function sc(t,e,n){return Fe(n,t[0]*e[0],t[1]*e[1],t[2]*e[2])}function ac(t,e,n,i){return qt(St(Kt(e,t),n),t,i)}function Xs(t){return oc(t[0],t[1],t[2])}function oc(t,e,n){return To(t*t+e*e+n*n)}function Ys(t,e,n){return Fe(n,jt(t[0],e[0]),jt(t[1],e[1]),jt(t[2],e[2]))}function qs(t,e,n){return Fe(n,Ht(t[0],e[0]),Ht(t[1],e[1]),Ht(t[2],e[2]))}function Ot(t,e){e=e||new Array(3);const n=Xs(t);return e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n,e}function Xr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ri(t,...e){let n;if(e=e||[],Array.isArray(t)?n=t.slice(0,3):n=[t],n.length<3)for(let i=0,r=e.length;i<r&&n.length<3;++i){const s=e[i];Array.isArray(s)?n.push(...s.slice(0,3-n.length)):n.push(s)}for(;n.length<3;)n.push(0);return n}function xu(t,e,n){return n=n||[0,0,0],Ot(mt(mt(t,e,n),t,n),n)}function Iu(t,e,n){return n=n||[0,0,0],Ot(mt(t,e,n),n)}function Cu(t,e,n){return n=n||[0,0,0],Ot(mt(e,t,n),n)}function Lu(t,e,n){return n=n||[0,0,0],Ot(mt(t,mt(t,e,n),n),n)}function Oe(t,e,n,i,r){return t=t||new Array(4),t[0]=e,t[1]=n,t[2]=i,t[3]=r,t}function Ks(t,e,n){return Oe(n,t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3]+e[3])}function Ou(t,e,n){return Oe(n,t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3])}function cc(t,e){return Oe(e,Xt(t[0]),Xt(t[1]),Xt(t[2]),Xt(t[3]))}function Zt(t,e){return Oe(e,t[0],t[1],t[2],t[3])}function Zs(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Nu(t,e,n){return Yt(t[0]-e[0])<=n&&Yt(t[1]-e[1])<=n&&Yt(t[2]-e[2])<=n&&Yt(t[3]-e[3])<=n}function lc(t){return Oe(t,0,0,-1,0)}function uc(t,e,n){return Oe(n,0,0,0,1)}function hc(t,e,n){return Oe(n,t[0]/e[0],t[1]/e[1],t[2]/e[2],t[3]/e[3])}function dc(t){return Oe(t,0,0,0,0)}function Js(t,e){e=e||new Array(4);for(let n=0,i=0,r=t.length;n<r;++n,i+=4){const s=t[n];e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3]}return e}function fc(t,e){return Oe(e,Qt(t[0]),Qt(t[1]),Qt(t[2]),Qt(t[3]))}function pc(t,e){return Oe(e,1/t[0],1/t[1],1/t[2],1/t[3])}function ea(t,e,n){return Oe(n,t[0]*e,t[1]*e,t[2]*e,t[3]*e)}function ta(t,e,n){return Oe(n,t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function gc(t,e,n){return Oe(n,t[0]*e[0],t[1]*e[1],t[2]*e[2],t[3]*e[3])}function na(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function mc(t,e,n,i){return Ks(ea(ta(e,t),n),t,i)}function ia(t){return Bn(t[0],t[1],t[2],t[3])}function Bn(t,e,n,i){return To(t*t+e*e+n*n+i*i)}function vc(t,e,n){return Oe(n,jt(t[0],e[0]),jt(t[1],e[1]),jt(t[2],e[2]),jt(t[3],e[3]))}function wc(t,e,n){return Oe(n,Ht(t[0],e[0]),Ht(t[1],e[1]),Ht(t[2],e[2]),Ht(t[3],e[3]))}function yc(t,e){const n=ia(t);return Oe(e,t[0]/n,t[1]/n,t[2]/n,t[3]/n)}function Yr(t,...e){let n;if(e=e||[],Array.isArray(t)?n=t.slice(0,4):n=[t],n.length<4)for(let i=0,r=e.length;i<r&&n.length<4;++i){const s=e[i];Array.isArray(s)?n.push(...s.slice(0,4-n.length)):n.push(s)}for(;n.length<4;)n.push(0);return n}function Pu(t,e){return e=e||[0,0,0,0],Oe(e,((t&16711680)>>16)/255,((t&65280)>>8)/255,(t&255)/255,1)}function Du(t,e){return e=e||[0,0,0,0],Oe(e,((t&4278190080)>>24)/255,((t&16711680)>>16)/255,((t&65280)>>8)/255,(t&255)/255)}function Tc(t,e,n,i){i=i||[0,0,0,0];const r=[0,0,0,0];let s,a,o,c,l;return a=t[1]*e[1]+t[2]*e[2]+t[3]*e[3]+t[0]*e[0],a<0?(a=-a,r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=-e[3]):(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3]),1-a>1e-7?(s=Rg(a),o=Eo(s),c=Eo((1-n)*s)/o,l=Eo(n*s)/o):(c=1-n,l=n),i[1]=c*t[1]+l*r[1],i[2]=c*t[2]+l*r[2],i[3]=c*t[3]+l*r[3],i[0]=c*t[0]+l*r[0],i}const Ec={add:Ws,ceil:_o,copy:Ao,compare:Ro,cross:Mo,divide:xo,dot:Bo,empty:Io,flatten:Co,floor:Lo,forward:So,inverse:Oo,length:ko,linear:Uo,max:No,min:Po,multiply:Do,normalize:Fo,scale:$s,subtract:js,vec:Go},bc={add:Fn,ceil:zo,copy:Hs,compare:Qs,cross:Wo,divide:jr,dot:gr,empty:$o,flatten:jo,floor:Ho,forward:Vo,inverse:Qo,length:ii,linear:Zo,max:Xo,min:Yo,multiply:qo,normalize:Ko,scale:He,subtract:$e,vec:ec},_c={add:qt,ceil:tc,copy:At,compare:Hr,cross:mt,divide:Qr,dot:Xr,empty:nc,flatten:ic,floor:rc,forward:Bi,inverse:mr,length:Xs,linear:ac,max:Ys,min:qs,multiply:sc,normalize:Ot,scale:St,subtract:Kt,vec:ri},Rc={add:Ks,ceil:cc,copy:Zt,compare:Zs,cross:uc,divide:hc,dot:na,empty:dc,flatten:Js,floor:fc,forward:lc,inverse:pc,length:ia,linear:mc,max:vc,min:wc,multiply:gc,normalize:yc,scale:ea,subtract:ta,vec:Yr,slerpQuat:Tc};function X(t){let e;return t.length===1?(e=Ec,e):t.length===2?(e=bc,e):t.length===3?(e=_c,e):(e=Rc,e)}function Fu(t){return`[${t[0]}]`}function Bu(t){return`[${t[0]}, ${t[1]}]`}function Uu(t){return`[${t[0]}, ${t[1]}, ${t[2]}]`}function ku(t){return`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`}const Ag=Object.freeze(Object.defineProperty({__proto__:null,V3R:dt,V4R:Eu,VecMath:X,add1:Ws,add2:Fn,add3:qt,add4:Ks,add4by3:Ou,apply1:at,apply2:Le,apply3:Fe,apply4:Oe,ceil1:_o,ceil2:zo,ceil3:tc,ceil4:cc,color4FromHex3:Pu,color4FromHex4:Du,compare1:Ro,compare2:Qs,compare3:Hr,compare4:Zs,copy1:Ao,copy2:Hs,copy3:At,copy4:Zt,cross1:Mo,cross2:Wo,cross3:mt,cross4:uc,divide1:xo,divide2:jr,divide3:Qr,divide4:hc,dot1:Bo,dot2:gr,dot3:Xr,dot4:na,down3:Lu,empty1:Io,empty2:$o,empty3:nc,empty4:dc,flatten1:Co,flatten2:jo,flatten3:ic,flatten4:Js,floor1:Lo,floor2:Ho,floor3:rc,floor4:fc,forward1:So,forward2:Vo,forward3:Bi,forward4:lc,fuzzyCompare1:Ru,fuzzyCompare2:Su,fuzzyCompare3:Mu,fuzzyCompare4:Nu,inverse1:Oo,inverse2:Qo,inverse3:mr,inverse4:pc,isVec1:bu,isVec2:bo,isVec3:_u,isVec4:Y,left3:Cu,length1:ko,length1Components:Au,length2:ii,length2Components:Jo,length3:Xs,length3Components:oc,length4:ia,length4Components:Bn,linear1:Uo,linear2:Zo,linear3:ac,linear4:mc,max1:No,max2:Xo,max3:Ys,max4:vc,min1:Po,min2:Yo,min3:qs,min4:wc,multiply1:Do,multiply2:qo,multiply3:sc,multiply4:gc,normalize1:Fo,normalize2:Ko,normalize3:Ot,normalize4:yc,right3:Iu,scale1:$s,scale2:He,scale3:St,scale4:ea,slerpQuat:Tc,subtract1:js,subtract2:$e,subtract3:Kt,subtract4:ta,toString1:Fu,toString2:Bu,toString3:Uu,toString4:ku,up3:xu,vec1:Go,vec1Methods:Ec,vec2:ec,vec2Methods:bc,vec3:ri,vec3Methods:_c,vec4:Yr,vec4Methods:Rc},Symbol.toStringTag,{value:"Module"})),{min:ra,max:sa}=Math;class ye{constructor(e){this.x=0,this.y=0,this.width=0,this.height=0,this.x=e.x||e.left||0,this.y=e.y||e.top||0,this.height=e.height||(e.bottom||0)-this.y||0,this.width=e.width||(e.right||0)-this.x||0}get area(){return this.width*this.height}get bottom(){return this.y+this.height}get left(){return this.x}get mid(){return[this.x+this.width/2,this.y+this.height/2]}get right(){return this.x+this.width}get top(){return this.y}static emptyBounds(){return new ye({height:0,width:0,x:0,y:0})}containsPoint(e){return!(e[0]<this.x||e[1]<this.y||e[0]>this.right||e[1]>this.bottom)}encapsulate(e){return e instanceof ye?(e.x<this.x&&(this.width+=Math.abs(e.x-this.x),this.x=e.x),e.y<this.y&&(this.height+=Math.abs(e.y-this.y),this.y=e.y),this.right<e.right&&(this.width+=e.right-this.right),this.bottom<e.bottom&&(this.height+=e.bottom-this.bottom),!0):(e[0]<this.x&&(this.width+=this.x-e[0],this.x=e[0]),e[0]>this.right&&(this.width+=e[0]-this.x),e[1]<this.y&&(this.height+=this.y-e[1],this.y=e[1]),e[1]>this.bottom&&(this.height+=e[1]-this.y),!0)}encapsulateAll(e){if(e.length<=0)return;let n=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;if(e[0]instanceof ye){const a=e;for(let o=0,c=a.length;o<c;++o){const l=a[o];n=ra(n,l.left),i=sa(i,l.right),r=ra(r,l.top),s=sa(s,l.bottom)}}else{const a=e;for(let o=0,c=a.length;o<c;++o){const[l,u]=a[o];n=ra(n,l),i=sa(i,l),r=ra(r,u),s=sa(s,u)}}this.x=Math.min(this.x,n),this.y=Math.min(this.y,r),this.width=Math.max(this.width,i-n),this.height=Math.max(this.height,s-r)}fits(e){return this.width===e.width&&this.height===e.height?1:this.width>=e.width&&this.height>=e.height?2:0}hitBounds(e){return!(this.right<e.x||this.x>e.right||this.bottom<e.y||this.y>e.bottom)}isInside(e){return this.x>=e.x&&this.right<=e.right&&this.y>=e.y&&this.bottom<=e.bottom}get location(){return[this.x,this.y]}toString(){return`{x: ${this.x} y:${this.y} w:${this.width} h:${this.height}}`}}function Jt(t,e,n){const i=`${t}`,r=parseFloat(i);return isNaN(r)?0:i.indexOf("%")>-1?r/100*e:r*n}const vr=new WeakSet;function Ac(t,e,n){(e.width===0||e.height===0)&&(vr.has(t)||(console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are non-zero.","item:",t,"reference:",e.toString()),vr.add(t)));const i=ye.emptyBounds();let r,s;if(t.width)i.width=Jt(t.width,e.width,n),t.left!==void 0?i.x=Jt(t.left,e.width,n):t.right!==void 0&&(i.x=e.width-Jt(t.right,e.width,n)-i.width);else{const a=Jt(t.left||0,e.width,n);r=e.width-Jt(t.right||0,e.width,n)-a,r<0&&(vr.has(t)||(console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are greater than zero.","item:",t,"reference:",e.toString()),vr.add(t))),i.x=a,i.width=r}if(t.height)i.height=Jt(t.height,e.height,n),t.top!==void 0?i.y=Jt(t.top,e.height,n):t.bottom!==void 0&&(i.y=e.height-Jt(t.bottom,e.height,n)-i.height);else{const a=Jt(t.top||0,e.height,n);s=e.height-Jt(t.bottom||0,e.height,n)-a,(s===void 0||s<0)&&(vr.has(t)||(console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are greater than zero.","item:",t,"reference:",e.toString()),vr.add(t))),i.y=a,i.height=s}return(i.width===0||i.height===0||isNaN(i.x+i.y+i.width+i.height))&&(i.x=0,i.y=0,i.width=e.width,i.height=e.height),i}class Un{constructor(e,n,i=!1,r=!1){this._isInstanced=!1,this._fullUpdate=!1,this.normalize=!1,this._needsUpdate=!1,this._updateRange={count:-1,offset:-1},this.data=e,this.size=n,this._isDynamic=i,this._isInstanced=r}get isDynamic(){return this._isDynamic}get isInstanced(){return this._isInstanced}get fullUpdate(){return this._fullUpdate}get needsUpdate(){return this._needsUpdate}get updateRange(){return this._updateRange}set updateRange(e){this._updateRange=e,this._needsUpdate=!0}destroy(){this.gl&&this.gl.proxy.disposeAttribute(this)}resolve(){this._needsUpdate=!1,this._fullUpdate=!1}setDynamic(e){this._isDynamic=e,this._needsUpdate=!0,this._fullUpdate=!0}}class si{constructor(){this._attributes={},this.maxInstancedCount=0,this.isInstanced=!1}get attributes(){return new Map(Object.entries(this._attributes))}addAttribute(e,n){this._attributes[e]=n,this.isInstanced=!1;let i;Object.values(this._attributes).forEach(r=>{const s=r.isInstanced?1:0;i===void 0&&(i=s),(i^s)===1&&(this.isInstanced=!0)})}removeAttribute(e){delete this._attributes[e]}destroy(){this.attributes.forEach(e=>e.destroy()),this.gl&&this.gl.proxy.disposeGeometry(this)}}d.GLSettings=void 0,(t=>{(e=>{(n=>{n[n.RGBA4=0]="RGBA4",n[n.RGB565=1]="RGB565",n[n.RGB5_A1=2]="RGB5_A1",n[n.R8=3]="R8",n[n.R8UI=4]="R8UI",n[n.R8I=5]="R8I",n[n.R16UI=6]="R16UI",n[n.R16I=7]="R16I",n[n.R32UI=8]="R32UI",n[n.R32I=9]="R32I",n[n.RG8=10]="RG8",n[n.RG8UI=11]="RG8UI",n[n.RG8I=12]="RG8I",n[n.RG16UI=13]="RG16UI",n[n.RG16I=14]="RG16I",n[n.RG32UI=15]="RG32UI",n[n.RG32I=16]="RG32I",n[n.RGB8=17]="RGB8",n[n.RGBA8=18]="RGBA8",n[n.SRGB8_ALPHA8=19]="SRGB8_ALPHA8",n[n.RGB10_A2=20]="RGB10_A2",n[n.RGBA8UI=21]="RGBA8UI",n[n.RGBA8I=22]="RGBA8I",n[n.RGB10_A2UI=23]="RGB10_A2UI",n[n.RGBA16UI=24]="RGBA16UI",n[n.RGBA16I=25]="RGBA16I",n[n.RGBA32I=26]="RGBA32I",n[n.RGBA32UI=27]="RGBA32UI"})(e.ColorBufferFormat||(e.ColorBufferFormat={})),(n=>{n[n.DEPTH_COMPONENT16=0]="DEPTH_COMPONENT16",n[n.DEPTH_STENCIL=1]="DEPTH_STENCIL",n[n.DEPTH_COMPONENT24=2]="DEPTH_COMPONENT24",n[n.DEPTH_COMPONENT32F=3]="DEPTH_COMPONENT32F",n[n.DEPTH24_STENCIL8=4]="DEPTH24_STENCIL8",n[n.DEPTH32F_STENCIL8=5]="DEPTH32F_STENCIL8"})(e.DepthBufferFormat||(e.DepthBufferFormat={})),(n=>{n[n.STENCIL_INDEX8=0]="STENCIL_INDEX8"})(e.StencilBufferFormat||(e.StencilBufferFormat={}))})(t.RenderTarget||(t.RenderTarget={})),(e=>{(n=>{n[n.NoBlending=-1]="NoBlending",n[n.NormalBlending=1]="NormalBlending",n[n.AdditiveBlending=2]="AdditiveBlending",n[n.SubtractiveBlending=3]="SubtractiveBlending",n[n.MultiplyBlending=4]="MultiplyBlending"})(e.Blending||(e.Blending={})),(n=>{n[n.Zero=-1]="Zero",n[n.One=1]="One",n[n.SrcColor=2]="SrcColor",n[n.OneMinusSrcColor=3]="OneMinusSrcColor",n[n.SrcAlpha=4]="SrcAlpha",n[n.OneMinusSrcAlpha=5]="OneMinusSrcAlpha",n[n.DstAlpha=6]="DstAlpha",n[n.OneMinusDstAlpha=7]="OneMinusDstAlpha",n[n.DstColor=8]="DstColor",n[n.OneMinusDstColor=9]="OneMinusDstColor"})(e.BlendingDstFactor||(e.BlendingDstFactor={})),(n=>{n[n.Zero=-1]="Zero",n[n.One=1]="One",n[n.SrcColor=2]="SrcColor",n[n.OneMinusSrcColor=3]="OneMinusSrcColor",n[n.SrcAlpha=4]="SrcAlpha",n[n.OneMinusSrcAlpha=5]="OneMinusSrcAlpha",n[n.DstAlpha=6]="DstAlpha",n[n.OneMinusDstAlpha=7]="OneMinusDstAlpha",n[n.DstColor=8]="DstColor",n[n.OneMinusDstColor=9]="OneMinusDstColor",n[n.SrcAlphaSaturate=10]="SrcAlphaSaturate"})(e.BlendingSrcFactor||(e.BlendingSrcFactor={})),(n=>{n[n.Add=-1]="Add",n[n.Subtract=1]="Subtract",n[n.ReverseSubtract=2]="ReverseSubtract"})(e.BlendingEquations||(e.BlendingEquations={})),(n=>{n[n.NEVER=-1]="NEVER",n[n.LESS=1]="LESS",n[n.EQUAL=2]="EQUAL",n[n.LESS_OR_EQUAL=3]="LESS_OR_EQUAL",n[n.GREATER=4]="GREATER",n[n.NOTEQUAL=5]="NOTEQUAL",n[n.GREATER_OR_EQUAL=6]="GREATER_OR_EQUAL",n[n.ALWAYS=7]="ALWAYS"})(e.DepthFunctions||(e.DepthFunctions={})),(n=>{n[n.NONE=-1]="NONE",n[n.CW=1]="CW",n[n.CCW=2]="CCW",n[n.BOTH=3]="BOTH"})(e.CullSide||(e.CullSide={}))})(t.Material||(t.Material={})),(e=>{(n=>{n[n.LINE_LOOP=0]="LINE_LOOP",n[n.LINE_STRIP=1]="LINE_STRIP",n[n.LINES=2]="LINES",n[n.POINTS=3]="POINTS",n[n.TRIANGLE_FAN=4]="TRIANGLE_FAN",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLES=6]="TRIANGLES"})(e.DrawMode||(e.DrawMode={}))})(t.Model||(t.Model={})),(e=>{(n=>{n[n.TEXTURE_2D=0]="TEXTURE_2D",n[n.CUBE_MAP=1]="CUBE_MAP"})(e.TextureBindingTarget||(e.TextureBindingTarget={})),(n=>{n[n.REPEAT=-1]="REPEAT",n[n.CLAMP_TO_EDGE=1]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(e.Wrapping||(e.Wrapping={})),(n=>{n[n.Nearest=-1]="Nearest",n[n.NearestMipMapNearest=1]="NearestMipMapNearest",n[n.NearestMipMapLinear=2]="NearestMipMapLinear",n[n.Linear=3]="Linear",n[n.LinearMipMapNearest=4]="LinearMipMapNearest",n[n.LinearMipMapLinear=5]="LinearMipMapLinear"})(e.TextureMinFilter||(e.TextureMinFilter={})),(n=>{n[n.Nearest=-1]="Nearest",n[n.Linear=1]="Linear"})(e.TextureMagFilter||(e.TextureMagFilter={})),(n=>{n[n.UnsignedByte=-1]="UnsignedByte",n[n.UnsignedShort_5_6_5=1]="UnsignedShort_5_6_5",n[n.UnsignedShort_4_4_4_4=2]="UnsignedShort_4_4_4_4",n[n.UnsignedShort_5_5_5_1=3]="UnsignedShort_5_5_5_1",n[n.UnsignedShort=4]="UnsignedShort",n[n.UnsignedInt=5]="UnsignedInt",n[n.UnsignedInt_24_8=6]="UnsignedInt_24_8",n[n.Byte=7]="Byte",n[n.Short=8]="Short",n[n.Int=9]="Int",n[n.Float=10]="Float",n[n.HalfFloat=11]="HalfFloat",n[n.UnsignedInt_2_10_10_10_REV=12]="UnsignedInt_2_10_10_10_REV",n[n.UnsignedInt_10F_11F_11F_REV=13]="UnsignedInt_10F_11F_11F_REV",n[n.UnsignedInt_5_9_9_9_REV=14]="UnsignedInt_5_9_9_9_REV",n[n.Float32UnsignedInt_24_8_REV=15]="Float32UnsignedInt_24_8_REV"})(e.SourcePixelFormat||(e.SourcePixelFormat={})),(n=>{n[n.Alpha=-1]="Alpha",n[n.DepthComponent=1]="DepthComponent",n[n.DepthStencil=2]="DepthStencil",n[n.Luminance=3]="Luminance",n[n.LuminanceAlpha=4]="LuminanceAlpha",n[n.RGB=5]="RGB",n[n.RGBA=6]="RGBA",n[n.RGBE=7]="RGBE",n[n.R8=8]="R8",n[n.R16F=9]="R16F",n[n.R32F=10]="R32F",n[n.R8UI=11]="R8UI",n[n.RG8=12]="RG8",n[n.RG16F=13]="RG16F",n[n.RG32F=14]="RG32F",n[n.RG8UI=15]="RG8UI",n[n.RG16UI=16]="RG16UI",n[n.RG32UI=17]="RG32UI",n[n.RGB8=18]="RGB8",n[n.SRGB8=19]="SRGB8",n[n.RGB565=20]="RGB565",n[n.R11F_G11F_B10F=21]="R11F_G11F_B10F",n[n.RGB9_E5=22]="RGB9_E5",n[n.RGB16F=23]="RGB16F",n[n.RGB32F=24]="RGB32F",n[n.RGB8UI=25]="RGB8UI",n[n.RGBA8=26]="RGBA8",n[n.SRGB8_ALPHA8=27]="SRGB8_ALPHA8",n[n.RGB5_A1=28]="RGB5_A1",n[n.RGB10_A2=29]="RGB10_A2",n[n.RGBA4=30]="RGBA4",n[n.RGBA16F=31]="RGBA16F",n[n.RGBA32F=32]="RGBA32F",n[n.RGBA8UI=33]="RGBA8UI",n[n.DEPTH_COMPONENT16=34]="DEPTH_COMPONENT16",n[n.DEPTH_COMPONENT24=35]="DEPTH_COMPONENT24",n[n.DEPTH_COMPONENT32F=36]="DEPTH_COMPONENT32F",n[n.RGBA32UI=37]="RGBA32UI",n[n.RGB32UI=38]="RGB32UI",n[n.RGBA16UI=39]="RGBA16UI",n[n.RGB16UI=40]="RGB16UI",n[n.RGBA32I=41]="RGBA32I",n[n.RGB32I=42]="RGB32I",n[n.RGBA16I=43]="RGBA16I",n[n.RGB16I=44]="RGB16I",n[n.RGBA8I=45]="RGBA8I",n[n.RGB8I=46]="RGB8I",n[n.RED_INTEGER=47]="RED_INTEGER",n[n.RG_INTEGER=48]="RG_INTEGER",n[n.RGB_INTEGER=49]="RGB_INTEGER",n[n.RGBA_INTEGER=50]="RGBA_INTEGER"})(e.TexelDataType||(e.TexelDataType={})),(n=>{n[n.ONE=1]="ONE",n[n.TWO=2]="TWO",n[n.FOUR=4]="FOUR",n[n.EIGHT=8]="EIGHT"})(e.PackAlignment||(e.PackAlignment={})),(n=>{n[n.ONE=1]="ONE",n[n.TWO=2]="TWO",n[n.FOUR=4]="FOUR",n[n.EIGHT=8]="EIGHT"})(e.UnpackAlignment||(e.UnpackAlignment={}))})(t.Texture||(t.Texture={})),(e=>{(n=>{n[n.ALPHA=0]="ALPHA",n[n.RGB=1]="RGB",n[n.RGBA=2]="RGBA"})(e.ReadFilter||(e.ReadFilter={})),(n=>{n[n.UNSIGNED_BYTE=0]="UNSIGNED_BYTE",n[n.UNSIGNED_SHORT_5_6_5=1]="UNSIGNED_SHORT_5_6_5",n[n.UNSIGNED_SHORT_4_4_4_4=2]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=3]="UNSIGNED_SHORT_5_5_5_1",n[n.FLOAT=4]="FLOAT"})(e.ReadTargetArrayFormat||(e.ReadTargetArrayFormat={}))})(t.Renderer||(t.Renderer={}))})(d.GLSettings||(d.GLSettings={}));function Sg(t,e){const n={attributeCount:0,attributes:[],uniformCount:0,uniforms:[]},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),s={35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT"},a={35664:1,35665:1,35666:1,35667:1,35668:1,35669:1,35670:1,35671:1,35672:1,35673:1,35674:1,35675:3,35676:4,35678:1,35680:1,5120:1,5121:1,5122:1,5123:1,5124:1,5125:1,5126:1};for(let o=0;o<i;++o){const c=t.getActiveUniform(e,o);c.typeName=s[c.type],n.uniforms.push(c),n.uniformCount+=c.size,c.size=c.size*a[c.type]}for(let o=0;o<r;o++){const c=t.getActiveAttrib(e,o);c.typeName=s[c.type],n.attributes.push(c),n.attributeCount+=c.size}return n}const Gu=class{static print(){return Object.assign({},Gu)}};let U=Gu;U.VAO=!1,U.DEPTH_TEXTURE=!1,U.MAX_VERTEX_UNIFORMS=0,U.MAX_FRAGMENT_UNIFORMS=0,U.MAX_VERTEX_ATTRIBUTES=0,U.WEBGL_SUPPORTED=!1,U.MAX_TEXTURE_SIZE=0,U.HARDWARE_INSTANCING=!1,U.MRT_EXTENSION=!1,U.MRT=!1,U.MAX_COLOR_ATTACHMENTS=0,U.SHADERS_3_0=!1,U.WEBGL_VERSION="none",U.FLOAT_TEXTURE_READ={half:!1,full:!1,halfLinearFilter:!1,fullLinearFilter:!1},U.FLOAT_TEXTURE_WRITE={half:!1,full:!1};function Mg(){function t(){try{const i=document.createElement("canvas");let r;return r=i.getContext("webgl2"),r?(U.WEBGL_VERSION="webgl2",r):(r=i.getContext("webgl"),r?(U.WEBGL_VERSION="webgl",r):(r=i.getContext("experimental-webgl"),r?(U.WEBGL_VERSION="experimental-webgl",r):null))}catch{return null}}function e(i){U.FLOAT_TEXTURE_READ.fullLinearFilter=!!i.getExtension("OES_texture_float_linear"),U.FLOAT_TEXTURE_READ.halfLinearFilter=!!i.getExtension("OES_texture_half_float_linear");const r=i.createTexture();if(i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.getError()!==i.NO_ERROR)throw new Error("WebGLStat could not create a texture");const s=i.getExtension("OES_texture_float")||i.getExtension("EXT_color_buffer_float");if(i.getExtension("WEBGL_color_buffer_float"),s){i.texImage2D(i.TEXTURE_2D,0,i instanceof WebGL2RenderingContext?i.RGBA32F:i.RGBA,2,2,0,i.RGBA,i.FLOAT,null),i.getError()===i.NO_ERROR&&(U.FLOAT_TEXTURE_READ.full=!0);const u=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,u),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,r,0),i.bindTexture(i.TEXTURE_2D,null),i.checkFramebufferStatus(i.FRAMEBUFFER)===i.FRAMEBUFFER_COMPLETE&&(U.FLOAT_TEXTURE_WRITE.full=!0),i.deleteFramebuffer(u),i.deleteTexture(r)}const a=i.createTexture();if(i.bindTexture(i.TEXTURE_2D,a),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.getError()!==i.NO_ERROR)throw new Error("WebGLStat could not create a texture");const o=i.getExtension("OES_texture_half_float")||i.getExtension("EXT_color_buffer_float");if(o){i.texImage2D(i.TEXTURE_2D,0,i instanceof WebGL2RenderingContext?i.RGBA16F:i.RGBA,2,2,0,i.RGBA,i instanceof WebGL2RenderingContext?i.HALF_FLOAT:o.HALF_FLOAT_OES,null),i.getError()===i.NO_ERROR&&(U.FLOAT_TEXTURE_READ.full=!0);const u=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,u),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,a,0),i.bindTexture(i.TEXTURE_2D,null),i.checkFramebufferStatus(i.FRAMEBUFFER)===i.FRAMEBUFFER_COMPLETE&&(U.FLOAT_TEXTURE_WRITE.full=!0),i.deleteFramebuffer(u),i.deleteTexture(a)}}const n=t();if(n)if(U.WEBGL_SUPPORTED=!0,U.MAX_VERTEX_UNIFORMS=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),U.MAX_FRAGMENT_UNIFORMS=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),U.MAX_VERTEX_ATTRIBUTES=n.getParameter(n.MAX_VERTEX_ATTRIBS),U.MAX_TEXTURE_SIZE=n.getParameter(n.MAX_TEXTURE_SIZE),e(n),n instanceof WebGL2RenderingContext)U.VAO=!0,U.MRT=!0,U.HARDWARE_INSTANCING=!0,U.SHADERS_3_0=!0,U.HARDWARE_INSTANCING=!0,U.DEPTH_TEXTURE=!0,U.MAX_COLOR_ATTACHMENTS=n.getParameter(n.MAX_COLOR_ATTACHMENTS);else{U.VAO=!!n.getExtension("OES_vertex_array_object"),U.HARDWARE_INSTANCING=!!n.getExtension("ANGLE_instanced_arrays");const i=n.getExtension("WEBGL_draw_buffers");U.MRT_EXTENSION=!!i,U.MRT=!!i,U.DEPTH_TEXTURE=!!n.getExtension("WEBGL_depth_texture"),i&&(U.MAX_COLOR_ATTACHMENTS=n.getParameter(i.MAX_COLOR_ATTACHMENTS_WEBGL))}window.WebGLStat=U}Mg();function aa(t,e){switch(e){case d.GLSettings.Model.DrawMode.LINES:return t.LINES;case d.GLSettings.Model.DrawMode.LINE_LOOP:return t.LINE_LOOP;case d.GLSettings.Model.DrawMode.LINE_STRIP:return t.LINE_STRIP;case d.GLSettings.Model.DrawMode.POINTS:return t.POINTS;case d.GLSettings.Model.DrawMode.TRIANGLES:return t.TRIANGLES;case d.GLSettings.Model.DrawMode.TRIANGLE_FAN:return t.TRIANGLE_FAN;case d.GLSettings.Model.DrawMode.TRIANGLE_STRIP:return t.TRIANGLE_STRIP;default:return t.TRIANGLES}}function Ui(t,e){switch(e){case d.GLSettings.Texture.TexelDataType.Alpha:return t.ALPHA;case d.GLSettings.Texture.TexelDataType.DepthComponent:return t.DEPTH_COMPONENT;case d.GLSettings.Texture.TexelDataType.DepthStencil:return t.DEPTH_STENCIL;case d.GLSettings.Texture.TexelDataType.Luminance:return t.LUMINANCE;case d.GLSettings.Texture.TexelDataType.LuminanceAlpha:return t.LUMINANCE_ALPHA;case d.GLSettings.Texture.TexelDataType.RGB:return t.RGB;case d.GLSettings.Texture.TexelDataType.RGBA:return t.RGBA;default:if(t instanceof WebGL2RenderingContext)switch(e){case d.GLSettings.Texture.TexelDataType.R8:return t.R8;case d.GLSettings.Texture.TexelDataType.R16F:return t.R16F;case d.GLSettings.Texture.TexelDataType.R32F:return t.R32F;case d.GLSettings.Texture.TexelDataType.R8UI:return t.R8UI;case d.GLSettings.Texture.TexelDataType.RG8:return t.RG8;case d.GLSettings.Texture.TexelDataType.RG16F:return t.RG16F;case d.GLSettings.Texture.TexelDataType.RG32F:return t.RG32F;case d.GLSettings.Texture.TexelDataType.RG8UI:return t.RG8UI;case d.GLSettings.Texture.TexelDataType.RG16UI:return t.RG16UI;case d.GLSettings.Texture.TexelDataType.RG32UI:return t.RG32UI;case d.GLSettings.Texture.TexelDataType.RGB8:return t.RGB8;case d.GLSettings.Texture.TexelDataType.SRGB8:return t.SRGB8;case d.GLSettings.Texture.TexelDataType.RGB565:return t.RGB565;case d.GLSettings.Texture.TexelDataType.R11F_G11F_B10F:return t.R11F_G11F_B10F;case d.GLSettings.Texture.TexelDataType.RGB9_E5:return t.RGB9_E5;case d.GLSettings.Texture.TexelDataType.RGB16F:return t.RGB16F;case d.GLSettings.Texture.TexelDataType.RGB32F:return t.RGB32F;case d.GLSettings.Texture.TexelDataType.RGB8UI:return t.RGB8UI;case d.GLSettings.Texture.TexelDataType.RGBA8:return t.RGBA8;case d.GLSettings.Texture.TexelDataType.SRGB8_ALPHA8:return t.SRGB8_ALPHA8;case d.GLSettings.Texture.TexelDataType.RGB5_A1:return t.RGB5_A1;case d.GLSettings.Texture.TexelDataType.RGB10_A2:return t.RGB10_A2;case d.GLSettings.Texture.TexelDataType.RGBA4:return t.RGBA4;case d.GLSettings.Texture.TexelDataType.RGBA16F:return t.RGBA16F;case d.GLSettings.Texture.TexelDataType.RGBA32F:return U.FLOAT_TEXTURE_READ.full&&U.FLOAT_TEXTURE_WRITE.full?t.RGBA32F:t.RGBA16F;case d.GLSettings.Texture.TexelDataType.RGBA8UI:return t.RGBA8UI;case d.GLSettings.Texture.TexelDataType.DEPTH_COMPONENT16:return t.DEPTH_COMPONENT16;case d.GLSettings.Texture.TexelDataType.DEPTH_COMPONENT24:return t.DEPTH_COMPONENT24;case d.GLSettings.Texture.TexelDataType.DEPTH_COMPONENT32F:return t.DEPTH_COMPONENT32F;case d.GLSettings.Texture.TexelDataType.RGBA32UI:return t.RGBA32UI;case d.GLSettings.Texture.TexelDataType.RGB32UI:return t.RGB32UI;case d.GLSettings.Texture.TexelDataType.RGBA16UI:return t.RGBA16UI;case d.GLSettings.Texture.TexelDataType.RGB16UI:return t.RGB16UI;case d.GLSettings.Texture.TexelDataType.RGBA32I:return t.RGBA32I;case d.GLSettings.Texture.TexelDataType.RGB32I:return t.RGB32I;case d.GLSettings.Texture.TexelDataType.RGBA16I:return t.RGBA16I;case d.GLSettings.Texture.TexelDataType.RGB16I:return t.RGB16I;case d.GLSettings.Texture.TexelDataType.RGBA8I:return t.RGBA8I;case d.GLSettings.Texture.TexelDataType.RGB8I:return t.RGB8I;default:return console.warn("An unsupported texel format was provided that is not supported in WebGL 1 or 2"),t.RGBA}return console.warn("An Unsupported texel format was provided. Some formats are only available in WebGL 2",e),t.RGBA}}function qr(t,e){switch(e){case d.GLSettings.Texture.SourcePixelFormat.Byte:return t.BYTE;case d.GLSettings.Texture.SourcePixelFormat.Float:return t.FLOAT;case d.GLSettings.Texture.SourcePixelFormat.HalfFloat:return console.warn("Unsupported HALF_FLOAT"),t.BYTE;case d.GLSettings.Texture.SourcePixelFormat.Int:return t.INT;case d.GLSettings.Texture.SourcePixelFormat.Short:return t.SHORT;case d.GLSettings.Texture.SourcePixelFormat.UnsignedByte:return t.UNSIGNED_BYTE;case d.GLSettings.Texture.SourcePixelFormat.UnsignedInt:return t.UNSIGNED_INT;case d.GLSettings.Texture.SourcePixelFormat.UnsignedShort:return t.UNSIGNED_SHORT;case d.GLSettings.Texture.SourcePixelFormat.UnsignedShort_4_4_4_4:return t.UNSIGNED_SHORT_4_4_4_4;case d.GLSettings.Texture.SourcePixelFormat.UnsignedShort_5_5_5_1:return t.UNSIGNED_SHORT_5_5_5_1;case d.GLSettings.Texture.SourcePixelFormat.UnsignedShort_5_6_5:return t.UNSIGNED_SHORT_5_6_5;default:return console.warn("An Unsupported input image format was provided",e),t.BYTE}}function ki(t,e){switch(e){case d.GLSettings.Texture.TextureMagFilter.Linear:return t.LINEAR;case d.GLSettings.Texture.TextureMagFilter.Nearest:return t.NEAREST}}function kn(t,e,n){switch(e){case d.GLSettings.Texture.TextureMinFilter.Linear:return t.LINEAR;case d.GLSettings.Texture.TextureMinFilter.Nearest:return t.NEAREST;case d.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear:return n?t.LINEAR_MIPMAP_LINEAR:t.LINEAR;case d.GLSettings.Texture.TextureMinFilter.LinearMipMapNearest:return n?t.LINEAR_MIPMAP_NEAREST:t.LINEAR;case d.GLSettings.Texture.TextureMinFilter.NearestMipMapLinear:return n?t.NEAREST_MIPMAP_LINEAR:t.NEAREST;case d.GLSettings.Texture.TextureMinFilter.NearestMipMapNearest:return n?t.NEAREST_MIPMAP_NEAREST:t.NEAREST;default:return t.LINEAR}}function zu(t,e){switch(e){case d.GLSettings.RenderTarget.ColorBufferFormat.RGB565:return t.RGB565;case d.GLSettings.RenderTarget.ColorBufferFormat.RGB5_A1:return t.RGB5_A1;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA4:return t.RGBA4;default:if(t instanceof WebGL2RenderingContext)switch(e){case d.GLSettings.RenderTarget.ColorBufferFormat.R8:return t.R8;case d.GLSettings.RenderTarget.ColorBufferFormat.R8UI:return t.R8UI;case d.GLSettings.RenderTarget.ColorBufferFormat.R8I:return t.R8I;case d.GLSettings.RenderTarget.ColorBufferFormat.R16UI:return t.R16UI;case d.GLSettings.RenderTarget.ColorBufferFormat.R16I:return t.R16I;case d.GLSettings.RenderTarget.ColorBufferFormat.R32UI:return t.R32UI;case d.GLSettings.RenderTarget.ColorBufferFormat.R32I:return t.R32I;case d.GLSettings.RenderTarget.ColorBufferFormat.RG8:return t.RG8;case d.GLSettings.RenderTarget.ColorBufferFormat.RG8UI:return t.RG8UI;case d.GLSettings.RenderTarget.ColorBufferFormat.RG8I:return t.RG8I;case d.GLSettings.RenderTarget.ColorBufferFormat.RG16UI:return t.RG16UI;case d.GLSettings.RenderTarget.ColorBufferFormat.RG16I:return t.RG16I;case d.GLSettings.RenderTarget.ColorBufferFormat.RG32UI:return t.RG32UI;case d.GLSettings.RenderTarget.ColorBufferFormat.RG32I:return t.RG32I;case d.GLSettings.RenderTarget.ColorBufferFormat.RGB8:return t.RGB8;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA8:return t.RGBA8;case d.GLSettings.RenderTarget.ColorBufferFormat.SRGB8_ALPHA8:return t.SRGB8_ALPHA8;case d.GLSettings.RenderTarget.ColorBufferFormat.RGB10_A2:return t.RGB10_A2;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA8UI:return t.RGBA8UI;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA8I:return t.RGBA8I;case d.GLSettings.RenderTarget.ColorBufferFormat.RGB10_A2UI:return t.RGB10_A2UI;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA16UI:return t.RGBA16UI;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA16I:return t.RGBA16I;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA32I:return t.RGBA32I;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA32UI:return t.RGBA32UI}return t.RGBA4}}function Vu(t,e){switch(e){case d.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT16:return t.DEPTH_COMPONENT16;case d.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_STENCIL:return t.DEPTH_STENCIL;default:if(t instanceof WebGL2RenderingContext)switch(e){case d.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT24:return t.DEPTH_COMPONENT24;case d.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT32F:return t.DEPTH_COMPONENT32F;case d.GLSettings.RenderTarget.DepthBufferFormat.DEPTH24_STENCIL8:return t.DEPTH24_STENCIL8;case d.GLSettings.RenderTarget.DepthBufferFormat.DEPTH32F_STENCIL8:return t.DEPTH32F_STENCIL8}return t.DEPTH_COMPONENT16}}function Wu(t,e){switch(e){case d.GLSettings.RenderTarget.StencilBufferFormat.STENCIL_INDEX8:return t.STENCIL_INDEX8;default:return t.STENCIL_INDEX8}}function Sc(t,e){switch(e){case d.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE:return t.CLAMP_TO_EDGE;case d.GLSettings.Texture.Wrapping.MIRRORED_REPEAT:return t.MIRRORED_REPEAT;case d.GLSettings.Texture.Wrapping.REPEAT:return t.REPEAT}}function Kr(t,e,n,i,r){if(i)return t.COLOR_ATTACHMENT0;const s=e.drawBuffers;if(r){if(s instanceof WebGL2RenderingContext)switch(n){case-2:return t.BACK;case-1:return t.NONE;case 0:return s.DRAW_BUFFER0;case 1:return s.DRAW_BUFFER1;case 2:return s.DRAW_BUFFER2;case 3:return s.DRAW_BUFFER3;case 4:return s.DRAW_BUFFER4;case 5:return s.DRAW_BUFFER5;case 6:return s.DRAW_BUFFER6;case 7:return s.DRAW_BUFFER7;case 8:return s.DRAW_BUFFER8;case 9:return s.DRAW_BUFFER9;case 10:return s.DRAW_BUFFER10;case 11:return s.DRAW_BUFFER11;case 12:return s.DRAW_BUFFER12;case 13:return s.DRAW_BUFFER13;case 14:return s.DRAW_BUFFER14;case 15:return s.DRAW_BUFFER15;default:console.warn("Attachments are only available for -2 - 15")}else if(s)switch(n){case-2:return t.BACK;case-1:return t.NONE;case 0:return s.DRAW_BUFFER0_WEBGL;case 1:return s.DRAW_BUFFER1_WEBGL;case 2:return s.DRAW_BUFFER2_WEBGL;case 3:return s.DRAW_BUFFER3_WEBGL;case 4:return s.DRAW_BUFFER4_WEBGL;case 5:return s.DRAW_BUFFER5_WEBGL;case 6:return s.DRAW_BUFFER6_WEBGL;case 7:return s.DRAW_BUFFER7_WEBGL;case 8:return s.DRAW_BUFFER8_WEBGL;case 9:return s.DRAW_BUFFER9_WEBGL;case 10:return s.DRAW_BUFFER10_WEBGL;case 11:return s.DRAW_BUFFER11_WEBGL;case 12:return s.DRAW_BUFFER12_WEBGL;case 13:return s.DRAW_BUFFER13_WEBGL;case 14:return s.DRAW_BUFFER14_WEBGL;case 15:return s.DRAW_BUFFER15_WEBGL;default:console.warn("Attachments are only available for 0 - 15")}}else if(s instanceof WebGL2RenderingContext)switch(n){case-2:return t.BACK;case-1:return t.NONE;case 0:return s.COLOR_ATTACHMENT0;case 1:return s.COLOR_ATTACHMENT1;case 2:return s.COLOR_ATTACHMENT2;case 3:return s.COLOR_ATTACHMENT3;case 4:return s.COLOR_ATTACHMENT4;case 5:return s.COLOR_ATTACHMENT5;case 6:return s.COLOR_ATTACHMENT6;case 7:return s.COLOR_ATTACHMENT7;case 8:return s.COLOR_ATTACHMENT8;case 9:return s.COLOR_ATTACHMENT9;case 10:return s.COLOR_ATTACHMENT10;case 11:return s.COLOR_ATTACHMENT11;case 12:return s.COLOR_ATTACHMENT12;case 13:return s.COLOR_ATTACHMENT13;case 14:return s.COLOR_ATTACHMENT14;case 15:return s.COLOR_ATTACHMENT15;default:console.warn("Attachments are only available for -2 - 15")}else if(s)switch(n){case-2:return t.BACK;case-1:return t.NONE;case 0:return s.COLOR_ATTACHMENT0_WEBGL;case 1:return s.COLOR_ATTACHMENT1_WEBGL;case 2:return s.COLOR_ATTACHMENT2_WEBGL;case 3:return s.COLOR_ATTACHMENT3_WEBGL;case 4:return s.COLOR_ATTACHMENT4_WEBGL;case 5:return s.COLOR_ATTACHMENT5_WEBGL;case 6:return s.COLOR_ATTACHMENT6_WEBGL;case 7:return s.COLOR_ATTACHMENT7_WEBGL;case 8:return s.COLOR_ATTACHMENT8_WEBGL;case 9:return s.COLOR_ATTACHMENT9_WEBGL;case 10:return s.COLOR_ATTACHMENT10_WEBGL;case 11:return s.COLOR_ATTACHMENT11_WEBGL;case 12:return s.COLOR_ATTACHMENT12_WEBGL;case 13:return s.COLOR_ATTACHMENT13_WEBGL;case 14:return s.COLOR_ATTACHMENT14_WEBGL;case 15:return s.COLOR_ATTACHMENT15_WEBGL;default:console.warn("Attachments are only available for 0 - 15")}return t.COLOR_ATTACHMENT0}function $u(t,e){return t.TEXTURE0+e}function Mc(t,e){return e-t.TEXTURE0}function ju(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var xc={exports:{}},Ic={exports:{}},Zr=1e3,Jr=Zr*60,es=Jr*60,ts=es*24,xg=ts*365.25,Ig=function(t,e){e=e||{};var n=typeof t;if(n==="string"&&t.length>0)return Cg(t);if(n==="number"&&isNaN(t)===!1)return e.long?Og(t):Lg(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function Cg(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),i=(e[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return n*xg;case"days":case"day":case"d":return n*ts;case"hours":case"hour":case"hrs":case"hr":case"h":return n*es;case"minutes":case"minute":case"mins":case"min":case"m":return n*Jr;case"seconds":case"second":case"secs":case"sec":case"s":return n*Zr;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function Lg(t){return t>=ts?Math.round(t/ts)+"d":t>=es?Math.round(t/es)+"h":t>=Jr?Math.round(t/Jr)+"m":t>=Zr?Math.round(t/Zr)+"s":t+"ms"}function Og(t){return oa(t,ts,"day")||oa(t,es,"hour")||oa(t,Jr,"minute")||oa(t,Zr,"second")||t+" ms"}function oa(t,e,n){if(!(t<e))return t<e*1.5?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}(function(t,e){e=t.exports=i.debug=i.default=i,e.coerce=c,e.disable=a,e.enable=s,e.enabled=o,e.humanize=Ig,e.instances=[],e.names=[],e.skips=[],e.formatters={};function n(l){var u=0,h;for(h in l)u=(u<<5)-u+l.charCodeAt(h),u|=0;return e.colors[Math.abs(u)%e.colors.length]}function i(l){var u;function h(){if(h.enabled){var f=h,p=+new Date,m=p-(u||p);f.diff=m,f.prev=u,f.curr=p,u=p;for(var v=new Array(arguments.length),T=0;T<v.length;T++)v[T]=arguments[T];v[0]=e.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");var b=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,function(S,I){if(S==="%%")return S;b++;var M=e.formatters[I];if(typeof M=="function"){var N=v[b];S=M.call(f,N),v.splice(b,1),b--}return S}),e.formatArgs.call(f,v);var E=h.log||e.log||console.log.bind(console);E.apply(f,v)}}return h.namespace=l,h.enabled=e.enabled(l),h.useColors=e.useColors(),h.color=n(l),h.destroy=r,typeof e.init=="function"&&e.init(h),e.instances.push(h),h}function r(){var l=e.instances.indexOf(this);return l!==-1?(e.instances.splice(l,1),!0):!1}function s(l){e.save(l),e.names=[],e.skips=[];var u,h=(typeof l=="string"?l:"").split(/[\s,]+/),f=h.length;for(u=0;u<f;u++)h[u]&&(l=h[u].replace(/\*/g,".*?"),l[0]==="-"?e.skips.push(new RegExp("^"+l.substr(1)+"$")):e.names.push(new RegExp("^"+l+"$")));for(u=0;u<e.instances.length;u++){var p=e.instances[u];p.enabled=e.enabled(p.namespace)}}function a(){e.enable("")}function o(l){if(l[l.length-1]==="*")return!0;var u,h;for(u=0,h=e.skips.length;u<h;u++)if(e.skips[u].test(l))return!1;for(u=0,h=e.names.length;u<h;u++)if(e.names[u].test(l))return!0;return!1}function c(l){return l instanceof Error?l.stack||l.message:l}})(Ic,Ic.exports);var Ng=Ic.exports;(function(t,e){e=t.exports=Ng,e.log=r,e.formatArgs=i,e.save=s,e.load=a,e.useColors=n,e.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:o(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}e.formatters.j=function(c){try{return JSON.stringify(c)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}};function i(c){var l=this.useColors;if(c[0]=(l?"%c":"")+this.namespace+(l?" %c":" ")+c[0]+(l?"%c ":" ")+"+"+e.humanize(this.diff),!!l){var u="color: "+this.color;c.splice(1,0,u,"color: inherit");var h=0,f=0;c[0].replace(/%[a-zA-Z%]/g,function(p){p!=="%%"&&(h++,p==="%c"&&(f=h))}),c.splice(f,0,u)}}function r(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(c){try{c==null?e.storage.removeItem("debug"):e.storage.debug=c}catch{}}function a(){var c;try{c=e.storage.debug}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=process.env.DEBUG),c}e.enable(a());function o(){try{return window.localStorage}catch{}}})(xc,xc.exports);var Pg=xc.exports;const Ke=ju(Pg);class Hu{constructor(e){this._destroyed=!1,this._internalFormat=d.GLSettings.RenderTarget.ColorBufferFormat.RGBA4,this.needsSettingsUpdate=!1,this._size=[0,0],this.size=e.size||this.size,this.internalFormat=e.internalFormat??this.internalFormat}get destroyed(){return this._destroyed}get internalFormat(){return this._internalFormat}set internalFormat(e){this.needsSettingsUpdate=!0,this._internalFormat=e}get size(){return this._size}set size(e){this.needsSettingsUpdate=!0,this._size=e}destroy(){this.gl&&this.gl.proxy.disposeColorBuffer(this),this._destroyed=!0}}var Cc=(t=>(t[t.INVALID=0]="INVALID",t[t.ONE=1]="ONE",t[t.TWO=2]="TWO",t[t.THREE=3]="THREE",t[t.FOUR=4]="FOUR",t))(Cc||{}),k=(t=>(t[t.ONE=1]="ONE",t[t.TWO=2]="TWO",t[t.THREE=3]="THREE",t[t.FOUR=4]="FOUR",t[t.MAT4X4=16]="MAT4X4",t[t.ATLAS=99]="ATLAS",t))(k||{});const Qu={[1]:1,[2]:2,[3]:3,[4]:4,[16]:16,[99]:4};var O=(t=>(t[t.ONE=1]="ONE",t[t.TWO=2]="TWO",t[t.THREE=3]="THREE",t[t.FOUR=4]="FOUR",t[t.MATRIX3=9]="MATRIX3",t[t.MATRIX4=16]="MATRIX4",t[t.FLOAT_ARRAY=97]="FLOAT_ARRAY",t[t.VEC4_ARRAY=98]="VEC4_ARRAY",t[t.TEXTURE=99]="TEXTURE",t))(O||{}),vt=(t=>(t[t.ONE=1]="ONE",t[t.TWO=2]="TWO",t[t.THREE=3]="THREE",t[t.FOUR=4]="FOUR",t))(vt||{}),Nt=(t=>(t[t.SCREEN_256TH=-256]="SCREEN_256TH",t[t.SCREEN_128TH=-128]="SCREEN_128TH",t[t.SCREEN_64TH=-64]="SCREEN_64TH",t[t.SCREEN_32ND=-32]="SCREEN_32ND",t[t.SCREEN_16TH=-16]="SCREEN_16TH",t[t.SCREEN_8TH=-8]="SCREEN_8TH",t[t.SCREEN_QUARTER=-4]="SCREEN_QUARTER",t[t.SCREEN_HALF=-2]="SCREEN_HALF",t[t.SCREEN=-1]="SCREEN",t[t._2=2]="_2",t[t._4=4]="_4",t[t._8=8]="_8",t[t._16=16]="_16",t[t._32=32]="_32",t[t._64=64]="_64",t[t._128=128]="_128",t[t._256=256]="_256",t[t._512=512]="_512",t[t._1024=1024]="_1024",t[t._2048=2048]="_2048",t[t._4096=4096]="_4096",t))(Nt||{}),xe=(t=>(t[t.ATLAS=0]="ATLAS",t[t.FONT=1]="FONT",t[t.TEXTURE=2]="TEXTURE",t[t.COLOR_BUFFER=3]="COLOR_BUFFER",t))(xe||{}),_e=(t=>(t[t.zyx=0]="zyx",t[t.zyz=1]="zyz",t[t.zxy=2]="zxy",t[t.zxz=3]="zxz",t[t.yxz=4]="yxz",t[t.yxy=5]="yxy",t[t.yzx=6]="yzx",t[t.yzy=7]="yzy",t[t.xyz=8]="xyz",t[t.xyx=9]="xyx",t[t.xzy=10]="xzy",t[t.xzx=11]="xzx",t))(_e||{});function Dg(t){return t.size!==void 0&&t.size<=4}function Fg(t){return!!(t&&t.resource)}var G=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.ALL=3]="ALL",t))(G||{});function ca(){}const Bg=/\s/g,Lc=/\s/,Gi=Lc.test.bind(Lc),Xu=/\n\r|\n|\r/g,Oc=/\n\r|\n|\r/,Ug=Oc.test.bind(Oc);function kg(t){return t}var oe=(t=>(t[t.NONE=0]="NONE",t[t.SINGLE=1]="SINGLE",t))(oe||{}),Ze=(t=>(t[t.CHANGE=0]="CHANGE",t[t.INSERT=1]="INSERT",t[t.REMOVE=2]="REMOVE",t))(Ze||{}),Nc=(t=>(t[t.NO_WEBGL_CONTEXT=0]="NO_WEBGL_CONTEXT",t))(Nc||{}),Qe=(t=>(t[t.UNIFORM=1]="UNIFORM",t[t.INSTANCE_ATTRIBUTE=2]="INSTANCE_ATTRIBUTE",t[t.INSTANCE_ATTRIBUTE_PACKING=3]="INSTANCE_ATTRIBUTE_PACKING",t))(Qe||{}),la=(t=>(t[t.LINEAR=0]="LINEAR",t))(la||{});function Gn(t){return t!==void 0&&t.charCodeAt!==void 0}function Gg(t){return t!==void 0&&t.toExponential!==void 0}function zg(t){return t!==void 0&&t.call!==void 0&&t.apply!==void 0}function ai(t){return t===!0||t===!1}var ge=(t=>(t[t.NONE=0]="NONE",t[t.BLANK=1]="BLANK",t[t.COLOR=2]="COLOR",t[t.DEPTH=3]="DEPTH",t[t.NORMAL=4]="NORMAL",t[t.PICKING=5]="PICKING",t[t.POSITION=6]="POSITION",t[t.POSITION_X=7]="POSITION_X",t[t.POSITION_Y=8]="POSITION_Y",t[t.POSITION_Z=9]="POSITION_Z",t[t.LIGHTS=10]="LIGHTS",t[t.LIGHTS2=11]="LIGHTS2",t[t.LIGHTS3=12]="LIGHTS3",t[t.ALPHA=13]="ALPHA",t[t.BETA=14]="BETA",t[t.GAMMA=15]="GAMMA",t[t.DELTA=16]="DELTA",t[t.ACCUMULATION1=17]="ACCUMULATION1",t[t.ACCUMULATION2=18]="ACCUMULATION2",t[t.ACCUMULATION3=19]="ACCUMULATION3",t[t.ACCUMULATION4=20]="ACCUMULATION4",t[t.COEFFICIENT1=21]="COEFFICIENT1",t[t.COEFFICIENT2=22]="COEFFICIENT2",t[t.COEFFICIENT3=23]="COEFFICIENT3",t[t.COEFFICIENT4=24]="COEFFICIENT4",t[t.ANGLE1=25]="ANGLE1",t[t.ANGLE2=26]="ANGLE2",t[t.ANGLE3=27]="ANGLE3",t[t.ANGLE4=28]="ANGLE4",t[t.COLOR2=29]="COLOR2",t[t.COLOR3=30]="COLOR3",t[t.COLOR4=31]="COLOR4",t[t.GLOW=32]="GLOW",t[t.BLUR=33]="BLUR",t))(ge||{});let Vg=1;function K(){return++Vg}let Wg=0;function $g(){return++Wg%16777215}class Se{constructor(e){this._uid=K(),this._destroyed=!1,this._flipY=!1,this._format=d.GLSettings.Texture.TexelDataType.RGBA,this._generateMipmaps=!1,this._internalFormat=d.GLSettings.Texture.TexelDataType.RGBA,this._magFilter=d.GLSettings.Texture.TextureMagFilter.Linear,this._minFilter=d.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear,this.needsDataUpload=!1,this.needsPartialDataUpload=!1,this.needsSettingsUpdate=!1,this._packAlignment=d.GLSettings.Texture.PackAlignment.FOUR,this._premultiplyAlpha=!1,this._type=d.GLSettings.Texture.SourcePixelFormat.UnsignedByte,this._unpackAlignment=d.GLSettings.Texture.UnpackAlignment.FOUR,this._updateRegions=[],this._wrapHorizontal=d.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE,this._wrapVertical=d.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE,this.anisotropy=e.anisotropy||this.anisotropy,this.data=e.data||this.data,this.flipY=e.flipY||this.flipY,this.format=e.format||this.format,this.internalFormat=e.internalFormat||this.format,this.generateMipMaps=e.generateMipMaps||this.generateMipMaps,this.magFilter=e.magFilter||this.magFilter,this.minFilter=e.minFilter||this.minFilter,this.packAlignment=e.packAlignment||this.packAlignment,this.premultiplyAlpha=e.premultiplyAlpha||this.premultiplyAlpha,this.type=e.type||this.type,this.unpackAlignment=e.unpackAlignment||this.unpackAlignment,this.wrapHorizontal=e.wrapHorizontal||this.wrapHorizontal,this.wrapVertical=e.wrapVertical||this.wrapVertical}static get emptyTexture(){return jg}get uid(){return this._uid}get destroyed(){return this._destroyed}get anisotropy(){return this._anisotropy}set anisotropy(e){this.needsSettingsUpdate=!0,this._anisotropy=e}get data(){return this._data}set data(e){this.needsDataUpload=!0,this._data=e}get flipY(){return this._flipY}set flipY(e){this.needsDataUpload=!0,this._flipY=e}get format(){return this._format}set format(e){this.needsDataUpload=!0,this._format=e}get generateMipMaps(){return this._generateMipmaps}set generateMipMaps(e){this.needsSettingsUpdate=!0,this._generateMipmaps=e}get internalFormat(){return this._internalFormat}set internalFormat(e){this.needsDataUpload=!0,this._internalFormat=e}get magFilter(){return this._magFilter}set magFilter(e){this.needsSettingsUpdate=!0,this._magFilter=e}get minFilter(){return this._minFilter}set minFilter(e){this.needsSettingsUpdate=!0,this._minFilter=e}get packAlignment(){return this._packAlignment}set packAlignment(e){this.needsSettingsUpdate=!0,this._packAlignment=e}get premultiplyAlpha(){return this._premultiplyAlpha}set premultiplyAlpha(e){this.needsSettingsUpdate=!0,this._premultiplyAlpha=e}get type(){return this._type}set type(e){this.needsDataUpload=!0,this._type=e}get unpackAlignment(){return this._unpackAlignment}set unpackAlignment(e){this.needsSettingsUpdate=!0,this._unpackAlignment=e}get updateRegions(){return this._updateRegions}get wrapHorizontal(){return this._wrapHorizontal}set wrapHorizontal(e){this.needsSettingsUpdate=!0,this._wrapHorizontal=e}get wrapVertical(){return this._wrapVertical}set wrapVertical(e){this.needsSettingsUpdate=!0,this._wrapVertical=e}get isHalfFloatTexture(){switch(this._internalFormat){case d.GLSettings.Texture.TexelDataType.R16F:case d.GLSettings.Texture.TexelDataType.RG16F:case d.GLSettings.Texture.TexelDataType.RGB16F:return!0}switch(this._type){case d.GLSettings.Texture.SourcePixelFormat.HalfFloat:return!0}return!1}get isFloatTexture(){switch(this._internalFormat){case d.GLSettings.Texture.TexelDataType.R11F_G11F_B10F:case d.GLSettings.Texture.TexelDataType.R16F:case d.GLSettings.Texture.TexelDataType.RG16F:case d.GLSettings.Texture.TexelDataType.R32F:case d.GLSettings.Texture.TexelDataType.RG32F:case d.GLSettings.Texture.TexelDataType.RGB16F:case d.GLSettings.Texture.TexelDataType.RGB32F:return!0}switch(this._type){case d.GLSettings.Texture.SourcePixelFormat.Float:case d.GLSettings.Texture.SourcePixelFormat.HalfFloat:return!0}return!1}destroy(){this.gl&&this.gl.proxy.disposeTexture(this),this._destroyed=!0,delete this._data}resolve(){this.needsDataUpload=!1,this.needsPartialDataUpload=!1,this.needsSettingsUpdate=!1,this._updateRegions=[]}update(e,n){this.needsPartialDataUpload=!0,this._updateRegions.push([e,n])}}const jg=new Se({data:{width:2,height:2,buffer:new Uint8Array(16)}}),zn=Ke("performance");function Yu(t){return t&&t.buffer&&t.buffer.byteOffset!==void 0&&t.buffer.byteLength||t.buffer===null}function wr(t){return(t&t-1)===0}function ua(t){return!!(t.gl&&t.gl.textureId&&t.gl.textureUnit>-1)}class ns{constructor(e,n,i){this.debugContext="",this.fragmentShaders=new Map,this.vertexShaders=new Map,this.programs=new Map,this.gl=e,this.state=n,this.extensions=i}static addExtensions(e){const n=e.getExtension("ANGLE_instanced_arrays"),i=e.getExtension("WEBGL_draw_buffers"),r=e.getExtension("OES_texture_float"),s=e.getExtension("OES_texture_float_linear"),a=e.getExtension("OES_texture_half_float"),o=e.getExtension("OES_texture_half_float_linear"),c=e.getExtension("EXT_texture_filter_anisotropic"),l=e.getExtension("EXT_color_buffer_float"),u=e.getExtension("OES_vertex_array_object"),h={maxAnistropicFilter:0};return!n&&!(e instanceof WebGL2RenderingContext)&&zn("This device does not have hardware instancing. All buffering strategies will be utilizing compatibility modes."),!i&&!(e instanceof WebGL2RenderingContext)&&zn("This device does not have hardware multi-render target capabilities. The system will have to fallback to multiple render passes to multiple FBOs to achieve the same result."),c?h.maxAnistropicFilter=e.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):zn("This device does not have hardware anisotropic filtering for textures. This property will be ignored when setting texture settings."),!u&&!(e instanceof WebGL2RenderingContext)&&zn("This device does not support Vertex Array Objects. This could cause performance issues for high numbers of draw calls."),{instancing:(e instanceof WebGL2RenderingContext?e:n)||void 0,drawBuffers:(e instanceof WebGL2RenderingContext?e:i)||void 0,anisotropicFiltering:c?{ext:c,stat:h}:void 0,renderFloatTexture:l||void 0,floatTex:(e instanceof WebGL2RenderingContext?e:r)||void 0,floatTexFilterLinear:(e instanceof WebGL2RenderingContext?e:s)||void 0,halfFloatTex:(e instanceof WebGL2RenderingContext?e:a)||void 0,halfFloatTexFilterLinear:(e instanceof WebGL2RenderingContext?e:o)||void 0,vao:(e instanceof WebGL2RenderingContext?e:u)||void 0}}clear(e,n,i){let r=0;e&&(r=r|this.gl.COLOR_BUFFER_BIT),n&&(r=r|this.gl.DEPTH_BUFFER_BIT),i&&(r=r|this.gl.STENCIL_BUFFER_BIT),this.gl.clear(r)}compileAttribute(e){if(e.gl)return;const n=this.gl,i=n.createBuffer();if(!i){console.warn(this.debugContext,"Could bot create WebGLBuffer. Printing any existing gl errors:"),this.printError();return}return this.state.bindVBO(i),n.bufferData(n.ARRAY_BUFFER,e.data,e.isDynamic?n.DYNAMIC_DRAW:n.STATIC_DRAW),e.gl={bufferId:i,type:n.ARRAY_BUFFER,proxy:this},e.resolve(),!0}compileGeometry(e){if(e.gl)return;let n=!0;if(e.gl={proxy:this},this.extensions.vao){let i;this.extensions.vao instanceof WebGL2RenderingContext?i=this.extensions.vao.createVertexArray():i=this.extensions.vao.createVertexArrayOES(),i?(this.state.disableVertexAttributeArray(),this.state.bindVAO(i),e.attributes.forEach((r,s)=>{this.updateAttribute(r)&&this.useAttribute(s,r,e)}),e.gl.vao=i,this.state.bindVAO(null)):zn("WARNING: Could not make VAO for Geometry. This is fine, but this could cause a hit on performance.")}return e.attributes.forEach(i=>{n=!!(this.compileAttribute(i)&&n)}),n}compileMaterial(e){if(e.gl)return;let n=this.vertexShaders.get(e.vertexShader)||null;if(!n){if(n=this.gl.createShader(this.gl.VERTEX_SHADER),!n){console.warn(this.debugContext,"Could not create a Vertex WebGLShader. Printing GL Errors:"),this.printError();return}if(this.gl.shaderSource(n,e.vertexShader),this.gl.compileShader(n),this.gl.isContextLost()&&console.warn("Context was lost during compilation"),!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)){console.error(this.debugContext,"VERTEX SHADER COMPILER ERROR",e.name),console.warn("Could not compile provided shader. Printing logs and errors:"),console.warn(this.lineFormatShader(e.vertexShader)),console.warn("LOGS:"),console.warn(this.gl.getShaderInfoLog(n)),this.printError(),this.gl.deleteShader(n);return}}let i=this.programs.get(n);i||(i=new Map,this.programs.set(n,i));const r={vsId:n,fsId:[],programId:[],proxy:this,programByTarget:new WeakMap,outputsByProgram:new WeakMap},s=new Set;if(!e.fragmentShader)return console.warn("A material appears to not have it's fragment shader configuration set."),!1;e.fragmentShader.forEach(o=>{var f,p;if(!i||!n)return;let c=this.fragmentShaders.get(o.source)||null;if(!c){if(c=this.gl.createShader(this.gl.FRAGMENT_SHADER),!c){console.warn(this.debugContext,"Could not create a Fragment WebGLShader. Printing GL Errors:"),this.printError();return}if(this.gl.shaderSource(c,o.source),this.gl.compileShader(c),this.gl.isContextLost()&&console.warn("Context was lost during compilation"),!this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS)){console.error(this.debugContext,"FRAGMENT SHADER COMPILER ERROR:",e.name),console.warn("Could not compile provided shader. Printing logs and errors:"),console.warn(this.lineFormatShader(o.source)),console.warn("LOGS:"),console.warn(this.gl.getShaderInfoLog(c)),this.printError(),this.gl.deleteShader(c);return}}let l=i.get(c)||null;if(l)l.useCount++;else{const m=this.gl.createProgram();if(!m){console.warn(this.debugContext,"Could not create a WebGLProgram. Printing GL Errors:"),this.printError();return}if(l={useCount:1,program:m},this.gl.attachShader(m,n),this.gl.attachShader(m,c),this.gl.linkProgram(m),this.gl.validateProgram(m),!this.gl.getProgramParameter(m,this.gl.LINK_STATUS)||!this.gl.getProgramParameter(m,this.gl.VALIDATE_STATUS)){const v=this.gl.getProgramInfoLog(m);console.warn(this.debugContext,`Could not compile WebGL program. 

`,v),this.printError(),this.gl.deleteProgram(m);return}i.set(c,l)}(f=r.fsId)==null||f.push({id:c,outputTypes:o.outputTypes}),(p=r.programId)==null||p.push({id:l.program,outputTypes:o.outputTypes}),r.outputsByProgram.set(l.program,o.outputTypes),this.state.useProgram(l.program);const u=this.state.currentProgram;if(!u)return!1;const h=this.gl.getProgramParameter(u,this.gl.ACTIVE_UNIFORMS);for(let m=0;m<h;m++){const v=this.gl.getActiveUniform(u,m);v&&s.add(v.name.replace("[0]",""))}}),e.gl=r;const a=new Set;return Object.keys(e.uniforms).forEach(o=>{s.has(o)||a.add(o)}),a.forEach(o=>{delete e.uniforms[o]}),Object.keys(e.uniforms).length!==s.size?(console.warn(this.debugContext,"A program is requesting a set of uniforms:",Array.from(s.values()),"but our material only provides",Object.keys(e.uniforms),"thus the expected rendering will be considered invalid."),!1):!0}compileRenderTarget(e){if(e.isInvalid)return!1;if(e.gl)return!0;const n=this.gl,i=n.createFramebuffer();if(!i)return console.warn(this.debugContext,"Could not generate a frame buffer object. Printing GL errors:"),this.printError(),!1;this.state.bindFBO(i);const r={fboId:i,proxy:this,fboByMaterial:new WeakMap};if(Array.isArray(e.buffers.color)){if(!this.extensions.drawBuffers)return console.warn("Attempted to manage a render target with MRT but the hardware does not support MRT. Use multiple render targets instead."),!1;const l=[];let u=!0;r.colorBufferId=l;const h=e.buffers.color.length<=1;if(e.buffers.color.forEach((f,p)=>{if(u)if(f.buffer instanceof Se){const m=Kr(n,this.extensions,p,h,!1);l.push({data:f.buffer,outputType:f.outputType,attachment:m}),ua(f.buffer)?n.framebufferTexture2D(n.FRAMEBUFFER,m,n.TEXTURE_2D,f.buffer.gl.textureId,0):(console.warn(this.debugContext,"Attempted to compile render target whose target texture was not ready for use."),u=!1)}else{const m=this.compileColorBuffer(f.buffer,e.width,e.height);if(m){const v=Kr(n,this.extensions,p,h,!1);l.push({data:m,outputType:f.outputType,attachment:v}),n.framebufferRenderbuffer(n.FRAMEBUFFER,v,n.RENDERBUFFER,m)}}}),!u)return!1}else if(e.buffers.color!==void 0){const l=e.buffers.color;if(l.buffer instanceof Se){const u=Kr(n,this.extensions,0,!0,!1);if(r.colorBufferId={data:l.buffer,outputType:l.outputType,attachment:u},ua(l.buffer))n.framebufferTexture2D(n.FRAMEBUFFER,u,n.TEXTURE_2D,l.buffer.gl.textureId,0);else return console.warn(this.debugContext,"Attempted to compile render target whose target texture was not ready for use."),!1}else{const u=this.compileColorBuffer(l.buffer,e.width,e.height);if(u){const h=Kr(n,this.extensions,0,!0,!1);r.colorBufferId={data:u,outputType:l.outputType,attachment:h},n.framebufferRenderbuffer(n.FRAMEBUFFER,h,n.RENDERBUFFER,u)}}}if(e.buffers.depth!==void 0){const l=e.buffers.depth;if(l instanceof Se)r.depthBufferId=l,ua(l)&&n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,l.gl.textureId,0);else if(l instanceof Hu){const u=this.compileDepthBuffer(l.internalFormat,e.width,e.height);u&&(r.depthBufferId=u,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,u))}else{const u=this.compileDepthBuffer(l,e.width,e.height);u&&(r.depthBufferId=u,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,u))}}if(e.buffers.stencil!==void 0){const l=e.buffers.stencil;if(l instanceof Se)r.stencilBufferId=l,ua(l)&&n.framebufferTexture2D(n.FRAMEBUFFER,n.STENCIL_ATTACHMENT,n.TEXTURE_2D,l.gl.textureId,0);else{const u=this.compileStencilBuffer(l,e.width,e.height);u&&(r.stencilBufferId=u,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.STENCIL_ATTACHMENT,n.RENDERBUFFER,u))}}e.gl=r;const s=n.checkFramebufferStatus(n.FRAMEBUFFER);let a=!1,o=!1,c="";switch(s){case n.FRAMEBUFFER_COMPLETE:e.setAsValid();break;case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:c="FRAMEBUFFER_INCOMPLETE_ATTACHMENT";break;case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:c="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";break;case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:c="FRAMEBUFFER_INCOMPLETE_DIMENSIONS";break;case n.FRAMEBUFFER_UNSUPPORTED:c="FRAMEBUFFER_UNSUPPORTED";break;default:a=!0;break}if(n instanceof WebGL2RenderingContext)switch(s){case n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:c="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE";break;case n.RENDERBUFFER_SAMPLES:c="RENDERBUFFER_SAMPLES";break;default:o=!0;break}return a&&o&&(console.warn(this.debugContext,"A framebuffer check failed to return a known result. This FBO for render target will be assumed failed"),console.warn("Result:",s,"Render Target:",e),c="UNKNOWN"),c?(console.warn(this.debugContext,"When creating a new FrameBuffer Object, the check on the framebuffer failed. Printing Errors:"),console.warn(c),this.printError(),console.warn("FAILED RENDER TARGET:",e),delete e.gl,e.isInvalid=!0,!1):!0}compileDepthBuffer(e,n,i){const r=this.gl,s=r.createRenderbuffer();if(!s){console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),this.printError();return}return this.state.bindRBO(s),r.renderbufferStorage(r.RENDERBUFFER,Vu(r,e),n,i),s}compileStencilBuffer(e,n,i){const r=this.gl,s=r.createRenderbuffer();if(!s){console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),this.printError();return}return this.state.bindRBO(s),r.renderbufferStorage(r.RENDERBUFFER,Wu(r,e),n,i),s}compileColorBuffer(e,n,i){const r=this.gl,s=r.createRenderbuffer();if(!s){console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),this.printError();return}return this.state.bindRBO(s),r.renderbufferStorage(r.RENDERBUFFER,zu(r,e.internalFormat),n,i),e.gl={bufferId:s,proxy:this},s}compileTexture(e){if(!e.gl||e.gl.textureId)return;if(e.gl.textureUnit<0){console.warn(this.debugContext,"A Texture object attempted to be compiled without an established Texture Unit.",e);return}this.state.setActiveTextureUnit(e.gl.textureUnit);const i=this.gl.createTexture();if(!i){console.warn(this.debugContext,"Could not generate a texture object on the GPU. Printing any gl errors:"),this.printError();return}return e.gl.textureId=i,e.needsDataUpload=!0,e.needsSettingsUpdate=!0,this.updateTextureData(e),this.updateTextureSettings(e),!0}draw(e){let n,i=[0,0];e.vertexDrawRange&&e.vertexDrawRange[0]>=0&&e.vertexDrawRange[1]>=0?i=[e.vertexDrawRange[0],e.vertexDrawRange[1]-e.vertexDrawRange[0]]:i=[0,e.vertexCount],e.drawInstances>=0&&e.geometry.isInstanced&&(n=this.extensions.instancing),!((U.MRT||U.MRT_EXTENSION)&&this.state.renderTarget&&!this.state.drawBuffers.find(r=>r!==this.gl.NONE))&&(n&&n instanceof WebGL2RenderingContext?n.drawArraysInstanced(aa(this.gl,e.drawMode),i[0],i[1],e.drawInstances):n?n.drawArraysInstancedANGLE(aa(this.gl,e.drawMode),i[0],i[1],e.drawInstances):this.gl.drawArrays(aa(this.gl,e.drawMode),i[0],i[1]),this.state.setDrawBuffers([],!0))}disposeAttribute(e){e.gl&&(this.gl.deleteBuffer(e.gl.bufferId),delete e.gl)}disposeColorBuffer(e){e.gl&&(e.gl.bufferId&&this.disposeRenderBuffer(e.gl.bufferId),delete e.gl)}disposeGeometry(e){e.gl&&this.extensions.vao&&e.gl.vao&&(this.extensions.vao instanceof WebGL2RenderingContext?this.extensions.vao.deleteVertexArray(e.gl.vao):this.extensions.vao.deleteVertexArrayOES(e.gl.vao))}disposeMaterial(e){if(e.gl){const{vsId:n,fsId:i,programId:r}=e.gl;let s=this.programs.get(n);s||(s=new Map,this.gl.deleteShader(n));for(let a=0,o=i.length;a<o;++a){const c=i[a];let l=s.get(c);l||(l={useCount:0,program:r}),l.useCount--,l.useCount<1&&(this.gl.deleteProgram(l.program),s.delete(c),s.size<=0&&this.gl.deleteShader(n));let u=!1;this.programs.forEach(h=>{h.has(c)&&(u=!0)}),u||this.gl.deleteShader(c)}}delete e.gl}disposeRenderBuffer(e){this.gl.deleteRenderbuffer(e)}disposeRenderTarget(e){e.gl&&(Array.isArray(e.gl.colorBufferId)?e.gl.colorBufferId.forEach(n=>{n.data instanceof Se&&!e.retainTextureTargets?this.disposeTexture(n.data):n.data instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(n.data)}):e.gl.colorBufferId&&e.gl.colorBufferId.data instanceof Se&&!e.retainTextureTargets?this.disposeTexture(e.gl.colorBufferId.data):e.gl.colorBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.colorBufferId.data),e.gl.depthBufferId instanceof Se&&!e.retainTextureTargets?this.disposeTexture(e.gl.depthBufferId):e.gl.depthBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.depthBufferId),e.gl.stencilBufferId instanceof Se&&!e.retainTextureTargets?this.disposeTexture(e.gl.stencilBufferId):e.gl.stencilBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.stencilBufferId),this.gl.deleteFramebuffer(e.gl.fboId),delete e.gl)}disposeTexture(e){e.gl&&!e.destroyed&&(this.gl.deleteTexture(e.gl.textureId),this.state.freeTextureUnit(e)),delete e.gl}static getContext(e,n){const i=[U.WEBGL_VERSION,"webgl","webgl2","experimental-webgl"];let r=null,s={};for(let a=0;a<i.length;++a){const o=i[a],c=e.getContext(o,n);if(c&&(c instanceof WebGLRenderingContext||c instanceof WebGL2RenderingContext)){zn("Generated GL Context of version with attributes:",o,n),r=c,s=ns.addExtensions(r);break}}return{context:r,extensions:s}}printError(){const e=this.gl.getError();switch(e){case this.gl.NO_ERROR:console.warn("GL Error: No Error");break;case this.gl.INVALID_ENUM:console.warn("GL Error: INVALID ENUM");break;case this.gl.INVALID_VALUE:console.warn("GL Error: INVALID_VALUE");break;case this.gl.INVALID_OPERATION:console.warn("GL Error: INVALID OPERATION");break;case this.gl.INVALID_FRAMEBUFFER_OPERATION:console.warn("GL Error: INVALID FRAMEBUFFER OPERATION");break;case this.gl.OUT_OF_MEMORY:console.warn("GL Error: OUT OF MEMORY");break;case this.gl.CONTEXT_LOST_WEBGL:console.warn("GL Error: CONTEXT LOST WEBGL");break;default:console.warn("GL Error: GL Context output an unrecognized error value:",e);break}}lineFormat(e){const n=e.split(`
`),i=String(n.length).length+1;return`
${n.map((r,s)=>`${Array(i-String(s+1).length).join(" ")}${s+1}: ${r}`).join(`
`)}`}lineFormatShader(e){return e?Gn(e)?this.lineFormat(e):e.forEach(n=>`
SHADER FOR OUTPUT TYPES: ${n.outputTypes} ${this.lineFormat(n.source)}`):"NO SHADER FOUND"}updateTexture(e){if(!e.gl||e.gl.textureUnit<0){console.warn(this.debugContext,"Can not update or compile a texture that does not have an established texture unit.",e);return}this.compileTexture(e),this.updateTextureData(e),this.updateTexturePartialData(e),this.updateTextureSettings(e),e.resolve()}updateTextureData(e){if(!e.needsDataUpload||!e.gl||!e.gl.textureId)return;if(e.gl.textureUnit<0){console.warn(this.debugContext,"A Texture object attempted to update it's data without an established Texture Unit.",e);return}const n=this.gl;if(this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,d.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D),e.needsSettingsUpdate=!0,this.updateTextureSettings(e),n instanceof WebGLRenderingContext||n instanceof WebGL2RenderingContext){if(Yu(e.data)){(!wr(e.data.width)||!wr(e.data.height))&&zn("Created a texture that is not using power of 2 dimensions.");const i=Ui(n,e.internalFormat),r=Ui(n,e.format);n instanceof WebGLRenderingContext&&i!==r&&console.warn("WebGL 1 requires format and data format to be identical"),n.texImage2D(n.TEXTURE_2D,0,i,e.data.width,e.data.height,0,r,qr(n,e.type),e.data.buffer)}else e.data&&((!wr(e.data.width)||!wr(e.data.height))&&zn("Created a texture that is not using power of 2 dimensions. %o",e),n.texImage2D(n.TEXTURE_2D,0,Ui(n,e.internalFormat),Ui(n,e.format),qr(n,e.type),e.data));e.generateMipMaps&&n.generateMipmap(n.TEXTURE_2D)}e.data&&(e.data={width:e.data.width,height:e.data.height,buffer:null}),e.needsDataUpload=!1}updateTexturePartialData(e){if(!e.needsPartialDataUpload||!e.gl||!e.gl.textureId)return;if(e.gl.textureUnit<0){console.warn(this.debugContext,"A Texture object attempted to update it's data without an established Texture Unit.",e);return}const n=this.gl;this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,d.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D),e.updateRegions.forEach(i=>{const r=i[0],s=i[1];(n instanceof WebGLRenderingContext||n instanceof WebGL2RenderingContext)&&(Yu(r)?n.texSubImage2D(n.TEXTURE_2D,0,s.x,s.y,r.width,r.height,Ui(n,e.format),qr(n,e.type),r.buffer):r&&n.texSubImage2D(n.TEXTURE_2D,0,s.x,s.y,Ui(n,e.format),qr(n,e.type),r),e.generateMipMaps&&n.generateMipmap(n.TEXTURE_2D))}),e.needsPartialDataUpload=!1}updateTextureSettings(e){if(!e.needsSettingsUpdate||!e.gl||!e.data||!e.gl.textureId)return;if(e.gl.textureUnit<0){console.warn(this.debugContext,"A Texture object attempted to update it's settings without an established Texture Unit.",e);return}const n=wr(e.data.width)&&wr(e.data.height),i=this.gl;this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,d.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D);let r,s;if(e.isHalfFloatTexture)if(U.FLOAT_TEXTURE_READ.halfLinearFilter)switch(r=ki(i,e.magFilter),e.minFilter){case d.GLSettings.Texture.TextureMinFilter.Nearest:case d.GLSettings.Texture.TextureMinFilter.NearestMipMapLinear:case d.GLSettings.Texture.TextureMinFilter.NearestMipMapNearest:s=kn(i,d.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);break;case d.GLSettings.Texture.TextureMinFilter.Linear:case d.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear:case d.GLSettings.Texture.TextureMinFilter.LinearMipMapNearest:s=kn(i,d.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);break}else r=ki(i,d.GLSettings.Texture.TextureMagFilter.Nearest),s=kn(i,d.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);else if(e.isFloatTexture)if(U.FLOAT_TEXTURE_READ.fullLinearFilter)switch(r=ki(i,e.magFilter),e.minFilter){case d.GLSettings.Texture.TextureMinFilter.Nearest:case d.GLSettings.Texture.TextureMinFilter.NearestMipMapLinear:case d.GLSettings.Texture.TextureMinFilter.NearestMipMapNearest:s=kn(i,d.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);break;case d.GLSettings.Texture.TextureMinFilter.Linear:case d.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear:case d.GLSettings.Texture.TextureMinFilter.LinearMipMapNearest:s=kn(i,d.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);break}else r=ki(i,d.GLSettings.Texture.TextureMagFilter.Nearest),s=kn(i,d.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);else!n&&i instanceof WebGLRenderingContext?(r=ki(i,d.GLSettings.Texture.TextureMagFilter.Linear),s=kn(i,d.GLSettings.Texture.TextureMinFilter.Linear,e.generateMipMaps)):(r=ki(i,e.magFilter),s=kn(i,e.minFilter,e.generateMipMaps));if(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,s),e.isFloatTexture||(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,Sc(i,e.wrapHorizontal)),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,Sc(i,e.wrapVertical))),e.isFloatTexture||(i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e.flipY)),this.extensions.anisotropicFiltering){const{ext:a,stat:o}=this.extensions.anisotropicFiltering,c=Math.min(o.maxAnistropicFilter,Math.floor(e.anisotropy||0));!isNaN(c)&&!e.isFloatTexture&&i.texParameterf(i.TEXTURE_2D,a.TEXTURE_MAX_ANISOTROPY_EXT,c)}e.needsSettingsUpdate=!1}updateAttribute(e){if(!e.gl)return this.compileAttribute(e);if(!e.fullUpdate&&!e.needsUpdate)return!0;const n=this.gl;if(e.fullUpdate||e.updateRange.count<0||e.updateRange.offset<0)this.state.bindVBO(e.gl.bufferId),n.bufferData(n.ARRAY_BUFFER,e.data,e.isDynamic?n.DYNAMIC_DRAW:n.STATIC_DRAW);else if(e.updateRange.count>0){this.state.bindVBO(e.gl.bufferId);const i=e.updateRange.offset;n.bufferSubData(n.ARRAY_BUFFER,i*4,e.data.subarray(i,i+e.updateRange.count))}return e.resolve(),!0}useAttribute(e,n,i){if(!this.state.currentProgram||!n.gl)return!1;n.gl.locations=n.gl.locations||new Map;let r=n.gl.locations.get(this.state.currentProgram);if(r===void 0&&(r=this.gl.getAttribLocation(this.state.currentProgram,e),r===-1&&zn("WARN: An attribute is not being used with the current material: %o",e,n),n.gl.locations.set(this.state.currentProgram,r)),r!==-1){switch(this.state.bindVBO(n.gl.bufferId),n.size){case 1:case 2:case 3:case 4:this.state.willUseVertexAttributeArray(r),this.gl.vertexAttribPointer(r,n.size,this.gl.FLOAT,n.normalize,0,0),i.isInstanced&&n.isInstanced&&this.extensions.instancing?this.state.setVertexAttributeArrayDivisor(r,1):this.state.setVertexAttributeArrayDivisor(r,0);break;default:{const s=Math.ceil(n.size/4);for(let a=0;a<s;++a)this.state.willUseVertexAttributeArray(r+a),this.gl.vertexAttribPointer(r+a,4,this.gl.FLOAT,n.normalize,s*4*4,a*16),i.isInstanced&&n.isInstanced&&this.extensions.instancing?this.state.setVertexAttributeArrayDivisor(r+a,1):this.state.setVertexAttributeArrayDivisor(r+a,0);break}}return!0}}}var je=(t=>(t[t.FLOAT=0]="FLOAT",t[t.VEC2=1]="VEC2",t[t.VEC3=2]="VEC3",t[t.VEC4=3]="VEC4",t[t.VEC4_ARRAY=4]="VEC4_ARRAY",t[t.FLOAT_ARRAY=5]="FLOAT_ARRAY",t[t.MATRIX3x3=6]="MATRIX3x3",t[t.MATRIX4x4=7]="MATRIX4x4",t[t.TEXTURE=8]="TEXTURE",t))(je||{});function Hg(t){return t.type===1}function Qg(t){return t.type===2}function Xg(t){return t.type===3}function qu(t){return t.type===4}function Yg(t){return t.type===6}function qg(t){return t.type===7}function Kg(t){return t.type===8}function Zg(t){return t.type===0}const Jg=window.OffscreenCanvas||ca;function zi(t){return t instanceof Jg}var kt=(t=>(t[t.INVALID=0]="INVALID",t[t.VALID=1]="VALID",t[t.NO_RENDER_TARGET_MATCHES=2]="NO_RENDER_TARGET_MATCHES",t))(kt||{});class oi{constructor(e){this.isInvalid=!1,this._uid=K(),this._validFramebuffer=!1,this._disabledTargets=new Set,this.retainTextureTargets=!1,this._buffers={color:Array.isArray(e.buffers.color)?e.buffers.color.slice(0):e.buffers.color,depth:e.buffers.depth,stencil:e.buffers.stencil},this._width=e.width||0,this._height=e.height||0,this.retainTextureTargets=e.retainTextureTargets||!1,this.calculateDimensions()}get uid(){return this._uid}get buffers(){return{color:Array.isArray(this._buffers.color)?this._buffers.color.slice(0):this._buffers.color,depth:this._buffers.depth,stencil:this._buffers.stencil}}get height(){return this._height}get width(){return this._width}get validFramebuffer(){return this._validFramebuffer}get disabledTargets(){return this._disabledTargets}set disabledTargets(e){this._disabledTargets=e}calculateDimensions(){const e=[];if(this._buffers.color instanceof Se)e.push(this._buffers.color);else if(Array.isArray(this._buffers.color))for(let n=0,i=this._buffers.color.length;n<i;++n){const r=this._buffers.color[n];r.buffer instanceof Se&&e.push(r.buffer)}else this._buffers.color&&this._buffers.color.buffer instanceof Se&&e.push(this._buffers.color.buffer);if(this._buffers.depth instanceof Se&&e.push(this._buffers.depth),this._buffers.stencil instanceof Se&&e.push(this._buffers.stencil),e.length>0&&e[0].data){const{width:n,height:i}=e[0].data;for(let r=0,s=e.length;r<s;++r){const a=e[r];if(!a.data){console.warn("A texture specified for thie RenderTarget did not have any data associated with it.");return}const{width:o,height:c}=a.data;(o!==n||c!==i)&&(console.warn("Texture applied to the render target is invalid as it does not match dimensions of all textures applied:",a,e,"The texture will be removed as a target for the render target"),this.removeTextureFromBuffer(a))}this._width=n,this._height=i}(!this._width||!this._height)&&console.warn("A RenderTarget was not able to establish valid dimensions. This target had no texture buffers and did not specify valid width and height values.",this)}dispose(){this.gl&&this.gl.proxy.disposeRenderTarget(this)}getBuffers(){return Array.isArray(this.buffers.color)?this.buffers.color:this.buffers.color?[this.buffers.color]:[]}getGLBuffers(){return this.gl?Array.isArray(this.gl.colorBufferId)?this.gl.colorBufferId:[this.gl.colorBufferId]:(this.isInvalid||console.warn("Attempted to retrieve gl buffers before the render target was compiled."),[])}getOutputTypes(){return this.getBuffers().map(e=>e.outputType)}getSize(){return[this._width,this._height]}getTextures(){const e=[];return Array.isArray(this.buffers.color)?this.buffers.color.forEach(n=>{n.buffer instanceof Se&&e.push(n.buffer)}):this.buffers.color&&this.buffers.color.buffer instanceof Se&&e.push(this.buffers.color.buffer),this.buffers.depth instanceof Se&&e.push(this.buffers.depth),this.buffers.stencil instanceof Se&&e.push(this.buffers.stencil),e}isColorTarget(){var e;if(Array.isArray(this.buffers.color)){if(this.buffers.color.length===1)return this.buffers.color[0].outputType===ge.COLOR}else return((e=this.buffers.color)==null?void 0:e.outputType)===ge.COLOR;return!1}removeTextureFromBuffer(e){var n;if(Array.isArray(this._buffers.color)){const i=this._buffers.color.find(s=>s.buffer===e);if(!i)return;const r=this._buffers.color.indexOf(i);r>-1&&this._buffers.color.splice(r,1)}else((n=this._buffers.color)==null?void 0:n.buffer)===e&&delete this._buffers.color;this._buffers.depth===e&&delete this._buffers.depth,this._buffers.stencil===e&&delete this._buffers.stencil}setSize(e,n){this.dispose(),this._width=e,this._height=n,this.getTextures().forEach(r=>{r.data={buffer:null,height:n,width:e}})}setAsValid(){this._validFramebuffer=!0}}const Ku=Ke("performance");class Zu{constructor(e,n){this.debugContext="",this._textureUnitToTexture=new Map,this._freeUnits=[],this._blendingEnabled=!0,this._blendDstFactor=d.GLSettings.Material.BlendingDstFactor.One,this._blendSrcFactor=d.GLSettings.Material.BlendingDstFactor.One,this._blendEquation=d.GLSettings.Material.BlendingEquations.Add,this._cullFace=d.GLSettings.Material.CullSide.NONE,this._colorMask=[!0,!0,!0,!0],this._clearColor=[0,0,0,1],this._depthFunc=d.GLSettings.Material.DepthFunctions.ALWAYS,this._depthTestEnabled=!0,this._depthMask=!0,this._ditheringEnabled=!0,this._boundFBO=null,this._renderTarget=null,this._boundRBO=null,this._boundVAO=null,this._boundVBO=null,this._boundTexture={id:null,unit:-1},this._currentProgram=null,this._scissorTestEnabled=!1,this._scissorBounds={x:0,y:0,width:1,height:1},this._currentUniforms={},this._activeTextureUnit=-1,this._drawBuffers=[],this._textureWillBeUsed=new Map,this._viewport={x:0,y:0,width:100,height:100},this._enabledVertexAttributeArray=[],this._willUseVertexAttributeArray=[],this._vertexAttributeArrayDivisor=new Map,this.gl=e,this.extensions=n;const i=this.gl.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);for(let r=0;r<i;++r)this._freeUnits.push($u(e,r));this._activeTextureUnit=e.TEXTURE0}get blendingEnabled(){return this._blendingEnabled}get blendDstFactor(){return this._blendDstFactor}get blendSrcFactor(){return this._blendSrcFactor}get blendEquation(){return this._blendEquation}get cullFace(){return this._cullFace}get colorMask(){return this._colorMask}get clearColor(){return this._clearColor}get depthFunc(){return this._depthFunc}get depthTestEnabled(){return this._depthTestEnabled}get depthMask(){return this._depthMask}get ditheringEnabled(){return this._ditheringEnabled}get boundFBO(){return this._boundFBO}get renderTarget(){return this._renderTarget}get boundRBO(){return this._boundRBO}get boundVAO(){return this._boundVAO}get boundVBO(){return this._boundVBO}get boundTexture(){return this._boundTexture}get currentProgram(){return this._currentProgram}get scissorTestEnabled(){return this._scissorTestEnabled}get scissorBounds(){return this._scissorBounds}get currentUniforms(){return this._currentUniforms}get activeTextureUnit(){return this._activeTextureUnit}get drawBuffers(){return this._drawBuffers}get textureWillBeUsed(){return this._textureWillBeUsed}get viewport(){return this._viewport}get enabledVertexAttributeArray(){return this._enabledVertexAttributeArray.slice(0).filter(e=>e!==void 0)}bindVAO(e){this._boundVAO!==e&&(this._boundVAO=e,this.extensions.vao&&(this.extensions.vao instanceof WebGL2RenderingContext?this.extensions.vao.bindVertexArray(e):this.extensions.vao.bindVertexArrayOES(e)))}bindVBO(e){this._boundVBO!==e&&(this._boundVBO=e,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e))}bindRBO(e){this._boundRBO!==e&&(this._boundRBO=e,this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,e))}bindFBO(e){this._boundFBO!==e&&(this._boundFBO=e,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e))}bindTexture(e,n){if(!(!e.gl||!e.gl.textureId)&&(!e||this._boundTexture.id!==e.gl.textureId||this._boundTexture.unit!==this._activeTextureUnit)){switch(this._boundTexture={id:e.gl.textureId,unit:this._activeTextureUnit},n){case d.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D:this.gl.bindTexture(this.gl.TEXTURE_2D,e.gl.textureId);break;case d.GLSettings.Texture.TextureBindingTarget.CUBE_MAP:this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,e.gl.textureId);break}const i=this._textureUnitToTexture.get(this._activeTextureUnit);i&&i.gl&&(i.gl.textureUnit=-1),this._textureUnitToTexture.set(this._activeTextureUnit,e),e.gl.textureUnit=this._activeTextureUnit}}disableVertexAttributeArray(){for(let e=0,n=this._enabledVertexAttributeArray.length;e<n;++e){const i=this._enabledVertexAttributeArray[e];this.gl.disableVertexAttribArray(i)}this._enabledVertexAttributeArray=[],this._willUseVertexAttributeArray=[],this._vertexAttributeArrayDivisor.clear()}willUseVertexAttributeArray(e){this._willUseVertexAttributeArray[e]=e,this._enabledVertexAttributeArray[e]===void 0&&(this._enabledVertexAttributeArray[e]=e,this.gl.enableVertexAttribArray(e))}applyVertexAttributeArrays(){for(let e=0,n=this._enabledVertexAttributeArray.length;e<n;++e){const i=this._enabledVertexAttributeArray[e];if(i!==void 0){if(this._willUseVertexAttributeArray[i]!==void 0)return;this.gl.disableVertexAttribArray(i),delete this._enabledVertexAttributeArray[i]}}this._willUseVertexAttributeArray=[]}setVertexAttributeArrayDivisor(e,n){this.extensions.instancing&&this._enabledVertexAttributeArray[e]!==void 0&&this._vertexAttributeArrayDivisor.get(e)!==n&&(this.extensions.instancing instanceof WebGL2RenderingContext?this.extensions.instancing.vertexAttribDivisor(e,n):this.extensions.instancing.vertexAttribDivisorANGLE(e,n),this._vertexAttributeArrayDivisor.set(e,n))}freeTextureUnit(e){e.gl&&e.gl.textureUnit>-1&&(this._freeUnits.unshift(e.gl.textureUnit),e.gl.textureUnit=-1)}setActiveTextureUnit(e){this._activeTextureUnit!==e&&(this._activeTextureUnit=e,this.gl.activeTexture(e))}setClearColor(e){Zs(e,this._clearColor)||(this._clearColor=Zt(e),this.applyClearColor())}setDrawBuffers(e,n){let i=e.length!==this._drawBuffers.length;if(!i){for(let r=0,s=e.length;r<s;++r)if(this._drawBuffers[r]!==e[r]){i=!0;break}}if(i){if(this.glProxy.extensions.drawBuffers instanceof WebGL2RenderingContext)n||this.glProxy.extensions.drawBuffers.drawBuffers(e);else if(this.glProxy.extensions.drawBuffers)n||this.glProxy.extensions.drawBuffers.drawBuffersWEBGL(e);else{console.warn("Attempted to use drawBuffers for MRT, but MRT is NOT supported by this hardware. Use multiple render targets instead");return}this._drawBuffers=e}}setProxy(e){this.glProxy=e}setScissor(e){e?(this._scissorTestEnabled||(this._scissorTestEnabled=!0,this.gl.enable(this.gl.SCISSOR_TEST)),(e.x!==this._scissorBounds.x||e.y!==this._scissorBounds.y||e.width!==this._scissorBounds.width||e.height!==this._scissorBounds.height)&&(this._scissorBounds=e,this.applyScissorBounds())):this._scissorTestEnabled&&(this._scissorTestEnabled=!1,this.gl.disable(this.gl.SCISSOR_TEST))}setViewport(e,n,i,r){(e!==this._viewport.x||n!==this._viewport.y||i!==this._viewport.width||r!==this._viewport.height)&&(this._viewport={x:e,y:n,width:i,height:r},this.applyViewport())}useProgram(e){this._currentProgram!==e&&(this._currentProgram=e,this.gl.useProgram(this._currentProgram))}useMaterial(e){if(!e.gl&&(!this.glProxy.compileMaterial(e)||!e.gl)||!e.gl.programId||e.gl.programId.length===0)return kt.INVALID;const n=this.findMaterialProgram(e);if(n===void 0)return console.warn("Could NOT determine a program for the given material that would appropriately match with the current RenderTarget"),kt.NO_RENDER_TARGET_MATCHES;if(this._renderTarget&&(e.gl.programByTarget.set(this._renderTarget,n),this.glProxy.extensions.drawBuffers)){const i=e.gl.outputsByProgram.get(n),r=this._renderTarget.getGLBuffers();if(!i||!r)return console.warn("Could not establish the buffers to utilize for the render target"),kt.NO_RENDER_TARGET_MATCHES;const s=[];for(let a=0,o=r.length;a<o;++a){const c=r[a];i.find(u=>(c==null?void 0:c.outputType)===u)===void 0?s.push(this.gl.NONE):this._renderTarget.disabledTargets.has((c==null?void 0:c.outputType)||0)?s.push(this.gl.NONE):s.push((c==null?void 0:c.attachment)||this.gl.NONE)}this.setDrawBuffers(s)}return this.useProgram(n),this.syncMaterial(e),kt.VALID}findMaterialProgram(e){if(!e.gl)return;if(!this._renderTarget||this._renderTarget.isColorTarget()){let o;if(this._renderTarget&&(o=e.gl.programByTarget.get(this._renderTarget),o!==void 0))return o;let c=Number.MAX_SAFE_INTEGER;for(let l=0,u=e.gl.programId.length;l<u;++l){const h=e.gl.programId[l];h.outputTypes.length<c&&h.outputTypes.indexOf(ge.COLOR)>=0&&(o=h.id,c=h.outputTypes.length)}return o||(o=e.gl.programId[e.gl.programId.length-1]),o}let n=e.gl.programByTarget.get(this._renderTarget);if(n!==void 0)return n;const i=new Set,r=this._renderTarget.getBuffers();for(let o=0,c=r.length;o<c;++o){const l=r[o];l&&i.add(l.outputType)}let s=0,a=[];for(let o=0,c=e.gl.programId.length;o<c;++o){const l=e.gl.programId[o];let u=0;for(let h=0,f=l.outputTypes.length;h<f;++h){const p=l.outputTypes[h];i.has(p)&&u++}u>s?(s=u,a=[l]):u===s&&a.push(l)}if(a.length!==0)return a.length===1?n=a[0].id:a.length>1&&(n=a.reduce((o,c)=>c.outputTypes.length<o.outputTypes.length?c:o)),n}useRenderTarget(e){return e?e.gl?(this.bindFBO(e.gl.fboId),this._renderTarget=e,!0):!1:(this.bindFBO(null),this._renderTarget=null,!0)}syncMaterial(e){return this.setDepthMask(e.depthWrite),this.setDepthTest(e.depthTest),this.setDepthFunc(e.depthFunc),this.setBlending(e.blending),this.setCullFace(e.culling),this.setColorMask(e.colorWrite),this.setDithering(e.dithering),this._currentUniforms=e.uniforms,!(!this._currentProgram||(Object.entries(e.uniforms).forEach(([n,i])=>{if(!this._currentProgram)return;i.gl||(i.gl=new Map);let r=i.gl.get(this._currentProgram);if(!r){const s=this.gl.getUniformLocation(this._currentProgram,n);if(!s){r={location:void 0},Ku(this.debugContext,`A Material specified a uniform ${n}, but none was found in the current program.`);return}r={location:s},i.gl.set(this._currentProgram,r)}r.location&&this.uploadUniform(r.location,i)}),this._textureWillBeUsed.size>0&&!this.applyUsedTextures()))}setDepthMask(e){this._depthMask!==e&&(this._depthMask=e,this.gl.depthMask(this._depthMask))}setDepthTest(e){this._depthTestEnabled!==e&&(this._depthTestEnabled=e,this._depthTestEnabled?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST))}setDepthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this.applyDepthFunc())}setBlending(e){e?(this._blendingEnabled||(this.gl.enable(this.gl.BLEND),this._blendingEnabled=!0),(this._blendDstFactor!==e.blendDst||this._blendSrcFactor!==e.blendSrc||this._blendEquation!==e.blendEquation)&&(this._blendDstFactor=e.blendDst||this._blendDstFactor,this._blendSrcFactor=e.blendSrc||this._blendSrcFactor,this._blendEquation=e.blendEquation||this._blendEquation,this.applyBlendFactors())):this._blendingEnabled&&(this.gl.disable(this.gl.BLEND),this._blendingEnabled=!1)}setDithering(e){this._ditheringEnabled!==e&&(this._ditheringEnabled=e,this._ditheringEnabled?this.gl.enable(this.gl.DITHER):this.gl.disable(this.gl.DITHER))}setColorMask(e){(this._colorMask[0]!==e[0]||this._colorMask[1]!==e[1]||this._colorMask[2]!==e[2]||this._colorMask[3]!==e[3])&&(this._colorMask=e,this.applyColorMask())}setCullFace(e){this._cullFace!==e&&(this._cullFace=e,this.applyCullFace())}uploadUniform(e,n){let i;switch(n.type){case je.FLOAT:i=n.value,this.gl.uniform1f(e,i);break;case je.VEC2:i=n.value,this.gl.uniform2f(e,i[0],i[1]);break;case je.VEC3:i=n.value,this.gl.uniform3f(e,i[0],i[1],i[2]);break;case je.VEC4:i=n.value,this.gl.uniform4f(e,i[0],i[1],i[2],i[3]);break;case je.VEC4_ARRAY:i=n.value,this.gl.uniform4fv(e,Js(i));break;case je.MATRIX3x3:i=n.value,this.gl.uniformMatrix3fv(e,!1,i);break;case je.MATRIX4x4:i=n.value,this.gl.uniformMatrix4fv(e,!1,i);break;case je.FLOAT_ARRAY:i=n.value,this.gl.uniform1fv(e,i);break;case je.TEXTURE:i=n.value,this.willUseTextureUnit(i,e);break;default:console.warn(this.debugContext,"A uniform specified an unrecognized type. It will not sync with the GPU:",n)}}applyUsedTextures(){const e=this.assignTextureUnits(Array.from(this._textureWillBeUsed.keys()));e.forEach(r=>{r.gl?r.gl.textureUnit=this.gl.TEXTURE0:r.gl={textureId:null,textureUnit:this.gl.TEXTURE0,proxy:this.glProxy}});const n=new Map,i=new Set;return this._textureWillBeUsed.forEach((r,s)=>{r instanceof oi?i.add(r):n.set(s,r)}),i.forEach(r=>{r.getTextures().some(o=>{if(e.indexOf(o)<0)this.glProxy.updateTexture(o);else return!0;return!1})?console.warn(this.debugContext,"A RenderTarget can not be used because all of it's textures could not be compiled."):this.glProxy.compileRenderTarget(r)}),n.forEach((r,s)=>{e.indexOf(s)<0?(this.glProxy.updateTexture(s),r.forEach(a=>{this.uploadTextureToUniform(a,s)})):r.forEach(a=>{this.gl.uniform1i(a,Mc(this.gl,0))})}),this._textureWillBeUsed.clear(),!0}assignTextureUnits(e){const n=[],i=[];for(e.forEach(a=>{!a.gl||a.gl.textureUnit<0?n.push(a):i.push(a)});this._freeUnits.length>0&&n.length>0;){const a=n.shift();if(!a)continue;const o=this._freeUnits.shift();if(o===void 0){n.unshift(a);continue}a.gl?a.gl.textureUnit=o:a.gl={textureId:null,textureUnit:o,proxy:this.glProxy},i.push(a)}if(n.length<=0)return n;Ku("WARNING: Too many textures in use are causing texture units to be swapped. Doing this occasionally is fine, but handling this on a frame loop can have serious performance concerns.");const r=new Map;this._textureUnitToTexture.forEach(a=>{a&&r.set(a,!1)}),i.forEach(a=>{r.set(a,!0)});const s=[];if(r.forEach((a,o)=>{a||s.push(o)}),s.length===0)return console.warn(this.debugContext,"There are too many textures being used for a single draw call. These textures will not be utilized on the GPU",n),console.warn("Current GL State:",this),n;for(;s.length>0&&n.length>0;){const a=n.shift();if(!a)continue;const o=s.shift();if(o===void 0||!o.gl||o.gl.textureUnit<0){n.unshift(a);continue}a.gl?a.gl.textureUnit=o.gl.textureUnit:a.gl={textureId:null,textureUnit:o.gl.textureUnit,proxy:this.glProxy},i.push(a)}return n.length>0&&(console.error(this.debugContext,"There are too many textures being used for a single draw call. These textures will not be utilized on the GPU",n),console.warn("Current GL State:",this)),n}uploadTextureToUniform(e,n){n.gl&&n.gl.textureUnit>=0?this.gl.uniform1i(e,Mc(this.gl,n.gl.textureUnit)):console.warn(this.debugContext,"Attempted to set a Texture Object to a uniform, but the Texture object did not have a valid texture unit.",n)}willUseTextureUnit(e,n){const i=this._textureWillBeUsed.get(e);n instanceof oi?i?i instanceof oi&&i!==n&&console.warn(this.debugContext,"A Texture is attempting to be used by two different render targets in a single draw."):this._textureWillBeUsed.set(e,n):i?i instanceof oi?console.warn(this.debugContext,"A texture in a single draw is attempting to attach to a uniform AND a render target which is invalid."):i.add(n):this._textureWillBeUsed.set(e,new Set([n]))}syncState(){const e=this.gl;this._blendingEnabled?e.enable(e.BLEND):e.disable(e.BLEND),this._ditheringEnabled?e.enable(e.DITHER):e.disable(e.DITHER),this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.setActiveTextureUnit(this._activeTextureUnit),this.applyClearColor(),this.applyCullFace(),this.applyBlendFactors(),this.applyBlendEquation(),this.applyColorMask(),this.applyDepthFunc(),this.applyScissorBounds(),this.applyViewport(),e.depthMask(this._depthMask)}applyClearColor(){this.gl.clearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3])}applyDepthFunc(){const e=this.gl;switch(this._depthFunc){case d.GLSettings.Material.DepthFunctions.ALWAYS:e.depthFunc(e.ALWAYS);break;case d.GLSettings.Material.DepthFunctions.EQUAL:e.depthFunc(e.EQUAL);break;case d.GLSettings.Material.DepthFunctions.GREATER:e.depthFunc(e.GREATER);break;case d.GLSettings.Material.DepthFunctions.GREATER_OR_EQUAL:e.depthFunc(e.GEQUAL);break;case d.GLSettings.Material.DepthFunctions.LESS:e.depthFunc(e.LESS);break;case d.GLSettings.Material.DepthFunctions.LESS_OR_EQUAL:e.depthFunc(e.LEQUAL);break;case d.GLSettings.Material.DepthFunctions.NEVER:e.depthFunc(e.NEVER);break;case d.GLSettings.Material.DepthFunctions.NOTEQUAL:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.ALWAYS);break}}applyScissorBounds(){this.gl.scissor(this._scissorBounds.x,this._scissorBounds.y,this._scissorBounds.width,this._scissorBounds.height)}applyColorMask(){this.gl.colorMask(this.colorMask[0]||!1,this.colorMask[1]||!1,this.colorMask[2]||!1,this.colorMask[3]||!1)}applyBlendEquation(){const e=this.gl;switch(this._blendEquation){case d.GLSettings.Material.BlendingEquations.Add:e.blendEquation(e.FUNC_ADD);break;case d.GLSettings.Material.BlendingEquations.Subtract:e.blendEquation(e.FUNC_SUBTRACT);break;case d.GLSettings.Material.BlendingEquations.ReverseSubtract:e.blendEquation(e.FUNC_REVERSE_SUBTRACT);break}}applyBlendFactors(){const e=this.gl;let n,i;switch(this._blendDstFactor){case d.GLSettings.Material.BlendingDstFactor.DstAlpha:n=e.BLEND_DST_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.DstColor:n=e.BLEND_DST_RGB;break;case d.GLSettings.Material.BlendingDstFactor.One:n=e.ONE;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusDstAlpha:n=e.ONE_MINUS_DST_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusDstColor:n=e.ONE_MINUS_DST_COLOR;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha:n=e.ONE_MINUS_SRC_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusSrcColor:n=e.ONE_MINUS_SRC_COLOR;break;case d.GLSettings.Material.BlendingDstFactor.SrcAlpha:n=e.SRC_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.SrcColor:n=e.SRC_COLOR;break;case d.GLSettings.Material.BlendingDstFactor.Zero:n=e.ZERO;break;default:n=e.ONE;break}switch(this._blendSrcFactor){case d.GLSettings.Material.BlendingDstFactor.DstAlpha:i=e.BLEND_DST_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.DstColor:i=e.BLEND_DST_RGB;break;case d.GLSettings.Material.BlendingDstFactor.One:i=e.ONE;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusDstAlpha:i=e.ONE_MINUS_DST_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusDstColor:i=e.ONE_MINUS_DST_COLOR;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha:i=e.ONE_MINUS_SRC_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusSrcColor:i=e.ONE_MINUS_SRC_COLOR;break;case d.GLSettings.Material.BlendingDstFactor.SrcAlpha:i=e.SRC_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.SrcColor:i=e.SRC_COLOR;break;case d.GLSettings.Material.BlendingDstFactor.Zero:i=e.ZERO;break;case d.GLSettings.Material.BlendingSrcFactor.SrcAlphaSaturate:i=e.SRC_ALPHA_SATURATE;break;default:i=e.ONE;break}e.blendFunc(i,n)}applyCullFace(){const e=this.gl;switch(this._cullFace!==d.GLSettings.Material.CullSide.NONE&&e.enable(e.CULL_FACE),this._cullFace){case d.GLSettings.Material.CullSide.CW:e.frontFace(e.CW),e.cullFace(e.FRONT);break;case d.GLSettings.Material.CullSide.CCW:e.frontFace(e.CCW),e.cullFace(e.FRONT);break;case d.GLSettings.Material.CullSide.BOTH:e.frontFace(e.CW),e.cullFace(e.FRONT_AND_BACK);break;default:e.disable(e.CULL_FACE)}}applyViewport(){this.gl.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)}}class is{constructor(e){this.blending={blendDst:d.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:d.GLSettings.Material.BlendingEquations.Add,blendSrc:d.GLSettings.Material.BlendingSrcFactor.SrcAlpha},this.colorWrite=[!0,!0,!0,!0],this.culling=d.GLSettings.Material.CullSide.CCW,this.depthFunc=d.GLSettings.Material.DepthFunctions.LESS_OR_EQUAL,this.depthTest=!0,this.depthWrite=!0,this.dithering=!0,this.name="",this.uniforms={},this.vertexShader="",Object.assign(this,e),delete this.gl}clone(){const e=new is(this);e.blending=Object.assign({},this.blending),e.polygonOffset=Object.assign({},this.polygonOffset),e.uniforms=Object.assign({},this.uniforms);for(const n in e.uniforms){const i=e.uniforms[n];if(i.gl){const r=new Map;i.gl.forEach((s,a)=>{r.set(a,Object.assign({},s))})}}return e}dispose(){this.gl&&this.gl.proxy.disposeMaterial(this)}}class Pc{constructor(e,n,i){this.drawMode=d.GLSettings.Model.DrawMode.TRIANGLES,this.vertexDrawRange=[-1,-1],this.drawInstances=-1,this.vertexCount=0,this.id=e,this.geometry=n,this.material=i}}class ha{constructor(){this.models=new Set}add(e){this.models.add(e)}remove(e){this.models.delete(e)}}const Ju=Ke("performance");class eh{constructor(e){this.state={clearMask:[!1,!1,!1],currentRenderTarget:null,displaySize:[1,1],pixelRatio:1,renderSize:[1,1]},this.options=Object.assign({alpha:!1,antialias:!1,preserveDrawingBuffer:!1},e),this.options.canvas||console.warn("WebGLRenderer ERROR: A canvas is REQUIRED as a parameter."),this.getContext()}set debugContext(e){this.glProxy&&(this.glProxy.debugContext=e),this.glState&&(this.glState.debugContext=e)}get gl(){return this._gl}clear(e,n,i){const r=this.state.clearMask;this.state.clearMask=[r[0]||e||!1,r[1]||n||!1,r[2]||i||!1]}clearColor(e){e&&this.glState.setClearColor(e)}dispose(){}getContext(){if(this._gl)return this._gl;const e=ns.getContext(this.options.canvas,{alpha:this.options.alpha||!1,antialias:this.options.antialias||!1,premultipliedAlpha:this.options.premultipliedAlpha||!1,preserveDrawingBuffer:this.options.preserveDrawingBuffer||!1});return e.context?(this._gl=e.context,this.glState=new Zu(e.context,e.extensions),this.glProxy=new ns(e.context,this.glState,e.extensions),this.glState.setProxy(this.glProxy),this.glState.syncState()):this.options.onNoContext?this.options.onNoContext():console.warn("No context was able to be produced, and the handler onNoContext was not implemented for such cases."),this._gl}getDisplaySize(){return this.state.displaySize}getPixelRatio(){return this.state.pixelRatio}getRenderSize(){return this.state.renderSize}getFullViewport(){const e=this.state.currentRenderTarget;if(Array.isArray(e))return{x:0,y:0,width:e[0].width,height:e[0].height};if(e)return{x:0,y:0,width:e.width,height:e.height};{const n=this.getRenderSize();return{x:0,y:0,width:n[0],height:n[1]}}}prepareAttribute(e,n,i){if(this.glProxy.updateAttribute(n))(!e.gl||!e.gl.vao)&&this.glProxy.useAttribute(i,n,e);else return console.warn("Could not update attribute",n),!1;return!0}render(e,n=null,i){if(!this.gl)return;this.setRenderTarget(n);const r=[];if(n&&!Array.isArray(n)&&(U.MRT||U.MRT_EXTENSION)){const a=n.getGLBuffers();this.glState.setDrawBuffers(a.map(o=>(o==null?void 0:o.attachment)||0))}const s=this.state.clearMask;if((s[0]||s[1]||s[2])&&(this.glProxy.clear(s[0],s[1],s[2]),this.state.clearMask=[!1,!1,!1]),Array.isArray(n))for(let a=0,o=n.length;a<o;++a){const c=n[a];if(this.glState.useRenderTarget(c),c&&!c.gl)return;e.models.forEach(l=>{this.renderModel(l,r,i)})}else{if(n&&!n.gl)return;e.models.forEach(a=>{this.renderModel(a,r,i)})}r.forEach(a=>{e.remove(a)})}renderModel(e,n,i){var o;const r=e.geometry,s=e.material;switch(this.glState.useMaterial(s)){case kt.VALID:{this.glProxy.compileGeometry(r);let c=!0;const l=(u,h)=>{c=this.prepareAttribute(r,u,h)&&c};r.attributes.forEach(l),(o=r.gl)!=null&&o.vao?this.glState.bindVAO(r.gl.vao):this.glState.applyVertexAttributeArrays(),i==null||i(this.glState,e.id),c?this.glProxy.draw(e):(console.warn("Geometry was unable to update correctly, thus we are skipping the drawing of",e),n.push(e)),this.glState.bindVAO(null);break}case kt.INVALID:{console.warn("Could not utilize material. Skipping draw call for:",s,r),n.push(e);break}case kt.NO_RENDER_TARGET_MATCHES:{Ju("Skipped draw for material due to no output matches for the current render target");break}default:Ju("Skipped draw for material due to unknown reasons");break}}readPixels(e,n,i,r,s,a=0){if(!this.gl)return;const o=this.state.currentRenderTarget;let c=!0,l;if(Array.isArray(o))l=o.find(u=>{var h;return Array.isArray(u.buffers.color)?u.buffers.color.find(f=>f.outputType===a):((h=u.buffers.color)==null?void 0:h.outputType)===a});else if(o&&Array.isArray(o==null?void 0:o.buffers.color)){if(o.buffers.color.length>1){console.warn("It is not yet implemented to read the pixels from a RenderTarget with multiple color buffers");return}l=o}else l=o;if(l&&(c=l.validFramebuffer),!c){console.warn("Framebuffer is incomplete. Can not read pixels at this time.");return}if(e=Math.max(0,e),n=Math.max(0,n),l){e+i>l.width&&(i=l.width-e),n+r>l.height&&(r=l.height-n);const u=l.height;this.gl.readPixels(e,u-n-r,i,r,this.gl.RGBA,this.gl.UNSIGNED_BYTE,s)}else{const u=this.getRenderSize(),h=u[1];e+i>u[0]&&(i=u[0]-e),n+r>u[1]&&(r=u[1]-n),this.gl.readPixels(e,h-n-r,i,r,this.gl.RGBA,this.gl.UNSIGNED_BYTE,s)}}setClearColor(e){this.glState.setClearColor(e)}setPixelRatio(e){const{canvas:n}=this.options,i=this.getDisplaySize();n.width=i[0]*e,n.height=i[1]*e,this.state.pixelRatio=e}setScissor(e,n){if(n=n||this.state.currentRenderTarget||null,Array.isArray(n)){const i=n[0].height;if(e){const{x:r,y:s,width:a,height:o}=e;this.glState.setScissor({x:r,y:i-s-o,width:a,height:o})}else this.glState.setScissor(null)}else if(n){const i=n.height;if(e){const{x:r,y:s,width:a,height:o}=e;this.glState.setScissor({x:r,y:i-s-o,width:a,height:o})}else this.glState.setScissor(null)}else{const{renderSize:i}=this.state,r=i[1];if(e){const{x:s,y:a,width:o,height:c}=e;this.glState.setScissor({x:s,y:r-a-c,width:o,height:c})}else this.glState.setScissor(null)}}setSize(e,n){const{canvas:i}=this.options,{pixelRatio:r}=this.state;i.width=Math.min(e*r,U.MAX_TEXTURE_SIZE),i.height=Math.min(n*r,U.MAX_TEXTURE_SIZE),i.style.width=`${e}px`,i.style.height=`${n}px`,this.state.renderSize=[i.width,i.height],this.state.displaySize=[e,n]}setRenderTarget(e){this.state.currentRenderTarget!==e&&(Array.isArray(e)?e.forEach(n=>{n.gl||this.glProxy.compileRenderTarget(n)}):!this.glState.useRenderTarget(e)&&e&&(e.getTextures().forEach(n=>{this.glState.willUseTextureUnit(n,e)}),this.glState.applyUsedTextures(),this.glProxy.compileRenderTarget(e)&&this.glState.useRenderTarget(e)),this.state.currentRenderTarget=e)}setViewport(e){const n=this.state.currentRenderTarget,{x:i,y:r,width:s,height:a}=e;if(Array.isArray(n)){const o=n[0].height;this.glState.setViewport(i,o-r-a,s,a)}else if(n){const o=n.height;this.glState.setViewport(i,o-r-a,s,a)}else{const{renderSize:o}=this.state,c=o[1];this.glState.setViewport(i,c-r-a,s,a)}}}var da=!!(typeof window<"u"&&window.document&&window.document.createElement),th={canUseDOM:da,canUseWorkers:typeof Worker<"u",canUseEventListeners:da&&!!(window.addEventListener||window.attachEvent),canUseViewport:da&&!!window.screen,isInWorker:!da},nh;th.canUseDOM&&(nh=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function em(t,e){if(!th.canUseDOM||e&&!("addEventListener"in document))return!1;var n="on"+t,i=n in document;if(!i){var r=document.createElement("div");r.setAttribute(n,"return;"),i=typeof r[n]=="function"}return!i&&nh&&t==="wheel"&&(i=document.implementation.hasFeature("Events.wheel","3.0")),i}var ih=!1,Vi,Dc,Fc,fa,pa,rh,ga,Bc,Uc,kc,sh,Gc,zc,ah,oh;function wt(){if(!ih){ih=!0;var t=navigator.userAgent,e=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(t),n=/(Mac OS X)|(Windows)|(Linux)/.exec(t);if(Gc=/\b(iPhone|iP[ao]d)/.exec(t),zc=/\b(iP[ao]d)/.exec(t),kc=/Android/i.exec(t),ah=/FBAN\/\w+;/i.exec(t),oh=/Mobile/i.exec(t),sh=!!/Win64/.exec(t),e){Vi=e[1]?parseFloat(e[1]):e[5]?parseFloat(e[5]):NaN,Vi&&document&&document.documentMode&&(Vi=document.documentMode);var i=/(?:Trident\/(\d+.\d+))/.exec(t);rh=i?parseFloat(i[1])+4:Vi,Dc=e[2]?parseFloat(e[2]):NaN,Fc=e[3]?parseFloat(e[3]):NaN,fa=e[4]?parseFloat(e[4]):NaN,fa?(e=/(?:Chrome\/(\d+\.\d+))/.exec(t),pa=e&&e[1]?parseFloat(e[1]):NaN):pa=NaN}else Vi=Dc=Fc=pa=fa=NaN;if(n){if(n[1]){var r=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(t);ga=r?parseFloat(r[1].replace("_",".")):!0}else ga=!1;Bc=!!n[2],Uc=!!n[3]}else ga=Bc=Uc=!1}}var Vc={ie:function(){return wt()||Vi},ieCompatibilityMode:function(){return wt()||rh>Vi},ie64:function(){return Vc.ie()&&sh},firefox:function(){return wt()||Dc},opera:function(){return wt()||Fc},webkit:function(){return wt()||fa},safari:function(){return Vc.webkit()},chrome:function(){return wt()||pa},windows:function(){return wt()||Bc},osx:function(){return wt()||ga},linux:function(){return wt()||Uc},iphone:function(){return wt()||Gc},mobile:function(){return wt()||Gc||zc||kc||oh},nativeApp:function(){return wt()||ah},android:function(){return wt()||kc},ipad:function(){return wt()||zc}};const ch=10,lh=40,uh=800;function Wc(t){let e=0,n=0,i=0,r=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),i=e*ch,r=n*ch,"deltaY"in t&&(r=t.deltaY),"deltaX"in t&&(i=t.deltaX),(i||r)&&t.deltaMode&&(t.deltaMode===1?(i*=lh,r*=lh):(i*=uh,r*=uh)),i&&!e&&(e=i<1?-1:1),r&&!n&&(n=r<1?-1:1),{spinX:e,spinY:-n,pixelX:i,pixelY:-r}}Wc.getEventType=function(){return Vc.firefox()?"DOMMouseScroll":em("wheel")?"wheel":"mousewheel"};function en(t,e){let n=0,i=0,r=0,s=0,a=e||t.nativeEvent&&t.nativeEvent.target||t.target;if(t||(t=window.event),t.pageX||t.pageY)n=t.pageX,i=t.pageY;else if(t.clientX||t.clientY){let o=0,c=0;document.documentElement&&(o=document.documentElement.scrollLeft,c=document.documentElement.scrollTop),n=t.clientX+document.body.scrollLeft+o,i=t.clientY+document.body.scrollTop+c}if(a.offsetParent)do r+=a.offsetLeft,s+=a.offsetTop,a=a.offsetParent;while(a);return[n-r,i-s]}function Xe(t){return t!=null}function hh(t){return Array.isArray(t)?e=>t.indexOf(e.start.view.id)>=0:e=>e.start.view.id===t}function dh(t){return Array.isArray(t)?e=>e.start.views.find(n=>t.indexOf(n.view.id)>=0):e=>e.start.views.find(n=>n.view.id===t)}class ma{constructor(){this._uid=K(),this.id="",this.pixelRatio=1,this._screenScale=[1,1]}get uid(){return this._uid}get screenBounds(){return this._scaledScreenBounds||(this._scaledScreenBounds=new ye({x:this._screenBounds.x*this._screenScale[0],y:this._screenBounds.y*this._screenScale[1],width:this._screenBounds.width*this._screenScale[0],height:this._screenBounds.height*this._screenScale[1]})),this._scaledScreenBounds}set screenBounds(e){delete this._scaledScreenBounds,this._screenBounds=e}get screenScale(){return this._screenScale}set screenScale(e){Qs(e,this._screenScale)||(delete this._scaledScreenBounds,this._screenScale=e)}screenToRenderSpace(e,n){return n=this.screenToView(e,n),Le(n,e[0]*this.pixelRatio,e[1]*this.pixelRatio)}renderSpaceToScreen(e,n){return n=n||[0,0],Le(n,e[0]/this.pixelRatio-this.screenBounds.x,e[1]/this.pixelRatio-this.screenBounds.y)}screenToView(e,n){return n=n||[0,0],Le(n,e[0]-this.screenBounds.x,e[1]-this.screenBounds.y)}viewToScreen(e,n){return n=n||[0,0],Le(n,e[0]+this.screenBounds.x,e[1]+this.screenBounds.y)}}class fh extends ma{screenToWorld(e,n){return e}screenRay(e){return[[0,0,-1],[0,0,-2]]}worldToScreen(e,n){return e}viewToWorld(e,n){return e}worldToView(e,n){return e}}const{cos:Pt,sin:Dt,tan:tn}=Math,Ft=Math.PI/2,ci=0,li=1,ui=2,hi=3,rs=0,ss=1,as=2,os=3,cs=4,ls=5,us=6,hs=7,ds=8,nn=0,rn=1,sn=2,an=3,on=4,cn=5,ln=6,un=7,hn=8,dn=9,fn=10,pn=11,gn=12,mn=13,vn=14,wn=15,Wi=new Array(20).fill(0).map(t=>yn()),ot=new Array(20).fill(0).map(t=>Ie());function Bt(t,e,n,i,r){return t=t||new Array(4),t[0]=e,t[1]=n,t[2]=i,t[3]=r,t}function yt(t,e,n,i,r,s,a,o,c,l){return t=t||new Array(9),t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=s,t[5]=a,t[6]=o,t[7]=c,t[8]=l,t}function Be(t,e,n,i,r,s,a,o,c,l,u,h,f,p,m,v,T){return t=t||new Array(16),t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=s,t[5]=a,t[6]=o,t[7]=c,t[8]=l,t[9]=u,t[10]=h,t[11]=f,t[12]=p,t[13]=m,t[14]=v,t[15]=T,t}const ph=yn(),gh=yn(),$c=yn(),tm=yn();function Ne(t){return t[3]*t[0]-t[1]*t[2]}function $i(t){return t[0]*t[4]*t[8]-t[0]*t[5]*t[7]+t[1]*t[5]*t[6]-t[1]*t[3]*t[8]+t[2]*t[3]*t[7]-t[2]*t[4]*t[6]}function jc(t){return yt(ph,t[5],t[6],t[7],t[9],t[10],t[11],t[13],t[14],t[15]),yt(gh,t[4],t[6],t[7],t[8],t[10],t[11],t[12],t[14],t[15]),yt($c,t[4],t[5],t[7],t[8],t[9],t[11],t[12],t[13],t[15]),yt($c,t[4],t[5],t[6],t[8],t[9],t[10],t[12],t[13],t[14]),t[0]*$i(ph)-t[1]*$i(gh)+t[2]*$i($c)-t[3]*$i(tm)}function mh(t,e){const n=Ne(t);return n===0?null:Bt(e,t[3]/n,-t[1]/n,-t[2]/n,t[0]/n)}function vh(t,e){const n=$i(t);if(n===0)return null;const i=Ne([t[4],t[5],t[7],t[8]]),r=Ne([t[3],t[5],t[6],t[8]]),s=Ne([t[3],t[4],t[6],t[7]]),a=Ne([t[1],t[2],t[7],t[8]]),o=Ne([t[0],t[2],t[6],t[8]]),c=Ne([t[0],t[1],t[6],t[7]]),l=Ne([t[1],t[2],t[4],t[5]]),u=Ne([t[0],t[2],t[3],t[5]]),h=Ne([t[0],t[1],t[3],t[4]]);return yt(e,i/n,-a/n,l/n,-r/n,o/n,u/n,s/n,-c/n,h/n)}function wh(t,e){const n=jc(t);if(n===0)return null;const i=Ne([t[0],t[1],t[4],t[5]]),r=Ne([t[0],t[2],t[4],t[6]]),s=Ne([t[0],t[3],t[4],t[7]]),a=Ne([t[1],t[2],t[5],t[6]]),o=Ne([t[1],t[3],t[5],t[7]]),c=Ne([t[2],t[3],t[6],t[7]]),l=Ne([t[10],t[11],t[14],t[15]]),u=Ne([t[9],t[11],t[13],t[15]]),h=Ne([t[9],t[10],t[13],t[14]]),f=Ne([t[8],t[11],t[12],t[15]]),p=Ne([t[8],t[10],t[12],t[14]]),m=Ne([t[8],t[9],t[12],t[13]]);return Be(e,(t[5]*l-t[6]*u+t[7]*h)/n,(-t[1]*l+t[2]*u-t[3]*h)/n,(t[12]*c-t[13]*o+t[14]*a)/n,(-t[9]*c+t[10]*o-t[11]*a)/n,(-t[4]*l+t[6]*f-t[7]*p)/n,(t[0]*l-t[2]*f+t[3]*p)/n,(-t[12]*c+t[14]*s-t[15]*r)/n,(t[8]*c-t[10]*s+t[11]*r)/n,(t[4]*u-t[5]*f+t[7]*m)/n,(-t[0]*u+t[1]*f-t[3]*m)/n,(t[12]*o-t[13]*s+t[15]*i)/n,(-t[8]*o+t[9]*s-t[11]*i)/n,(-t[4]*h+t[5]*p-t[6]*m)/n,(t[0]*h-t[1]*p+t[2]*m)/n,(-t[12]*a+t[13]*r-t[14]*i)/n,(t[8]*a-t[9]*r+t[10]*i)/n)}function yh(t,e,n){return Bt(n,t[0]*e,t[1]*e,t[2]*e,t[3]*e)}function Th(t,e,n){return yt(n,t[0]*e,t[1]*e,t[2]*e,t[3]*e,t[4]*e,t[5]*e,t[6]*e,t[7]*e,t[8]*e)}function Eh(t,e,n){return Be(n,t[0]*e,t[1]*e,t[2]*e,t[3]*e,t[4]*e,t[5]*e,t[6]*e,t[7]*e,t[8]*e,t[9]*e,t[10]*e,t[11]*e,t[12]*e,t[13]*e,t[14]*e,t[15]*e)}function fs(t){return Bt(t,1,0,0,1)}function yn(t){return yt(t,1,0,0,0,1,0,0,0,1)}function Ie(t){return Be(t,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}function bh(t,e,n){return Bt(n,e[ci]*t[ci]+e[li]*t[ui],e[ci]*t[li]+e[li]*t[hi],e[ui]*t[ci]+e[hi]*t[ui],e[ui]*t[li]+e[hi]*t[hi])}function _h(t,e,n){return yt(n,e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8])}function Mt(t,e,n){return n=n||[],n[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],n[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],n[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],n[3]=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],n[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],n[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],n[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],n[7]=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],n[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],n[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],n[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],n[11]=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],n[12]=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],n[13]=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],n[14]=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],n[15]=e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15],n}function Rh(t,...e){if(e.length<=0)return Ie();if(t=t||Ie(),e.length===1)return yr(e[0],t);let n=e[0],i=ot[ot.length-1],r=ot[ot.length-2];t===i&&(i=ot[ot.length-3]),t===r&&(r=ot[ot.length-3]);let s=i;for(let a=1,o=e.length-1;a<o;++a){const c=e[a];n=Mt(n,c,s),s=s===i?r:i}return Mt(n,e[e.length-1],t)}function Ah(t,e,n){return Bt(n,t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3]+e[3])}function Sh(t,e,n){return yt(n,t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3]+e[3],t[4]+e[4],t[5]+e[5],t[6]+e[6],t[7]+e[7],t[8]+e[8])}function Mh(t,e,n){return Be(n,t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3]+e[3],t[4]+e[4],t[5]+e[5],t[6]+e[6],t[7]+e[7],t[8]+e[8],t[9]+e[9],t[10]+e[10],t[11]+e[11],t[12]+e[12],t[13]+e[13],t[14]+e[14],t[15]+e[15])}function xh(t,e,n){return Bt(n,t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function Ih(t,e,n){return yt(n,t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3],t[4]-e[4],t[5]-e[5],t[6]-e[6],t[7]-e[7],t[8]-e[8])}function Ch(t,e,n){return Be(n,t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3],t[4]-e[4],t[5]-e[5],t[6]-e[6],t[7]-e[7],t[8]-e[8],t[9]-e[9],t[10]-e[10],t[11]-e[11],t[12]-e[12],t[13]-e[13],t[14]-e[14],t[15]-e[15])}function Lh(t,e,n){return Bt(n,t[0]*e[0],t[1]*e[1],t[2]*e[2],t[3]*e[3])}function Oh(t,e,n){return yt(n,t[0]*e[0],t[1]*e[1],t[2]*e[2],t[3]*e[3],t[4]*e[4],t[5]*e[5],t[6]*e[6],t[7]*e[7],t[8]*e[8])}function Nh(t,e,n){return Be(n,t[0]*e[0],t[1]*e[1],t[2]*e[2],t[3]*e[3],t[4]*e[4],t[5]*e[5],t[6]*e[6],t[7]*e[7],t[8]*e[8],t[9]*e[9],t[10]*e[10],t[11]*e[11],t[12]*e[12],t[13]*e[13],t[14]*e[14],t[15]*e[15])}function Ph(t,e){return Bt(e,t[0],t[2],t[1],t[3])}function ps(t,e){return yt(e,t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}function Dh(t,e){return Be(e,t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}function Fh(t,e){return(t>=Math.PI/2||t<=-Math.PI/2)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),e=e||fs(),Bt(e,1,0,tn(t),1)}function Bh(t,e){return(t>=Math.PI/2||t<=-Math.PI/2)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),e=e||fs(),Bt(e,1,tn(t),0,1)}function Uh(t,e,n){(e>=Ft||e<=-Ft||t>=Ft||t<=-Ft)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),n=n||Ie();const i=tn(e),r=tn(t);return Be(n,1,0,0,0,r,1,0,0,i,0,1,0,0,0,0,1)}function kh(t,e,n){(e>=Ft||e<=-Ft||t>=Ft||t<=-Ft)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),n=n||Ie();const i=tn(e),r=tn(t);return Be(n,1,r,0,0,0,1,0,0,0,i,1,0,0,0,0,1)}function Gh(t,e,n){(e>=Ft||e<=-Ft||t>=Ft||t<=-Ft)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),n=n||Ie();const i=tn(e),r=tn(t);return Be(n,1,0,r,0,0,1,i,0,0,0,1,0,0,0,0,1)}function zh(t,e,n){return Le(n,t[ci]*e[0]+t[ui]*e[1],t[li]*e[0]+t[hi]*e[1])}function Vh(t,e,n){return Fe(n,t[rs]*e[0]+t[os]*e[1]+t[us]*e[2],t[ss]*e[0]+t[cs]*e[1]+t[hs]*e[2],t[as]*e[0]+t[ls]*e[1]+t[ds]*e[2])}function Wh(t,e,n){return Oe(n,t[nn]*e[0]+t[on]*e[1]+t[hn]*e[2]+t[gn]*1,t[rn]*e[0]+t[cn]*e[1]+t[dn]*e[2]+t[mn]*1,t[sn]*e[0]+t[ln]*e[1]+t[fn]*e[2]+t[vn]*1,t[an]*e[0]+t[un]*e[1]+t[pn]*e[2]+t[wn]*1)}function gs(t,e,n){return Oe(n,t[nn]*e[0]+t[on]*e[1]+t[hn]*e[2]+t[gn]*e[3],t[rn]*e[0]+t[cn]*e[1]+t[dn]*e[2]+t[mn]*e[3],t[sn]*e[0]+t[ln]*e[1]+t[fn]*e[2]+t[vn]*e[3],t[an]*e[0]+t[un]*e[1]+t[pn]*e[2]+t[wn]*e[3])}function $h(t){return`Matrix: [
  ${t[0]}, ${t[1]},
  ${t[2]}, ${t[3]},
]`}function jh(t){return`Matrix: [
  ${t[0]}, ${t[1]}, ${t[2]},
  ${t[3]}, ${t[4]}, ${t[5]},
  ${t[6]}, ${t[7]}, ${t[8]},
]`}function Hh(t){return`Matrix: [
  ${t[0]}, ${t[1]}, ${t[2]}, ${t[3]},
  ${t[4]}, ${t[5]}, ${t[6]}, ${t[7]},
  ${t[8]}, ${t[9]}, ${t[10]}, ${t[11]},
  ${t[12]}, ${t[13]}, ${t[14]}, ${t[15]},
]`}function Hc(t,e){e=e||new Array(4);const n=Math.cos(t),i=Math.sin(t);return e[ci]=n,e[li]=-i,e[ui]=i,e[hi]=n,e}function Qc(t,e,n,i){if(t)if(e)if(n){const r=Pt(t),s=Pt(e),a=Pt(n),o=Dt(t),c=Dt(e),l=Dt(n);return Be(i,s*a,s*l,-c,0,o*c*a-r*l,o*c*l+r*a,o*s,0,r*c*a+o*l,r*c*l-o*a,r*s,0,0,0,0,1)}else{const r=Pt(t),s=Pt(e),a=Dt(t),o=Dt(e);return Be(i,s,0,-o,0,a*o,r,a*s,0,r*o,-a,r*s,0,0,0,0,1)}else if(n){const r=Pt(t),s=Pt(n),a=Dt(t),o=Dt(n);return Be(i,s,o,0,0,-r*o,r*s,a,0,a*o,-a*s,r,0,0,0,0,1)}else{const r=Pt(t),s=Dt(t);return Be(i,1,0,0,0,0,r,s,0,0,-s,r,0,0,0,0,1)}else if(e)if(n){const r=Pt(e),s=Pt(n),a=Dt(e),o=Dt(n);return Be(i,r*s,r*o,-a,0,-o,s,0,0,a*s,a*o,r,0,0,0,0,1)}else{const r=Pt(e),s=Dt(e);return Be(i,r,0,-s,0,0,1,0,0,s,0,r,0,0,0,0,1)}else if(n){const r=Pt(n),s=Dt(n);return Be(i,r,s,0,0,-s,r,0,0,0,0,1,0,0,0,0,1)}else return Ie(i)}function Qh(t,e){return Qc(t[0],t[1],t[2],e)}function Xh(t,e){return Xc(t[0],t[1],t[2],e)}function Xc(t,e,n,i){return Be(i,t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1)}function Yh(t,e){return Yc(t[0],t[1],t[2],e)}function Yc(t,e,n,i){return Be(i,1,0,0,0,0,1,0,0,0,0,1,0,t,e,n,1)}function va(t,e,n,i,r,s,a){return a=a||Ie(),Be(a,2*t/(i-n),0,0,0,0,2*t/(r-s),0,0,(i+n)/(i-n),(r+s)/(r-s),-(e+t)/(e-t),-1,0,0,-(2*e*t)/(e-t),0)}function qc(t,e,n,i,r,s){const a=n/e,o=tn(t/2)*i,c=-o,l=a*o,u=-l;return va(i,r,c,o,l,u,s)}function qh(t,e,n,i,r,s){const a=e/n,o=tn(t/2)*i,c=-o,l=a*o,u=-l;return va(i,r,u,l,o,c,s)}function Kc(t,e,n,i,r,s,a){return Be(a,2/(e-t),0,0,0,0,2/(i-n),0,0,0,0,-1/(s-r),0,(e+t)/(t-e),(i+n)/(n-i),-r/(r-s),1)}function Zc(t,e,n,i,r){return r=r||[0,0,0,0],gs(t,e,r),Oe(r,(r[0]/r[3]+1)*.5*n,(r[1]/r[3]+1)*.5*i,r[2]/r[3],1)}function wa(t,e,n,i,r){return Zc(t,[e[0],e[1],e[2],1],n,i,r)}function Kh(t,e){return Math.abs(t[0]-e[0])<=1e-7&&Math.abs(t[1]-e[1])<=1e-7&&Math.abs(t[2]-e[2])<=1e-7&&Math.abs(t[3]-e[3])<=1e-7}function Zh(t,e){return Math.abs(t[0]-e[0])<=1e-7&&Math.abs(t[1]-e[1])<=1e-7&&Math.abs(t[2]-e[2])<=1e-7&&Math.abs(t[3]-e[3])<=1e-7&&Math.abs(t[4]-e[4])<=1e-7&&Math.abs(t[5]-e[5])<=1e-7&&Math.abs(t[6]-e[6])<=1e-7&&Math.abs(t[7]-e[7])<=1e-7&&Math.abs(t[8]-e[8])<=1e-7}function Jc(t,e){return Math.abs(t[0]-e[0])<=1e-7&&Math.abs(t[1]-e[1])<=1e-7&&Math.abs(t[2]-e[2])<=1e-7&&Math.abs(t[3]-e[3])<=1e-7&&Math.abs(t[4]-e[4])<=1e-7&&Math.abs(t[5]-e[5])<=1e-7&&Math.abs(t[6]-e[6])<=1e-7&&Math.abs(t[7]-e[7])<=1e-7&&Math.abs(t[8]-e[8])<=1e-7&&Math.abs(t[9]-e[9])<=1e-7&&Math.abs(t[10]-e[10])<=1e-7&&Math.abs(t[11]-e[11])<=1e-7&&Math.abs(t[12]-e[12])<=1e-7&&Math.abs(t[13]-e[13])<=1e-7&&Math.abs(t[14]-e[14])<=1e-7&&Math.abs(t[15]-e[15])<=1e-7}function Jh(t){return[t[0],t[1],t[2],t[3]]}function ed(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function yr(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e):[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function ms(t,e,n,i){i=i||[];const[r,s,a]=t,[o,c,l]=n,[u,h,f,p,m,v,T,b,E]=e;i[nn]=u*r,i[rn]=h*s,i[sn]=f*a,i[an]=0,i[on]=p*r,i[cn]=m*s,i[ln]=v*a,i[un]=0,i[hn]=T*r,i[dn]=b*s,i[fn]=E*a,i[pn]=0,i[gn]=r*(u*o+p*c+T*l),i[mn]=s*(h*o+m*c+b*l),i[vn]=a*(f*o+v*c+E*l),i[wn]=1}function ya(t,e,n,i){i=i||[];const[r,s,a]=t,[o,c,l]=n,[u,h,f,p,m,v,T,b,E]=e;i[nn]=u*r,i[rn]=h*r,i[sn]=f*r,i[an]=0,i[on]=p*s,i[cn]=m*s,i[ln]=v*s,i[un]=0,i[hn]=T*a,i[dn]=b*a,i[fn]=E*a,i[pn]=0,i[gn]=o,i[mn]=c,i[vn]=l,i[wn]=1}function td(t,e,n,i){i=i||[];const[r,s]=t,[a,o]=n,[c,l,u,h]=e;i[nn]=c*r,i[rn]=l*s,i[sn]=0,i[an]=0,i[on]=u*r,i[cn]=h*s,i[ln]=0,i[un]=0,i[hn]=0,i[dn]=0,i[fn]=1,i[pn]=0,i[gn]=r*(c*a+u*o),i[mn]=s*(l*a+h*o),i[vn]=0,i[wn]=1}function el(t,e,n,i){i=i||[];const[r,s]=t,[a,o]=n,[c,l,u,h]=e;i[nn]=c*r,i[rn]=l*r,i[sn]=0,i[an]=0,i[on]=u*s,i[cn]=h*s,i[ln]=0,i[un]=0,i[hn]=0,i[dn]=0,i[fn]=1,i[pn]=0,i[gn]=a,i[mn]=o,i[vn]=0,i[wn]=1}const nm=Object.freeze(Object.defineProperty({__proto__:null,Hadamard2x2:Lh,Hadamard3x3:Oh,Hadamard4x4:Nh,M200:ci,M201:li,M210:ui,M211:hi,M300:rs,M301:ss,M302:as,M310:os,M311:cs,M312:ls,M320:us,M321:hs,M322:ds,M3R:Wi,M400:nn,M401:rn,M402:sn,M403:an,M410:on,M411:cn,M412:ln,M413:un,M420:hn,M421:dn,M422:fn,M423:pn,M430:gn,M431:mn,M432:vn,M433:wn,M4R:ot,SRT4x4:ya,SRT4x4_2D:el,TRS4x4:ms,TRS4x4_2D:td,add2x2:Ah,add3x3:Sh,add4x4:Mh,affineInverse2x2:mh,affineInverse3x3:vh,affineInverse4x4:wh,apply2x2:Bt,apply3x3:yt,apply4x4:Be,compare2x2:Kh,compare3x3:Zh,compare4x4:Jc,concat4x4:Rh,copy2x2:Jh,copy3x3:ed,copy4x4:yr,determinant2x2:Ne,determinant3x3:$i,determinant4x4:jc,identity2:fs,identity3:yn,identity4:Ie,multiply2x2:bh,multiply3x3:_h,multiply4x4:Mt,multiplyScalar2x2:yh,multiplyScalar3x3:Th,multiplyScalar4x4:Eh,orthographic4x4:Kc,perspective4x4:qc,perspectiveFOVY4x4:qh,perspectiveFrustum4x4:va,project3As4ToScreen:wa,projectToScreen:Zc,rotation2x2:Hc,rotation4x4:Qc,rotation4x4by3:Qh,scale4x4:Xc,scale4x4by3:Xh,shearX2x2:Fh,shearX4x4:Uh,shearY2x2:Bh,shearY4x4:kh,shearZ4x4:Gh,subtract2x2:xh,subtract3x3:Ih,subtract4x4:Ch,toString2x2:$h,toString3x3:jh,toString4x4:Hh,transform2:zh,transform3:Vh,transform3as4:Wh,transform4:gs,translation4x4:Yc,translation4x4by3:Yh,transpose2x2:Ph,transpose3x3:ps,transpose4x4:Dh},Symbol.toStringTag,{value:"Module"}));function tl(t,e){return!t||!e?t===e:!Object.keys(Object.assign({},t,e)).find(n=>t[n]!==e[n])}const{min:im,max:rm,pow:nd,round:sm,sin:vs,PI:Tr}=Math,ws=sm(Tr*1e3)/1e3;function de(t,e,n){return im(rm(t,e),n)}var Tn=(t=>(t[t.NONE=1]="NONE",t[t.CONTINUOUS=4]="CONTINUOUS",t[t.REPEAT=2]="REPEAT",t[t.REFLECT=3]="REFLECT",t))(Tn||{});const am=`
\${easingMethod} {
  return end;
}
`,om=`
\${easingMethod} {
  return (end - start) * t + start;
}
`,cm=`
\${easingMethod} {
  float time = t * t;
  return (end - start) * time + start;
}
`,lm=`
\${easingMethod} {
  float time = t * (2.0 - t);
  return (end - start) * time + start;
}
`,um=`
\${easingMethod} {
  float time = t < 0.5 ? 2.0 * t * t : -1.0 + (4.0 - 2.0 * t) * t;
  return (end - start) * time + start;
}
`,hm=`
\${easingMethod} {
  float time = t * t * t;
  return (end - start) * time + start;
}
`,dm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = t1 * t1 * t1 + 1.0;
  return (end - start) * time + start;
}
`,fm=`
\${easingMethod} {
  float time = t < 0.5 ? 4.0 * t * t * t : (t - 1.0) * (2.0 * t - 2.0) * (2.0 * t - 2.0) + 1.0;
  return (end - start) * time + start;
}
`,pm=`
\${easingMethod} {
  float time = t * t * t * t;
  return (end - start) * time + start;
}
`,gm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = 1.0 - t1 * t1 * t1 * t1;
  return (end - start) * time + start;
}
`,mm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = t < 0.5 ? 8.0 * t * t * t * t : 1.0 - 8.0 * t1 * t1 * t1 * t1;
  return (end - start) * time + start;
}
`,vm=`
\${easingMethod} {
  float time = t * t * t * t * t;
  return (end - start) * time + start;
}
`,wm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = 1.0 + t1 * t1 * t1 * t1 * t1;
  return (end - start) * time + start;
}
`,ym=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = t < 0.5 ? 16.0 * t * t * t * t * t : 1.0 + 16.0 * t1 * t1 * t1 * t1 * t1;
  return (end - start) * time + start;
}
`,Tm=`
\${easingMethod} {
  float p = 0.3;
  float time = pow(2.0, -10.0 * t) * sin((t - p / 4.0) * (2.0 * ${ws}) / p) + 1.0;
  return (end - start) * time + start;
}
`,Em=`
\${easingMethod} {
  float time = t * t * t - t * 1.05 * sin(t * ${ws});
  return (end - start) * time + start;
}
`,bm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float a = 1.7;
  float time = (t1 * t1 * ((a + 1.0) * t1 + a) + 1.0);
  return (end - start) * time + start;
}
`,_m=`
\${easingMethod} {
  float a = 1.4;
  float a1 = a * 1.525;
  float t1 = t / 0.5;
  float t2 = t1 - 2.0;
  float time =
    (t1 < 1.0) ? 0.5 * (t1 * t1 * (a1 + 1.0) * t1 - a1) :
    0.5 * (t2 * t2 * ((a1 + 1.0) * t2 + a1) + 2.0)
  ;

  return (end - start) * time + start;
}
`,Rm=`
\${easingMethod} {
  \${T} direction = end - start;
  return start + direction * 0.5 + direction * sin(t * ${ws} * 2.0) * 0.5;
}
`,Am=`
\${easingMethod} {
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - t, t),
    vec2(sin((1.0 - t) * omega) / sinom, sin(t * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Sm=`
\${easingMethod} {
  float time = t * t;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Mm=`
\${easingMethod} {
  float time = t * (2.0 - t);
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,xm=`
\${easingMethod} {
  float time = t < 0.5 ? 2.0 * t * t : -1.0 + (4.0 - 2.0 * t) * t;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Im=`
\${easingMethod} {
  float time = t * t * t;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Cm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = t1 * t1 * t1 + 1.0;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Lm=`
\${easingMethod} {
  float time = t < 0.5 ? 4.0 * t * t * t : (t - 1.0) * (2.0 * t - 2.0) * (2.0 * t - 2.0) + 1.0;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Om=`
\${easingMethod} {
  float time = t * t * t * t;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Nm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = 1.0 - t1 * t1 * t1 * t1;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Pm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = t < 0.5 ? 8.0 * t * t * t * t : 1.0 - 8.0 * t1 * t1 * t1 * t1;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Dm=`
\${easingMethod} {
  float time = t * t * t * t * t;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Fm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = 1.0 + t1 * t1 * t1 * t1 * t1;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Bm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = t < 0.5 ? 16.0 * t * t * t * t * t : 1.0 + 16.0 * t1 * t1 * t1 * t1 * t1;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Um=`
\${easingMethod} {
  float p = 0.3;
  float time = pow(2.0, -10.0 * t) * sin((t - p / 4.0) * (2.0 * ${ws}) / p) + 1.0;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,km=`
\${easingMethod} {
  float time = t * t * t - t * 1.05 * sin(t * ${ws});
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Gm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float a = 1.7;
  float time = (t1 * t1 * ((a + 1.0) * t1 + a) + 1.0);
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,zm=`
\${easingMethod} {
  float a = 1.4;
  float a1 = a * 1.525;
  float t1 = t / 0.5;
  float t2 = t1 - 2.0;
  float time =
    (t1 < 1.0) ? 0.5 * (t1 * t1 * (a1 + 1.0) * t1 - a1) :
    0.5 * (t2 * t2 * ((a1 + 1.0) * t2 + a1) + 2.0)
  ;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`;class Ta{constructor(e,n,i,r){this.uid=K(),this.delay=0,this.duration=500,this.loop=1,this.cpu=e,this.gpu=n,this.duration=i||500,this.methodName=r||"easingMethod"}static immediate(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{const{copy:c}=X(r);return c(s,o)},delay:n,duration:e,gpu:am,loop:i,methodName:"immediate"}}static linear(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{const{add:c,scale:l,subtract:u}=X(r);return a=de(a,0,1),c(l(u(s,r),a),r,o)},delay:n,duration:e,gpu:om,loop:i,methodName:"linear"}}static easeInQuad(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=a*a,{add:l,scale:u,subtract:h}=X(r);return l(u(h(s,r),c),r,o)},delay:n,duration:e,gpu:cm,loop:i,methodName:"easeInQuad"}}static easeOutQuad(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=a*(2-a),{add:l,scale:u,subtract:h}=X(r);return l(u(h(s,r),c),r,o)},delay:n,duration:e,gpu:lm,loop:i,methodName:"easeOutQuad"}}static easeInOutQuad(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=a<.5?2*a*a:-1+(4-2*a)*a,{add:l,scale:u,subtract:h}=X(r);return l(u(h(s,r),c),r,o)},delay:n,duration:e,gpu:um,loop:i,methodName:"easeInOutQuad"}}static easeInCubic(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=a*a*a,{add:l,scale:u,subtract:h}=X(r);return l(u(h(s,r),c),r,o)},delay:n,duration:e,gpu:hm,loop:i,methodName:"easeInCubic"}}static easeOutCubic(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=--a*a*a+1,{add:l,scale:u,subtract:h}=X(r);return l(u(h(s,r),c),r,o)},delay:n,duration:e,gpu:dm,loop:i,methodName:"easeOutCubic"}}static easeInOutCubic(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=a<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1,{add:l,scale:u,subtract:h}=X(r);return l(u(h(s,r),c),r,o)},delay:n,duration:e,gpu:fm,loop:i,methodName:"easeInOutCubic"}}static easeInQuart(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=a*a*a*a,{add:l,scale:u,subtract:h}=X(r);return l(u(h(s,r),c),r,o)},delay:n,duration:e,gpu:pm,loop:i,methodName:"easeInQuart"}}static easeOutQuart(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=1- --a*a*a*a,{add:l,scale:u,subtract:h}=X(r);return l(u(h(s,r),c),r,o)},delay:n,duration:e,gpu:gm,loop:i,methodName:"easeOutQuart"}}static easeInOutQuart(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=a<.5?8*a*a*a*a:1-8*--a*a*a*a,{add:l,scale:u,subtract:h}=X(r);return l(u(h(s,r),c),r,o)},delay:n,duration:e,gpu:mm,loop:i,methodName:"easeInOutQuart"}}static easeInQuint(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=a*a*a*a*a,{add:l,scale:u,subtract:h}=X(r);return l(u(h(s,r),c),r,o)},delay:n,duration:e,gpu:vm,loop:i,methodName:"easeInQuint"}}static easeOutQuint(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=1+--a*a*a*a*a,{add:l,scale:u,subtract:h}=X(r);return l(u(h(s,r),c),r,o)},delay:n,duration:e,gpu:wm,loop:i,methodName:"easeOutQuint"}}static easeInOutQuint(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=a<.5?16*a*a*a*a*a:1+16*--a*a*a*a*a,{add:l,scale:u,subtract:h}=X(r);return l(u(h(s,r),c),r,o)},delay:n,duration:e,gpu:ym,loop:i,methodName:"easeInOutQuint"}}static easeOutElastic(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=.3,l=nd(2,-10*a)*vs((a-c/4)*(2*Tr)/c)+1,{add:u,scale:h,subtract:f}=X(r);return u(h(f(s,r),l),r,o)},delay:n,duration:e,gpu:Tm,loop:i,methodName:"easeOutElastic"}}static easeBackIn(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=1.05,l=a*a*a-a*c*vs(a*Tr),{add:u,scale:h,subtract:f}=X(r);return u(h(f(s,r),l),r,o)},delay:n,duration:e,gpu:Em,loop:i,methodName:"easeBackIn"}}static easeBackOut(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const c=1.7,l=a-1,u=l*l*((c+1)*l+c)+1,{add:h,scale:f,subtract:p}=X(r);return h(f(p(s,r),u),r,o)},delay:n,duration:e,gpu:bm,loop:i,methodName:"easeBackOut"}}static easeBackInOut(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{a=de(a,0,1);const l=1.7*1.525,u=a/.5,h=u-2,f=u<1?.5*(u*u*(l+1)*u-l):.5*(h*h*((l+1)*h+l)+2),{add:p,scale:m,subtract:v}=X(r);return p(m(v(s,r),f),r,o)},delay:n,duration:e,gpu:_m,loop:i,methodName:"easeBackInOut"}}static continuousSinusoidal(e,n=0,i=4){return{uid:K(),cpu:(r,s,a,o)=>{const{add:c,scale:l,subtract:u}=X(r);a=de(a,0,1);const h=u(s,r),f=l(h,.5);return c(c(r,f),l(f,vs(a*Tr*2)*1),o)},delay:n,duration:e,gpu:Rm,loop:i,methodName:"repeatingSinusoidal",validation:{ignoreEndValueCheck:!0,ignoreOverTimeCheck:!0}}}static slerpQuatLinear(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:u}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),u(1,0,0,0)}a=de(a,0,1);const{slerpQuat:c,vec:l}=X(r);return c?c(r,s,a,o):l(1,0,0,0)},delay:n,duration:e,gpu:Am,loop:i,methodName:"slerpQuatLinear"}}static slerpQuatInQuad(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:h}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=de(a,0,1);const c=a*a,{slerpQuat:l,vec:u}=X(r);return l?l(r,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Sm,loop:i,methodName:"slerpQuatInQuad"}}static slerpQuatOutQuad(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:h}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=de(a,0,1);const c=a*(2-a),{slerpQuat:l,vec:u}=X(r);return l?l(r,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Mm,loop:i,methodName:"slerpQuatOutQuad"}}static slerpQuatInOutQuad(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:h}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=de(a,0,1);const c=a<.5?2*a*a:-1+(4-2*a)*a,{slerpQuat:l,vec:u}=X(r);return l?l(r,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:xm,loop:i,methodName:"slerpQuatInOutQuad"}}static slerpQuatInCubic(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:h}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=de(a,0,1);const c=a*a*a,{slerpQuat:l,vec:u}=X(r);return l?l(r,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Im,loop:i,methodName:"slerpQuatInCubic"}}static slerpQuatOutCubic(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:h}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=de(a,0,1);const c=--a*a*a+1,{slerpQuat:l,vec:u}=X(r);return l?l(r,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Cm,loop:i,methodName:"slerpQuatOutCubic"}}static slerpQuatInOutCubic(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:h}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=de(a,0,1);const c=a<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1,{slerpQuat:l,vec:u}=X(r);return l?l(r,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Lm,loop:i,methodName:"slerpQuatInOutCubic"}}static slerpQuatInQuart(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:h}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=de(a,0,1);const c=a*a*a*a,{slerpQuat:l,vec:u}=X(r);return l?l(r,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Om,loop:i,methodName:"slerpQuatInQuart"}}static slerpQuatOutQuart(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:h}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=de(a,0,1);const c=1- --a*a*a*a,{slerpQuat:l,vec:u}=X(r);return l?l(r,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Nm,loop:i,methodName:"slerpQuatOutQuart"}}static slerpQuatInOutQuart(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:h}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=de(a,0,1);const c=a<.5?8*a*a*a*a:1-8*--a*a*a*a,{slerpQuat:l,vec:u}=X(r);return l?l(r,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Pm,loop:i,methodName:"slerpQuatInOutQuart"}}static slerpQuatInQuint(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:h}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=de(a,0,1);const c=a*a*a*a*a,{slerpQuat:l,vec:u}=X(r);return l?l(r,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Dm,loop:i,methodName:"slerpQuatInQuint"}}static slerpQuatOutQuint(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:h}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=de(a,0,1);const c=1+--a*a*a*a*a,{slerpQuat:l,vec:u}=X(r);return l?l(r,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Fm,loop:i,methodName:"slerpQuatOutQuint"}}static slerpQuatInOutQuint(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:h}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=de(a,0,1);const c=a<.5?16*a*a*a*a*a:1+16*--a*a*a*a*a,{slerpQuat:l,vec:u}=X(r);return l?l(r,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Bm,loop:i,methodName:"slerpQuatInOutQuint"}}static slerpQuatOutElastic(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:f}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),f(1,0,0,0)}a=de(a,0,1);const c=.3,l=nd(2,-10*a)*vs((a-c/4)*(2*Tr)/c)+1,{slerpQuat:u,vec:h}=X(r);return u?u(r,s,l,o):h(1,0,0,0)},delay:n,duration:e,gpu:Um,loop:i,methodName:"slerpQuatOutElastic"}}static slerpQuatBackIn(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:f}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),f(1,0,0,0)}a=de(a,0,1);const c=1.05,l=a*a*a-a*c*vs(a*Tr),{slerpQuat:u,vec:h}=X(r);return u?u(r,s,l,o):h(1,0,0,0)},delay:n,duration:e,gpu:km,loop:i,methodName:"slerpQuatBackIn"}}static slerpQuatBackOut(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:p}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),p(1,0,0,0)}a=de(a,0,1);const c=1.7,l=a-1,u=l*l*((c+1)*l+c)+1,{slerpQuat:h,vec:f}=X(r);return h?h(r,s,u,o):f(1,0,0,0)},delay:n,duration:e,gpu:Gm,loop:i,methodName:"slerpQuatBackOut"}}static slerpQuatBackInOut(e,n=0,i=1){return{uid:K(),cpu:(r,s,a,o)=>{if(!Y(r)||!Y(s)||!Y(o)){const{vec:v}=X(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),v(1,0,0,0)}a=de(a,0,1);const l=1.7*1.525,u=a/.5,h=u-2,f=u<1?.5*(u*u*(l+1)*u-l):.5*(h*h*((l+1)*h+l)+2),{slerpQuat:p,vec:m}=X(r);return p?p(r,s,f,o):m(1,0,0,0)},delay:n,duration:e,gpu:zm,loop:i,methodName:"slerpQuatBackInOut"}}}const{cos:ys,sin:di,sqrt:xt,exp:id,acos:nl,atan2:rd,PI:sd}=Math;let Tt,En,bn,_n,et,ct,Er,Rn,Et,Ye,br,Ea,ba,fi,Q,Gt,_a,_r;const ad=Ue(),od=Ue(),cd=Ue(),ld=Ue(),ud=1,hd=2,dd=3,fd=0;function bt(t,e,n){return t>n?n:t<e?e:t}function Ue(t){return t?(t[0]=0,t[1]=0,t[2]=0,t[3]=0,t):[0,0,0,0]}function pd(t,e,n){return n=n||Ue(),n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n[3]=t[3]+e[3],n}function il(t,e,n){n=n||Ue();const i=t[0],r=e[0],s=t[1],a=e[1],o=t[2],c=e[2],l=t[3],u=e[3];return n[0]=i*r-s*a-o*c-l*u,n[1]=i*a+s*r+o*u-l*c,n[2]=i*c-s*u+o*r+l*a,n[3]=i*u+s*c-o*a+l*r,n}function gd(t,e,n){n=n||Ue();const i=t[0],r=t[1],s=t[2],a=t[3],o=e[0],c=e[1],l=e[2],u=e[3],h=o*o+c*c+l*l+u*u;if(h===0)n[0]=0,n[1]=0,n[2]=0,n[3]=0;else{const f=1/h;n[0]=(i*o+r*c+s*l+a*u)*f,n[1]=(r*o-i*c-s*u+a*l)*f,n[2]=(s*o-i*l-a*c+r*u)*f,n[3]=(a*o-i*u-r*l+s*c)*f}return n}function md(t,e){e=e||Ue();const n=t[0],i=t[1],r=t[2],s=t[3],a=xt(i*i+r*r+s*s),o=id(n),c=o/a*di(a);return a===0?(e[0]=id(n),e[1]=0,e[2]=0,e[3]=0):(e[0]=o*ys(a),e[1]=i*c,e[2]=r*c,e[3]=s*c),e}function rl(t,e,n){return n=n||Ue(),n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}function vd(t,e,n){return n=n||Ue(),il(e,sl(t),n)}function sl(t,e){return e=e||Ue(),e[0]=t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function wd(t,e){e=e||Ue();const n=t[0],i=t[1],r=t[2],s=t[3],a=n*n+i*i+r*r+s*s;if(a===0)e[0]=0,e[1]=0,e[2]=0,e[3]=0;else{const o=1/a;e[0]=n*o,e[1]=-i*o,e[2]=-r*o,e[3]=-s*o}return e}function al(t){const e=t[0],n=t[1],i=t[2],r=t[3];return xt(e*e+n*n+i*i+r*r)}function yd(t,e){e=e||Ue();const n=al(t);if(n===0)return[0,0,0,0];const i=1/n;return rl(t,i,e)}function Td(t){return t[0]}function Ed(t){return[t[1],t[2],t[3]]}function bd(t,e){return na(t,e)}function _d(t,e,n){n=n||Ue();const i=t[0],r=t[1],s=t[2],a=1/xt(i*i+r*r+s*s),o=di(e/2);return n[0]=ys(e/2),n[1]=o*i*a,n[2]=o*r*a,n[3]=o*s*a,n}function ol(t,e,n){n=n||Ue();const i=t[0],r=t[1],s=t[2],a=Math.cos,o=Math.sin,c=a(i/2),l=a(r/2),u=a(s/2),h=o(i/2),f=o(r/2),p=o(s/2);switch(e){case _e.xyz:n[1]=h*l*u+c*f*p,n[2]=c*f*u-h*l*p,n[3]=c*l*p+h*f*u,n[0]=c*l*u-h*f*p;break;case _e.yxz:n[0]=c*l*u+h*f*p,n[1]=h*l*u+c*f*p,n[2]=c*f*u-h*l*p,n[3]=c*l*p-h*f*u;break;case _e.zxy:n[0]=c*l*u-h*f*p,n[1]=h*l*u-c*f*p,n[2]=c*f*u+h*l*p,n[3]=c*l*p+h*f*u;break;case _e.zyx:n[0]=c*l*u+h*f*p,n[1]=h*l*u-c*f*p,n[2]=c*f*u+h*l*p,n[3]=c*l*p-h*f*u;break;case _e.yzx:n[0]=c*l*u-h*f*p,n[1]=h*l*u+c*f*p,n[2]=c*f*u+h*l*p,n[3]=c*l*p-h*f*u;break;case _e.xzy:n[0]=c*l*u+h*f*p,n[1]=h*l*u-c*f*p,n[2]=c*f*u-h*l*p,n[3]=c*l*p+h*f*u;break}return n}function Rd(t,e,n){n=n||[0,0,0];const i=ol(t,e);return Ra(i,_e.xyz,n),n}function Rr(t,e,n,i,r,s){s[0]=rd(t,e),s[1]=nl(n),s[2]=rd(i,r)}function Ad(t,e){return Ra(t,_e.zyx,e)}function Ra(t,e,n){n=n||[0,0,0];const i=t[0],r=t[1],s=t[2],a=t[3],o=Sa(t),c=o[0],l=o[4],u=o[8],h=o[1],f=o[5],p=o[9],m=o[2],v=o[6],T=o[10];switch(e){case _e.zyx:n[1]=Math.asin(-bt(m,-1,1)),Math.abs(m)<.99999?(n[0]=Math.atan2(v,T),n[2]=Math.atan2(h,c)):(n[0]=0,n[2]=Math.atan2(-l,f));break;case _e.zyz:Rr(2*s*a+2*i*r,2*i*s-2*r*a,a*a-s*s-r*r+i*i,2*s*a-2*i*r,2*r*a+2*i*s,n);break;case _e.zxy:n[0]=Math.asin(bt(v,-1,1)),Math.abs(v)<.99999?(n[1]=Math.atan2(-m,T),n[2]=Math.atan2(-l,f)):(n[1]=0,n[2]=Math.atan2(h,c));break;case _e.zxz:Rr(2*r*a-2*i*s,2*s*a+2*i*r,a*a-s*s-r*r+i*i,2*r*a+2*i*s,2*i*r-2*s*a,n);break;case _e.yxz:n[0]=Math.asin(-bt(p,-1,1)),Math.abs(p)<.9999?(n[1]=Math.atan2(u,T),n[2]=Math.atan2(h,f)):(n[1]=Math.atan2(-m,c),n[2]=0);break;case _e.yxy:Rr(2*r*s+2*i*a,2*i*r-2*s*a,s*s-a*a+i*i-r*r,2*r*s-2*i*a,2*s*a+2*i*r,n);break;case _e.yzx:n[2]=Math.asin(bt(h,-1,1)),Math.abs(h)<.99999?(n[0]=Math.atan2(-p,f),n[1]=Math.atan2(-m,c)):(n[0]=0,n[1]=Math.atan2(u,T));break;case _e.yzy:Rr(2*s*a-2*i*r,2*r*s+2*i*a,s*s-a*a+i*i-r*r,2*s*a+2*i*r,2*i*a-2*r*s,n);break;case _e.xyz:n[1]=Math.asin(bt(u,-1,1)),Math.abs(u)<.99999?(n[0]=Math.atan2(-p,T),n[2]=Math.atan2(-l,c)):(n[0]=Math.atan2(v,f),n[2]=0);break;case _e.xyx:Rr(2*r*s-2*i*a,2*r*a+2*i*s,r*r+i*i-a*a-s*s,2*r*s+2*i*a,2*i*s-2*r*a,n);break;case _e.xzy:n[2]=Math.asin(-bt(l,-1,1)),Math.abs(l)<.99999?(n[0]=Math.atan2(v,f),n[1]=Math.atan2(u,c)):(n[0]=Math.atan2(-p,T),n[1]=0);break;case _e.xzx:Rr(2*r*a+2*i*s,2*i*a-2*r*s,r*r+i*i-a*a-s*s,2*r*a-2*i*s,2*r*s+2*i*a,n);break;default:console.warn("Invalid Euler rotation order.");break}return n}function Sd(t,e,n){n=n||[0,0,0];const i=Sa(t),r=i[0],s=i[4],a=i[8],o=i[1],c=i[5],l=i[9],u=i[2],h=i[6],f=i[10];switch(e){case _e.xyz:n[1]=Math.asin(bt(a,-1,1)),Math.abs(a)<.99999?(n[0]=Math.atan2(-l,f),n[2]=Math.atan2(-s,r)):(n[0]=Math.atan2(h,c),n[2]=0);break;case _e.yxz:n[0]=Math.asin(-bt(l,-1,1)),Math.abs(l)<.9999?(n[1]=Math.atan2(a,f),n[2]=Math.atan2(o,c)):(n[1]=Math.atan2(-u,r),n[2]=0);break;case _e.zxy:n[0]=Math.asin(bt(h,-1,1)),Math.abs(h)<.99999?(n[1]=Math.atan2(-u,f),n[2]=Math.atan2(-s,c)):(n[1]=0,n[2]=Math.atan2(o,r));break;case _e.zyx:n[1]=Math.asin(-bt(u,-1,1)),Math.abs(u)<.99999?(n[0]=Math.atan2(h,f),n[2]=Math.atan2(o,r)):(n[0]=0,n[2]=Math.atan2(-s,c));break;case _e.yzx:n[2]=Math.asin(bt(o,-1,1)),Math.abs(o)<.99999?(n[0]=Math.atan2(-l,c),n[1]=Math.atan2(-u,r)):(n[0]=0,n[1]=Math.atan2(a,f));break;case _e.xzy:n[2]=Math.asin(-bt(s,-1,1)),Math.abs(s)<.99999?(n[0]=Math.atan2(h,c),n[1]=Math.atan2(a,r)):(n[0]=Math.atan2(-l,f),n[1]=0);break}}function Md(t){const e=t[0];if(e<-1||e>1)return 0;const n=2*nl(e);return n>sd?n-2*sd:n}function xd(t){const e=t[1],n=t[2],i=t[3];if(xt(e*e+n*n+i*i)===0)return[0,0,0];const s=1/xt(e*e+n*n+i*i);return[e*s,n*s,i*s]}function Aa(t,e){e=e||yn();const n=t[1]+t[1],i=t[2]+t[2],r=t[3]+t[3],s=t[1]*n,a=t[1]*i,o=t[1]*r,c=t[2]*i,l=t[2]*r,u=t[3]*r,h=t[0]*n,f=t[0]*i,p=t[0]*r;return e[rs]=1-(c+u),e[ss]=a-p,e[as]=o+f,e[os]=a+p,e[cs]=1-(s+u),e[ls]=l-h,e[us]=o-f,e[hs]=l+h,e[ds]=1-(s+c),e}function Id(t,e){e=e||Ie();const n=t[1]+t[1],i=t[2]+t[2],r=t[3]+t[3],s=t[1]*n,a=t[1]*i,o=t[1]*r,c=t[2]*i,l=t[2]*r,u=t[3]*r,h=t[0]*n,f=t[0]*i,p=t[0]*r;return e[nn]=1-(c+u),e[rn]=a-p,e[sn]=o+f,e[an]=0,e[on]=a+p,e[cn]=1-(s+u),e[ln]=l-h,e[un]=0,e[hn]=o-f,e[dn]=l+h,e[fn]=1-(s+c),e[pn]=0,e[gn]=0,e[mn]=0,e[vn]=0,e[wn]=1,e}function Cd(t,e){e=e||yn();const n=t[1]+t[1],i=t[2]+t[2],r=t[3]+t[3],s=t[1]*n,a=t[1]*i,o=t[1]*r,c=t[2]*i,l=t[2]*r,u=t[3]*r,h=t[0]*n,f=t[0]*i,p=t[0]*r;return e[rs]=1-(c+u),e[os]=a-p,e[us]=o+f,e[ss]=a+p,e[cs]=1-(s+u),e[hs]=l-h,e[as]=o-f,e[ls]=l+h,e[ds]=1-(s+c),e}function Sa(t,e){e=e||Ie();const n=t[1]+t[1],i=t[2]+t[2],r=t[3]+t[3],s=t[1]*n,a=t[1]*i,o=t[1]*r,c=t[2]*i,l=t[2]*r,u=t[3]*r,h=t[0]*n,f=t[0]*i,p=t[0]*r;return e[nn]=1-(c+u),e[on]=a-p,e[hn]=o+f,e[gn]=0,e[rn]=a+p,e[cn]=1-(s+u),e[dn]=l-h,e[mn]=0,e[sn]=o-f,e[ln]=l+h,e[fn]=1-(s+c),e[vn]=0,e[an]=0,e[un]=0,e[pn]=0,e[wn]=1,e}function Ld(t,e){e=e||Ue();const[n,i,r]=t,s=ys(n/2),a=ys(i/2),o=ys(r/2),c=di(n/2),l=di(i/2),u=di(r/2),h=a*o,f=l*u,p=a*u,m=l*o;return e[0]=s*h+c*f,e[1]=c*h-s*f,e[2]=s*m+c*p,e[3]=s*p-c*m,e}function cl(t,e,n){return n=n||Ue(),_r=Ot([-t[0],-t[1],-t[2]],dt[dt.length-1]),Gt=Ot(mt(e,_r,dt[dt.length-2])),_a=mt(_r,Gt,dt[dt.length-3]),et=Gt[0],ct=_a[0],Er=_r[0],Et=Gt[1],Ye=_a[1],br=_r[1],Ea=Gt[2],ba=_a[2],fi=_r[2],Q=(1+et+Ye+fi)*.25,Q>0?(Q=Math.sqrt(Q),n[0]=Q,Q=1/(4*Q),n[1]=(br-ba)*Q,n[2]=(Ea-Er)*Q,n[3]=(ct-Et)*Q):(n[0]=0,Q=-.5*(Ye+fi),Q>0?(Q=Math.sqrt(Q),n[1]=Q,Q*=2,n[2]=ct/Q,n[3]=Er/Q):(n[1]=0,Q=.5*(1-fi),Q>0?(Q=Math.sqrt(Q),n[2]=Q,n[3]=br/(2*Q)):(n[2]=0,n[3]=1))),n}function Od(t,e){if(e=e||Ue(),Tt=t[0],En=t[3],bn=t[6],_n=t[1],et=t[4],ct=t[7],Rn=t[2],Et=t[5],Ye=t[8],Q=Tt+et+Ye,Q>0){const i=xt(Q+1)*2;return e[0]=.25*i,e[1]=(Et-ct)/i,e[2]=(bn-Rn)/i,e[3]=(_n-En)/i,e}if(Tt>et&&Tt>Ye){const i=xt(1+Tt-et-Ye)*2;return e[0]=(Et-ct)/i,e[1]=.25*i,e[2]=(En+_n)/i,e[3]=(bn+Rn)/i,e}if(et>Ye){const i=xt(1+et-Tt-Ye)*2;return e[0]=(bn-Rn)/i,e[1]=(_n+En)/i,e[2]=.25*i,e[3]=(Et+ct)/i,e}const n=xt(1+Ye-Tt-et)*2;return e[0]=(_n-En)/n,e[1]=(Rn+bn)/n,e[2]=(Et+ct)/n,e[3]=.25*n,e}function Nd(t,e){if(e=e||Ue(),Tt=t[0],En=t[4],bn=t[8],_n=t[1],et=t[5],ct=t[9],Rn=t[2],Et=t[6],Ye=t[10],Q=Tt+et+Ye,Q>0){const i=xt(Q+1)*2;return e[0]=.25*i,e[1]=(Et-ct)/i,e[2]=(bn-Rn)/i,e[3]=(_n-En)/i,e}if(Tt>et&&Tt>Ye){const i=xt(1+Tt-et-Ye)*2;return e[0]=(Et-ct)/i,e[1]=.25*i,e[2]=(En+_n)/i,e[3]=(bn+Rn)/i,e}if(et>Ye){const i=xt(1+et-Tt-Ye)*2;return e[0]=(bn-Rn)/i,e[1]=(_n+En)/i,e[2]=.25*i,e[3]=(Et+ct)/i,e}const n=xt(1+Ye-Tt-et)*2;return e[0]=(_n-En)/n,e[1]=(Rn+bn)/n,e[2]=(Et+ct)/n,e[3]=.25*n,e}function Ma(t,e,n,i,r){return r=r||Ue(),et=t[0]/e,ct=t[4]/n,Er=t[8]/i,Et=t[1]/e,Ye=t[5]/n,br=t[9]/i,Ea=t[2]/e,ba=t[6]/n,fi=t[10]/i,Q=(1+et+Ye+fi)*.25,Q>0?(Q=Math.sqrt(Q),r[0]=Q,Q=1/(4*Q),r[1]=(br-ba)*Q,r[2]=(Ea-Er)*Q,r[3]=(ct-Et)*Q):(r[0]=0,Q=-.5*(Ye+fi),Q>0?(Q=Math.sqrt(Q),r[1]=Q,Q*=2,r[2]=ct/Q,r[3]=Er/Q):(r[1]=0,Q=.5*(1-fi),Q>0?(Q=Math.sqrt(Q),r[2]=Q,r[3]=br/(2*Q)):(r[2]=0,r[3]=1))),r}function Pd(t,e,n){n=n||Ie();const i=Ot([-t[0],-t[1],-t[2]]),r=Ot(mt(e,i)),s=mt(i,r);return n[0]=r[0],n[1]=s[0],n[2]=i[0],n[3]=0,n[4]=r[1],n[5]=s[1],n[6]=i[1],n[7]=0,n[8]=r[2],n[9]=s[2],n[10]=i[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function xa(t,e,n){return Gt=ri(e[1],e[2],e[3]),Q=e[0],qt(qt(St(Gt,2*Xr(Gt,t)),St(t,Q*Q-Xr(Gt,Gt))),St(mt(Gt,t),2*Q),n)}function Dd(t,e,n,i){i=i||Ue();const r=[0,0,0,0];let s,a,o,c,l;return a=t[1]*e[1]+t[2]*e[2]+t[3]*e[3]+t[0]*e[0],a<0?(a=-a,r[0]=-e[1],r[1]=-e[2],r[2]=-e[3],r[3]=-e[0]):(r[0]=e[1],r[1]=e[2],r[2]=e[3],r[3]=e[0]),1-a>1e-7?(s=nl(a),o=di(s),c=di((1-n)*s)/o,l=di(n*s)/o):(c=1-n,l=n),i[1]=c*t[1]+l*r[0],i[2]=c*t[2]+l*r[1],i[3]=c*t[3]+l*r[2],i[0]=c*t[0]+l*r[3],i}function Ts(){return[1,0,0,0]}function Fd(){return[0,1,0,0]}function Bd(){return[0,0,1,0]}function Ud(){return[0,0,0,1]}const Vm=Object.freeze(Object.defineProperty({__proto__:null,QR1:ad,QR2:od,QR3:cd,QR4:ld,QW:fd,QX:ud,QY:hd,QZ:dd,addQuat:pd,angleQuat:Md,axisQuat:xd,clamp:bt,conjugateQuat:sl,decomposeRotation:Ma,diffUnitQuat:vd,divideQuat:gd,dotQuat:bd,eulerToQuat:Ld,exponentQuat:md,fromEulerAxisAngleToQuat:_d,fromOrderedEulerToQuat:ol,iQuat:Fd,imaginaryQuat:Ed,inverseQuat:wd,jQuat:Bd,kQuat:Ud,lengthQuat:al,lookAtMatrix:Pd,lookAtQuat:cl,matrix3x3FromUnitQuatModel:Aa,matrix3x3FromUnitQuatView:Cd,matrix3x3ToQuaternion:Od,matrix4x4FromUnitQuatModel:Id,matrix4x4FromUnitQuatView:Sa,matrix4x4ToQuaternion:Nd,multiplyQuat:il,normalizeQuat:yd,oneQuat:Ts,realQuat:Td,rotateVectorByUnitQuat:xa,scaleQuat:rl,slerpUnitQuat:Dd,toEulerFromQuat:Ad,toEulerXYZfromOrderedEuler:Rd,toOrderedEulerFromQuat:Ra,toOrderedEulerFromQuat2:Sd,zeroQuat:Ue},Symbol.toStringTag,{value:"Module"}));function ll(t,e){return[t,e]}function kd(t,e,n){return n=n||[0,0,0],qt(t[0],St(t[1],e),n)}function ul(t,e,n){return n=n||[[0,0,0],[0,0,0]],At(t,n[0]),Ot(Kt(e,t),n[1]),n}const Wm=Object.freeze(Object.defineProperty({__proto__:null,ray:ll,rayFromPoints:ul,rayToLocation:kd},Symbol.toStringTag,{value:"Module"})),$m=nm,jm=Vm,Hm=Wm,Qm=Ag;let lt=class{constructor(){this.promise=new Promise((e,n)=>(this.resolver=e,this.rejector=n))}resolve(e){this.resolver(e)}reject(e){this.rejector(e)}},zt=-1,Ia=0,Ca=[],Es=[],bs=[];const Ar=new Map,Sr=t=>{Ia=t;let e=!1;const n=[];Ar.forEach((r,s)=>{e=!0;let[a,o,c,l,u]=r;if(l!==-1&&(u===-1&&(u=t,r[4]=t),t-u>=l)){n.push(s),a(t,u+l);return}if(o!==-1){if(c===-1&&(r[2]=t,c=t),t-c>=o)for(a(t);t-c>=o;)r[2]+=o,c+=o}else a(t)});for(let r=0,s=n.length;r<s;++r){const a=n[r];Ar.delete(a)}const i=Es.slice();Es=[];for(let r=0,s=i.length;r<s;++r){const[a,o,c]=i[r];o<=0?a&&a(t):t-c>o?a(t):(e=!0,Es.push(i[r]))}for(let r=0,s=bs.length;r<s;++r){const a=bs[r];a&&(e=!0,a(t))}bs=Ca.slice(0),Ca=[],bs.length>0&&(e=!0),e?zt=requestAnimationFrame(Sr):zt=-1};zt=requestAnimationFrame(Sr);function _s(t){const e=new lt;return Ca.push(n=>{t&&t(n),e.resolve(n)}),zt===-1&&(zt=requestAnimationFrame(Sr)),e.promise}function Vn(t,e){const n=new lt,i=r=>{t&&t(r),n.resolve(r)};return Es.push([i,e||-1,Ia]),zt===-1&&(zt=requestAnimationFrame(Sr)),n.promise}function hl(t,e,n){const i=new lt,r=(s,a)=>{t(s),n!==void 0&&n>0?a!==void 0&&i.resolve(a):i.resolve(s)};return Ar.set(i.promise,[r,e||-1,-1,n||-1,-1]),zt===-1&&(zt=requestAnimationFrame(Sr)),i.promise}function Gd(t){Ar.delete(t),zt===-1&&(zt=requestAnimationFrame(Sr))}function Xm(){Ar.forEach(t=>t[0](Ia,Ia)),Ar.clear(),Es=[],Ca=[],bs=[]}const ji=new Set,dl=ji.add.bind(ji),fl=ji.delete.bind(ji),zd=async()=>{await hl(()=>{ji.size!==0&&(ji.forEach(t=>t.update()),ji.clear())},void 0,Number.POSITIVE_INFINITY),zd()};zd();class pl{constructor(){this._children=[],this._needsUpdate=!1,this._childUpdate=new Set}get parent(){return this._parent}set parent(e){this.setParent(e)}get children(){return this._children}get needsUpdate(){return this._needsUpdate}get childUpdate(){return this._childUpdate}addChild(e,n){e.parent!==this&&(n||e.setParent(this,!0),this._children.push(e),this._childUpdate.add(e),e.invalidate())}invalidate(){if(this._needsUpdate)return!1;this._needsUpdate=!0;for(let e=0,n=this._children.length;e<n;++e){const i=this._children[e];this._childUpdate.add(i),i.invalidate()}return!0}processParentUpdates(e){if(!this._parent||!this._parent._needsUpdate)return;const n=[];let i=this._parent;for(;i&&(n.push(i),i._parent&&i._parent.needsUpdate);)i=i._parent;for(let r=n.length-1;r>=0;--r){const s=n[r];e(s),s.resolve()}}removeChild(e,n){e._parent===this&&(e._parent!==void 0&&!n&&e.setParent(void 0,!0),this._children.splice(this._children.indexOf(e),1),this._childUpdate.delete(e))}resolve(){this._needsUpdate&&(this._needsUpdate=!1,this._parent&&this._parent._childUpdate.delete(this))}setParent(e,n){this._parent!==e&&(n||(e!==void 0&&e.addChild(this,!0),this._parent&&this._parent.removeChild(this,!0)),this._parent=e,this.invalidate())}}class La extends pl{constructor(e){super(),this.isQueuedForUpdate=!1,this.needsWorldOrientation=!1,this.needsWorldDecomposition=!1,this.hasViewMatrix=!1,this._instance=null,this._matrix={value:Ie()},this._localMatrix={value:this._matrix.value},this._rotation={value:Ts()},this._localRotation={value:this._rotation.value},this.localRotationMatrix=yn(),this._scale={value:[1,1,1]},this._localScale={value:this._scale.value},this._position={value:[0,0,0]},this._localPosition={value:this._position.value},this._forward={value:Bi()},this._localForward={value:this._forward.value},this.needsForwardUpdate=!1,e&&(e.localPosition&&(this.localPosition=e.localPosition),e.localRotation&&(this.localRotation=e.localRotation),e.localScale&&(this.localScale=e.localScale),e.parent&&(this.parent=e.parent))}set instance(e){this._instance!==e&&this._instance&&(this._instance.transform.instance=null,e&&(e.transform=this)),this._instance=e}get matrix(){return this.update(),this._matrix.value}get localMatrix(){return this.update(),this._localMatrix.value}get viewMatrix(){return this.hasViewMatrix=!0,this._viewMatrix===void 0&&this.invalidate(),this.update(),this._viewMatrix===void 0?Ie():this._viewMatrix.value}get localViewMatrix(){return this.hasViewMatrix=!0,this._localViewMatrix===void 0&&this.invalidate(),this.update(),this._localViewMatrix===void 0?Ie():this._localViewMatrix.value}get localTransform(){var e;return(e=this._localTransform)==null?void 0:e.value}set localTransform(e){e?(this._localTransform||(this._localTransform={value:Ie()}),yr(e,this._localTransform.value),this._localTransform.didUpdate=!0):delete this._localTransform,this.invalidate()}get localViewTransform(){var e;return(e=this._localViewTransform)==null?void 0:e.value}set localViewTransform(e){e?(this._localViewTransform||(this._localViewTransform={value:Ie()}),yr(e,this._localViewTransform.value),this._localViewTransform.didUpdate=!0):delete this._localViewTransform,this.invalidate()}get rotation(){return this.needsWorldOrientation=!0,this.update(),this._rotation.value}set rotation(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world rotation when a parent is present is not supported yet. Use localRotation for now."):this.localRotation=e}get localRotation(){return this._localRotation.value}set localRotation(e){Oe(this._localRotation.value,e[0],e[1],e[2],e[3]),this._localRotation.didUpdate=!0,this.invalidate(),this.needsForwardUpdate=!0}get scale(){return this.needsWorldOrientation=!0,this.update(),this._scale.value}set scale(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world scale is not supported yet. Use localScale for now."):this.localScale=e}get localScale(){return this._localScale.value}set localScale(e){Fe(this._localScale.value,e[0],e[1],e[2]),this._localScale.didUpdate=!0,this.invalidate()}get position(){return this.needsWorldOrientation=!0,this.update(),this._position.value}set position(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world position is not supported yet. Use localPosition for now."):this.localPosition=e}get localPosition(){return this._localPosition.value}set localPosition(e){this._localPosition.value[0]=e[0],this._localPosition.value[1]=e[1],this._localPosition.value[2]=e[2],this._localPosition.didUpdate=!0,this.invalidate()}get forward(){var e;return(this.needsForwardUpdate||(e=this.parent)!=null&&e.childUpdate.has(this))&&(this.needsForwardUpdate=!1,xa(Bi(),this._rotation.value,this._forward.value)),this._forward.value}get localForward(){return this.needsForwardUpdate&&(this.needsForwardUpdate=!1,xa(Bi(),this._localRotation.value,this._localForward.value)),this._localForward.value}applyLocalSRT(e,n,i){this._localScale.value=e,this._localPosition.value=i,this._localRotation.value=n,this._localScale.didUpdate=!0,this._localPosition.didUpdate=!0,this._localRotation.didUpdate=!0,this.invalidate(),this._instance&&(this._instance.transform=this)}decomposeWorldMatrix(){if(!this.needsWorldDecomposition||!this.parent||!this._matrix.didUpdate||this._matrix.value===this._localMatrix.value)return;if(this._instance){if(!this._instance.needsWorldUpdate||!this.needsWorldOrientation)return}else if(!this.needsWorldOrientation)return;this.needsWorldDecomposition=!1;const e=this._matrix.value,n=this._position.value,i=this._scale.value;this._position.didUpdate=n[0]!==e[12]||n[1]!==e[13]||n[2]!==e[14],this._position.didUpdate&&Fe(n,e[12],e[13],e[14]);const r=Bn(e[0],e[1],e[2],e[3]),s=Bn(e[4],e[5],e[6],e[7]),a=Bn(e[8],e[9],e[10],e[11]);this._scale.didUpdate=i[0]!==r||i[1]!==s||i[2]!==a,Fe(i,r,s,a),this._scale.didUpdate=!0;const[o,c,l,u]=this._rotation.value;Ma(this._matrix.value,r,s,a,this._rotation.value);const h=this._rotation.value;this._rotation.didUpdate=h[0]!==o||h[1]!==c||h[2]!==l||h[3]!==u}lookAtLocal(e,n){cl(Kt(e,this._localPosition.value,dt[0]),n||[0,1,0],this._localRotation.value),this._localRotation.didUpdate=!0,this.invalidate(),this.needsForwardUpdate=!0}divideMemory(){this._forward.value=Bi(),this._matrix.value=Ie(),this._rotation.value=Ts(),this._scale.value=[1,1,1],this._position.value=[0,0,0],this.hasViewMatrix&&this._viewMatrix&&this._localViewMatrix&&(this._viewMatrix.value=Ie())}mergeMemory(){this._forward.value=this._localForward.value,this._matrix.value=this._localMatrix.value,this._rotation.value=this._localRotation.value,this._scale.value=this._localScale.value,this._position.value=this._localPosition.value,this.hasViewMatrix&&this._viewMatrix&&this._localViewMatrix&&(this._viewMatrix.value=this._localViewMatrix.value)}setParent(e,n){e!==this.parent&&(e?this.parent||this.divideMemory():this.mergeMemory(),this.invalidate(),this.needsForwardUpdate=!0,this._localScale.didUpdate=!0,this._localRotation.didUpdate=!0,this._localPosition.didUpdate=!0,super.setParent(e,n))}invalidate(){return this.queueForUpdate(),super.invalidate()}optimize(){this.needsWorldOrientation=!1}queueForUpdate(){!this.isQueuedForUpdate&&this._instance&&this._instance.active&&(this.isQueuedForUpdate=!0,dl(this))}update(e){let n=!1;if(this.isQueuedForUpdate&&(fl(this),this.isQueuedForUpdate=!1),this.needsUpdate){const i=this.localRotationMatrix;this._localRotation.didUpdate&&Aa(this._localRotation.value,i),this._localTransform?(ya(this._localScale.value,i,this._localPosition.value,ot[0]),Mt(this._localTransform.value,ot[0],this._localMatrix.value)):ya(this._localScale.value,i,this._localPosition.value,this._localMatrix.value),this._localMatrix.didUpdate=!0,n=!0,this.hasViewMatrix&&(this._viewMatrix===void 0&&(this._viewMatrix={value:Ie()}),this._localViewMatrix===void 0&&(this.parent?this._localViewMatrix={value:Ie()}:this._localViewMatrix={value:this._viewMatrix.value}),this._localViewTransform?(ms(mr(this._localScale.value,dt[0]),ps(i,Wi[1]),St(this._localPosition.value,-1,dt[1]),ot[0]),Mt(this._localViewTransform.value,ot[0],this._localViewMatrix.value)):ms(mr(this._localScale.value,dt[0]),ps(i,Wi[1]),St(this._localPosition.value,-1,dt[1]),this._localViewMatrix.value),this._localViewMatrix.didUpdate=!0)}this.parent&&(this.parent.needsUpdate?(e||this.processParentUpdates(i=>{i.update(!0)}),n=!0):this.parent.childUpdate.has(this)&&(n=!0),n&&(Mt(this.parent._matrix.value,this._localMatrix.value,this._matrix.value),this._matrix.didUpdate=!0,this.needsWorldDecomposition=!0,this.hasViewMatrix&&this._viewMatrix&&this._localViewMatrix&&(this.parent.hasViewMatrix&&this.parent._viewMatrix&&this.parent._localViewMatrix?Mt(this.parent._viewMatrix.value,this._localViewMatrix.value,this._viewMatrix.value):(Aa(this.parent.rotation,Wi[0]),ms(mr(this.parent._scale.value,dt[0]),ps(Wi[0],Wi[1]),St(this.parent._position.value,-1,dt[1]),ot[0]),Mt(this._localViewMatrix.value,ot[0],this._viewMatrix.value)),this._viewMatrix.didUpdate=!0))),this.decomposeWorldMatrix(),this._instance&&this._instance.active&&(this._localMatrix.didUpdate||this._matrix.didUpdate)&&(this._instance.needsLocalUpdate&&(this._localRotation.didUpdate&&(this._instance._localRotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._localPosition=this._localPosition.value),this._localScale.didUpdate&&(this._instance._localScale=this._localScale.value)),this._instance.needsWorldUpdate&&(this.parent?(this._rotation.didUpdate&&(this._instance._rotation=this._rotation.value),this._scale.didUpdate&&(this._instance._scale=this._scale.value),this._position.didUpdate&&(this._instance._position=this._position.value)):(this._localRotation.didUpdate&&(this._instance._rotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._position=this._localPosition.value),this._localScale.didUpdate&&(this._instance._scale=this._localScale.value))),this._matrix.didUpdate&&(this._instance._matrix=this._matrix.value),this._localMatrix.didUpdate&&(this._instance._localMatrix=this._localMatrix.value,this.parent||(this._instance._matrix=this._matrix.value))),this._localScale.didUpdate=!1,this._localRotation.didUpdate=!1,this._localPosition.didUpdate=!1,this._rotation.didUpdate=!1,this._scale.didUpdate=!1,this._position.didUpdate=!1,this._matrix.didUpdate=!1,this._localMatrix.didUpdate=!1,this.resolve()}}const Vd=new La;var Wn=(t=>(t[t.PERSPECTIVE=0]="PERSPECTIVE",t[t.ORTHOGRAPHIC=1]="ORTHOGRAPHIC",t))(Wn||{});function Wd(t){return t.projectionOptions.type===1&&"left"in t.projectionOptions}function gl(t){return t.projectionOptions.type===0&&"fov"in t.projectionOptions}class $n{constructor(e){this._id=K(),this.animationEndTime=0,this.needsViewDrawn=!0,this.needsBroadcast=!1,this.viewChangeViewId="",this.transform=new La,this._projection=Ie(),this._needsUpdate=!0,this._viewProjection=Ie(),this._projectionOptions=e,this._needsUpdate=!0,this.onChange=e.onViewChange,this.update()}get id(){return this._id}broadcast(e){this.onChange&&this.onChange(this,e)}static makeOrthographic(e){return new $n(Object.assign({left:-100,right:100,top:-100,bottom:100,near:-100,far:1e5,type:1},e))}static makePerspective(e){return new $n(Object.assign({type:0,far:1e4,near:1,fov:90*Math.PI/180,height:1e3,width:1e3},e))}get projectionType(){return this._projectionOptions.type}get projection(){return this.update(!0),this._projection}get view(){return this.transform.viewMatrix}get needsUpdate(){return this._needsUpdate}get position(){return this.transform.position}set position(e){this._needsUpdate=this._needsUpdate||!Hr(e,this.transform.position),this.transform.position=e}lookAt(e,n){const i=yr(this.transform.matrix);this.transform.lookAtLocal(e,n||[0,1,0]),this._needsUpdate=this._needsUpdate||!Jc(i,this.transform.matrix)}get scale(){return this.transform.scale}set scale(e){this._needsUpdate=this._needsUpdate||!Hr(e,this.transform.scale),this.transform.scale=e}get projectionOptions(){return this._projectionOptions}set projectionOptions(e){this._needsUpdate=this._needsUpdate||!tl(e,this._projectionOptions),this._projectionOptions=e}get viewProjection(){return this.update(!0),this._viewProjection}setOrthographic(e){this._projectionOptions=Object.assign({left:-100,right:100,top:-100,bottom:100,near:-100,far:1e5,type:1},e)}setPerspective(e){this._projectionOptions=Object.assign({type:0,far:1e4,near:1,fov:90*Math.PI/180,height:1e3,width:1e3},e)}resolve(){this._needsUpdate=!1,this.needsViewDrawn=!1,this.needsBroadcast=!1}update(e){(this._needsUpdate||e)&&(this.updateProjection(),this._needsUpdate=!1,this.needsViewDrawn=!0)}updateProjection(){Wd(this)?Kc(this.projectionOptions.left,this.projectionOptions.right,this.projectionOptions.bottom,this.projectionOptions.top,this.projectionOptions.near,this.projectionOptions.far,this._projection):gl(this)&&qc(this.projectionOptions.fov,this.projectionOptions.width,this.projectionOptions.height,this.projectionOptions.near,this.projectionOptions.far,this._projection),Mt(this._projection,this.transform.viewMatrix,this._viewProjection)}}class Hi{get id(){return this._key}get key(){return this._key}constructor(e){this._key=e.key}}function Ym(t){return{key:"",type:xe.COLOR_BUFFER,...t}}function Oa(t){return t!==void 0&&t.key!==void 0&&t.type===xe.COLOR_BUFFER}class $d extends Hi{constructor(e,n){super(e),this.type=xe.COLOR_BUFFER,this.height=e.height,this.width=e.width,this.colorBufferSettings=e.colorBufferSettings,this.createColorBuffer(n)}destroy(){this.colorBuffer.destroy()}createColorBuffer(e){if(this.colorBuffer)return;this.colorBufferSettings={...this.colorBufferSettings};let n,i;const r=(e==null?void 0:e.getRenderSize())||[1,1];if(this.width<=Nt.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");n=r[0]/-this.width}else n=this.width;if(this.height<=Nt.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");i=r[1]/-this.width}else i=this.height;this.colorBuffer=new Hu({internalFormat:d.GLSettings.RenderTarget.ColorBufferFormat.RGBA4,size:[n,i],...this.colorBufferSettings})}}class Mr{get webGLRenderer(){return this._webGLRenderer}set webGLRenderer(e){this._webGLRenderer=e}getIOExpansion(){return[]}resize(){}setAttributeContext(e){}}class jd extends Mr{constructor(){super(...arguments),this.resources=new Map}async dequeueRequests(){return!1}destroy(){}destroyResource(e){this.resources.delete(e.key)}getResource(e){return this.resources.get(e)||{key:"",type:-1}}async initResource(e){this.resources.set(e.key,e)}request(e,n,i){return[0,0,0,0]}updateResource(e){}}const Hd=new jd;class qm extends Mr{constructor(){super(...arguments),this.resources=new Map}async dequeueRequests(){return!1}destroy(){this.resources.forEach(e=>e.destroy()),this.resources.clear()}getIOExpansion(){return[]}getResource(e){return this.resources.get(e)||null}destroyResource(e){const n=this.resources.get(e.key);n&&(n.destroy(),this.resources.delete(e.key))}async initResource(e){let n=this.resources.get(e.key);if(n){console.warn("Attempted to generate a RenderTexture that already exists for key",e.key);return}n=new $d(e,this.webGLRenderer),this.resources.set(e.key,n)}request(e,n,i,r){const s=this.resources.get(i.key);return s?(i.colorBuffer=s.colorBuffer,[0,0,1,1]):[0,0,0,0]}resize(){const e=new Map;this.resources.forEach((n,i)=>{n.width>Nt.SCREEN&&n.height>Nt.SCREEN||(n.colorBuffer.destroy(),n=new $d(n,this.webGLRenderer),e.set(i,n))}),e.forEach((n,i)=>this.resources.set(i,n))}updateResource(e){this.resources.get(e.key)&&console.warn("UPDATING AN EXISTING COLOR BUFFER IS NOT SUPPORTED YET")}}function ml(t){return{type:xe.COLOR_BUFFER,...t}}const Rs=class{static setObservableMonitor(t){Rs.gatherIds=t,Rs.observableIds=[]}static getObservableMonitorIds(t){const e=Rs.observableIds.slice(0);return t&&(Rs.observableIds=[]),e}};let ft=Rs;ft.setCycle=!1,ft.gatherIds=!1,ft.observableIds=[],ft.observableNamesToUID=new Map;const An=ft,Na=new Map;let Km=1;const Zm={}.constructor;function Jm(t,e){const n=An.observableNamesToUID.get(e)||0;if(n===0){console.warn("A property with name",e,"for",t,"has not been assigned a UID which is an error in this step of the process.");return}function i(){return An.gatherIds&&(An.setCycle||An.observableIds.push(n)),t.observableStorage[n]}function r(a){An.gatherIds&&(An.setCycle=!0),t.observableStorage[n]=a,t.changes[n]=n,t.observer&&t.observer.instanceUpdated(t),An.gatherIds&&(An.setCycle=!1)}const s=t[e];Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:i,set:r}),t[e]=s}function B(t,e,n){n||(n={configurable:!0,enumerable:!0});let i=Na.get(t.constructor),r=An.observableNamesToUID.get(e)||0;r===0&&(r=++Km,An.observableNamesToUID.set(e,r)),i||(i=new Set,Na.set(t.constructor,i)),i.add(e);let s=Object.getPrototypeOf(t),a=0;for(;s.constructor!==Zm&&++a<100;){const o=Na.get(s.constructor);o&&o.forEach(c=>i==null?void 0:i.add(c)),s=Object.getPrototypeOf(s)}a>=100&&console.warn("@observable decorator encountered a type that has 100+ levels of inheritance. This is most likely an error, and may be a result of a circular dependency and will not be supported by this decorator."),n.enumerable=!0,n.writable=!0,Object.defineProperty(t,e,n)}function _t(t,e){if(t.constructor!==e)return;const n=Na.get(e);n&&n.forEach(i=>Jm(t,i))}class ke{constructor(e){if(this._uid=K(),this.cleanObservation=new Map,this.instanceChanges=new Map,this.allowChanges=!0,this.resolveContext="",e)for(let n=0,i=e.length;n<i;++n){const r=e[n];this.add(r)}}get uid(){return this._uid}get changeList(){this.allowChanges=!1;const e=[];return this.instanceChanges.forEach(n=>e.push(n)),e}add(e){if(this.cleanObservation.get(e.uid))return e;if(this.allowChanges){e.observer=this;const n=e.observableDisposer;this.cleanObservation.set(e.uid,[e,n]),this.instanceChanges.set(e.uid,[e,Ze.INSERT,e.changes])}return e}clear(){this.cleanObservation.forEach(e=>{this.remove(e[0])})}destroy(){this.cleanObservation.forEach(e=>{e[1]()}),this.cleanObservation.clear(),this.instanceChanges.clear()}instanceUpdated(e){this.allowChanges&&this.instanceChanges.set(e.uid,[e,Ze.CHANGE,e.changes])}remove(e){if(this.allowChanges){const n=this.cleanObservation.get(e.uid);n&&(n[1](),this.cleanObservation.delete(e.uid),this.instanceChanges.set(e.uid,[n[0],Ze.REMOVE,{}]))}return!1}resolve(e){if(this.allowChanges=!0,this.instanceChanges.clear(),this.resolveContext&&this.resolveContext!==e)throw new Error("An instance provider has been issued to two layers. This is not a suppported feature yet and can cause issues.");this.resolveContext=e}sync(){const e=[];this.cleanObservation.forEach(n=>{const[i]=n;this.instanceChanges.set(i.uid,[i,Ze.INSERT,e])})}}class Qd{constructor(e){this.delay=0,this.isManualStart=!1,this.isTimeSet=!1,this.startTime=-1,Object.assign(this,e)}setAutomatic(){this.isManualStart=!1,this.isTimeSet=!1}setStart(e){e&&(this.start.length!==e.length?console.warn("A manual easing adjustment provided an incompatible value for the easing type."):(this.start=e,this.isManualStart=!0))}setTiming(e,n){this.delay=e===void 0?this.delay:e,this.duration=n===void 0?this.duration:n,this.isTimeSet=!0}}var e0=Object.defineProperty,t0=Object.getOwnPropertyDescriptor,Xd=(t,e,n,i)=>{for(var r=i>1?void 0:i?t0(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(r=(i?a(e,n,r):a(r))||r);return i&&r&&e0(e,n,r),r};let Yd=0;const vl=class{constructor(t){this._active=!1,this.changes={},this._observer=null,this.observableStorage=[],this._uid=vl.newUID,this.reactivate=!1,_t(this,vl),t&&(this.active=t.active||this.active)}static get newUID(){return Yd=++Yd%16777215}get active(){return this._active}set active(t){this._active=t,this.reactivate=!0}get observableDisposer(){return()=>this._observer=null}get observer(){return this._observer||null}set observer(t){const e=this._observer;e&&e!==t&&(this.easing&&this.easing.clear(),e.remove(this)),this._observer=t}getEasing(t){if(this.easingId){const e=this.easingId[`_${t}_end`];if(e&&this.easing){const n=this.easing.get(e);if(n instanceof Qd)return n}}}get uid(){return this._uid}resourceTrigger(){console.warn("resourceTrigger called on an instance that did not override resourceTrigger. resourceTrigger MUST be overridden for instances","that utilize a resource. The observable that is tied to committing the resource should be 'triggered' in this method.")}};let pt=vl;Xd([B],pt.prototype,"_active",2),Xd([B],pt.prototype,"_uid",2);class n0 extends pt{resourceTrigger(){}}function wl(t){return{key:"",type:xe.TEXTURE,...t}}function Qi(t){return t&&t.key!==void 0&&t.type===xe.TEXTURE}class yl extends Hi{constructor(e,n){super(e),this.type=xe.TEXTURE,this.height=e.height,this.width=e.width,this.textureSettings=e.textureSettings,this.createTexture(n)}destroy(){this.texture.destroy()}createTexture(e){var s;if(this.texture)return;this.textureSettings={generateMipMaps:!0,premultiplyAlpha:!1,...this.textureSettings};let n,i;const r=(e==null?void 0:e.getRenderSize())||[1,1];if(this.width<=Nt.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");n=r[0]/-this.width}else n=this.width;if(this.height<=Nt.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");i=r[1]/-this.width}else i=this.height;this.texture=new Se({data:((s=this.textureSettings)==null?void 0:s.data)||{width:n,height:i,buffer:null},...this.textureSettings})}}const i0=`varying highp vec4 _picking_color_pass_;
void main() {
\${out: _picking_fragment_} = _picking_color_pass_;
}`;function qd(t){return t}class gt{constructor(e,n,i,r){this.child=[null,null],this.isLeaf=!0,this.data=null,this.bounds=new ye({height:r,width:i,x:e,y:n})}destroy(){const e=this.child[0],n=this.child[1];this.data=null,e&&e.destroy(),n&&n.destroy(),this.child[0]=null,this.child[1]=null}hasChild(){const e=this.child[0],n=this.child[1];return e&&!e.data?!e.isLeaf:n&&!n.data?!n.isLeaf:!1}insert(e){let n=this.child[0],i=this.child[1];if(!this.isLeaf&&n&&i){const r=n.insert(e);return r!==null?r:i.insert(e)}else{if(this.data)return null;const r=this.bounds.fits(e.bounds);if(r===0)return null;if(r===1)return this.data=e.data,this;this.isLeaf=!1;const s=e.bounds.width,a=e.bounds.height,o=this.bounds.width-s,c=this.bounds.height-e.bounds.height;o>c?(n=this.child[0]=new gt(this.bounds.x,this.bounds.y,s,this.bounds.height),i=this.child[1]=new gt(this.bounds.x+s,this.bounds.y,o,this.bounds.height)):(n=this.child[0]=new gt(this.bounds.x,this.bounds.y,this.bounds.width,a),i=this.child[1]=new gt(this.bounds.x,this.bounds.y+a,this.bounds.width,c))}return n.insert(e)}remove(e){const n=this.child[0],i=this.child[1];if(i&&n&&!this.isLeaf){let r=n.remove(e);return r?!0:(r=i.remove(e),n.hasChild()||i.hasChild()||(this.child[0]=null,this.child[1]=null),r)}else return this.data===e?(this.data=null,!0):!1}static applyToSubTexture(e,n,i,r,s){if(!i)return;r=r||{top:0,left:0,bottom:0,right:0};const a=n instanceof gt?n.bounds:n,o=(a.x+r.left)/e.bounds.width,c=(a.y+r.top)/e.bounds.height,l=(a.width-r.left-r.right)/e.bounds.width,u=(a.height-r.top-r.bottom)/e.bounds.height;let h;s?h=new ye({bottom:1-c,left:o,right:o+l,top:1-(c+u)}):h=new ye({top:1-c,left:o,right:o+l,bottom:1-(c+u)});const f=h.bottom,p=h.y,m=h.x,v=h.x+h.width;i.atlasTL=[m,p],i.atlasBR=[v,f],i.atlasBL=[m,f],i.atlasTR=[v,p],i.widthOnAtlas=Math.abs(i.atlasTR[0]-i.atlasTL[0]),i.heightOnAtlas=Math.abs(i.atlasTR[1]-i.atlasBR[1]),i.pixelWidth=l*e.bounds.width,i.pixelHeight=u*e.bounds.height}}function Kd(t){return t&&t.call!==void 0&&t.apply!==void 0}function pi(t,e,n){let i=t.get(e);return i===void 0&&(Kd(n)?i=n():i=n,t.set(e,i)),i}function Pa(t,e,n){let i=t.get(e);return i===void 0&&(Kd(n)?i=n():i=n),i}class It{}It.transparentShapeBlending={blending:{blendDst:d.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:d.GLSettings.Material.BlendingEquations.Add,blendSrc:d.GLSettings.Material.BlendingSrcFactor.SrcAlpha},culling:d.GLSettings.Material.CullSide.NONE,modify(t){return Object.assign({},this,t)}},It.transparentImageBlending={blending:{blendSrc:d.GLSettings.Material.BlendingSrcFactor.One,blendDst:d.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:d.GLSettings.Material.BlendingEquations.Add},culling:d.GLSettings.Material.CullSide.NONE,modify(t){return Object.assign({},this,t)}};class r0{static async modify(e,n,i){for(let r=0,s=n.length;r<s;++r){const a=n[r];for(let o=0,c=e.length;o<c;++o){const l=e[o],u=l.getEasing(a);u&&i(u,l,o,r)}}}static async all(e,n,i,r){let s=ca;const a=new Promise(l=>s=l);let o=0;for(let l=0,u=i.length;l<u;++l){const h=i[l];for(let f=0,p=n.length;f<p;++f){const m=n[f],v=m.getEasing(h);v&&(r&&r(v,m,f,l),o=Math.max((v.delay||0)+v.duration,o))}}const c=l=>{l<o?Vn(c):s()};return e?Vn(l=>{o+=l,c(l)}):s(),a}}const s0=5,a0=10;function o0(t,e){const n=[];return e.forEach(i=>{t.find(r=>i instanceof r)&&n.push(i)}),n}class Zd{destroy(){this.TL.destroy(),this.TR.destroy(),this.BL.destroy(),this.BR.destroy()}constructor(e,n){const i=e.mid;this.TL=new xr(e.x,i[0],e.y,i[1],n),this.TR=new xr(i[0],e.right,e.y,i[1],n),this.BL=new xr(e.x,i[0],i[1],e.bottom,n),this.BR=new xr(i[0],e.right,i[1],e.bottom,n)}}class xr{constructor(e,n,i,r,s){this.children=[],this.depth=0,arguments.length>=4?this.bounds=new ye({left:e,right:n,top:i,bottom:r}):this.bounds=new ye({left:0,right:1,top:0,bottom:1}),this.depth=s||0}destroy(){this.children=[],this.nodes&&(this.nodes.destroy(),delete this.nodes)}add(e,n){return e.isInside(this.bounds)?this.doAdd(e):(this.cover(e),this.add(e,n))}addAll(e){let n=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;const{min:a,max:o}=Math;for(let c=0,l=e.length;c<l;++c){const u=e[c];n=a(n,u.x),r=o(u.right,r),i=a(i,u.y),s=o(s,u.bottom)}this.cover(new ye({left:n,right:r,top:i,bottom:s})),e.forEach(c=>this.doAdd(c))}cover(e){if(e.isInside(this.bounds))return;this.bounds.encapsulate(e),this.bounds.x-=1,this.bounds.y-=1,this.bounds.width+=2,this.bounds.height+=2;const n=this.gatherChildren([]);this.nodes&&(this.nodes.destroy(),delete this.nodes),n.forEach(i=>this.doAdd(i))}doAdd(e){return this.nodes?e.isInside(this.nodes.TL.bounds)?this.nodes.TL.doAdd(e):e.isInside(this.nodes.TR.bounds)?this.nodes.TR.doAdd(e):e.isInside(this.nodes.BL.bounds)?this.nodes.BL.doAdd(e):e.isInside(this.nodes.BR.bounds)?this.nodes.BR.doAdd(e):(this.children.push(e),!0):e.isInside(this.bounds)?(this.children.push(e),this.children.length>s0&&this.depth<a0&&this.split(),!0):(isNaN(e.width+e.height+e.x+e.y)?console.error("Child did not fit into bounds because a dimension is NaN",e):e.area===0&&console.error("Child did not fit into bounds because the area is zero",e),!0)}gatherChildren(e,n){n&&n(this);for(let i=0,r=this.children.length;i<r;++i)e.push(this.children[i]);return this.nodes&&(this.nodes.TL.gatherChildren(e,n),this.nodes.TR.gatherChildren(e,n),this.nodes.BL.gatherChildren(e,n),this.nodes.BR.gatherChildren(e,n)),e}query(e,n){return e instanceof ye?e.hitBounds(this.bounds)?this.queryBounds(e,[],n):[]:bo(e)&&this.bounds.containsPoint(e)?this.queryPoint(e,[],n):[]}queryBounds(e,n,i){return this.bounds.isInside(e)?(this.gatherChildren(n,i),n):(this.children.forEach(r=>{r.hitBounds(e)&&n.push(r)}),i&&i(this),this.nodes&&(e.hitBounds(this.nodes.TL.bounds)&&this.nodes.TL.queryBounds(e,n,i),e.hitBounds(this.nodes.TR.bounds)&&this.nodes.TR.queryBounds(e,n,i),e.hitBounds(this.nodes.BL.bounds)&&this.nodes.BL.queryBounds(e,n,i),e.hitBounds(this.nodes.BR.bounds)&&this.nodes.BR.queryBounds(e,n,i)),n)}queryPoint(e,n,i){return this.children.forEach(r=>{r.containsPoint(e)&&n.push(r)}),i&&i(this),this.nodes&&(this.nodes.TL.bounds.containsPoint(e)&&this.nodes.TL.queryPoint(e,n,i),this.nodes.TR.bounds.containsPoint(e)&&this.nodes.TR.queryPoint(e,n,i),this.nodes.BL.bounds.containsPoint(e)&&this.nodes.BL.queryPoint(e,n,i),this.nodes.BR.bounds.containsPoint(e)&&this.nodes.BR.queryPoint(e,n,i)),n}split(){const e=[];this.gatherChildren(e),this.nodes=new Zd(this.bounds,this.depth+1),this.children=[];for(let n=0,i=e.length;n<i;++n){const r=e[n];r&&this.doAdd(r)}}visit(e){const n=!!e(this);this.nodes&&!n&&(this.nodes.TL.visit(e),this.nodes.TR.visit(e),this.nodes.BL.visit(e),this.nodes.BR.visit(e))}}class Jd extends xr{}class As{constructor(e){this.willDispose=new Set,this.keyToItem=new Map,this.keyToInitializer=new Map,this.currentInitalizerIndex=0,this.currentInitializers=[],this._items=[],this.inlineDeferred=n=>{this.deferredInlining=n},this.inlineImmediate=n=>{if(n.length>0&&this.currentInitializers&&this.currentItem){this.currentInitializers.splice(this.currentInitalizerIndex+1,0,...n);for(let i=0,r=n.length;i<r;++i){const s=n[i];s.parent=this.currentItem}}},this.inline=this.inlineImmediate,this.options=e}get items(){return this._items.slice(0)}async destroy(){const e=[];for(let n=0,i=this.currentInitializers.length;n<i;++n){const r=this.currentInitializers[n],s=this.keyToItem.get(r.key);s&&e.push(this.options.destroyItem(r,s))}await Promise.all(e)}async diff(e){const n=e.slice(0);this.currentInitializers=n,this._items=[];let i=0;for(;i<n.length;){const r=n[i];if(this.currentInitalizerIndex=i,this.currentInitializer=r,this.willDispose.has(r.key)){let s=this.keyToItem.get(r.key)||null;s?(this.currentItem=s,await this.options.updateItem(r,s)):s=await this.options.buildItem(r),s&&(this.keyToInitializer.set(r.key,r),this.willDispose.delete(r.key),this._items.push(s))}else{this.inline=this.inlineDeferred;const s=await this.options.buildItem(r);this.inline=this.inlineImmediate,s&&(this.currentItem=s,this.deferredInlining&&(this.inline(this.deferredInlining),delete this.deferredInlining),this.keyToItem.set(r.key,s),this.keyToInitializer.set(r.key,r),this._items.push(s))}delete this.currentItem,i++}this.willDispose.forEach(async r=>{const s=this.keyToItem.get(r),a=this.keyToInitializer.get(r);if(!s||!a)return;await this.options.destroyItem(a,s)&&(this.keyToItem.delete(r),this.keyToInitializer.delete(r))}),this.willDispose.clear(),this.keyToInitializer.forEach(r=>{this.willDispose.add(r.key)}),this.currentInitializers=[],delete this.currentItem,delete this.currentInitializer}getByKey(e){return this.keyToItem.get(e)}async rebuild(){if(!this.currentItem||!this.currentInitializer)return;this.keyToItem.delete(this.currentItem.id),this.keyToInitializer.delete(this.currentItem.id),this.options.destroyItem(this.currentInitializer,this.currentItem);const e=await this.options.buildItem(this.currentInitializer);e&&(this.keyToItem.set(this.currentItem.id,e),this.keyToInitializer.set(this.currentItem.id,this.currentInitializer))}}function gi(t){const{shader:e,options:n={},required:i,onError:r,onToken:s,onMain:a}=t,o=new Map,c=new Map,l=new Map,u=new Map,h=e.replace(/\$\{([^\}]*)\}/g,(p,m)=>{let v="";return u.set(m,(u.get(m)||0)+1),m in n?(o.set(m,(o.get(m)||0)+1),v=n[m]):c.set(m,(c.get(m)||0)+1),s&&(v=s(m,v)),v});Object.keys(n).forEach(p=>{o.get(p)||l.set(p,(l.get(p)||0)+1)});const f={resolvedShaderOptions:o,shader:h,shaderProvidedOptions:u,unresolvedProvidedOptions:l,unresolvedShaderOptions:c};if(i&&i.values.forEach(p=>{if(f.unresolvedProvidedOptions.get(p)){const m=`${i.name}: Could not resolve all the required inputs. Input: ${p}`;r?r(m):console.error(m)}else if(f.unresolvedShaderOptions.get(p)){const m=`${i.name}: A required option was not provided in the options parameter. Option: ${p}`;r?r(m):console.error(m)}else if(!f.resolvedShaderOptions.get(p)){const m=`${i.name}: A required option was not provided in the options parameter. Option: ${p}`;r?r(m):console.error(m)}}),a){const p=f.shader,m=p.match(/void((.+)|\s)(main(\s+)\(\)|main\(\))(((.+)(\s*)\{)|(\s*)\{)/gm);if(m&&m.length>0){const v=p.indexOf(m[0]);if(v<0)a(null);else{const T=p.substr(0,v),b=p.substr(v+m[0].length);let E=!1,S=!1,I=1,M=0,N=-1;for(let x=0,P=b.length;x<P;++x){const te=b[x],W=b[x+1];switch(te){case"/":switch(W){case"*":!E&&!S&&(E=!0,x++);break;case"/":!E&&!S&&(S=!0,x++);break}break;case"*":W==="/"&&(S||(E=!1,x++));break;case`
`:case"\r":E||(S=!1);break;case"{":!E&&!S&&I++;break;case"}":!E&&!S&&M++,I===M&&(N=x);break}if(N!==-1)break}if(N!==-1){const x=b.substr(0,N),P=b.substr(N+1),te=a(x,`${T}
${P}`);typeof te=="string"?f.shader=p.substr(0,v+m[0].length)+te+p.substr(v+m[0].length+N):f.shader=p.substr(0,v)+te.header+p.substr(v,m[0].length)+te.main+p.substr(v+m[0].length+N)}else a(null)}}}return f}function c0(t){return new Promise(e=>setTimeout(e,t))}function l0(t){let e=0,n=[];return Object.assign(async r=>{if(r!==void 0&&r!==t&&(n.forEach(u=>u.resolve(!1)),t=r),!t)return!1;const s=++e,a=new lt;let o=t.getBoundingClientRect(),c;if(n.push(a),o.width===0||o.height===0){let u=!0;const h={attributes:!0};c=new MutationObserver(f=>{if(u){for(const p of f)if(p.type==="attributes"){if(!t)return;o=t.getBoundingClientRect(),o.width!==0&&o.height!==0&&(c&&(c.disconnect(),c=void 0),u=!1,a.resolve(s===e))}}}),c.observe(t,h),await _s(),o=t.getBoundingClientRect(),u&&o.width!==0&&o.height!==0&&(c.disconnect(),u=!1,a.resolve(s===e))}else await _s(),a.resolve(s===e);const l=await a.promise;return c&&(c.disconnect(),c=void 0),l&&(n.forEach(u=>u.resolve(!1)),n=[]),l},{cancel:()=>{n.forEach(r=>r.resolve(!1)),n=[]}})}function Xi(t,e){const n=Object.assign(e,{key:e.key||t.defaultProps.key,data:e.data||t.defaultProps.data});return{get key(){return e.key||""},init:[t,n]}}function Yi(t,e){const n=Object.assign(e,{key:e.key||t.defaultProps.key,data:e.data||t.defaultProps.data});return{get key(){return e.key||""},init:[t,n]}}function ef(t){return t}function tf(t){return t}const u0={layer:Xi,view:Ll,vertex:tf,uniform:ef,attribute:qd};class h0{constructor(e){this.index=-1,this.marker=new Map,this.pool=new Array(e.firstAlloc);for(let n=0,i=e.firstAlloc;n<i;++n)this.pool[n]=e.create();this.options=e}destroy(){for(let e=0,n=this.pool.length;e<n;++e)this.options.destroy(this.pool[e]);this.pool=[],this.marker.clear()}retrieve(){const e=this.pool[this.index+1];return this.index++,this.marker.set(e,this.index),e}replace(e){const n=this.marker.get(e);n!==void 0&&(this.pool[n]=this.pool[this.index],this.pool[this.index]=e,this.marker.delete(e),this.index--)}}function mi(t){return t?[t.atlasTL[0],t.atlasTL[1],t.atlasBR[0],t.atlasBR[1]]:[0,0,0,0]}class jn{constructor(e){this._uid=K(),this.aspectRatio=1,this.atlasTL=[0,0],this.atlasTR=[0,0],this.atlasBL=[0,0],this.atlasBR=[0,0],this.heightOnAtlas=0,this.isValid=!1,this.pixelWidth=0,this.pixelHeight=0,this.texture=null,this.widthOnAtlas=0,Object.assign(this,e)}get uid(){return this._uid}static fromRegion(e,n){if(!e.data)return null;const i=n.x/e.data.width,r=n.y/e.data.height,s=n.width/e.data.width,a=n.height/e.data.height,o=new ye({bottom:r+a,left:i,right:i+s,top:r}),c=o.bottom,l=o.y,u=o.x,h=o.x+o.width,f=new jn;return f.atlasTL=[u,l],f.atlasBR=[h,c],f.atlasBL=[u,c],f.atlasTR=[h,l],f}update(){!this.texture||!this.source||!this.atlasRegion||this.texture.update(this.source,this.atlasRegion)}toString(){return JSON.stringify({atlas:{TL:this.atlasTL,TR:this.atlasTR,BL:this.atlasBL,BR:this.atlasBR},width:this.pixelWidth,height:this.pixelHeight},null,2)}}const d0=Ke("performance");function nf(t){return{key:"",type:xe.ATLAS,...t}}function Tl(t){return t&&t.type===xe.ATLAS}class rf extends Hi{constructor(e){super(e),this.resourceReferences=new Map,this.type=xe.ATLAS;const n=document.createElement("canvas");if(this.width=n.width=e.width,this.height=n.height=e.height,this.textureSettings=e.textureSettings,e.width<0||e.height<0)throw new Error("TextureSize Error: An atlas does NOT support Screen Texture sizing.");this.packing=new gt(0,0,e.width,e.height),this.createTexture(n)}createTexture(e){if(this.texture)return;let n;this.textureSettings?n={generateMipMaps:!0,premultiplyAlpha:!0,...this.textureSettings}:n={generateMipMaps:!0,premultiplyAlpha:!0},this.texture=new Se({data:e,...n})}destroy(){var e;(e=this.texture)==null||e.destroy(),this.resourceReferences.forEach(n=>{this.invalidateTexture(n.subtexture)})}invalidateTexture(e){const n=[0,0];e.aspectRatio=1,e.atlasBL=n,e.atlasBR=n,e.atlasTL=n,e.atlasTR=n,e.isValid=!1,e.texture=null,e.pixelHeight=0,e.pixelWidth=0,delete e.source,e.video&&(e.video.monitor.destroy(),delete e.video)}resolveResources(){const e=[];this.resourceReferences.forEach((n,i)=>{n.count<=0&&n.subtexture&&(d0("A subtexture on an atlas has been invalidated as it is deemed no longer used: %o",n.subtexture),this.invalidateTexture(n.subtexture),e.push(i))});for(let n=0,i=e.length;n<i;++n)this.resourceReferences.delete(e[n])}stopUsingResource(e){const n=this.resourceReferences.get(e.source)||{subtexture:e.texture||new jn,count:0};n.count--}useResource(e){const n=this.resourceReferences.get(e.source)||{subtexture:e.texture,count:0};n.count++}}let it;class qi{static async awaitContext(){for(;!it;)this.getContext(),await new Promise(e=>setTimeout(e,10))}static getContext(){it||(it=document.createElement("canvas").getContext("2d"))}static async calculateImageSize(e){if(await this.awaitContext(),!it){console.warn("The Image rasterizer was unable to establish a valid canvas context. Please ensure the system supports contexts and ensure the document is ready first.");return}if(e.width===0||e.height===0){console.warn("Images provided shoud have valid dimensions! Please ensure the image is loaded first.");return}return it.canvas.width=100,it.canvas.height=100,it.drawImage(e,0,0,1,1),[e.width,e.height]}static async resizeImage(e,n){if(await this.awaitContext(),!it)return console.warn("The Image rasterizer was unable to establish a valid canvas context. Please ensure the system supports contexts and ensure the document is ready first."),e;if(e.width===0||e.height===0)return console.warn("Images provided shoud have valid dimensions! Please ensure the image is loaded first."),e;it.canvas.width=Math.floor(e.width*n),it.canvas.height=Math.floor(e.height*n),e instanceof ImageData?it.putImageData(e,0,0,0,0,it.canvas.width,it.canvas.height):it.drawImage(e,0,0,it.canvas.width,it.canvas.height);const i=new Image;return i.src=it.canvas.toDataURL("image/png"),await qi.calculateImageSize(i),i}}class f0{constructor(e,n){this.video=e,this.subTexture=n,this.isDestroyed=!1,this.renderedTime=-1,this.previousTime=-1,this.playedFrames=0,this.caughtFrames=0,this.timeFrame=0,this.doUpdate=()=>{Math.abs(this.video.currentTime-this.renderedTime)<.015||(this.renderedTime=this.video.currentTime,this.subTexture.update())},this.loop=i=>{this.doUpdate(),this.isDestroyed||Vn(this.loop)},this.addEventListeners()}async addEventListeners(){this.isDestroyed||this.loop(await Vn())}destroy(){this.video.pause(),this.isDestroyed=!0,this.removeEventListeners()}removeEventListeners(){}}const sf=Ke("performance"),p0=new jn({aspectRatio:0,atlasBL:[0,0],atlasBR:[0,0],texture:null,atlasTL:[0,0],atlasTR:[0,0],heightOnAtlas:0,isValid:!1,pixelHeight:0,pixelWidth:0,widthOnAtlas:0});function g0(t){return!!(t&&t.isValid&&t.pixelWidth&&t.pixelHeight)}class af{constructor(){this.allAtlas=new Map}async createAtlas(e){const n=new rf(e);return this.allAtlas.set(n.id,n),sf("Atlas Created-> %o",n),n}destroy(){this.allAtlas.forEach(e=>e.destroy())}destroyAtlas(e){const n=this.allAtlas.get(e);n&&n.destroy()}setDefaultImage(e,n){return e=Object.assign(e,p0,{atlasReferenceID:n}),e}async draw(e,n){var o;const i=e.id;if(n.disposeResource)return!0;const r=e.resourceReferences.get(n.source);if(r)return n.texture=r.subtexture,!0;n.texture=new jn,n.texture.isValid=!0,e.resourceReferences.set(n.source,{subtexture:n.texture,count:0});const s=await this.loadImage(n),a=n.texture;if(s&&g0(a)){const c=new ye({bottom:a.pixelHeight,left:0,right:a.pixelWidth,top:0}),l={data:a,bounds:c};l.bounds.width+=0,l.bounds.height+=0;let u=e.packing,h=u.insert(l);if(!h){if(!this.repackResources(e))return console.error("Repacking the atlas failed. Some resources may be in an undefined state. Consider making another atlas."),!1;u=e.packing,h=u.insert(l)}return h?(h.data=a,gt.applyToSubTexture(u,h,a,{top:.5,left:.5,right:.5,bottom:.5}),a.texture=e.texture||null,a.source=s,a.atlasRegion={...h.bounds,y:e.height-h.bounds.y-h.bounds.height},(o=e.texture)==null||o.update(s,a.atlasRegion),s instanceof HTMLVideoElement&&(a.video={monitor:new f0(s,a)}),!0):(console.error("Could not fit resource into atlas",n),n.texture=this.setDefaultImage(a,i),!1)}else return a&&!a.isValid?sf("Resource was invalidated during load:",n):console.error("Could not load resource:",n),n.texture&&(n.texture=this.setDefaultImage(n.texture,i)),!1}getAtlasTexture(e){return this.allAtlas.get(e)}async loadImage(e){const n=e.texture||new jn,i=e.source;if(e.texture=n,e.texture.isValid===!1)return null;if(i instanceof HTMLImageElement){let r=await new Promise(s=>{if(!(i instanceof HTMLImageElement))return;const a=i;if(a.width&&a.height){qi.calculateImageSize(a),n.pixelWidth=a.width,n.pixelHeight=a.height,n.aspectRatio=a.width/a.height,s(a);return}a?(a.onload=function(){n.pixelWidth=a.width,n.pixelHeight=a.height,n.aspectRatio=a.width/a.height,a.onload=null,s(a)},a.onerror=function(){console.error("Error generating Image element for source:",i),a.onload=null,s(null)}):s(null)});return r&&e.rasterizationScale!==void 0&&e.rasterizationScale!==1&&(r=await qi.resizeImage(r,e.rasterizationScale||1)),r}else{if(i instanceof HTMLVideoElement)return i.videoHeight===0||i.videoWidth===0?(console.warn("Video requests to the atlas manager MUST have the video completely loaded and ready for loading","There are too many caveats to automate video loading at this low of a level to have it prepped properly for","use in the texture for all browsers. Consider handling video resources at the layer level to have them","prepped for use."),null):(n.pixelWidth=i.videoWidth,n.pixelHeight=i.videoHeight,n.aspectRatio=i.videoWidth/i.videoHeight,i);if(Gn(i)){const r=i;let s=await new Promise(a=>{const o=new Image;o.onload=function(){n.pixelWidth=o.width,n.pixelHeight=o.height,n.aspectRatio=o.width/o.height,o.onload=null,a(o)},o.onerror=function(){console.error("Error generating Image element for source:",i),a(null)},o.src=r});return s&&e.rasterizationScale!==void 0&&e.rasterizationScale!==1&&(s=await qi.resizeImage(s,e.rasterizationScale||1)),s}else{let r=i;return r&&e.rasterizationScale!==void 0&&e.rasterizationScale!==1&&(r=await qi.resizeImage(r,e.rasterizationScale||1)),r}}}repackResources(e){if(!this.renderer)return console.warn("Attempted to repack resources for an atlas, but no renderer has been specified for this manager yet."),!1;const n=[e.packing],i=[];let r=0;const s=new Map;for(;r<n.length;){const S=n[r];r++,S.data&&S.data.texture&&(i.push(S),s.set(S.bounds,new ye(S.bounds))),S.child[0]&&n.push(S.child[0]),S.child[1]&&n.push(S.child[1])}if(i.sort((S,I)=>Math.max(I.bounds.width,I.bounds.height)-Math.max(S.bounds.width,S.bounds.height)),i.length<=0)return e.packing=new gt(0,0,e.width,e.height),!0;if(!e.texture)return console.warn("Attempted to repack resources for an atlas with no texture."),!1;const a=new Se(e.texture);a.data={buffer:new Uint8Array(e.width*e.height*4),width:e.width,height:e.height};const o=new gt(0,0,e.width,e.height);let c=!1;for(let S=0,I=i.length;S<I;++S){const M=i[S];if(!M.data){console.warn("Attempted to repack a node with no valid data.");continue}M.bounds.x=0,M.bounds.y=0;const N=o.insert({bounds:M.bounds,data:M.data});if(!N){console.warn("When repacking the atlas, an existing node was unable to be repacked",M),c=!0;continue}gt.applyToSubTexture(o,N,M.data)}if(c)return!1;const l=new Float32Array(i.length*2*6),u=new Float32Array(i.length*2*6),h=new jn;for(let S=0,I=i.length;S<I;++S){const M=i[S],N=s.get(M.bounds),x=M.data;if(!N||!x){console.warn("While repacking there was an issue finding the previous bounds and the next texture to use",N,x);continue}gt.applyToSubTexture(o,N,h);const P=S*2*6;l[P]=x.atlasTL[0]*2-1,l[P+1]=x.atlasTL[1]*2-1,l[P+2]=x.atlasTR[0]*2-1,l[P+3]=x.atlasTR[1]*2-1,l[P+4]=x.atlasBL[0]*2-1,l[P+5]=x.atlasBL[1]*2-1,l[P+6]=x.atlasTR[0]*2-1,l[P+7]=x.atlasTR[1]*2-1,l[P+8]=x.atlasBR[0]*2-1,l[P+9]=x.atlasBR[1]*2-1,l[P+10]=x.atlasBL[0]*2-1,l[P+11]=x.atlasBL[1]*2-1,u[P]=h.atlasTL[0],u[P+1]=h.atlasTL[1],u[P+2]=h.atlasTR[0],u[P+3]=h.atlasTR[1],u[P+4]=h.atlasBL[0],u[P+5]=h.atlasBL[1],u[P+6]=h.atlasTR[0],u[P+7]=h.atlasTR[1],u[P+8]=h.atlasBR[0],u[P+9]=h.atlasBR[1],u[P+10]=h.atlasBL[0],u[P+11]=h.atlasBL[1],x.texture=a}const f=new si,p=new Un(l,2),m=new Un(u,2);f.addAttribute("position",p),f.addAttribute("texCoord",m);const v=new oi({buffers:{color:{buffer:a,outputType:0}},retainTextureTargets:!0}),T=new is({culling:d.GLSettings.Material.CullSide.NONE,uniforms:{texture:{type:je.TEXTURE,value:e.texture}},fragmentShader:new Map([[v,{outputNames:[],outputTypes:[0],source:`
          precision highp float;

          uniform sampler2D texture;
          varying vec2 _texCoord;

          void main() {
            gl_FragColor = texture2D(texture, _texCoord);
          }
        `}]]),vertexShader:`
        precision highp float;

        attribute vec2 position;
        attribute vec2 texCoord;
        varying vec2 _texCoord;

        void main() {
          _texCoord = texCoord;
          gl_Position = vec4(position, 0.0, 1.0);
        }
      `}),b=new Pc("__atlas_manager__",f,T);b.vertexCount=i.length*6,b.drawMode=d.GLSettings.Model.DrawMode.TRIANGLES;const E=new ha;return E.add(b),this.renderer.setRenderTarget(v),this.renderer.setViewport(this.renderer.getFullViewport()),this.renderer.setScissor(this.renderer.getFullViewport()),this.renderer.render(E,v),T.dispose(),f.destroy(),v.dispose(),e.texture.destroy(),e.texture=a,e.packing=o,!0}async updateAtlas(e,n){const i=this.allAtlas.get(e);if(i){for(const r of n)r.disposeResource||await this.draw(i,r);for(let r=0,s=n.length;r<s;++r){const a=n[r];a.disposeResource?i.stopUsingResource(a):i.useResource(a)}i.resolveResources()}else console.warn("Can not update non-existing atlas:",e,"These resources will not be loaded:",n);return i}}const m0=Ke("performance");class of{setDeclaration(e,n,i,r){e.has(n)&&m0(`%s: Overriding declaration %s
Setting new value: %s`,r||"Expand IO Declarations",n,i),e.set(n,i)}}class Ss extends of{expand(e,n,i,r){return{instanceAttributes:[],uniforms:[],vertexAttributes:[]}}validate(e,n,i,r){return!0}processHeaderInjection(e,n,i,r,s,a,o){return{injection:""}}processAttributeDestructuring(e,n,i,r,s,a){return""}}const v0="TextureIOExpansion";function w0(t,e,n){return t&&t.resource&&e.getResourceType(t.resource.key())===n&&t.resource.name!==void 0&&t.resource.key!==void 0}class Da extends Ss{constructor(e,n){super(),this.manager=n,this.resourceType=e}expand(e,n,i,r){const s=this.manager,a=[],o=new Map;n.forEach(u=>{if(w0(u,this.manager.router,this.resourceType)){u.size===void 0&&(u.size=k.FOUR);const h=u.resource.shaderInjection||G.FRAGMENT,f=o.get(u.resource.name);f?o.set(u.resource.name,[f[0]||h===G.VERTEX||h===G.ALL,f[1]||h===G.FRAGMENT||h===G.ALL]):(a.push(u),o.set(u.resource.name,[h===G.VERTEX||h===G.ALL,h===G.FRAGMENT||h===G.ALL]))}});const c=a.map(u=>{let h=G.FRAGMENT;if(u.resource){const f=o.get(u.resource.name);f&&(h=f[0]&&f[1]&&G.ALL||f[0]&&!f[1]&&G.VERTEX||!f[0]&&f[1]&&G.FRAGMENT||h)}return[{name:u.resource.name,shaderInjection:h,size:O.TEXTURE,update:()=>{const f=s.getResource(u.resource.key());return f&&f.texture||Se.emptyTexture}},{name:`${u.resource.name}_size`,shaderInjection:h,size:O.TWO,update:()=>{const f=s.getResource(u.resource.key());if(f){const p=f.texture;if(p&&p.data){const{width:m,height:v}=p.data;return[m||1,v||1]}}return[1,1]}}]}),l=[];return c.forEach(u=>u.forEach(h=>l.push(h))),{instanceAttributes:[],vertexAttributes:[],uniforms:l}}validate(e,n,i,r){let s=!1;return n.forEach(a=>{a.easing&&a.resource&&(console.warn("An instance attribute can not have both easing and resource properties. Undefined behavior will occur."),console.warn(a),s=!0)}),!s}processHeaderInjection(e,n,i,r,s,a,o){const c={injection:""};for(let l=0,u=o.length;l<u;++l){const h=o[l],f=h.shaderInjection||G.VERTEX;h.size===O.TEXTURE&&f===e&&this.setDeclaration(n,h.name,`uniform sampler2D ${h.name};
`,v0)}return c}}class cf extends Mr{constructor(e){super(),this.resources=new Map,this.requestQueue=new Map,this.requestLookup=new Map,this.atlasManager=e&&e.atlasManager||new af}get webGLRenderer(){return this._webGLRenderer}set webGLRenderer(e){this._webGLRenderer=e,this.atlasManager.renderer=e}async dequeueRequests(){let e=!1;const n=[];this.requestQueue.forEach((i,r)=>{n.push([r,i])}),this.requestQueue.clear();for(const[i,r]of n)if(r.length>0){e=!0;const s=r.slice(0);r.length=0,await this.atlasManager.updateAtlas(i,s);const a=this.requestLookup.get(i);if(a){const o=new Set;s.forEach(c=>{const l=a.get(c);if(a.delete(c),l&&!c.disposeResource)for(let u=0,h=l.length;u<h;++u){const[f,p]=l[u];f.managesInstance(p)&&(p.active=!0),o.add(p)}}),_s(()=>{o.forEach(c=>{c.active=!0,c.resourceTrigger()})})}}return e}destroy(){this.atlasManager.destroy()}destroyResource(e){this.resources.get(e.key)&&(this.atlasManager.destroyAtlas(e.key),this.resources.delete(e.key))}getAtlasTexture(e){const n=this.atlasManager.getAtlasTexture(e);return n&&n.texture||null}getResource(e){return this.resources.get(e)||null}getIOExpansion(){return[new Da(xe.ATLAS,this)]}async initResource(e){if(Tl(e)){const n=await this.atlasManager.createAtlas(e);this.resources.set(e.key,n)}}request(e,n,i,r){const s=i.key||"",a=i.texture;if(a)return mi(a);let o=this.requestLookup.get(s);if(o){const l=o.get(i);if(l)return l.push([e,n]),n.active=!1,mi(i.texture)}else o=new Map,this.requestLookup.set(s,o);i.disposeResource||(n.active=!1);let c=this.requestQueue.get(s);return c||(c=[],this.requestQueue.set(s,c)),c.push(i),o.set(i,[[e,n]]),mi(a)}updateResource(e){Tl(e)}}const y0=new Image;function Ir(t){return{type:xe.ATLAS,source:y0,...t}}class lf extends Mr{constructor(){super(...arguments),this.resources=new Map}async dequeueRequests(){return!1}destroy(){this.resources.forEach(e=>e.destroy()),this.resources.clear()}getIOExpansion(){return[new Da(xe.TEXTURE,this)]}getResource(e){return this.resources.get(e)||null}destroyResource(e){const n=this.resources.get(e.key);n&&(n.destroy(),this.resources.delete(e.key))}async initResource(e){let n=this.resources.get(e.key);if(n){console.warn("Attempted to generate a RenderTexture that already exists for key",e.key);return}n=new yl(e,this.webGLRenderer),this.resources.set(e.key,n)}request(e,n,i,r){const s=this.resources.get(i.key);return s?(i.texture=s.texture,[0,0,1,1]):[0,0,0,0]}resize(){const e=new Map;this.resources.forEach((n,i)=>{n.width>Nt.SCREEN&&n.height>Nt.SCREEN||(n.texture.destroy(),n=new yl(n,this.webGLRenderer),e.set(i,n))}),e.forEach((n,i)=>this.resources.set(i,n))}updateResource(e){this.resources.get(e.key)&&console.warn("UPDATING AN EXISTING RENDER TEXTURE IS NOT SUPPORTED YET")}}function Fa(t){return{type:xe.TEXTURE,...t}}const{ceil:T0,max:uf,log2:E0,pow:b0,sqrt:_0}=Math,Ct=[-1,-1];function R0(t,e){const{width:n,height:i}=t;let r;const s=[],a=[];for(let o=0;o<n;++o){s[o]=[],a[o]=[];for(let c=0;c<i;++c){const l=c*(n*4)+o*4;r=e[l+3],r?(s[o][c]=[o,c],a[o][c]=Ct):(s[o][c]=Ct,a[o][c]=[o,c])}}return{seed:s,inverse:a}}function A0(t){const e=[];for(let n=0,i=t.length;n<i;++n)e[n]=[];return e}function hf(t,e,n=!1){const i=n?-1:1;let r,s,a,o;const c=[];let l=-1;for(let u=0,h=t.length;u<h;++u){const f=t[u];c[u]=[];for(let p=0,m=f.length;p<m;++p)r=f[p],r===e?o=256:(s=[u,p],a=$e(r,s),o=_0(gr(a,a))),c[u][p]=o,l=uf(o,l)}for(let u=0,h=t.length;u<h;++u){const f=t[u];for(let p=0,m=f.length;p<m;++p)o=c[u][p],c[u][p]=o/l*255*i}return c}function S0(t,e,n,i){let r;const s=hf(t,n,!0),a=hf(e,n,!1),o=s.length,c=s;for(let l=0,u=s.length;l<u;++l){const h=s[l],f=a[l];for(let p=0,m=h.length;p<m;++p){const v=h[p],T=f[p];h[p]=v+T}}for(let l=0,u=c.length;l<u;++l){const h=c[l];for(let f=0,p=h.length;f<p;++f){r=h[f];const m=f*(o*4)+l*4;i[m]=r,i[m+1]=r,i[m+2]=r,i[m+3]=255}}}function df(t,e){const n=t.length,i=t[0].length;let r=A0(t),s=t,a,o,c,l,u,h,f,p,m;for(let v=0;v<e;++v){const T=r;r=s,s=T;const b=b0(2,e-v-1);for(f=0;f<n;++f)for(p=0;p<i;++p){for(a=[f,p],c=[(r[f-b]||[])[p-b]||Ct,(r[f]||[])[p-b]||Ct,(r[f+b]||[])[p-b]||Ct,(r[f-b]||[])[p]||Ct,(r[f]||[])[p]||Ct,(r[f+b]||[])[p]||Ct,(r[f-b]||[])[p+b]||Ct,(r[f]||[])[p+b]||Ct,(r[f+b]||[])[p+b]||Ct],u=0,l=Number.MAX_VALUE,m=0;m<9;++m){const E=c[m];E!==Ct&&(o=$e(E,a),h=gr(o,o),h<l&&(l=h,u=m))}s[f][p]=c[u]}}return s}function M0(t,e=S0){const{width:n,height:i}=t,r=t.getContext("2d");if(!r)return;const s=r.getImageData(0,0,n,i).data,a=uf(n,i),o=T0(E0(a)),c=R0(t,s),l=df(c.seed,o),u=df(c.inverse,o),h=new ImageData(n,i);e(l,u,Ct,h.data),r.putImageData(h,0,0)}function x0(t){}const Ba=Ke("performance");var Ua=(t=>(t[t.BITMAP=0]="BITMAP",t[t.SDF=1]="SDF",t[t.MSDF=2]="MSDF",t))(Ua||{});class ff extends Hi{constructor(e){super(e),this.dynamic=!1,this.glyphCount=0,this.glyphMap={},this.kerning={},this.spaceWidth=0,this.type=xe.FONT,this.dynamic=e.dynamic||!1,this.fontSource=e.fontSource,e.characters&&e.characters.forEach(i=>{this.doRegisterGlyph(i[0],i[1])});const n=e.fontMapSize?e.fontMapSize:[Nt._1024,Nt._1024];this.makeGlyphTypeTextureSettings(e.glyphType),this.createTexture(n),this.packing=new gt(0,0,n[0],n[1]),this.addCachedKerning()}get fontString(){return`${this.fontSource.size}px ${this.fontSource.family}`}getKerningCacheName(){return`__deltav_kerning_cache_${this.fontSource.family}__`}addCachedKerning(){if(this.fontSource.localKerningCache){const e=localStorage.getItem(this.getKerningCacheName());if(e){Ba("Loading cached kerning items:",this.getKerningCacheName());try{const n=JSON.parse(e);let i=0;for(const r in n){let s=typeof r=="string"&&r.length===1;if(!s)continue;const a=n[r],o=this.kerning[r]||{};this.kerning[r]=o;for(const c in a)s=typeof r=="string"&&r.length===1,s&&(o[c]=a[c],i++)}Ba("Found kerning items in the cache!","Count:",i)}catch{}}}}addKerning(e){let n=!1;for(const i in e){const r=e[i],s=this.kerning[i]||{};this.kerning[i]||(n=!0),this.kerning[i]=s;for(const a in r)s[a]||(n=!0),s[a]=r[a]}if(n&&this.fontSource.localKerningCache)try{Ba("Storing kerning info in cache...");const i=JSON.stringify(this.kerning);localStorage.setItem(this.getKerningCacheName(),i)}catch{Ba("Could not cache kerning info")}}createTexture(e){if(this.texture)return;let n;this.textureSettings?n={generateMipMaps:!0,premultiplyAlpha:!0,...this.textureSettings}:n={generateMipMaps:!0,premultiplyAlpha:!0},this.texture=new Se({data:{width:e[0],height:e[1],buffer:null},...n})}destroy(){var e;(e=this.texture)==null||e.destroy()}doRegisterGlyph(e,n){const i=e[0];this.glyphMap[i]?console.warn("A Glyph is already registered with a rendering"):this.glyphMap[i]=n}findMissingCharacters(e){const n=new Set;let i="";for(let r=0,s=e.length;r<s;++r){const a=e[r];!this.glyphMap[a]&&!n.has(a)&&(n.add(a),i+=a)}return i}getGlyphTexture(e){return this.glyphMap[e[0]]||null}getGlyphKerning(e,n){const i=this.kerning[e];return i?i[n]||[0,0]:[0,0]}getGlyphWidth(e,n,i){const r=e.positions[n],s=e.positions[i];if(!n||!i)return 0;const a=this.glyphMap[e.glyphs[i]];return a?s[0]+a.pixelWidth-r[0]:0}async getTruncatedLayout(e,n,i,r,s,a){if(e.size[0]>i){let o="",c=0;for(let m=0,v=n.length;m<v;++m)c+=this.glyphMap[n[m]].pixelWidth;if(c>i)return{fontScale:1,glyphs:"",positions:[],size:[0,0],text:""};let l=0,u=e.positions.length,h=0,f=0,p="";for(;l!==u;){if(h=Math.floor((u-l)/2)+l,p=e.glyphs[h],f=e.positions[h][0]+this.glyphMap[p].pixelWidth+c,f>i)u=h;else if(f<i)l=h;else break;if(Math.abs(l-u)<=1){if(f<i)break;for(;f>i&&h>=0;)h--,f=e.positions[h][0]+this.glyphMap[p].pixelWidth+c;break}}if(f=e.positions[h][0]+this.glyphMap[p].pixelWidth+c,f<i){let m=0,v=0;for(let E=0,S=e.text.length;E<S&&m<=h;++E){const I=e.text[E];v++,Gi(I)||m++}const T=e.text[v-1];let b;for(let E=0,S=n.length;E<S;++E)if(!Gi(n[E])){b=n[E];break}if(T&&b&&!this.kerning[T][b]){const E=await a.estimateKerning([T+b],this.fontString,this.fontSource.size,this.kerning,!1);this.addKerning(E.pairs)}o=`${e.text.substr(0,v)}${n}`}else o=n;return this.getStringLayout(o,r,s)}return e}getStringWidth(e,n,i){const r=e.text;let s=0,a=r.length;if(typeof n=="string"){const h=r.indexOf(n);if(h<0)return 0;s=h,a=s+n.length}else s=n;i!==void 0&&(a=i);let o=0;const c=Math.min(r.length,s),l=Math.min(r.length,a);for(;o<c;++o)Gi(r[o])&&(s--,a--);for(;o<l;++o)Gi(r[o])&&a--;const u=this.glyphMap[e.text[a]||""];return u?(e.positions[a]||[0,0])[0]-(e.positions[s]||[0,0])[0]+u.pixelWidth:0}getStringLayout(e,n,i){const r=[];let s="";const a=n/this.fontSource.size;let o=Number.MAX_SAFE_INTEGER,c=0,l=0,u=[0,0];const h=this.spaceWidth;let f=0,p="",m,v;for(let E=0,S=e.length;E<S;++E){const I=e[E];if(Gi(I)){f++;continue}m=[0,0],p&&(m=this.kerning[p][I]||[0,0]),u=Fn(Fn(u,He(m,a)),[f*h*a+(E===0?0:i),0]),r.push([u[0],u[1]]),s+=I,v=this.glyphMap[I],o=Math.min(u[1],o),c=Math.max(u[1]+v.pixelHeight*a,c),p=I,l=u[0]+v.pixelWidth*a,f=0}const T=c-o,b=[l,T];for(let E=0,S=r.length;E<S;++E)u=r[E],u[1]-=o;return{fontScale:a,glyphs:s,positions:r,size:b,text:e}}makeGlyphTypeTextureSettings(e){switch(e){case 0:this.textureSettings={magFilter:d.GLSettings.Texture.TextureMagFilter.Linear,minFilter:d.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear,internalFormat:d.GLSettings.Texture.TexelDataType.LuminanceAlpha,format:d.GLSettings.Texture.TexelDataType.LuminanceAlpha};break;case 1:this.textureSettings={magFilter:d.GLSettings.Texture.TextureMagFilter.Linear,minFilter:d.GLSettings.Texture.TextureMinFilter.Linear,internalFormat:d.GLSettings.Texture.TexelDataType.Luminance,format:d.GLSettings.Texture.TexelDataType.Luminance};break;case 2:this.textureSettings={magFilter:d.GLSettings.Texture.TextureMagFilter.Linear,minFilter:d.GLSettings.Texture.TextureMinFilter.Linear,internalFormat:d.GLSettings.Texture.TexelDataType.RGB,format:d.GLSettings.Texture.TexelDataType.RGB};break}}registerGlyph(e,n){this.dynamic?this.doRegisterGlyph(e,n):console.warn("Attempted to register a new glyph with a non-dynamic FontMap")}supportsKerning(e){for(let n=1,i=e.length;n<i;++n){const r=e[n],s=e[n-1];if(this.kerning[s]){if(!this.kerning[s][r])return!1}else return!1}return!0}}const{min:pf,max:ka}=Math,Ki=document.createElement("canvas");let Hn;function I0(t){const{width:e,height:n}=t.canvas,i=t.getImageData(0,0,e,n).data;let r,s=!1,a=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER;for(let u=0;u<e;++u)for(let h=0;h<n;++h){const f=h*(e*4)+u*4;r=i[f],r>0&&(s=!0,a=pf(a,h),o=pf(o,u),c=ka(c,u),l=ka(l,h))}return s?(a-=1,l+=2,c+=2,o-=1,a=ka(a,0),o=ka(o,0),{minX:o,minY:a,maxX:c,maxY:l}):null}function El(t,e,n,i){if(t=t[0],(Ki.width<e||Ki.height<n)&&(Ki.width=e,Ki.height=n),!Hn){const c=Ki.getContext("2d");if(c)Hn=c;else return null}Hn.clearRect(0,0,Ki.width,Ki.height),Hn.font=i,Hn.fillStyle="white",Hn.fillText(t,e/2,n/2);const r=I0(Hn);if(!r)return{data:Hn.getImageData(0,0,1,1),size:[0,0]};const s=r.maxX-r.minX,a=r.maxY-r.minY;return{data:Hn.getImageData(r.minX,r.minY,s,a),size:[s,a]}}const Vt=document.createElement("img"),Lt=document.createElement("canvas");async function gf(t){const e=new lt;if(!Vt||!Lt)return null;const n=new XMLSerializer().serializeToString(t),s="data:image/svg+xml;base64,"+btoa(n);let a=!1;const o=()=>{if(a)return;a=!0,Lt.width=Vt.width*window.devicePixelRatio,Lt.height=Vt.height*window.devicePixelRatio;const l=Lt.getContext("2d");if(!l){e.resolve(null);return}l.clearRect(0,0,Lt.width,Lt.height),l.mozImageSmoothingEnabled=!1,l.webkitImageSmoothingEnabled=!1,l.msImageSmoothingEnabled=!1,l.imageSmoothingEnabled=!1,l.drawImage(Vt,0,0,Vt.width*window.devicePixelRatio,Vt.height*window.devicePixelRatio),e.resolve(l.getImageData(0,0,Lt.width,Lt.height)),Vt.src="",Lt.width=0,Lt.height=0,Lt.style.position="absolute",Lt.style.top="0px",Lt.style.zIndex="9999"};return Vt.onload=o,Vt.src=s,Vt.width>0&&Vt.height>0&&o(),await e.promise}const Ga=Ke("performance"),{floor:bl}=Math;async function C0(t,e,n,i){const r="http://www.w3.org/2000/svg",s=U.MAX_TEXTURE_SIZE/window.devicePixelRatio,a=e*2,o=e*1.3,c=bl(s/a),l=document.createElementNS(r,"svg");l.setAttribute("width",`${s}px`),l.style.font=t,l.style.position="relative",l.style.left="0px",l.style.top="0px";const u=[],h=Math.floor(s/o);let f=0,p=0,m=0,v,T,b=0;for(;p<n.all.length;){const W=document.createElementNS(r,"g");v=W,f=Math.floor(u.length/h),W.setAttribute("transform",`translate(0, ${(u.length-f*h)*o})`),u.push(W);let V=s;for(m=0;m<c&&p<n.all.length;m++){const ae=document.createElementNS(r,"text");ae.setAttribute("x",`${m*a}`),ae.setAttribute("dy","1em");const Z=n.all[p];p++;const ne=Z[0],re=Z[1],ee=document.createElementNS(r,"tspan"),D=document.createElementNS(r,"tspan");ee.setAttribute("fill","#ff0000"),D.setAttribute("fill","#0000ff"),ee.textContent=ne,D.textContent=re,ae.appendChild(ee),ae.appendChild(D),W.appendChild(ae),V-=a}if(V>=0){const ae=document.createElementNS(r,"text");ae.setAttribute("width",`${V}px`),W.appendChild(ae),T=ae}else T=null;b=V}const E=[];for(let W=0;W<n.all.length;W++)E.push([Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER]);let S=0,I=!1;if(i){const W="M",V=document.createElementNS(r,"text");V.setAttribute("dy","1em"),V.style.width=`${a}`,V.style.height=`${o}`,V.setAttribute("x",`${a*m}`),V.style.font=t;const ae=await El(W,128,128,t);if(ae){S=ae.size[0];const Z=document.createElementNS(r,"tspan"),ne=document.createElementNS(r,"tspan"),re=document.createElementNS(r,"tspan");if(Z.setAttribute("fill","#ff0000"),re.setAttribute("fill","#0000ff"),Z.textContent=W,re.textContent=W,ne.textContent=" ",V.appendChild(Z),V.appendChild(ne),V.appendChild(re),m<c&&v)v.appendChild(V),b-=a,T&&(T.remove(),b>0&&(v.style.width=`${b}px`,v.appendChild(T)));else{const ee=document.createElement("g");f=Math.floor(u.length/h),ee.setAttribute("transform",`translate(0, ${(u.length-f*h)*o})`),v=ee,v.appendChild(V),u.push(ee),T=document.createElementNS(r,"text"),ee.appendChild(T)}E.push([Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER]),I=!0}}const M=u.length*o,N=Math.ceil(M/s);let x=null;Ga("Rendering table canvas batches for font kerning analysis",n,u);for(let W=0;W<N;++W){const V=u.splice(0,h),ae=V.length*o;for(l.setAttribute("height",`${ae}px`);l.lastElementChild;)l.lastElementChild.remove();for(let Z=0,ne=V.length;Z<ne;++Z){const re=V[Z];l.appendChild(re)}if(!x)x=await gf(l);else{const Z=await gf(l);if(!Z){console.warn("Font Renderer: Could not generate image data for analyzing font kerning");continue}const ne=new Uint8ClampedArray(x.data.length+Z.data.length);ne.set(x.data),ne.set(Z.data,x.data.length),x=new ImageData(ne,s*window.devicePixelRatio,x.height+Z.height)}}Ga("Analyzing rendered data",x);const P=a*window.devicePixelRatio,te=o*window.devicePixelRatio;if(x){const W=x.data;let V,ae,Z,ne,re,ee;for(let D=0,Ee=x.height;D<Ee;D++)for(let ve=0,_=x.width;ve<_;ve++)V=(_*D+ve)*4,ae=W[V+0],Z=W[V+1],ne=W[V+2],ee=bl(D/te)*c+bl(ve/P),ee<E.length&&(re=E[ee],ae>0&&Z===0&&ne===0&&(ve<re[0]&&(re[0]=ve),D<re[1]&&(re[1]=D)),ae===0&&Z===0&&ne>0&&(ve<re[2]&&(re[2]=ve),D<re[3]&&(re[3]=D)));if(I){const D=E.pop();if(D){const Ee=[D[2]-D[0],0],ve=He(Ee,1/window.devicePixelRatio);n.spaceWidth=Math.ceil(ve[0])-S}}for(let D=0,Ee=E.length;D<Ee;D++){const ve=n.all[D],_=ve[0],L=ve[1],q=E[D],ue=[q[2]-q[0],q[3]-q[1]],ie=n.pairs[_];if(ie){const fe=He(ue,1/window.devicePixelRatio);ie[L]=[Math.ceil(fe[0]),fe[1]]}}}else console.warn("html2canvas did not produce a valid canvas context to analyze");Ga("Kerning rendering analysis complete",n.pairs)}function L0(t,e,n){t=t.replace(/\s/g,"");const i=n&&n.all||[],r=n&&n.pairs||{};for(let s=0;s<t.length-1;s++){const a=t[s],o=t[s+1];let c=r[a];c||(c=r[a]={}),(!e[a]||!e[a][o])&&!c[o]&&(c[o]=[0,0],i.push(`${a}${o}`))}return{all:i,pairs:r,spaceWidth:0}}class mf{makeBitmapGlyphs(e,n,i){const r={},s=new Set;for(let o=0,c=e.length;o<c;++o)s.add(e[o]);const a=Array.from(s.values());for(let o=0,c=a.length;o<c;++o){const l=a[o],u=El(l,i*2,i*2,n);u?r[l]={glyph:u.data,glyphIndex:o}:console.warn("Unable to render character",l,"to font map for rendering.")}return r}async estimateKerning(e,n,i,r,s){const a={all:[],pairs:{},spaceWidth:0};Ga("Estimating Kerning for",e);for(let o=0,c=e.length;o<c;++o){const l=e[o];L0(l,r,a)}return(a.all.length>0||s)&&await C0(n,i,a,s),a}}var Zi=(t=>(t[t.TEXCOORDS=0]="TEXCOORDS",t[t.IMAGE_SIZE=1]="IMAGE_SIZE",t))(Zi||{});function Ji(t){return{type:xe.FONT,...t}}function O0(){return".101112131415161718191.202122232425262728292.303132333435363738393.404142434445464748494.505152535455565758595.606162636465666768696.707172737475767778797.808182838485868788898.909192939495969798999.000102030405060708090.$0$1$2$3$4$5$6$7$8$9$%0%1%2%3%4%5%6%7%8%9%-0-1-2-3-4-5-6-7-8-9-+0+1+2+3+4+5+6+7+8+9+)0)1)2)3)4)5)6)7)8)9)(0(1(2(3(4(5(6(7(8(9("}const vf=Ke("performance");var wf=(t=>(t[t._16=16]="_16",t[t._32=32]="_32",t[t._64=64]="_64",t[t._128=128]="_128",t))(wf||{});function _l(t){return t&&t.type===xe.FONT}function N0(t){return t&&t.type===void 0}function Rl(t){return{key:"",type:xe.FONT,...t}}class yf{constructor(){this.fontMaps=new Map,this.fontRenderer=new mf}async calculateMetrics(e,n){vf("Calculating metrics for requests");const i=this.fontMaps.get(e);if(i)for(let r=0,s=n.length;r<s;++r){const o=n[r].metrics;o&&(o.layout=i.getStringLayout(o.text,o.fontSize,o.letterSpacing),o.maxWidth&&(vf("Calculating truncation for",o.text,o.maxWidth),o.layout=await i.getTruncatedLayout(o.layout,o.truncation||"",o.maxWidth,o.fontSize,o.letterSpacing,this.fontRenderer),o.truncatedText=o.layout.text))}}characterFilterToCharacters(e){const n=new Set;let i="";for(let r=0,s=e.length;r<s;++r){const a=e[r];n.has(a)||(n.add(a),i+=a)}return i}async createFontMap(e){const n=this.characterFilterToCharacters(e.characterFilter||""),i=e.fontSource;let r=Ua.SDF;i&&(N0(i)?r=Ua.BITMAP:r=i.type||r);const s=new ff({...e,glyphType:r});return await this.updateFontMapCharacters(n,s),this.fontMaps.set(e.key,s),e.fontSource.preload&&this.updateFontMap(e.key,[Ji({key:e.key,character:"",kerningPairs:[e.fontSource.preload],metrics:{fontSize:12,text:e.fontSource.preload,letterSpacing:0}})]),s}destroy(){this.fontMaps.forEach(e=>e.destroy())}destroyFontMap(e){const n=this.fontMaps.get(e);n&&n.destroy()}async updateFontMap(e,n){const i=this.fontMaps.get(e);if(!i)return;let r=[];const s=new Set;for(let o=0,c=n.length;o<c;++o){const l=n[o];if(l.character&&s.add(l.character),l.kerningPairs&&(r=r.concat(l.kerningPairs)),l.metrics&&l.metrics.truncation){const u=l.metrics.truncation.replace(/\s/g,"");r.push(u);for(let h=0,f=l.metrics.truncation.length;h<f;++h)s.add(u)}}for(let o=0,c=r.length;o<c;++o)s.add(r[o]);let a="";s.forEach(o=>a+=o),await this.updateFontMapCharacters(a,i),await this.updateKerningPairs(r,i);for(let o=0,c=n.length;o<c;++o)n[o].fontMap=i}async updateKerningPairs(e,n){if(!n)return;const i=await this.fontRenderer.estimateKerning(e,n.fontString,n.fontSource.size,n.kerning,!n.spaceWidth);n.addKerning(i.pairs),n.spaceWidth=n.spaceWidth||i.spaceWidth}async updateFontMapCharacters(e,n){if(!n)return;const i=n.texture,r=n.findMissingCharacters(e);if(r.length<=0)return;const s=this.fontRenderer.makeBitmapGlyphs(r,n.fontString,n.fontSource.size);for(const a in s){const o=s[a];if(i!=null&&i.data){const c=new ye({x:0,y:0,width:o.glyph.width,height:o.glyph.height}),l=new jn,u=n.packing.insert({data:l,bounds:c});if(!u){console.warn("Font map is full and could not pack in any more glyphs");return}gt.applyToSubTexture(n.packing,u,l,void 0,!0),i.update(o.glyph,{...u.bounds,y:n.packing.bounds.height-u.bounds.y-u.bounds.height}),l?n.registerGlyph(a,l):console.warn("Could not generate a subtexture for the font map registration.")}else console.warn("Can not update font map as the maps texture data is not defined.")}}async getPrerenderedImageData(e,n,i){const r=[];return i.forEach(s=>{let a=e.glyphs[s];if(a||(a=e.errorGlyph),!e.errorGlyph)return console.warn("The prerendered source provided did NOT provide a proper glyph for rendering when a glyph could not be located."),[];const o=new Image;let c;const l=new Promise(u=>c=u);return o.onload=function(){const u=document.createElement("canvas"),h=u.getContext("2d");if(!h)return;u.width=n,u.height=n,h.drawImage(o,0,0,n,n);const f=h.getImageData(0,0,n,n);c(f)},o.onerror=function(){console.warn("There was an issue with loading the glyph data for character:",s),c(null)},o.src=e.glyphs[s],r.push(l),[]}),await Promise.all(r)}}const Ms=Ke("performance");class Tf extends Mr{constructor(){super(...arguments),this.requestLookup=new Map,this.requestQueue=new Map,this.resourceLookup=new Map,this.fontManager=new yf}async dequeueRequests(){let e=!1;const n=[];this.requestQueue.forEach((i,r)=>{n.push([r,i])}),this.requestQueue.clear();for(let i=0,r=n.length;i<r;++i){const[s,a]=n[i];if(a.length>0){e=!0;const o=a.slice(0);a.length=0,Ms("Processing requests for resource '%s'",s),await this.fontManager.updateFontMap(s,o),await this.fontManager.calculateMetrics(s,o);const c=this.requestLookup.get(s);c?(o.forEach(l=>{const u=c.get(l);if(c.delete(l),u){for(let h=0,f=u.length;h<f;++h){const[p,m]=u[h];p.managesInstance(m)&&(m.active=!0)}_s(()=>{const h=new Set;for(let f=0,p=u.length;f<p;++f){const m=u[f][1];h.has(m)||(h.add(m),m.resourceTrigger())}})}}),Ms("All requests for resource '%s' are processed",s)):Ms("There were no Font requests waiting for completion for resource",s)}}return e}destroy(){this.fontManager.destroy()}destroyResource(e){const n=this.resourceLookup.get(e.key);n&&(this.fontManager.destroyFontMap(n.id),this.resourceLookup.delete(e.key))}getResource(e){return this.resourceLookup.get(e)||null}getIOExpansion(){return[new Da(xe.FONT,this)]}async initResource(e){if(_l(e)){const n=await this.fontManager.createFontMap(e);n&&this.resourceLookup.set(e.key,n),Ms("Font map created->",n)}}request(e,n,i,r){const s=i,a=s.fontMap;let o=null;if(a)return s.character&&(o=a.getGlyphTexture(s.character)),o?s.fetch===Zi.IMAGE_SIZE?[o.pixelWidth,o.pixelHeight]:mi(o):s.fetch===Zi.IMAGE_SIZE?[0,0]:mi(null);const c=i.key;let l=this.requestLookup.get(c);if(l){const h=l.get(s);if(h)return h.push([e,n]),n.active=!1,s.fetch===Zi.IMAGE_SIZE?[0,0]:mi(o)}else l=new Map,this.requestLookup.set(c,l);n.active=!1;let u=this.requestQueue.get(c);return u||(u=[],this.requestQueue.set(c,u)),u.push(s),l.set(s,[[e,n]]),s.fetch?[0,0]:mi(o)}updateResource(e){if(!_l(e))return;const n=this.resourceLookup.get(e.key);n&&(tl(e.fontSource,n.fontSource)||Ms("Font resources currently do not update. To update their properties simply destroy and recreate for now."))}}const P0=Ke("performance");class Al{constructor(){this.managers=new Map,this.resourceKeyToType=new Map}async dequeueRequests(){let e=!1;const n=Array.from(this.managers.values());for(let i=0,r=n.length;i<r;++i){const a=await n[i].dequeueRequests();e=e||a}return e}destroy(){this.managers.forEach(e=>e.destroy()),this.resourceKeyToType.clear(),this.managers.clear(),delete this.webGLRenderer}async destroyResource(e){const n=this.managers.get(e.type);if(!n){console.warn(`A Resource is trying to be destroyed but has no manager to facilitate the operation: ${e.type}`);return}return this.resourceKeyToType.delete(e.key),await n.destroyResource(e)}getIOExpansion(){let e=[];return this.managers.forEach(n=>{e=e.concat(n.getIOExpansion())}),e}getManager(e){const n=this.managers.get(e);return n||(console.warn(`A manager was requested that does not exist for type ${e}`),Hd)}getResourceType(e){return this.resourceKeyToType.get(e)}async initResource(e){const n=this.managers.get(e.type);if(!n){console.warn(`A Resource is trying to be created but has no manager to facilitate the operation: ${e.type}`);return}if(this.resourceKeyToType.has(e.key)){console.warn("Detected two resources with identical keys. The duplicate resource will not be generated:",e.key);return}return this.resourceKeyToType.set(e.key,e.type),await n.initResource(e)}request(e,n,i,r){const s=this.managers.get(i.type);return s?s.request(e,n,i,r):(console.warn(`A Layer is requesting a resource for which there is no manager set. Please make sure a Resource Manager is set for resource of type: ${i.type}`),[-1,-1,-1,-1])}resize(){this.managers.forEach(e=>e.resize())}setManager(e,n){this.managers.get(e)&&P0(`A manager was assigned to a resource type: ${e} that overrides another manager already set to that type.`),n.router=this,this.managers.set(e,n),n.webGLRenderer=this.webGLRenderer}setWebGLRenderer(e){this.webGLRenderer=e,this.managers.forEach(n=>n.webGLRenderer=e)}async updateResource(e){const n=this.managers.get(e.type);if(!n){console.warn(`A Resource is trying to be updated but has no manager to facilitate the operation: ${e.type}`);return}return await n.updateResource(e)}}const Ef=new Al,D0={createFont:Rl,createAtlas:nf,createTexture:wl,createColorBuffer:Ym},F0={textureRequest:Fa,atlasRequest:Ir,fontRequest:Ji,colorBufferRequest:ml};function bf(t){const e=t.canvas.height,n=t.canvas.width,r={aspectRatio:n/e,bottom:-e/2,far:1e7,left:-n/2,near:-100,right:n/2,top:e/2,viewSize:e},s=new $n({type:Wn.ORTHOGRAPHIC,left:r.left,right:r.right,top:r.top,bottom:r.bottom,near:r.near,far:r.far});return s.scale=[1,-1,1],s.position=[0,0,-300],s.update(),{camera:s,viewport:{bottom:0,left:0,right:0,top:0}}}const B0={[O.ONE]:je.FLOAT,[O.TWO]:je.VEC2,[O.THREE]:je.VEC3,[O.FOUR]:je.VEC4,[O.MATRIX3]:je.MATRIX3x3,[O.MATRIX4]:je.MATRIX4x4,[O.FLOAT_ARRAY]:je.FLOAT_ARRAY,[O.TEXTURE]:je.TEXTURE},U0={[O.ONE]:[0],[O.TWO]:[0,0],[O.THREE]:[0,0,0],[O.FOUR]:[0,0,0,0],[O.MATRIX3]:[0,0,0,0,0,0,0,0,0],[O.MATRIX4]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};function k0(t){return{type:B0[t.size],value:U0[t.size]}}function _f(t,e,n,i,r){const s=t.getMaterialOptions(),a=new Map;n.forEach((c,l)=>{a.set(l.renderTarget||null,c)}),Object.assign(s,t.props.materialOptions||{}),s.vertexShader=e,s.fragmentShader=a,s.name=t.id,s.uniforms={};for(let c=0,l=i.length;c<l;++c){const u=i[c],h=k0(u);s.uniforms[u.name]=h}for(let c=0,l=r.length;c<l;++c){const u=r[c];s.uniforms[u.name]={type:u.type,value:u.value}}return new is(s)}function G0(t){return!Array.isArray(t[0])}function Rf(t,e,n,i){const r=[];(t.bufferType===Qe.INSTANCE_ATTRIBUTE||t.bufferType===Qe.INSTANCE_ATTRIBUTE_PACKING)&&(e=1);for(let h=0,f=n.length;h<f;++h){const p=n[h];r.push(new Float32Array(p.size*i*e))}const s=n.length;let a,o,c,l=!1;for(let h=0,f=i;h<f;++h)for(let p=0;p<s;++p)if(o=n[p],a=r[p],c=o.update(h),G0(c))for(let m=h*o.size,v=m+o.size,T=0;m<v;++m,++T)a[m]=c[T];else l=!0;l&&console.warn("A vertex buffer updating method should not use arrays of arrays of numbers.");for(let h=0,f=n.length;h<f;++h){const m=n[h].size*i;for(let v=1,T=e;v<T;++v)r[h].copyWithin(m*v,0,m)}if(t.bufferType===Qe.UNIFORM){const h=r[0];for(let f=0,p=e;f<p;++f){const m=f*i;for(let v=0;v<i;++v)h[v+m]=f}}const u=new si;for(let h=0,f=n.length;h<f;++h){const p=n[h],m=new Un(r[h],p.size);p.materialAttribute=m,u.addAttribute(p.name,m)}return u}function za(t,e,n,i){const r=new Pc(t,e,n);return r.drawMode=i||d.GLSettings.Model.DrawMode.TRIANGLE_STRIP,r}const vi="EasingIOExpansion",{abs:z0,max:V0}=Math,W0={duration:0,start:[0],end:[0],startTime:0},Af={1:"float",2:"vec2",3:"vec3",4:"vec4",9:"mat3",16:"mat4",99:"vec4"},Sl={easingMethod:"easingMethod",T:"T"};function $0(t){return!!t&&t.easing&&t.size!==void 0&&t.size<=4}function j0(t){return t}class Sf extends Ss{constructor(){super(...arguments),this.baseAttributeName=new Map}expand(e,n,i,r){const s=new Set,a=[],o=[];for(const l of n)$0(l)&&a.push(l);const c={};e.easingId=c;for(let l=0,u=a.length;l<u;++l){const h=a[l],{cpu:f,loop:p,uid:m}=h.easing,{name:v,size:T,update:b}=h,E=m;this.baseAttributeName.set(h,h.name),h.name=`_${h.name}_end`,c[h.name]=E,s.has(E)&&console.error("Undefined behavior occurs if you reuse an IAutoEasingMethod. Please ensure you are using uid() from the util to give the IAutoEasingMethod its uid, or just use the default provided methods"),s.add(E);const S={values:W0};let I,M,N,x,P,te,W,V,ae,Z,ne,re,ee;h.update=_=>{if(ae=e.surface.frameMetrics,M=h.easing.delay,N=h.easing.duration,W=b(_),V=ae.currentTime,_.easing=re=_.easing||new Map,Z=re.get(E),!ne||!Z?(ne=X(W),Z=new Qd({duration:N,end:ne.copy(W),start:ne.copy(W),startTime:V}),re.set(E,Z)):_.reactivate&&(ne.copy(W,Z.end),ne.copy(W,Z.end),Z.startTime=V),P=Z,x=N,I=M,P.isTimeSet&&(x=P.duration||N,I=P.delay||0),!P.isManualStart){switch(te=1,p){case Tn.CONTINUOUS:te=(V-P.startTime)/x,ee=!0;break;case Tn.REPEAT:te=(V-P.startTime)/x%1,ee=!0;break;case Tn.REFLECT:{const L=(V-P.startTime)/x;te=z0(L/2%1-.5)*2,ee=!0;break}case Tn.NONE:default:te=(V-P.startTime)/x,ee=!1;break}P.start=f(P.start,P.end,te,P.start)}return P.startTime=V+I,ne.copy(W,P.end),S.values=P,e.animationEndTime=V0(e.animationEndTime,P.startTime+x+ae.frameDuration),e.isAnimationContinuous=ee,W},h.childAttributes=h.childAttributes||[];const D={name:`_${v}_start`,parentAttribute:h,size:T,update:_=>S.values.start};h.childAttributes.push(D),o.push(D);const Ee={name:`_${v}_start_time`,parentAttribute:h,size:k.ONE,update:_=>[S.values.startTime]};h.childAttributes.push(Ee),o.push(Ee);const ve={name:`_${v}_duration`,parentAttribute:h,size:k.ONE,update:_=>[S.values.duration]};h.childAttributes.push(ve),o.push(ve)}return{instanceAttributes:o,vertexAttributes:[],uniforms:[]}}validate(e,n,i,r){let s=!1;return n.forEach(a=>{a.easing&&a.resource&&(console.warn("An instance attribute can not have both easing and resource properties. Undefined behavior will occur."),console.warn(a),s=!0),a.easing&&a.size===void 0&&console.warn("An Instance Attribute with easing MUST have a size declared")}),!s}processAttributeDestructuring(e,n,i,r,s,a){const o="";for(let c=0,l=s.length;c<l;++c){const u=s[c];if(!u.easing||!u.size)continue;const h=this.baseAttributeName.get(u);if(!h){console.warn("Could not determine a base name for an easing attribute.");continue}this.baseAttributeName.delete(u);const f=`_${h}_time`,p=`_${h}_duration`,m=`_${h}_start_time`;switch(u.easing.loop){case Tn.CONTINUOUS:{this.setDeclaration(n,f,`  float ${f} = (currentTime - ${m}) / ${p};
`,vi);break}case Tn.REPEAT:{this.setDeclaration(n,f,`  float ${f} = clamp(fract((currentTime - ${m}) / ${p}), 0.0, 1.0);
`,vi);break}case Tn.REFLECT:{const v=`_${h}_timePassed`,T=`_${h}_pingPong`;this.setDeclaration(n,v,`  float ${v} = (currentTime - ${m}) / ${p};
`,vi),this.setDeclaration(n,T,`  float ${T} = abs((fract(${v} / 2.0)) - 0.5) * 2.0;
`,vi),this.setDeclaration(n,f,`  float ${f} = clamp(${T}, 0.0, 1.0);
`,vi);break}case Tn.NONE:default:{this.setDeclaration(n,f,`  float ${f} = clamp((currentTime - ${m}) / ${p}, 0.0, 1.0);
`,vi);break}}this.setDeclaration(n,h,`  ${Af[u.size]} ${h} = ${u.easing.methodName}(_${h}_start, _${h}_end, _${h}_time);
`,vi)}return o}processHeaderInjection(e,n,i,r,s,a,o){const c={injection:""};if(e!==G.VERTEX)return c;const l=new Map;if(c.injection=`// Auto Easing Methods specified by the layer
`,a.forEach(h=>{if(h.easing&&h.size){let f=l.get(h.easing.methodName);f||(f=new Map,l.set(h.easing.methodName,f)),f.set(h.size,h.easing.gpu)}}),l.size===0)return c.injection="",c;const u={name:"Easing Method Generation",values:[Sl.easingMethod]};return l.forEach((h,f)=>{h.forEach((p,m)=>{const v=Af[m],T={[Sl.easingMethod]:`${v} ${f}(${v} start, ${v} end, float t)`,[Sl.T]:`${v}`},b=gi({options:T,required:u,shader:p});this.setDeclaration(n,`${v} ${f}`,`${b.shader}
`,vi)})}),c}}const er="BasicIOExpansion",H0=["x","y","z","w"],tr={[O.ONE]:"float",[O.TWO]:"vec2",[O.THREE]:"vec3",[O.FOUR]:"vec4",[O.MATRIX3]:"mat3",[O.MATRIX4]:"mat4",[O.FLOAT_ARRAY]:"float",[O.VEC4_ARRAY]:"vec4",[O.TEXTURE]:"vec4"};function Mf(t){return t&&t.length}function Q0(t){const e=t.size;if(e===O.FLOAT_ARRAY||e===O.VEC4_ARRAY){const n=t.update(t);if(Mf(n))return`#define ${t.name}_length ${n.length}
`}return""}function X0(t){const e=t.size;if(e===O.FLOAT_ARRAY||e===O.VEC4_ARRAY){const n=t.update(t);if(Mf(n))return`[${t.name}_length]`}return""}function Y0(t,e){return H0.slice(t,t+e).join("")}class xf extends Ss{processAttributeDestructuring(e,n,i,r,s,a){let o="";const c=s.slice(0);switch(e.bufferType){case Qe.INSTANCE_ATTRIBUTE:o=this.processDestructuringInstanceAttribute(n,c);break;case Qe.INSTANCE_ATTRIBUTE_PACKING:o=this.processDestructuringInstanceAttributePacking(n,c);break}return e.picking.type===oe.SINGLE&&(o+=`
// This portion is where the shader assigns the picking color that gets passed to the fragment shader
_picking_color_pass_ = _pickingColor;
`),o}processDestructuringInstanceAttribute(e,n){return""}processDestructuringInstanceAttributePacking(e,n){let i="";return i+=this.processDestructureBlocks(e,n),i}processDestructureBlocks(e,n){const i="";return n.forEach(r=>{const s=r.block||0;r.size===k.MAT4X4?this.setDeclaration(e,r.name,`  ${tr[r.size]} ${r.name} = mat4(block${s}, block${s+1}, block${s+2}, block${s+3});
`,er):r.size===k.FOUR?this.setDeclaration(e,r.name,`  ${tr[r.size]} ${r.name} = block${s};
`,er):this.setDeclaration(e,r.name,`  ${tr[r.size||1]} ${r.name} = block${s}.${Y0(r.blockIndex||0,r.size||1)};
`,er)}),i}processHeaderInjection(e,n,i,r,s,a,o){let c={injection:""};e===G.VERTEX&&(c=this.processAttributeHeader(n,i,r,s,a));const l=this.processUniformHeader(n,o,e);return{...c,injection:c.injection+l}}processAttributeHeader(e,n,i,r,s){let o=`// Shader input
`;return o+=this.processVertexAttributes(e,r),n.bufferType===Qe.INSTANCE_ATTRIBUTE&&s.length>0&&(o+=this.processInstanceAttributeBufferStrategy(e,s)),n.bufferType===Qe.INSTANCE_ATTRIBUTE_PACKING&&s.length>0&&(o+=this.processInstanceAttributePackingBufferStrategy(e,i.instanceMaxBlock)),{injection:o,material:void 0}}processUniformHeader(e,n,i){const r="",s=i||G.VERTEX;return n.forEach(a=>{a.shaderInjection=a.shaderInjection||G.VERTEX,(a.shaderInjection===s||a.shaderInjection===G.ALL)&&this.setDeclaration(e,a.name,`${Q0(a)}uniform ${a.qualifier||""}${a.qualifier?" ":""}${tr[a.size]} ${a.name}${X0(a)};
`,er)}),r}processInstanceAttributeBufferStrategy(e,n){let i="attribute";return U.SHADERS_3_0&&(i="in"),n.forEach(r=>{this.setDeclaration(e,r.name,`${i} ${tr[r.size||1]} ${r.qualifier||""}${r.qualifier&&" "||""} ${r.name};
`,er)}),""}processInstanceAttributePackingBufferStrategy(e,n){let i="attribute";U.SHADERS_3_0&&(i="in");for(let r=0,s=n+1;r<s;++r)this.setDeclaration(e,`block${r}`,`${i} ${tr[k.FOUR]} block${r};
`,er);return""}processVertexAttributes(e,n){let i="attribute";return U.SHADERS_3_0&&(i="in"),n.forEach(r=>{this.setDeclaration(e,r.name,`${i} ${tr[r.size]} ${r.qualifier||""}${r.qualifier&&" "||""}${r.name};
`,er)}),""}}const q0=`if (_active < 0.5) {
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
return;
}`,K0="instanceData",Z0="_active",J0="ActiveIOExpansion";class If extends Ss{processAttributeDestructuring(e,n,i,r,s,a){const o="";return s.find(c=>c.name===Z0)&&this.setDeclaration(n,"__active_attribute_handler__",q0,J0),o}}function ev(t){return t&&t.buffer&&t.buffer.value}function Cf(t){return t&&t.propertyToBufferLocation}class Va{constructor(e,n){this.add=()=>{},this.remove=i=>i,this.layer=e,this.scene=n}changesProcessed(){delete this.changeListContext}incomingChangeList(e){this.changeListContext=e}makeLayerMaterial(){const e=this.layer.shaderIOInfo;return _f(this.layer,e.vs,e.fs,e.uniforms,e.materialUniforms)}}let Cr={};function wi(t,e){const n=Cr[t]||[e,-1,0];Cr[t]=n,n[2]++,clearTimeout(n[1]),n[1]=window.setTimeout(()=>{e(n[2],t),delete Cr[t]},1)}function Lf(){for(const t in Cr){const e=Cr[t];clearTimeout(e[1]),e[0](e[2],t)}Cr={}}const Lr=Ke("performance"),{max:tv}=Math;function nv(t){return!!(t&&t.buffer&&t.buffer.value)}function Of(t){return Cf(t)}class Nf extends Va{constructor(e,n){super(e,n),this.allBufferLocations={},this.availableLocations=[],this.currentInstancedCount=0,this.instanceToBufferLocation={},this.maxInstancedCount=0,this.attributeToPropertyIds=new Map,this.updateAllPropertyIdList=[],this.activePropertyId=-1,this.currentAvailableLocation=-1,this.remove=i=>{const r=this.instanceToBufferLocation[i.uid];return r&&(delete this.instanceToBufferLocation[i.uid],this.availableLocations.push(r)),i},this.add=this.doAddWithRegistration}changesProcessed(){super.changesProcessed(),this.availableLocations.splice(0,this.currentAvailableLocation+1),this.currentAvailableLocation=-1}doAddWithRegistration(e){ft.setObservableMonitor(!0),this.layer.shaderIOInfo.instanceAttributes.forEach(i=>{if(i.parentAttribute)return;i.update(e);const r=ft.getObservableMonitorIds(!0);this.attributeToPropertyIds.set(i,[r[r.length-1]]),r.length>1&&Lr("Property has multiple observables. Only the last trigger will be retained as the feature is not complete yet"),i===this.layer.shaderIOInfo.activeAttribute&&(this.activePropertyId=r[0])}),ft.setObservableMonitor(!1),this.makeUpdateAllPropertyIdList();const n=this.resizeBuffer();return this.gatherLocationsIntoGroups(n.newLocations,n.growth),this.add=this.doAdd,this.doAdd(e)}doAdd(e){if(this.availableLocations.length<=0||this.currentAvailableLocation>=this.availableLocations.length-1){const i=this.resizeBuffer();this.gatherLocationsIntoGroups(i.newLocations,i.growth)}const n=this.availableLocations[++this.currentAvailableLocation];return n&&this.geometry?(this.instanceToBufferLocation[e.uid]=n,this.currentInstancedCount=this.geometry.maxInstancedCount=tv(this.currentInstancedCount,n.instanceIndex+1),this.model&&(this.model.vertexDrawRange=[0,this.layer.shaderIOInfo.instanceVertexCount],this.model.drawInstances=this.currentInstancedCount,this.layer.shaderIOInfo.instanceVertexCount===0&&(this.model.vertexDrawRange[1]=this.model.drawInstances))):console.error("Add Error: Instance Attribute Buffer Manager failed to pair an instance with a buffer location"),n}destroy(){this.geometry&&this.geometry.destroy(),this.material&&this.material.dispose(),this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model)}getBufferLocations(e){return this.instanceToBufferLocation[e.uid]}getActiveAttributePropertyId(){return this.activePropertyId}getUpdateAllPropertyIdList(){return this.updateAllPropertyIdList}managesInstance(e){return this.instanceToBufferLocation[e.uid]!==void 0}makeUpdateAllPropertyIdList(){const e={};this.attributeToPropertyIds.forEach(n=>{e[n[0]]=n[0]}),this.updateAllPropertyIdList=Object.values(e).filter(Boolean)}removeFromScene(){this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model),delete this.scene}resizeBuffer(){var r;Lr("Gathering resize growth amount...");const e=this.layer.shaderIOInfo;let n=0;const i=new Map;if(this.changeListContext){n=1e3;for(let s=0,a=this.changeListContext.length;s<a;++s){const o=this.changeListContext[s];switch(o[1]){case Ze.CHANGE:case Ze.INSERT:this.instanceToBufferLocation[o[0].uid]||n++;break}}}if(Lr("BEGIN: Resizing unpacked attribute buffer by %d instances",n),this.geometry){this.geometry.destroy(),this.geometry=new si;const s=this.maxInstancedCount;for(const a of e.vertexAttributes)a.materialAttribute&&this.geometry.addAttribute(a.name,a.materialAttribute);this.maxInstancedCount+=n,this.attributes=this.attributes||[];for(const a of this.attributes){const o=a.bufferAttribute,c=a.size||0;if(o.data instanceof Float32Array){let l=o.data;l.length<this.maxInstancedCount*c&&(l=new Float32Array(this.maxInstancedCount*c*2),l.set(o.data,0));const u=new Un(l,c,!0,!0);u.setDynamic(!0),a.bufferAttribute=u,this.geometry.addAttribute(a.name,u);let h=i.get(a.name);const f=this.allBufferLocations[a.name]||[];this.allBufferLocations[a.name]=f;for(let T=0,b=f.length;T<b;++T)f[T].buffer.value=l;h||(h=[],i.set(a.name,h));let p,m=h.length;const v=this.maxInstancedCount-s;h.length+=v,f.length+=v;for(let T=s,b=this.maxInstancedCount;T<b;++T,++m)p={attribute:a,buffer:{value:l},instanceIndex:T,range:[T*c,T*c+c]},h[m]=p,f[T]=p}}(r=this.scene)!=null&&r.container&&this.model&&this.scene.container.remove(this.model)}else{this.maxInstancedCount+=n,this.geometry=new si;for(const s of e.vertexAttributes)s.materialAttribute&&this.geometry.addAttribute(s.name,s.materialAttribute);this.attributes=[];for(const s of e.instanceAttributes){const a=s.size||0,o=new Float32Array(a*this.maxInstancedCount),c=new Un(o,a,!0,!0);c.setDynamic(!0),this.geometry.addAttribute(s.name,c);let l=i.get(s.name);l||(l=[],i.set(s.name,l));const u=this.allBufferLocations[s.name]||[];this.allBufferLocations[s.name]=u;const h=Object.assign({},s,{uid:K(),bufferAttribute:c});for(let f=0;f<this.maxInstancedCount;++f){const p={attribute:h,buffer:{value:o},instanceIndex:f,range:[f*a,f*a+a]};l.push(p),u.push(p)}this.attributes.push(h)}this.geometry.maxInstancedCount=0,this.material=this.makeLayerMaterial();for(let s=0,a=e.uniforms.length;s<a;++s){const o=e.uniforms[s];o.materialUniforms.push(this.material.uniforms[o.name])}}return this.scene&&this.model&&this.scene.container&&this.scene.container.remove(this.model),this.material=this.material||this.makeLayerMaterial(),this.model=za(this.layer.id,this.geometry,this.material,e.drawMode),this.scene&&this.scene.container&&this.model&&this.scene.container.add(this.model),Lr("COMPLETE: Resizing unpacked attribute buffer"),{growth:n,newLocations:i}}gatherLocationsIntoGroups(e,n){if(this.attributeToPropertyIds.size===0)return;Lr("BEGIN: Unpacked attribute manager grouping new buffer locations");const i=[];this.attributeToPropertyIds.forEach((u,h)=>{i.push({attribute:h,bufferLocationsForAttribute:e.get(h.name)||[],childBufferLocations:(h.childAttributes||[]).map(f=>({location:e.get(f.name)||[],bufferIndex:-1})),ids:u,bufferIndex:-1})});let r,s,a,o,c,l;for(let u=0;u<n;++u){const h={instanceIndex:-1,propertyToBufferLocation:{}};for(let f=0,p=i.length;f<p;++f){if(r=i[f],s=r.attribute,a=r.ids,o=r.bufferLocationsForAttribute,!o){wi("Instance Attribute Buffer Error",(m,v)=>{console.warn(`${v}: There is an error in forming buffer location groups in InstanceAttributeBufferManager. Error count: ${m}`)});continue}if(c=o[++r.bufferIndex],!c){wi("Instance Attribute Buffer Error",(m,v)=>{console.warn(`${v}: There is an error in forming buffer location groups in InstanceAttributeBufferManager. Error count: ${m}`)});continue}if(h.instanceIndex===-1)h.instanceIndex=c.instanceIndex;else if(c.instanceIndex!==h.instanceIndex){wi("Instance Attribute Parallelism Error",(m,v)=>{console.warn(`${v}: A buffer location does not have a matching instance index which means the buffer locations are not in parallel with each other somehow. Error count: ${m}`),console.warn(s.name,c)});continue}if(s.childAttributes){c.childLocations=[];for(let m=0,v=s.childAttributes.length;m<v;++m){const T=r.childBufferLocations[m];if(T){const b=T.location[++T.bufferIndex];b?c.childLocations.push(b):(l=s.childAttributes[m],wi("Instance Attribute Child Attribute Error",(E,S)=>{console.warn(`${S}: A child attribute does not have a buffer location available. Error count: ${E}`),console.warn(`Parent Attribute: ${s.name} Child Attribute: ${l.name}`)}))}}}for(let m=0,v=a.length;m<v;++m)h.propertyToBufferLocation[a[m]]=c}this.availableLocations.push(h)}Lr("COMPLETE: Unpacked attribute buffer manager buffer location grouping"),Lf()}getInstanceCount(){return this.maxInstancedCount}}const{max:iv}=Math,Or=Ke("performance");class Pf extends Va{constructor(e,n){super(e,n),this.allBufferLocations={},this.availableLocations=[],this.currentInstancedCount=0,this.instanceToBufferLocation={},this.maxInstancedCount=1e3,this.blockSubAttributesLookup=new Map,this.attributeToPropertyIds=new Map,this.updateAllPropertyIdList=[],this.activePropertyId=-1,this.currentAvailableLocation=-1,this.remove=i=>{const r=this.instanceToBufferLocation[i.uid];return r&&(delete this.instanceToBufferLocation[i.uid],this.availableLocations.push(r)),i},this.add=this.doAddWithRegistration}changesProcessed(){super.changesProcessed(),this.availableLocations.splice(0,this.currentAvailableLocation+1),this.currentAvailableLocation=-1}doAddWithRegistration(e){this.layer.shaderIOInfo.instanceAttributes.forEach(i=>{if(i.parentAttribute)return;ft.setObservableMonitor(!0),i.update(e);const r=ft.getObservableMonitorIds(!0);this.attributeToPropertyIds.set(i,[r[r.length-1]]),r.length>1&&Or("Property has multiple observables. Only the last trigger will be retained as the feature is not complete yet"),i===this.layer.shaderIOInfo.activeAttribute&&(this.activePropertyId=r[0])}),ft.setObservableMonitor(!1),this.makeUpdateAllPropertyIdList();const n=this.resizeBuffer();return this.gatherLocationsIntoGroups(n.newLocations,n.growth),this.add=this.doAdd,this.doAdd(e)}doAdd(e){if(this.availableLocations.length<=0||this.currentAvailableLocation>=this.availableLocations.length-1){const i=this.resizeBuffer();this.gatherLocationsIntoGroups(i.newLocations,i.growth)}const n=this.availableLocations[++this.currentAvailableLocation];return n&&this.geometry?(this.instanceToBufferLocation[e.uid]=n,this.currentInstancedCount=this.geometry.maxInstancedCount=iv(this.currentInstancedCount,n.instanceIndex+1),this.model&&(this.model.vertexDrawRange=[0,this.layer.shaderIOInfo.instanceVertexCount],this.model.drawInstances=this.currentInstancedCount,this.layer.shaderIOInfo.instanceVertexCount===0&&(this.model.vertexDrawRange[1]=this.model.drawInstances))):console.error("Add Error: Instance Attribute Buffer Manager failed to pair an instance with a buffer location"),n}destroy(){this.geometry&&this.geometry.destroy(),this.material&&this.material.dispose(),this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model)}getBufferLocations(e){return this.instanceToBufferLocation[e.uid]}getActiveAttributePropertyId(){return this.activePropertyId}getUpdateAllPropertyIdList(){return this.updateAllPropertyIdList}managesInstance(e){return this.instanceToBufferLocation[e.uid]!==void 0}makeUpdateAllPropertyIdList(){const e={};this.attributeToPropertyIds.forEach(n=>{e[n[0]]=n[0]}),this.updateAllPropertyIdList=Object.values(e).filter(Boolean)}removeFromScene(){this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model),delete this.scene}resizeBuffer(){const e=this.layer.shaderIOInfo;let n=0;const i=new Map;if(this.changeListContext){n=1e3;for(let r=0,s=this.changeListContext.length;r<s;++r){const a=this.changeListContext[r];switch(a[1]){case Ze.CHANGE:case Ze.INSERT:this.instanceToBufferLocation[a[0].uid]||n++;break}}}if(Or("BEGIN: Resizing packed attribute buffer by %d instances",n),this.geometry){Or(`Info: Vertex packing buffer is being resized for layer ${this.layer.id}`),this.geometry.destroy(),this.geometry=new si;const r=this.maxInstancedCount;for(const s of e.vertexAttributes)s.materialAttribute&&this.geometry.addAttribute(s.name,s.materialAttribute);this.maxInstancedCount+=n,this.attributes=this.attributes||[],this.blockAttributes=this.blockAttributes||[];for(let s=0,a=this.blockAttributes.length;s<a;++s){const o=this.blockAttributes[s];let c=o.bufferAttribute;const l=o.size||0;if(c.data instanceof Float32Array){let u=c.data;u.length<this.maxInstancedCount*l&&(u=new Float32Array(this.maxInstancedCount*l*2),u.set(c.data,0)),u.set(c.data,0);const h=new Un(u,l,!0,!0);o.bufferAttribute=c=h,this.geometry.addAttribute(o.name,h);const f=this.blockSubAttributesLookup.get(s),p=o.size||0;if(f)for(let m=0,v=f.length;m<v;++m){const T=f[m];let b=i.get(T.name);b||(b=[],i.set(T.name,b));const E=this.allBufferLocations[T.name]||[];this.allBufferLocations[T.name]=E;const S=Object.assign({},T,{uid:K(),packUID:o.packUID,bufferAttribute:c}),I=T.blockIndex||0,M=T.size||1;let N;for(let W=0,V=E.length;W<V;++W)N=E[W],N.attribute=S,N.buffer.value=u;let x,P=b.length;const te=this.maxInstancedCount-r;b.length+=te,E.length+=te;for(let W=r;W<this.maxInstancedCount;++W,++P)x={attribute:S,block:s,buffer:{value:u},instanceIndex:W,range:[W*p+I,W*p+I+M]},b[P]=x,E[W]=x}}}}else{this.maxInstancedCount+=n,this.geometry=new si;for(const a of e.vertexAttributes)a.materialAttribute&&this.geometry.addAttribute(a.name,a.materialAttribute);this.attributes=[],this.blockAttributes=[];const r=new Map,s=new Map;this.blockSubAttributesLookup=s;for(let a=0,o=e.instanceAttributes.length;a<o;++a){const c=e.instanceAttributes[a],l=c.block||0;let u=r.get(l)||0;u=Math.max(u,(c.blockIndex||0)+(c.size||0)),r.set(l,u);let h=s.get(l);h||(h=[],s.set(l,h)),h.push(c)}s.forEach(a=>a.sort((o,c)=>(o.blockIndex||0)-(c.blockIndex||0)));for(let a=0,o=r.size;a<o;++a){const c=r.get(a)||0,l=K();c||console.warn("Instance Attribute Packing Error: The system tried to build an attribute with a size of zero.","These are the attributes used:",e.instanceAttributes,"These are the block sizes calculated",r,"This is the block to attribute lookup generated",s);const u=new Float32Array(c*this.maxInstancedCount),h=new Un(u,c,!0,!0);this.geometry.addAttribute(`block${a}`,h);const f=s.get(a);if(f){for(let p=0,m=f.length;p<m;++p){const v=f[p];let T=i.get(v.name);T||(T=[],i.set(v.name,T));const b=this.allBufferLocations[v.name]||[];this.allBufferLocations[v.name]=b;const E=Object.assign({},v,{uid:a,packUID:l,bufferAttribute:h,size:c}),S=v.blockIndex||0,I=v.size||1;for(let M=0;M<this.maxInstancedCount;++M){const N={attribute:E,block:a,buffer:{value:u},instanceIndex:M,range:[M*c+S,M*c+S+I]};T.push(N),b.push(N)}this.attributes.push(E)}this.blockAttributes.push({uid:K(),packUID:l,bufferAttribute:h,name:`block${a}`,size:c,update:()=>[0]})}else console.warn("Instance Attribute Packing Buffer Error: Somehow there are no attributes associated with a block.","These are the attributes used:",e.instanceAttributes,"These are the block sizes calculated",r,"This is the block to attribute lookup generated",s)}this.geometry.maxInstancedCount=0,this.material=this.makeLayerMaterial();for(let a=0,o=e.uniforms.length;a<o;++a){const c=e.uniforms[a];c.materialUniforms.push(this.material.uniforms[c.name])}}return this.scene&&this.model&&this.scene.container&&this.scene.container.remove(this.model),this.material=this.material||this.makeLayerMaterial(),this.model=za(this.layer.id,this.geometry,this.material,this.layer.shaderIOInfo.drawMode),this.scene&&this.scene.container&&this.model&&this.scene.container.add(this.model),Or("COMPLETE: Resizing unpacked attribute buffer"),{growth:n,newLocations:i}}gatherLocationsIntoGroups(e,n){if(this.attributeToPropertyIds.size===0)return;Or("BEGIN: Packed attribute manager grouping new buffer locations");const i=[];this.attributeToPropertyIds.forEach((r,s)=>{i.push({attribute:s,bufferLocationsForAttribute:e.get(s.name)||[],childBufferLocations:(s.childAttributes||[]).map(a=>({location:e.get(a.name)||[],bufferIndex:-1})),ids:r,bufferIndex:-1})});for(let r=0;r<n;++r){const s={instanceIndex:-1,propertyToBufferLocation:{}};for(let a=0,o=i.length;a<o;++a){const c=i[a],l=c.attribute,u=c.ids,h=c.bufferLocationsForAttribute;if(!h){wi("Instance Attribute Buffer Error",(p,m)=>{console.warn(`${m}: There is an error in forming buffer location groups in InstanceAttributePackingBufferManager. Error count: ${p}`)});continue}const f=h[++c.bufferIndex];if(!f){wi("Instance Attribute Buffer Error",(p,m)=>{console.warn(`${m}: There is an error in forming buffer location groups in InstanceAttributePackingBufferManager. Error count: ${p}`)});continue}if(s.instanceIndex===-1)s.instanceIndex=f.instanceIndex;else if(f.instanceIndex!==s.instanceIndex){wi("Instance Attribute Parallelism Error",(p,m)=>{console.warn(`${m}: A buffer location does not have a matching instance index which means the buffer locations are not in parallel with each other somehow. Error count: ${p}`),console.warn(l.name,f)});continue}if(l.childAttributes){const p=[];for(let m=0,v=l.childAttributes.length;m<v;++m){const T=l.childAttributes[m],b=c.childBufferLocations[m];if(b){const E=b.location[++b.bufferIndex];E?p.push(E):wi("Instance Attribute Child Attribute Error",(S,I)=>{console.warn(`${I}: A child attribute does not have a buffer location available. Error count: ${S}`),console.warn(`Parent Attribute: ${l.name} Child Attribute: ${T.name}`)})}}f.childLocations=p}for(let p=0,m=u.length;p<m;++p){const v=u[p];s.propertyToBufferLocation[v]=f}}this.availableLocations.push(s)}Or("COMPLETE: Packed attribute buffer manager buffer location grouping"),Lf()}getInstanceCount(){return this.maxInstancedCount}}function Df(t){return t&&t.buffer&&t.buffer.value&&t.type===je.VEC4_ARRAY}class Ff extends Va{constructor(e,n){super(e,n),this.buffers=[],this.availableClusters=[],this.instanceToCluster={},this.clusterToBuffer=new Map,this.add=r=>{this.availableClusters.length<=0&&this.makeNewBuffer();const s=this.availableClusters.pop();return s?this.instanceToCluster[r.uid]=s:console.warn("No valid cluster available for instance added to uniform manager."),s},this.remove=r=>{const s=this.instanceToCluster[r.uid];return s&&(delete this.instanceToCluster[r.uid],this.availableClusters.push(s)),r};let i=0;e.shaderIOInfo.instanceAttributes.forEach(r=>{i=Math.max(r.block||0,i)}),this.uniformBlocksPerInstance=i+1}destroy(){this.buffers.forEach(e=>{e.geometry.destroy(),e.material.dispose()})}getBufferLocations(e){return this.instanceToCluster[e.uid]}getActiveAttributePropertyId(){return-1}getInstanceCount(){return-1}getUpdateAllPropertyIdList(){return[]}managesInstance(e){return this.instanceToCluster[e.uid]===void 0}removeFromScene(){const e=this.scene;if(e!=null&&e.container){for(let n=0,i=this.buffers.length;n<i;++n){const r=this.buffers[n];e.container.remove(r.model)}delete this.scene}}setScene(e){if(e.container){for(let n=0,i=this.buffers.length;n<i;++n){const r=this.buffers[n];e.container.add(r.model)}this.scene=e}else console.warn("Can not set a scene that has an undefined container.")}makeNewBuffer(){const e=this.layer.shaderIOInfo,n=new si;e.vertexAttributes.forEach(u=>{u.materialAttribute&&n.addAttribute(u.name,u.materialAttribute)});const i=this.makeLayerMaterial(),r=za(this.layer.id,n,i,e.drawMode);r.vertexDrawRange=[0,e.maxInstancesPerBuffer*e.instanceVertexCount];const s={activeInstances:[],clusters:[],firstInstance:0,geometry:n,lastInstance:0,material:i,model:r};this.buffers.push(s);let a=0;const o=K0,c=i.uniforms[o];if(qu(c))c.value=c.value.map(()=>[0,0,0,0]);else{console.warn("Material is utilizing an invalid uniform type for Uniform Buffer Management. Buffering will not be possible.");return}const l=Object.assign({},e.instanceAttributes[0],{bufferAttribute:new Un(new Float32Array(1),1),uid:K()});for(let u=0,h=e.maxInstancesPerBuffer;u<h;++u){const f={attribute:l,buffer:c,instanceIndex:u,range:[a,0]};a+=this.uniformBlocksPerInstance,f.range[1]=a,s.clusters.push(f),this.availableClusters.push(f),this.clusterToBuffer.set(f,s)}for(let u=0,h=e.uniforms.length;u<h;++u){const f=e.uniforms[u];f.materialUniforms.push(i.uniforms[f.name])}this.scene&&this.scene.container&&this.scene.container.add(s.model)}}class Bf{constructor(e,n){this.layer=e,this.bufferManager=n}}const Wa=[],{min:Ml,max:xl}=Math;class rv extends Bf{constructor(){super(...arguments),this.diffMode=0,this.bufferAttributeUpdateRange={},this.bufferAttributeWillUpdate={},this.updateInstance=this.updateInstancePartial}addInstance(e,n,i,r){if(r)e.changeInstance(e,n,Wa,r);else{const s=e.layer.bufferManager.add(n);Of(s)&&(n.active=!0,e.layer.onDiffAdd&&e.layer.onDiffAdd(n),e.updateInstance(e.layer,n,Wa,s))}}changeInstance(e,n,i,r){r?e.updateInstance(e.layer,n,i,r):e.addInstance(e,n,Wa,r)}removeInstance(e,n,i,r){r&&(n.active=!1,e.layer.onDiffRemove&&e.layer.onDiffRemove(n),e.updateInstance(e.layer,n,Wa,r),e.layer.bufferManager.remove(n))}updateInstancePartial(e,n,i,r){const s=r.propertyToBufferLocation,a=this.bufferAttributeUpdateRange;let o,c,l,u,h,f;if(n.active){(i.length===0||n.reactivate)&&(i=this.bufferManager.getUpdateAllPropertyIdList());for(let p=0,m=i.length;p<m;++p)if(o=s[i[p]],!!o&&(h=o.attribute,f=h.packUID||h.uid,c=h.update(n),o.buffer.value.set(c,o.range[0]),l=a[f]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER],l[0]=h,l[1]=Ml(o.range[0],l[1]),l[2]=xl(o.range[1],l[2]),a[f]=l,o.childLocations)){u=o.childLocations;for(let v=0,T=u.length;v<T;++v)o=u[v],o&&(f=o.attribute.packUID||o.attribute.uid,c=o.attribute.update(n),o.buffer.value.set(c,o.range[0]),l=a[f]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER],l[0]=o.attribute,l[1]=Ml(o.range[0],l[1]),l[2]=xl(o.range[1],l[2]),a[f]=l)}}else o=s[this.bufferManager.getActiveAttributePropertyId()],h=o.attribute,f=h.packUID||h.uid,c=h.update(n),o.buffer.value.set(c,o.range[0]),l=a[f]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER],l[0]=h,l[1]=Ml(o.range[0],l[1]),l[2]=xl(o.range[1],l[2]),a[f]=l;n.reactivate=!1}updateInstanceFull(e,n,i,r){const s=r.propertyToBufferLocation,a=this.bufferAttributeWillUpdate;let o,c,l,u;if(n.active){(i.length===0||n.reactivate)&&(i=this.bufferManager.getUpdateAllPropertyIdList());for(let h=0,f=i.length;h<f;++h)if(o=s[i[h]],!!o&&(u=o.attribute,c=u.update(n),o.buffer.value.set(c,o.range[0]),a[u.packUID||u.uid]=u,o.childLocations)){l=o.childLocations;for(let p=0,m=l.length;p<m;++p)o=l[p],o&&(u=o.attribute,c=u.update(n),o.buffer.value.set(c,o.range[0]),a[u.packUID||u.uid]=u)}}else o=s[this.bufferManager.getActiveAttributePropertyId()],u=o.attribute,c=u.update(n),o.buffer.value.set(c,o.range[0]),a[u.packUID||u.uid]=u;n.reactivate=!1}commit(){if(this.diffMode===0){const e=Object.values(this.bufferAttributeUpdateRange);for(let n=0,i=e.length;n<i;++n){const r=e[n],s=r[0].bufferAttribute;s.updateRange={count:r[2]-r[1],offset:r[1]}}}else{const e=Object.values(this.bufferAttributeWillUpdate);for(let n=0,i=e.length;n<i;++n){const r=e[n].bufferAttribute;r.updateRange={count:-1,offset:0}}}this.bufferAttributeUpdateRange={}}incomingChangeList(e){e.length===0?this.diffMode=0:e.length>this.bufferManager.getInstanceCount()*.7?this.diffMode=1:this.diffMode=0,this.diffMode===0?this.updateInstance=this.updateInstancePartial:this.updateInstance=this.updateInstanceFull}}const Uf=[];class sv extends Bf{addInstance(e,n,i,r){if(r)e.changeInstance(e,n,Uf,r);else{const s=e.layer.bufferManager.add(n);Df(s)&&(n.active=!0,e.layer.onDiffAdd&&e.layer.onDiffAdd(n),e.updateInstance(e.layer,n,s))}}changeInstance(e,n,i,r){r?e.updateInstance(e.layer,n,r):e.addInstance(e,n,Uf,r)}removeInstance(e,n,i,r){r&&(n.active=!1,e.layer.onDiffRemove&&e.layer.onDiffRemove(n),e.updateInstance(e.layer,n,r),e.layer.bufferManager.remove(n))}updateInstance(e,n,i){if(n.active){const r=i.buffer,s=i.range[0],a=r.value;let o,c,l,u,h,f;for(let p=0,m=e.shaderIOInfo.instanceAttributes.length;p<m;++p)if(o=e.shaderIOInfo.instanceAttributes[p],c=o.update(n),l=a[s+(o.block||0)],u=o.blockIndex,u!==void 0)for(h=u,f=c.length+u;h<f;++h)l[h]=c[h-u];r.value=a}else{const r=i.buffer,s=i.range[0],a=r.value,o=e.shaderIOInfo.activeAttribute,c=o.update(n),l=a[s+(o.block||0)],u=o.blockIndex;if(u!==void 0)for(let h=u,f=c.length+u;h<f;++h)l[h]=c[h-u];r.value=a}}commit(){}incomingChangeList(e){}}class av{makeProcessor(e,n){if(this.processing)return this.processing;if(e.bufferType===Qe.INSTANCE_ATTRIBUTE||e.bufferType===Qe.INSTANCE_ATTRIBUTE_PACKING?this.processor=new rv(e,n):this.processor=new sv(e,n),!this.processor)throw new Error("Failed to create a diff processor");return this.processing=[this.processor.changeInstance,this.processor.addInstance,this.processor.removeInstance],this.processing}}class kf{constructor(e){this.index=0,this.available=4,this.index=e}setAttribute(e){return(e.size||0)<=this.available?(e.block=this.index,e.blockIndex=4-this.available,this.available-=e.size||0,!0):!1}}function ov(t){t.forEach(e=>{if(e.resource&&e.size===void 0&&(e.size=k.FOUR),!e.size)try{const n=e.update(new pt({}));n.length>0&&n.length<=k.FOUR&&(e.size=n.length)}catch{console.warn("The system could not determine the size of the provided attribute. Please provide the size of the attribute:",e)}})}function Gf(t){ov(t);const e=[];t.forEach(n=>{if(n.size&&n.size===k.MAT4X4){n.block=e.length,n.blockIndex=Cc.INVALID;for(let r=0;r<4;++r){const s=new kf(e.length);s.available=0,s.index=0,e.push(s)}return}if(!e.find(r=>r.setAttribute(n)?!!r:!1)){const r=new kf(e.length);e.push(r),r.setAttribute(n)||console.warn("There was a problem packing an attribute into a block. No block would accommodate it:",n)}})}function zf(t){return!!t}function Vf(t){return!!t}function Wf(t){return!!t}function cv(t){return Object.assign({},t,{materialAttribute:null})}function lv(t){return Object.assign({},t,{materialUniforms:[]})}function uv(t,e,n,i){e.forEach(r=>{r.name===void 0&&console.warn("All instance attributes MUST have a name on Layer:",t.id),e.find(s=>s!==r&&s.name===r.name)&&console.warn("An instance attribute can not have the same name used more than once:",r.name),n.find(s=>s.name===r.name)&&console.warn("An instance attribute and a vertex attribute in a layer can not share the same name:",r.name),r.resource||r.size===void 0&&(console.warn("An instance attribute requires the size to be defined."),console.warn(r))})}function hv(t,e,n){if(!n)return;let i=e.instanceAttributes||[],r=e.uniforms||[],s=e.vertexAttributes||[];n.shaderModuleUnits.forEach(l=>{l.instanceAttributes&&(i=i.concat(l.instanceAttributes(t))),l.uniforms&&(r=r.concat(l.uniforms(t))),l.vertexAttributes&&(s=s.concat(l.vertexAttributes(t)))});const a=new Set,o=new Set,c=new Set;r.filter(l=>l?a.has(l.name)?(console.warn("Included shader modules has introduced duplicate uniform names:",l.name,"One will be overridden thus causing a potential crash of the shader."),!1):(a.add(l.name),!0):!1),i.filter(l=>l?o.has(l.name)?(console.warn("Included shader modules has introduced duplicate Instance Attribute names:",l.name,"One will be overridden thus causing a potential crash of the shader."),!1):(o.add(l.name),!0):!1),s.filter(l=>l?c.has(l.name)?(console.warn("Included shader modules has introduced duplicate Vertex Attribute names:",l.name,"One will be overridden thus causing a potential crash of the shader."),!1):(c.add(l.name),!0):!1),e.instanceAttributes=i,e.uniforms=r,e.vertexAttributes=s}function $f(t,e,n,i,r,s){hv(e,n,s);const a=(n.instanceAttributes||[]).filter(zf),o=(n.vertexAttributes||[]).filter(Vf),c=(n.uniforms||[]).filter(Wf);for(let f=0,p=i.length;f<p;++f){const m=i[f];if(m.validate(e,a,o,c)){const v=m.expand(e,a,o,c);v.instanceAttributes.filter(zf).forEach(T=>a.push(T)),v.vertexAttributes.filter(Vf).forEach(T=>o.push(T)),v.uniforms.filter(Wf).forEach(T=>c.push(T))}}uv(e,a,o);const l=a.slice(0),u=(o||[]).map(cv),h=c.map(lv);return l.sort(r.sortInstanceAttributes),h.sort(r.sortUniforms),u.sort(r.sortVertexAttributes),Gf(l),e.getLayerBufferType(t,o,l),{instanceAttributes:l,uniforms:h,vertexAttributes:u}}class Il{static calculateUniformBlockUseage(e){let n=0;for(let i=0,r=e.length;i<r;++i)n+=Math.ceil(e[i].size/4);return n}process(e,n){this.instanceMaxBlock=0,e.forEach(i=>{this.instanceMaxBlock=Math.max(this.instanceMaxBlock,i.block||0)}),this.blocksPerInstance=this.instanceMaxBlock+1,this.maxUniforms=U.MAX_VERTEX_UNIFORMS,this.maxUniformsForInstancing=this.maxUniforms-Il.calculateUniformBlockUseage(n),this.maxInstancesPerUniformBuffer=Math.floor(this.maxUniformsForInstancing/this.blocksPerInstance),this.totalInstanceUniformBlocks=this.maxInstancesPerUniformBuffer*this.blocksPerInstance}}function dv(t,e,n,i){return e<0&&(e=t.length+e,e<0&&(e=0)),t.slice(0,e)+(i||"")+t.slice(e+n)}function $a(t){let e=!1,n=!1;const i=[];let r={start:-1,stop:-1},s={start:-1,stop:-1};for(let a=0,o=t.length;a<o;++a){const c=t[a],l=t[a+1];switch(c){case"/":switch(l){case"*":!n&&!e&&(r.start=a,e=!0,a++);break;case"/":!e&&!n&&(s.start=a,n=!0,a++);break}break;case"*":l==="/"&&e&&(r.stop=a+2,i.push(r),r={start:-1,stop:-1},e=!1,a++);break;case`
`:case"\r":n&&(s.stop=a,i.push(s),s={start:-1,stop:-1},n=!1);break}}return i.reverse(),i.forEach(a=>{t=dv(t,a.start,a.stop-a.start)}),t}const xs="Once a ShaderModuleUnit has been registered, you CAN NOT modify it! Module ID:";class ja{constructor(e){this._dependents=null,Object.assign(this,e)}get content(){return this._content}set content(e){if(this._isLocked){console.warn(xs,this._moduleId);return}this._content=e}get compatibility(){return this._compatibility}set compatibility(e){if(this._isLocked){console.warn(xs,this._moduleId);return}this._compatibility=e}get dependents(){return this._dependents}set dependents(e){if(this._isLocked&&this._dependents!==null){console.warn(xs,this._moduleId);return}this._dependents=e}isLocked(){return this._isLocked}get moduleId(){return this._moduleId}set moduleId(e){if(this._isLocked){console.warn(xs,this._moduleId);return}this._moduleId=e}applyAnalyzedContent(e){if(this._isLocked&&this.dependents!==null){console.warn(xs,this._moduleId);return}this._content=e}lock(){this._isLocked=!0}}const jf=Ke("performance"),fv=Ke("shader-module-vs"),pv=Ke("shader-module-fs"),Hf="import",Qf=":";function Xf(t,e){return!!t&&(t.compatibility===e||t.compatibility===G.ALL)}const yi=class{static register(t){if(!(t instanceof ja)){if(Array.isArray(t)){let a="";return t.forEach(o=>{const c=yi.register(o);c&&(a+=`${c}
`)}),a||null}return yi.register(new ja(t))}let e=yi.modules.get(t.moduleId);e||(e={},yi.modules.set(t.moduleId,e));const n=e.fs,i=e.vs,r=Xf(t,G.FRAGMENT),s=Xf(t,G.VERTEX);if(n&&r){if(n.isFinal)return`Module ID: ${t.moduleId} Can not override the module's existing Fragment registration as the exisitng module is marked as final`;jf("A Shader Module Unit has overridden an existing module for the Fragment Shader Module ID: %o",t.moduleId)}if(i&&s){if(i.isFinal)return`Module ID: ${t.moduleId} Can not override the module's existing Vertex registration as the exisitng module is marked as final`;jf("A Shader Module Unit has overridden an existing module for the Vertex Shader Module ID: %o",t.moduleId)}return r&&(e.fs=t),s&&(e.vs=t),t.lock(),null}static analyzeDependents(t){if(t.dependents&&t.isLocked())return[];const e=[],n=[],i=new Set,r=t.compatibility,s=t.moduleId,a=gi({options:{},shader:t.content,onToken:o=>{const c=o.trim();if(c.indexOf(Hf)===0){const l=c.substr(Hf.length).trim();if(l[0]===Qf){let u=!1;const h=l.substr(Qf.length).trim().split(",");return h[h.length-1].trim().length===0&&h.pop(),h.forEach(f=>{f=f.trim();const p=yi.modules.get(f);p?((r===G.FRAGMENT||r===G.ALL)&&(p.fs?(u=!0,i.has(f)||n.push(f)):e.push(`Could not find requested target fragment module for Module ID: ${f} requested by module: ${s}`)),(r===G.VERTEX||r===G.ALL)&&(p.vs?(u=!0,i.has(f)||n.push(f)):e.push(`Could not find requested target vertex module for Module ID: ${f} requested by module: ${s}`)),!p.vs&&!p.fs&&e.push("Could not find a vertex or fragment shader within exisitng module"),u||e.push(`Error Processing module Module ID: ${f} requested by module: ${s}`)):e.push(`Could not find requested module: ${f} requested by module: ${s}`)}),""}}return`\${${o}}`}});return t.applyAnalyzedContent(a.shader),t.dependents=n,e}static process(t,e,n,i){const r=new Set,s=new Set,a=[],o=[],c=n===G.VERTEX?fv:pv;c("Processing Shader for context %o:",t);function l(m){const v=m.moduleId;c("%o: %o",v,a.slice(0).reverse().join(" -> "));const T=a.indexOf(v);if(a.unshift(v),T>-1){const b=a.slice(0,T+2).reverse();return o.push(`A Shader has detected a Circular dependency in import requests: ${b.join(" -> ")}`),a.shift(),!1}return!0}function u(m){const v=m.moduleId;if(!l(m))return null;if(v&&s.has(v))return a.shift(),"";let T="";yi.analyzeDependents(m).forEach(S=>o.push(S));const E=m.dependents;if(c("Module dependencies detected %o",E),E&&E.length>0)for(let S=0,I=E.length;S<I;++S){const M=E[S],N=yi.modules.get(M);if(N){let x;(n===G.FRAGMENT||n===G.ALL)&&(N.fs?(r.add(N.fs),x=u(N.fs)):o.push(`Could not find requested target fragment module for Module ID: ${M} requested by module: ${v}`)),(n===G.VERTEX||n===G.ALL)&&(N.vs?(r.add(N.vs),x=u(N.vs)):o.push(`Could not find requested target vertex module for Module ID: ${M} requested by module: ${v}`)),!N.vs&&!N.fs&&o.push("Could not find a vertex or fragment shader within exisitng module"),x===null&&o.push(`Error Processing module Module ID: ${M} requested by module: ${v}`),T+=x||""}else o.push(`Could not find requested module: ${M} requested by module: ${v}`)}return a.shift(),s.add(v||""),`${T.trim()}

${m.content.trim()}`}let h=e;if(i){let m="";i.forEach(v=>{m+=`\${import: ${v}}
`}),h=m+e}const f=new ja({content:h,compatibility:n,moduleId:`Layer "${t}" ${n===G.ALL?"fs vs":n===G.VERTEX?"vs":"fs"}`});return{errors:o,shader:u(f),shaderModuleUnits:r}}};let tt=yi;tt.modules=new Map;const Yf={attributes:"attributes",easingMethod:"easingMethod",extend:"extend",extendHeader:"extendHeader",T:"T"},Ha="out",Qa=":";class qf{constructor(){this.metricsProcessing=new Il}static mergeFragmentOutputsForMRT(e,n,i,r,s,a){let o="",c="",l="";const u=new Set,h=[],f=new Set;return U.MRT||(l=" = gl_FragColor"),i.forEach((p,m)=>{let v=!0,T=!1;if(s&&s.indexOf(p.outputType)<0&&(v=!1),a&&m<i.length-1&&(v=!1),!a&&r.indexOf(p.outputType)<0&&(v=!1),f.has(p.outputType))throw new Error("Can not use the same Output Fragment type multiple times");f.add(p.outputType);const b=r.indexOf(p.outputType);gi({shader:$a(p.source),onToken(E){const S=E.trim();if(S.indexOf(Ha)===0){if(T)throw console.error("Found multiple ${out} tokens in a single fragment shader. This is not supported nor logical","If you need to use the declared output multiple times, use the assigned name","and don't wrap it repeatedly in the shader.","eg-","void main() {","  ${out: myOutput} = value;","  vec4 somethingElse = myOutput;","}"),new Error("Invalid Shader Format");T=!0;const I=S.substr(Ha.length).trim();if(I[0]===Qa){const M=I.substr(Qa.length).trim();if(!M)throw new Error("Output in a shader requires an identifier ${out: <name required>}");if(u.has(M))throw new Error("You can not declare the same output name in subsequent fragment shader outputs");if(M==="gl_FragColor")throw new Error("DO not use gl_FragColor as an identifier for an out. Choose something not used by the WebGL spec.");let N="";if(v)if(u.add(M),h.push(p.outputType),U.MRT_EXTENSION)l=` = gl_FragData[${b}]`,N="vec4 ";else if(U.MRT&&U.SHADERS_3_0)n.set(M,`layout(location = ${b}) out vec4 ${M};
`);else throw new Error(`Could not generate a proper output declaration for the fragment shader output: ${M}`);else N="vec4 ";return`${N}${M}${l}`}else throw new Error("Output in a shader requires an identifier ${out: <name required>}")}return`\${${E}}`},onMain(E,S){return!T&&E&&(E.match("gl_FragColor")?(h.push(p.outputType),U.MRT&&(U.SHADERS_3_0?(n.set("_FragColor",`layout(location = ${b}) out vec4 _FragColor;
`),E=E.replace(/gl_FragColor/g,"_FragColor")):(E=E.replace(/gl_FragColor\s+=/,`vec4 _FragColor = gl_FragData[${b}] =`),E=E.replace(/gl_FragColor\s+=/g,`_FragColor = gl_FragData[${b}] =`),E=E.replace(/gl_FragColor/g,"_FragColor"))),u.add("_FragColor")):h.push(ge.NONE)),o+=`
${(S||"").trim()}`,c+=`
  ${(E||"").trim()}`,(E||"").trim()}})}),{output:`${o}
void main() {
${c}
}`,outputNames:Array.from(u.values()),outputTypes:h}}static mergeOutputFragmentShaderForColor(e,n){if(n.length>1||n[0]!==ge.COLOR)throw new Error("Merging fragment shaders for only COLOR output is only valid when the view has a single COLOR output target.");Gn(e)&&(e=[{outputType:ge.COLOR,source:e}]);let i="",r="";const s=new Set,a=[];return e.some(o=>{const c=o.outputType===ge.COLOR;let l=!1;return c&&a.push(ge.COLOR),gi({shader:$a(o.source),onToken(u){const h=u.trim();if(h.indexOf(Ha)===0){if(l)throw console.error("Found multiple ${out} tokens in a single fragment shader. This is not supported nor logical","If you need to use the declared output multiple times, use the assigned name","and don't wrap it repeatedly in the shader.","eg-","void main() {","  ${out: myOutput} = value;","  vec4 somethingElse = myOutput;","}"),new Error("Invalid Shader Format");l=!0;const f=h.substr(Ha.length).trim();if(f[0]===Qa){const p=f.substr(Qa.length).trim();if(!p)throw new Error("Output in a shader requires an identifier ${out: <name required>}");if(s.has(p))throw new Error("You can not declare the same output name in subsequent fragment shader outputs");if(p==="gl_FragColor")throw new Error("DO not use gl_FragColor as an identifier for an out. Choose something not used by the WebGL spec.");return c?(s.add("gl_FragColor"),p!=="gl_FragColor"?`vec4 ${p} = gl_FragColor`:"gl_FragColor"):`vec4 ${p}`}}return`\${${u}}`},onMain(u,h){return r+=`
${(h||"").trim()}`,i+=`
  ${(u||"").trim()}`,(u||"").trim()}}),!!c}),{output:`${r}
void main() {
${i}
}`,outputNames:Array.from(s.values()),outputTypes:a}}static makeOutputFragmentShader(e,n,i,r){if(!i||Gn(i))if(Gn(r)){const s=this.mergeOutputFragmentShaderForColor([{source:r,outputType:ge.COLOR}],[ge.COLOR]);return{source:s.output,outputTypes:[ge.COLOR],outputNames:s.outputNames}}else if(Array.isArray(r)){const s=r.find(c=>c.outputType===ge.COLOR);let a=-1;s?a=r.indexOf(s):a=r.length-1;const o=this.mergeOutputFragmentShaderForColor(r.slice(0,a+1),[ge.COLOR]);return{source:o.output,outputNames:o.outputNames,outputTypes:[ge.COLOR]}}else return null;else if(Array.isArray(i)){if(!U.MRT)throw new Error("Multiple Render Targets were specified, but are not natively supported by user's hardware! MRT also does not have a fallback in deltav yet!");const s=i.map(a=>a.outputType);if(Array.isArray(r)){const a=new Map;for(let o=0,c=i.length;o<c;++o){const l=i[o];for(let u=0,h=r.length;u<h;++u)if(r[u].outputType===l.outputType){a.set(l.outputType,u);break}}if(U.MRT){let o=-1;const c=[];if(a.forEach((u,h)=>{c.push(h),o=Math.max(u,o)}),o===-1)return null;const l=this.mergeFragmentOutputsForMRT(e,n,r.slice(0,o+1),s,c);return{source:l.output,outputNames:l.outputNames,outputTypes:l.outputTypes}}else throw new Error("Fragment shader generation not supported for MRT systems on non MRT hardware...yet")}else if(i.find(o=>o.outputType===ge.COLOR)&&r){const o=this.mergeFragmentOutputsForMRT(e,n,[{source:r,outputType:ge.COLOR}],s);return{source:o.output,outputNames:o.outputNames,outputTypes:o.outputTypes}}}return null}process(e,n,i,r,s,a,o){try{if(!e.surface.gl)return console.warn("No WebGL context available for layer!"),null;const c=this.processImports(e,n,i);if(!c)return null;const{vertexAttributes:l,instanceAttributes:u,uniforms:h}=$f(e.surface.gl,e,n,s,o,c);e.getLayerBufferType(e.surface.gl,l,u),this.metricsProcessing.process(u,h);let f="",p="",m="";const v={uniforms:[]},T=r.vs||new Map,b=r.fs||new Map,E=r.destructure||new Map;for(let V=0,ae=s.length;V<ae;++V){const Z=s[V],ne=Z.processHeaderInjection(G.VERTEX,T,e,this.metricsProcessing,l,u,h);f+=ne.injection,ne.material&&(v.uniforms=v.uniforms.concat(ne.material.uniforms||[])),m+=Z.processAttributeDestructuring(e,E,this.metricsProcessing,l,u,h)}let S="";T.forEach(V=>{S+=V}),f=S+f,S="",E.forEach(V=>{S+=V}),m=S+m;const I=this.processExtensions(),M=`precision highp float;

`,N=I+M+f+c.vs;let x={[Yf.attributes]:m},P=!1;const te=gi({options:x,required:void 0,shader:N,onToken(V,ae){return V===Yf.attributes&&(P=!0),ae},onMain(V){return P?V||"":V===null?(console.warn("The body of void main() could not be determined."),""):`${m}
${V}`}});return c.fs.forEach((V,ae)=>{x={},p="",S="";const Z=b.get(ae)||new Map;for(let ee=0,D=s.length;ee<D;++ee){const ve=s[ee].processHeaderInjection(G.FRAGMENT,Z,e,this.metricsProcessing,l,u,h);if(p+=ve.injection,ve.material){const _=new Set;v.uniforms.forEach(L=>_.add(L.name)),v.uniforms.forEach(L=>{_.has(L.name)||v.uniforms.push(L)})}}Z.forEach(ee=>{S+=ee}),p=S+p;const ne=I+M+p+V.source,re=gi({options:x,required:void 0,shader:ne});V.source=re.shader.trim();for(let ee=0,D=a.length;ee<D;++ee){const Ee=a[ee];te.shader=Ee.vertex(te.shader),V.source=Ee.fragment(V.source)}}),{fs:c.fs,materialUniforms:v.uniforms,maxInstancesPerBuffer:this.metricsProcessing.maxInstancesPerUniformBuffer,modules:Array.from(c.shaderModuleUnits),vs:te.shader.trim(),vertexAttributes:l,instanceAttributes:u,uniforms:h}}catch(c){return c instanceof Error&&(console.warn("An unknown error occurred while processing the shaders for layer:",e.id),console.warn("Error:"),console.warn(c&&(c.stack||c.message))),null}}processExtensions(){let e="";return U.SHADERS_3_0&&(e+="#version 300 es"),U.MRT_EXTENSION&&(e+="#extension GL_EXT_draw_buffers : require"),e&&(e+=`

`),e}processImports(e,n,i){const r=new Set;let s=e.baseShaderModules(n);e.props.baseShaderModules&&(s=e.props.baseShaderModules(n,s));const a=tt.process(e.id,n.vs,G.VERTEX,s.vs);if(a.errors.length>0)return console.warn("Error processing imports for the vertex shader of layer:",e.id,"Errors",...a.errors.reverse()),null;const o=new Map;return i.forEach((c,l)=>{const u=tt.process(e.id,c.source,G.FRAGMENT,s.fs);if(u.errors.length>0){console.warn("Error processing imports for the fragment shader of layer:",e.id,"Errors",...u.errors.reverse());return}u.shaderModuleUnits.forEach(f=>r.add(f));const h={source:u.shader||"",outputTypes:c.outputTypes,outputNames:c.outputNames};o.set(l,h)}),a.shaderModuleUnits.forEach(c=>r.add(c)),{fs:o,vs:a.shader||"",shaderModuleUnits:r}}}class Kf{constructor(e){this.isMouseOver=new Set,this.isMouseDown=new Set,this.isTouchOver=new Map,this.isTouchDown=new Map,this.layer=e}getColorPickInstance(e){return this.colorPicking&&this.layer.picking.type===oe.SINGLE&&this.colorPicking.view===e?this.layer.uidToInstance.get(16777215-this.colorPicking.nearestColor):null}handleMouseOver(e,n){}handleTouchOver(e,n,i){}handleMouseDown(e,n){if(this.layer.picking&&this.layer.picking.type!==oe.NONE){const{onMouseDown:i}=this.layer.props;if(i){const r=e.projection.screenToWorld(n.screen.position),s=[];if(this.layer.picking.type===oe.SINGLE){const o=this.getColorPickInstance(e);o&&s.push(o)}const a={interaction:n,instances:s,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:r};i(a),this.isMouseDown.clear(),s.forEach(o=>this.isMouseDown.add(o))}}}handleTouchDown(e,n,i){const{onTouchDown:r,onTouchOver:s}=this.layer.props;if(!this.layer.picking||this.layer.picking.type===oe.NONE||!r&&!s)return;const a=e.projection.screenToWorld(i.screen.position),o=[];if(this.layer.picking.type===oe.SINGLE){const h=this.getColorPickInstance(e);h&&o.push(h)}const c={interaction:n,touch:i,instances:o,layer:this.layer.id,projection:e.projection,screen:i.screen.position,world:a},l=pi(this.isTouchDown,i.touch.touch.identifier,()=>new Set),u=pi(this.isTouchOver,i.touch.touch.identifier,()=>new Set);o.forEach(h=>{l.add(h),u.add(h)}),s&&s(c),r&&r(c)}handleMouseOut(e,n){if(this.layer.picking&&this.layer.picking.type!==oe.NONE){const{onMouseOut:i}=this.layer.props;if(i){const r=e.projection.screenToWorld(n.screen.position),s={interaction:n,instances:Array.from(this.isMouseOver.keys()),layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:r};i(s)}}this.isMouseOver.clear()}handleTouchOut(e,n,i){const{onTouchOut:r}=this.layer.props;if(!this.layer.picking||this.layer.picking.type===oe.NONE||!r)return;const s=e.projection.screenToWorld(i.screen.position),a={interaction:n,touch:i,instances:Array.from(this.isMouseOver.keys()),layer:this.layer.id,projection:e.projection,screen:i.screen.position,world:s};r(a),this.isTouchOver.delete(i.touch.touch.identifier)}handleMouseUp(e,n){const{onMouseUp:i,onMouseUpOutside:r}=this.layer.props;if(!this.layer.picking||this.layer.picking.type===oe.NONE||!i)return;const s=e.projection.screenToWorld(n.screen.position),a=[];if(this.layer.picking.type===oe.SINGLE){const c=this.getColorPickInstance(e);c&&a.push(c)}let o={interaction:n,instances:a,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:s};i(o),a.forEach(c=>this.isMouseDown.delete(c)),!(this.isMouseDown.size<=0||!r)&&(o={interaction:n,instances:Array.from(this.isMouseDown.values()),layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:s},r(o))}handleTouchUp(e,n,i){const{onTouchUp:r,onTouchUpOutside:s,onTouchOut:a,onTouchAllEnd:o}=this.layer.props;if(!this.layer.picking||this.layer.picking.type===oe.NONE||!r&&!s&&!a&&!o)return;const c=e.projection.screenToWorld(i.screen.position),l=[];if(this.layer.picking.type===oe.SINGLE){const f=this.getColorPickInstance(e);f&&l.push(f)}let u={interaction:n,touch:i,instances:l,layer:this.layer.id,projection:e.projection,screen:i.screen.position,world:c};a&&a(u),r&&r(u);const h=Pa(this.isTouchDown,i.touch.touch.identifier,new Set);l.forEach(f=>h.delete(f)),h.size>0&&s&&(u={interaction:n,touch:i,instances:Array.from(h.values()),layer:this.layer.id,projection:e.projection,screen:i.screen.position,world:c},s(u)),this.isTouchDown.delete(i.touch.touch.identifier),this.isTouchDown.size<=0&&o&&(u={interaction:n,touch:i,instances:[],layer:this.layer.id,projection:e.projection,screen:i.screen.position,world:c},o(u))}handleMouseMove(e,n){const{onMouseOver:i,onMouseMove:r,onMouseOut:s}=this.layer.props;if(this.layer.picking&&this.layer.picking.type!==oe.NONE&&(i||r||s)){let a;const o=e.projection.screenToWorld(n.screen.position),c=[];if(this.layer.picking.type===oe.SINGLE){const u=this.getColorPickInstance(e);u&&c.push(u)}const l=new Set;if(c.forEach(u=>l.add(u)),s){const u=[];this.isMouseOver.forEach(h=>{l.has(h)||u.push(h)}),a={interaction:n,instances:u,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:o},u.length>0&&s(a)}if(i){const u=c.filter(h=>!this.isMouseOver.has(h));a={interaction:n,instances:u,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:o},u.length>0&&i(a)}r&&(a={interaction:n,instances:c,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:o},r(a)),this.isMouseOver=l}}handleTouchMove(e,n,i){const{onTouchOver:r,onTouchMove:s,onTouchOut:a}=this.layer.props;if(this.layer.picking&&this.layer.picking.type!==oe.NONE&&(r||s||a)){let o;const c=e.projection.screenToWorld(i.screen.position),l=[];if(this.layer.picking.type===oe.SINGLE){const f=this.getColorPickInstance(e);f&&l.push(f)}const u=Pa(this.isTouchOver,i.touch.touch.identifier,new Set),h=new Set;if(l.forEach(f=>h.add(f)),a){const f=[];u.forEach(p=>{h.has(p)||f.push(p)}),o={interaction:n,touch:i,instances:f,layer:this.layer.id,projection:e.projection,screen:i.screen.position,world:c},f.length>0&&a(o)}if(r){const f=l.filter(p=>!u.has(p));o={interaction:n,touch:i,instances:f,layer:this.layer.id,projection:e.projection,screen:i.screen.position,world:c},f.length>0&&r(o)}s&&(o={interaction:n,touch:i,instances:l,layer:this.layer.id,projection:e.projection,screen:i.screen.position,world:c},s(o)),this.isMouseOver=h}}handleMouseClick(e,n){if(this.layer.picking&&this.layer.picking.type!==oe.NONE){const{onMouseClick:i}=this.layer.props;if(i){const r=e.projection.screenToWorld(n.screen.position),s=[];if(this.layer.picking.type===oe.SINGLE){const o=this.getColorPickInstance(e);o&&s.push(o)}const a={interaction:n,instances:s,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:r};i(a)}}}handleTap(e,n,i){if(this.layer.picking&&this.layer.picking.type!==oe.NONE){const{onTap:r}=this.layer.props;if(r){const s=e.projection.screenToWorld(i.screen.position),a=[];if(this.layer.picking.type===oe.SINGLE){const c=this.getColorPickInstance(e);c&&a.push(c)}const o={interaction:n,touch:i,instances:a,layer:this.layer.id,projection:e.projection,screen:i.screen.position,world:s};r(o)}}}handleMouseDrag(e,n){}}const Cl=Ke("performance"),Zf=class extends Hi{constructor(t,e,n){super(n),this.animationEndTime=0,this.isAnimationContinuous=!1,this.depth=0,this._easingManager={easingComplete:new lt,complete:()=>this._easingManager.easingComplete.promise},this.lastFrameTime=0,this.needsViewDrawn=!1,this.picking={currentPickMode:oe.NONE,type:oe.SINGLE,uidToInstance:new Map},this.resource=Ef,this.shaderIOInfo={},this.streamChanges={locked:!1,streamIndex:0},this._uid=K(),this.uidToInstance=new Map,this.willRebuildLayer=!1,this.surface=t,this.scene=e,this.props=Object.assign({},Zf.defaultProps||{},n)}get bufferManager(){return this._bufferManager}get bufferType(){return this._bufferType||Qe.INSTANCE_ATTRIBUTE}get easingManager(){return this._easingManager}get uid(){return this._uid}static createRef(){return{easing:null}}validateShaderIO(t){if(!t)return this.picking&&(this.picking.type=oe.NONE),Cl("Shell layer initialized. Nothing will be rendered for this layer",this.id),!0;if(!t.fs||!t.vs)return console.warn("Layer needs to specify the fragment and vertex shaders:",this.id),!1}cleanShaderIOElements(t){t.instanceAttributes=(t.instanceAttributes||[]).filter(Xe),t.vertexAttributes=(t.vertexAttributes||[]).filter(Xe),t.uniforms=(t.uniforms||[]).filter(Xe)}checkForDuplicateOutputTypes(t){let{mapOutput:e}=this.props;Gn(t.fs)&&(t.fs=[{outputType:ge.COLOR,source:t.fs}]),e=e||{};const n=new Set;let i=!1,r=Number.MIN_SAFE_INTEGER;for(let s=0,a=t.fs.length;s<a;++s){const o=t.fs[s],c=e[o.outputType];if(c===void 0){n.has(o.outputType)&&(i=!0),n.add(o.outputType);continue}c===ge.NONE?o.outputType=r++:o.outputType=c,n.has(o.outputType)&&(i=!0),n.add(o.outputType)}if(i)return console.warn("Layer has duplicate fragment shader output types"),!1}processFragmentShadersForEachView(t,e){Gn(t.fs)&&(t.fs=[{outputType:ge.COLOR,source:t.fs}]);const n=this.picking.type===oe.SINGLE&&!t.fs.find(a=>a.outputType===ge.PICKING);if(this.picking.type===oe.SINGLE&&!n)throw new Error("Do NOT specify picking prop on a layer when you have your own Picking output declared.");const i={outputType:ge.PICKING,source:i0},r=new Map,s={fs:new Map,vs:new Map,destructure:new Map};for(let a=0,o=e.length;a<o;++a){const c=e[a];if(n){const p=t.fs.findIndex(m=>m.outputType===ge.PICKING);p>-1&&t.fs.splice(p,1)}const l=c.getOutputTargets();let u=0;t.fs.forEach((p,m)=>{l!=null&&l.find(v=>v.outputType===p.outputType)&&(u=m)}),n&&t.fs.splice(u+1,0,i);let h=pi(s.fs,c,new Map);h||(h=new Map,s.fs.set(c,h));const f=qf.makeOutputFragmentShader(s.vs,h,l,t.fs);if(!f)return console.warn("Could not generate output fragment shaders for the view specified."),!1;r.set(c,f)}return{outputFragmentShaders:r,declarations:s}}processLayerShaders(t,e,n){let i=null;if(i=new qf().process(this,t,e,n,this.surface.getIOExpanders(),this.surface.getShaderTransforms(),this.surface.getIOSorting()),!i)return console.warn("The shader processor did not produce metrics for the layer."),!1;this.shaderIOInfo=Object.assign({activeAttribute:{name:"active",size:k.ONE,update:r=>[r.active?1:0]},instanceAttributes:i.instanceAttributes,instanceVertexCount:t.vertexCount,vs:i.vs,fs:i.fs,materialUniforms:i.materialUniforms,maxInstancesPerBuffer:i.maxInstancesPerBuffer,drawMode:t.drawMode||d.GLSettings.Model.DrawMode.TRIANGLE_STRIP,uniforms:i.uniforms,vertexAttributes:i.vertexAttributes},this.shaderIOInfo)}processVertexAttributes(t){Rf(this,this.shaderIOInfo.maxInstancesPerBuffer,this.shaderIOInfo.vertexAttributes,t.vertexCount)}init(t){if(!this.surface.gl)return console.warn("The layer's surface does not have a valid WebGL context."),!1;const{picking:e=oe.NONE}=this.props;e===oe.SINGLE?this.picking={currentPickMode:oe.NONE,type:oe.SINGLE,uidToInstance:new Map}:this.picking={currentPickMode:oe.NONE,type:oe.NONE},this.resource=this.surface.resourceManager;const n=this.initShader();this.interactions=new Kf(this);const i=this.validateShaderIO(n);if(i!==void 0)return i;if(!n)return!1;let r;return r=this.cleanShaderIOElements(n),ai(r)||(r=this.checkForDuplicateOutputTypes(n),ai(r))||(r=this.processFragmentShadersForEachView(n,t),ai(r))||(r=this.processLayerShaders(n,r.outputFragmentShaders,r.declarations),ai(r))||(r=this.processVertexAttributes(n),ai(r))||(r=this.makeLayerBufferManager(this.surface.gl,this.scene),ai(r))||(r=this.updateDiffHandlers(),ai(r))?r:(this.layerShaderDebugging(),this.props.ref&&(this.props.ref.easing=this.easingManager),!0)}layerShaderDebugging(){this.props.printShader&&(console.warn(`Layer: ${this.props.key}`,`
Shader Configuration:`,this.shaderIOInfo),console.warn(`VERTEX SHADER
`),console.warn(`
${this.shaderIOInfo.vs}`),this.shaderIOInfo.fs.forEach((t,e)=>{console.warn(`FRAGMENT SHADER:
`,`view: ${e.id}):
Output Targets${JSON.stringify(t.outputNames)}
${JSON.stringify(t.outputTypes)}
`),console.warn(`
${t.source}`)}))}baseShaderModules(t){const e=[],n=[];return e.push("instancing"),this.picking.type===oe.SINGLE&&e.push("picking"),(t.instanceAttributes||[]).find(r=>!!(r&&r.easing))&&e.push("frame"),{fs:n,vs:e}}childLayers(){return[]}destroy(){this.bufferManager&&(this.bufferManager.scene&&this.bufferManager.scene.removeLayer(this),this.bufferManager.removeFromScene(),this.bufferManager.destroy())}didUpdateProps(){}draw(){this.updateStreamLock();const t=this.getChangeList();t.length>0&&(this.needsViewDrawn=!0);let e,n,i;const r=this.diffManager;if(!r||!this.bufferManager)return;const s=r.processing,a=r.processor;if(!a){console.warn("A layer is atttempting to draw without a diff processor for analyzing changes.");return}a.incomingChangeList(t),this.bufferManager.incomingChangeList(t);for(let o=0,c=t.length;o<c;++o)e=t[o],n=e[0],i=this.bufferManager.getBufferLocations(n),s==null||s[e[1]](a,n,Object.values(e[2]),i),n.changes={};a.commit(),this.bufferManager.changesProcessed(),this.updateEasingManager(),this.updateUniforms()}updateEasingManager(){if(this.props.streamChanges){if(!this.streamChanges.stream||this.streamChanges.stream.length<=0){const t=this._easingManager.easingComplete;this._easingManager.easingComplete=new lt,Vn(()=>{t.resolve()},this.animationEndTime-this.surface.frameMetrics.currentTime)}}else{const t=this._easingManager.easingComplete;this._easingManager.easingComplete=new lt,Vn(()=>{t.resolve()},this.animationEndTime-this.surface.frameMetrics.currentTime)}}getNextStreamChanges(){let t;const{streamChanges:e={count:1e4,strategy:la.LINEAR}}=this.props,{stream:n=[],streamIndex:i}=this.streamChanges;switch(e.count===void 0&&(e.count=1e4),e.count<=0&&(e.count=Number.MAX_SAFE_INTEGER),e.strategy){case la.LINEAR:default:{t=n.slice(i,i+e.count),this.streamChanges.streamIndex+=e.count;break}}return this.streamChanges.stream&&this.streamChanges.streamIndex>=this.streamChanges.stream.length&&delete this.streamChanges.stream,t}updateStreamLock(){this.streamChanges.locked=!!(this.streamChanges.stream&&this.streamChanges.streamIndex<this.streamChanges.stream.length)}getChangeList(){let t;return this.streamChanges.locked?t=this.getNextStreamChanges():this.props.streamChanges?(this.streamChanges.streamIndex=0,this.streamChanges.locked=!0,this.streamChanges.stream=this.props.data.changeList,t=[],this.props.data.resolve(this.id)):(t=this.props.data.changeList,this.props.data.resolve(this.id)),this.updateStreamLock(),t}getInstanceObservableIds(t,e){const n={};for(let i=0,r=e.length;i<r;++i){ft.setObservableMonitor(!0),t[e[i]];const s=ft.getObservableMonitorIds(!0);s[0]!==void 0&&(n[e[i]]=s[0])}return ft.setObservableMonitor(!1),n}getMaterialOptions(){return{}}initShader(){return{fs:"${import: no-op}",instanceAttributes:[],uniforms:[],vertexAttributes:[],vertexCount:0,vs:"${import: no-op}"}}managesInstance(t){return Xe(this.bufferManager)&&this.bufferManager.managesInstance(t)}getLayerBufferType(t,e,n){let i=Qe.UNIFORM,r=0;if(this._bufferType!==void 0)return this._bufferType;if(U.HARDWARE_INSTANCING){for(let s=0,a=e.length;s<a;++s){const o=e[s];r+=Math.ceil(o.size/4)}for(let s=0,a=n.length;s<a;++s){const o=n[s];r+=Math.ceil(Qu[o.size||1]/4)}if(r>U.MAX_VERTEX_ATTRIBUTES){r=0;for(let s=0,a=n.length;s<a;++s){const o=n[s];r=Math.max(r,o.block||0)}for(let s=0,a=e.length;s<a;++s){const o=e[s];r+=Math.ceil(o.size/4)}r<U.MAX_VERTEX_ATTRIBUTES&&(i=Qe.INSTANCE_ATTRIBUTE_PACKING,Cl(`Performance Issue (Moderate):
            Layer %o is utilizing too many vertex attributes and is now using vertex packing.
            Max Vertex units %o
            Used Vertex units %o
            Instance Attributes %o
            Vertex Attributes %o`,this.id,U.MAX_VERTEX_ATTRIBUTES,r,n,e))}else i=Qe.INSTANCE_ATTRIBUTE}return i===Qe.UNIFORM&&(Cl(`Performance Issue (High):
        Layer %o is utilizing too many vertex attributes and is now using a uniform buffer.
        Max Vertex units %o
        Used Vertex units %o
        Instance Attributes %o
        Vertex Attributes %o`,this.id,U.MAX_VERTEX_ATTRIBUTES,r,n,e),i=Qe.UNIFORM),this.setBufferType(i),i}makeLayerBufferManager(t,e){switch(this.getLayerBufferType(t,this.shaderIOInfo.vertexAttributes,this.shaderIOInfo.instanceAttributes)){case Qe.INSTANCE_ATTRIBUTE:{this.setBufferManager(new Nf(this,e));break}case Qe.INSTANCE_ATTRIBUTE_PACKING:{this.setBufferManager(new Pf(this,e));break}default:{this.setBufferManager(new Ff(this,e));break}}}updateDiffHandlers(){(this.shaderIOInfo.instanceAttributes||[]).find(e=>!!(e&&e.easing))?this.picking.type===oe.SINGLE?(this.onDiffAdd=this.handleDiffAddWithPickingAndEasing,this.onDiffRemove=this.handleDiffRemoveWithPickingAndEasing):(this.onDiffAdd=this.handleDiffAddWithEasing,this.onDiffRemove=this.handleDiffRemoveWithEasing):this.picking.type===oe.SINGLE&&(this.onDiffAdd=this.handleDiffAddWithPicking,this.onDiffRemove=this.handleDiffRemoveWithPicking)}handleDiffAddWithEasing(t){t.easingId=this.easingId}handleDiffAddWithPicking(t){this.uidToInstance.set(t.uid,t)}handleDiffAddWithPickingAndEasing(t){this.uidToInstance.set(t.uid,t),t.easingId=this.easingId}handleDiffRemoveWithEasing(t){t.easing&&delete t.easing,delete t.easingId}handleDiffRemoveWithPicking(t){this.uidToInstance.delete(t.uid)}handleDiffRemoveWithPickingAndEasing(t){this.uidToInstance.delete(t.uid),t.easing&&delete t.easing,delete t.easingId}rebuildLayer(){if(this.willRebuildLayer=!0,this.children)for(let t=0,e=this.children.length;t<e;++t)this.children[t].rebuildLayer()}resolveChanges(t){const e=this.props.data.changeList;e.length>0&&(this.needsViewDrawn=!0),t||this.props.data.resolve(this.id);for(let n=0,i=e.length;n<i;++n)e[n][0].changes={};return e}setBufferManager(t){this._bufferManager?console.warn("You can not change a layer's buffer strategy once it has been instantiated."):(this._bufferManager=t,this.diffManager=new av,this.diffManager.makeProcessor(this,t))}setBufferType(t){this._bufferType===void 0?this._bufferType=t:console.warn("You can not change a layers buffer strategy once it has been instantiated.")}shouldDrawView(t,e){for(const n in e)if(e[n]!==t[n])return!0;return!1}updateUniforms(){let t,e;for(let n=0,i=this.shaderIOInfo.uniforms.length;n<i;++n)t=this.shaderIOInfo.uniforms[n],e=t.update(t),t.materialUniforms.forEach(r=>r.value=e)}willUpdateProps(t){t.picking!==this.props.picking&&this.rebuildLayer(),t.ref!==this.props.ref&&this.props.ref&&(this.props.ref.easing=this.easingManager)}};let Qn=Zf;Qn.defaultProps={};const Jf=Ke("performance");class Xa extends Hi{constructor(e,n){super(n),this.container=new ha,this.surface=e,this.init(n)}get layers(){return this.layerDiffs.items}get views(){return this.viewDiffs.items}init(e){if(!this.surface||!this.surface.gl)return;this.container=new ha;const n=bf(this.surface.gl);this.layerDiffs=new As({buildItem:async i=>{if(Jf("Building layer",i.key),!this.surface)return null;const r=i.init[0],s=i.init[1],a=new r(this.surface,this,Object.assign({},r.defaultProps,s));if(a.initializer=i,a.props.data.sync(),a.parent=s.parent,s.parent&&(s.parent.children?s.parent.children.push(a):s.parent.children=[a]),!a.init(this.views))return console.warn("Error initializing layer:",s.key,"A layer was unable to be added to the surface. See previous warnings (if any) to determine why they could not be instantiated"),null;const o=a.childLayers();return this.layerDiffs.inline(o),a},destroyItem:async(i,r)=>(Jf("Destroying layer",i.key),r.destroy(),!0),updateItem:async(i,r)=>{const s=i.init[1];if(r.willUpdateProps(s),s.data!==r.props.data&&s.data.sync(),r.shouldDrawView(r.props,s)&&(r.needsViewDrawn=!0),Object.assign(r.props,s),r.initializer.init[1]=r.props,r.didUpdateProps(),s.parent&&r.parent&&r.parent!==s.parent){const a=r.parent.children||[],o=a.indexOf(r)||-1;o>-1&&a.splice(o,1)}r.parent=s.parent,r.willRebuildLayer?(this.layerDiffs.rebuild(),r.willRebuildLayer=!1):this.layerDiffs.inline(r.childLayers())}}),this.viewDiffs=new As({buildItem:async i=>{if(!this.surface)return null;const r=new i.init[0](this,i.init[1]);return r.props.camera=r.props.camera||n.camera,r.pixelRatio=this.surface.pixelRatio,r.resource=this.surface.resourceManager,this.surface.userInputManager.waitingForRender=!0,r},destroyItem:async(i,r)=>!0,updateItem:async(i,r)=>{const s=i.init[1];r.willUpdateProps(s),r.shouldDrawView(r.props,s)&&(r.needsDraw=!0),Object.assign(r.props,s),r.didUpdateProps(),this.surface&&(this.surface.userInputManager.waitingForRender=!0)}}),this.update(e)}destroy(){delete this.container,this.layerDiffs.destroy(),this.viewDiffs.destroy()}removeLayer(e){if(this.layers){const n=this.layers.indexOf(e);if(n>=0){this.layers.splice(n,1);return}}}async update(e){this.order=e.order,await this.viewDiffs.diff(e.views),await this.layerDiffs.diff(e.layers),this.views.forEach(n=>n.createRenderTarget())}}Xa.DEFAULT_SCENE_ID="__default__";var Is=(t=>(t[t.COLOR=1]="COLOR",t[t.DEPTH=2]="DEPTH",t[t.STENCIL=4]="STENCIL",t))(Is||{});function Ll(t,e){const n=Object.assign(e,{key:e.key||"",viewport:e.viewport||{left:0,right:0,top:0,bottom:0}});return{get key(){return e.key||""},init:[t,n]}}const ep=class extends Hi{constructor(t,e){super(e),this.animationEndTime=0,this.depth=0,this.lastFrameTime=0,this.needsDraw=!1,this.optimizeRendering=!1,this._pixelRatio=1,this.scene=t,this.props=Object.assign({},ep.defaultProps||{},e)}get pixelRatio(){return this.props.pixelRatio??this._pixelRatio}set pixelRatio(t){this._pixelRatio=t}get screenBounds(){return this.projection.screenBounds}set screenBounds(t){this.projection.screenBounds=t}get viewBounds(){return this.projection.viewBounds}set viewBounds(t){this.projection.viewBounds=t}get clearFlags(){return this.props.clearFlags||[]}get order(){return this.props.order||0}getOutputTargets(){const{output:t}=this.props;let e=[];return t?(Qi(t.buffers)||Oa(t.buffers)?e=[{outputType:ge.COLOR,resource:t.buffers}]:Object.keys(t.buffers).forEach(n=>{const i=Number.parseFloat(n),r=t.buffers[i];r&&e.push({outputType:i,resource:r})}),e):null}getRenderTargets(){return this.renderTarget?[this.renderTarget]:[]}createRenderTarget(){this.renderTarget&&(Array.isArray(this.renderTarget)?this.renderTarget.forEach(u=>u.dispose()):this.renderTarget.dispose());const{output:t}=this.props,e=this.scene.surface;if(!t||!e)return;const n=new Set;for(let u=0,h=this.scene.layers.length;u<h;++u){const p=this.scene.layers[u].shaderIOInfo.fs.get(this);p&&p.outputTypes.forEach(m=>n.add(m))}const i=new Map,r=new Qn(e,this.scene,{key:"",data:new ke}),s=new pt({}),a=this.getOutputTargets()||[];for(let u=0,h=a.length;u<h;++u){const f=a[u],p=f.resource;if(n.has(f.outputType))if(Qi(p)){const m=Fa({key:f.resource.key});if(this.resource.request(r,s,m),!m.texture)throw console.warn("A view has a RenderTexture output target with key:",f.resource.key,"however, no RenderTexture was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createTexture()"),new Error(`Output target unable to be constructed for view ${this.id}`);i.set(f.outputType,m.texture)}else{const m=ml({key:f.resource.key});if(this.resource.request(r,s,m),!m.colorBuffer)throw console.warn("A view has a ColorBuffer output target with key:",f.resource.key,"however, no ColorBuffer was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createColorBuffer()"),new Error(`Output target unable to be constructed for view ${this.id}`);i.set(f.outputType,m.colorBuffer)}}let o,c;i.forEach(u=>{var h,f,p;if(u instanceof Se){if((o===void 0||c===void 0)&&(o=((h=u.data)==null?void 0:h.width)||0,c=((f=u.data)==null?void 0:f.height)||0),o===0||c===0)throw new Error("RenderTexture for View can NOT have a width or height of zero.");if(((p=u.data)==null?void 0:p.width)!==o||u.data.height!==c)throw new Error("When a view has multiple output targets: ALL RenderTextures and ColorBuffers that a view references MUST have the same dimensions")}else{if((o===void 0||c===void 0)&&(o=u.size[0]||0,c=u.size[1]||0),o===0||c===0)throw new Error("RenderTexture for View can NOT have a width or height of zero.");if(u.size[0]!==o||u.size[1]!==c)throw new Error("When a view has multiple output targets: ALL RenderTextures and ColorBuffers that a view references MUST have the same dimensions")}});let l;if(t.depth)if(Qi(t.depth)){const u=Fa({key:t.depth.key});if(this.resource.request(r,s,u),!u.texture)throw console.warn("A view has a depth buffer output target with key:",t.depth,"however, no RenderTexture was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createTexture()"),new Error(`Output target unable to be constructed for view ${this.id}`);l=u.texture}else if(Oa(t.depth)){const u=ml({key:t.depth.key});if(this.resource.request(r,s,u),!u.colorBuffer)throw console.warn("A view has a depth buffer output target with key:",t.depth.key,"however, no ColorBuffer was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createColorBuffer()"),new Error(`Output target unable to be constructed for view ${this.id}`);l=u.colorBuffer}else l=d.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT16;if(U.MRT){const u=[];i.forEach((h,f)=>u.push({buffer:h,outputType:f})),this.renderTarget=new oi({buffers:{color:u,depth:l},retainTextureTargets:!0})}else throw new Error("MRT for non-MRT systems not supported yet.")}willUseView(){const t=this.getRenderTargets();this.props.screenScale&&(this.projection.screenScale=this.props.screenScale),t.some(n=>n.getBuffers().some(i=>!!i.buffer.destroyed))&&this.createRenderTarget()}shouldDrawView(t,e){for(const n in e)if(e[n]!==t[n])return!0;return!1}willUpdateProps(t){}didUpdateProps(){}};let Cs=ep;Cs.defaultProps={key:"",camera:$n.makeOrthographic(),viewport:{left:0,right:0,top:0,bottom:0}};class tp extends Cs{constructor(){super(new Xa(void 0,{key:"error",layers:[],views:[]}),{key:"error",viewport:{},camera:$n.makeOrthographic()}),this.projection=new fh,this.screenBounds=new ye({x:0,y:0,width:100,height:100})}screenToWorld(e,n){return[0,0]}worldToScreen(e,n){return[0,0]}viewToWorld(e,n){return[0,0]}worldToView(e,n){return[0,0]}fitViewtoViewport(e,n){this.screenBounds=e}}const gv=1e3,mv=200,Xn=new tp;Xn.fitViewtoViewport(new ye({x:0,y:0,width:100,height:100}),new ye({x:0,y:0,width:100,height:100}));function vv(t,e){return e.d&&t.d?e.d.depth-t.d.depth:0}function Ol(t,e){return t.touch.identifier-e.touch.identifier}class np{constructor(e,n,i,r){this.eventManagers=[],this.eventCleanup=[],this._waitingForRender=!0,this.getViewsUnderPosition=s=>{if(!this.quadTree)return[];const a=this.quadTree.query(s);return a.sort(vv),a},this.resize=()=>{this._waitingForRender=!0},this.context=e,this.surface=n,this.setControllers(i),this.addContextListeners(r)}get waitingForRender(){return this._waitingForRender}set waitingForRender(e){if(this._waitingForRender=e,!e){this.quadTree=new Jd(0,0,0,0);const n=this.scenes,i=[];for(let r=0,s=n.length;r<s;++r){const a=n[r];for(let o=0,c=a.views.length;o<c;++o){const l=a.views[o];i.push(l.screenBounds)}}this.quadTree.addAll(i)}}get scenes(){return!this.surface||!this.surface.sceneDiffs?[]:this.surface.sceneDiffs.items}addContextListeners(e){this.addMouseContextListeners(e),this.addTouchContextListeners()}addMouseContextListeners(e){const n=this.context;if(zi(n))return;let i,r=!1;if(e){const s=a=>{const o=en(a,n),c=this.getViewsUnderPosition(o);if(c.length<=0)return;i={canClick:!1,currentPosition:o,deltaPosition:[0,0],previousPosition:o,start:o,startTime:Date.now(),startView:c[0].d,event:a,wheel:this.makeWheel(a),button:-1};const l=this.makeMouseInteraction(i);this.eventManagers.forEach(u=>{u.handleWheel(l)}),a.stopPropagation(),a.preventDefault()};"onwheel"in n&&(n.onwheel=s),"addEventListener"in n&&(n.addEventListener("DOMMouseScroll",s),this.eventCleanup.push(["DOMMouseScroll",s]))}n.onmouseleave=s=>{if(this.waitingForRender||!i)return;const a=en(s,n);i.deltaPosition=$e(a,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=a;const o=this.makeMouseInteraction(i);this.eventManagers.forEach(c=>{c.handleMouseOut(o)})},n.onmousemove=s=>{if(this.waitingForRender)return;const a=en(s,n);if(!i){const c=this.getViewsUnderPosition(a);i={canClick:!1,currentPosition:a,deltaPosition:[0,0],previousPosition:a,start:a,startTime:Date.now(),startView:c[0].d,event:s,wheel:this.makeWheel(),button:-1}}i.deltaPosition=$e(a,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=a,i.canClick=!1;const o=this.makeMouseInteraction(i);this.eventManagers.forEach(c=>{c.handleMouseMove(o)}),r=!0},n.onmousedown=s=>{if(this.waitingForRender)return;const a=en(s,n),o=this.getViewsUnderPosition(a);if(o.length<=0)return;i={canClick:!0,currentPosition:a,deltaPosition:[0,0],previousPosition:a,start:a,startTime:Date.now(),startView:o[0].d,event:s,wheel:this.makeWheel(),button:s.button};const c=this.makeMouseInteraction(i);this.eventManagers.forEach(u=>{u.handleMouseDown(c)}),s.stopPropagation(),document.onmousemove=u=>{if(!i)return;if(!r){const f=en(u,n);i.deltaPosition=$e(f,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=f,i.canClick=!1}const h=this.makeMouseInteraction(i);this.eventManagers.forEach(f=>{f.handleDrag(h)}),u.preventDefault(),u.stopPropagation(),r=!1},document.onmouseup=u=>{document.onmousemove=null,document.onmouseup=null,document.onmouseover=null,i=void 0},document.onmouseover=u=>{if(!i)return;const h=en(u,n);i.deltaPosition=$e(h,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=h;const f=this.makeMouseInteraction(i);this.eventManagers.forEach(p=>{p.handleMouseOver(f)}),u.stopPropagation()},n.onmouseup=u=>{if(!i)return;const h=en(u,n);i.deltaPosition=$e(h,i.currentPosition),i.previousPosition=i.currentPosition,i.currentPosition=h,i.button=u.button;const f=this.makeMouseInteraction(i);this.eventManagers.forEach(p=>{p.handleMouseUp(f)}),i.canClick&&Date.now()-i.startTime<gv&&this.eventManagers.forEach(p=>{p.handleClick(f)}),i=void 0};const l=n;l.onselectstart!==void 0?l.onselectstart=function(){return!1}:n.addEventListener("selectstart",function(){s.preventDefault()})}}addTouchContextListeners(){const e=this.context;if(zi(e))return;const n=new Map,i=new Map;function r(u){return u.map(h=>h.touch)}function s(u){return u.reduce((h,f)=>f.touch.startTime>h.touch.startTime?f:h,u[0])}const a={center:u=>u.length<=0?[0,0]:this.getTouchCenter(r(u)),centerDelta:u=>{if(u.length<=0)return[0,0];const h=r(u),f=this.getTouchCenter(h,m=>m.previousPosition),p=this.getTouchCenter(h);return $e(p,f)},centerStart:u=>{if(u.length<=0)return[0,0];const h=s(u).touch;return this.getTouchCenter(r(u),f=>f===h?f.start:f.startRelative.get(h)||[0,0])},id:u=>r(u).sort(Ol).map(f=>f.touch.identifier).join("_"),rotation:u=>{if(u.length<=0)return 0;const h=r(u),f=this.getTouchCenter(h);return this.getAverageAngle(h,f)},rotationDelta:u=>{if(u.length<=0)return 0;const h=r(u),f=this.getTouchCenter(h,T=>T.previousPosition),p=this.getAverageAngle(h,f,T=>T.previousPosition),m=this.getTouchCenter(h);return this.getAverageAngle(h,m)-p},rotationStart:u=>{if(u.length<=0)return 0;const h=s(u).touch,f=r(u),p=this.getTouchCenter(f,m=>m===h?m.start:m.startRelative.get(h)||[0,0]);return this.getAverageAngle(f,p,m=>m===h?m.start:m.startRelative.get(h)||[0,0])},spread:u=>{if(u.length<=0)return 0;const h=r(u),f=this.getTouchCenter(h);return this.getAverageDistance(h,f)},spreadDelta:u=>{if(u.length<=0)return 0;const h=r(u),f=this.getTouchCenter(h,T=>T.previousPosition),p=this.getAverageDistance(h,f,T=>T.previousPosition),m=this.getTouchCenter(h);return this.getAverageDistance(h,m)-p},spreadStart:u=>{if(u.length<=0)return 0;const h=s(u).touch,f=r(u),p=this.getTouchCenter(f,m=>m===h?m.start:m.startRelative.get(h)||[0,0]);return this.getAverageDistance(f,p,m=>m===h?m.start:m.startRelative.get(h)||[0,0])}};e.ontouchstart=u=>{u.preventDefault(),u.stopPropagation();const h=this.getTouches(u),f=[],p=[];for(let m=0,v=h.length;m<v;++m){const T=h[m],b=n.get(T.identifier);if(b)f.push(b);else{const E=en(T),S=this.getViewsUnderPosition(E);if(S.length<=0)continue;const I=S[0].d,M={canTap:!0,currentPosition:E,deltaPosition:[0,0],startTime:Date.now(),start:E,startView:I,previousPosition:E,startRelative:new Map,touch:T};n.set(T.identifier,M),p.push(M)}}if(p.length>0){const m=p.concat(f),v=[];for(let b=0,E=p.length;b<E;++b){const S=p[b];for(let M=0,N=m.length;M<N;++M){const x=m[M];S!==x&&x.startRelative.set(S,x.currentPosition)}const I=this.makeSingleTouchInteraction(S);v.push(I),i.set(S.touch.identifier,I)}const T={touches:v,allTouches:m.map(b=>i.get(b.touch.identifier)).filter(Xe),multitouch:a};this.eventManagers.forEach(b=>{b.handleTouchDown(T)})}document.ontouchend=m=>{o.call(document,m),document.ontouchend=null,document.ontouchcancel=null,document.ontouchmove=null},document.ontouchcancel=m=>{l.call(document,m),document.ontouchend=null,document.ontouchcancel=null,document.ontouchmove=null},document.ontouchmove=c};const o=e.ontouchend=u=>{u.stopPropagation(),u.preventDefault();const h=this.getTouches(u,"changed"),f=Array.from(i.values()),p=[];for(let m=0,v=h.length;m<v;++m){const T=h[m],b=n.get(T.identifier);if(b){if(b.canTap&&Date.now()-b.startTime<mv){const S={touches:[this.makeSingleTouchInteraction(b)],allTouches:f,multitouch:a};this.eventManagers.forEach(I=>{I.handleTap(S)})}p.push(b),n.delete(T.identifier),i.delete(T.identifier)}}if(p.length>0){const v={touches:p.map(T=>this.makeSingleTouchInteraction(T)),allTouches:f,multitouch:a};this.eventManagers.forEach(T=>{T.handleTouchUp(v)})}},c=e.ontouchmove=u=>{u.stopPropagation(),u.preventDefault();const h=this.getTouches(u),f=[],p=[];for(let m=0,v=h.length;m<v;++m){const T=h[m],b=n.get(T.identifier);if(b){const E=en(T),S=$e(E,b.currentPosition);if(ii(S)<=0){p.push(b),Object.assign(b,{currentPosition:E,deltaPosition:S,previousPosition:b.currentPosition,touch:T});continue}f.push(b),Object.assign(b,{canTap:!1,currentPosition:E,deltaPosition:S,previousPosition:b.currentPosition,touch:T})}}if(f.length>0){const m=f.concat(p),T={touches:f.map(b=>this.makeSingleTouchInteraction(b)),allTouches:m.map(b=>i.get(b.touch.identifier)).filter(Xe),multitouch:a};this.eventManagers.forEach(b=>{b.handleTouchDrag(T)})}},l=e.ontouchcancel=u=>{u.stopPropagation(),u.preventDefault();const h=this.getTouches(u,"changed"),f=Array.from(i.values()),p=[];for(let m=0,v=h.length;m<v;++m){const T=h[m],b=n.get(T.identifier);b&&(p.push(b),n.delete(T.identifier),i.delete(T.identifier))}if(p.length>0){const v={touches:p.map(T=>this.makeSingleTouchInteraction(T)),allTouches:f,multitouch:a};this.eventManagers.forEach(T=>{T.handleTouchCancelled(v)})}}}getAverageDistance(e,n,i){let r=0;if(e.length<=0)return r;i||(i=s=>s.currentPosition);for(let s=0,a=e.length;s<a;++s){const o=e[s];r+=ii($e(i(o),n))}return r/e.length}getAverageAngle(e,n,i){let r=0;if(e.length<=0)return r;i||(i=s=>s.currentPosition);for(let s=0,a=e.length;s<a;++s){const o=e[s],c=$e(i(o),n);let l=Math.atan2(c[1],c[0]);l<0&&(l+=Math.PI*2),r+=l}return r/e.length}getTouchCenter(e,n){let i=[0,0];if(e.length<=0)return i;n||(n=r=>r.currentPosition);for(let r=0,s=e.length;r<s;++r){const a=e[r],o=n(a);i=Fn(i,o)}return He(i,1/e.length)}getTouches(e,n){const i=new Map;if(e.touches&&e.touches.length>0&&(!n||n==="touches"))for(let r=0,s=e.touches.length;r<s;++r){const a=e.touches.item(r);a&&i.set(a.identifier,a)}if(e.changedTouches&&e.changedTouches.length>0&&(!n||n==="changed"))for(let r=0,s=e.changedTouches.length;r<s;++r){const a=e.changedTouches.item(r);a&&i.set(a.identifier,a)}if(e.targetTouches&&e.targetTouches.length>0&&(!n||n==="target"))for(let r=0,s=e.targetTouches.length;r<s;++r){const a=e.targetTouches.item(r);a&&i.set(a.identifier,a)}return Array.from(i.values())}getView(e){const n=this.scenes;for(let i=0,r=n.length;i<r;++i){const a=n[i].viewDiffs.getByKey(e);if(a)return a}return null}makeMouseInteraction(e){const n=this.getViewsUnderPosition(e.currentPosition);let i=n[0]&&n[0].d;i||(i=Xn);const r=this.getViewsUnderPosition(e.start);let s=e.startView;s||(s=Xn);const a={canvas:zi(this.context)?void 0:this.context,mouse:e,screen:{position:e.currentPosition},start:{position:s.projection.screenToView(e.start),view:s,views:r.map(o=>(o.d||(o.d=Xn),{position:o.d.projection.screenToView(e.start),view:o.d}))},target:{position:i.projection.screenToView(e.currentPosition),view:i,views:n.map(o=>(o.d||(o.d=Xn),{position:o.d.projection.screenToView(e.currentPosition),view:o.d}))}};return this.currentInteraction=a,a}makeSingleTouchInteraction(e){const n=e.currentPosition,i=this.getViewsUnderPosition(n);let r=i[0]&&i[0].d;r||(r=Xn);let s=e.startView;s||(s=Xn);const a={canvas:zi(this.context)?void 0:this.context,touch:e,screen:{position:n},start:{position:s.projection.screenToView(e.start),view:s,views:this.getViewsUnderPosition(e.start).map(o=>(o.d||(o.d=Xn),{position:o.d.projection.screenToView(e.start),view:o.d}))},target:{position:r.projection.screenToView(n),view:r,views:i.map(o=>(o.d||(o.d=Xn),{position:o.d.projection.screenToView(n),view:o.d}))}};return this.currentInteraction=a,a}makeMultiTouchInteractions(e,n){e.sort(Ol);const i=this.allTouchCombinations(e);for(let r=0,s=i.length;r<s;++r){const a=i[r],o=a.map(l=>l.touch.identifier).join("_");let c=n.get(o);if(!c){const l=this.getTouchCenter(a);c={touches:a,averageSpreadDelta:0,startCenter:l,currentCenter:l,currentRotation:this.getAverageAngle(a,l),centerDelta:[0,0],rotationDelta:0},n.set(o,c)}}}updateMultiTouchInteractions(e,n){e.sort(Ol);const i=this.allTouchCombinations(e);for(let r=0,s=i.length;r<s;++r){const a=i[r],o=a.map(l=>l.touch.identifier).join("_"),c=n.get(o);if(c){const l=this.getTouchCenter(a),u=this.getAverageAngle(a,l);c.centerDelta=$e(l,c.currentCenter),c.currentCenter=l,c.rotationDelta=u-c.currentRotation,c.currentRotation=u}}}allTouchCombinations(e){const n=[],i=e.length,r=1<<i;for(let s=1;s<r;s++){const a=[];for(let o=0;o<i;o++)s&1<<o&&a.push(e[o]);n.push(a)}return n}makeWheel(e){if(!e)return{delta:[0,0]};const n=Wc(e);return{delta:[n.pixelX,n.pixelY]}}setControllers(e){this.eventManagers=e;for(const n of this.eventManagers)n.setUserInputManager(this)}destroy(){delete this.quadTree,zi(this.context)||(this.context.onmousedown=null,this.context.onmousemove=null,this.context.onmouseleave=null);const e=this.context;e.onmousewheel&&(e.onmousewheel=null),this.eventCleanup.forEach(n=>{this.context.removeEventListener(n[0],n[1])})}}class Nl extends Di{constructor(e,n=!1){super(),this.preserveQueueMouse=[],this.singleQueueMouse=new Map,this.preserveQueueTouch=[],this.singleQueueTouch=new Map,this.preserveEvents=!1,this.handlers=new Fi(e),this.preserveEvents=n}dequeue(){try{this.preserveEvents?(this.preserveQueueMouse.forEach(e=>{e[0](e[1])}),this.preserveQueueTouch.forEach(e=>{e[0](e[1])})):(this.singleQueueMouse.forEach((e,n)=>{n(e)}),this.singleQueueTouch.forEach((e,n)=>{n(e)}))}catch(e){console.error("Queued events had errors. Further events aborted"),e instanceof Error&&console.error(e.stack||e.message)}this.preserveQueueMouse=[],this.singleQueueMouse.clear(),this.preserveQueueTouch=[],this.singleQueueTouch.clear()}handleMouseDown(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseDown,e]):this.singleQueueMouse.set(this.handlers.handleMouseDown,e)}handleMouseUp(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseUp,e]):this.singleQueueMouse.set(this.handlers.handleMouseUp,e)}handleMouseOver(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseOver,e]):this.singleQueueMouse.set(this.handlers.handleMouseOver,e)}handleMouseOut(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseOut,e]):this.singleQueueMouse.set(this.handlers.handleMouseOut,e)}handleMouseMove(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseMove,e]):this.singleQueueMouse.set(this.handlers.handleMouseMove,e)}handleClick(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleClick,e]):this.singleQueueMouse.set(this.handlers.handleClick,e)}handleDrag(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleDrag,e]):this.singleQueueMouse.set(this.handlers.handleDrag,e)}handleWheel(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleWheel,e]):this.singleQueueMouse.set(this.handlers.handleWheel,e)}handleTouchCancelled(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchCancelled,e]):this.singleQueueTouch.set(this.handlers.handleTouchCancelled,e)}handleTouchDown(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchDown,e]):this.singleQueueTouch.set(this.handlers.handleTouchDown,e)}handleTouchUp(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchUp,e]):this.singleQueueTouch.set(this.handlers.handleTouchUp,e)}handleTouchOut(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchOut,e]):this.singleQueueTouch.set(this.handlers.handleTouchOut,e)}handleTouchDrag(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchDrag,e]):this.singleQueueTouch.set(this.handlers.handleTouchDrag,e)}handleTap(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTap,e]):this.singleQueueTouch.set(this.handlers.handleTap,e)}handleDoubleTap(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleDoubleTap,e]):this.singleQueueTouch.set(this.handlers.handleDoubleTap,e)}handleLongTouch(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleLongTouch,e]):this.singleQueueTouch.set(this.handlers.handleLongTouch,e)}handleLongTap(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleLongTap,e]):this.singleQueueTouch.set(this.handlers.handleLongTap,e)}handlePinch(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handlePinch,e]):this.singleQueueTouch.set(this.handlers.handlePinch,e)}handleSpread(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleSpread,e]):this.singleQueueTouch.set(this.handlers.handleSpread,e)}handleTouchRotate(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchRotate,e]):this.singleQueueTouch.set(this.handlers.handleTouchRotate,e)}handleSwipe(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleSwipe,e]):this.singleQueueTouch.set(this.handlers.handleSwipe,e)}}const ip=`vec3 cameraSpace(vec3 world) {
return (world + cameraOffset) * cameraScale2D;
}
vec3 cameraSpaceSize(vec3 worldSize) {
return worldSize * cameraScale2D;
}
vec4 clipSpace(vec3 world) {
return (viewProjection) * vec4(cameraSpace(world), 1.0);
}
vec4 clipSpaceSize(vec3 worldSize) {
return (viewProjection) * vec4(cameraSpaceSize(worldSize), 0.0);
}`,wv=Ta.immediate(0);class Yn{constructor(e,n){this._id=K(),this.animation=Ta.immediate(0),this.animationEndTime=0,this.offsetBroadcastTime=0,this.scaleBroadcastTime=0,this._offset=[0,0,0],this.startOffset=[0,0,0],this.startOffsetTime=0,this.offsetEndTime=0,this._scale=[1,1,1],this.startScale=[1,1,1],this.startScaleTime=0,this.scaleEndTime=0,this.needsBroadcast=!1,this.camera=e,n&&(this._offset=At(n.offset||this._offset),this._scale=At(n.scale||this._scale))}get id(){return this._id}broadcast(e){this.offset,this.scale,this.needsBroadcast&&(this.needsBroadcast=!1,this.onViewChange&&this.onViewChange(this.camera,e))}centerOn(e,n){var o;const i=(o=this.surface)==null?void 0:o.getViewSize(e);if(!i)return;const r=[i.width/2,i.height/2,0],s=Kt(n,Qr(r,this._scale)),a=this.animation;this.setOffset(At(this.offset)),this.animation=wv,this.setOffset(St(s,-1)),this.animation=a}getCurrentTime(){return this.surface?this.surface.frameMetrics.currentTime:0}getOffset(){return this._offset}getScale(){return this._scale}get offset(){const e=this.getCurrentTime();return this.onViewChange&&this.offsetBroadcastTime<this.offsetEndTime&&(this.offsetBroadcastTime=e,this.needsBroadcast=!0),this.animation.cpu(this.startOffset,this._offset,(e-this.startOffsetTime)/this.animation.duration)}setId(e){this._id=e,this.camera.needsViewDrawn=!0}setOffset(e){this.startOffset=At(this.offset),this._offset=At(e),this.startOffsetTime=this.getCurrentTime(),this.offsetEndTime=this.startOffsetTime+this.animation.duration,this.updateEndTime(),this.camera.needsViewDrawn=!0,this.onViewChange&&(this.offsetBroadcastTime=this.startOffsetTime,this.needsBroadcast=!0)}get scale(){const e=this.getCurrentTime();return this.onViewChange&&this.scaleBroadcastTime<this.scaleEndTime&&(this.scaleBroadcastTime=e,this.needsBroadcast=!0),this.animation.cpu(this.startScale,this._scale,(e-this.startScaleTime)/this.animation.duration)}setViewChangeHandler(e){this.onViewChange=e}setScale(e){this.startScale=At(this.scale),this._scale=At(e),this.startScaleTime=this.getCurrentTime(),this.scaleEndTime=this.startScaleTime+this.animation.duration,this.updateEndTime(),this.camera.needsViewDrawn=!0,this.onViewChange&&(this.scaleBroadcastTime=this.startScaleTime,this.needsBroadcast=!0)}resolve(){this.camera.needsViewDrawn=!1,this.needsBroadcast=!1}update(){this.camera.needsViewDrawn=!0}updateEndTime(){this.animationEndTime=Math.max(this.scaleEndTime,this.offsetEndTime)}}class nr extends $n{constructor(e){super({left:-100,right:100,top:-100,bottom:100,near:-100,far:1e5,type:Wn.ORTHOGRAPHIC}),this.control2D=new Yn(this,e)}get control2D(){return this._control2D}set control2D(e){this._control2D=e}get scale2D(){return this.control2D.scale}get offset(){return this.control2D.offset}}class rp{sortInstanceAttributes(e,n){return e.resource&&!n.resource||e.easing&&!n.easing?-1:1}sortVertexAttributes(e,n){return 1}sortUniforms(e,n){return 1}}class sp extends Nl{constructor(){super({handleClick:async e=>{var n,i;this.enablePicking(),await((n=this.willRenderResolver)==null?void 0:n.promise),this.enablePicking(),await((i=this.didRenderResolver)==null?void 0:i.promise),this.handleInteraction(e,(r,s)=>{var a;(a=r.interactions)==null||a.handleMouseClick(s,e)})},handleTap:async e=>{var n,i;this.enablePicking(),await((n=this.willRenderResolver)==null?void 0:n.promise),this.enablePicking(),await((i=this.didRenderResolver)==null?void 0:i.promise),e.touches.forEach(r=>{this.handleInteraction(r,(s,a)=>{var o;(o=s.interactions)==null||o.handleTap(a,e,r)})})},handleDrag:async e=>{var n;await((n=this.willRenderResolver)==null?void 0:n.promise),this.handleInteraction(e,(i,r)=>{var s;(s=i.interactions)==null||s.handleMouseDrag(r,e)})},handleMouseDown:async e=>{var n;this.enablePicking(),await((n=this.willRenderResolver)==null?void 0:n.promise),this.handleInteraction(e,(i,r)=>{var s;return(s=i.interactions)==null?void 0:s.handleMouseDown(r,e)})},handleTouchDown:async e=>{var n;this.enablePicking(),await((n=this.willRenderResolver)==null?void 0:n.promise),e.touches.forEach(i=>{this.handleInteraction(i,(r,s)=>{var a;return(a=r.interactions)==null?void 0:a.handleTouchDown(s,e,i)})})},handleMouseUp:async e=>{var n;await((n=this.willRenderResolver)==null?void 0:n.promise),this.handleInteraction(e,(i,r)=>{var s;return(s=i.interactions)==null?void 0:s.handleMouseUp(r,e)})},handleTouchUp:async e=>{var n;await((n=this.willRenderResolver)==null?void 0:n.promise),e.touches.forEach(i=>{this.handleInteraction(i,(r,s)=>{var a;return(a=r.interactions)==null?void 0:a.handleTouchUp(s,e,i)})})},handleMouseOut:async e=>{var n;await((n=this.willRenderResolver)==null?void 0:n.promise),this.isOver.forEach(i=>{this.handleView(i,(r,s)=>{var a;return(a=r.interactions)==null?void 0:a.handleMouseOut(s,e)})}),this.isOver.clear()},handleTouchOut:async e=>{var n;await((n=this.willRenderResolver)==null?void 0:n.promise),e.touches.forEach(i=>{Pa(this.isTouchOver,i.touch.touch.identifier,new Set).forEach(s=>{this.handleView(s,(a,o)=>{var c;return(c=a.interactions)==null?void 0:c.handleTouchOut(o,e,i)})}),this.isOver.clear()})},handleMouseMove:async e=>{var r;this.enablePicking(),await((r=this.willRenderResolver)==null?void 0:r.promise);const n=this.handleInteraction(e,(s,a)=>{var o;return(o=s.interactions)==null?void 0:o.handleMouseMove(a,e)}),i=new Set;n.forEach(s=>i.add(s)),this.isOver.forEach(s=>{i.has(s)||this.handleView(s,(a,o)=>{var c;return(c=a.interactions)==null?void 0:c.handleMouseOut(o,e)})}),i.forEach(s=>{this.isOver.has(s)||this.handleView(s,(a,o)=>{var c;return(c=a.interactions)==null?void 0:c.handleMouseOver(o,e)})}),this.isOver=i},handleTouchDrag:async e=>{var n;this.enablePicking(),await((n=this.willRenderResolver)==null?void 0:n.promise),e.touches.forEach(i=>{const r=this.handleInteraction(i,(o,c)=>{var l;return(l=o.interactions)==null?void 0:l.handleTouchMove(c,e,i)}),s=new Set;r.forEach(o=>s.add(o));const a=pi(this.isTouchOver,i.touch.touch.identifier,new Set);a.forEach(o=>{s.has(o)||this.handleView(o,(c,l)=>{var u;return(u=c.interactions)==null?void 0:u.handleTouchOut(l,e,i)})}),s.forEach(o=>{a.has(o)||this.handleView(o,(c,l)=>{var u;return(u=c.interactions)==null?void 0:u.handleTouchOver(l,e,i)})}),this.isTouchOver.set(i.touch.touch.identifier,s)})}}),this.isOver=new Set,this.isTouchOver=new Map}get scenes(){return!this.surface||!this.surface.sceneDiffs?[]:this.surface.sceneDiffs.items}enablePicking(){this.surface&&this.surface.enableOptimizedOutput(ge.PICKING)}willRender(){var e;for(let n=0,i=this.scenes.length;n<i;++n){const r=this.scenes[n];for(let s=0,a=r.layers.length;s<a;++s)(e=r.layers[s].interactions)==null||delete e.colorPicking}this.willRenderResolver&&this.willRenderResolver.resolve(),this.willRenderResolver=new lt,this.dequeue()}async didRender(){this.didRenderResolver&&this.didRenderResolver.resolve(),this.didRenderResolver=new lt}getSceneViewsUnderMouse(e){const n=new Map;for(let i=0,r=this.scenes.length;i<r;++i){const s=this.scenes[i];for(let a=0,o=s.views.length;a<o;++a){const c=s.views[a];n.set(c.id,c)}}return e.target.views.map(i=>n.get(i.view.id)).filter(Xe)}handleInteraction(e,n){const i=this.getSceneViewsUnderMouse(e);for(let r=0,s=i.length;r<s;++r){const a=i[r];this.handleView(a,n)}return i}handleView(e,n){for(let i=0,r=e.scene.layers.length;i<r;++i){const s=e.scene.layers[i];s.picking&&s.picking.type!==oe.NONE&&n(s,e)}}}class yv{}class Tv extends yv{vertex(e){let n=$a(e);return U.SHADERS_3_0?(n=n.replace(/\s+varying\s+/g,`
out `),n=n.replace(/(texture2D(\s+)\(|texture2D\()/g,"texture(")):(n=n.replace(/^#version 300 es/g,""),n=n.replace(/\s+out\s+/g,`
varying `)),n}fragment(e){let n=$a(e);if(U.SHADERS_3_0){if(n=n.replace(/\s+varying\s+/g,`
in `),n=n.replace(/(texture2D(\s+)\(|texture2D\()/g,"texture("),n.match(/gl_FragColor/g)&&(n=n.replace(/gl_FragColor/g,"_FragColor"),!n.match("out vec4 _FragColor"))){const i=n.split(`
`);i.splice(3,0,"layout(location = 0) out vec4 _FragColor;"),n=i.join(`
`)}}else n=n.replace(/^#version 300 es/g,""),n=n.replace(/\s+in\s+/g,`
varying `);return n}}function Ev(t,e,n,i,r){const s={view:t,allColors:[],colorData:n,dataHeight:r,dataWidth:i,mouse:e,nearestColor:0,nearestColorBytes:[0,0,0,0]},a=new Map;let o=0;const c=i/2,l=r/2;let u=0,h=[0,0,0,0],f=Number.MAX_SAFE_INTEGER;for(let p=0;p<r;++p)for(let m=0;m<i;++m){const v=n[o],T=n[o+1],b=n[o+2];o+=4;const E=v<<16|T<<8|b;if(a.set(E,!0),E!==0){const S=m-c,I=p-l,M=S*S+I*I;M<f&&(f=M,u=E,h=[v,T,b,255])}}return s.allColors=Array.from(a.keys()),s.nearestColor=u,s.nearestColorBytes=h,s}class bv{constructor(e){this.pickingRenderTargets=new Map,this.surface=e.surface}analyzePickedPixels(e,n){if(n.optimizeRendering)return;const i=jr(He(e,this.surface.pixelRatio),n.projection.screenScale),r=5,s=5,a=4,o=new Uint8Array(r*s*a);this.surface.renderer.readPixels(Math.floor(i[0]-r/2),Math.floor(i[1]-s/2),r,s,o);const c=Ev(n,[i[0]-n.screenBounds.x,i[1]-n.screenBounds.y],o,r,s);for(let l=0,u=n.scene.layers.length;l<u;++l){const h=n.scene.layers[l];h.picking.type===oe.SINGLE&&(h.interactions.colorPicking=c)}}decodePicking(){const e=this.surface.getCurrentInteraction();if(!e)return;const n=e.screen.position,i=e.target.views.map(s=>s.view),r=new Set;this.pickingRenderTargets.forEach((s,a)=>{const o=s.getBuffers()[0].buffer;o instanceof Se&&(!o.gl||o.destroyed)&&(s.dispose(),r.add(a))}),r.forEach(s=>this.pickingRenderTargets.delete(s)),i.forEach(s=>{let a=this.pickingRenderTargets.get(s);if(a||s.getRenderTargets().forEach(l=>{l.gl&&l.getBuffers().forEach(u=>{if(u.outputType===ge.PICKING){if(a=new oi({buffers:{color:u}}),a.width===0||a.height===0){a=void 0;return}this.pickingRenderTargets.set(s,a)}})}),!a)return;const o=this.surface.renderer.state.currentRenderTarget;let c=!1;o?(Array.isArray(o)||o.getBuffers()[0].buffer!==a.getBuffers()[0].buffer)&&(c=!0):c=!0,c&&this.surface.renderer.setRenderTarget(a),this.analyzePickedPixels(n,s)})}}const ap=()=>[new xf,new If,new Sf],op=()=>[{type:xe.COLOR_BUFFER,manager:new qm},{type:xe.TEXTURE,manager:new lf},{type:xe.ATLAS,manager:new cf({})},{type:xe.FONT,manager:new Tf}],cp=()=>[new Tv],_v=[0,0,0,0];function Pl(t,e){return(t.order||Number.MAX_SAFE_INTEGER)-(e.order||Number.MAX_SAFE_INTEGER)}class lp{constructor(e){this.commands=new bv({surface:this}),this.frameMetrics={currentFrame:0,currentTime:Date.now()|0,frameDuration:1e3/60,previousTime:Date.now()|0},this.isBufferingResources=!1,this.ioExpanders=[],this.shaderTransforms=[],this.optimizedOutputs=new Set([ge.PICKING]),this.ioSorting=new rp,this.pixelRatio=window.devicePixelRatio,this.enabledOptimizedOutputs=new Set,this.viewDrawDependencies=new Map,this.resourceDiffs=new As({buildItem:async n=>(await this.resourceManager.initResource(n),{id:n.key}),destroyItem:async(n,i)=>(await this.resourceManager.destroyResource(n),!0),updateItem:async(n,i)=>{await this.resourceManager.updateResource(n)}}),this.sceneDiffs=new As({buildItem:async n=>new Xa(this,{key:n.key,views:n.views,layers:n.layers}),destroyItem:async(n,i)=>(i.destroy(),!0),updateItem:async(n,i)=>{await i.update(n)}}),this.readyResolver=new lt,this.ready=this.readyResolver.promise,e&&this.init(e)}get gl(){return this.context}get scenes(){return this.sceneDiffs.items}broadcastEventManagerCycle(e){for(let n=0,i=this.userInputManager.eventManagers.length;n<i;++n){const r=this.userInputManager.eventManagers[n];switch(e){case 1:r.didRender();break;case 0:r.willRender();break}}}async commit(e,n,i){if(!this.gl)return;let r=!1;n&&this.frameMetrics.currentFrame++,this.frameMetrics.frameDuration=this.frameMetrics.currentTime-this.frameMetrics.previousTime,this.frameMetrics.previousTime=this.frameMetrics.currentTime,e===void 0?this.frameMetrics.currentTime=Date.now()|0:(this.frameMetrics.previousTime===this.frameMetrics.currentTime&&(this.frameMetrics.previousTime=e),this.frameMetrics.currentTime=e),e=this.frameMetrics.currentTime;const s=this.sceneDiffs.items;s.sort(Pl);const a={};for(let c=0,l=s.length;c<l;++c){const u=s[c],h=u.views,f=u.layers;h.sort(Pl),f.sort(Pl);for(let p=0,m=h.length;p<m;++p){const v=h[p],T={};f.length>0&&v.willUseView();const b=this.renderer.getRenderSize();let E=new ye({width:b[0],height:b[1],x:0,y:0});if(v.renderTarget){const N=(Array.isArray(v.renderTarget)?v.renderTarget[0]:v.renderTarget).getSize();E=new ye({width:N[0],height:N[1],x:0,y:0})}const S=Ac(v.props.viewport,E,this.pixelRatio);v.fitViewtoViewport(E,S);for(let M=0,N=f.length;M<N;++M){const x=f[M];x.view=v;try{x.draw(),(x.needsViewDrawn||x.isAnimationContinuous)&&(v.needsDraw=!0),T[x.id]=x,v.animationEndTime=Math.max(v.animationEndTime,x.animationEndTime,v.props.camera.animationEndTime),x.lastFrameTime=e}catch(P){P instanceof Error&&(a[x.id]||(a[x.id]=[x,P]))}}if(v.needsDraw||e&&e<v.lastFrameTime||e&&e<v.animationEndTime||v.props.camera.needsViewDrawn){v.needsDraw=!0,r=!0;const M=this.viewDrawDependencies.get(v);M&&M.forEach(N=>{N.needsDraw=!0})}const I=Object.values(T);f.length!==I.length&&u.layerDiffs.diff(I.map(M=>M.initializer)),u.container&&i&&i(r,u,v)}}const o=Object.values(a);this.printLayerErrors(o)}destroy(){this.resourceManager.destroy(),this.userInputManager.destroy(),this.sceneDiffs.destroy(),this.renderer.dispose(),delete this.context}async draw(e){if(this.gl){this.broadcastEventManagerCycle(0);for(let n=0,i=this.sceneDiffs.items.length;n<i;++n){const r=this.sceneDiffs.items[n];for(let s=0,a=r.views.length;s<a;++s){const o=r.views[s];o.props.camera.broadcast(o.id)}}if(await this.commit(e,!0,(n,i,r)=>{i.container&&n&&this.drawSceneView(i.container,r)}),this.userInputManager.waitingForRender&&(this.userInputManager.waitingForRender=!1),!this.isBufferingResources){this.isBufferingResources=!0;const n=await this.resourceManager.dequeueRequests();this.isBufferingResources=!1,n&&this.draw(await Vn())}for(let n=0,i=this.sceneDiffs.items.length;n<i;++n){const r=this.sceneDiffs.items[n];for(let s=0,a=r.views.length;s<a;++s){const o=r.views[s];o.needsDraw=!1,o.props.camera.resolve()}for(let s=0,a=r.layers.length;s<a;++s){const o=r.layers[s];o.needsViewDrawn=!1}}this.broadcastEventManagerCycle(1),this.enabledOptimizedOutputs.clear()}}drawSceneView(e,n,i,r){i=i||this.renderer;const s={x:n.viewBounds.left,y:n.viewBounds.top},a=n.viewBounds,o=n.props.background||_v,c=n.clearFlags.indexOf(Is.COLOR)>-1,l=r||n.renderTarget||null;n.renderTarget&&(n.getRenderTargets().forEach(h=>this.optimizedOutputs.forEach(f=>h.disabledTargets.add(f))),this.enabledOptimizedOutputs.size>0&&n.getRenderTargets().forEach(f=>this.enabledOptimizedOutputs.forEach(p=>f.disabledTargets.delete(p)))),i.setRenderTarget(l),i.setScissor({x:s.x,y:s.y,width:a.width,height:a.height},l),c&&i.clearColor([o[0],o[1],o[2],o[3]]),i.setViewport({x:s.x,y:s.y,width:a.width,height:a.height}),n.clearFlags&&n.clearFlags.length>0?i.clear(c,n.clearFlags.indexOf(Is.DEPTH)>-1,n.clearFlags.indexOf(Is.STENCIL)>-1):i.clear(!1),i.render(e,l,n.props.glState),n.lastFrameTime=this.frameMetrics.currentTime}fitContainer(e){if(!this.context||zi(this.context.canvas))return;const n=this.context.canvas.parentElement;if(n){const i=this.context.canvas;i.className="",i.setAttribute("style",""),n.style.position="relative",i.style.position="absolute",i.style.left="0xp",i.style.top="0xp",i.style.width="100%",i.style.height="100%",i.setAttribute("width",""),i.setAttribute("height","");const r=n.getBoundingClientRect(),s=i.getBoundingClientRect();this.resize(s.width||100,r.height||100)}}gatherViewDrawDependencies(){if(!this.sceneDiffs)return;this.viewDrawDependencies.clear();const e=this.sceneDiffs.items,n=this.renderer.getRenderSize();for(let i=0,r=e.length;i<r;i++){const s=e[i];for(let a=0,o=s.views.length;a<o;++a){const c=s.views[a];c.willUseView();let l=new ye({width:n[0],height:n[1],x:0,y:0});if(c.renderTarget){const f=(Array.isArray(c.renderTarget)?c.renderTarget[0]:c.renderTarget).getSize();l=new ye({width:f[0],height:f[1],x:0,y:0})}const u=Ac(c.props.viewport,l,this.pixelRatio);c.fitViewtoViewport(l,u),c.props.camera.update(!0)}}for(let i=0,r=e.length;i<r;i++){const s=e[i];for(let a=0,o=s.views.length;a<o;++a){const c=s.views[a],l=[];for(let u=0,h=e.length;u<h;u++)if(u!==i){const f=e[u];for(let p=0,m=f.views.length;p<m;++p){const v=f.views[p];c.viewBounds.hitBounds(v.viewBounds)&&l.push(v)}}this.viewDrawDependencies.set(c,l)}}}getCurrentInteraction(){return this.userInputManager.currentInteraction}getIOExpanders(){return this.ioExpanders}getIOSorting(){return this.ioSorting}getShaderTransforms(){return this.shaderTransforms}getOptimizedOutputs(){return this.enabledOptimizedOutputs}getViewSize(e){for(let n=0,i=this.sceneDiffs.items.length;n<i;++n){const s=this.sceneDiffs.items[n].viewDiffs.getByKey(e);if(s)return s.renderTarget?s.viewBounds:s.screenBounds}return null}getViewWorldBounds(e){for(let n=0,i=this.sceneDiffs.items.length;n<i;++n){const s=this.sceneDiffs.items[n].viewDiffs.getByKey(e);if(s)if(s.screenBounds){const a=s.projection.viewToWorld([0,0]),o=s.projection.screenToWorld([s.screenBounds.right,s.screenBounds.bottom]);return new ye({bottom:o[1],left:a[0],right:o[0],top:a[1]})}else return null}return null}getProjections(e){for(let n=0,i=this.sceneDiffs.items.length;n<i;++n){const s=this.sceneDiffs.items[n].viewDiffs.getByKey(e);if(s)return s.projection}return null}async init(e){var i;if(this.context)return this;this.pixelRatio=e.pixelRatio||this.pixelRatio,this.pixelRatio<1&&(this.pixelRatio=1);const n=this.initGL(e);return n?(this.context=n,this.gl?((i=e.optimizedOutputTargets)==null||i.forEach(r=>this.optimizedOutputs.add(r)),this.initUserInputManager(e),await this.initResources(e),await this.initIOExpanders(e),await this.initShaderTransforms(e)):console.warn("Could not establish a GL context. Layer Surface will be unable to render"),this.readyResolver.resolve(this),this):(this.readyResolver.reject({error:Nc.NO_WEBGL_CONTEXT,message:"Could not establish a webgl context. Surface is being destroyed to free resources."}),this.destroy(),this)}initGL(e){const n=e.context;if(!n)return null;const i=n.width,r=n.height;let s=!0;const a=Object.assign({alpha:!1,antialias:!1,preserveDrawingBuffer:!1,premultiplyAlpha:!1},e.rendererOptions);return this.renderer=new eh({alpha:a.alpha,antialias:a.antialias,canvas:n,preserveDrawingBuffer:a.preserveDrawingBuffer,premultipliedAlpha:a.premultipliedAlpha,onNoContext:()=>{s=!1}}),!s||!this.renderer.gl?null:(this.context=this.renderer.gl,this.resourceManager&&this.resourceManager.setWebGLRenderer(this.renderer),this.setRendererSize(i,r),this.renderer.setPixelRatio(this.pixelRatio),this.renderer.gl)}initIOExpanders(e){const n=ap();Array.isArray(e.ioExpansion)||e.ioExpansion===void 0?this.ioExpanders=e.ioExpansion&&e.ioExpansion.slice(0)||n.slice(0)||[]:e.ioExpansion instanceof Function&&(this.ioExpanders=e.ioExpansion(n));const i=this.resourceManager.getIOExpansion();this.ioExpanders=this.ioExpanders.concat(i)}initShaderTransforms(e){const n=cp();Array.isArray(e.shaderTransforms)||e.shaderTransforms===void 0?this.shaderTransforms=e.shaderTransforms&&e.shaderTransforms.slice(0)||n.slice(0)||[]:e.shaderTransforms instanceof Function&&(this.shaderTransforms=e.shaderTransforms(n))}initUserInputManager(e){if(!this.context)return;const n=[new sp].concat(e.eventManagers||[]);this.userInputManager=new np(this.context.canvas,this,n,e.handlesWheelEvents)}async initResources(e){const n=op();this.resourceManager=new Al,this.resourceManager.setWebGLRenderer(this.renderer),(e.resourceManagers&&e.resourceManagers.slice(0)||n.slice(0)||[]).forEach(r=>{this.resourceManager.setManager(r.type,r.manager)})}async pipeline(e){e.resources&&await this.resourceDiffs.diff(e.resources),e.scenes&&await this.sceneDiffs.diff(e.scenes),this.gatherViewDrawDependencies()}printLayerErrors(e){e.length>0&&(console.warn("Some layers errored during their draw update. These layers will be removed. They can be re-added if render() is called again:",e.map(n=>n[0].id)),e.forEach(n=>{if(console.warn(`Layer ${n[0].id} removed for the following error:`),n[1]){const i=n[1].stack||n[1].message;if(console.error(i),i.indexOf("RangeError")>-1||i.indexOf("Source is too large")>-1){const r=n[0],s=r.bufferManager.changeListContext||[];let a,o=0;for(let c=0,l=s.length;c<l;++c){const[u]=s[c];r.shaderIOInfo.instanceAttributes.forEach(h=>{h.update(u).length!==h.size&&(a||(a=["Example instance returned the wrong sized value for an attribute:",u,h]),o++)})}a&&(console.error("The following output shows discovered issues related to the specified error"),console.error(`Instances are returning too large IO for an attribute
`,a[0],a[1],a[2],"Total errors for too large IO values",o))}}}))}resize(e,n,i){if(this.pixelRatio=i||this.pixelRatio,this.pixelRatio<1&&(this.pixelRatio=1),this.setRendererSize(e,n),this.renderer.setPixelRatio(this.pixelRatio),this.userInputManager.resize(),this.resourceManager.resize(),this.sceneDiffs){const r=this.sceneDiffs.items;for(let s=0,a=r.length;s<a;++s){const o=r[s];for(let c=0,l=o.views.length;c<l;++c){const u=o.views[c];u.pixelRatio=this.pixelRatio,u.props.camera.update(!0)}}}this.gatherViewDrawDependencies()}redraw(){for(let e=0,n=this.sceneDiffs.items.length;e<n;++e){const i=this.sceneDiffs.items[e];for(let r=0,s=i.views.length;r<s;++r){const a=i.views[r];a.needsDraw=!0}}}setRendererSize(e,n){e=e||100,n=n||100,this.renderer.setSize(e,n)}enableOptimizedOutput(e){this.enabledOptimizedOutputs.add(e)}}class up extends Qn{draw(){this.props.commands(this.surface)}initShader(){return null}}up.defaultProps={data:new ke,key:"",commands:()=>{}};class nt extends Qn{constructor(e,n,i){super(e,n,i)}baseShaderModules(e){const n=super.baseShaderModules(e);return n.vs.push("world2D"),n}}const Rv=`
These are projection methods and camera
related constants associated with a
View2D.

Methods:
vec3 cameraSpace(vec3 world);
vec3 cameraSpaceSize(vec3 worldSize);
vec4 clipSpace(vec3 world);
vec4 clipSpaceSize(vec3 worldSize);

Constants:
mat4 projection;
mat4 view;
mat4 viewProjection;
vec3 cameraOffset;
vec3 cameraPosition;
vec3 cameraScale;
vec3 cameraScale2D;
vec3 cameraRotation;
vec2 viewSize;
float pixelRatio;
`;tt.register([{moduleId:"world2D",description:Rv,content:ip,compatibility:G.ALL,uniforms:t=>t instanceof nt?[{name:"projection",size:O.MATRIX4,update:()=>t.view.props.camera.projection},{name:"view",size:O.MATRIX4,update:()=>t.view.props.camera.view},{name:"viewProjection",size:O.MATRIX4,update:()=>t.view.props.camera.viewProjection},{name:"cameraOffset",size:O.THREE,update:()=>t.view.props.camera instanceof nr?t.view.props.camera.control2D.offset:[0,0,0]},{name:"cameraPosition",size:O.THREE,update:()=>t.view.props.camera.position},{name:"cameraScale",size:O.THREE,update:()=>t.view.props.camera.scale},{name:"cameraScale2D",size:O.THREE,update:()=>t.view.props.camera instanceof nr?t.view.props.camera.scale2D:[1,1,1]},{name:"cameraRotation",size:O.THREE,update:()=>t.view.props.camera.scale},{name:"viewSize",size:O.TWO,update:()=>[t.view.viewBounds.width,t.view.viewBounds.height]},{name:"pixelRatio",size:O.ONE,update:()=>[t.view.pixelRatio]}]:(console.warn("A shader requested the module world2D; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}]);var $=(t=>(t[t.BottomLeft=0]="BottomLeft",t[t.BottomMiddle=1]="BottomMiddle",t[t.BottomRight=2]="BottomRight",t[t.Custom=3]="Custom",t[t.Middle=4]="Middle",t[t.MiddleLeft=5]="MiddleLeft",t[t.MiddleRight=6]="MiddleRight",t[t.TopLeft=7]="TopLeft",t[t.TopMiddle=8]="TopMiddle",t[t.TopRight=9]="TopRight",t))($||{}),Sn=(t=>(t[t.ALWAYS=1]="ALWAYS",t[t.BOUND_MAX=2]="BOUND_MAX",t[t.NEVER=3]="NEVER",t))(Sn||{}),hp=(t=>(t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_MIDDLE=1]="TOP_MIDDLE",t[t.TOP_RIGHT=2]="TOP_RIGHT",t[t.MIDDLE_LEFT=3]="MIDDLE_LEFT",t[t.MIDDLE=4]="MIDDLE",t[t.MIDDLE_RIGHT=5]="MIDDLE_RIGHT",t[t.BOTTOM_LEFT=6]="BOTTOM_LEFT",t[t.BOTTOM_MIDDLE=7]="BOTTOM_MIDDLE",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT",t))(hp||{});class dp extends Fi{constructor(e){super({}),this._uid=K(),this.isPanning=!1,this.isScaling=!1,this.panFilter=(n,i,r)=>n,this.scaleFilter=(n,i,r)=>n,this.startViews=[],this.optimizedViews=new Set,this.cameraImmediateAnimation=Ta.immediate(0),this.targetTouches=new Set,this.onRangeChanged=(n,i)=>{},this.startViewDidStart=!1,this.applyBounds=()=>{if(this.bounds&&this.camera){const n=this.getView(this.bounds.view);this.applyScaleBounds(),n&&(this.camera.control2D.getOffset()[0]=this.boundsHorizontalOffset(n,this.bounds),this.camera.control2D.getOffset()[1]=this.boundsVerticalOffset(n,this.bounds))}},this.applyScaleBounds=()=>{this.camera&&this.bounds&&(this.bounds.scaleMin&&this.camera.control2D.setScale(Ys(this.camera.control2D.getScale(),this.bounds.scaleMin)),this.bounds.scaleMax&&this.camera.control2D.setScale(qs(this.camera.control2D.getScale(),this.bounds.scaleMax)))},this.handleCameraViewChange=(n,i)=>{if(i!==this.startViews[0])return;const r=this.surface.getProjections(i);r&&this.onRangeChanged(n,r)},e.bounds&&this.setBounds(e.bounds),this._camera=e.camera,this.scaleFactor=e.scaleFactor||1e3,this.ignoreCoverViews=e.ignoreCoverViews||!1,this.twoFingerPan=e.twoFingerPan||!1,e.startView&&(Array.isArray(e.startView)?(this.startViews=e.startView,this._camera.control2D.setViewChangeHandler(this.handleCameraViewChange)):(this.startViews=[e.startView],this._camera.control2D.setViewChangeHandler(this.handleCameraViewChange))),this.panFilter=e.panFilter||this.panFilter,this.scaleFilter=e.scaleFilter||this.scaleFilter,this.onRangeChanged=e.onRangeChanged||this.onRangeChanged,e.wheelShouldScroll&&(this.wheelShouldScroll=e.wheelShouldScroll)}get uid(){return this._uid}get camera(){return this._camera}anchoredByBoundsHorizontal(e,n){switch(n.anchor){case 0:case 3:case 6:return-(n.worldBounds.left-n.screenPadding.left/this.camera.control2D.getScale()[0]);case 1:case 4:case 7:return-(n.worldBounds.right-n.worldBounds.width/2-.5*((e.screenBounds.width+n.screenPadding.right)/this.camera.control2D.getScale()[0]));case 2:case 5:case 8:return-(n.worldBounds.right-(e.screenBounds.width-n.screenPadding.right)/this.camera.control2D.getScale()[0])}}anchoredByBoundsVertical(e,n){switch(n.anchor){case 0:case 1:case 2:return-(n.worldBounds.top-n.screenPadding.top/this.camera.control2D.getScale()[1]);case 3:case 4:case 5:return-(n.worldBounds.bottom-n.worldBounds.height/2-.5*((e.screenBounds.height+n.screenPadding.bottom)/this.camera.control2D.getScale()[1]));case 6:case 7:case 8:return-(n.worldBounds.bottom-(e.screenBounds.height-n.screenPadding.bottom)/this.camera.control2D.getScale()[1])}}boundsHorizontalOffset(e,n){const i=e.projection.worldToScreen([n.worldBounds.left,n.worldBounds.top]),r=e.projection.worldToScreen([n.worldBounds.right,n.worldBounds.bottom]);return r[0]-i[0]+n.screenPadding.left+n.screenPadding.right-e.screenBounds.width<0?this.anchoredByBoundsHorizontal(e,n):r[0]<e.screenBounds.right-n.screenPadding.right?-n.worldBounds.right+(e.screenBounds.width-n.screenPadding.right)/this.camera.control2D.getScale()[0]:i[0]>e.screenBounds.left+n.screenPadding.left?-n.worldBounds.left+n.screenPadding.left/this.camera.control2D.getScale()[0]:this.camera.control2D.getOffset()[0]}boundsVerticalOffset(e,n){const i=e.projection.worldToScreen([n.worldBounds.left,n.worldBounds.top]),r=e.projection.worldToScreen([n.worldBounds.right,n.worldBounds.bottom]);return r[1]-i[1]+n.screenPadding.top+n.screenPadding.bottom-e.screenBounds.height<0?this.anchoredByBoundsVertical(e,n):r[1]<e.screenBounds.bottom-n.screenPadding.bottom?-n.worldBounds.bottom+(e.screenBounds.height-n.screenPadding.bottom)/this.camera.control2D.getScale()[1]:i[1]>e.screenBounds.top+n.screenPadding.top?-n.worldBounds.top+n.screenPadding.top/this.camera.control2D.getScale()[0]:this.camera.control2D.getOffset()[1]}canStart(e){return this.startViews.length===0||this.startViews&&this.startViews.indexOf(e)>-1||this.startViewDidStart&&this.ignoreCoverViews}centerOn(e,n){if(!this.camera.control2D.surface)return;const i=this.camera.control2D.surface.getViewSize(e);if(!i)return;const r=[i.width/2,i.height/2,0],s=Kt(n,Qr(r,this.camera.control2D.getScale())),a=St(s,-1);this.setOffset(e,a)}doPan(e,n,i){let r=ri(jr(i,this.camera.control2D.getScale()),0);this.panFilter&&(r=this.panFilter(r,n,e)),this.camera.control2D.getOffset()[0]+=r[0],this.camera.control2D.getOffset()[1]+=r[1],this.applyBounds(),this.onRangeChanged(this.camera,n.projection),this.applyBounds(),this.camera.control2D.update()}doScale(e,n,i,r){const s=n.projection.screenToWorld(e),a=this.camera.control2D.getScale()[0]||1,o=this.camera.control2D.getScale()[1]||1;this.scaleFilter&&(r=this.scaleFilter(r,n,i)),this.camera.control2D.getScale()[0]=a+r[0],this.camera.control2D.getScale()[1]=o+r[1],this.applyScaleBounds();const c=n.projection.screenToWorld(e),l=$e(s,c);this.camera.control2D.getOffset()[0]-=l[0],this.camera.control2D.getOffset()[1]-=l[1],this.applyBounds(),this.onRangeChanged(this.camera,n.projection),this.applyBounds(),this.camera.control2D.update(),this.camera.control2D.animation=this.cameraImmediateAnimation}filterTouchesByValidStart(e){return this.ignoreCoverViews?e.filter(dh(this.startViews)):e.filter(hh(this.startViews))}findCoveredStartView(e){const n=e.target.views.find(i=>this.startViews.indexOf(i.view.id)>-1);this.startViewDidStart=!!n,n&&(this.coveredStartView=n.view)}getRange(e){const n=this.getProjection(e),i=this.getViewScreenBounds(e);if(n&&i){const r=n.screenToWorld([i.x,i.y]),s=n.screenToWorld([i.right,i.bottom]);return new ye({height:s[1]-r[1],width:s[0]-r[0],x:r[0],y:r[1]})}return new ye({x:0,y:0,width:1,height:1})}getTargetView(e){return this.startViews&&!this.ignoreCoverViews?e.target.view:this.coveredStartView}handleMouseDown(e){this.startViews&&(this.findCoveredStartView(e),e.start&&(this.isPanning=this.canStart(e.start.view.id)||this.isPanning))}handleTouchDown(e){if(this.startViews){const n=this.filterTouchesByValidStart(e.allTouches);this.twoFingerPan?n.length>1&&(this.isPanning=!0):n.length>0&&(this.isPanning=!0),n.length>1&&(this.isScaling=!0);for(let i=0,r=n.length;i<r;++i){const s=n[i];this.targetTouches.add(s.touch.touch.identifier)}}}handleMouseUp(e){this.startViewDidStart=!1,this.isPanning=!1,this.optimizedViews.forEach(n=>n.optimizeRendering=!1),this.optimizedViews.clear()}handleTouchUp(e){e.touches.forEach(n=>{this.targetTouches.delete(n.touch.touch.identifier),this.targetTouches.size<=0&&(this.startViewDidStart=!1,this.isPanning=!1,this.optimizedViews.forEach(i=>i.optimizeRendering=!1),this.optimizedViews.clear())}),this.isPanning=!1,this.isScaling=!1,this.targetTouches.size>0&&(this.isPanning=!0),this.targetTouches.size>1&&(this.isScaling=!0)}handleTouchCancelled(e){e.touches.forEach(n=>{this.targetTouches.delete(n.touch.touch.identifier),this.targetTouches.size<=0&&(this.startViewDidStart=!1,this.isPanning=!1,this.optimizedViews.forEach(i=>i.optimizeRendering=!1),this.optimizedViews.clear())}),this.isPanning=!1,this.isScaling=!1,this.targetTouches.size>0&&(this.isPanning=!0),this.targetTouches.size>1&&(this.isScaling=!0)}handleDrag(e){e.start&&this.canStart(e.start.view.id)&&(e.target.views.forEach(n=>{n.view.optimizeRendering=!0,this.optimizedViews.add(n.view)}),this.doPan(e.target.views.map(n=>n.view),e.start.view,e.mouse.deltaPosition),this.camera.control2D.animation=this.cameraImmediateAnimation)}handleTouchDrag(e){const n=this.filterTouchesByValidStart(e.allTouches);if(n.length>0&&this.isPanning){for(let a=0,o=n.length;a<o;++a)n[a].target.views.forEach(l=>{l.view.optimizeRendering=!0,this.optimizedViews.add(l.view)});const i=new Set,s=n.reduce((a,o)=>{for(let c=0,l=o.target.views.length;c<l;++c){const u=o.target.views[c];i.add(u.view)}return o.touch.startTime<a.touch.startTime?o:a},n[0]).start.view;if(this.isPanning&&(this.doPan(Array.from(i.values()),s,e.multitouch.centerDelta(n)),this.camera.control2D.animation=this.cameraImmediateAnimation),this.isScaling){const a=e.multitouch.center(n),o=$e(n[0].touch.currentPosition,a),c=$e(a,e.multitouch.centerDelta(n)),l=$e(n[0].touch.previousPosition,c),u=ii(o)/ii(l),h=[u*this.camera.scale2D[0]-this.camera.scale2D[0],u*this.camera.scale2D[1]-this.camera.scale2D[1],0];u!==1&&this.doScale(a,s,Array.from(i.values()),h)}}}handleWheel(e){if(this.findCoveredStartView(e),this.canStart(e.target.view.id))if(this.wheelShouldScroll){const n=[-e.mouse.wheel.delta[0],e.mouse.wheel.delta[1]];e.start&&this.doPan(e.target.views.map(i=>i.view),e.start.view,n)}else{const n=this.camera.control2D.getScale()[0]||1,i=this.camera.control2D.getScale()[1]||1,r=this.getTargetView(e),s=[e.mouse.wheel.delta[1]/this.scaleFactor*n,e.mouse.wheel.delta[1]/this.scaleFactor*i,1];if(!r){console.warn("Could not find target view for wheel event");return}this.doScale(e.screen.position,r,e.target.views.map(a=>a.view),s)}}get pan(){return this.camera.control2D.offset}get scale(){return this.camera.control2D.getScale()}setBounds(e){this.bounds=e,this.applyBounds()}setOffset(e,n){const i=At(this.camera.control2D.offset);if(this.camera.control2D.getOffset()[0]=n[0],this.camera.control2D.getOffset()[1]=n[1],this.camera.control2D.getOffset()[2]=n[2],this.applyBounds(),this.camera.control2D.surface){const a=this.camera.control2D.surface.getProjections(e);a&&this.onRangeChanged(this.camera,a)}this.applyBounds();const r=At(this.camera.control2D.getOffset()),s=this.camera.control2D.animation;this.camera.control2D.setOffset(i),this.camera.control2D.animation=this.cameraImmediateAnimation,this.camera.control2D.setOffset(r),this.camera.control2D.animation=s}setRange(e,n){const i=this.getProjection(n),r=this.getViewScreenBounds(n),s=this.getView(n);if(i&&r&&s){const a=Kt([r.width/e.width,r.height/e.height,1],this.camera.control2D.getScale());this.camera.control2D.setScale(qt(this.camera.control2D.getScale(),this.scaleFilter(a,s,[s])));const o=Kt([-e.x,-e.y,0],this.camera.control2D.offset);this.camera.control2D.setOffset(qt(this.camera.control2D.offset,this.scaleFilter(o,s,[s]))),this.applyBounds(),this.onRangeChanged(this.camera,s.projection),this.applyBounds()}}setRangeChangeHandler(e){this.onRangeChanged=e}}class Av extends Yn{constructor(e,n){super(e),this.offsetFilter=i=>i,this.scaleFilter=i=>i,this.base=n.base,this.offsetFilter=n.offsetFilter||this.offsetFilter,this.scaleFilter=n.scaleFilter||this.scaleFilter}set offset(e){}get offset(){return this.offsetFilter(this.base.offset)}set scale(e){}get scale(){return this.scaleFilter(this.base.scale)}}class Sv extends nr{constructor(e){super(),this.base=e.base,this._control2D=new Av(this.base,{base:this.base.control2D,offsetFilter:e.offsetFilter,scaleFilter:e.scaleFilter})}set control2D(e){}get control2D(){return this._control2D}}const Mv=new nr;class xv extends ma{constructor(){super(...arguments),this.camera=Mv}screenToWorld(e,n){const i=this.screenToView(e),r=n||[0,0];return r[0]=(i[0]-this.camera.control2D.offset[0]*this.camera.scale2D[0])/this.camera.scale2D[0],r[1]=(i[1]-this.camera.control2D.offset[1]*this.camera.scale2D[1])/this.camera.scale2D[1],r}screenRay(e){const n=this.screenToWorld(e);return[[n[0],n[1],0],[n[0],n[1],-1]]}worldToScreen(e,n){const i=[0,0];return i[0]=(e[0]*this.camera.scale2D[0]+this.camera.control2D.offset[0]*this.camera.scale2D[0])*this.pixelRatio,i[1]=(e[1]*this.camera.scale2D[1]+this.camera.control2D.offset[1]*this.camera.scale2D[1])*this.pixelRatio,this.viewToScreen(i,n)}viewToWorld(e,n){const i=n||[0,0],r=e;return i[0]=(r[0]-this.camera.control2D.offset[0]*this.camera.scale2D[0])/this.camera.scale2D[0],i[1]=(r[1]-this.camera.control2D.offset[1]*this.camera.scale2D[1])/this.camera.scale2D[1],i}worldToView(e,n){const i=n||[0,0];return i[0]=e[0]*this.camera.scale2D[0]+this.camera.control2D.offset[0]*this.camera.scale2D[0],i[1]=e[1]*this.camera.scale2D[1]+this.camera.control2D.offset[1]*this.camera.scale2D[1],i}}function fp(t){return t.projectionType===Wn.ORTHOGRAPHIC}class pp extends Cs{constructor(e,n){super(e,n),this.projection=new xv,this.projection.camera=n.camera||new nr}fitViewtoViewport(e,n){if(fp(this.props.camera)){const i=n.width,r=n.height,s={bottom:-r/2,far:1e7,left:-i/2,near:-100,right:i/2,top:r/2},a=1/this.pixelRatio,o=1/this.pixelRatio,c=this.props.camera;c.projectionOptions=Object.assign(c.projectionOptions,s),c.position=[n.width/(2*this.pixelRatio),n.height/(2*this.pixelRatio),c.position[2]],c.scale=[a,-o,1],c.lookAt(qt(c.position,[0,0,-1]),[0,1,0]),c.update(),this.projection.viewBounds=n,n.d=this,this.projection.screenBounds=new ye({height:this.viewBounds.height/this.pixelRatio,width:this.viewBounds.width/this.pixelRatio,x:this.viewBounds.x/this.pixelRatio,y:this.viewBounds.y/this.pixelRatio}),this.screenBounds.d=this}else fp(this.props.camera)||console.warn("View2D does not support non-orthographic cameras.")}willUpdateProps(e){this.projection.camera=e.camera}}pp.defaultProps={key:"",camera:new nr,viewport:{left:0,right:0,bottom:0,top:0}};const Iv=`precision highp float;
varying vec4 vertexColor;
void main() {
gl_FragColor = vertexColor;
}`,Cv=`precision highp float;
varying vec4 vertexColor;
vec2 interpolation(float t, vec2 center, float radius, float start, float end) {
float angle = (end - start) * t + start;
return center + vec2(cos(angle) * radius, sin(angle) * radius);
}
void main() {
float startAngle = angle.x;
float endAngle = angle.y;
float widthStart = thickness.x;
float widthEnd = thickness.y;
vec4 centerClip = clipSpace(vec3(center, depth));
vec2 centerScreen = (centerClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;
float normal = position.x;
float interpolationTime = position.y;
float interpolationIncrement = 1.0 / position.z;
vec2 currentPosition = interpolation(interpolationTime, centerScreen, radius, startAngle, endAngle);
vec2 currentNormal = normalize(currentPosition - centerScreen);
float lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;
vec2 vertex = currentPosition + currentNormal * (normal * lineThickness);
vertexColor = mix(colorStart, colorEnd, interpolationTime);
vertexColor *= vertexColor.a;
gl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), centerClip.zw);
gl_PointSize = 5.0;
}`,Lv=`\${import: arc}
precision highp float;
varying vec4 vertexColor;
void main() {
float startAngle = angle.x + angleOffset;
float endAngle = angle.y + angleOffset;
float widthStart = thickness.x;
float widthEnd = thickness.y;
float normal = vertex.x;
float interpolationTime = vertex.y;
float interpolationIncrement = 1.0 / vertex.z;
vec2 currentPosition = arc(interpolationTime, center, radius, startAngle, endAngle);
vec2 currentNormal = normalize(currentPosition - center);
float lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;
vec2 vertex = currentPosition + currentNormal * (normal * lineThickness);
vertexColor = mix(colorStart, colorEnd, interpolationTime);
gl_Position = clipSpace(vec3(vertex, depth));
}`;var gp=(t=>(t[t.NONE=0]="NONE",t[t.SCREEN_CURVE=1]="SCREEN_CURVE",t))(gp||{});const qn=class extends nt{initShader(){const{scaleType:t}=this.props,e=this.props.animate||{},{angle:n,angleOffset:i,center:r,radius:s,thickness:a,colorStart:o,colorEnd:c}=e,l=150,u={0:1,[l*2+2]:-1},h={0:0,[l*2+2]:1};let f=1;for(let m=0;m<l*2;++m)u[m+1]=f,h[m+1]=Math.floor(m/2)/(l-1),f*=-1;const p=t===0?Lv:Cv;return{fs:Iv,instanceAttributes:[{easing:r,name:qn.attributeNames.center,size:k.TWO,update:m=>m.center},{easing:s,name:qn.attributeNames.radius,size:k.ONE,update:m=>[m.radius]},{name:qn.attributeNames.depth,size:k.ONE,update:m=>[m.depth]},{easing:a,name:qn.attributeNames.thickness,size:k.TWO,update:m=>m.thickness},{easing:n,name:qn.attributeNames.angle,size:k.TWO,update:m=>m.angle},{easing:i,name:qn.attributeNames.angleOffset,size:k.ONE,update:m=>[m.angleOffset]},{easing:o,name:qn.attributeNames.colorStart,size:k.FOUR,update:m=>m.colorStart},{easing:c,name:qn.attributeNames.colorEnd,size:k.FOUR,update:m=>m.colorEnd}],uniforms:[{name:"scaleFactor",size:O.ONE,update:m=>[1]}],vertexAttributes:[{name:"vertex",size:vt.THREE,update:m=>[u[m],h[m],l*2]}],vertexCount:l*2+2,vs:p}}getMaterialOptions(){return Object.assign({},It.transparentShapeBlending,{culling:d.GLSettings.Material.CullSide.NONE})}};let Dl=qn;Dl.defaultProps={data:new ke,key:"",scaleType:0},Dl.attributeNames={angle:"angle",angleOffset:"angleOffset",center:"center",colorEnd:"colorEnd",colorStart:"colorStart",depth:"depth",radius:"radius",thickness:"thickness"};var Ov=Object.defineProperty,Nv=Object.getOwnPropertyDescriptor,Ti=(t,e,n,i)=>{for(var r=i>1?void 0:i?Nv(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(r=(i?a(e,n,r):a(r))||r);return i&&r&&Ov(e,n,r),r};const mp=class extends pt{constructor(t){super(t),this.angle=[0,Math.PI],this.colorEnd=[1,1,1,1],this.colorStart=[1,1,1,1],this.center=[0,0],this.depth=0,this.angleOffset=0,this.radius=1,this.thickness=[5,5],_t(this,mp),this.angle=t.angle||this.angle,this.colorEnd=t.colorEnd||this.colorEnd,this.colorStart=t.colorStart||this.colorStart,this.center=t.center||this.center,this.depth=t.depth||this.depth,this.radius=t.radius||this.radius,this.thickness=t.thickness||this.thickness}};let Kn=mp;Ti([B],Kn.prototype,"angle",2),Ti([B],Kn.prototype,"colorEnd",2),Ti([B],Kn.prototype,"colorStart",2),Ti([B],Kn.prototype,"center",2),Ti([B],Kn.prototype,"depth",2),Ti([B],Kn.prototype,"angleOffset",2),Ti([B],Kn.prototype,"radius",2),Ti([B],Kn.prototype,"thickness",2);const Pv=`precision highp float;
varying vec4 vertexColor;
varying float edgeSharpness;
varying float edgeSharpnessBase;
varying vec2 pointCoord;
float circle(vec2 coord, float radius){
vec2 dist = coord - vec2(0.5);
return 1.0 - smoothstep(
radius - (radius * edgeSharpness),
radius + (radius * edgeSharpnessBase),
dot(dist, dist) * 4.0
);
}
void main() {
float step_factor = circle(pointCoord, 1.0);
\${out: color} = mix(
vec4(0.0, 0.0, 0.0, 0.0),
vertexColor,
step_factor
);
if (color.a == 0.0) discard;
}`,Dv=`precision highp float;
varying vec4 vertexColor;
varying float edgeSharpness;
varying float edgeSharpnessBase;
float circle(vec2 coord, float radius){
vec2 dist = coord - vec2(0.5);
return 1.0 - smoothstep(
radius - (radius * edgeSharpness),
radius + (radius * edgeSharpnessBase),
dot(dist, dist) * 4.0
);
}
void main() {
float step_factor = circle(gl_PointCoord, 1.0);
\${out: color} = mix(
vec4(0.0, 0.0, 0.0, 0.0),
vertexColor,
step_factor
);
if (color.a == 0.0) discard;
}`,Fv=`precision highp float;
varying vec4 vertexColor;
varying float edgeSharpness;
varying float edgeSharpnessBase;
void main() {
vertexColor = color;
vertexColor.a *= layerOpacity;
float size = radius * cameraScale2D.x;
edgeSharpness = mix(0.8, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));
edgeSharpnessBase = mix(0.1, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));
gl_Position = clipSpace(vec3(center, depth));
gl_PointSize = size * 2.0 * pixelRatio;
}`,Bv=`precision highp float;
varying vec4 vertexColor;
varying float edgeSharpness;
varying float edgeSharpnessBase;
varying vec2 pointCoord;
void main() {
vertexColor = color;
vertexColor.a *= layerOpacity;
float size = radius * cameraScale2D.x * pixelRatio;
edgeSharpness = mix(0.8, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));
edgeSharpnessBase = mix(0.1, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));
pointCoord = (normals.xy + vec2(1.0, 1.0)) / 2.0;
vec4 clipCenter = clipSpace(vec3(center, depth));
vec2 screenCenter = (clipCenter.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;
vec2 vertex = (normals.xy * size) + screenCenter;
gl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), clipCenter.zw);
}`,Ls=class extends nt{initShader(){const{animate:t={},usePoints:e=!1,opacity:n=()=>1}=this.props,{center:i,radius:r,color:s}=t,a={0:1,1:1,2:-1,3:1,4:-1,5:-1},o={0:-1,1:-1,2:-1,3:1,4:1,5:1},c=[{name:"normals",size:vt.TWO,update:u=>[a[u],o[u]]}],l=6;return{drawMode:e?d.GLSettings.Model.DrawMode.POINTS:d.GLSettings.Model.DrawMode.TRIANGLE_STRIP,fs:e?[{outputType:ge.COLOR,source:Dv},{outputType:ge.GLOW,source:`
              void main() {
                \${out: glow} = color;
              }
              `}]:[{outputType:ge.COLOR,source:Pv},{outputType:ge.GLOW,source:`
              void main() {
                \${out: glow} = color;
              }
              `}],instanceAttributes:[{easing:i,name:Ls.attributeNames.center,size:k.TWO,update:u=>u.center},{easing:r,name:Ls.attributeNames.radius,size:k.ONE,update:u=>[u.radius]},{name:Ls.attributeNames.depth,size:k.ONE,update:u=>[u.depth]},{easing:s,name:Ls.attributeNames.color,size:k.FOUR,update:u=>u.color}],uniforms:[{name:"layerOpacity",size:O.ONE,update:u=>[n()]}],vertexAttributes:e?void 0:c,vertexCount:e?0:l,vs:e?Fv:Bv}}getMaterialOptions(){return It.transparentShapeBlending}};let Fl=Ls;Fl.defaultProps={data:new ke,key:""},Fl.attributeNames={center:"center",color:"color",depth:"depth",radius:"radius"};var Uv=Object.defineProperty,kv=Object.getOwnPropertyDescriptor,Ya=(t,e,n,i)=>{for(var r=i>1?void 0:i?kv(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(r=(i?a(e,n,r):a(r))||r);return i&&r&&Uv(e,n,r),r};const vp=class extends pt{constructor(t){super(t),this.color=[1,1,1,1],this.depth=0,this.radius=0,this.center=[0,0],_t(this,vp),this.color=t.color||this.color,this.radius=t.radius||this.radius,this.center=t.center||this.center,this.depth=t.depth||this.depth}get width(){return this.radius*2}get height(){return this.radius*2}};let Os=vp;Ya([B],Os.prototype,"color",2),Ya([B],Os.prototype,"depth",2),Ya([B],Os.prototype,"radius",2),Ya([B],Os.prototype,"center",2);var Ns=(t=>(t[t.NONE=0]="NONE",t[t.SCREEN_CURVE=1]="SCREEN_CURVE",t))(Ns||{}),Mn=(t=>(t[t.LINE=0]="LINE",t[t.BEZIER=1]="BEZIER",t[t.BEZIER2=2]="BEZIER2",t))(Mn||{}),Bl=(t=>(t[t.ALL=0]="ALL",t[t.PASS_Y=1]="PASS_Y",t[t.PASS_X=2]="PASS_X",t))(Bl||{});const Gv=`precision highp float;
varying vec4 vertexColor;
\${interpolation}
void main() {
float normal = vertex.x;
float interpolationTime = vertex.y;
float interpolationIncrement = 1.0 / vertex.z;
vec2 currentPosition = interpolation(interpolationTime, start, end, control.xy, control.zw);
vec2 prePosition = interpolation(interpolationTime - interpolationIncrement, start, end, control.xy, control.zw);
vec2 nextPosition = interpolation(interpolationTime + interpolationIncrement, start, end, control.xy, control.zw);
vec2 preLine = prePosition - currentPosition;
vec2 nextLine = nextPosition - currentPosition;
vec2 currentNormal = mix(
normalize(vec2(preLine.y, -preLine.x)),
mix(
normalize(vec2(preLine.y, -preLine.x) + vec2(-nextLine.y, nextLine.x)),
normalize(vec2(-nextLine.y, nextLine.x)),
float(vertex.x >= 1.0)
),
float(vertex.x > 0.0)
);
float lineThickness = mix(thickness.x, thickness.y, interpolationTime) / 2.0;
vec2 vertexPos = currentPosition + currentNormal * (normal * lineThickness);
vertexColor = mix(startColor, endColor, interpolationTime);
gl_Position = clipSpace(vec3(vertexPos, depth));
gl_PointSize = 5.0;
}`,zv=`vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {
float t1 = 1.0 - t;
return pow(t1, 3.0) * p1 + 3.0 * t * pow(t1, 2.0) * c1 + 3.0 * pow(t, 2.0) * t1 * c2 + pow(t, 3.0) * p2;
}`,Vv=`vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {
return (1.0 - t) * (1.0 - t) * p1 + 2.0 * t * (1.0 - t) * c1 + t * t * p2;
}`,Wv=`precision highp float;
varying vec4 vertexColor;
void main() {
gl_FragColor = vertexColor;
}`,$v=`vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {
return p1 + (p2 - p1) * t;
}`,jv=`precision highp float;
varying vec4 vertexColor;
\${interpolation}
void main() {
float normal = vertex.x;
float interpolationTime = vertex.y;
float interpolationIncrement = 1.0 / vertex.z;
vec4 startClip = clipSpace(vec3(start, depth));
vec4 endClip = clipSpace(vec3(end, depth));
vec2 startScreen = (startClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;
vec2 endScreen = (endClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;
vec2 control1 = startScreen + vec2(control.x, -control.y) * scaleFactor;
vec2 control2 = endScreen + vec2(control.z, -control.w) * scaleFactor;
vec2 currentPosition = interpolation(interpolationTime, startScreen, endScreen, control1, control2);
vec2 prePosition = interpolation(interpolationTime - interpolationIncrement, startScreen, endScreen, control1, control2);
vec2 nextPosition = interpolation(interpolationTime + interpolationIncrement, startScreen, endScreen, control1, control2);
vec2 preLine = prePosition - currentPosition;
vec2 nextLine = nextPosition - currentPosition;
vec2 currentNormal = mix(
normalize(vec2(preLine.y, -preLine.x)),
mix(
normalize(vec2(preLine.y, -preLine.x) + vec2(-nextLine.y, nextLine.x)),
normalize(vec2(-nextLine.y, nextLine.x)),
float(vertex.x >= 1.0)
),
float(vertex.x > 0.0)
);
float lineThickness = mix(thickness.x, thickness.y, interpolationTime) / 2.0;
vec2 vertexPos = currentPosition + currentNormal * (-normal * lineThickness * scaleFactor);
vertexColor = mix(startColor, endColor, interpolationTime);
gl_Position = vec4((vertexPos / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), startClip.zw);
gl_PointSize = 5.0;
}`;function Hv(t){return[t[0][0],t[0][1],t[1][0],t[1][1]]}const Qv={[Mn.LINE]:$v,[Mn.BEZIER]:Vv,[Mn.BEZIER2]:zv},xn=class extends nt{initShader(){const{animate:t={},scaleFactor:e=()=>1,type:n,scaleType:i=Ns.NONE}=this.props,{end:r,start:s,startColor:a,endColor:o,control:c,thickness:l}=t,u=n===Mn.LINE?2:50,h={0:1,[u*2+2]:-1},f={0:0,[u*2+2]:1};let p=1;for(let T=0;T<u*2;++T)h[T+1]=p,f[T+1]=Math.floor(T/2)/(u-1),p*=-1;const m={interpolation:Qv[n]},v=gi({options:m,required:{name:"Edge Layer",values:["interpolation"]},shader:i===Ns.NONE?Gv:jv,onToken:(T,b)=>T in m?b:`\${${T}}`});return{fs:Wv,instanceAttributes:[{easing:a,name:xn.attributeNames.startColor,size:k.FOUR,update:T=>T.startColor},{easing:o,name:xn.attributeNames.endColor,size:k.FOUR,update:T=>T.endColor},{easing:s,name:xn.attributeNames.start,size:k.TWO,update:T=>T.start},{easing:r,name:xn.attributeNames.end,size:k.TWO,update:T=>T.end},{easing:l,name:xn.attributeNames.thickness,size:k.TWO,update:T=>T.thickness},{name:xn.attributeNames.depth,size:k.ONE,update:T=>[T.depth]},n===Mn.LINE?{easing:c,name:xn.attributeNames.control,size:k.FOUR,update:T=>[0,0,0,0]}:null,n===Mn.BEZIER?{easing:c,name:xn.attributeNames.control,size:k.FOUR,update:T=>[T.control[0][0],T.control[0][1],0,0]}:null,n===Mn.BEZIER2?{easing:c,name:xn.attributeNames.control,size:k.FOUR,update:T=>Hv(T.control)}:null],uniforms:[{name:"scaleFactor",size:O.ONE,update:T=>[e()]},{name:"layerOpacity",size:O.ONE,update:T=>[this.props.opacity===void 0?1:this.props.opacity]}],vertexAttributes:[{name:"vertex",size:vt.THREE,update:T=>[h[T],f[T],u*2]}],vertexCount:u*2+2,vs:v.shader}}getMaterialOptions(){return It.transparentShapeBlending}};let Ul=xn;Ul.defaultProps={broadphase:Bl.ALL,data:new ke,key:"none",scaleType:Ns.NONE,type:Mn.LINE},Ul.attributeNames={control:"control",depth:"depth",end:"end",endColor:"endColor",start:"start",startColor:"startColor",thickness:"thickness"};var Xv=Object.defineProperty,Yv=Object.getOwnPropertyDescriptor,ir=(t,e,n,i)=>{for(var r=i>1?void 0:i?Yv(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(r=(i?a(e,n,r):a(r))||r);return i&&r&&Xv(e,n,r),r};const wp=class extends pt{constructor(t){super(t),this.control=[[0,0],[0,0]],this.depth=0,this.end=[0,0],this.endColor=[1,1,1,1],this.start=[0,0],this.startColor=[1,1,1,1],this.thickness=[1,1],_t(this,wp),this.startColor=t.startColor||this.startColor,this.endColor=t.endColor||this.endColor,this.control=t.control||this.control,this.depth=t.depth||this.depth,this.end=t.end||this.end,this.thickness=t.thickness||this.thickness,this.start=t.start||this.start}get length(){const t=[this.end[0]-this.start[0],this.end[1]-this.start[1]];return Math.sqrt(t[0]*t[0]+t[1]*t[1])}get midpoint(){return 0}get perpendicular(){const t=this.length;return[(this.end[1]-this.start[1])/t,-(this.end[0]-this.start[0])/t]}setEdgeThickness(t){this.thickness=[t,t]}setColor(t){this.startColor=Zt(t),this.endColor=Zt(t)}};let Ei=wp;ir([B],Ei.prototype,"control",2),ir([B],Ei.prototype,"depth",2),ir([B],Ei.prototype,"end",2),ir([B],Ei.prototype,"endColor",2),ir([B],Ei.prototype,"start",2),ir([B],Ei.prototype,"startColor",2),ir([B],Ei.prototype,"thickness",2);const Ge=Ke("video");function qv(t){Ge.enabled&&(t.addEventListener("abort",()=>Ge("abort")),t.addEventListener("canplay",()=>Ge("canplay")),t.addEventListener("canplaythrough",()=>Ge("canplaythrough")),t.addEventListener("durationchange",()=>Ge("durationchange")),t.addEventListener("emptied",()=>Ge("emptied")),t.addEventListener("ended",()=>Ge("ended")),t.addEventListener("error",()=>Ge("error")),t.addEventListener("loadeddata",()=>Ge("loadeddata")),t.addEventListener("loadedmetadata",()=>Ge("loadedmetadata")),t.addEventListener("loadstart",()=>Ge("loadstart")),t.addEventListener("pause",()=>Ge("pause")),t.addEventListener("play",()=>Ge("play")),t.addEventListener("playing",()=>Ge("playing")),t.addEventListener("progress",()=>Ge("progress")),t.addEventListener("ratechange",()=>Ge("ratechange")),t.addEventListener("seeked",()=>Ge("seeked")),t.addEventListener("seeking",()=>Ge("seeking")),t.addEventListener("stalled",()=>Ge("stalled")),t.addEventListener("suspend",()=>Ge("suspend")),t.addEventListener("timeupdate",()=>Ge("timeupdate")),t.addEventListener("volumechange",()=>Ge("volumechange")),t.addEventListener("waiting",()=>Ge("waiting")))}const Kv=`precision highp float;
varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
gl_FragColor = texture2D(imageAtlas, texCoord) * vertexColor;
gl_FragColor = gl_FragColor * gl_FragColor.a;
}`,Zv=`precision highp float;
varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec3 screenSize = cameraSpaceSize(vec3(size, 1.0));
bool largerOnScreen = screenSize.y > size.y;
float useScaleMode = float(
(
scaling == 3.0 ||
(largerOnScreen && scaling == 2.0)
) &&
scaling != 1.0
);
float unequalZooms = float(cameraScale2D.x != cameraScale2D.y);
float normal = normals.x;
float side = normals.y;
vec2 worldAnchor = location + anchor;
texCoord = texture.xy + ((texture.zw - texture.xy) * vec2(side, float(normal == -1.0)));
vertexColor = tint;
vec2 adjustedSize = mix(
size,
(size * cameraScale2D.yx),
unequalZooms
);
vec2 adjustedAnchor = mix(
anchor,
(anchor * cameraScale2D.yx),
unequalZooms
);
vec2 vertex = vec2(side, float(normal == 1.0)) * adjustedSize + location - adjustedAnchor;
float imageScreenScale = mix(
screenSize.y / adjustedSize.y,
screenSize.x / adjustedSize.x,
float((cameraScale2D.x < 1.0) || (cameraScale2D.x > 1.0))
);
vec2 anchorToVertex = vertex - location;
vertex = mix(
vertex,
(anchorToVertex / imageScreenScale) + location,
useScaleMode
);
gl_Position = clipSpace(vec3(vertex, depth));
}`,bi=class extends nt{constructor(t,e,n){super(t,e,n)}initShader(){const t=this.props.animate||{},{tint:e,location:n,size:i}=t,r={0:1,1:1,2:-1,3:1,4:-1,5:-1},s={0:0,1:0,2:0,3:1,4:1,5:1};return{fs:Kv,instanceAttributes:[{easing:n,name:bi.attributeNames.location,size:k.TWO,update:a=>a.origin},{name:bi.attributeNames.anchor,size:k.TWO,update:a=>[a.anchor.x||0,a.anchor.y||0]},{easing:i,name:bi.attributeNames.size,size:k.TWO,update:a=>[a.width,a.height]},{name:bi.attributeNames.depth,size:k.ONE,update:a=>[a.depth]},{name:bi.attributeNames.scaling,size:k.ONE,update:a=>[a.scaling]},{name:bi.attributeNames.texture,resource:{key:()=>this.props.atlas||"",name:"imageAtlas"},update:a=>(a.source,a.request?this.resource.request(this,a,a.request):(console.warn("An image utilizing the image-render-layer does not have its request specified yet.","The image-render-layer does NOT manage requests and should be handled before this layer deals with the instance"),[0,0,0,0]))},{easing:e,name:bi.attributeNames.tint,size:k.FOUR,update:a=>a.tint}],uniforms:[{name:"scaleFactor",size:O.ONE,update:a=>[1]}],vertexAttributes:[{name:"normals",size:vt.TWO,update:a=>[r[a],s[a]]}],vertexCount:6,vs:Zv}}getMaterialOptions(){return It.transparentImageBlending}};let kl=bi;kl.defaultProps={key:"",data:new ke},kl.attributeNames={location:"location",anchor:"anchor",size:"size",depth:"depth",scaling:"scaling",texture:"texture",tint:"tint"};function Ps(t){return t&&t.videoSrc}const qa=new Image;qa.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";class yp extends nt{constructor(){super(...arguments),this.childProvider=new ke,this.imageToResource=new Map,this.sourceToRequest=new Map,this.sourceToVideo=new Map,this.usingVideo=new Map,this.waitingForVideo=new Map,this.waitForVideoSource=new Map,this.originalOnReadyCallbacks=new Map}childLayers(){return[Yi(kl,{...this.props,key:`${this.props.key}.image-render-layer`})]}destroy(){super.destroy(),this.sourceToVideo.forEach(e=>{e.pause(),this.sourceToVideo.clear(),this.waitingForVideo.clear(),this.waitForVideoSource.clear()})}draw(){const e=this.resolveChanges(!0);if(this.updateAnimationState(),e.length<=0)return;this.propertyIds||(this.propertyIds=this.getInstanceObservableIds(e[0][0],["source"]));const{source:n}=this.propertyIds;for(let r=0,s=e.length;r<s;++r){const[a,o,c]=e[r];switch(o){case Ze.CHANGE:if(c[n]!==void 0){const l=this.imageToResource.get(a);let u=this.getAtlasSource(a);if(u===l)break;if(l instanceof HTMLVideoElement){const h=this.waitForVideoSource.get(a);if(h){this.waitForVideoSource.delete(a);const p=this.waitingForVideo.get(h);p&&p.delete(a)}let f=this.usingVideo.get(l.getAttribute("data-source")||"");f||(f=new Set),f.delete(a),f.size<=0&&this.sourceToVideo.delete(l.getAttribute("data-source")||""),a.onReady=this.originalOnReadyCallbacks.get(a)}if(Ps(a.source)&&(this.prepareVideo(a,a.source),u=this.getAtlasSource(a),pi(this.usingVideo,a.source.videoSrc,new Set).add(a)),this.imageToResource.set(a,u),this.resource.request(this,a,Ir({key:this.props.atlas||"",disposeResource:!0,source:l})),u){let h=this.sourceToRequest.get(u);(!h||h.texture&&!h.texture.isValid)&&(h=Ir({key:this.props.atlas||"",source:u,rasterizationScale:this.props.rasterizationScale}),this.sourceToRequest.set(u,h)),a.request=h,this.resource.request(this,a,h)}}break;case Ze.INSERT:if(a.source){let l=this.getAtlasSource(a);Ps(a.source)&&(this.prepareVideo(a,a.source),l=this.getAtlasSource(a),pi(this.usingVideo,a.source.videoSrc,new Set).add(a));let u=this.sourceToRequest.get(l);(!u||u.texture&&!u.texture.isValid)&&(u=Ir({key:this.props.atlas||"",source:l,rasterizationScale:this.props.rasterizationScale}),this.sourceToRequest.set(l,u)),a.request=u}break;case Ze.REMOVE:{const l=this.getAtlasSource(a);if(this.imageToResource.delete(a),Ps(a.source)){const u=this.waitForVideoSource.get(a);if(u){this.waitForVideoSource.delete(a);const f=this.waitingForVideo.get(u);f&&f.delete(a)}let h=this.usingVideo.get(a.source.videoSrc);h||(h=new Set),h.delete(a),h.size<=0&&this.sourceToVideo.delete(a.source.videoSrc),this.originalOnReadyCallbacks.delete(a)}this.resource.request(this,a,Ir({key:this.props.atlas||"",disposeResource:!0,source:l}));break}}}const i=[];this.usingVideo.forEach((r,s)=>{r.size<=0&&i.push(s)});for(let r=0,s=i.length;r<s;++r){const a=i[r];this.usingVideo.delete(a),this.sourceToVideo.delete(a)}}getAtlasSource(e){return Ps(e.source)?this.sourceToVideo.get(e.source.videoSrc)||qa:e.source}prepareVideo(e,n){const i=this.sourceToVideo.get(n.videoSrc);if(this.originalOnReadyCallbacks.get(e)||this.originalOnReadyCallbacks.set(e,e.onReady),i){const p=this.waitingForVideo.get(n.videoSrc);if(p)p.add(e),this.waitForVideoSource.set(e,n.videoSrc),e.onReady=void 0,e.source=qa,e.videoLoad=()=>{i.load(),n.autoPlay&&i.play()};else{const m=this.originalOnReadyCallbacks.get(e)||e.onReady;if(!m)return;e.onReady=v=>{m(v,i)}}return}const s=document.createElement("video");this.sourceToVideo.set(n.videoSrc,s),s.setAttribute("data-source",n.videoSrc),qv(s);const a=new lt,o=new lt,c=()=>{s.removeEventListener("loadedmetadata",u),s.removeEventListener("loadeddata",l),s.removeEventListener("error",h),this.waitingForVideo.delete(n.videoSrc),this.waitForVideoSource.delete(e)},l=()=>{o.resolve()},u=()=>{a.resolve()},h=p=>{let m;p.path&&p.path[0]&&(m=p.path[0].error),p.originalTarget&&(m=p.originalTarget.error),console.warn("There was an error loading the video resource to the atlas texture context"),console.warn(m),a.reject({}),o.reject({})};s.addEventListener("loadedmetadata",u),s.addEventListener("loadeddata",l),s.addEventListener("error",h),e.onReady=void 0,pi(this.waitingForVideo,n.videoSrc,new Set).add(e),this.waitForVideoSource.set(e,n.videoSrc),e.source=qa,e.videoLoad=()=>{s.load(),n.autoPlay&&s.play()},s.muted=!0,s.src=n.videoSrc,Promise.all([a.promise,o.promise]).then(()=>{s.currentTime=0,n.autoPlay&&s.play();const p=this.waitingForVideo.get(n.videoSrc);p&&p.forEach(m=>{m.source=n,m.onReady=this.originalOnReadyCallbacks.get(m)}),c()}).catch(()=>{c()})}updateAnimationState(){let e=!1;this.sourceToVideo.forEach(n=>{n.paused||(e=!0)}),this.isAnimationContinuous=this.usingVideo.size>0&&e}initShader(){return null}}yp.defaultProps={atlas:"default",key:"",data:new ke};var Jv=Object.defineProperty,ew=Object.getOwnPropertyDescriptor,_i=(t,e,n,i)=>{for(var r=i>1?void 0:i?ew(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(r=(i?a(e,n,r):a(r))||r);return i&&r&&Jv(e,n,r),r};const{max:tw}=Math,nw={[$.TopLeft]:(t,e)=>{t.x=-t.padding,t.y=-t.padding},[$.TopMiddle]:(t,e)=>{t.x=e.width/2,t.y=-t.padding},[$.TopRight]:(t,e)=>{t.x=e.width+t.padding,t.y=-t.padding},[$.MiddleLeft]:(t,e)=>{t.x=-t.padding,t.y=e.height/2},[$.Middle]:(t,e)=>{t.x=e.width/2,t.y=e.height/2},[$.MiddleRight]:(t,e)=>{t.x=e.width+t.padding,t.y=e.height/2},[$.BottomLeft]:(t,e)=>{t.x=-t.padding,t.y=e.height+t.padding},[$.BottomMiddle]:(t,e)=>{t.x=e.width/2,t.y=e.height+t.padding},[$.BottomRight]:(t,e)=>{t.x=e.width+t.padding,t.y=e.height+t.padding},[$.Custom]:(t,e)=>{t.x=t.x||0,t.y=t.y||0}},Tp=class extends pt{constructor(t){super(t),this.tint=[0,0,0,1],this.depth=0,this.height=1,this.origin=[0,0],this.scaling=Sn.BOUND_MAX,this.width=1,this.sourceWidth=0,this.sourceHeight=0,this._anchor={padding:0,type:$.TopLeft,x:0,y:0},this.videoLoad=ca,_t(this,Tp),this.depth=t.depth||this.depth,this.tint=t.tint||this.tint,this.scaling=t.scaling||this.scaling,this.origin=t.origin||this.origin,this.width=t.width||1,this.height=t.height||1,this.source=t.source,this.onReady=t.onReady,t.anchor&&this.setAnchor(t.anchor)}get maxSize(){return tw(this.width,this.height)}set maxSize(t){const e=this.width/this.height;this.width=t*e,this.height=t}get anchor(){return this._anchor}resourceTrigger(){this.source=this.source,this.request&&this.request.texture&&(this.sourceWidth=this.request.texture.pixelWidth,this.sourceHeight=this.request.texture.pixelHeight),this.onReady&&this.onReady(this)}setAnchor(t){const e={padding:t.padding||0,type:t.type,x:t.x||0,y:t.y||0};nw[e.type](e,this),this._anchor=e}};let Zn=Tp;_i([B],Zn.prototype,"tint",2),_i([B],Zn.prototype,"depth",2),_i([B],Zn.prototype,"height",2),_i([B],Zn.prototype,"origin",2),_i([B],Zn.prototype,"scaling",2),_i([B],Zn.prototype,"source",2),_i([B],Zn.prototype,"width",2),_i([B],Zn.prototype,"_anchor",2);var iw=Object.defineProperty,rw=Object.getOwnPropertyDescriptor,Jn=(t,e,n,i)=>{for(var r=i>1?void 0:i?rw(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(r=(i?a(e,n,r):a(r))||r);return i&&r&&iw(e,n,r),r};const Gl=class extends pt{constructor(t){super(t),this.anchor=[0,0],this.character="a",this.color=[1,1,1,1],this.depth=0,this.fontScale=1,this.maxScale=1,this.offset=[0,0],this.origin=[0,0],this.padding=[0,0],_t(this,Gl),this.origin=t.origin||this.origin,this.offset=t.offset||this.offset,this.character=t.character||this.character,this.color=t.color||this.color,this.maxScale=t.maxScale||this.maxScale,this.padding=t.padding||this.padding,this.anchor=t.anchor||this.anchor,this.onReady=t.onReady}clone(){const t=new Gl(this);t.onReady=this.onReady,t.request=this.request}resourceTrigger(){this.offset=this.offset,this.origin=this.origin,this.character=this.character,this.color=this.color,this.onReady&&this.onReady(this)}};let Wt=Gl;Jn([B],Wt.prototype,"anchor",2),Jn([B],Wt.prototype,"character",2),Jn([B],Wt.prototype,"color",2),Jn([B],Wt.prototype,"depth",2),Jn([B],Wt.prototype,"fontScale",2),Jn([B],Wt.prototype,"maxScale",2),Jn([B],Wt.prototype,"offset",2),Jn([B],Wt.prototype,"origin",2),Jn([B],Wt.prototype,"padding",2);const Ep=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec4 texColor = texture2D(fontMap, texCoord);
if (texColor.r <= 0.0) discard;
texColor.a = texColor.r;
gl_FragColor = texColor * vertexColor;
}`,bp=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec2 pushOut = normals * glyphSize * fontScale;
vec3 position = vec3(origin + padding - anchor + offset + pushOut, depth);
gl_Position = clipSpace(position);
texCoord = texture.xy + (texture.zw - texture.xy) * normals;
vertexColor = color * color.a;
}`,sw=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec4 texColor = texture2D(fontMap, texCoord);
if (texColor.r <= 0.0) discard;
texColor.a = texColor.r;
gl_FragColor = texColor * vertexColor;
}`,aw=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec2 scale = fontScale * cameraScale2D.xy;
float scaleBy = max(scale.x, scale.y) / maxScale;
vec2 pushOut = normals * glyphSize * fontScale;
float vx = mix(
(-anchor.x + offset.x + pushOut.x),
(-anchor.x + offset.x + pushOut.x) / scaleBy,
float(scale.x >= maxScale)
);
float vy = mix(
(-anchor.y + offset.y + pushOut.y),
(-anchor.y + offset.y + pushOut.y) / scaleBy,
float(scale.y >= maxScale)
);
vec3 position = vec3(origin + padding + vec2(vx, vy), depth);
gl_Position = clipSpace(position);
texCoord = texture.xy + (texture.zw - texture.xy) * normals;
vertexColor = color * color.a;
}`,ow=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec4 texColor = texture2D(fontMap, texCoord);
if (texColor.r <= 0.0) discard;
texColor.a = texColor.r;
gl_FragColor = texColor * vertexColor;
}`,cw=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec2 pushOut = normals * glyphSize * fontScale;
vec3 position = vec3(origin + padding + (-anchor + offset + pushOut) / cameraScale2D.xy, depth);
gl_Position = clipSpace(position);
texCoord = texture.xy + (texture.zw - texture.xy) * normals;
vertexColor = color * color.a;
}`,lw=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec4 texColor = texture2D(fontMap, texCoord);
if (texColor.r <= 0.0) discard;
texColor.a = texColor.r;
gl_FragColor = texColor * vertexColor;
}`,uw=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec2 pushOut = normals * glyphSize * fontScale;
vec3 position = vec3(origin + padding + offset + pushOut, depth);
gl_Position = clipSpace(position);
texCoord = texture.xy + (texture.zw - texture.xy) * normals;
vertexColor = color * color.a;
}`,hw=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec4 texColor = texture2D(fontMap, texCoord);
if (texColor.r <= 0.0) discard;
texColor.a = texColor.r;
gl_FragColor = texColor * vertexColor;
}`,dw=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec2 scale = fontScale * cameraScale2D.xy;
float scaleBy = max(scale.x, scale.y) / maxScale;
vec2 pushOut = normals * glyphSize * fontScale;
float vx = mix(
(origin.x + padding.x + offset.x + pushOut.x),
origin.x + anchor.x + (padding.x - anchor.x + offset.x + pushOut.x) / scaleBy,
float(scale.x >= maxScale)
);
float vy = mix(
(origin.y + padding.y + offset.y + pushOut.y),
origin.y + anchor.y + (padding.y - anchor.y + offset.y + pushOut.y) / scaleBy,
float(scale.y >= maxScale)
);
vec3 position = vec3(vec2(vx, vy), depth);
gl_Position = clipSpace(position);
texCoord = texture.xy + (texture.zw - texture.xy) * normals;
vertexColor = color * color.a;
}`,fw=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec4 texColor = texture2D(fontMap, texCoord);
if (texColor.r <= 0.0) discard;
texColor.a = texColor.r;
gl_FragColor = texColor * vertexColor;
}`,pw=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec2 pushOut = normals * glyphSize * fontScale;
vec3 position = vec3(origin + anchor + (padding - anchor + offset + pushOut) / cameraScale2D.xy , depth);
gl_Position = clipSpace(position);
texCoord = texture.xy + (texture.zw - texture.xy) * normals;
vertexColor = color * color.a;
}`,Nr=class extends nt{constructor(){super(...arguments),this.glyphRequests={}}initShader(){const t=this.props.animate||{},{anchor:e,color:n,offset:i,origin:r}=t,s={0:[0,0],1:[0,0],2:[1,0],3:[0,1],4:[1,1],5:[1,1]},a={name:"texture",resource:{key:()=>this.props.resourceKey||"",name:"fontMap"},update:h=>{const f=h.character;return(!h.request||h.character!==h.request.character)&&(this.glyphRequests[h.character]?h.request=this.glyphRequests[h.character]:(h.request=Ji({key:this.props.resourceKey||"",character:f}),this.glyphRequests[h.character]=h.request),h.request.fontMap&&h.onReady&&h.onReady(h)),h.request.fetch=Zi.TEXCOORDS,this.resource.request(this,h,h.request)}},o={name:"glyphSize",parentAttribute:a,resource:{key:()=>this.props.resourceKey||"",name:"fontMap"},size:k.TWO,update:h=>{const f=h.character;return(!h.request||h.character!==h.request.character)&&(this.glyphRequests[h.character]?h.request=this.glyphRequests[h.character]:(h.request=Ji({key:this.props.resourceKey||"",character:f}),this.glyphRequests[h.character]=h.request),h.request.fontMap&&h.onReady&&h.onReady(h)),h.request.fetch=Zi.IMAGE_SIZE,this.resource.request(this,h,h.request)}};a.childAttributes=[o];let c,l;switch(this.props.scaleMode||Sn.ALWAYS){case Sn.BOUND_MAX:{c=this.props.inTextArea?hw:sw,l=this.props.inTextArea?dw:aw;break}case Sn.NEVER:{c=this.props.inTextArea?ow:fw,l=this.props.inTextArea?pw:cw;break}case Sn.ALWAYS:{c=this.props.inTextArea?lw:Ep,l=this.props.inTextArea?uw:bp;break}default:{c=Ep,l=bp;break}}return{fs:c,instanceAttributes:[{easing:n,name:Nr.attributeNames.color,size:k.FOUR,update:h=>h.color},{name:Nr.attributeNames.depth,size:k.ONE,update:h=>[h.depth]},{name:"fontScale",size:k.ONE,update:h=>[h.fontScale]},{easing:e,name:Nr.attributeNames.anchor,size:k.TWO,update:h=>h.anchor},{easing:r,name:Nr.attributeNames.origin,size:k.TWO,update:h=>h.origin},{easing:i,name:Nr.attributeNames.offset,size:k.TWO,update:h=>h.offset},{name:"padding",size:k.TWO,update:h=>h.padding},{name:"maxScale",size:k.ONE,update:h=>[h.maxScale]},o,a],uniforms:[],vertexAttributes:[{name:"normals",size:vt.TWO,update:h=>s[h]}],vertexCount:6,vs:l}}draw(){super.draw()}getMaterialOptions(){return Object.assign({},It.transparentImageBlending,{depthTest:!1})}willUpdateProps(t){t.resourceKey!==this.props.resourceKey&&(Object.values(this.glyphRequests).forEach(e=>{delete e.fontMap,e.key=t.resourceKey||""}),this.rebuildLayer())}};let Ka=Nr;Ka.defaultProps={key:"",data:new ke,resourceKey:"No resource specified"},Ka.attributeNames={color:"color",depth:"depth",anchor:"anchor",origin:"origin",offset:"offset"};const gw="...",_p={[$.TopLeft]:(t,e)=>{t.x=0,t.y=0},[$.TopMiddle]:(t,e)=>{t.x=e.size[0]/2,t.y=0},[$.TopRight]:(t,e)=>{t.x=e.size[0],t.y=0},[$.MiddleLeft]:(t,e)=>{t.x=0,t.y=e.size[1]/2},[$.Middle]:(t,e)=>{t.x=e.size[0]/2,t.y=e.size[1]/2},[$.MiddleRight]:(t,e)=>{t.x=e.size[0],t.y=e.size[1]/2},[$.BottomLeft]:(t,e)=>{t.x=0,t.y=e.size[1]},[$.BottomMiddle]:(t,e)=>{t.x=e.size[0]/2,t.y=e.size[1]},[$.BottomRight]:(t,e)=>{t.x=e.size[0],t.y=e.size[1]},[$.Custom]:(t,e)=>{t.x=t.x||0,t.y=t.y||0}},Ri=[[-1,-1],[0,-1],[1,-1],[-1,0],[0,0],[1,0],[-1,1],[0,1],[1,1]].map(t=>{const e=Math.sqrt(gr(t,t));return He(t,1/-e)}),Rp={[$.TopLeft]:t=>{t.paddingDirection=He(Ri[0],t.padding)},[$.TopMiddle]:t=>{t.paddingDirection=He(Ri[1],t.padding)},[$.TopRight]:t=>{t.paddingDirection=He(Ri[2],t.padding)},[$.MiddleLeft]:t=>{t.paddingDirection=He(Ri[3],t.padding)},[$.Middle]:t=>{t.paddingDirection=[0,0]},[$.MiddleRight]:t=>{t.paddingDirection=He(Ri[5],t.padding)},[$.BottomLeft]:t=>{t.paddingDirection=He(Ri[6],t.padding)},[$.BottomMiddle]:t=>{t.paddingDirection=He(Ri[7],t.padding)},[$.BottomRight]:t=>{t.paddingDirection=He(Ri[8],t.padding)},[$.Custom]:t=>{t.paddingDirection=t.paddingDirection}};function ut(t){if(t)return e=>{t({...e,instances:e.instances.map(n=>n.parentLabel).filter(Xe)})}}class zl extends nt{constructor(){super(...arguments),this.fullUpdate=!1,this.glyphProvider=new ke,this.labelToGlyphs=new Map,this.labelToKerningRequest=new Map,this.labelWaitingOnGlyph=new Map,this.truncationWidth=-1,this.handleGlyphReady=e=>{if(!e.parentLabel){delete e.onReady;return}const n=e.parentLabel,i=this.labelWaitingOnGlyph.get(e.parentLabel);if(i&&i.has(e)&&(i.delete(e),i.size<=0)){const r=n.onReady;r&&r(n)}}}childLayers(){return[Yi(this.props.customGlyphLayer||Ka,{animate:this.props.animate,data:this.glyphProvider,key:`${this.id}.glyphs`,resourceKey:this.props.resourceKey,scaleMode:this.props.scaleMode||Sn.BOUND_MAX,inTextArea:this.props.inTextArea,picking:this.props.picking,onMouseClick:ut(this.props.onMouseClick),onMouseUp:ut(this.props.onMouseUp),onMouseDown:ut(this.props.onMouseDown),onMouseOut:ut(this.props.onMouseOut),onMouseOver:ut(this.props.onMouseOver),onMouseMove:ut(this.props.onMouseMove),onMouseUpOutside:ut(this.props.onMouseUpOutside),onTap:ut(this.props.onTap),onTouchDown:ut(this.props.onTouchDown),onTouchUp:ut(this.props.onTouchUp),onTouchUpOutside:ut(this.props.onTouchUpOutside),onTouchMove:ut(this.props.onTouchMove),onTouchOut:ut(this.props.onTouchOut),onTouchOver:ut(this.props.onTouchOver),onTouchAllEnd:ut(this.props.onTouchAllEnd),onTouchAllOut:ut(this.props.onTouchAllOut)})]}draw(){const e=this.resolveChanges();if(e.length<=0)return;if(!this.propertyIds){const h=e[0][0];this.propertyIds=this.getInstanceObservableIds(h,["text","active","anchor","color","origin","fontSize","maxWidth","maxScale","letterSpacing"])}const{text:n,active:i,anchor:r,color:s,origin:a,fontSize:o,maxWidth:c,maxScale:l,letterSpacing:u}=this.propertyIds;for(let h=0,f=e.length;h<f;++h){const[p,m,v]=e[h];switch(m){case Ze.CHANGE:if(!this.labelToGlyphs.get(p)){this.insert(p);continue}v[n]!==void 0?(this.invalidateRequest(p),this.layoutGlyphs(p)):v[i]!==void 0&&(p.active?(this.layoutGlyphs(p),this.showGlyphs(p)):this.hideGlyphs(p)),v[r]&&this.updateAnchor(p),v[s]!==void 0&&this.updateGlyphColors(p),v[a]!==void 0&&this.updateGlyphOrigins(p),v[l]!==void 0&&this.updateGlyphMaxScales(p),v[o]!==void 0&&(this.invalidateRequest(p),this.layoutGlyphs(p)),v[c]!==void 0&&(this.invalidateRequest(p),this.layoutGlyphs(p)),v[u]!==void 0&&(this.invalidateRequest(p),this.layoutGlyphs(p));break;case Ze.INSERT:this.insert(p);break;case Ze.REMOVE:{const T=this.labelToGlyphs.get(p);if(T){for(let b=0,E=T.length;b<E;++b)this.glyphProvider.remove(T[b]);this.labelToGlyphs.delete(p),this.labelToKerningRequest.delete(p),this.labelWaitingOnGlyph.delete(p)}break}}}}insert(e){e.preload?this.props.data.remove(e):this.labelToGlyphs.get(e)||this.labelToGlyphs.set(e,[]),this.layoutGlyphs(e)}hideGlyphs(e){const n=this.labelToGlyphs.get(e);if(n)for(let i=0,r=n.length;i<r;++i)this.glyphProvider.remove(n[i])}initShader(){return null}invalidateRequest(e){this.labelToKerningRequest.delete(e)}layoutGlyphs(e){if(!this.updateKerning(e)||!e.active)return;const n=this.labelToKerningRequest.get(e);if(!n||!n.fontMap)return;const i=n.metrics;if(!i||!i.layout)return;const r=i.layout;this.updateGlyphs(e,r);const s=e.glyphs;e.size=r.size,_p[e.anchor.type](e.anchor,e),Rp[e.anchor.type](e.anchor);const a=e.anchor,o=e.anchor.paddingDirection;for(let c=0,l=Math.min(r.positions.length,s.length);c<l;++c){const u=r.positions[c],h=s[c];h.offset=u,h.fontScale=r.fontScale,h.anchor=[a.x||0,a.y||0],h.origin=Hs(e.origin),h.padding=o||[0,0],h.maxScale=e.maxScale}}managesInstance(e){return!!this.labelToGlyphs.get(e)}showGlyphs(e){const n=this.labelToGlyphs.get(e);if(n)for(let i=0,r=n.length;i<r;++i)this.glyphProvider.add(n[i])}updateAnchor(e){const n=e.glyphs;if(!n)return;_p[e.anchor.type](e.anchor,e),Rp[e.anchor.type](e.anchor);const i=e.anchor,r=e.anchor.paddingDirection;for(let s=0,a=n.length;s<a;++s)n[s].anchor=[i.x||0,i.y||0],n[s].padding=r||[0,0]}updateGlyphs(e,n){let i=this.labelToGlyphs.get(e);i||(i=[],this.labelToGlyphs.set(e,i));let r=this.labelWaitingOnGlyph.get(e);r||(r=new Set,this.labelWaitingOnGlyph.set(e,r));for(let s=0,a=Math.min(i.length,n.glyphs.length);s<a;++s){const o=i[s];o.character!==n.glyphs[s]&&(o.character=n.glyphs[s],(!o.request||!o.request.fontMap||!o.request.fontMap.glyphMap[o.character])&&r.add(o))}if(i.length<n.glyphs.length){let s=0;for(let a=i.length,o=n.glyphs.length;a<o;++a,++s){const c=n.glyphs[a],l=new Wt({character:c,color:e.color,origin:e.origin,maxScale:e.maxScale,onReady:this.handleGlyphReady});l.parentLabel=e,i.push(l),e.active&&this.glyphProvider.add(l),r.add(l)}}else if(i.length>n.glyphs.length){for(let s=n.glyphs.length,a=i.length;s<a;++s){const o=i[s];this.glyphProvider.remove(o)}for(;i.length>n.glyphs.length;)i.pop()}e.glyphs=i}updateGlyphColors(e){const n=e.glyphs;if(n)for(let i=0,r=n.length;i<r;++i)n[i].color=Zt(e.color)}updateGlyphOrigins(e){const n=e.glyphs;if(!n)return;const i=e.origin;for(let r=0,s=n.length;r<s;++r)n[r].origin=[i[0],i[1]]}updateGlyphMaxScales(e){const n=e.glyphs;if(!n)return;const i=e.maxScale;for(let r=0,s=n.length;r<s;++r)n[r].maxScale=i}updateKerning(e){let n=this.labelToKerningRequest.get(e);const i=e.text;if(n){if(n.kerningPairs&&n.kerningPairs.indexOf(i)>-1)return!!n.fontMap;if(n.fontMap&&!n.fontMap.supportsKerning(i.replace(/\s/g,"")))this.labelToKerningRequest.delete(e),n=void 0;else return!0}if(!n){const r={fontSize:e.fontSize,text:e.text,letterSpacing:e.letterSpacing};return e.maxWidth>0&&(r.maxWidth=e.maxWidth,r.truncation=this.props.truncation||gw),n=Ji({key:this.props.resourceKey||"",character:"",kerningPairs:[i],metrics:r}),e.preload?(e.resourceTrigger=()=>{e.onReady&&e.onReady(e)},this.resource.request(this,e,n)):(this.resource.request(this,e,n,{resource:{type:xe.FONT,key:this.props.resourceKey||""}}),this.labelToKerningRequest.set(e,n)),!1}return!0}willUpdateProps(e){e.data!==this.props.data&&delete this.propertyIds,e.scaleMode!==this.props.scaleMode&&this.rebuildLayer(),e.resourceKey!==this.props.resourceKey&&(this.fullUpdate=!0)}}zl.defaultProps={key:"",data:new ke};var mw=Object.defineProperty,vw=Object.getOwnPropertyDescriptor,In=(t,e,n,i)=>{for(var r=i>1?void 0:i?vw(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(r=(i?a(e,n,r):a(r))||r);return i&&r&&mw(e,n,r),r};const Ap=class extends pt{constructor(t){super(t),this.color=[0,0,0,1],this.depth=0,this.fontSize=12,this.maxScale=1,this.maxWidth=0,this.origin=[0,0],this.scale=1,this.text="",this.letterSpacing=0,this.preload=!1,this.glyphs=[],this.size=[0,0],this.truncatedText="",this.anchor={padding:0,paddingDirection:[0,0],type:$.TopLeft,x:0,y:0},_t(this,Ap),this.anchor=t.anchor||this.anchor,this.color=t.color||this.color,this.depth=t.depth||this.depth,this.fontSize=t.fontSize||this.fontSize,this.maxScale=t.maxScale||this.maxScale,this.maxWidth=t.maxWidth||0,this.onReady=t.onReady,this.origin=t.origin,this.preload=t.preload||!1,this.scale=t.scale||this.scale,this.text=t.text||this.text,this.letterSpacing=t.letterSpacing||this.letterSpacing,t.anchor&&this.setAnchor(t.anchor)}getWidth(){return this.size[0]}setAnchor(t){const e={padding:t.padding||0,paddingDirection:t.paddingDirection,type:t.type,x:t.x||0,y:t.y||0};this.anchor=e}subTextGlyphs(t){const e=[],n=this.text.indexOf(t);if(n<0)return e;let i=0;for(let r=0,s=Math.min(this.text.length,n+t.length);r<s;++r)Gi(this.text[r])||(i++,r>=n&&e.push(this.glyphs[i]));return e}resourceTrigger(){}};let Re=Ap;In([B],Re.prototype,"color",2),In([B],Re.prototype,"depth",2),In([B],Re.prototype,"fontSize",2),In([B],Re.prototype,"maxScale",2),In([B],Re.prototype,"maxWidth",2),In([B],Re.prototype,"origin",2),In([B],Re.prototype,"scale",2),In([B],Re.prototype,"text",2),In([B],Re.prototype,"letterSpacing",2),In([B],Re.prototype,"anchor",2);var ww=Object.defineProperty,yw=Object.getOwnPropertyDescriptor,rr=(t,e,n,i)=>{for(var r=i>1?void 0:i?yw(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(r=(i?a(e,n,r):a(r))||r);return i&&r&&ww(e,n,r),r},Za=(t=>(t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.CENTERED=2]="CENTERED",t))(Za||{}),Cn=(t=>(t[t.NONE=0]="NONE",t[t.CHARACTER=1]="CHARACTER",t[t.WORD=2]="WORD",t))(Cn||{}),Pr=(t=>(t[t.NEWLINE=0]="NEWLINE",t))(Pr||{});const Sp=class extends Re{constructor(t){super(t),this.maxHeight=0,this.lineHeight=0,this.wordWrap=0,this.alignment=0,this.labels=[],this.newLabels=[],this.borders=[],this.padding=[0,0,0,0],this.borderWidth=6,this.hasBorder=!0,this.spaceWidth=0,_t(this,Sp),this.color=t.color,this.origin=t.origin,this.oldOrigin=t.origin,this.text=t.text,this.fontSize=t.fontSize||this.fontSize,this.maxWidth=t.maxWidth||this.maxWidth,this.maxHeight=t.maxHeight||this.maxHeight,this.lineHeight=t.lineHeight||this.lineHeight,this.wordWrap=t.wordWrap||this.wordWrap,this.alignment=t.alignment||this.alignment,this.padding=t.padding||this.padding,this.borderWidth=t.borderWidth||this.borderWidth,this.hasBorder=t.hasBorder!==void 0?t.hasBorder:this.hasBorder,this.letterSpacing=t.letterSpacing||this.letterSpacing}};let Ai=Sp;rr([B],Ai.prototype,"maxHeight",2),rr([B],Ai.prototype,"lineHeight",2),rr([B],Ai.prototype,"wordWrap",2),rr([B],Ai.prototype,"alignment",2),rr([B],Ai.prototype,"padding",2),rr([B],Ai.prototype,"borderWidth",2),rr([B],Ai.prototype,"hasBorder",2);var Tw=Object.defineProperty,Ew=Object.getOwnPropertyDescriptor,Si=(t,e,n,i)=>{for(var r=i>1?void 0:i?Ew(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(r=(i?a(e,n,r):a(r))||r);return i&&r&&Tw(e,n,r),r};const bw={[$.TopLeft]:(t,e)=>{t.x=-t.padding,t.y=-t.padding},[$.TopMiddle]:(t,e)=>{t.x=e.size[0]/2,t.y=-t.padding},[$.TopRight]:(t,e)=>{t.x=e.size[0]+t.padding,t.y=-t.padding},[$.MiddleLeft]:(t,e)=>{t.x=-t.padding,t.y=e.size[1]/2},[$.Middle]:(t,e)=>{t.x=e.size[0]/2,t.y=e.size[1]/2},[$.MiddleRight]:(t,e)=>{t.x=e.size[0]+t.padding,t.y=e.size[1]/2},[$.BottomLeft]:(t,e)=>{t.x=-t.padding,t.y=e.size[1]+t.padding},[$.BottomMiddle]:(t,e)=>{t.x=e.size[0]/2,t.y=e.size[1]+t.padding},[$.BottomRight]:(t,e)=>{t.x=e.size[0]+t.padding,t.y=e.size[1]+t.padding},[$.Custom]:(t,e)=>{t.x=t.x||0,t.y=t.y||0}},Mp=class extends pt{constructor(t){super(t),this.color=[0,0,0,1],this.depth=0,this.maxScale=1,this.scale=1,this.scaling=Sn.BOUND_MAX,this.size=[1,1],this.position=[0,0],this._anchor={padding:0,type:$.TopLeft,x:0,y:0},_t(this,Mp),this.depth=t.depth||this.depth,this.color=t.color||this.color,this.scaling=t.scaling||this.scaling,this.position=t.position||this.position,this.size=t.size||this.size,t.anchor&&this.setAnchor(t.anchor)}get anchor(){return this._anchor}setAnchor(t){const e={padding:t.padding||0,type:t.type,x:t.x||0,y:t.y||0};bw[e.type](e,this),this._anchor=e}};let Ln=Mp;Si([B],Ln.prototype,"color",2),Si([B],Ln.prototype,"depth",2),Si([B],Ln.prototype,"maxScale",2),Si([B],Ln.prototype,"scale",2),Si([B],Ln.prototype,"scaling",2),Si([B],Ln.prototype,"size",2),Si([B],Ln.prototype,"position",2),Si([B],Ln.prototype,"_anchor",2);var _w=Object.defineProperty,Rw=Object.getOwnPropertyDescriptor,Vl=(t,e,n,i)=>{for(var r=i>1?void 0:i?Rw(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(r=(i?a(e,n,r):a(r))||r);return i&&r&&_w(e,n,r),r};const xp=class extends Ln{constructor(t){super(t),this.fontScale=1,this.textAreaOrigin=[0,0],this.textAreaAnchor=[0,0],_t(this,xp),this.fontScale=t.fontScale||this.fontScale,this.textAreaOrigin=t.textAreaOrigin||this.textAreaOrigin,this.textAreaAnchor=t.textAreaAnchor||this.textAreaAnchor}};let sr=xp;Vl([B],sr.prototype,"fontScale",2),Vl([B],sr.prototype,"textAreaOrigin",2),Vl([B],sr.prototype,"textAreaAnchor",2);const Aw=`precision highp float;
varying vec4 vertexColor;
void main() {
gl_FragColor = vertexColor;
}`,Sw=`precision highp float;
varying vec4 vertexColor;
void main() {
float borderScale = mix(fontScale, 1.0, float(scaling == 3.0));
vec3 screenSize = cameraSpaceSize(vec3(size * scale * borderScale / scaleFactor / maxScale, 1.0));
bool largerOnScreen = screenSize.y > size.y || screenSize.x > size.x;
float useScaleMode = float(
(
scaling == 3.0 ||
(largerOnScreen && scaling == 2.0)
) &&
scaling != 1.0
);
float unequalZooms = float(cameraScale2D.x != cameraScale2D.y);
vec2 adjustedSize = mix(
size,
(size * cameraScale2D.yx),
unequalZooms
);
float normal = normals.x;
float side = normals.y;
vec2 scaledAnchor = anchor * scale;
vec2 worldAnchor = location + scaledAnchor;
vec2 adjustedAnchor = mix(
scaledAnchor,
(scaledAnchor * cameraScale2D.yx),
unequalZooms
);
vec2 vertex = vec2(side, float(normal == 1.0)) * scale * adjustedSize + location - adjustedAnchor;
float labelScreenScale = mix(
screenSize.y / adjustedSize.y,
screenSize.x / adjustedSize.x,
float((cameraScale2D.x != 1.0))
);
float currentScale = labelScreenScale * scale;
vec2 anchorToVertex = vertex - location;
vertex = mix(
vertex + textAreaOrigin,
(anchorToVertex + location - textAreaAnchor) / labelScreenScale + textAreaOrigin + textAreaAnchor,
useScaleMode
);
vertexColor = color;
gl_Position = clipSpace(vec3(vertex, depth));
}`,On=class extends nt{initShader(){const t=this.props.animate||{},e={0:1,1:1,2:-1,3:1,4:-1,5:-1},n={0:0,1:0,2:0,3:1,4:1,5:1},{scaleFactor:i=()=>1}=this.props;return{fs:Aw,instanceAttributes:[{easing:t.location,name:On.attributeNames.location,size:k.TWO,update:r=>r.position},{name:On.attributeNames.anchor,size:k.TWO,update:r=>[r.anchor.x||0,r.anchor.y||0]},{name:On.attributeNames.size,size:k.TWO,update:r=>r.size},{name:On.attributeNames.depth,size:k.ONE,update:r=>[r.depth]},{name:On.attributeNames.scaling,size:k.ONE,update:r=>[r.scaling]},{easing:t.color,name:On.attributeNames.color,size:k.FOUR,update:r=>r.color},{name:On.attributeNames.scale,size:k.ONE,update:r=>[r.scale]},{name:On.attributeNames.maxScale,size:k.ONE,update:r=>[r.maxScale]},{name:On.attributeNames.fontScale,size:k.ONE,update:r=>[r.fontScale]},{name:"textAreaOrigin",size:k.TWO,update:r=>r.textAreaOrigin},{name:"textAreaAnchor",size:k.TWO,update:r=>r.textAreaAnchor}],uniforms:[{name:"scaleFactor",size:O.ONE,update:r=>[i()]}],vertexAttributes:[{name:"normals",size:vt.TWO,update:r=>[e[r],n[r]]}],vertexCount:6,vs:Sw}}getMaterialOptions(){return It.transparentShapeBlending}};let Wl=On;Wl.defaultProps={key:"",data:new ke},Wl.attributeNames={anchor:"anchor",color:"color",depth:"depth",fontScale:"fontScale",location:"location",maxScale:"maxScale",scale:"scale",scaling:"scaling",size:"size"};const Mi={[$.TopLeft]:t=>[0,0],[$.TopMiddle]:t=>[t.maxWidth/2,0],[$.TopRight]:t=>[t.maxWidth,0],[$.MiddleLeft]:t=>[0,t.maxHeight/2],[$.Middle]:t=>[t.maxWidth/2,t.maxHeight/2],[$.MiddleRight]:t=>[t.maxWidth,t.maxHeight/2],[$.BottomLeft]:t=>[0,t.maxHeight],[$.BottomMiddle]:t=>[t.maxWidth/2,t.maxHeight],[$.BottomRight]:t=>[t.maxWidth,t.maxHeight],[$.Custom]:t=>[t.anchor.x||0,t.anchor.y||0]};function Ja(t,e){let n=Number.MAX_SAFE_INTEGER;for(let i=0,r=t.length;i<r;i++){const s=t[i],a=e.get(s);a===0?n=0:a&&a<n&&(n=a)}return n===Number.MAX_SAFE_INTEGER?0:n}function Mw(t){const e=[],n=t.split(Xu);for(let s=0,a=n.length-1;s<a;s++)n[s].split(" ").forEach(l=>{l!==""&&e.push(l)}),e.push(`
`);return n[n.length-1].split(" ").forEach(s=>{s!==""&&e.push(s)}),e}function xw(t,e){const n=new Map;if(e.fontMap){const i=e.fontMap.fontSource.size,r=t.fontSize/i,s=e.fontMap,a=t.text.replace(/\s/g,"");let o=Number.MAX_SAFE_INTEGER,c=0,l,u="";for(let h=0,f=a.length;h<f;++h){const p=a[h];l=0,u&&(l=s.kerning[u][p][1]||0),c=c+l*r,n.set(p,c),o=Math.min(c,o),u=p}n.forEach((h,f)=>{n.set(f,h-o)})}return n}function Iw(t,e,n){const i=[],r=n.fontMap?n.fontMap.fontSource.size:e.fontSize,s=e.fontSize/r;let a="",o=0,c=[0,0];for(let l=0,u=t.text.length;l<u;l++){const h=t.text[l];if(n.fontMap){let f=[0,0];a&&(f=n.fontMap.kerning[a][h]||[0,0]),c=Fn(c,He(f,s)),l!==0&&(c=Fn(c,[e.letterSpacing,0]));const p=n.fontMap.glyphMap[h];o=c[0]+p.pixelWidth*s,i.push(o),a=h}}return i}class Ip extends nt{constructor(){super(...arguments),this.providers={labels:new ke,borders:new ke},this.fullUpdate=!1,this.areaToLabels=new Map,this.areaToLines=new Map,this.areaWaitingOnLabel=new Map,this.areaTokerningRequest=new Map,this.areaToWords=new Map,this.labelsInLine=[],this.handleLabelReady=e=>{if(!e.parentTextArea){delete e.onReady;return}const n=e.parentTextArea,i=this.areaWaitingOnLabel.get(n);if(i&&i.has(e)&&(i.delete(e),i.size<=0)){n.active=!0;const r=n.onReady;r&&r(n)}}}childLayers(){const e=this.props.animateLabel||{},n=this.props.animateBorder||{},i=this.props.scaling;return[Yi(zl,{animate:e,customGlyphLayer:this.props.customGlyphLayer,data:this.providers.labels,key:`${this.id}.labels`,resourceKey:this.props.resourceKey,scaleMode:i,inTextArea:!0}),Yi(Wl,{animate:{color:n.color,location:n.location},data:this.providers.borders,key:`${this.id}.border`})]}draw(){const e=this.resolveChanges();if(e.length<=0)return;if(!this.propertyIds){const T=e[0][0];this.propertyIds=this.getInstanceObservableIds(T,["active","alignment","borderWidth","color","fontSize","hasBorder","letterSpacing","lineHeight","maxHeight","maxWidth","origin","padding","text","wordWrap"])}const{active:n,alignment:i,borderWidth:r,color:s,fontSize:a,hasBorder:o,letterSpacing:c,lineHeight:l,maxHeight:u,maxWidth:h,origin:f,padding:p,text:m,wordWrap:v}=this.propertyIds;for(let T=0,b=e.length;T<b;++T){const[E,S,I]=e[T];switch(S){case Ze.CHANGE:if(!this.areaToLabels.get(E)){this.insert(E);continue}I[m]!==void 0?(this.clear(E),this.updateLabels(E),this.layout(E)):I[n]!==void 0&&(E.active?(this.layout(E),this.showLabels(E)):this.hideLabels(E)),I[i]!==void 0&&(this.clear(E),this.updateLabels(E),this.layoutLabels(E)),I[s]!==void 0&&this.updateLabelColors(E),I[f]!==void 0&&this.updateLabelOrigins(E),I[a]!==void 0&&this.updateLabelFontSizes(E),I[v]!==void 0&&this.updateLabelLineWrap(E),I[l]!==void 0&&this.updateLabelLineHeight(E),I[h]!==void 0&&this.updateTextAreaSize(E),I[u]!==void 0&&this.updateTextAreaSize(E),I[p]!==void 0&&this.updateTextAreaSize(E),I[r]!==void 0&&this.updateBorderWidth(E),I[o]!==void 0&&this.updateBorder(E),I[c]!==void 0&&this.updateLetterSpacing(E);break;case Ze.INSERT:this.insert(E);break;case Ze.REMOVE:{const M=this.areaToLabels.get(E);if(M){for(let N=0,x=M.length;N<x;++N){const P=M[N];P instanceof Re&&this.providers.labels.remove(P)}this.areaToLabels.delete(E),this.areaWaitingOnLabel.delete(E)}break}}}}insert(e){this.layout(e),this.updateLabels(e)}hideLabels(e){const n=this.areaToLabels.get(e);if(n)for(let i=0,r=n.length;i<r;++i){const s=n[i];s instanceof Re&&this.providers.labels.remove(s)}}initShader(){return null}clear(e){const n=e.labels;for(let r=0,s=n.length;r<s;r++){const a=n[r];a instanceof Re&&this.providers.labels.remove(a)}e.labels=[];const i=e.newLabels;for(let r=0,s=i.length;r<s;r++){const a=i[r];a instanceof Re&&this.providers.labels.remove(a)}e.newLabels=[],this.areaToLabels.delete(e),this.areaWaitingOnLabel.delete(e),this.areaToWords.delete(e)}seperateLabel(e,n,i,r,s,a,o,c,l){const u=e.padding[0],h=e.padding[1]||0,f=e.padding[2]||0,p=e.padding[3]||0,m=e.maxWidth-p-h,v=e.maxHeight-u-f,T=e.origin[0],b=e.origin[1];n.active=!1;const E=r.substring(0,s+1),S=Ja(E,i),I=Mi[e.anchor.type](e),M=new Re({anchor:{padding:0,type:$.Custom,paddingDirection:[a+p,o+u+S],x:I[0],y:I[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[T,b],text:E});if(M.size=[l[s],n.size[1]],this.providers.labels.add(M),e.newLabels.push(M),this.labelsInLine.push(M),a+=M.getWidth()+c,e.wordWrap===Cn.CHARACTER||e.wordWrap===Cn.WORD){if(this.setTextAlignment(a,o,c,m,e.alignment),a=0,o+=e.lineHeight,o+e.lineHeight<=v){let N=l[l.length-1]-l[s];for(;N>m&&o+e.lineHeight<=v;){let x=l.length-1;for(;l[x]-l[s]>m;)x--;const P=r.substring(s+1,x+1),te=Ja(P,i),W=new Re({anchor:{padding:0,type:$.Custom,paddingDirection:[a+p,o+u+te],x:I[0],y:I[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[T,b],text:P});W.size=[l[x]-l[s],n.size[1]],a+=W.getWidth()+c,this.labelsInLine.push(W),this.providers.labels.add(W),e.newLabels.push(W),this.setTextAlignment(a,o,c,m,e.alignment),a=0,o+=e.lineHeight,s=x,N=l[l.length-1]-l[s]}if(o+e.lineHeight<=v){const x=r.substring(s+1),P=Ja(x,i),te=new Re({anchor:{padding:0,type:$.Custom,paddingDirection:[a+p,o+u+P],x:I[0],y:I[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[T,b],text:x});te.size=[l[l.length-1]-l[s],n.size[1]],this.labelsInLine.push(te);const W=[];for(let V=s+1;V<l.length;V++)W.push(l[V]-l[s]);this.providers.labels.add(te),e.newLabels.push(te),a+=te.getWidth()+c}}}else e.wordWrap===Cn.NONE&&(a+=M.getWidth()+c);return[a,o]}updateLabelLineWrap(e){const n=this.areaToLabels.get(e);if(n){for(let i=0,r=n.length;i<r;++i){const s=n[i];s instanceof Re&&(s.active=!0)}for(let i=0,r=e.newLabels.length;i<r;++i){const s=e.newLabels[i];this.providers.labels.remove(s)}e.newLabels=[],this.layoutLabels(e)}}updateLabelLineHeight(e){const n=this.areaToLabels.get(e);if(n){for(let i=0,r=n.length;i<r;++i){const s=n[i];s instanceof Re&&(s.active=!0)}for(let i=0,r=e.newLabels.length;i<r;++i){const s=e.newLabels[i];this.providers.labels.remove(s)}e.newLabels=[],this.layoutLabels(e)}}updateTextAreaSize(e){const n=this.areaToLabels.get(e);if(n){for(let i=0,r=n.length;i<r;++i){const s=n[i];s instanceof Re&&(s.active=!0)}for(let i=0,r=e.newLabels.length;i<r;++i){const s=e.newLabels[i];this.providers.labels.remove(s)}e.newLabels=[];for(let i=0,r=e.borders.length;i<r;++i){const s=e.borders[i];this.providers.borders.remove(s)}e.borders=[],this.layoutBorder(e),this.layoutLabels(e)}}updateBorderWidth(e){for(let n=0,i=e.borders.length;n<i;++n){const r=e.borders[n];this.providers.borders.remove(r)}e.borders=[],this.layoutBorder(e)}updateBorder(e){if(e.hasBorder)this.layoutBorder(e);else{for(let n=0,i=e.borders.length;n<i;++n){const r=e.borders[n];this.providers.borders.remove(r)}e.borders=[]}}updateLetterSpacing(e){this.clear(e),this.updateLabels(e),this.layout(e)}setTextAlignment(e,n,i,r,s){if(e-i<r&&s!==Za.LEFT){const a=r-e+i,o=s===Za.RIGHT?a:a/2;this.labelsInLine.forEach(c=>{const l=c.anchor;c.anchor={padding:l.padding,type:$.Custom,paddingDirection:[(l.paddingDirection?l.paddingDirection[0]:0)+o,l.paddingDirection?l.paddingDirection[1]:n],x:l.x,y:l.y}})}this.labelsInLine=[]}layoutBorder(e){if(e.hasBorder){const n=this.areaTokerningRequest.get(e);if(!n)return;const i=n.fontMap?n.fontMap.fontSource.size:e.fontSize,r=e.fontSize/i,s=this.props.scaling,a=e.borderWidth,o=new sr({color:e.color,fontScale:r,scaling:s,size:[e.maxWidth+2*a,a],textAreaOrigin:e.origin,textAreaAnchor:Mi[e.anchor.type](e),position:[-a,-a]}),c=new sr({color:e.color,fontScale:r,scaling:s,size:[a,e.maxHeight+2*a],textAreaOrigin:e.origin,textAreaAnchor:Mi[e.anchor.type](e),position:[-a,-a]}),l=new sr({color:e.color,fontScale:r,scaling:s,size:[a,e.maxHeight+2*a],textAreaOrigin:e.origin,textAreaAnchor:Mi[e.anchor.type](e),position:[e.maxWidth,-a]}),u=new sr({color:e.color,fontScale:r,scaling:s,size:[e.maxWidth+2*a,a],textAreaOrigin:e.origin,textAreaAnchor:Mi[e.anchor.type](e),position:[-a,e.maxHeight]});this.providers.borders.add(o),this.providers.borders.add(c),this.providers.borders.add(l),this.providers.borders.add(u),e.borders.push(o),e.borders.push(c),e.borders.push(l),e.borders.push(u)}}layoutLabels(e){const n=this.areaTokerningRequest.get(e);if(!n)return;const i=e.padding[0],r=e.padding[1]||0,s=e.padding[2]||0,a=e.padding[3]||0,o=e.maxWidth-a-r,c=e.maxHeight-i-s,l=e.origin[0],u=e.origin[1];let h=0;if(e.spaceWidth)h=e.spaceWidth;else{if(n.fontMap){const v=n.fontMap.fontSource.size,T=e.fontSize/v;h=n.fontMap.spaceWidth*T}else h=this.props.whiteSpaceKerning||e.fontSize/2;e.spaceWidth=h}const f=xw(e,n);let p=0,m=0;this.labelsInLine=[];for(let v=0,T=e.labels.length;v<T;++v){const b=e.labels[v];if(b instanceof Re){const E=b.getWidth(),S=Ja(b.text,f),I=Iw(b,e,n);if(m+e.lineHeight<=c&&I[0]<=o)if(p+E<=o){b.origin=[l,u];const M=Mi[e.anchor.type](e);b.anchor={padding:0,paddingDirection:[p+a,m+i+S],type:$.Custom,x:M[0],y:M[1]},p+=E+h,this.labelsInLine.push(b),p>=o&&e.wordWrap===Cn.CHARACTER&&v+1<T&&e.labels[v+1]!==Pr.NEWLINE&&(this.setTextAlignment(p,m,h,o,e.alignment),p=0,m+=e.lineHeight)}else if(e.wordWrap===Cn.WORD&&b.getWidth()<=e.maxWidth)if(this.setTextAlignment(p,m,h,o,e.alignment),p=0,m+=e.lineHeight,m+e.lineHeight<=c){b.origin=[l,u];const M=Mi[e.anchor.type](e);b.anchor={padding:0,paddingDirection:[p+a,m+i+S],type:$.Custom,x:M[0],y:M[1]},this.labelsInLine.push(b),p+=b.getWidth()+h}else b.active=!1;else{const M=o-p;let N=I.length-1;const x=b.text;for(;I[N]>M;)N--;if(N>=0){const P=this.seperateLabel(e,b,f,x,N,p,m,h,I);p=P[0],m=P[1]}else if(e.wordWrap===Cn.CHARACTER||e.wordWrap===Cn.WORD)if(this.setTextAlignment(p,m,h,o,e.alignment),m+=e.lineHeight,p=0,m+e.lineHeight<c)if(p+b.getWidth()<=o){b.origin=[l,u];const P=Mi[e.anchor.type](e);b.anchor={padding:0,paddingDirection:[p+a,m+i+S],type:$.Custom,x:P[0],y:P[1]},this.labelsInLine.push(b),p+=b.getWidth()+h,p>=o&&v+1<T&&e.labels[v+1]!==Pr.NEWLINE&&(this.setTextAlignment(p,m,h,o,e.alignment),p=0,m+=e.lineHeight)}else{const P=o-p;let te=I.length-1;const W=b.text;for(;I[te]>P;)te--;if(te>=0){const V=this.seperateLabel(e,b,f,W,te,p,m,h,I);p=V[0],m=V[1]}}else b.active=!1;else e.wordWrap===Cn.NONE&&(b.active=!1)}else b.active=!1}else b===Pr.NEWLINE&&(this.setTextAlignment(p,m,h,o,e.alignment),p=0,m+=e.lineHeight)}this.setTextAlignment(p,m,h,o,e.alignment)}layout(e){this.updateKerning(e);const n=this.areaTokerningRequest.get(e);if(!n||!n.fontMap)return;const i=this.areaWaitingOnLabel.get(e);if(i&&i.size>0||!e.active)return;const r=this.areaToLabels.get(e);!r||r.length===0||(this.updateLabels(e),this.layoutBorder(e),this.layoutLabels(e))}updateKerning(e){let n=this.areaTokerningRequest.get(e);const i=e.text;if(n){if(n.kerningPairs&&n.kerningPairs.indexOf(i)>-1)return!!n.fontMap;if(n.fontMap&&!n.fontMap.supportsKerning(i))this.areaTokerningRequest.delete(e),n=void 0;else return!1}else{const r={fontSize:e.fontSize,text:e.text,letterSpacing:e.letterSpacing};return n=Ji({character:"",key:this.props.resourceKey||"",kerningPairs:[i],metrics:r}),e.preload?(e.resourceTrigger=()=>{e.onReady&&e.onReady(e)},this.resource.request(this,e,n)):(this.resource.request(this,e,n),this.areaTokerningRequest.set(e,n)),!1}return!0}managesInstance(e){return!!this.areaToLabels.get(e)}showLabels(e){const n=this.areaToLabels.get(e);if(n)for(let i=0,r=n.length;i<r;++i){const s=n[i];s instanceof Re&&this.providers.labels.add(s)}}updateLabels(e){let n=this.areaToLabels.get(e);const i=e.padding[0],r=e.padding[3]||0,s=e.origin[0]+r,a=e.origin[1]+i;n||(n=[],this.areaToLabels.set(e,n));let o=this.areaWaitingOnLabel.get(e);o||(o=new Set,this.areaWaitingOnLabel.set(e,o));let c=this.areaToWords.get(e);if(c||(c=Mw(e.text)),n.length<c.length)for(let l=n.length,u=c.length;l<u;++l){const h=c[l];if(h===`
`)n.push(Pr.NEWLINE);else{const f=new Re({active:!1,color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,text:h,origin:[s,a],onReady:this.handleLabelReady});f.parentTextArea=e,n.push(f),this.providers.labels.add(f),o.add(f)}}e.labels=n}updateLabelColors(e){const n=this.areaToLabels.get(e);if(n){for(let i=0,r=n.length;i<r;++i){const s=n[i];s instanceof Re&&(s.color=Zt(e.color))}for(let i=0,r=e.newLabels.length;i<r;++i)e.newLabels[i].color=Zt(e.color);for(let i=0,r=e.borders.length;i<r;++i)e.borders[i].color=Zt(e.color)}}updateLabelFontSizes(e){this.clear(e),this.updateLabels(e),this.areaTokerningRequest.delete(e),this.layout(e)}updateLabelOrigins(e){const n=this.areaToLabels.get(e);if(!n)return;const i=e.origin,r=e.oldOrigin;for(let s=0,a=n.length;s<a;++s){const o=n[s];if(o instanceof Re){const c=o.origin;o.origin=[c[0]+i[0]-r[0],c[1]+i[1]-r[1]]}}for(let s=0,a=e.newLabels.length;s<a;++s){const o=e.newLabels[s];if(o instanceof Re){const c=o.origin;o.origin=[c[0]+i[0]-r[0],c[1]+i[1]-r[1]]}}for(let s=0,a=e.borders.length;s<a;++s){const o=e.borders[s];o.position=[o.position[0]+i[0]-r[0],o.position[1]+i[1]-r[1]]}e.oldOrigin=e.origin}willUpdateProps(e){e.data!==this.props.data&&delete this.propertyIds,e.resourceKey!==this.props.resourceKey&&(this.fullUpdate=!0)}}Ip.defaultProps={key:"",data:new ke,scaling:Sn.ALWAYS};const Cw=`precision highp float;
varying vec4 vertexColor;
void main() {
gl_FragColor = vertexColor;
}`,Lw=`precision highp float;
varying vec4 vertexColor;
void main() {
vec3 screenSize = cameraSpaceSize(vec3(size * scale / scaleFactor / maxScale, 1.0));
bool largerOnScreen = screenSize.y > size.y || screenSize.x > size.x;
float useScaleMode = float(
(
scaling == 3.0 ||
(largerOnScreen && scaling == 2.0)
) &&
scaling != 1.0
);
float unequalZooms = float(cameraScale2D.x != cameraScale2D.y);
vec2 adjustedSize = mix(
size,
(size * cameraScale2D.yx),
unequalZooms
);
float normal = normals.x;
float side = normals.y;
vec2 scaledAnchor = anchor * scale;
vec2 worldAnchor = location + scaledAnchor;
vec2 adjustedAnchor = mix(
scaledAnchor,
(scaledAnchor * cameraScale2D.yx),
unequalZooms
);
vec2 vertex = vec2(side, float(normal == 1.0)) * scale * adjustedSize + location - adjustedAnchor;
float labelScreenScale = mix(
screenSize.y / adjustedSize.y,
screenSize.x / adjustedSize.x,
float((cameraScale2D.x != 1.0))
);
float currentScale = labelScreenScale * scale;
vec2 anchorToVertex = vertex - location;
vertex = mix(
vertex,
(anchorToVertex / labelScreenScale) + location,
useScaleMode
);
vertexColor = color;
gl_Position = clipSpace(vec3(vertex, depth));
}`,ei=class extends nt{initShader(){const t=this.props.animate||{},e={0:1,1:1,2:-1,3:1,4:-1,5:-1},n={0:0,1:0,2:0,3:1,4:1,5:1},{scaleFactor:i=()=>1}=this.props;return{fs:Cw,instanceAttributes:[{easing:t.location,name:ei.attributeNames.location,size:k.TWO,update:r=>r.position},{name:ei.attributeNames.anchor,size:k.TWO,update:r=>[r.anchor.x||0,r.anchor.y||0]},{name:ei.attributeNames.size,size:k.TWO,update:r=>r.size},{name:ei.attributeNames.depth,size:k.ONE,update:r=>[r.depth]},{name:ei.attributeNames.scaling,size:k.ONE,update:r=>[r.scaling]},{easing:t.color,name:ei.attributeNames.color,size:k.FOUR,update:r=>r.color},{name:ei.attributeNames.scale,size:k.ONE,update:r=>[r.scale]},{name:ei.attributeNames.maxScale,size:k.ONE,update:r=>[r.maxScale]}],uniforms:[{name:"scaleFactor",size:O.ONE,update:r=>[i()]}],vertexAttributes:[{name:"normals",size:vt.TWO,update:r=>[e[r],n[r]]}],vertexCount:6,vs:Lw}}getMaterialOptions(){return It.transparentShapeBlending}};let $l=ei;$l.defaultProps={key:"",data:new ke},$l.attributeNames={anchor:"anchor",color:"color",depth:"depth",location:"location",maxScale:"maxScale",scale:"scale",scaling:"scaling",size:"size"};var Ow=Object.defineProperty,Nw=Object.getOwnPropertyDescriptor,Ds=(t,e,n,i)=>{for(var r=i>1?void 0:i?Nw(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(r=(i?a(e,n,r):a(r))||r);return i&&r&&Ow(e,n,r),r};const Cp=class extends pt{constructor(t){super(t),this.color=[1,1,1,1],this.depth=0,this.radius=0,this.thickness=1,this.center=[0,0],_t(this,Cp),this.color=t.color||this.color,this.depth=t.depth||this.depth,this.radius=t.radius||this.radius,this.thickness=t.thickness||this.thickness,this.center=t.center||this.center}get width(){return this.radius*2}get height(){return this.radius*2}get innerRadius(){return this.radius-this.thickness}};let Dr=Cp;Ds([B],Dr.prototype,"color",2),Ds([B],Dr.prototype,"depth",2),Ds([B],Dr.prototype,"radius",2),Ds([B],Dr.prototype,"thickness",2),Ds([B],Dr.prototype,"center",2);const Pw=`precision highp float;
varying vec4 vertexColor;
varying float edgeSharpness;
varying float borderSize;
varying vec2 pointCoord;
varying float scale;
float circle(vec2 coord, float radius){
vec2 dist = coord - vec2(0.5);
return 1.0 - smoothstep(
radius - (radius * edgeSharpness),
radius,
dot(dist, dist) * 4.0
);
}
void main() {
float outer_step_factor = circle(pointCoord, 1.0);
float inner_step_factor = circle(pointCoord, 1.0 - borderSize * scale);
gl_FragColor = mix(
mix(
vec4(0.0, 0.0, 0.0, 0.0),
vertexColor,
outer_step_factor
),
vec4(0.0, 0.0, 0.0, 0.0),
inner_step_factor
);
}`,Dw=`precision highp float;
varying vec4 vertexColor;
varying float edgeSharpness;
varying float borderSize;
varying vec2 pointCoord;
varying float scale;
void main() {
scale = scaleFactor;
vertexColor = color;
float size = radius * scaleFactor * pixelRatio;
float ringWidth = mix(2.0 , thickness, float(thickness > 2.0));
borderSize = mix(
(ringWidth) / size,
((ringWidth * pixelRatio) / size),
float(pixelRatio > 1.0)
);
edgeSharpness = min(0.2 / (ringWidth * scale), 0.1);
pointCoord = (normals.xy + vec2(1.0, 1.0)) / 2.0;
vec4 clipCenter = clipSpace(vec3(center, depth));
vec2 screenCenter = (clipCenter.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;
vec2 vertex = (normals.xy * size) + screenCenter;
gl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), clipCenter.zw);
}`,Fr=class extends nt{initShader(){const t=this.props.scaleFactor||(()=>1),e=this.props.animate||{},{color:n,center:i,radius:r}=e,s={0:1,1:1,2:-1,3:1,4:-1,5:-1},a={0:-1,1:-1,2:-1,3:1,4:1,5:1};return{fs:Pw,instanceAttributes:[{easing:i,name:Fr.attributeNames.center,size:k.TWO,update:o=>o.center},{easing:r,name:Fr.attributeNames.radius,size:k.ONE,update:o=>[o.radius]},{name:Fr.attributeNames.depth,size:k.ONE,update:o=>[o.depth]},{easing:n,name:Fr.attributeNames.color,size:k.FOUR,update:o=>o.color},{name:Fr.attributeNames.thickness,size:k.ONE,update:o=>[o.thickness]}],uniforms:[{name:"scaleFactor",size:O.ONE,update:o=>[t()]}],vertexAttributes:[{name:"normals",size:vt.TWO,update:o=>[s[o],a[o]]}],vertexCount:6,vs:Dw}}getMaterialOptions(){return It.transparentShapeBlending}};let jl=Fr;jl.defaultProps={key:"",data:new ke},jl.attributeNames={center:"center",radius:"radius",depth:"depth",color:"color",thickness:"thickness"};const Fw=`\${import: camera}
vec3 cameraSpace(vec3 world) {
return (view * vec4(world, 1.0)).xyz;
}
vec3 cameraSpace(vec4 world) {
return (view * world).xyz;
}
vec3 cameraSpaceDirection(vec3 world) {
return (view * vec4(world, 0.0)).xyz;
}
vec3 cameraSpaceDirection(vec4 world) {
return (view * world).xyz;
}
vec3 cameraSpaceSize(vec3 worldSize) {
return (view * vec4(worldSize, 0.0)).xyz;
}
vec4 clipSpace(vec3 world) {
return (viewProjection) * vec4(world, 1.0);
}
vec4 clipSpace(vec4 world) {
return (viewProjection) * world;
}
vec4 clipSpaceDirection(vec3 worldSize) {
return (viewProjection) * vec4(worldSize, 0.0);
}
vec4 clipSpaceDirection(vec4 worldSize) {
return (viewProjection) * worldSize;
}
vec4 clipSpaceSize(vec3 worldSize) {
return (viewProjection) * vec4(worldSize, 0.0);
}`,Bw=`
These are properties injected from the
current camera applied to the view.

Constants:
mat4 projection;
mat4 view;
mat4 viewProjection;
vec3 cameraOffset;
vec3 cameraPosition;
vec3 cameraScale;
vec3 cameraRotation;
vec2 viewSize;
float pixelRatio;
`;tt.register([{moduleId:"camera",description:Bw,content:"",compatibility:G.ALL,uniforms:t=>[{name:"projection",size:O.MATRIX4,update:()=>t.view.props.camera.projection},{name:"viewProjection",size:O.MATRIX4,update:()=>t.view.props.camera.viewProjection},{name:"view",size:O.MATRIX4,update:()=>t.view.props.camera.view},{name:"cameraPosition",size:O.THREE,update:()=>t.view.props.camera.position},{name:"cameraScale",size:O.THREE,update:()=>t.view.props.camera.scale},{name:"cameraRotation",size:O.THREE,update:()=>t.view.props.camera.scale},{shaderInjection:G.ALL,name:"viewSize",size:O.TWO,update:()=>[t.view.viewBounds.width,t.view.viewBounds.height]},{shaderInjection:G.ALL,name:"pixelRatio",size:O.ONE,update:()=>[t.view.pixelRatio]}]},{moduleId:"projection",content:Fw,compatibility:G.ALL}]);const Uw=`
This provides frame timing information
or how many frames have been rendered.

Constants:
float currentTime;
float currentFrame;
`;tt.register({moduleId:"frame",description:Uw,content:"",compatibility:G.ALL,uniforms:t=>[{name:"currentTime",size:O.ONE,update:()=>[t.surface.frameMetrics.currentTime]},{name:"currentFrame",size:O.ONE,update:()=>[t.surface.frameMetrics.currentFrame]}]});const kw=`vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}`,Gw=`
Provides methods that converts colors to
HSV values and back. This makes it
easier to deal with hue saturation and
lightness levels.

Methods:
vec3 rgb2hsv(vec3 c);
vec3 hsv2rgb(vec3 c);
`;tt.register({moduleId:"hsv",description:Gw,content:kw,compatibility:G.ALL});const zw=`
This is an internal shader module that
helps establish the instancing system.
Not recommended for use unless you
really know how to utilize it properly.

Attributes:
float _active;
float instance;
`;tt.register({moduleId:"instancing",description:zw,content:"",compatibility:G.ALL,instanceAttributes:t=>{const e={name:"_active",size:k.ONE,update:n=>[n.active?1:0]};return t.shaderIOInfo.activeAttribute=e,[e]},vertexAttributes:t=>t.bufferType===Qe.UNIFORM?[{name:"instance",size:vt.ONE,update:()=>[0]}]:[]});const Vw=`\${import: PI, PI2, fsin, fcos, wrap}
vec2 arc(float t, vec2 center, float radius, float start, float end) {
float angle = wrap((end - start) * t + start, 0.0, PI2);
return center + vec2(fcos(angle), fsin(angle)) * radius;
}`,Ww=`vec2 bezier1(float t, vec2 p1, vec2 p2, vec2 c1) {
return (1.0 - t) * (1.0 - t) * p1 + 2.0 * t * (1.0 - t) * c1 + t * t * p2;
}`,$w=`vec2 bezier2(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {
float t1 = 1.0 - t;
return pow(t1, 3.0) * p1 + 3.0 * t * pow(t1, 2.0) * c1 + 3.0 * pow(t, 2.0) * t1 * c2 + pow(t, 3.0) * p2;
}`,jw=`\${import: PI, PI2, PI_2}
float fcos(float x) {
float sine;
x += PI_2;
x += mix(
mix(
0.0,
-PI2, float(x > PI)
),
PI2, float(x < -PI)
);
sine = 1.27323954 * x;
sine += mix(-1.0, 1.0, float(x < 0.0)) * 0.405284735 * x * x;
sine = 0.225 * (sine * (mix(1.0, -1.0, float(sine < 0.0)) * sine) - sine) + sine;
return sine;
}`,Hw=`float fmod(float x, float m, float m_inv) {
return x - m * floor(x * m_inv);
}`,Qw=`\${import: PI, PI2}
float fsin(float x) {
float sine;
x += mix(
mix(
0.0,
-PI2, float(x > PI)
),
PI2, float(x < -PI)
);
sine = 1.27323954 * x;
sine += mix(-1.0, 1.0, float(x < 0.0)) * 0.405284735 * x * x;
sine = 0.225 * (sine * (mix(1.0, -1.0, float(sine < 0.0)) * sine) - sine) + sine;
return sine;
}`,Xw="float PI = 3.14159265;",Yw="float PI2 = 6.2831853;",qw="float PI2_INV = 0.1591549431;",Kw="float PI_2 = 1.5707963268;",Zw="float PI_4 = 0.7853981634;",Jw="float PI_INV = 0.3183098862;",ey="float toDegrees = 57.2957795131;",ty="float toRadians = 0.01745329252;",ny=`float wrap(float value, float start, float end) {
float width = end - start;
float offsetValue = value - start;
return (offsetValue - (floor(offsetValue / width) * width)) + start;
}`,Hl=[{moduleId:"PI_INV",description:"Provides: float PI_INV = 1.0 / pi",content:Jw,compatibility:G.ALL},{moduleId:"PI2_INV",description:`Provides:
float PI2_INV = 1.0 / (pi * 2.0)`,content:qw,compatibility:G.ALL},{moduleId:"PI_2",description:"Provides: float PI_2 = pi / 2.0",content:Kw,compatibility:G.ALL},{moduleId:"PI_4",description:"Provides: float PI_4 = pi / 4.0",content:Zw,compatibility:G.ALL},{moduleId:"PI",description:"Provides: float PI = pi",content:Xw,compatibility:G.ALL},{moduleId:"PI2",description:"Provides: float PI2 = pi * 2.0",content:Yw,compatibility:G.ALL},{moduleId:"toDegrees",description:`Provides: float toDegrees;
Can be used to convert radians to degrees:
radians * toDegrees`,content:ey,compatibility:G.ALL},{moduleId:"toRadians",description:`Provides: float toRadians;
Can be used to convert degrees to radians:
degress * toRadians`,content:ty,compatibility:G.ALL}],iy={moduleId:"constants",description:`
Provides all the math constants you may
need as convenience. It's probably
better to include them individually, but
convenience sometimes beats practicality

Constants:
${Hl.map(t=>t.moduleId).join(`
`)}
`,content:`\${import: ${Hl.map(t=>t.moduleId).join(", ")}}`,compatibility:G.ALL},ry=[{moduleId:"bezier1",description:`Provides the 2D single control
point bezier method:
vec2 bezier1(float t, vec2 p1, vec2 p2, vec2 c1)`,content:Ww,compatibility:G.ALL},{moduleId:"bezier2",description:`Provides the 2D single control
point bezier method:
vec2 bezier2(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2)`,content:$w,compatibility:G.ALL},{moduleId:"arc",description:`Provides the 2D
arc interpolation method:
vec2 arc(float t,
	vec2 center,
	float radius,
	float start,
	float end
)`,content:Vw,compatibility:G.ALL},{moduleId:"fmod",description:`Provides the floating point
modulus method:
float fmod(float x, float m, float m_inv)`,content:Hw,compatibility:G.ALL},{moduleId:"wrap",description:`Provides a method that wraps
value overflows:
float wrap(float value, float start, float end)`,content:ny,compatibility:G.ALL},{moduleId:"fcos",description:`Provides a fcos method that also
has a higher precision than
some hardware cos implementations:
float fcos(float x)`,content:jw,compatibility:G.ALL},{moduleId:"fsin",description:`Provides a fsin method that also
has a higher precision than
some hardware sin implementations:
float fsin(float x)`,content:Qw,compatibility:G.ALL}];tt.register([...ry,...Hl,iy]);const sy=`mat4 rotationFromQuaternion(vec4 q) {
float x2 = q.y + q.y;
float y2 = q.z + q.z;
float z2 = q.w + q.w;
float xx = q.y * x2;
float xy = q.y * y2;
float xz = q.y * z2;
float yy = q.z * y2;
float yz = q.z * z2;
float zz = q.w * z2;
float wx = q.x * x2;
float wy = q.x * y2;
float wz = q.x * z2;
return mat4(
1.0 - (yy + zz), xy - wz, xz + wy, 0.0,
xy + wz, 1.0 - (xx + zz), yz - wx, 0.0,
xz - wy, yz + wx, 1.0 - (xx + yy), 0.0,
0, 0, 0, 1
);
}`,ay=`mat4 scale(vec3 s) {
return mat4(
s.x, 0, 0, 0,
0, s.y, 0, 0,
0, 0, s.z, 0,
0, 0, 0, 1
);
}`,oy=`\${import: translation, rotation, scale}
mat4 transform(vec3 s, vec4 r, vec3 t) {
return translation(t) * rotationFromQuaternion(r) * scale(s);
}`,cy=`mat4 translation(vec3 t) {
return mat4(
1, 0, 0, 0,
0, 1, 0, 0,
0, 0, 1, 0,
t.x, t.y, t.z, 1
);
}`;tt.register([{moduleId:"translation",description:`Generates a translation matrix
from a vec3:
mat4 transform(vec3 s, vec4 r, vec3 t)`,compatibility:G.ALL,content:cy},{moduleId:"rotation",description:`Generates a rotation matrix
from a quaternion:
mat4 rotationFromQuaternion(vec4 q)`,compatibility:G.ALL,content:sy},{moduleId:"scale",description:`Generates a scale matrix
from a vec3:
mat4 scale(vec3 s)`,compatibility:G.ALL,content:ay},{moduleId:"transform",description:`Generates a full transform matrix
from a scale, quaternion, translation:
mat4 transform(vec3 s, vec4 r, vec3 t)`,compatibility:G.ALL,content:oy}]);const ly=`vec4 bitSh = vec4(16777216., 65536., 256., 1.);
vec4 bitMsk = vec4(0., vec3(1. / 256.0));
vec4 bitShifts = vec4(1.) / vec4(16777216., 65536., 256., 1.);
vec4 packFloat(float value, float range) {
value = (value + range) / (range * 2.);
vec4 comp = fract(value * bitSh);
comp -= comp.xxyz * bitMsk;
return comp;
}
float unpackFloat(vec4 color, float range) {
return dot(color , bitShifts) * (range * 2.) - range;
}`,uy=`
This provides the ability to pack
a float value into a color RGBA
value. This is used to bypass the
lack of support for float textures.

Constants:
float currentTime;
float currentFrame;
`;tt.register({moduleId:"packFloat",description:uy,content:ly,compatibility:G.ALL});const hy="varying highp vec4 _picking_color_pass_;";tt.register([{moduleId:"picking",description:`Internal use only. Provides methods
and constants to make the picking processes work.`,content:hy,compatibility:G.VERTEX,instanceAttributes:t=>[{name:"_pickingColor",size:k.FOUR,update:e=>{const n=16777215-e.uid;return[((n&16711680)>>16)/255,((n&65280)>>8)/255,(n&255)/255,1]}}]}]);const dy=`void main() {
gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
}`,fy=`void main() {
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
}`,Lp=`
Makes a no-op shader where gl_Position
is [0, 0, 0, 0] and gl_FragColor is
[0, 0, 0, 0].

You can not import this if you specify
your own main() method.
`;tt.register([{moduleId:"no-op",description:Lp,content:fy,compatibility:G.VERTEX},{moduleId:"no-op",description:Lp,content:dy,compatibility:G.FRAGMENT}]);const py=`
This is a special helper module used by
the system to map View2D content into
a 3D world space. The system utilizes
this module automatically for you when
you utilize createLayer2Din3D.
`;tt.register([{moduleId:"world2DXY",description:py,content:ip,compatibility:G.ALL,uniforms:t=>t instanceof nt?t.props.control2D?[{name:"projection",size:O.MATRIX4,update:()=>t.view.props.camera.projection},{name:"view",size:O.MATRIX4,update:()=>t.view.props.camera.view},{name:"cameraOffset",size:O.THREE,update:()=>t.props.control2D instanceof Yn?t.props.control2D.offset:[0,0,0]},{name:"cameraPosition",size:O.THREE,update:()=>t.view.props.camera.position},{name:"cameraScale",size:O.THREE,update:()=>t.view.props.camera.scale},{name:"cameraScale2D",size:O.THREE,update:()=>t.props.control2D instanceof Yn?t.props.control2D.scale:[1,1,1]},{name:"cameraRotation",size:O.FOUR,update:()=>t.view.props.camera.transform.rotation},{name:"viewSize",size:O.TWO,update:()=>[t.view.viewBounds.width,t.view.viewBounds.height]},{name:"pixelRatio",size:O.ONE,update:()=>[t.view.pixelRatio]}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requested the module world2DXZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}]);const gy=`vec3 cameraSpace(vec3 world) {
return (world + cameraOffset) * cameraScale2D;
}
vec3 cameraSpaceSize(vec3 worldSize) {
return worldSize * cameraScale2D;
}
vec4 clipSpace(vec3 world) {
return ((projection * view) * vec4(cameraSpace(world.xzy), 1.0));
}
vec4 clipSpaceSize(vec3 worldSize) {
return ((projection * view) * vec4(cameraSpaceSize(worldSize.xzy), 0.0));
}`,my=`
This is a special helper module used by
the system to map View2D content into
a 3D world space. The system utilizes
this module automatically for you when
you utilize createLayer2Din3D.
`;tt.register([{moduleId:"world2DXZ",description:my,content:gy,compatibility:G.ALL,uniforms:t=>t instanceof nt?t.props.control2D?[{name:"projection",size:O.MATRIX4,update:()=>t.view.props.camera.projection},{name:"view",size:O.MATRIX4,update:()=>t.view.props.camera.view},{name:"cameraOffset",size:O.THREE,update:()=>t.props.control2D instanceof Yn?t.props.control2D.offset:[0,0,0]},{name:"cameraPosition",size:O.THREE,update:()=>t.view.props.camera.position},{name:"cameraScale",size:O.THREE,update:()=>t.view.props.camera.scale},{name:"cameraScale2D",size:O.THREE,update:()=>t.props.control2D instanceof Yn?t.props.control2D.scale:[1,1,1]},{name:"cameraRotation",size:O.THREE,update:()=>t.view.props.camera.scale},{name:"viewSize",size:O.TWO,update:()=>[t.view.viewBounds.width,t.view.viewBounds.height]},{name:"pixelRatio",size:O.ONE,update:()=>[t.view.pixelRatio]}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requesed the module world2DXZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}]);const vy=`vec3 cameraSpace(vec3 world) {
return (world + cameraOffset) * cameraScale2D;
}
vec3 cameraSpaceSize(vec3 worldSize) {
return worldSize * cameraScale2D;
}
vec4 clipSpace(vec3 world) {
return ((projection * view) * vec4(cameraSpace(world.zyx), 1.0));
}
vec4 clipSpaceSize(vec3 worldSize) {
return ((projection * view) * vec4(cameraSpaceSize(worldSize.zyx), 0.0));
}`,wy=`
This is a special helper module used by
the system to map View2D content into
a 3D world space. The system utilizes
this module automatically for you when
you utilize createLayer2Din3D.
`;tt.register([{moduleId:"world2DYZ",description:wy,content:vy,compatibility:G.ALL,uniforms:t=>t instanceof nt?t.props.control2D?[{name:"projection",size:O.MATRIX4,update:()=>t.view.props.camera.projection},{name:"view",size:O.MATRIX4,update:()=>t.view.props.camera.view},{name:"cameraOffset",size:O.THREE,update:()=>t.props.control2D instanceof Yn?t.props.control2D.offset:[0,0,0]},{name:"cameraPosition",size:O.THREE,update:()=>t.view.props.camera.position},{name:"cameraScale",size:O.THREE,update:()=>t.view.props.camera.scale},{name:"cameraScale2D",size:O.THREE,update:()=>t.props.control2D instanceof Yn?t.props.control2D.scale:[1,1,1]},{name:"cameraRotation",size:O.THREE,update:()=>t.view.props.camera.scale},{name:"viewSize",size:O.TWO,update:()=>[t.view.viewBounds.width,t.view.viewBounds.height]},{name:"pixelRatio",size:O.ONE,update:()=>[t.view.pixelRatio]}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requesed the module world2DYZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}]);class Op extends ma{screenToWorld(e,n){return n=n||[0,0,0],this.viewToWorld(this.screenToView(e),n),n}screenRay(e){if(this.camera.projectionType===Wn.ORTHOGRAPHIC){const n=ri(this.screenToWorld(e));return ll(n,this.camera.transform.forward)}else{const n=ri(this.screenToWorld(e));return ul(ri(this.camera.transform.position),n)}}worldToScreen(e,n){n=n||[0,0];const i=Mt(this.camera.projection,this.camera.view),r=wa(i,e,this.viewBounds.width,this.viewBounds.height);return Le(n,r[0]/this.pixelRatio,r[1]/this.pixelRatio)}viewToWorld(e,n){n=n||[0,0,0];const{width:i,height:r}=this.viewBounds,{projectionOptions:s}=this.camera,a=He(e,this.pixelRatio),{tan:o}=Math;if(s.type===Wn.PERSPECTIVE){const{fov:c,near:l}=s,u=r/i,h=o(c/2)*l,f=(2*((a[0]+.5)/i)-1)*h,p=(1-2*((a[1]+.5)/r))*h*u,m=[f,p,-1],v=gs(this.camera.transform.matrix,Yr(m,1));Fe(n,v[0],v[1],v[2])}else{const c=$e(a,[i/2,r/2]),l=gs(this.camera.transform.viewMatrix,Yr(c,-s.near));Fe(n,l[0],-l[1],l[2])}return n}worldToView(e,n){n=n||[0,0];const i=Mt(this.camera.projection,this.camera.view),r=wa(i,e,this.viewBounds.width,this.viewBounds.height);return Le(n,r[0]/this.pixelRatio,r[1]/this.pixelRatio)}}function yy(t){return t.projectionType===Wn.ORTHOGRAPHIC}class Np extends Cs{constructor(e,n){super(e,n),this.projection=new Op,this.projection.camera=n.camera,this.projection.pixelRatio=this.pixelRatio}fitViewtoViewport(e,n){if(gl(this.props.camera)){const i=n.width,r=n.height,s=this.props.camera,a={near:s.projectionOptions.near,far:s.projectionOptions.far,width:i,height:r};this.props.preventCameraAdjustment||(s.projectionOptions=Object.assign(s.projectionOptions,a),s.update()),this.projection.pixelRatio=this.pixelRatio,this.projection.viewBounds=n,this.projection.viewBounds.d=this,this.projection.screenBounds=new ye({height:this.projection.viewBounds.height/this.pixelRatio,width:this.projection.viewBounds.width/this.pixelRatio,x:this.projection.viewBounds.x/this.pixelRatio,y:this.projection.viewBounds.y/this.pixelRatio}),this.projection.screenBounds.d=this}else if(yy(this.props.camera)){const i=n.width,r=n.height,s=this.props.camera,a={near:s.projectionOptions.near,far:s.projectionOptions.far,left:-i/2,right:i/2,top:r/2,bottom:-r/2};this.props.preventCameraAdjustment||(s.projectionOptions=Object.assign(s.projectionOptions,a),s.update()),this.projection.pixelRatio=this.pixelRatio,this.projection.viewBounds=n,this.projection.viewBounds.d=this,this.projection.screenBounds=new ye({height:this.projection.viewBounds.height/this.pixelRatio,width:this.projection.viewBounds.width/this.pixelRatio,x:this.projection.viewBounds.x/this.pixelRatio,y:this.projection.viewBounds.y/this.pixelRatio}),this.projection.screenBounds.d=this}}willUpdateProps(e){this.projection.camera=e.camera}}Np.defaultProps={key:"",camera:new $n({type:Wn.PERSPECTIVE,width:100,height:100,fov:Math.PI/2,far:1e5,near:1}),viewport:{left:0,right:0,bottom:0,top:0}};var Pp=(t=>(t[t.XY=0]="XY",t[t.XZ=1]="XZ",t[t.YZ=2]="YZ",t))(Pp||{});function Ty(t,e,n){if(!(e===nt||e.prototype instanceof nt))return console.warn("A Layer type was specified for createLayer2din3D that is NOT a Layer2D type, which is invalid.","The layer will be used without being modified."),Xi(e,n);let r;switch(t){case 0:r="world2DXY";break;case 1:r="world2DXZ";break;case 2:r="world2DYZ";break;default:return Xi(e,n)}const s=Object.assign({},n,{baseShaderModules:(a,o)=>{let c=o.vs.indexOf("world2D");return c>=0&&o.vs.splice(c,1,r),c=o.fs.indexOf("world2D"),c>=0&&o.fs.splice(c,1,r),o}});return Xi(e,s)}class Dp extends Qn{baseShaderModules(e){const n=super.baseShaderModules(e);return n.vs.push("parent-transform"),n}}const Ey=`
When working with SceneGraphLayers, the
layer can have a transform applied to
the layer. This makes that transform
available in the parentTransform
constant.

mat4 parentTransform;
`;tt.register({moduleId:"parent-transform",description:Ey,compatibility:G.VERTEX,content:"",uniforms:t=>{const e=t;if(!(e instanceof Dp))return console.warn("A shader requested the module parent-transform; however, the layer the","shader is generated from is NOT a SceneGraphLayer which is","required for the module to work."),[];const n=Ie();return[{name:"parentTransform",size:O.MATRIX4,update:()=>{var i;return((i=e.props.parent)==null?void 0:i.matrix)||n}}]}});var by=Object.defineProperty,_y=Object.getOwnPropertyDescriptor,xi=(t,e,n,i)=>{for(var r=i>1?void 0:i?_y(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(r=(i?a(e,n,r):a(r))||r);return i&&r&&by(e,n,r),r};const Ql=class extends pt{constructor(t){super(t),this.needsLocalUpdate=!1,this.needsWorldUpdate=!1,_t(this,Ql);const e=t.transform||new La;this.transform=e,t.parent&&(t.parent instanceof Ql?this.parent=t.parent:this.transform.parent=t.parent)}get transform(){return this._transform}set transform(t){this._transform||(this._position=t.position,this._rotation=t.rotation,this._scale=t.scale,this._localPosition=t.localPosition,this._localRotation=t.localRotation,this._localScale=t.localScale,this._matrix=t.matrix,this._localMatrix=t.localMatrix),t.instance=this,this._transform=t}get matrix(){return this._transform.update(),this._matrix}get localMatrix(){return this._transform.update(),this._localMatrix}get localPosition(){return this.needsLocalUpdate=!0,this._localPosition}set localPosition(t){this.transform.localPosition=t}get localRotation(){return this.needsLocalUpdate=!0,this._localRotation}set localRotation(t){this.transform.localRotation=t}get localScale(){return this.needsLocalUpdate=!0,this._localScale}set localScale(t){this.transform.localScale=t}get position(){return this.needsWorldUpdate=!0,this.transform.update(),this._position}set position(t){this.transform.position=t}get rotation(){return this.needsWorldUpdate=!0,this.transform.update(),this._rotation}set rotation(t){this.transform.rotation=t}get scale(){return this.needsWorldUpdate=!0,this.transform.update(),this._scale}set scale(t){this.transform.scale=t}set parent(t){this.transform.parent=t.transform}optimize(){this.needsWorldUpdate=!1,this.needsLocalUpdate=!1,this.transform.optimize()}};let Nn=Ql;xi([B],Nn.prototype,"_matrix",2),xi([B],Nn.prototype,"_localMatrix",2),xi([B],Nn.prototype,"_localPosition",2),xi([B],Nn.prototype,"_localRotation",2),xi([B],Nn.prototype,"_localScale",2),xi([B],Nn.prototype,"_position",2),xi([B],Nn.prototype,"_rotation",2),xi([B],Nn.prototype,"_scale",2);class Ry extends pl{constructor(){super(...arguments),this.isQueuedForUpdate=!1,this.needsWorldOrientation=!1,this.needsWorldDecomposition=!1,this._instance=null,this._matrix={value:Ie()},this._localMatrix={value:this._matrix.value},this._position={value:[0,0,0]},this._localPosition={value:this._position.value},this._rotation={value:Ts()},this._localRotation={value:0},this.localRotationMatrix=fs(),this._scale={value:[1,1,1]},this._localScale={value:this._scale.value}}set instance(e){this._instance!==e&&this._instance&&(this._instance.transform.instance=null,e&&(e.transform=this)),this._instance=e}get matrix(){return this.update(),this._matrix.value}get position(){return this.needsWorldOrientation=!0,this.update(),this._position.value}set position(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world position is not supported yet. Use localPosition for now."):this.localPosition=e}get localPosition(){return this._localPosition.value}set localPosition(e){this._localPosition.value[0]=e[0],this._localPosition.value[1]=e[1],this._localPosition.didUpdate=!0,this.invalidate()}get rotation(){return this.needsWorldOrientation=!0,this.update(),this._rotation.value}set rotation(e){console.warn("NOT IMPLEMENTED: Setting world rotation for a 2D transform is not supported yet.")}get localRotation(){return this._localRotation.value}set localRotation(e){this._localRotation.value=e,this._localRotation.didUpdate=!0,this.invalidate()}get scale(){return this.needsWorldOrientation=!0,this.update(),this._scale.value}set scale(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world scale is not supported yet. Use localScale for now."):this.localScale=e}get localScale(){return this._localScale.value}set localScale(e){Le(this._localScale.value,e[0],e[1]),this._localScale.didUpdate=!0,this.invalidate()}decomposeWorldMatrix(){if(!this.parent||!this.needsWorldDecomposition||!this.needsWorldOrientation)return;this.needsWorldDecomposition=!1;const e=this._matrix.value,n=this._position.value,i=this._scale.value;this._position.didUpdate=n[0]!==e[12]||n[1]!==e[13]||n[2]!==e[14],this._position.didUpdate&&Fe(n,e[12],e[13],e[14]);const r=Bn(e[0],e[1],e[2],e[3]),s=Bn(e[4],e[5],e[6],e[7]),a=Bn(e[8],e[9],e[10],e[11]);this._scale.didUpdate=i[0]!==r||i[1]!==s||i[2]!==a,Fe(i,r,s,a),this._scale.didUpdate=!0;const[o,c,l,u]=this._rotation.value;Ma(this._matrix.value,r,s,a,this._rotation.value);const h=this._rotation.value;this._rotation.didUpdate=h[0]!==o||h[1]!==c||h[2]!==l||h[3]!==u}queueForUpdate(){!this.isQueuedForUpdate&&this._instance&&this._instance.active&&(this.isQueuedForUpdate=!0,dl(this))}update(e){let n=!1;if(this.isQueuedForUpdate&&(fl(this),this.isQueuedForUpdate=!1),this.needsUpdate){const i=this.localRotationMatrix;this._localRotation.didUpdate&&Hc(this._localRotation.value,i),el(this._localScale.value,i,this._localPosition.value,this._localMatrix.value),this._localMatrix.didUpdate=!0,n=!0}this.parent&&(this.parent.needsUpdate?(e||this.processParentUpdates(i=>{i.update(!0)}),n=!0):this.parent.childUpdate.has(this)&&(n=!0),n&&(Mt(this.parent._matrix.value,this._localMatrix.value,this._matrix.value),this._matrix.didUpdate=!0,this.needsWorldDecomposition=!0)),this.decomposeWorldMatrix(),this._instance&&this._instance.active&&(this._localRotation.didUpdate&&(this._instance._localRotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._localPosition=this._localPosition.value),this._localScale.didUpdate&&(this._instance._localScale=this._localScale.value),this.parent?(this._rotation.didUpdate&&(this._instance._rotation=this._rotation.value),this._scale.didUpdate&&(this._instance._scale=this._scale.value),this._position.didUpdate&&(this._instance._position=this._position.value)):(this._localRotation.didUpdate&&(this._instance._rotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._position=this._localPosition.value),this._localScale.didUpdate&&(this._instance._scale=this._localScale.value)),(this._matrix.didUpdate||this._localMatrix.didUpdate)&&(this._instance.transform=this)),this._localScale.didUpdate=!1,this._localRotation.didUpdate=!1,this._localPosition.didUpdate=!1,this._rotation.didUpdate=!1,this._scale.didUpdate=!1,this._position.didUpdate=!1,this._matrix.didUpdate=!1,this._localMatrix.didUpdate=!1,this.resolve()}}const Ay=`varying vec2 _texCoord;
void main() {
gl_FragColor = mix(
vec4(1.0, 0.0, 0.0, 1.0),
vec4(0.0, 0.0, 0.0, 1.0),
float(_texCoord.x <= 0.01 || _texCoord.x > 0.99 || _texCoord.y < 0.01 || _texCoord.y > 0.99)
);
}`,Sy=`\${import: projection}
varying vec2 _texCoord;
void main() {
vec4 pos = vec4(position * size, 1.0);
vec4 world = transform * pos;
_texCoord = texCoord;
gl_Position = clipSpace(world.xyz);
}`;class Fp extends Qn{initShader(){const e=[1,1,1],n=[1,1,-1],i=[1,-1,-1],r=[1,-1,1],s=[-1,1,1],a=[-1,1,-1],o=[-1,-1,-1],c=[-1,-1,1],l=[e,n,i,e,i,r,s,e,r,s,r,c,s,o,a,s,c,o,a,i,n,a,o,i,s,n,e,s,a,n,c,r,i,c,i,o],u=[1,0,0],h=[0,0,1],f=[-1,0,0],p=[0,0,-1],m=[0,1,0],v=[0,-1,0],T=[u,u,u,u,u,u,h,h,h,h,h,h,f,f,f,f,f,f,p,p,p,p,p,p,m,m,m,m,m,m,v,v,v,v,v,v],b=[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,0],[1,1],[0,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]];return{drawMode:d.GLSettings.Model.DrawMode.TRIANGLES,fs:[{outputType:ge.COLOR,source:Ay}],instanceAttributes:[{name:"transform",size:k.MAT4X4,update:E=>(E.transform||Vd).matrix},{name:"size",size:k.THREE,update:E=>E.size}],uniforms:[],vertexAttributes:[{name:"position",size:vt.THREE,update:E=>l[E]},{name:"normal",size:vt.THREE,update:E=>T[E]},{name:"texCoord",size:vt.TWO,update:E=>b[E]}],vertexCount:36,vs:Sy}}getMaterialOptions(){return Object.assign({},It.transparentShapeBlending,{cullSide:d.GLSettings.Material.CullSide.CCW})}}Fp.defaultProps={data:new ke,key:"",materialOptions:It.transparentShapeBlending};var My=Object.defineProperty,xy=Object.getOwnPropertyDescriptor,Bp=(t,e,n,i)=>{for(var r=i>1?void 0:i?xy(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(r=(i?a(e,n,r):a(r))||r);return i&&r&&My(e,n,r),r};const Up=class extends Nn{constructor(t){super(t),this.size=[1,1,1],this.color=[1,1,1,1],_t(this,Up),this.size=t.size||this.size,this.color=t.color||this.color}};let Xl=Up;Bp([B],Xl.prototype,"size",2),Bp([B],Xl.prototype,"color",2);var Yl={exports:{}},Fs={},ql={exports:{}},le={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kp;function Iy(){if(kp)return le;kp=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function f(_){return _===null||typeof _!="object"?null:(_=h&&_[h]||_["@@iterator"],typeof _=="function"?_:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,v={};function T(_,L,q){this.props=_,this.context=L,this.refs=v,this.updater=q||p}T.prototype.isReactComponent={},T.prototype.setState=function(_,L){if(typeof _!="object"&&typeof _!="function"&&_!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,_,L,"setState")},T.prototype.forceUpdate=function(_){this.updater.enqueueForceUpdate(this,_,"forceUpdate")};function b(){}b.prototype=T.prototype;function E(_,L,q){this.props=_,this.context=L,this.refs=v,this.updater=q||p}var S=E.prototype=new b;S.constructor=E,m(S,T.prototype),S.isPureReactComponent=!0;var I=Array.isArray,M=Object.prototype.hasOwnProperty,N={current:null},x={key:!0,ref:!0,__self:!0,__source:!0};function P(_,L,q){var ue,ie={},fe=null,Ae=null;if(L!=null)for(ue in L.ref!==void 0&&(Ae=L.ref),L.key!==void 0&&(fe=""+L.key),L)M.call(L,ue)&&!x.hasOwnProperty(ue)&&(ie[ue]=L[ue]);var Te=arguments.length-2;if(Te===1)ie.children=q;else if(1<Te){for(var we=Array(Te),Je=0;Je<Te;Je++)we[Je]=arguments[Je+2];ie.children=we}if(_&&_.defaultProps)for(ue in Te=_.defaultProps,Te)ie[ue]===void 0&&(ie[ue]=Te[ue]);return{$$typeof:t,type:_,key:fe,ref:Ae,props:ie,_owner:N.current}}function te(_,L){return{$$typeof:t,type:_.type,key:L,ref:_.ref,props:_.props,_owner:_._owner}}function W(_){return typeof _=="object"&&_!==null&&_.$$typeof===t}function V(_){var L={"=":"=0",":":"=2"};return"$"+_.replace(/[=:]/g,function(q){return L[q]})}var ae=/\/+/g;function Z(_,L){return typeof _=="object"&&_!==null&&_.key!=null?V(""+_.key):L.toString(36)}function ne(_,L,q,ue,ie){var fe=typeof _;(fe==="undefined"||fe==="boolean")&&(_=null);var Ae=!1;if(_===null)Ae=!0;else switch(fe){case"string":case"number":Ae=!0;break;case"object":switch(_.$$typeof){case t:case e:Ae=!0}}if(Ae)return Ae=_,ie=ie(Ae),_=ue===""?"."+Z(Ae,0):ue,I(ie)?(q="",_!=null&&(q=_.replace(ae,"$&/")+"/"),ne(ie,L,q,"",function(Je){return Je})):ie!=null&&(W(ie)&&(ie=te(ie,q+(!ie.key||Ae&&Ae.key===ie.key?"":(""+ie.key).replace(ae,"$&/")+"/")+_)),L.push(ie)),1;if(Ae=0,ue=ue===""?".":ue+":",I(_))for(var Te=0;Te<_.length;Te++){fe=_[Te];var we=ue+Z(fe,Te);Ae+=ne(fe,L,q,we,ie)}else if(we=f(_),typeof we=="function")for(_=we.call(_),Te=0;!(fe=_.next()).done;)fe=fe.value,we=ue+Z(fe,Te++),Ae+=ne(fe,L,q,we,ie);else if(fe==="object")throw L=String(_),Error("Objects are not valid as a React child (found: "+(L==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":L)+"). If you meant to render a collection of children, use an array instead.");return Ae}function re(_,L,q){if(_==null)return _;var ue=[],ie=0;return ne(_,ue,"","",function(fe){return L.call(q,fe,ie++)}),ue}function ee(_){if(_._status===-1){var L=_._result;L=L(),L.then(function(q){(_._status===0||_._status===-1)&&(_._status=1,_._result=q)},function(q){(_._status===0||_._status===-1)&&(_._status=2,_._result=q)}),_._status===-1&&(_._status=0,_._result=L)}if(_._status===1)return _._result.default;throw _._result}var D={current:null},Ee={transition:null},ve={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:Ee,ReactCurrentOwner:N};return le.Children={map:re,forEach:function(_,L,q){re(_,function(){L.apply(this,arguments)},q)},count:function(_){var L=0;return re(_,function(){L++}),L},toArray:function(_){return re(_,function(L){return L})||[]},only:function(_){if(!W(_))throw Error("React.Children.only expected to receive a single React element child.");return _}},le.Component=T,le.Fragment=n,le.Profiler=r,le.PureComponent=E,le.StrictMode=i,le.Suspense=c,le.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ve,le.cloneElement=function(_,L,q){if(_==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+_+".");var ue=m({},_.props),ie=_.key,fe=_.ref,Ae=_._owner;if(L!=null){if(L.ref!==void 0&&(fe=L.ref,Ae=N.current),L.key!==void 0&&(ie=""+L.key),_.type&&_.type.defaultProps)var Te=_.type.defaultProps;for(we in L)M.call(L,we)&&!x.hasOwnProperty(we)&&(ue[we]=L[we]===void 0&&Te!==void 0?Te[we]:L[we])}var we=arguments.length-2;if(we===1)ue.children=q;else if(1<we){Te=Array(we);for(var Je=0;Je<we;Je++)Te[Je]=arguments[Je+2];ue.children=Te}return{$$typeof:t,type:_.type,key:ie,ref:fe,props:ue,_owner:Ae}},le.createContext=function(_){return _={$$typeof:a,_currentValue:_,_currentValue2:_,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},_.Provider={$$typeof:s,_context:_},_.Consumer=_},le.createElement=P,le.createFactory=function(_){var L=P.bind(null,_);return L.type=_,L},le.createRef=function(){return{current:null}},le.forwardRef=function(_){return{$$typeof:o,render:_}},le.isValidElement=W,le.lazy=function(_){return{$$typeof:u,_payload:{_status:-1,_result:_},_init:ee}},le.memo=function(_,L){return{$$typeof:l,type:_,compare:L===void 0?null:L}},le.startTransition=function(_){var L=Ee.transition;Ee.transition={};try{_()}finally{Ee.transition=L}},le.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},le.useCallback=function(_,L){return D.current.useCallback(_,L)},le.useContext=function(_){return D.current.useContext(_)},le.useDebugValue=function(){},le.useDeferredValue=function(_){return D.current.useDeferredValue(_)},le.useEffect=function(_,L){return D.current.useEffect(_,L)},le.useId=function(){return D.current.useId()},le.useImperativeHandle=function(_,L,q){return D.current.useImperativeHandle(_,L,q)},le.useInsertionEffect=function(_,L){return D.current.useInsertionEffect(_,L)},le.useLayoutEffect=function(_,L){return D.current.useLayoutEffect(_,L)},le.useMemo=function(_,L){return D.current.useMemo(_,L)},le.useReducer=function(_,L,q){return D.current.useReducer(_,L,q)},le.useRef=function(_){return D.current.useRef(_)},le.useState=function(_){return D.current.useState(_)},le.useSyncExternalStore=function(_,L,q){return D.current.useSyncExternalStore(_,L,q)},le.useTransition=function(){return D.current.useTransition()},le.version="18.2.0",le}var Bs={exports:{}};/**
 * @license React
 * react.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */Bs.exports;var Gp;function Cy(){return Gp||(Gp=1,function(t,e){process.env.NODE_ENV!=="production"&&function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var n="18.2.0",i=Symbol.for("react.element"),r=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),v=Symbol.for("react.offscreen"),T=Symbol.iterator,b="@@iterator";function E(g){if(g===null||typeof g!="object")return null;var w=T&&g[T]||g[b];return typeof w=="function"?w:null}var S={current:null},I={transition:null},M={current:null,isBatchingLegacy:!1,didScheduleLegacyUpdate:!1},N={current:null},x={},P=null;function te(g){P=g}x.setExtraStackFrame=function(g){P=g},x.getCurrentStack=null,x.getStackAddendum=function(){var g="";P&&(g+=P);var w=x.getCurrentStack;return w&&(g+=w()||""),g};var W=!1,V=!1,ae=!1,Z=!1,ne=!1,re={ReactCurrentDispatcher:S,ReactCurrentBatchConfig:I,ReactCurrentOwner:N};re.ReactDebugCurrentFrame=x,re.ReactCurrentActQueue=M;function ee(g){{for(var w=arguments.length,R=new Array(w>1?w-1:0),A=1;A<w;A++)R[A-1]=arguments[A];Ee("warn",g,R)}}function D(g){{for(var w=arguments.length,R=new Array(w>1?w-1:0),A=1;A<w;A++)R[A-1]=arguments[A];Ee("error",g,R)}}function Ee(g,w,R){{var A=re.ReactDebugCurrentFrame,F=A.getStackAddendum();F!==""&&(w+="%s",R=R.concat([F]));var J=R.map(function(H){return String(H)});J.unshift("Warning: "+w),Function.prototype.apply.call(console[g],console,J)}}var ve={};function _(g,w){{var R=g.constructor,A=R&&(R.displayName||R.name)||"ReactClass",F=A+"."+w;if(ve[F])return;D("Can't call %s on a component that is not yet mounted. This is a no-op, but it might indicate a bug in your application. Instead, assign to `this.state` directly or define a `state = {};` class property with the desired state in the %s component.",w,A),ve[F]=!0}}var L={isMounted:function(g){return!1},enqueueForceUpdate:function(g,w,R){_(g,"forceUpdate")},enqueueReplaceState:function(g,w,R,A){_(g,"replaceState")},enqueueSetState:function(g,w,R,A){_(g,"setState")}},q=Object.assign,ue={};Object.freeze(ue);function ie(g,w,R){this.props=g,this.context=w,this.refs=ue,this.updater=R||L}ie.prototype.isReactComponent={},ie.prototype.setState=function(g,w){if(typeof g!="object"&&typeof g!="function"&&g!=null)throw new Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,g,w,"setState")},ie.prototype.forceUpdate=function(g){this.updater.enqueueForceUpdate(this,g,"forceUpdate")};{var fe={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see https://github.com/facebook/react/issues/3236)."]},Ae=function(g,w){Object.defineProperty(ie.prototype,g,{get:function(){ee("%s(...) is deprecated in plain JavaScript React classes. %s",w[0],w[1])}})};for(var Te in fe)fe.hasOwnProperty(Te)&&Ae(Te,fe[Te])}function we(){}we.prototype=ie.prototype;function Je(g,w,R){this.props=g,this.context=w,this.refs=ue,this.updater=R||L}var Ci=Je.prototype=new we;Ci.constructor=Je,q(Ci,ie.prototype),Ci.isPureReactComponent=!0;function Zl(){var g={current:null};return Object.seal(g),g}var eo=Array.isArray;function Ur(g){return eo(g)}function Jl(g){{var w=typeof Symbol=="function"&&Symbol.toStringTag,R=w&&g[Symbol.toStringTag]||g.constructor.name||"Object";return R}}function kr(g){try{return or(g),!1}catch{return!0}}function or(g){return""+g}function cr(g){if(kr(g))return D("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",Jl(g)),or(g)}function to(g,w,R){var A=g.displayName;if(A)return A;var F=w.displayName||w.name||"";return F!==""?R+"("+F+")":R}function lr(g){return g.displayName||"Context"}function Dn(g){if(g==null)return null;if(typeof g.tag=="number"&&D("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g;switch(g){case s:return"Fragment";case r:return"Portal";case o:return"Profiler";case a:return"StrictMode";case h:return"Suspense";case f:return"SuspenseList"}if(typeof g=="object")switch(g.$$typeof){case l:var w=g;return lr(w)+".Consumer";case c:var R=g;return lr(R._context)+".Provider";case u:return to(g,g.render,"ForwardRef");case p:var A=g.displayName||null;return A!==null?A:Dn(g.type)||"Memo";case m:{var F=g,J=F._payload,H=F._init;try{return Dn(H(J))}catch{return null}}}return null}var ur=Object.prototype.hasOwnProperty,Gr={key:!0,ref:!0,__self:!0,__source:!0},no,io,zr;zr={};function ks(g){if(ur.call(g,"ref")){var w=Object.getOwnPropertyDescriptor(g,"ref").get;if(w&&w.isReactWarning)return!1}return g.ref!==void 0}function Li(g){if(ur.call(g,"key")){var w=Object.getOwnPropertyDescriptor(g,"key").get;if(w&&w.isReactWarning)return!1}return g.key!==void 0}function eu(g,w){var R=function(){no||(no=!0,D("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",w))};R.isReactWarning=!0,Object.defineProperty(g,"key",{get:R,configurable:!0})}function ro(g,w){var R=function(){io||(io=!0,D("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",w))};R.isReactWarning=!0,Object.defineProperty(g,"ref",{get:R,configurable:!0})}function so(g){if(typeof g.ref=="string"&&N.current&&g.__self&&N.current.stateNode!==g.__self){var w=Dn(N.current.type);zr[w]||(D('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',w,g.ref),zr[w]=!0)}}var hr=function(g,w,R,A,F,J,H){var se={$$typeof:i,type:g,key:w,ref:R,props:H,_owner:J};return se._store={},Object.defineProperty(se._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(se,"_self",{configurable:!1,enumerable:!1,writable:!1,value:A}),Object.defineProperty(se,"_source",{configurable:!1,enumerable:!1,writable:!1,value:F}),Object.freeze&&(Object.freeze(se.props),Object.freeze(se)),se};function tu(g,w,R){var A,F={},J=null,H=null,se=null,pe=null;if(w!=null){ks(w)&&(H=w.ref,so(w)),Li(w)&&(cr(w.key),J=""+w.key),se=w.__self===void 0?null:w.__self,pe=w.__source===void 0?null:w.__source;for(A in w)ur.call(w,A)&&!Gr.hasOwnProperty(A)&&(F[A]=w[A])}var Me=arguments.length-2;if(Me===1)F.children=R;else if(Me>1){for(var Pe=Array(Me),De=0;De<Me;De++)Pe[De]=arguments[De+2];Object.freeze&&Object.freeze(Pe),F.children=Pe}if(g&&g.defaultProps){var Ve=g.defaultProps;for(A in Ve)F[A]===void 0&&(F[A]=Ve[A])}if(J||H){var qe=typeof g=="function"?g.displayName||g.name||"Unknown":g;J&&eu(F,qe),H&&ro(F,qe)}return hr(g,J,H,se,pe,N.current,F)}function nu(g,w){var R=hr(g.type,w,g.ref,g._self,g._source,g._owner,g.props);return R}function iu(g,w,R){if(g==null)throw new Error("React.cloneElement(...): The argument must be a React element, but you passed "+g+".");var A,F=q({},g.props),J=g.key,H=g.ref,se=g._self,pe=g._source,Me=g._owner;if(w!=null){ks(w)&&(H=w.ref,Me=N.current),Li(w)&&(cr(w.key),J=""+w.key);var Pe;g.type&&g.type.defaultProps&&(Pe=g.type.defaultProps);for(A in w)ur.call(w,A)&&!Gr.hasOwnProperty(A)&&(w[A]===void 0&&Pe!==void 0?F[A]=Pe[A]:F[A]=w[A])}var De=arguments.length-2;if(De===1)F.children=R;else if(De>1){for(var Ve=Array(De),qe=0;qe<De;qe++)Ve[qe]=arguments[qe+2];F.children=Ve}return hr(g.type,J,H,se,pe,Me,F)}function Oi(g){return typeof g=="object"&&g!==null&&g.$$typeof===i}var ao=".",ru=":";function su(g){var w=/[=:]/g,R={"=":"=0",":":"=2"},A=g.replace(w,function(F){return R[F]});return"$"+A}var Vr=!1,oo=/\/+/g;function ni(g){return g.replace(oo,"$&/")}function dr(g,w){return typeof g=="object"&&g!==null&&g.key!=null?(cr(g.key),su(""+g.key)):w.toString(36)}function Ni(g,w,R,A,F){var J=typeof g;(J==="undefined"||J==="boolean")&&(g=null);var H=!1;if(g===null)H=!0;else switch(J){case"string":case"number":H=!0;break;case"object":switch(g.$$typeof){case i:case r:H=!0}}if(H){var se=g,pe=F(se),Me=A===""?ao+dr(se,0):A;if(Ur(pe)){var Pe="";Me!=null&&(Pe=ni(Me)+"/"),Ni(pe,w,Pe,"",function(uT){return uT})}else pe!=null&&(Oi(pe)&&(pe.key&&(!se||se.key!==pe.key)&&cr(pe.key),pe=nu(pe,R+(pe.key&&(!se||se.key!==pe.key)?ni(""+pe.key)+"/":"")+Me)),w.push(pe));return 1}var De,Ve,qe=0,st=A===""?ao:A+ru;if(Ur(g))for(var yo=0;yo<g.length;yo++)De=g[yo],Ve=st+dr(De,yo),qe+=Ni(De,w,R,Ve,F);else{var yu=E(g);if(typeof yu=="function"){var Eg=g;yu===Eg.entries&&(Vr||ee("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),Vr=!0);for(var cT=yu.call(Eg),bg,lT=0;!(bg=cT.next()).done;)De=bg.value,Ve=st+dr(De,lT++),qe+=Ni(De,w,R,Ve,F)}else if(J==="object"){var _g=String(g);throw new Error("Objects are not valid as a React child (found: "+(_g==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":_g)+"). If you meant to render a collection of children, use an array instead.")}}return qe}function fr(g,w,R){if(g==null)return g;var A=[],F=0;return Ni(g,A,"","",function(J){return w.call(R,J,F++)}),A}function au(g){var w=0;return fr(g,function(){w++}),w}function co(g,w,R){fr(g,function(){w.apply(this,arguments)},R)}function ou(g){return fr(g,function(w){return w})||[]}function lo(g){if(!Oi(g))throw new Error("React.Children.only expected to receive a single React element child.");return g}function uo(g){var w={$$typeof:l,_currentValue:g,_currentValue2:g,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null};w.Provider={$$typeof:c,_context:w};var R=!1,A=!1,F=!1;{var J={$$typeof:l,_context:w};Object.defineProperties(J,{Provider:{get:function(){return A||(A=!0,D("Rendering <Context.Consumer.Provider> is not supported and will be removed in a future major release. Did you mean to render <Context.Provider> instead?")),w.Provider},set:function(H){w.Provider=H}},_currentValue:{get:function(){return w._currentValue},set:function(H){w._currentValue=H}},_currentValue2:{get:function(){return w._currentValue2},set:function(H){w._currentValue2=H}},_threadCount:{get:function(){return w._threadCount},set:function(H){w._threadCount=H}},Consumer:{get:function(){return R||(R=!0,D("Rendering <Context.Consumer.Consumer> is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?")),w.Consumer}},displayName:{get:function(){return w.displayName},set:function(H){F||(ee("Setting `displayName` on Context.Consumer has no effect. You should set it directly on the context with Context.displayName = '%s'.",H),F=!0)}}}),w.Consumer=J}return w._currentRenderer=null,w._currentRenderer2=null,w}var pr=-1,Gs=0,zs=1,cu=2;function lu(g){if(g._status===pr){var w=g._result,R=w();if(R.then(function(J){if(g._status===Gs||g._status===pr){var H=g;H._status=zs,H._result=J}},function(J){if(g._status===Gs||g._status===pr){var H=g;H._status=cu,H._result=J}}),g._status===pr){var A=g;A._status=Gs,A._result=R}}if(g._status===zs){var F=g._result;return F===void 0&&D(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))

Did you accidentally put curly braces around the import?`,F),"default"in F||D(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))`,F),F.default}else throw g._result}function uu(g){var w={_status:pr,_result:g},R={$$typeof:m,_payload:w,_init:lu};{var A,F;Object.defineProperties(R,{defaultProps:{configurable:!0,get:function(){return A},set:function(J){D("React.lazy(...): It is not supported to assign `defaultProps` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),A=J,Object.defineProperty(R,"defaultProps",{enumerable:!0})}},propTypes:{configurable:!0,get:function(){return F},set:function(J){D("React.lazy(...): It is not supported to assign `propTypes` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),F=J,Object.defineProperty(R,"propTypes",{enumerable:!0})}}})}return R}function hu(g){g!=null&&g.$$typeof===p?D("forwardRef requires a render function but received a `memo` component. Instead of forwardRef(memo(...)), use memo(forwardRef(...))."):typeof g!="function"?D("forwardRef requires a render function but was given %s.",g===null?"null":typeof g):g.length!==0&&g.length!==2&&D("forwardRef render functions accept exactly two parameters: props and ref. %s",g.length===1?"Did you forget to use the ref parameter?":"Any additional parameter will be undefined."),g!=null&&(g.defaultProps!=null||g.propTypes!=null)&&D("forwardRef render functions do not support propTypes or defaultProps. Did you accidentally pass a React component?");var w={$$typeof:u,render:g};{var R;Object.defineProperty(w,"displayName",{enumerable:!1,configurable:!0,get:function(){return R},set:function(A){R=A,!g.name&&!g.displayName&&(g.displayName=A)}})}return w}var y;y=Symbol.for("react.module.reference");function C(g){return!!(typeof g=="string"||typeof g=="function"||g===s||g===o||ne||g===a||g===h||g===f||Z||g===v||W||V||ae||typeof g=="object"&&g!==null&&(g.$$typeof===m||g.$$typeof===p||g.$$typeof===c||g.$$typeof===l||g.$$typeof===u||g.$$typeof===y||g.getModuleId!==void 0))}function z(g,w){C(g)||D("memo: The first argument must be a component. Instead received: %s",g===null?"null":typeof g);var R={$$typeof:p,type:g,compare:w===void 0?null:w};{var A;Object.defineProperty(R,"displayName",{enumerable:!1,configurable:!0,get:function(){return A},set:function(F){A=F,!g.name&&!g.displayName&&(g.displayName=F)}})}return R}function j(){var g=S.current;return g===null&&D(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.`),g}function me(g){var w=j();if(g._context!==void 0){var R=g._context;R.Consumer===g?D("Calling useContext(Context.Consumer) is not supported, may cause bugs, and will be removed in a future major release. Did you mean to call useContext(Context) instead?"):R.Provider===g&&D("Calling useContext(Context.Provider) is not supported. Did you mean to call useContext(Context) instead?")}return w.useContext(g)}function be(g){var w=j();return w.useState(g)}function he(g,w,R){var A=j();return A.useReducer(g,w,R)}function ce(g){var w=j();return w.useRef(g)}function rt(g,w){var R=j();return R.useEffect(g,w)}function ze(g,w){var R=j();return R.useInsertionEffect(g,w)}function We(g,w){var R=j();return R.useLayoutEffect(g,w)}function Rt(g,w){var R=j();return R.useCallback(g,w)}function Pi(g,w){var R=j();return R.useMemo(g,w)}function ho(g,w,R){var A=j();return A.useImperativeHandle(g,w,R)}function $t(g,w){{var R=j();return R.useDebugValue(g,w)}}function ky(){var g=j();return g.useTransition()}function Gy(g){var w=j();return w.useDeferredValue(g)}function zy(){var g=j();return g.useId()}function Vy(g,w,R){var A=j();return A.useSyncExternalStore(g,w,R)}var Vs=0,tg,ng,ig,rg,sg,ag,og;function cg(){}cg.__reactDisabledLog=!0;function Wy(){{if(Vs===0){tg=console.log,ng=console.info,ig=console.warn,rg=console.error,sg=console.group,ag=console.groupCollapsed,og=console.groupEnd;var g={configurable:!0,enumerable:!0,value:cg,writable:!0};Object.defineProperties(console,{info:g,log:g,warn:g,error:g,group:g,groupCollapsed:g,groupEnd:g})}Vs++}}function $y(){{if(Vs--,Vs===0){var g={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:q({},g,{value:tg}),info:q({},g,{value:ng}),warn:q({},g,{value:ig}),error:q({},g,{value:rg}),group:q({},g,{value:sg}),groupCollapsed:q({},g,{value:ag}),groupEnd:q({},g,{value:og})})}Vs<0&&D("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var du=re.ReactCurrentDispatcher,fu;function fo(g,w,R){{if(fu===void 0)try{throw Error()}catch(F){var A=F.stack.trim().match(/\n( *(at )?)/);fu=A&&A[1]||""}return`
`+fu+g}}var pu=!1,po;{var jy=typeof WeakMap=="function"?WeakMap:Map;po=new jy}function lg(g,w){if(!g||pu)return"";{var R=po.get(g);if(R!==void 0)return R}var A;pu=!0;var F=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var J;J=du.current,du.current=null,Wy();try{if(w){var H=function(){throw Error()};if(Object.defineProperty(H.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(H,[])}catch(st){A=st}Reflect.construct(g,[],H)}else{try{H.call()}catch(st){A=st}g.call(H.prototype)}}else{try{throw Error()}catch(st){A=st}g()}}catch(st){if(st&&A&&typeof st.stack=="string"){for(var se=st.stack.split(`
`),pe=A.stack.split(`
`),Me=se.length-1,Pe=pe.length-1;Me>=1&&Pe>=0&&se[Me]!==pe[Pe];)Pe--;for(;Me>=1&&Pe>=0;Me--,Pe--)if(se[Me]!==pe[Pe]){if(Me!==1||Pe!==1)do if(Me--,Pe--,Pe<0||se[Me]!==pe[Pe]){var De=`
`+se[Me].replace(" at new "," at ");return g.displayName&&De.includes("<anonymous>")&&(De=De.replace("<anonymous>",g.displayName)),typeof g=="function"&&po.set(g,De),De}while(Me>=1&&Pe>=0);break}}}finally{pu=!1,du.current=J,$y(),Error.prepareStackTrace=F}var Ve=g?g.displayName||g.name:"",qe=Ve?fo(Ve):"";return typeof g=="function"&&po.set(g,qe),qe}function Hy(g,w,R){return lg(g,!1)}function Qy(g){var w=g.prototype;return!!(w&&w.isReactComponent)}function go(g,w,R){if(g==null)return"";if(typeof g=="function")return lg(g,Qy(g));if(typeof g=="string")return fo(g);switch(g){case h:return fo("Suspense");case f:return fo("SuspenseList")}if(typeof g=="object")switch(g.$$typeof){case u:return Hy(g.render);case p:return go(g.type,w,R);case m:{var A=g,F=A._payload,J=A._init;try{return go(J(F),w,R)}catch{}}}return""}var ug={},hg=re.ReactDebugCurrentFrame;function mo(g){if(g){var w=g._owner,R=go(g.type,g._source,w?w.type:null);hg.setExtraStackFrame(R)}else hg.setExtraStackFrame(null)}function Xy(g,w,R,A,F){{var J=Function.call.bind(ur);for(var H in g)if(J(g,H)){var se=void 0;try{if(typeof g[H]!="function"){var pe=Error((A||"React class")+": "+R+" type `"+H+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof g[H]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw pe.name="Invariant Violation",pe}se=g[H](w,H,A,R,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(Me){se=Me}se&&!(se instanceof Error)&&(mo(F),D("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",A||"React class",R,H,typeof se),mo(null)),se instanceof Error&&!(se.message in ug)&&(ug[se.message]=!0,mo(F),D("Failed %s type: %s",R,se.message),mo(null))}}}function Wr(g){if(g){var w=g._owner,R=go(g.type,g._source,w?w.type:null);te(R)}else te(null)}var gu;gu=!1;function dg(){if(N.current){var g=Dn(N.current.type);if(g)return`

Check the render method of \``+g+"`."}return""}function Yy(g){if(g!==void 0){var w=g.fileName.replace(/^.*[\\\/]/,""),R=g.lineNumber;return`

Check your code at `+w+":"+R+"."}return""}function qy(g){return g!=null?Yy(g.__source):""}var fg={};function Ky(g){var w=dg();if(!w){var R=typeof g=="string"?g:g.displayName||g.name;R&&(w=`

Check the top-level render call using <`+R+">.")}return w}function pg(g,w){if(!(!g._store||g._store.validated||g.key!=null)){g._store.validated=!0;var R=Ky(w);if(!fg[R]){fg[R]=!0;var A="";g&&g._owner&&g._owner!==N.current&&(A=" It was passed a child from "+Dn(g._owner.type)+"."),Wr(g),D('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',R,A),Wr(null)}}}function gg(g,w){if(typeof g=="object"){if(Ur(g))for(var R=0;R<g.length;R++){var A=g[R];Oi(A)&&pg(A,w)}else if(Oi(g))g._store&&(g._store.validated=!0);else if(g){var F=E(g);if(typeof F=="function"&&F!==g.entries)for(var J=F.call(g),H;!(H=J.next()).done;)Oi(H.value)&&pg(H.value,w)}}}function mg(g){{var w=g.type;if(w==null||typeof w=="string")return;var R;if(typeof w=="function")R=w.propTypes;else if(typeof w=="object"&&(w.$$typeof===u||w.$$typeof===p))R=w.propTypes;else return;if(R){var A=Dn(w);Xy(R,g.props,"prop",A,g)}else if(w.PropTypes!==void 0&&!gu){gu=!0;var F=Dn(w);D("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",F||"Unknown")}typeof w.getDefaultProps=="function"&&!w.getDefaultProps.isReactClassApproved&&D("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Zy(g){{for(var w=Object.keys(g.props),R=0;R<w.length;R++){var A=w[R];if(A!=="children"&&A!=="key"){Wr(g),D("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",A),Wr(null);break}}g.ref!==null&&(Wr(g),D("Invalid attribute `ref` supplied to `React.Fragment`."),Wr(null))}}function vg(g,w,R){var A=C(g);if(!A){var F="";(g===void 0||typeof g=="object"&&g!==null&&Object.keys(g).length===0)&&(F+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var J=qy(w);J?F+=J:F+=dg();var H;g===null?H="null":Ur(g)?H="array":g!==void 0&&g.$$typeof===i?(H="<"+(Dn(g.type)||"Unknown")+" />",F=" Did you accidentally export a JSX literal instead of a component?"):H=typeof g,D("React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",H,F)}var se=tu.apply(this,arguments);if(se==null)return se;if(A)for(var pe=2;pe<arguments.length;pe++)gg(arguments[pe],g);return g===s?Zy(se):mg(se),se}var wg=!1;function Jy(g){var w=vg.bind(null,g);return w.type=g,wg||(wg=!0,ee("React.createFactory() is deprecated and will be removed in a future major release. Consider using JSX or use React.createElement() directly instead.")),Object.defineProperty(w,"type",{enumerable:!1,get:function(){return ee("Factory.type is deprecated. Access the class directly before passing it to createFactory."),Object.defineProperty(this,"type",{value:g}),g}}),w}function eT(g,w,R){for(var A=iu.apply(this,arguments),F=2;F<arguments.length;F++)gg(arguments[F],A.type);return mg(A),A}function tT(g,w){var R=I.transition;I.transition={};var A=I.transition;I.transition._updatedFibers=new Set;try{g()}finally{if(I.transition=R,R===null&&A._updatedFibers){var F=A._updatedFibers.size;F>10&&ee("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),A._updatedFibers.clear()}}}var yg=!1,vo=null;function nT(g){if(vo===null)try{var w=("require"+Math.random()).slice(0,7),R=t&&t[w];vo=R.call(t,"timers").setImmediate}catch{vo=function(F){yg===!1&&(yg=!0,typeof MessageChannel>"u"&&D("This browser does not have a MessageChannel implementation, so enqueuing tasks via await act(async () => ...) will fail. Please file an issue at https://github.com/facebook/react/issues if you encounter this warning."));var J=new MessageChannel;J.port1.onmessage=F,J.port2.postMessage(void 0)}}return vo(g)}var $r=0,Tg=!1;function iT(g){{var w=$r;$r++,M.current===null&&(M.current=[]);var R=M.isBatchingLegacy,A;try{if(M.isBatchingLegacy=!0,A=g(),!R&&M.didScheduleLegacyUpdate){var F=M.current;F!==null&&(M.didScheduleLegacyUpdate=!1,wu(F))}}catch(Ve){throw wo(w),Ve}finally{M.isBatchingLegacy=R}if(A!==null&&typeof A=="object"&&typeof A.then=="function"){var J=A,H=!1,se={then:function(Ve,qe){H=!0,J.then(function(st){wo(w),$r===0?mu(st,Ve,qe):Ve(st)},function(st){wo(w),qe(st)})}};return!Tg&&typeof Promise<"u"&&Promise.resolve().then(function(){}).then(function(){H||(Tg=!0,D("You called act(async () => ...) without await. This could lead to unexpected testing behaviour, interleaving multiple act calls and mixing their scopes. You should - await act(async () => ...);"))}),se}else{var pe=A;if(wo(w),$r===0){var Me=M.current;Me!==null&&(wu(Me),M.current=null);var Pe={then:function(Ve,qe){M.current===null?(M.current=[],mu(pe,Ve,qe)):Ve(pe)}};return Pe}else{var De={then:function(Ve,qe){Ve(pe)}};return De}}}}function wo(g){g!==$r-1&&D("You seem to have overlapping act() calls, this is not supported. Be sure to await previous act() calls before making a new one. "),$r=g}function mu(g,w,R){{var A=M.current;if(A!==null)try{wu(A),nT(function(){A.length===0?(M.current=null,w(g)):mu(g,w,R)})}catch(F){R(F)}else w(g)}}var vu=!1;function wu(g){if(!vu){vu=!0;var w=0;try{for(;w<g.length;w++){var R=g[w];do R=R(!0);while(R!==null)}g.length=0}catch(A){throw g=g.slice(w+1),A}finally{vu=!1}}}var rT=vg,sT=eT,aT=Jy,oT={map:fr,forEach:co,count:au,toArray:ou,only:lo};e.Children=oT,e.Component=ie,e.Fragment=s,e.Profiler=o,e.PureComponent=Je,e.StrictMode=a,e.Suspense=h,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=re,e.cloneElement=sT,e.createContext=uo,e.createElement=rT,e.createFactory=aT,e.createRef=Zl,e.forwardRef=hu,e.isValidElement=Oi,e.lazy=uu,e.memo=z,e.startTransition=tT,e.unstable_act=iT,e.useCallback=Rt,e.useContext=me,e.useDebugValue=$t,e.useDeferredValue=Gy,e.useEffect=rt,e.useId=zy,e.useImperativeHandle=ho,e.useInsertionEffect=ze,e.useLayoutEffect=We,e.useMemo=Pi,e.useReducer=he,e.useRef=ce,e.useState=be,e.useSyncExternalStore=Vy,e.useTransition=ky,e.version=n,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()}(Bs,Bs.exports)),Bs.exports}process.env.NODE_ENV==="production"?ql.exports=Iy():ql.exports=Cy();var ar=ql.exports;const Ce=ju(ar);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zp;function Ly(){if(zp)return Fs;zp=1;var t=ar,e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,r=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(o,c,l){var u,h={},f=null,p=null;l!==void 0&&(f=""+l),c.key!==void 0&&(f=""+c.key),c.ref!==void 0&&(p=c.ref);for(u in c)i.call(c,u)&&!s.hasOwnProperty(u)&&(h[u]=c[u]);if(o&&o.defaultProps)for(u in c=o.defaultProps,c)h[u]===void 0&&(h[u]=c[u]);return{$$typeof:e,type:o,key:f,ref:p,props:h,_owner:r.current}}return Fs.Fragment=n,Fs.jsx=a,Fs.jsxs=a,Fs}var Us={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vp;function Oy(){return Vp||(Vp=1,process.env.NODE_ENV!=="production"&&function(){var t=ar,e=Symbol.for("react.element"),n=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),o=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.suspense_list"),h=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.for("react.offscreen"),m=Symbol.iterator,v="@@iterator";function T(y){if(y===null||typeof y!="object")return null;var C=m&&y[m]||y[v];return typeof C=="function"?C:null}var b=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function E(y){{for(var C=arguments.length,z=new Array(C>1?C-1:0),j=1;j<C;j++)z[j-1]=arguments[j];S("error",y,z)}}function S(y,C,z){{var j=b.ReactDebugCurrentFrame,me=j.getStackAddendum();me!==""&&(C+="%s",z=z.concat([me]));var be=z.map(function(he){return String(he)});be.unshift("Warning: "+C),Function.prototype.apply.call(console[y],console,be)}}var I=!1,M=!1,N=!1,x=!1,P=!1,te;te=Symbol.for("react.module.reference");function W(y){return!!(typeof y=="string"||typeof y=="function"||y===i||y===s||P||y===r||y===l||y===u||x||y===p||I||M||N||typeof y=="object"&&y!==null&&(y.$$typeof===f||y.$$typeof===h||y.$$typeof===a||y.$$typeof===o||y.$$typeof===c||y.$$typeof===te||y.getModuleId!==void 0))}function V(y,C,z){var j=y.displayName;if(j)return j;var me=C.displayName||C.name||"";return me!==""?z+"("+me+")":z}function ae(y){return y.displayName||"Context"}function Z(y){if(y==null)return null;if(typeof y.tag=="number"&&E("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof y=="function")return y.displayName||y.name||null;if(typeof y=="string")return y;switch(y){case i:return"Fragment";case n:return"Portal";case s:return"Profiler";case r:return"StrictMode";case l:return"Suspense";case u:return"SuspenseList"}if(typeof y=="object")switch(y.$$typeof){case o:var C=y;return ae(C)+".Consumer";case a:var z=y;return ae(z._context)+".Provider";case c:return V(y,y.render,"ForwardRef");case h:var j=y.displayName||null;return j!==null?j:Z(y.type)||"Memo";case f:{var me=y,be=me._payload,he=me._init;try{return Z(he(be))}catch{return null}}}return null}var ne=Object.assign,re=0,ee,D,Ee,ve,_,L,q;function ue(){}ue.__reactDisabledLog=!0;function ie(){{if(re===0){ee=console.log,D=console.info,Ee=console.warn,ve=console.error,_=console.group,L=console.groupCollapsed,q=console.groupEnd;var y={configurable:!0,enumerable:!0,value:ue,writable:!0};Object.defineProperties(console,{info:y,log:y,warn:y,error:y,group:y,groupCollapsed:y,groupEnd:y})}re++}}function fe(){{if(re--,re===0){var y={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:ne({},y,{value:ee}),info:ne({},y,{value:D}),warn:ne({},y,{value:Ee}),error:ne({},y,{value:ve}),group:ne({},y,{value:_}),groupCollapsed:ne({},y,{value:L}),groupEnd:ne({},y,{value:q})})}re<0&&E("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Ae=b.ReactCurrentDispatcher,Te;function we(y,C,z){{if(Te===void 0)try{throw Error()}catch(me){var j=me.stack.trim().match(/\n( *(at )?)/);Te=j&&j[1]||""}return`
`+Te+y}}var Je=!1,Ci;{var Zl=typeof WeakMap=="function"?WeakMap:Map;Ci=new Zl}function eo(y,C){if(!y||Je)return"";{var z=Ci.get(y);if(z!==void 0)return z}var j;Je=!0;var me=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var be;be=Ae.current,Ae.current=null,ie();try{if(C){var he=function(){throw Error()};if(Object.defineProperty(he.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(he,[])}catch($t){j=$t}Reflect.construct(y,[],he)}else{try{he.call()}catch($t){j=$t}y.call(he.prototype)}}else{try{throw Error()}catch($t){j=$t}y()}}catch($t){if($t&&j&&typeof $t.stack=="string"){for(var ce=$t.stack.split(`
`),rt=j.stack.split(`
`),ze=ce.length-1,We=rt.length-1;ze>=1&&We>=0&&ce[ze]!==rt[We];)We--;for(;ze>=1&&We>=0;ze--,We--)if(ce[ze]!==rt[We]){if(ze!==1||We!==1)do if(ze--,We--,We<0||ce[ze]!==rt[We]){var Rt=`
`+ce[ze].replace(" at new "," at ");return y.displayName&&Rt.includes("<anonymous>")&&(Rt=Rt.replace("<anonymous>",y.displayName)),typeof y=="function"&&Ci.set(y,Rt),Rt}while(ze>=1&&We>=0);break}}}finally{Je=!1,Ae.current=be,fe(),Error.prepareStackTrace=me}var Pi=y?y.displayName||y.name:"",ho=Pi?we(Pi):"";return typeof y=="function"&&Ci.set(y,ho),ho}function Ur(y,C,z){return eo(y,!1)}function Jl(y){var C=y.prototype;return!!(C&&C.isReactComponent)}function kr(y,C,z){if(y==null)return"";if(typeof y=="function")return eo(y,Jl(y));if(typeof y=="string")return we(y);switch(y){case l:return we("Suspense");case u:return we("SuspenseList")}if(typeof y=="object")switch(y.$$typeof){case c:return Ur(y.render);case h:return kr(y.type,C,z);case f:{var j=y,me=j._payload,be=j._init;try{return kr(be(me),C,z)}catch{}}}return""}var or=Object.prototype.hasOwnProperty,cr={},to=b.ReactDebugCurrentFrame;function lr(y){if(y){var C=y._owner,z=kr(y.type,y._source,C?C.type:null);to.setExtraStackFrame(z)}else to.setExtraStackFrame(null)}function Dn(y,C,z,j,me){{var be=Function.call.bind(or);for(var he in y)if(be(y,he)){var ce=void 0;try{if(typeof y[he]!="function"){var rt=Error((j||"React class")+": "+z+" type `"+he+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof y[he]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw rt.name="Invariant Violation",rt}ce=y[he](C,he,j,z,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(ze){ce=ze}ce&&!(ce instanceof Error)&&(lr(me),E("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",j||"React class",z,he,typeof ce),lr(null)),ce instanceof Error&&!(ce.message in cr)&&(cr[ce.message]=!0,lr(me),E("Failed %s type: %s",z,ce.message),lr(null))}}}var ur=Array.isArray;function Gr(y){return ur(y)}function no(y){{var C=typeof Symbol=="function"&&Symbol.toStringTag,z=C&&y[Symbol.toStringTag]||y.constructor.name||"Object";return z}}function io(y){try{return zr(y),!1}catch{return!0}}function zr(y){return""+y}function ks(y){if(io(y))return E("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",no(y)),zr(y)}var Li=b.ReactCurrentOwner,eu={key:!0,ref:!0,__self:!0,__source:!0},ro,so,hr;hr={};function tu(y){if(or.call(y,"ref")){var C=Object.getOwnPropertyDescriptor(y,"ref").get;if(C&&C.isReactWarning)return!1}return y.ref!==void 0}function nu(y){if(or.call(y,"key")){var C=Object.getOwnPropertyDescriptor(y,"key").get;if(C&&C.isReactWarning)return!1}return y.key!==void 0}function iu(y,C){if(typeof y.ref=="string"&&Li.current&&C&&Li.current.stateNode!==C){var z=Z(Li.current.type);hr[z]||(E('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',Z(Li.current.type),y.ref),hr[z]=!0)}}function Oi(y,C){{var z=function(){ro||(ro=!0,E("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",C))};z.isReactWarning=!0,Object.defineProperty(y,"key",{get:z,configurable:!0})}}function ao(y,C){{var z=function(){so||(so=!0,E("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",C))};z.isReactWarning=!0,Object.defineProperty(y,"ref",{get:z,configurable:!0})}}var ru=function(y,C,z,j,me,be,he){var ce={$$typeof:e,type:y,key:C,ref:z,props:he,_owner:be};return ce._store={},Object.defineProperty(ce._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(ce,"_self",{configurable:!1,enumerable:!1,writable:!1,value:j}),Object.defineProperty(ce,"_source",{configurable:!1,enumerable:!1,writable:!1,value:me}),Object.freeze&&(Object.freeze(ce.props),Object.freeze(ce)),ce};function su(y,C,z,j,me){{var be,he={},ce=null,rt=null;z!==void 0&&(ks(z),ce=""+z),nu(C)&&(ks(C.key),ce=""+C.key),tu(C)&&(rt=C.ref,iu(C,me));for(be in C)or.call(C,be)&&!eu.hasOwnProperty(be)&&(he[be]=C[be]);if(y&&y.defaultProps){var ze=y.defaultProps;for(be in ze)he[be]===void 0&&(he[be]=ze[be])}if(ce||rt){var We=typeof y=="function"?y.displayName||y.name||"Unknown":y;ce&&Oi(he,We),rt&&ao(he,We)}return ru(y,ce,rt,me,j,Li.current,he)}}var Vr=b.ReactCurrentOwner,oo=b.ReactDebugCurrentFrame;function ni(y){if(y){var C=y._owner,z=kr(y.type,y._source,C?C.type:null);oo.setExtraStackFrame(z)}else oo.setExtraStackFrame(null)}var dr;dr=!1;function Ni(y){return typeof y=="object"&&y!==null&&y.$$typeof===e}function fr(){{if(Vr.current){var y=Z(Vr.current.type);if(y)return`

Check the render method of \``+y+"`."}return""}}function au(y){{if(y!==void 0){var C=y.fileName.replace(/^.*[\\\/]/,""),z=y.lineNumber;return`

Check your code at `+C+":"+z+"."}return""}}var co={};function ou(y){{var C=fr();if(!C){var z=typeof y=="string"?y:y.displayName||y.name;z&&(C=`

Check the top-level render call using <`+z+">.")}return C}}function lo(y,C){{if(!y._store||y._store.validated||y.key!=null)return;y._store.validated=!0;var z=ou(C);if(co[z])return;co[z]=!0;var j="";y&&y._owner&&y._owner!==Vr.current&&(j=" It was passed a child from "+Z(y._owner.type)+"."),ni(y),E('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',z,j),ni(null)}}function uo(y,C){{if(typeof y!="object")return;if(Gr(y))for(var z=0;z<y.length;z++){var j=y[z];Ni(j)&&lo(j,C)}else if(Ni(y))y._store&&(y._store.validated=!0);else if(y){var me=T(y);if(typeof me=="function"&&me!==y.entries)for(var be=me.call(y),he;!(he=be.next()).done;)Ni(he.value)&&lo(he.value,C)}}}function pr(y){{var C=y.type;if(C==null||typeof C=="string")return;var z;if(typeof C=="function")z=C.propTypes;else if(typeof C=="object"&&(C.$$typeof===c||C.$$typeof===h))z=C.propTypes;else return;if(z){var j=Z(C);Dn(z,y.props,"prop",j,y)}else if(C.PropTypes!==void 0&&!dr){dr=!0;var me=Z(C);E("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",me||"Unknown")}typeof C.getDefaultProps=="function"&&!C.getDefaultProps.isReactClassApproved&&E("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Gs(y){{for(var C=Object.keys(y.props),z=0;z<C.length;z++){var j=C[z];if(j!=="children"&&j!=="key"){ni(y),E("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",j),ni(null);break}}y.ref!==null&&(ni(y),E("Invalid attribute `ref` supplied to `React.Fragment`."),ni(null))}}function zs(y,C,z,j,me,be){{var he=W(y);if(!he){var ce="";(y===void 0||typeof y=="object"&&y!==null&&Object.keys(y).length===0)&&(ce+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var rt=au(me);rt?ce+=rt:ce+=fr();var ze;y===null?ze="null":Gr(y)?ze="array":y!==void 0&&y.$$typeof===e?(ze="<"+(Z(y.type)||"Unknown")+" />",ce=" Did you accidentally export a JSX literal instead of a component?"):ze=typeof y,E("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",ze,ce)}var We=su(y,C,z,me,be);if(We==null)return We;if(he){var Rt=C.children;if(Rt!==void 0)if(j)if(Gr(Rt)){for(var Pi=0;Pi<Rt.length;Pi++)uo(Rt[Pi],y);Object.freeze&&Object.freeze(Rt)}else E("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else uo(Rt,y)}return y===i?Gs(We):pr(We),We}}function cu(y,C,z){return zs(y,C,z,!0)}function lu(y,C,z){return zs(y,C,z,!1)}var uu=lu,hu=cu;Us.Fragment=i,Us.jsx=uu,Us.jsxs=hu}()),Us}process.env.NODE_ENV==="production"?Yl.exports=Ly():Yl.exports=Oy();var Ut=Yl.exports;function Ii(t,e,n,i={current:0},r=""){const s=e.get(n),a=new Set,o=Ce.useRef([]),c=new Set;o.current=[],r=r?`${r}.`:"";let l=[];return s&&(l=Ce.Children.map(s,u=>{if(Ce.isValidElement(u)){const h=u.key||i.current++,f=`${r}${u.props.name||`${h}`}`,p=t.get(f)||new lt;t.set(f,p),o.current.push(p),u.props.share&&(u.props.share.current=p);const m={key:h,name:f,resolver:p};return a.has(m.name)?c.add(m.name):a.add(m.name),Ce.cloneElement(u,m)}})),[l,Promise.all(o.current.map(u=>u==null?void 0:u.promise)),{resolvers:o,nameConflict:c}]}function Kl(...t){return t.filter(Xe).reduce((e,n)=>e.concat(n),[])}function Ny(t){const{children:e,tagName:n,...i}=t,r=Object.keys(i).reduce((s,a)=>{try{Gn(a)&&(s[a.toLowerCase()]=JSON.stringify(i[a]))}catch{}return s},{});return{tagName:n,attributes:r,children:e}}const Pn=t=>{const{tagName:e="",attributes:n,children:i}=Ny(t),{writeToDom:r}=Ce.useContext(Br)||{};return r?Ce.createElement(e,n,i):t.children};var ht=(t=>(t[t.EVENT_MANAGER=1]="EVENT_MANAGER",t[t.LAYER=2]="LAYER",t[t.CAMERA=3]="CAMERA",t[t.PROVIDER=4]="PROVIDER",t[t.RESOURCE=5]="RESOURCE",t[t.VIEW=6]="VIEW",t[t.SCENE=7]="SCENE",t))(ht||{});function Wp(t,e,n){var s,a;const i=new Map,r=[];for(e&&e.forEach(o=>{i.set(o,[])}),Ce.Children.forEach(t,(o,c)=>{r.push(o)}),r.reverse();r.length>0;){const o=r.pop();if(Ce.isValidElement(o)){if(o!==void 0&&((o==null?void 0:o.type)===Ce.Fragment||o.props.surfaceJSXType===void 0)){if(!((s=o==null?void 0:o.props)!=null&&s.children)){n&&n.push(o);continue}const c=[];Ce.Children.forEach(((a=o==null?void 0:o.props)==null?void 0:a.children)||[],l=>{c.push(l)});for(let l=c.length-1;l>=0;--l)r.push(c[l]);continue}else if(o!==void 0){if(o.props.surfaceJSXType===void 0){n&&n.push(o);continue}if(e){const c=i.get(o.props.surfaceJSXType);if(!c){n&&n.push(o);continue}c.push(o)}else{let c=i.get(o.props.surfaceJSXType);c||(c=[],i.set(o.props.surfaceJSXType,c)),c.push(o)}}}}return i}function Py(t){return t&&t.charCodeAt!==void 0}function Dy(t){return t!=null}const $p=()=>{};class Fy{constructor(e){this.resolver=$p,this.rejector=$p,this.promise=new Promise((n,i)=>(this.resolver=n,this.rejector=i))}resolve(e){this.resolver(e)}reject(e){this.rejector(e)}hijack(e){this.children=this.children||[],this.children.push(e),this.childResolvers=this.childResolvers||new Map,this.childResolvers.set(e,e.resolver),e.resolver=async n=>{this.childResolutions=this.childResolutions||new Map,this.childResolutions.set(e,n)}}}function ti(t,e){var o,c;const[n,i]=ar.useState(!0),[r,s]=ar.useState(!1),a={store:t,shouldMount:n};if(!r&&Dy(t.willMount)&&(a.shouldMount=!!((o=t.willMount)!=null&&o.call(t))),r){const l=(c=t.willUpdate)==null?void 0:c.call(t);l&&(async()=>await l())()}return ar.useEffect(()=>{const l=new Fy;s(!0),i(a.shouldMount);let u;return(async()=>{var h;u=await((h=t.didMount)==null?void 0:h.call(t)),l.resolve(!0)})(),()=>{(async()=>(await l.promise,u==null||u()))()}},[]),ar.useEffect(()=>{var l;r&&(a.shouldMount=!!((l=t.willMount)!=null&&l.call(t)))},e||[0]),a}const dT="",Br=Ce.createContext(void 0),By=t=>{const e=Ce.useRef(null),n=Ce.useRef(null),i=Ce.useRef(0),r=Ce.useRef(null),s=Ce.useRef(null),a=Ce.useRef(-1),o=Ce.useRef(new Map),c=Ce.useRef(new Map),l=Ce.useRef(new Map),u=Ce.useRef(new Map),h=Ce.useRef(new Map),f=Ce.useRef(new lt),p={current:0},m=[],v=Wp(t.children,void 0,m);m.length&&console.warn("Surface found unsupported children",m);const[T,b]=Ii(o.current,v,ht.EVENT_MANAGER,p),[E,S]=Ii(c.current,v,ht.RESOURCE,p),[I,M,{nameConflict:N}]=Ii(h.current,v,ht.SCENE,p),[x,P,{nameConflict:te}]=Ii(u.current,v,ht.LAYER,p),[W,V,{nameConflict:ae}]=Ii(l.current,v,ht.VIEW,p);if(N.size>0){console.warn("Root Scene name conflict:",N);return}if(te.size>0){console.warn("Root Scene Layer name conflict:",te);return}if(ae.size>0){console.warn("Root Scene View name conflict:",ae);return}const Z=async ee=>{r.current&&(i.current=ee,r.current.draw(ee))},ne=ee=>{var D,Ee,ve,_,L,q;(D=n.current)==null||D.remove(),(_=r.current)==null||_.resize(((Ee=e.current)==null?void 0:Ee.offsetWidth)||0,((ve=e.current)==null?void 0:ve.offsetHeight)||0),n.current&&((L=e.current)==null||L.appendChild(n.current)),ee||(q=r.current)==null||q.draw(i.current)},re=()=>{window.clearTimeout(a.current),a.current=window.setTimeout(()=>{ne(!0)})};return ti({async didMount(){var Te;if(!n.current||!e.current)return;const[ee,D,Ee,ve,_]=await Promise.all([b,S,M,P,V]),L=Ee.filter(Xe),q=ee.filter(Xe),ue=D.filter(Xe),ie=ve.filter(Xe),fe=_.filter(Xe);if(Ee.length<=0&&(!(ie!=null&&ie.length)||!(fe!=null&&fe.length))){console.error("No scenes or root level Layers+Views provided to surface");return}fe.length&&ie.length&&L.unshift({key:"root",layers:ie,views:fe});const Ae=await new lp({context:n.current,handlesWheelEvents:t.handlesWheelEvents!==void 0?t.handlesWheelEvents:!0,pixelRatio:window.devicePixelRatio,eventManagers:q,rendererOptions:Object.assign({alpha:!0,antialias:!1},t.options)}).ready;return s.current=hl(Z),Ae.pipeline({resources:ue,scenes:L}),r.current=Ae,await Vn(),ne(!0),(Te=t.ready)==null||Te.resolve(r.current),window.addEventListener("resize",re),()=>{var we;window.removeEventListener("resize",re),Gd(s.current),(we=r.current)==null||we.destroy()}}}),Ut.jsx("div",{ref:e,className:"SurfaceJSX",children:Ut.jsx("canvas",{ref:n,children:Ut.jsx(Br.Provider,{value:{writeToDom:t.writeToDom,eventResolvers:o.current,resourceResolvers:c.current,viewResolvers:l.current,layerResolvers:u.current,sceneResolvers:h.current,resolversReady:f.current},children:Ut.jsx(Pn,{tagName:"Surface",...t,children:Kl(T,E,W,x,I)})})})})},jp=t=>(ti({didMount(){var e;(e=t.resolver)==null||e.resolve(new Nl(t.handlers,t.preserveEvents))}}),Ut.jsx(Pn,{tagName:"QueuedEventHandler",...t}));jp.defaultProps={surfaceJSXType:ht.EVENT_MANAGER};const Hp=t=>(ti({didMount(){var e;(e=t.resolver)==null||e.resolve(new Fi(t.handlers))}}),Ut.jsx(Pn,{tagName:"SimpleEventHandler",...t}));Hp.defaultProps={surfaceJSXType:ht.EVENT_MANAGER};const Qp=t=>(ti({didMount(){var e;(e=t.resolver)==null||e.resolve(new dp(t.options))}}),Ut.jsx(Pn,{tagName:"BasicCamera2DController",...t}));Qp.defaultProps={surfaceJSXType:ht.EVENT_MANAGER};const Xp=t=>(ti({didMount(){var e;(e=t.resolver)==null||e.resolve(wl({key:t.name,height:t.height,width:t.width,textureSettings:t.textureSettings}))}}),Ut.jsx(Pn,{tagName:"Texture",...t}));Xp.defaultProps={surfaceJSXType:ht.RESOURCE};const Yp=t=>(ti({didMount(){var e;(e=t.resolver)==null||e.resolve(Rl({key:t.name,fontSource:t.fontSource,characterFilter:t.characterFilter,dynamic:t.dynamic,fontMap:t.fontMap,fontMapSize:t.fontMapSize}))}}),Ut.jsx(Pn,{tagName:"Font",...t}));Yp.defaultProps={surfaceJSXType:ht.RESOURCE};const qp=t=>{const e=Ce.useContext(Br);return ti({async didMount(){var a;let n=t.config;const i=t.uses;if(i){await(e==null?void 0:e.resolversReady);const o={},c=i.names.map(async l=>{var f,p;const u=(f=e==null?void 0:e.resourceResolvers)==null?void 0:f.get(l);if(!u)return console.error(`A layer requested a resource: ${l} but the name identifier was not found in the available resources`),console.warn("Available resources:",Array.from(((p=e==null?void 0:e.resourceResolvers)==null?void 0:p.keys())||[])),null;const h=await u.promise;if(!h)return console.error(`The Layer requested a resource "${l}", but the resource did not resolve a value`),null;if(!Qi(h))return console.error(`The Layer requested a resource "${l}", but the resource resolved to a value that is not a render texture resource`),null;o[l]=h}).filter(Xe);await Promise.all(c),n=i.apply(o,{...t.config})}const r=Xi(t.type,{key:t.name,...n});let s=r.init[1].data;s===r.init[0].defaultProps.data&&(s=new ke,r.init[1].data=s),t.providerRef&&s instanceof ke&&(t.providerRef.current=s),(a=t.resolver)==null||a.resolve(r)}}),Ut.jsx(Pn,{tagName:"Layer",...t})};qp.defaultProps={surfaceJSXType:ht.LAYER};function Kp(t,e,n){var r,s;const i=(r=e==null?void 0:e.resourceResolvers)==null?void 0:r.get(n);return i||(console.error(`A View "${t}" requested a resource: ${n} but the name identifier was not found in the available resources`),console.warn("Available resources:",Array.from(((s=e==null?void 0:e.resourceResolvers)==null?void 0:s.keys())||[])),null)}const Zp=t=>{const e=Ce.useContext(Br);return ti({async didMount(){var c,l,u;t.config.output&&!t.output&&console.warn("Do NOT use the output property in the config. Use the output property on the props of the JSX element"),await(e==null?void 0:e.resolversReady);const n=((c=t.output)==null?void 0:c.buffers)||{},i=Object.entries(n).map(([h,f])=>{const p=Kp(t.name,e,f);return p?[Number.parseInt(h),p,f]:(console.warn("View props",t),null)}).filter(Xe),r={};await Promise.all(i.map(async h=>{const f=await h[1].promise;Qi(f)||Oa(f)?r[h[0]]=f:(console.error(`A View "${t.name}" requested an output buffer for the resource with name: ${h[2]} but the resource indicated is not a valid output target type.`,"Ensure the resource is a RenderTextureResource or ColorBufferResource"),console.warn("View props",t))}));let s=!0;const a=(l=t.output)==null?void 0:l.depth;if(Py(a)){const h=Kp(t.name,e,a);if(!h)console.warn("View props",t),s=!1;else{const f=await h.promise;Qi(f)||Oa(f)?s=f:(console.error(`A View "${t.name}" requested a depth buffer for the resource with name: ${a} but the resource indicated is not a valid output target type.`,"Ensure the resource is a RenderTextureResource or ColorBufferResource"),console.warn("View props",t))}}else Xe(a)&&(s=a);const o=Ll(t.type,{key:t.name,...t.config,output:t.output?{buffers:r,depth:s}:void 0});(u=t.resolver)==null||u.resolve(o)}}),Ut.jsx(Pn,{tagName:"View",...t})};Zp.defaultProps={surfaceJSXType:ht.VIEW};const Jp=t=>{var u,h,f,p;const e=Ce.useContext(Br),n={current:0},i=Wp(t.children),[r,s,{nameConflict:a}]=Ii((e==null?void 0:e.layerResolvers)||new Map,i,ht.LAYER,n,t.name),[o,c,{nameConflict:l}]=Ii((e==null?void 0:e.viewResolvers)||new Map,i,ht.VIEW,n,t.name);if(a.size>0){console.warn(`Scene ${t.name} Layer name conflict:`,a),(u=t.resolver)==null||u.resolve(null);return}if(l.size>0){console.warn(`Scene ${t.name} View name conflict:`,l),(h=t.resolver)==null||h.resolve(null);return}if(!r){console.warn("A Scene had no Layers:",t.name),(f=t.resolver)==null||f.resolve(null);return}if(!o){console.warn("A Scene had no Views:",t.name),(p=t.resolver)==null||p.resolve(null);return}return ti({async didMount(){var T;const[m,v]=await Promise.all([s,c]);(T=t.resolver)==null||T.resolve({key:t.name,layers:m.filter(Xe),views:v.filter(Xe)})}}),Ut.jsx(Pn,{tagName:"Scene",...t,children:Kl(o,r)})};Jp.defaultProps={surfaceJSXType:ht.SCENE};class eg extends Qn{constructor(e,n,i){super(e,n,i),console.warn("Please ensure all debugLayer calls are removed for production:",i.key)}childLayers(){return this.props.wrap?(this.props.wrap.init[1].key=`debug-wrapper.${this.props.key}`,[this.props.wrap]):[]}draw(){if(!this.props.wrap)return;const e=this.resolveChanges(!0);if(e.length===0)return;const{messageHeader:n=()=>""}=this.props;console.warn(`${n()}
`,{totalChanges:e.length,changes:e})}initShader(){if(!this.props.wrap)return null;const e=new this.props.wrap.init[0](this.surface,this.scene,this.props.wrap.init[1]),n=e.childLayers(),i={};for(;n.length>0;){const r=n.pop();if(!r)continue;const s=new r.init[0](this.surface,this.scene,r.init[1]);i[s.id]={shaderIO:s.initShader()},s.childLayers().forEach(a=>n.push(a))}return console.warn(`Shader IO: ${this.id}
`,{shaderIO:e.initShader(),childLayers:i}),null}}eg.defaultProps={data:new ke,key:"default",messageHeader:()=>"",wrap:Xi(Qn,{data:new ke})};function Uy(t,e){const n=Yi(eg,{messageHeader:()=>`CHANGES FOR: ${n.init[1].key}`,wrap:Yi(t,e),data:e.data});return n}d.ActiveIOExpansion=If,d.AnchorType=$,d.ArcInstance=Kn,d.ArcLayer=Dl,d.ArcScaleType=gp,d.Atlas=rf,d.AtlasManager=af,d.AtlasResourceManager=cf,d.Attribute=Un,d.AutoEasingLoopStyle=Tn,d.AutoEasingMethod=Ta,d.Axis2D=Pp,d.BaseIOExpansion=Ss,d.BaseIOSorting=rp,d.BaseProjection=ma,d.BaseResourceManager=Mr,d.BaseShaderIOInjection=of,d.BasicCamera2DController=dp,d.BasicCamera2DControllerJSX=Qp,d.BasicIOExpansion=xf,d.BasicInstance=n0,d.Bounds=ye,d.BufferManagerBase=Va,d.Camera=$n,d.Camera2D=nr,d.CameraBoundsAnchor=hp,d.CameraProjectionType=Wn,d.CircleInstance=Os,d.CircleLayer=Fl,d.ClearFlags=Is,d.CommandLayer=up,d.CommonMaterialOptions=It,d.Control2D=Yn,d.CubeInstance=Xl,d.CubeLayer=Fp,d.CustomTag=Pn,d.DEFAULT_IO_EXPANSION=ap,d.DEFAULT_RESOURCE_MANAGEMENT=op,d.DEFAULT_RESOURCE_ROUTER=Ef,d.DEFAULT_SHADER_TRANSFORM=cp,d.EasingIOExpansion=Sf,d.EasingUtil=r0,d.EdgeBroadphase=Bl,d.EdgeInstance=Ei,d.EdgeLayer=Ul,d.EdgeScaleType=Ns,d.EdgeType=Mn,d.EulerOrder=_e,d.EventManager=Di,d.FontGlyphRenderSize=wf,d.FontJSX=Yp,d.FontManager=yf,d.FontMap=ff,d.FontMapGlyphType=Ua,d.FontRenderer=mf,d.FontResourceManager=Tf,d.FontResourceRequestFetch=Zi,d.FragmentOutputType=ge,d.GLProxy=ns,d.GLState=Zu,d.Geometry=si,d.GlyphInstance=Wt,d.GlyphLayer=Ka,d.Hadamard2x2=Lh,d.Hadamard3x3=Oh,d.Hadamard4x4=Nh,d.INVALID_RESOURCE_MANAGER=Hd,d.IdentityTransform=Vd,d.ImageInstance=Zn,d.ImageLayer=yp,d.ImageRasterizer=qi,d.Instance=pt,d.Instance3D=Nn,d.InstanceAttributeBufferManager=Nf,d.InstanceAttributePackingBufferManager=Pf,d.InstanceAttributeSize=k,d.InstanceBlockIndex=Cc,d.InstanceDiffType=Ze,d.InstanceProvider=ke,d.InvalidResourceManager=jd,d.LabelInstance=Re,d.LabelLayer=zl,d.Layer=Qn,d.Layer2D=nt,d.LayerBufferType=Qe,d.LayerInteractionHandler=Kf,d.LayerJSX=qp,d.LayerMouseEvents=sp,d.LayerScene=Xa,d.M200=ci,d.M201=li,d.M210=ui,d.M211=hi,d.M300=rs,d.M301=ss,d.M302=as,d.M310=os,d.M311=cs,d.M312=ls,d.M320=us,d.M321=hs,d.M322=ds,d.M3R=Wi,d.M400=nn,d.M401=rn,d.M402=sn,d.M403=an,d.M410=on,d.M411=cn,d.M412=ln,d.M413=un,d.M420=hn,d.M421=dn,d.M422=fn,d.M423=pn,d.M430=gn,d.M431=mn,d.M432=vn,d.M433=wn,d.M4R=ot,d.Material=is,d.MaterialUniformType=je,d.MatrixMath=$m,d.Model=Pc,d.MouseButton=Tu,d.NOOP=ca,d.NewLineCharacterMode=Pr,d.NoView=tp,d.ObservableMonitoring=ft,d.PackNode=gt,d.PickType=oe,d.Projection3D=Op,d.PromiseResolver=lt,d.QR1=ad,d.QR2=od,d.QR3=cd,d.QR4=ld,d.QW=fd,d.QX=ud,d.QY=hd,d.QZ=dd,d.QuadTree=Jd,d.QuadTreeNode=xr,d.QuadTreeQuadrants=Zd,d.QuaternionMath=jm,d.QueuedEventHandler=Nl,d.QueuedEventHandlerJSX=jp,d.REQUEST=F0,d.RESOURCE=D0,d.RayMath=Hm,d.ReactiveDiff=As,d.RectangleInstance=Ln,d.RectangleLayer=$l,d.ReferenceCamera2D=Sv,d.RenderTarget=oi,d.RenderTexture=yl,d.RenderTextureResourceManager=lf,d.ResourcePool=h0,d.ResourceRouter=Al,d.ResourceType=xe,d.RingInstance=Dr,d.RingLayer=jl,d.SRT4x4=ya,d.SRT4x4_2D=el,d.ScaleMode=Sn,d.Scene=ha,d.SceneGraphLayer=Dp,d.SceneJSX=Jp,d.ShaderInjectionTarget=G,d.ShaderModule=tt,d.ShaderModuleUnit=ja,d.SimpleEventHandler=Fi,d.SimpleEventHandlerJSX=Hp,d.SimpleProjection=fh,d.StreamChangeStrategy=la,d.SubTexture=jn,d.Surface=lp,d.SurfaceContext=Br,d.SurfaceErrorType=Nc,d.SurfaceJSX=By,d.TRS4x4=ms,d.TRS4x4_2D=td,d.TextAlignment=Za,d.TextAreaInstance=Ai,d.TextAreaLayer=Ip,d.Texture=Se,d.TextureIOExpansion=Da,d.TextureJSX=Xp,d.TextureSize=Nt,d.Transform=La,d.Transform2D=Ry,d.TreeNode=pl,d.UniformBufferManager=Ff,d.UniformSize=O,d.UseMaterialStatus=kt,d.UserInputEventManager=np,d.V3R=dt,d.V4R=Eu,d.VecMath=X,d.VectorMath=Qm,d.VertexAttributeSize=vt,d.View=Cs,d.View2D=pp,d.View3D=Np,d.ViewJSX=Zp,d.WebGLRenderer=eh,d.WebGLStat=U,d.WordWrap=Cn,d.add1=Ws,d.add2=Fn,d.add2x2=Ah,d.add3=qt,d.add3x3=Sh,d.add4=Ks,d.add4by3=Ou,d.add4x4=Mh,d.addQuat=pd,d.affineInverse2x2=mh,d.affineInverse3x3=vh,d.affineInverse4x4=wh,d.angleQuat=Md,d.apply1=at,d.apply2=Le,d.apply2x2=Bt,d.apply3=Fe,d.apply3x3=yt,d.apply4=Oe,d.apply4x4=Be,d.atlasRequest=Ir,d.axisQuat=xd,d.ceil1=_o,d.ceil2=zo,d.ceil3=tc,d.ceil4=cc,d.clamp=bt,d.color4FromHex3=Pu,d.color4FromHex4=Du,d.colorBufferFormat=zu,d.colorUID=$g,d.compare1=Ro,d.compare2=Qs,d.compare2x2=Kh,d.compare3=Hr,d.compare3x3=Zh,d.compare4=Zs,d.compare4x4=Jc,d.concat4x4=Rh,d.concatChildren=Kl,d.conjugateQuat=sl,d.convertToSDF=M0,d.copy1=Ao,d.copy2=Hs,d.copy2x2=Jh,d.copy3=At,d.copy3x3=ed,d.copy4=Zt,d.copy4x4=yr,d.create=u0,d.createAtlas=nf,d.createAttribute=qd,d.createChildLayer=Yi,d.createEasingAttribute=j0,d.createFont=Rl,d.createLayer=Xi,d.createLayer2Din3D=Ty,d.createMaterialOptions=kg,d.createTexture=wl,d.createUniform=ef,d.createVertex=tf,d.createView=Ll,d.cross1=Mo,d.cross2=Wo,d.cross3=mt,d.cross4=uc,d.debugLayer=Uy,d.decomposeRotation=Ma,d.depthBufferFormat=Vu,d.determinant2x2=Ne,d.determinant3x3=$i,d.determinant4x4=jc,d.diffUnitQuat=vd,d.divide1=xo,d.divide2=jr,d.divide3=Qr,d.divide4=hc,d.divideQuat=gd,d.dot1=Bo,d.dot2=gr,d.dot3=Xr,d.dot4=na,d.dotQuat=bd,d.down3=Lu,d.drawMode=aa,d.empty1=Io,d.empty2=$o,d.empty3=nc,d.empty4=dc,d.eulerToQuat=Ld,d.eventElementPosition=en,d.exponentQuat=md,d.filterQuery=o0,d.flatten1=Co,d.flatten2=jo,d.flatten3=ic,d.flatten4=Js,d.floor1=Lo,d.floor2=Ho,d.floor3=rc,d.floor4=fc,d.fontRequest=Ji,d.forward1=So,d.forward2=Vo,d.forward3=Bi,d.forward4=lc,d.fromEulerAxisAngleToQuat=_d,d.fromOrderedEulerToQuat=ol,d.fuzzyCompare1=Ru,d.fuzzyCompare2=Su,d.fuzzyCompare3=Mu,d.fuzzyCompare4=Nu,d.generateDefaultScene=bf,d.generateLayerGeometry=Rf,d.generateLayerMaterial=_f,d.generateLayerModel=za,d.getAbsolutePositionBounds=Ac,d.getProgramInfo=Sg,d.iQuat=Fd,d.identity2=fs,d.identity3=yn,d.identity4=Ie,d.imaginaryQuat=Ed,d.indexToColorAttachment=Kr,d.indexToTextureUnit=$u,d.injectShaderIO=$f,d.inputImageFormat=qr,d.instanceAttributeSizeFloatCount=Qu,d.inverse1=Oo,d.inverse2=Qo,d.inverse3=mr,d.inverse4=pc,d.inverseQuat=wd,d.isAtlasResource=Tl,d.isBoolean=ai,d.isBufferLocation=ev,d.isBufferLocationGroup=Cf,d.isDefined=Xe,d.isFontResource=_l,d.isFunction=zg,d.isInstanceAttributeBufferLocation=nv,d.isInstanceAttributeBufferLocationGroup=Of,d.isInstanceAttributeVector=Dg,d.isNewline=Ug,d.isNumber=Gg,d.isOffscreenCanvas=zi,d.isOrthographic=Wd,d.isPerspective=gl,d.isRenderTextureResource=Qi,d.isResourceAttribute=Fg,d.isString=Gn,d.isUniformBufferLocation=Df,d.isUniformFloat=Zg,d.isUniformMat3=Yg,d.isUniformMat4=qg,d.isUniformTexture=Kg,d.isUniformVec2=Hg,d.isUniformVec3=Qg,d.isUniformVec4=Xg,d.isUniformVec4Array=qu,d.isVec1=bu,d.isVec2=bo,d.isVec3=_u,d.isVec4=Y,d.isVideoResource=Ps,d.isWhiteSpace=Gi,d.jQuat=Bd,d.kQuat=Ud,d.left3=Cu,d.length1=ko,d.length1Components=Au,d.length2=ii,d.length2Components=Jo,d.length3=Xs,d.length3Components=oc,d.length4=ia,d.length4Components=Bn,d.lengthQuat=al,d.linear1=Uo,d.linear2=Zo,d.linear3=ac,d.linear4=mc,d.lookAtMatrix=Pd,d.lookAtQuat=cl,d.magFilter=ki,d.makeFontSDF=x0,d.makeObservable=_t,d.mapGetWithDefault=Pa,d.mapInjectDefault=pi,d.matrix3x3FromUnitQuatModel=Aa,d.matrix3x3FromUnitQuatView=Cd,d.matrix3x3ToQuaternion=Od,d.matrix4x4FromUnitQuatModel=Id,d.matrix4x4FromUnitQuatView=Sa,d.matrix4x4ToQuaternion=Nd,d.max1=No,d.max2=Xo,d.max3=Ys,d.max4=vc,d.min1=Po,d.min2=Yo,d.min3=qs,d.min4=wc,d.minFilter=kn,d.multiply1=Do,d.multiply2=qo,d.multiply2x2=bh,d.multiply3=sc,d.multiply3x3=_h,d.multiply4=gc,d.multiply4x4=Mt,d.multiplyQuat=il,d.multiplyScalar2x2=yh,d.multiplyScalar3x3=Th,d.multiplyScalar4x4=Eh,d.newLineCharRegEx=Oc,d.newLineRegEx=Xu,d.nextFrame=_s,d.normalize1=Fo,d.normalize2=Ko,d.normalize3=Ot,d.normalize4=yc,d.normalizeQuat=yd,d.normalizeWheel=Wc,d.observable=B,d.onAnimationLoop=hl,d.onFrame=Vn,d.oneQuat=Ts,d.orthographic4x4=Kc,d.packAttributes=Gf,d.perspective4x4=qc,d.perspectiveFOVY4x4=qh,d.perspectiveFrustum4x4=va,d.preloadNumber=O0,d.project3As4ToScreen=wa,d.projectToScreen=Zc,d.ray=ll,d.rayFromPoints=ul,d.rayToLocation=kd,d.realQuat=Td,d.renderGlyph=El,d.resolveUpdate=fl,d.right3=Iu,d.rotateVectorByUnitQuat=xa,d.rotation2x2=Hc,d.rotation4x4=Qc,d.rotation4x4by3=Qh,d.scale1=$s,d.scale2=He,d.scale3=St,d.scale4=ea,d.scale4x4=Xc,d.scale4x4by3=Xh,d.scaleQuat=rl,d.scheduleUpdate=dl,d.shaderTemplate=gi,d.shallowCompare=tl,d.shearX2x2=Fh,d.shearX4x4=Uh,d.shearY2x2=Bh,d.shearY4x4=kh,d.shearZ4x4=Gh,d.slerpQuat=Tc,d.slerpUnitQuat=Dd,d.stencilBufferFormat=Wu,d.stopAllFrameCommands=Xm,d.stopAnimationLoop=Gd,d.subTextureIOValue=mi,d.subtract1=js,d.subtract2=$e,d.subtract2x2=xh,d.subtract3=Kt,d.subtract3x3=Ih,d.subtract4=ta,d.subtract4x4=Ch,d.texelFormat=Ui,d.textureRequest=Fa,d.textureUnitToIndex=Mc,d.toEulerFromQuat=Ad,d.toEulerXYZfromOrderedEuler=Rd,d.toOrderedEulerFromQuat=Ra,d.toOrderedEulerFromQuat2=Sd,d.toString1=Fu,d.toString2=Bu,d.toString2x2=$h,d.toString3=Uu,d.toString3x3=jh,d.toString4=ku,d.toString4x4=Hh,d.touchesContainsStartView=dh,d.touchesHasStartView=hh,d.transform2=zh,d.transform3=Vh,d.transform3as4=Wh,d.transform4=gs,d.translation4x4=Yc,d.translation4x4by3=Yh,d.transpose2x2=Ph,d.transpose3x3=ps,d.transpose4x4=Dh,d.uid=K,d.up3=xu,d.useChildResolvers=Ii,d.vec1=Go,d.vec1Methods=Ec,d.vec2=ec,d.vec2Methods=bc,d.vec3=ri,d.vec3Methods=_c,d.vec4=Yr,d.vec4Methods=Rc,d.wait=c0,d.waitForValidDimensions=l0,d.whiteSpaceCharRegEx=Lc,d.whiteSpaceRegEx=Bg,d.wrapMode=Sc,d.zeroQuat=Ue,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.js.map
