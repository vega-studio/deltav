(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(".SurfaceJSX{flex:1 1 auto;display:flex;flex-direction:column;width:100%;height:100%;overflow:hidden}")),document.head.appendChild(e)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
(function(d,Br){var Ur=document.createElement("style");Ur.textContent=`.SurfaceJSX{flex:1 1 auto;display:flex;flex-direction:column;width:100%;height:100%;overflow:hidden}
`,document.head.appendChild(Ur),typeof exports=="object"&&typeof module<"u"?Br(exports):typeof define=="function"&&define.amd?define(["exports"],Br):(d=typeof globalThis<"u"?globalThis:d||self,Br(d.deltav={}))})(this,function(d){"use strict";window.WebGL2RenderingContext=window.WebGL2RenderingContext||function(){};class Br{get surface(){return this.userInputManager.surface}getProjection(e){const n=this.userInputManager.getView(e);return n?n.projection:null}getView(e){return this.userInputManager&&this.userInputManager.getView(e)||null}getViewScreenBounds(e){const n=this.userInputManager.getView(e);return n?n.screenBounds:null}setUserInputManager(e){this.userInputManager=e}willRender(){}didRender(){}}class Ur extends Br{constructor(e){super(),Object.assign(this,e)}handleMouseDown(e){}handleMouseUp(e){}handleMouseOver(e){}handleMouseOut(e){}handleMouseMove(e){}handleClick(e){}handleDrag(e){}handleWheel(e){}handleTouchCancelled(e){}handleTouchDown(e){}handleTouchUp(e){}handleTouchOut(e){}handleTouchDrag(e){}handleTap(e){}handleDoubleTap(e){}handleLongTouch(e){}handleLongTap(e){}handlePinch(e){}handleSpread(e){}handleTouchRotate(e){}handleSwipe(e){}}var Cu=(t=>(t[t.NONE=-1]="NONE",t[t.LEFT=0]="LEFT",t[t.AUX=1]="AUX",t[t.RIGHT=2]="RIGHT",t[t.FOURTH=3]="FOURTH",t[t.FIFTH=4]="FIFTH",t))(Cu||{});const{sqrt:Mo,max:Wt,min:jt,floor:Ht,ceil:Qt,abs:Xt,acos:zg,sin:Io}=Math,gt=new Array(20).fill(0).map(t=>[0,0,0]),Lu=new Array(20).fill(0).map(t=>[0,0,0,0]);function Ou(t){return t&&Array.isArray(t)&&t.length===1}function Co(t){return t&&Array.isArray(t)&&t.length===2}function Nu(t){return t&&Array.isArray(t)&&t.length===3}function X(t){return t&&Array.isArray(t)&&t.length===4}function ot(t,e){return t=t||[],t[0]=e,t}function Hs(t,e,n){return ot(n,t[0]+e[0])}function Lo(t,e){return ot(e,Qt(t[0]))}function Oo(t,e){return t[0]===e[0]}function Pu(t,e,n){return Xt(t[0]-e[0])<=n}function No(t,e){return ot(e,t[0])}function Po(){return[0]}function Do(t,e,n){return ot(n,0)}function Fo(t,e,n){return ot(n,t[0]/e[0])}function Bo(t){return ot(t,0)}function Uo(t,e){e=e||[];for(let n=0,r=t.length;n<r;++n)e.push(t[n][0]);return e}function ko(t,e){return ot(e,Ht(t[0]))}function Go(t,e){return ot(e,1/t[0])}function Qs(t,e,n){return ot(n,t[0]*e)}function Xs(t,e,n){return ot(n,t[0]-e[0])}function zo(t,e,n){return ot(n,Wt(t[0],e[0]))}function Vo(t,e,n){return ot(n,jt(t[0],e[0]))}function $o(t,e,n){return ot(n,t[0]*e[0])}function Wo(t,e){return ot(e,1)}function jo(t,e){return t[0]*e[0]}function Du(t,e){return t[0]*e[0]}function Ho(t,e,n,r){return Hs(Qs(Xs(e,t),n),t,r)}function Qo(t){return t[0]}function Fu(t){return t}function Xo(t,...e){let n;if(e=e||[],Array.isArray(t)?n=t.slice(0,1):n=[t],n.length<1)for(let r=0,i=e.length;r<i&&n.length<1;++r){const s=e[r];Array.isArray(s)?n.push(...s.slice(0,1-n.length)):n.push(s)}for(;n.length<1;)n.push(0);return n}function Ce(t,e,n){return t=t||new Array(2),t[0]=e,t[1]=n,t}function kn(t,e,n){return Ce(n,t[0]+e[0],t[1]+e[1])}function Yo(t,e){return Ce(e,Qt(t[0]),Qt(t[1]))}function Ys(t,e){return Ce(e,t[0],t[1])}function qo(t){return Ce(t,1,0)}function Ko(t,e,n){return Ce(n,0,0)}function qs(t,e){return t[0]===e[0]&&t[1]===e[1]}function Bu(t,e,n){return Xt(t[0]-e[0])<=n&&Xt(t[1]-e[1])<=n}function Qi(t,e,n){return Ce(n,t[0]/e[0],t[1]/e[1])}function Zo(t){return Ce(t,0,0)}function Jo(t,e){e=e||new Array(t.length*2);for(let n=0,r=0,i=t.length;n<i;++n,r+=2){const s=t[n];e[r]=s[0],e[r+1]=s[1]}return e}function ec(t,e){return Ce(e,Ht(t[0]),Ht(t[1]))}function Ks(t,e){return Ce(e,1/t[0],1/t[1])}function tc(t,e,n){return Ce(n,Wt(t[0],e[0]),Wt(t[1],e[1]))}function nc(t,e,n){return Ce(n,jt(t[0],e[0]),jt(t[1],e[1]))}function Xe(t,e,n){return Ce(n,t[0]*e,t[1]*e)}function je(t,e,n){const r=n||new Array(2);return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r}function rc(t,e,n){return Ce(n,t[0]*e[0],t[1]*e[1])}function ic(t,e){const n=or(t);return Ce(e,t[0]/n,t[1]/n)}function mi(t,e){return t[0]*e[0]+t[1]*e[1]}function Uu(t,e){return t[0]*e[0]-t[1]*e[1]}function ku(t,e){return t[0]*e[1]-t[1]*e[0]}function Gu(t,e){return Ce(e,t[1],t[0])}function sc(t,e,n,r){return kn(Xe(je(e,t),n),t,r)}function or(t){return ac(t[0],t[1])}function ac(t,e){return Mo(t*t+e*e)}function Zs(t,...e){let n;if(e=e||[],Array.isArray(t)?n=t.slice(0,2):n=[t],n.length<2)for(let r=0,i=e.length;r<i&&n.length<2;++r){const s=e[r];Array.isArray(s)?n.push(...s.slice(0,2-n.length)):n.push(s)}for(;n.length<2;)n.push(0);return n}function Ne(t,e,n,r){return t=t||new Array(3),t[0]=e,t[1]=n,t[2]=r,t}function Yt(t,e,n){return Ne(n,t[0]+e[0],t[1]+e[1],t[2]+e[2])}function oc(t,e){return Ne(e,Qt(t[0]),Qt(t[1]),Qt(t[2]))}function xt(t,e){return Ne(e,t[0],t[1],t[2])}function Xi(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function zu(t,e,n){return Xt(t[0]-e[0])<=n&&Xt(t[1]-e[1])<=n&&Xt(t[2]-e[2])<=n}function kr(t){return Ne(t,0,0,-1)}function wt(t,e,n){return n=n||new Array(3),n[0]=t[1]*e[2]-t[2]*e[1],n[1]=t[2]*e[0]-t[0]*e[2],n[2]=t[0]*e[1]-t[1]*e[0],n}function Yi(t,e,n){return Ne(n,t[0]/e[0],t[1]/e[1],t[2]/e[2])}function cc(t){return Ne(t,0,0,0)}function lc(t,e){e=e||new Array(t.length*3);for(let n=0,r=0,i=t.length;n<i;++n,r+=3){const s=t[n];e[r]=s[0],e[r+1]=s[1],e[r+2]=s[2]}return e}function uc(t,e){return Ne(e,Ht(t[0]),Ht(t[1]),Ht(t[2]))}function vi(t,e){return Ne(e,1/t[0],1/t[1],1/t[2])}function Mt(t,e,n){return Ne(n,t[0]*e,t[1]*e,t[2]*e)}function qt(t,e,n){return Ne(n,t[0]-e[0],t[1]-e[1],t[2]-e[2])}function hc(t,e,n){return Ne(n,t[0]*e[0],t[1]*e[1],t[2]*e[2])}function dc(t,e,n,r){return Yt(Mt(qt(e,t),n),t,r)}function Js(t){return fc(t[0],t[1],t[2])}function fc(t,e,n){return Mo(t*t+e*e+n*n)}function ea(t,e,n){return Ne(n,Wt(t[0],e[0]),Wt(t[1],e[1]),Wt(t[2],e[2]))}function ta(t,e,n){return Ne(n,jt(t[0],e[0]),jt(t[1],e[1]),jt(t[2],e[2]))}function Nt(t,e){e=e||new Array(3);const n=Js(t);return e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n,e}function qi(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Vu(t,e){return t[0]*e[0]-t[1]*e[1]-t[2]*e[2]}function $u(t,e){return Ne(e,t[2],t[1],t[0])}function cr(t,...e){let n;if(e=e||[],Array.isArray(t)?n=t.slice(0,3):n=[t],n.length<3)for(let r=0,i=e.length;r<i&&n.length<3;++r){const s=e[r];Array.isArray(s)?n.push(...s.slice(0,3-n.length)):n.push(s)}for(;n.length<3;)n.push(0);return n}function Wu(t,e,n){return n=n||[0,0,0],Nt(wt(wt(t,e,n),t,n),n)}function ju(t,e,n){return n=n||[0,0,0],Nt(wt(t,e,n),n)}function Hu(t,e,n){return n=n||[0,0,0],Nt(wt(e,t,n),n)}function Qu(t,e,n){return n=n||[0,0,0],Nt(wt(t,wt(t,e,n),n),n)}function Le(t,e,n,r,i){return t=t||new Array(4),t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function na(t,e,n){return Le(n,t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3]+e[3])}function Xu(t,e,n){return Le(n,t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3])}function pc(t,e){return Le(e,Qt(t[0]),Qt(t[1]),Qt(t[2]),Qt(t[3]))}function Kt(t,e){return Le(e,t[0],t[1],t[2],t[3])}function ra(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Yu(t,e,n){return Xt(t[0]-e[0])<=n&&Xt(t[1]-e[1])<=n&&Xt(t[2]-e[2])<=n&&Xt(t[3]-e[3])<=n}function gc(t){return Le(t,0,0,-1,0)}function mc(t,e,n){return Le(n,0,0,0,1)}function vc(t,e,n){return Le(n,t[0]/e[0],t[1]/e[1],t[2]/e[2],t[3]/e[3])}function yc(t){return Le(t,0,0,0,0)}function ia(t,e){e=e||new Array(4);for(let n=0,r=0,i=t.length;n<i;++n,r+=4){const s=t[n];e[r]=s[0],e[r+1]=s[1],e[r+2]=s[2],e[r+3]=s[3]}return e}function wc(t,e){return Le(e,Ht(t[0]),Ht(t[1]),Ht(t[2]),Ht(t[3]))}function Tc(t,e){return Le(e,1/t[0],1/t[1],1/t[2],1/t[3])}function sa(t,e,n){return Le(n,t[0]*e,t[1]*e,t[2]*e,t[3]*e)}function aa(t,e,n){return Le(n,t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function bc(t,e,n){return Le(n,t[0]*e[0],t[1]*e[1],t[2]*e[2],t[3]*e[3])}function oa(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function qu(t,e){return t[0]*e[0]-t[1]*e[1]-t[2]*e[2]-t[3]*e[3]}function Ku(t,e){return Le(e,t[3],t[2],t[1],t[0])}function Ec(t,e,n,r){return na(sa(aa(e,t),n),t,r)}function ca(t){return Gn(t[0],t[1],t[2],t[3])}function Gn(t,e,n,r){return Mo(t*t+e*e+n*n+r*r)}function _c(t,e,n){return Le(n,Wt(t[0],e[0]),Wt(t[1],e[1]),Wt(t[2],e[2]),Wt(t[3],e[3]))}function Rc(t,e,n){return Le(n,jt(t[0],e[0]),jt(t[1],e[1]),jt(t[2],e[2]),jt(t[3],e[3]))}function Ac(t,e){const n=ca(t);return Le(e,t[0]/n,t[1]/n,t[2]/n,t[3]/n)}function Ki(t,...e){let n;if(e=e||[],Array.isArray(t)?n=t.slice(0,4):n=[t],n.length<4)for(let r=0,i=e.length;r<i&&n.length<4;++r){const s=e[r];Array.isArray(s)?n.push(...s.slice(0,4-n.length)):n.push(s)}for(;n.length<4;)n.push(0);return n}function Zu(t,e){return e=e||[0,0,0,0],Le(e,((t&16711680)>>16)/255,((t&65280)>>8)/255,(t&255)/255,1)}function Ju(t,e){return e=e||[0,0,0,0],Le(e,((t&4278190080)>>24)/255,((t&16711680)>>16)/255,((t&65280)>>8)/255,(t&255)/255)}function Sc(t,e,n,r){r=r||[0,0,0,0];const i=[0,0,0,0];let s,a,o,c,l;return a=t[1]*e[1]+t[2]*e[2]+t[3]*e[3]+t[0]*e[0],a<0?(a=-a,i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=-e[3]):(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1-a>1e-7?(s=zg(a),o=Io(s),c=Io((1-n)*s)/o,l=Io(n*s)/o):(c=1-n,l=n),r[1]=c*t[1]+l*i[1],r[2]=c*t[2]+l*i[2],r[3]=c*t[3]+l*i[3],r[0]=c*t[0]+l*i[0],r}const xc={add:Hs,ceil:Lo,copy:No,compare:Oo,cross:Do,divide:Fo,dot:jo,empty:Bo,flatten:Uo,floor:ko,forward:Po,inverse:Go,length:Qo,linear:Ho,max:zo,min:Vo,multiply:$o,normalize:Wo,scale:Qs,subtract:Xs,vec:Xo},Mc={add:kn,ceil:Yo,copy:Ys,compare:qs,cross:Ko,divide:Qi,dot:mi,empty:Zo,flatten:Jo,floor:ec,forward:qo,inverse:Ks,length:or,linear:sc,max:tc,min:nc,multiply:rc,normalize:ic,scale:Xe,subtract:je,vec:Zs},Ic={add:Yt,ceil:oc,copy:xt,compare:Xi,cross:wt,divide:Yi,dot:qi,empty:cc,flatten:lc,floor:uc,forward:kr,inverse:vi,length:Js,linear:dc,max:ea,min:ta,multiply:hc,normalize:Nt,scale:Mt,subtract:qt,vec:cr},Cc={add:na,ceil:pc,copy:Kt,compare:ra,cross:mc,divide:vc,dot:oa,empty:yc,flatten:ia,floor:wc,forward:gc,inverse:Tc,length:ca,linear:Ec,max:_c,min:Rc,multiply:bc,normalize:Ac,scale:sa,subtract:aa,vec:Ki,slerpQuat:Sc};function Q(t){let e;return t.length===1?(e=xc,e):t.length===2?(e=Mc,e):t.length===3?(e=Ic,e):(e=Cc,e)}function eh(t){return`[${t[0]}]`}function th(t){return`[${t[0]}, ${t[1]}]`}function nh(t){return`[${t[0]}, ${t[1]}, ${t[2]}]`}function rh(t){return`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`}const Vg=Object.freeze(Object.defineProperty({__proto__:null,V3R:gt,V4R:Lu,VecMath:Q,add1:Hs,add2:kn,add3:Yt,add4:na,add4by3:Xu,apply1:ot,apply2:Ce,apply3:Ne,apply4:Le,ceil1:Lo,ceil2:Yo,ceil3:oc,ceil4:pc,color4FromHex3:Zu,color4FromHex4:Ju,compare1:Oo,compare2:qs,compare3:Xi,compare4:ra,copy1:No,copy2:Ys,copy3:xt,copy4:Kt,cross1:Do,cross2:Ko,cross3:wt,cross4:mc,divide1:Fo,divide2:Qi,divide3:Yi,divide4:vc,dot1:jo,dot2:mi,dot3:qi,dot4:oa,down3:Qu,empty1:Bo,empty2:Zo,empty3:cc,empty4:yc,flatten1:Uo,flatten2:Jo,flatten3:lc,flatten4:ia,floor1:ko,floor2:ec,floor3:uc,floor4:wc,forward1:Po,forward2:qo,forward3:kr,forward4:gc,fuzzyCompare1:Pu,fuzzyCompare2:Bu,fuzzyCompare3:zu,fuzzyCompare4:Yu,inverse1:Go,inverse2:Ks,inverse3:vi,inverse4:Tc,isVec1:Ou,isVec2:Co,isVec3:Nu,isVec4:X,left3:Hu,length1:Qo,length1Components:Fu,length2:or,length2Components:ac,length3:Js,length3Components:fc,length4:ca,length4Components:Gn,linear1:Ho,linear2:sc,linear3:dc,linear4:Ec,max1:zo,max2:tc,max3:ea,max4:_c,min1:Vo,min2:nc,min3:ta,min4:Rc,multiply1:$o,multiply2:rc,multiply3:hc,multiply4:bc,normalize1:Wo,normalize2:ic,normalize3:Nt,normalize4:Ac,reverse2:Gu,reverse3:$u,reverse4:Ku,right3:ju,scale1:Qs,scale2:Xe,scale3:Mt,scale4:sa,slerpQuat:Sc,subtract1:Xs,subtract2:je,subtract3:qt,subtract4:aa,toString1:eh,toString2:th,toString3:nh,toString4:rh,tod1:Du,tod2:Uu,tod3:Vu,tod4:qu,tod_flip2:ku,up3:Wu,vec1:Xo,vec1Methods:xc,vec2:Zs,vec2Methods:Mc,vec3:cr,vec3Methods:Ic,vec4:Ki,vec4Methods:Cc},Symbol.toStringTag,{value:"Module"})),{min:la,max:ua}=Math;class we{constructor(e){this.x=0,this.y=0,this.width=0,this.height=0,this.x=e.x||e.left||0,this.y=e.y||e.top||0,this.height=e.height||(e.bottom||0)-this.y||0,this.width=e.width||(e.right||0)-this.x||0}get area(){return this.width*this.height}get bottom(){return this.y+this.height}get left(){return this.x}get mid(){return[this.x+this.width/2,this.y+this.height/2]}get right(){return this.x+this.width}get top(){return this.y}static emptyBounds(){return new we({height:0,width:0,x:0,y:0})}containsPoint(e){return!(e[0]<this.x||e[1]<this.y||e[0]>this.right||e[1]>this.bottom)}encapsulate(e){return e instanceof we?(e.x<this.x&&(this.width+=Math.abs(e.x-this.x),this.x=e.x),e.y<this.y&&(this.height+=Math.abs(e.y-this.y),this.y=e.y),this.right<e.right&&(this.width+=e.right-this.right),this.bottom<e.bottom&&(this.height+=e.bottom-this.bottom),!0):(e[0]<this.x&&(this.width+=this.x-e[0],this.x=e[0]),e[0]>this.right&&(this.width+=e[0]-this.x),e[1]<this.y&&(this.height+=this.y-e[1],this.y=e[1]),e[1]>this.bottom&&(this.height+=e[1]-this.y),!0)}encapsulateAll(e){if(e.length<=0)return;let n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;if(e[0]instanceof we){const a=e;for(let o=0,c=a.length;o<c;++o){const l=a[o];n=la(n,l.left),r=ua(r,l.right),i=la(i,l.top),s=ua(s,l.bottom)}}else{const a=e;for(let o=0,c=a.length;o<c;++o){const[l,u]=a[o];n=la(n,l),r=ua(r,l),i=la(i,u),s=ua(s,u)}}this.x=Math.min(this.x,n),this.y=Math.min(this.y,i),this.width=Math.max(this.width,r-n),this.height=Math.max(this.height,s-i)}fits(e){return this.width===e.width&&this.height===e.height?1:this.width>=e.width&&this.height>=e.height?2:0}hitBounds(e){return!(this.right<e.x||this.x>e.right||this.bottom<e.y||this.y>e.bottom)}isInside(e){return this.x>=e.x&&this.right<=e.right&&this.y>=e.y&&this.bottom<=e.bottom}get location(){return[this.x,this.y]}toString(){return`{x: ${this.x} y:${this.y} w:${this.width} h:${this.height}}`}}function Zt(t,e,n){const r=`${t}`,i=parseFloat(r);return isNaN(i)?0:r.indexOf("%")>-1?i/100*e:i*n}const yi=new WeakSet;function Lc(t,e,n){(e.width===0||e.height===0)&&(yi.has(t)||(console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are non-zero.","item:",t,"reference:",e.toString()),yi.add(t)));const r=we.emptyBounds();let i,s;if(t.width)r.width=Zt(t.width,e.width,n),t.left!==void 0?r.x=Zt(t.left,e.width,n):t.right!==void 0&&(r.x=e.width-Zt(t.right,e.width,n)-r.width);else{const a=Zt(t.left||0,e.width,n);i=e.width-Zt(t.right||0,e.width,n)-a,i<0&&(yi.has(t)||(console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are greater than zero.","item:",t,"reference:",e.toString()),yi.add(t))),r.x=a,r.width=i}if(t.height)r.height=Zt(t.height,e.height,n),t.top!==void 0?r.y=Zt(t.top,e.height,n):t.bottom!==void 0&&(r.y=e.height-Zt(t.bottom,e.height,n)-r.height);else{const a=Zt(t.top||0,e.height,n);s=e.height-Zt(t.bottom||0,e.height,n)-a,(s===void 0||s<0)&&(yi.has(t)||(console.warn("An AbsolutePosition evaluated to invalid dimensions.","Please ensure that the object provided and the reference has valid dimensions","to produce dimensions with width and height that are greater than zero.","item:",t,"reference:",e.toString()),yi.add(t))),r.y=a,r.height=s}return(r.width===0||r.height===0||isNaN(r.x+r.y+r.width+r.height))&&(r.x=0,r.y=0,r.width=e.width,r.height=e.height),r}class zn{constructor(e,n,r=!1,i=!1){this._isInstanced=!1,this._fullUpdate=!1,this.normalize=!1,this._needsUpdate=!1,this._updateRange={count:-1,offset:-1},this.data=e,this.size=n,this._isDynamic=r,this._isInstanced=i}get isDynamic(){return this._isDynamic}get isInstanced(){return this._isInstanced}get fullUpdate(){return this._fullUpdate}get needsUpdate(){return this._needsUpdate}get updateRange(){return this._updateRange}set updateRange(e){this._updateRange=e,this._needsUpdate=!0}destroy(){this.gl&&this.gl.proxy.disposeAttribute(this)}resolve(){this._needsUpdate=!1,this._fullUpdate=!1}setDynamic(e){this._isDynamic=e,this._needsUpdate=!0,this._fullUpdate=!0}}class lr{constructor(){this._attributes={},this.maxInstancedCount=0,this.isInstanced=!1}get attributes(){return new Map(Object.entries(this._attributes))}addAttribute(e,n){this._attributes[e]=n,this.isInstanced=!1;let r;Object.values(this._attributes).forEach(i=>{const s=i.isInstanced?1:0;r===void 0&&(r=s),(r^s)===1&&(this.isInstanced=!0)})}removeAttribute(e){delete this._attributes[e]}destroy(){this.attributes.forEach(e=>e.destroy()),this.gl&&this.gl.proxy.disposeGeometry(this)}}d.GLSettings=void 0,(t=>{(e=>{(n=>{n[n.RGBA4=0]="RGBA4",n[n.RGB565=1]="RGB565",n[n.RGB5_A1=2]="RGB5_A1",n[n.R8=3]="R8",n[n.R8UI=4]="R8UI",n[n.R8I=5]="R8I",n[n.R16UI=6]="R16UI",n[n.R16I=7]="R16I",n[n.R32UI=8]="R32UI",n[n.R32I=9]="R32I",n[n.RG8=10]="RG8",n[n.RG8UI=11]="RG8UI",n[n.RG8I=12]="RG8I",n[n.RG16UI=13]="RG16UI",n[n.RG16I=14]="RG16I",n[n.RG32UI=15]="RG32UI",n[n.RG32I=16]="RG32I",n[n.RGB8=17]="RGB8",n[n.RGBA8=18]="RGBA8",n[n.SRGB8_ALPHA8=19]="SRGB8_ALPHA8",n[n.RGB10_A2=20]="RGB10_A2",n[n.RGBA8UI=21]="RGBA8UI",n[n.RGBA8I=22]="RGBA8I",n[n.RGB10_A2UI=23]="RGB10_A2UI",n[n.RGBA16UI=24]="RGBA16UI",n[n.RGBA16I=25]="RGBA16I",n[n.RGBA32I=26]="RGBA32I",n[n.RGBA32UI=27]="RGBA32UI"})(e.ColorBufferFormat||(e.ColorBufferFormat={})),(n=>{n[n.DEPTH_COMPONENT16=0]="DEPTH_COMPONENT16",n[n.DEPTH_STENCIL=1]="DEPTH_STENCIL",n[n.DEPTH_COMPONENT24=2]="DEPTH_COMPONENT24",n[n.DEPTH_COMPONENT32F=3]="DEPTH_COMPONENT32F",n[n.DEPTH24_STENCIL8=4]="DEPTH24_STENCIL8",n[n.DEPTH32F_STENCIL8=5]="DEPTH32F_STENCIL8"})(e.DepthBufferFormat||(e.DepthBufferFormat={})),(n=>{n[n.STENCIL_INDEX8=0]="STENCIL_INDEX8"})(e.StencilBufferFormat||(e.StencilBufferFormat={}))})(t.RenderTarget||(t.RenderTarget={})),(e=>{(n=>{n[n.NoBlending=-1]="NoBlending",n[n.NormalBlending=1]="NormalBlending",n[n.AdditiveBlending=2]="AdditiveBlending",n[n.SubtractiveBlending=3]="SubtractiveBlending",n[n.MultiplyBlending=4]="MultiplyBlending"})(e.Blending||(e.Blending={})),(n=>{n[n.Zero=-1]="Zero",n[n.One=1]="One",n[n.SrcColor=2]="SrcColor",n[n.OneMinusSrcColor=3]="OneMinusSrcColor",n[n.SrcAlpha=4]="SrcAlpha",n[n.OneMinusSrcAlpha=5]="OneMinusSrcAlpha",n[n.DstAlpha=6]="DstAlpha",n[n.OneMinusDstAlpha=7]="OneMinusDstAlpha",n[n.DstColor=8]="DstColor",n[n.OneMinusDstColor=9]="OneMinusDstColor"})(e.BlendingDstFactor||(e.BlendingDstFactor={})),(n=>{n[n.Zero=-1]="Zero",n[n.One=1]="One",n[n.SrcColor=2]="SrcColor",n[n.OneMinusSrcColor=3]="OneMinusSrcColor",n[n.SrcAlpha=4]="SrcAlpha",n[n.OneMinusSrcAlpha=5]="OneMinusSrcAlpha",n[n.DstAlpha=6]="DstAlpha",n[n.OneMinusDstAlpha=7]="OneMinusDstAlpha",n[n.DstColor=8]="DstColor",n[n.OneMinusDstColor=9]="OneMinusDstColor",n[n.SrcAlphaSaturate=10]="SrcAlphaSaturate"})(e.BlendingSrcFactor||(e.BlendingSrcFactor={})),(n=>{n[n.Add=-1]="Add",n[n.Subtract=1]="Subtract",n[n.ReverseSubtract=2]="ReverseSubtract"})(e.BlendingEquations||(e.BlendingEquations={})),(n=>{n[n.NEVER=-1]="NEVER",n[n.LESS=1]="LESS",n[n.EQUAL=2]="EQUAL",n[n.LESS_OR_EQUAL=3]="LESS_OR_EQUAL",n[n.GREATER=4]="GREATER",n[n.NOTEQUAL=5]="NOTEQUAL",n[n.GREATER_OR_EQUAL=6]="GREATER_OR_EQUAL",n[n.ALWAYS=7]="ALWAYS"})(e.DepthFunctions||(e.DepthFunctions={})),(n=>{n[n.NONE=-1]="NONE",n[n.CW=1]="CW",n[n.CCW=2]="CCW",n[n.BOTH=3]="BOTH"})(e.CullSide||(e.CullSide={}))})(t.Material||(t.Material={})),(e=>{(n=>{n[n.LINE_LOOP=0]="LINE_LOOP",n[n.LINE_STRIP=1]="LINE_STRIP",n[n.LINES=2]="LINES",n[n.POINTS=3]="POINTS",n[n.TRIANGLE_FAN=4]="TRIANGLE_FAN",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLES=6]="TRIANGLES"})(e.DrawMode||(e.DrawMode={}))})(t.Model||(t.Model={})),(e=>{(n=>{n[n.TEXTURE_2D=0]="TEXTURE_2D",n[n.CUBE_MAP=1]="CUBE_MAP"})(e.TextureBindingTarget||(e.TextureBindingTarget={})),(n=>{n[n.REPEAT=-1]="REPEAT",n[n.CLAMP_TO_EDGE=1]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(e.Wrapping||(e.Wrapping={})),(n=>{n[n.Nearest=-1]="Nearest",n[n.NearestMipMapNearest=1]="NearestMipMapNearest",n[n.NearestMipMapLinear=2]="NearestMipMapLinear",n[n.Linear=3]="Linear",n[n.LinearMipMapNearest=4]="LinearMipMapNearest",n[n.LinearMipMapLinear=5]="LinearMipMapLinear"})(e.TextureMinFilter||(e.TextureMinFilter={})),(n=>{n[n.Nearest=-1]="Nearest",n[n.Linear=1]="Linear"})(e.TextureMagFilter||(e.TextureMagFilter={})),(n=>{n[n.UnsignedByte=-1]="UnsignedByte",n[n.UnsignedShort_5_6_5=1]="UnsignedShort_5_6_5",n[n.UnsignedShort_4_4_4_4=2]="UnsignedShort_4_4_4_4",n[n.UnsignedShort_5_5_5_1=3]="UnsignedShort_5_5_5_1",n[n.UnsignedShort=4]="UnsignedShort",n[n.UnsignedInt=5]="UnsignedInt",n[n.UnsignedInt_24_8=6]="UnsignedInt_24_8",n[n.Byte=7]="Byte",n[n.Short=8]="Short",n[n.Int=9]="Int",n[n.Float=10]="Float",n[n.HalfFloat=11]="HalfFloat",n[n.UnsignedInt_2_10_10_10_REV=12]="UnsignedInt_2_10_10_10_REV",n[n.UnsignedInt_10F_11F_11F_REV=13]="UnsignedInt_10F_11F_11F_REV",n[n.UnsignedInt_5_9_9_9_REV=14]="UnsignedInt_5_9_9_9_REV",n[n.Float32UnsignedInt_24_8_REV=15]="Float32UnsignedInt_24_8_REV"})(e.SourcePixelFormat||(e.SourcePixelFormat={})),(n=>{n[n.Alpha=-1]="Alpha",n[n.DepthComponent=1]="DepthComponent",n[n.DepthStencil=2]="DepthStencil",n[n.Luminance=3]="Luminance",n[n.LuminanceAlpha=4]="LuminanceAlpha",n[n.RGB=5]="RGB",n[n.RGBA=6]="RGBA",n[n.RGBE=7]="RGBE",n[n.R8=8]="R8",n[n.R16F=9]="R16F",n[n.R32F=10]="R32F",n[n.R8UI=11]="R8UI",n[n.RG8=12]="RG8",n[n.RG16F=13]="RG16F",n[n.RG32F=14]="RG32F",n[n.RG8UI=15]="RG8UI",n[n.RG16UI=16]="RG16UI",n[n.RG32UI=17]="RG32UI",n[n.RGB8=18]="RGB8",n[n.SRGB8=19]="SRGB8",n[n.RGB565=20]="RGB565",n[n.R11F_G11F_B10F=21]="R11F_G11F_B10F",n[n.RGB9_E5=22]="RGB9_E5",n[n.RGB16F=23]="RGB16F",n[n.RGB32F=24]="RGB32F",n[n.RGB8UI=25]="RGB8UI",n[n.RGBA8=26]="RGBA8",n[n.SRGB8_ALPHA8=27]="SRGB8_ALPHA8",n[n.RGB5_A1=28]="RGB5_A1",n[n.RGB10_A2=29]="RGB10_A2",n[n.RGBA4=30]="RGBA4",n[n.RGBA16F=31]="RGBA16F",n[n.RGBA32F=32]="RGBA32F",n[n.RGBA8UI=33]="RGBA8UI",n[n.DEPTH_COMPONENT16=34]="DEPTH_COMPONENT16",n[n.DEPTH_COMPONENT24=35]="DEPTH_COMPONENT24",n[n.DEPTH_COMPONENT32F=36]="DEPTH_COMPONENT32F",n[n.RGBA32UI=37]="RGBA32UI",n[n.RGB32UI=38]="RGB32UI",n[n.RGBA16UI=39]="RGBA16UI",n[n.RGB16UI=40]="RGB16UI",n[n.RGBA32I=41]="RGBA32I",n[n.RGB32I=42]="RGB32I",n[n.RGBA16I=43]="RGBA16I",n[n.RGB16I=44]="RGB16I",n[n.RGBA8I=45]="RGBA8I",n[n.RGB8I=46]="RGB8I",n[n.RED_INTEGER=47]="RED_INTEGER",n[n.RG_INTEGER=48]="RG_INTEGER",n[n.RGB_INTEGER=49]="RGB_INTEGER",n[n.RGBA_INTEGER=50]="RGBA_INTEGER"})(e.TexelDataType||(e.TexelDataType={})),(n=>{n[n.ONE=1]="ONE",n[n.TWO=2]="TWO",n[n.FOUR=4]="FOUR",n[n.EIGHT=8]="EIGHT"})(e.PackAlignment||(e.PackAlignment={})),(n=>{n[n.ONE=1]="ONE",n[n.TWO=2]="TWO",n[n.FOUR=4]="FOUR",n[n.EIGHT=8]="EIGHT"})(e.UnpackAlignment||(e.UnpackAlignment={}))})(t.Texture||(t.Texture={})),(e=>{(n=>{n[n.ALPHA=0]="ALPHA",n[n.RGB=1]="RGB",n[n.RGBA=2]="RGBA"})(e.ReadFilter||(e.ReadFilter={})),(n=>{n[n.UNSIGNED_BYTE=0]="UNSIGNED_BYTE",n[n.UNSIGNED_SHORT_5_6_5=1]="UNSIGNED_SHORT_5_6_5",n[n.UNSIGNED_SHORT_4_4_4_4=2]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=3]="UNSIGNED_SHORT_5_5_5_1",n[n.FLOAT=4]="FLOAT"})(e.ReadTargetArrayFormat||(e.ReadTargetArrayFormat={}))})(t.Renderer||(t.Renderer={}))})(d.GLSettings||(d.GLSettings={}));function $g(t,e){const n={attributeCount:0,attributes:[],uniformCount:0,uniforms:[]},r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),s={35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT"},a={35664:1,35665:1,35666:1,35667:1,35668:1,35669:1,35670:1,35671:1,35672:1,35673:1,35674:1,35675:3,35676:4,35678:1,35680:1,5120:1,5121:1,5122:1,5123:1,5124:1,5125:1,5126:1};for(let o=0;o<r;++o){const c=t.getActiveUniform(e,o);c.typeName=s[c.type],n.uniforms.push(c),n.uniformCount+=c.size,c.size=c.size*a[c.type]}for(let o=0;o<i;o++){const c=t.getActiveAttrib(e,o);c.typeName=s[c.type],n.attributes.push(c),n.attributeCount+=c.size}return n}const ih=class{static print(){return Object.assign({},ih)}};let U=ih;U.VAO=!1,U.DEPTH_TEXTURE=!1,U.MAX_VERTEX_UNIFORMS=0,U.MAX_FRAGMENT_UNIFORMS=0,U.MAX_VERTEX_ATTRIBUTES=0,U.WEBGL_SUPPORTED=!1,U.MAX_TEXTURE_SIZE=0,U.HARDWARE_INSTANCING=!1,U.MRT_EXTENSION=!1,U.MRT=!1,U.MAX_COLOR_ATTACHMENTS=0,U.SHADERS_3_0=!1,U.WEBGL_VERSION="none",U.FLOAT_TEXTURE_READ={half:!1,full:!1,halfLinearFilter:!1,fullLinearFilter:!1},U.FLOAT_TEXTURE_WRITE={half:!1,full:!1};function Wg(){function t(){try{const r=document.createElement("canvas");let i;return i=r.getContext("webgl2"),i?(U.WEBGL_VERSION="webgl2",i):(i=r.getContext("webgl"),i?(U.WEBGL_VERSION="webgl",i):(i=r.getContext("experimental-webgl"),i?(U.WEBGL_VERSION="experimental-webgl",i):null))}catch{return null}}function e(r){U.FLOAT_TEXTURE_READ.fullLinearFilter=!!r.getExtension("OES_texture_float_linear"),U.FLOAT_TEXTURE_READ.halfLinearFilter=!!r.getExtension("OES_texture_half_float_linear");const i=r.createTexture();if(r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.getError()!==r.NO_ERROR)throw new Error("WebGLStat could not create a texture");const s=r.getExtension("OES_texture_float")||r.getExtension("EXT_color_buffer_float");if(r.getExtension("WEBGL_color_buffer_float"),s){r.texImage2D(r.TEXTURE_2D,0,r instanceof WebGL2RenderingContext?r.RGBA32F:r.RGBA,2,2,0,r.RGBA,r.FLOAT,null),r.getError()===r.NO_ERROR&&(U.FLOAT_TEXTURE_READ.full=!0);const u=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,u),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,i,0),r.bindTexture(r.TEXTURE_2D,null),r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE&&(U.FLOAT_TEXTURE_WRITE.full=!0),r.deleteFramebuffer(u),r.deleteTexture(i)}const a=r.createTexture();if(r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.getError()!==r.NO_ERROR)throw new Error("WebGLStat could not create a texture");const o=r.getExtension("OES_texture_half_float")||r.getExtension("EXT_color_buffer_float");if(o){r.texImage2D(r.TEXTURE_2D,0,r instanceof WebGL2RenderingContext?r.RGBA16F:r.RGBA,2,2,0,r.RGBA,r instanceof WebGL2RenderingContext?r.HALF_FLOAT:o.HALF_FLOAT_OES,null),r.getError()===r.NO_ERROR&&(U.FLOAT_TEXTURE_READ.full=!0);const u=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,u),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0),r.bindTexture(r.TEXTURE_2D,null),r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE&&(U.FLOAT_TEXTURE_WRITE.full=!0),r.deleteFramebuffer(u),r.deleteTexture(a)}}const n=t();if(n)if(U.WEBGL_SUPPORTED=!0,U.MAX_VERTEX_UNIFORMS=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),U.MAX_FRAGMENT_UNIFORMS=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),U.MAX_VERTEX_ATTRIBUTES=n.getParameter(n.MAX_VERTEX_ATTRIBS),U.MAX_TEXTURE_SIZE=n.getParameter(n.MAX_TEXTURE_SIZE),e(n),n instanceof WebGL2RenderingContext)U.VAO=!0,U.MRT=!0,U.HARDWARE_INSTANCING=!0,U.SHADERS_3_0=!0,U.HARDWARE_INSTANCING=!0,U.DEPTH_TEXTURE=!0,U.MAX_COLOR_ATTACHMENTS=n.getParameter(n.MAX_COLOR_ATTACHMENTS);else{U.VAO=!!n.getExtension("OES_vertex_array_object"),U.HARDWARE_INSTANCING=!!n.getExtension("ANGLE_instanced_arrays");const r=n.getExtension("WEBGL_draw_buffers");U.MRT_EXTENSION=!!r,U.MRT=!!r,U.DEPTH_TEXTURE=!!n.getExtension("WEBGL_depth_texture"),r&&(U.MAX_COLOR_ATTACHMENTS=n.getParameter(r.MAX_COLOR_ATTACHMENTS_WEBGL))}window.WebGLStat=U}Wg();function ha(t,e){switch(e){case d.GLSettings.Model.DrawMode.LINES:return t.LINES;case d.GLSettings.Model.DrawMode.LINE_LOOP:return t.LINE_LOOP;case d.GLSettings.Model.DrawMode.LINE_STRIP:return t.LINE_STRIP;case d.GLSettings.Model.DrawMode.POINTS:return t.POINTS;case d.GLSettings.Model.DrawMode.TRIANGLES:return t.TRIANGLES;case d.GLSettings.Model.DrawMode.TRIANGLE_FAN:return t.TRIANGLE_FAN;case d.GLSettings.Model.DrawMode.TRIANGLE_STRIP:return t.TRIANGLE_STRIP;default:return t.TRIANGLES}}function Gr(t,e){switch(e){case d.GLSettings.Texture.TexelDataType.Alpha:return t.ALPHA;case d.GLSettings.Texture.TexelDataType.DepthComponent:return t.DEPTH_COMPONENT;case d.GLSettings.Texture.TexelDataType.DepthStencil:return t.DEPTH_STENCIL;case d.GLSettings.Texture.TexelDataType.Luminance:return t.LUMINANCE;case d.GLSettings.Texture.TexelDataType.LuminanceAlpha:return t.LUMINANCE_ALPHA;case d.GLSettings.Texture.TexelDataType.RGB:return t.RGB;case d.GLSettings.Texture.TexelDataType.RGBA:return t.RGBA;default:if(t instanceof WebGL2RenderingContext)switch(e){case d.GLSettings.Texture.TexelDataType.R8:return t.R8;case d.GLSettings.Texture.TexelDataType.R16F:return t.R16F;case d.GLSettings.Texture.TexelDataType.R32F:return t.R32F;case d.GLSettings.Texture.TexelDataType.R8UI:return t.R8UI;case d.GLSettings.Texture.TexelDataType.RG8:return t.RG8;case d.GLSettings.Texture.TexelDataType.RG16F:return t.RG16F;case d.GLSettings.Texture.TexelDataType.RG32F:return t.RG32F;case d.GLSettings.Texture.TexelDataType.RG8UI:return t.RG8UI;case d.GLSettings.Texture.TexelDataType.RG16UI:return t.RG16UI;case d.GLSettings.Texture.TexelDataType.RG32UI:return t.RG32UI;case d.GLSettings.Texture.TexelDataType.RGB8:return t.RGB8;case d.GLSettings.Texture.TexelDataType.SRGB8:return t.SRGB8;case d.GLSettings.Texture.TexelDataType.RGB565:return t.RGB565;case d.GLSettings.Texture.TexelDataType.R11F_G11F_B10F:return t.R11F_G11F_B10F;case d.GLSettings.Texture.TexelDataType.RGB9_E5:return t.RGB9_E5;case d.GLSettings.Texture.TexelDataType.RGB16F:return t.RGB16F;case d.GLSettings.Texture.TexelDataType.RGB32F:return t.RGB32F;case d.GLSettings.Texture.TexelDataType.RGB8UI:return t.RGB8UI;case d.GLSettings.Texture.TexelDataType.RGBA8:return t.RGBA8;case d.GLSettings.Texture.TexelDataType.SRGB8_ALPHA8:return t.SRGB8_ALPHA8;case d.GLSettings.Texture.TexelDataType.RGB5_A1:return t.RGB5_A1;case d.GLSettings.Texture.TexelDataType.RGB10_A2:return t.RGB10_A2;case d.GLSettings.Texture.TexelDataType.RGBA4:return t.RGBA4;case d.GLSettings.Texture.TexelDataType.RGBA16F:return t.RGBA16F;case d.GLSettings.Texture.TexelDataType.RGBA32F:return U.FLOAT_TEXTURE_READ.full&&U.FLOAT_TEXTURE_WRITE.full?t.RGBA32F:t.RGBA16F;case d.GLSettings.Texture.TexelDataType.RGBA8UI:return t.RGBA8UI;case d.GLSettings.Texture.TexelDataType.DEPTH_COMPONENT16:return t.DEPTH_COMPONENT16;case d.GLSettings.Texture.TexelDataType.DEPTH_COMPONENT24:return t.DEPTH_COMPONENT24;case d.GLSettings.Texture.TexelDataType.DEPTH_COMPONENT32F:return t.DEPTH_COMPONENT32F;case d.GLSettings.Texture.TexelDataType.RGBA32UI:return t.RGBA32UI;case d.GLSettings.Texture.TexelDataType.RGB32UI:return t.RGB32UI;case d.GLSettings.Texture.TexelDataType.RGBA16UI:return t.RGBA16UI;case d.GLSettings.Texture.TexelDataType.RGB16UI:return t.RGB16UI;case d.GLSettings.Texture.TexelDataType.RGBA32I:return t.RGBA32I;case d.GLSettings.Texture.TexelDataType.RGB32I:return t.RGB32I;case d.GLSettings.Texture.TexelDataType.RGBA16I:return t.RGBA16I;case d.GLSettings.Texture.TexelDataType.RGB16I:return t.RGB16I;case d.GLSettings.Texture.TexelDataType.RGBA8I:return t.RGBA8I;case d.GLSettings.Texture.TexelDataType.RGB8I:return t.RGB8I;default:return console.warn("An unsupported texel format was provided that is not supported in WebGL 1 or 2"),t.RGBA}return console.warn("An Unsupported texel format was provided. Some formats are only available in WebGL 2",e),t.RGBA}}function Zi(t,e){switch(e){case d.GLSettings.Texture.SourcePixelFormat.Byte:return t.BYTE;case d.GLSettings.Texture.SourcePixelFormat.Float:return t.FLOAT;case d.GLSettings.Texture.SourcePixelFormat.HalfFloat:return console.warn("Unsupported HALF_FLOAT"),t.BYTE;case d.GLSettings.Texture.SourcePixelFormat.Int:return t.INT;case d.GLSettings.Texture.SourcePixelFormat.Short:return t.SHORT;case d.GLSettings.Texture.SourcePixelFormat.UnsignedByte:return t.UNSIGNED_BYTE;case d.GLSettings.Texture.SourcePixelFormat.UnsignedInt:return t.UNSIGNED_INT;case d.GLSettings.Texture.SourcePixelFormat.UnsignedShort:return t.UNSIGNED_SHORT;case d.GLSettings.Texture.SourcePixelFormat.UnsignedShort_4_4_4_4:return t.UNSIGNED_SHORT_4_4_4_4;case d.GLSettings.Texture.SourcePixelFormat.UnsignedShort_5_5_5_1:return t.UNSIGNED_SHORT_5_5_5_1;case d.GLSettings.Texture.SourcePixelFormat.UnsignedShort_5_6_5:return t.UNSIGNED_SHORT_5_6_5;default:return console.warn("An Unsupported input image format was provided",e),t.BYTE}}function zr(t,e){switch(e){case d.GLSettings.Texture.TextureMagFilter.Linear:return t.LINEAR;case d.GLSettings.Texture.TextureMagFilter.Nearest:return t.NEAREST}}function Vn(t,e,n){switch(e){case d.GLSettings.Texture.TextureMinFilter.Linear:return t.LINEAR;case d.GLSettings.Texture.TextureMinFilter.Nearest:return t.NEAREST;case d.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear:return n?t.LINEAR_MIPMAP_LINEAR:t.LINEAR;case d.GLSettings.Texture.TextureMinFilter.LinearMipMapNearest:return n?t.LINEAR_MIPMAP_NEAREST:t.LINEAR;case d.GLSettings.Texture.TextureMinFilter.NearestMipMapLinear:return n?t.NEAREST_MIPMAP_LINEAR:t.NEAREST;case d.GLSettings.Texture.TextureMinFilter.NearestMipMapNearest:return n?t.NEAREST_MIPMAP_NEAREST:t.NEAREST;default:return t.LINEAR}}function sh(t,e){switch(e){case d.GLSettings.RenderTarget.ColorBufferFormat.RGB565:return t.RGB565;case d.GLSettings.RenderTarget.ColorBufferFormat.RGB5_A1:return t.RGB5_A1;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA4:return t.RGBA4;default:if(t instanceof WebGL2RenderingContext)switch(e){case d.GLSettings.RenderTarget.ColorBufferFormat.R8:return t.R8;case d.GLSettings.RenderTarget.ColorBufferFormat.R8UI:return t.R8UI;case d.GLSettings.RenderTarget.ColorBufferFormat.R8I:return t.R8I;case d.GLSettings.RenderTarget.ColorBufferFormat.R16UI:return t.R16UI;case d.GLSettings.RenderTarget.ColorBufferFormat.R16I:return t.R16I;case d.GLSettings.RenderTarget.ColorBufferFormat.R32UI:return t.R32UI;case d.GLSettings.RenderTarget.ColorBufferFormat.R32I:return t.R32I;case d.GLSettings.RenderTarget.ColorBufferFormat.RG8:return t.RG8;case d.GLSettings.RenderTarget.ColorBufferFormat.RG8UI:return t.RG8UI;case d.GLSettings.RenderTarget.ColorBufferFormat.RG8I:return t.RG8I;case d.GLSettings.RenderTarget.ColorBufferFormat.RG16UI:return t.RG16UI;case d.GLSettings.RenderTarget.ColorBufferFormat.RG16I:return t.RG16I;case d.GLSettings.RenderTarget.ColorBufferFormat.RG32UI:return t.RG32UI;case d.GLSettings.RenderTarget.ColorBufferFormat.RG32I:return t.RG32I;case d.GLSettings.RenderTarget.ColorBufferFormat.RGB8:return t.RGB8;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA8:return t.RGBA8;case d.GLSettings.RenderTarget.ColorBufferFormat.SRGB8_ALPHA8:return t.SRGB8_ALPHA8;case d.GLSettings.RenderTarget.ColorBufferFormat.RGB10_A2:return t.RGB10_A2;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA8UI:return t.RGBA8UI;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA8I:return t.RGBA8I;case d.GLSettings.RenderTarget.ColorBufferFormat.RGB10_A2UI:return t.RGB10_A2UI;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA16UI:return t.RGBA16UI;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA16I:return t.RGBA16I;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA32I:return t.RGBA32I;case d.GLSettings.RenderTarget.ColorBufferFormat.RGBA32UI:return t.RGBA32UI}return t.RGBA4}}function ah(t,e){switch(e){case d.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT16:return t.DEPTH_COMPONENT16;case d.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_STENCIL:return t.DEPTH_STENCIL;default:if(t instanceof WebGL2RenderingContext)switch(e){case d.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT24:return t.DEPTH_COMPONENT24;case d.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT32F:return t.DEPTH_COMPONENT32F;case d.GLSettings.RenderTarget.DepthBufferFormat.DEPTH24_STENCIL8:return t.DEPTH24_STENCIL8;case d.GLSettings.RenderTarget.DepthBufferFormat.DEPTH32F_STENCIL8:return t.DEPTH32F_STENCIL8}return t.DEPTH_COMPONENT16}}function oh(t,e){switch(e){case d.GLSettings.RenderTarget.StencilBufferFormat.STENCIL_INDEX8:return t.STENCIL_INDEX8;default:return t.STENCIL_INDEX8}}function Oc(t,e){switch(e){case d.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE:return t.CLAMP_TO_EDGE;case d.GLSettings.Texture.Wrapping.MIRRORED_REPEAT:return t.MIRRORED_REPEAT;case d.GLSettings.Texture.Wrapping.REPEAT:return t.REPEAT}}function Ji(t,e,n,r,i){if(r)return t.COLOR_ATTACHMENT0;const s=e.drawBuffers;if(i){if(s instanceof WebGL2RenderingContext)switch(n){case-2:return t.BACK;case-1:return t.NONE;case 0:return s.DRAW_BUFFER0;case 1:return s.DRAW_BUFFER1;case 2:return s.DRAW_BUFFER2;case 3:return s.DRAW_BUFFER3;case 4:return s.DRAW_BUFFER4;case 5:return s.DRAW_BUFFER5;case 6:return s.DRAW_BUFFER6;case 7:return s.DRAW_BUFFER7;case 8:return s.DRAW_BUFFER8;case 9:return s.DRAW_BUFFER9;case 10:return s.DRAW_BUFFER10;case 11:return s.DRAW_BUFFER11;case 12:return s.DRAW_BUFFER12;case 13:return s.DRAW_BUFFER13;case 14:return s.DRAW_BUFFER14;case 15:return s.DRAW_BUFFER15;default:console.warn("Attachments are only available for -2 - 15")}else if(s)switch(n){case-2:return t.BACK;case-1:return t.NONE;case 0:return s.DRAW_BUFFER0_WEBGL;case 1:return s.DRAW_BUFFER1_WEBGL;case 2:return s.DRAW_BUFFER2_WEBGL;case 3:return s.DRAW_BUFFER3_WEBGL;case 4:return s.DRAW_BUFFER4_WEBGL;case 5:return s.DRAW_BUFFER5_WEBGL;case 6:return s.DRAW_BUFFER6_WEBGL;case 7:return s.DRAW_BUFFER7_WEBGL;case 8:return s.DRAW_BUFFER8_WEBGL;case 9:return s.DRAW_BUFFER9_WEBGL;case 10:return s.DRAW_BUFFER10_WEBGL;case 11:return s.DRAW_BUFFER11_WEBGL;case 12:return s.DRAW_BUFFER12_WEBGL;case 13:return s.DRAW_BUFFER13_WEBGL;case 14:return s.DRAW_BUFFER14_WEBGL;case 15:return s.DRAW_BUFFER15_WEBGL;default:console.warn("Attachments are only available for 0 - 15")}}else if(s instanceof WebGL2RenderingContext)switch(n){case-2:return t.BACK;case-1:return t.NONE;case 0:return s.COLOR_ATTACHMENT0;case 1:return s.COLOR_ATTACHMENT1;case 2:return s.COLOR_ATTACHMENT2;case 3:return s.COLOR_ATTACHMENT3;case 4:return s.COLOR_ATTACHMENT4;case 5:return s.COLOR_ATTACHMENT5;case 6:return s.COLOR_ATTACHMENT6;case 7:return s.COLOR_ATTACHMENT7;case 8:return s.COLOR_ATTACHMENT8;case 9:return s.COLOR_ATTACHMENT9;case 10:return s.COLOR_ATTACHMENT10;case 11:return s.COLOR_ATTACHMENT11;case 12:return s.COLOR_ATTACHMENT12;case 13:return s.COLOR_ATTACHMENT13;case 14:return s.COLOR_ATTACHMENT14;case 15:return s.COLOR_ATTACHMENT15;default:console.warn("Attachments are only available for -2 - 15")}else if(s)switch(n){case-2:return t.BACK;case-1:return t.NONE;case 0:return s.COLOR_ATTACHMENT0_WEBGL;case 1:return s.COLOR_ATTACHMENT1_WEBGL;case 2:return s.COLOR_ATTACHMENT2_WEBGL;case 3:return s.COLOR_ATTACHMENT3_WEBGL;case 4:return s.COLOR_ATTACHMENT4_WEBGL;case 5:return s.COLOR_ATTACHMENT5_WEBGL;case 6:return s.COLOR_ATTACHMENT6_WEBGL;case 7:return s.COLOR_ATTACHMENT7_WEBGL;case 8:return s.COLOR_ATTACHMENT8_WEBGL;case 9:return s.COLOR_ATTACHMENT9_WEBGL;case 10:return s.COLOR_ATTACHMENT10_WEBGL;case 11:return s.COLOR_ATTACHMENT11_WEBGL;case 12:return s.COLOR_ATTACHMENT12_WEBGL;case 13:return s.COLOR_ATTACHMENT13_WEBGL;case 14:return s.COLOR_ATTACHMENT14_WEBGL;case 15:return s.COLOR_ATTACHMENT15_WEBGL;default:console.warn("Attachments are only available for 0 - 15")}return t.COLOR_ATTACHMENT0}function ch(t,e){return t.TEXTURE0+e}function Nc(t,e){return e-t.TEXTURE0}function lh(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Pc={exports:{}},Dc={exports:{}},es=1e3,ts=es*60,ns=ts*60,rs=ns*24,jg=rs*365.25,Hg=function(t,e){e=e||{};var n=typeof t;if(n==="string"&&t.length>0)return Qg(t);if(n==="number"&&isNaN(t)===!1)return e.long?Yg(t):Xg(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function Qg(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*jg;case"days":case"day":case"d":return n*rs;case"hours":case"hour":case"hrs":case"hr":case"h":return n*ns;case"minutes":case"minute":case"mins":case"min":case"m":return n*ts;case"seconds":case"second":case"secs":case"sec":case"s":return n*es;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function Xg(t){return t>=rs?Math.round(t/rs)+"d":t>=ns?Math.round(t/ns)+"h":t>=ts?Math.round(t/ts)+"m":t>=es?Math.round(t/es)+"s":t+"ms"}function Yg(t){return da(t,rs,"day")||da(t,ns,"hour")||da(t,ts,"minute")||da(t,es,"second")||t+" ms"}function da(t,e,n){if(!(t<e))return t<e*1.5?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}(function(t,e){e=t.exports=r.debug=r.default=r,e.coerce=c,e.disable=a,e.enable=s,e.enabled=o,e.humanize=Hg,e.instances=[],e.names=[],e.skips=[],e.formatters={};function n(l){var u=0,h;for(h in l)u=(u<<5)-u+l.charCodeAt(h),u|=0;return e.colors[Math.abs(u)%e.colors.length]}function r(l){var u;function h(){if(h.enabled){var f=h,p=+new Date,m=p-(u||p);f.diff=m,f.prev=u,f.curr=p,u=p;for(var v=new Array(arguments.length),b=0;b<v.length;b++)v[b]=arguments[b];v[0]=e.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");var T=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,function(S,I){if(S==="%%")return S;T++;var x=e.formatters[I];if(typeof x=="function"){var D=v[T];S=x.call(f,D),v.splice(T,1),T--}return S}),e.formatArgs.call(f,v);var E=h.log||e.log||console.log.bind(console);E.apply(f,v)}}return h.namespace=l,h.enabled=e.enabled(l),h.useColors=e.useColors(),h.color=n(l),h.destroy=i,typeof e.init=="function"&&e.init(h),e.instances.push(h),h}function i(){var l=e.instances.indexOf(this);return l!==-1?(e.instances.splice(l,1),!0):!1}function s(l){e.save(l),e.names=[],e.skips=[];var u,h=(typeof l=="string"?l:"").split(/[\s,]+/),f=h.length;for(u=0;u<f;u++)h[u]&&(l=h[u].replace(/\*/g,".*?"),l[0]==="-"?e.skips.push(new RegExp("^"+l.substr(1)+"$")):e.names.push(new RegExp("^"+l+"$")));for(u=0;u<e.instances.length;u++){var p=e.instances[u];p.enabled=e.enabled(p.namespace)}}function a(){e.enable("")}function o(l){if(l[l.length-1]==="*")return!0;var u,h;for(u=0,h=e.skips.length;u<h;u++)if(e.skips[u].test(l))return!1;for(u=0,h=e.names.length;u<h;u++)if(e.names[u].test(l))return!0;return!1}function c(l){return l instanceof Error?l.stack||l.message:l}})(Dc,Dc.exports);var qg=Dc.exports;(function(t,e){e=t.exports=qg,e.log=i,e.formatArgs=r,e.save=s,e.load=a,e.useColors=n,e.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:o(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}e.formatters.j=function(c){try{return JSON.stringify(c)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}};function r(c){var l=this.useColors;if(c[0]=(l?"%c":"")+this.namespace+(l?" %c":" ")+c[0]+(l?"%c ":" ")+"+"+e.humanize(this.diff),!!l){var u="color: "+this.color;c.splice(1,0,u,"color: inherit");var h=0,f=0;c[0].replace(/%[a-zA-Z%]/g,function(p){p!=="%%"&&(h++,p==="%c"&&(f=h))}),c.splice(f,0,u)}}function i(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(c){try{c==null?e.storage.removeItem("debug"):e.storage.debug=c}catch{}}function a(){var c;try{c=e.storage.debug}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=process.env.DEBUG),c}e.enable(a());function o(){try{return window.localStorage}catch{}}})(Pc,Pc.exports);var Kg=Pc.exports;const Ye=lh(Kg);class uh{constructor(e){this._destroyed=!1,this._internalFormat=d.GLSettings.RenderTarget.ColorBufferFormat.RGBA4,this.needsSettingsUpdate=!1,this._size=[0,0],this.size=e.size||this.size,this.internalFormat=e.internalFormat??this.internalFormat}get destroyed(){return this._destroyed}get internalFormat(){return this._internalFormat}set internalFormat(e){this.needsSettingsUpdate=!0,this._internalFormat=e}get size(){return this._size}set size(e){this.needsSettingsUpdate=!0,this._size=e}destroy(){this.gl&&this.gl.proxy.disposeColorBuffer(this),this._destroyed=!0}}var Fc=(t=>(t[t.INVALID=0]="INVALID",t[t.ONE=1]="ONE",t[t.TWO=2]="TWO",t[t.THREE=3]="THREE",t[t.FOUR=4]="FOUR",t))(Fc||{}),k=(t=>(t[t.ONE=1]="ONE",t[t.TWO=2]="TWO",t[t.THREE=3]="THREE",t[t.FOUR=4]="FOUR",t[t.MAT4X4=16]="MAT4X4",t[t.ATLAS=99]="ATLAS",t))(k||{});const hh={[1]:1,[2]:2,[3]:3,[4]:4,[16]:16,[99]:4};var L=(t=>(t[t.ONE=1]="ONE",t[t.TWO=2]="TWO",t[t.THREE=3]="THREE",t[t.FOUR=4]="FOUR",t[t.MATRIX3=9]="MATRIX3",t[t.MATRIX4=16]="MATRIX4",t[t.FLOAT_ARRAY=97]="FLOAT_ARRAY",t[t.VEC4_ARRAY=98]="VEC4_ARRAY",t[t.TEXTURE=99]="TEXTURE",t))(L||{}),ct=(t=>(t[t.ONE=1]="ONE",t[t.TWO=2]="TWO",t[t.THREE=3]="THREE",t[t.FOUR=4]="FOUR",t))(ct||{}),Pt=(t=>(t[t.SCREEN_256TH=-256]="SCREEN_256TH",t[t.SCREEN_128TH=-128]="SCREEN_128TH",t[t.SCREEN_64TH=-64]="SCREEN_64TH",t[t.SCREEN_32ND=-32]="SCREEN_32ND",t[t.SCREEN_16TH=-16]="SCREEN_16TH",t[t.SCREEN_8TH=-8]="SCREEN_8TH",t[t.SCREEN_QUARTER=-4]="SCREEN_QUARTER",t[t.SCREEN_HALF=-2]="SCREEN_HALF",t[t.SCREEN=-1]="SCREEN",t[t._2=2]="_2",t[t._4=4]="_4",t[t._8=8]="_8",t[t._16=16]="_16",t[t._32=32]="_32",t[t._64=64]="_64",t[t._128=128]="_128",t[t._256=256]="_256",t[t._512=512]="_512",t[t._1024=1024]="_1024",t[t._2048=2048]="_2048",t[t._4096=4096]="_4096",t))(Pt||{}),xe=(t=>(t[t.ATLAS=0]="ATLAS",t[t.FONT=1]="FONT",t[t.TEXTURE=2]="TEXTURE",t[t.COLOR_BUFFER=3]="COLOR_BUFFER",t))(xe||{}),_e=(t=>(t[t.zyx=0]="zyx",t[t.zyz=1]="zyz",t[t.zxy=2]="zxy",t[t.zxz=3]="zxz",t[t.yxz=4]="yxz",t[t.yxy=5]="yxy",t[t.yzx=6]="yzx",t[t.yzy=7]="yzy",t[t.xyz=8]="xyz",t[t.xyx=9]="xyx",t[t.xzy=10]="xzy",t[t.xzx=11]="xzx",t))(_e||{});function Zg(t){return t.size!==void 0&&t.size<=4}function Jg(t){return!!(t&&t.resource)}var P=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.ALL=3]="ALL",t))(P||{});function fa(){}const em=/\s/g,Bc=/\s/,Vr=Bc.test.bind(Bc),dh=/\n\r|\n|\r/g,Uc=/\n\r|\n|\r/,tm=Uc.test.bind(Uc);function nm(t){return t}var ue=(t=>(t[t.NONE=0]="NONE",t[t.SINGLE=1]="SINGLE",t))(ue||{}),Je=(t=>(t[t.CHANGE=0]="CHANGE",t[t.INSERT=1]="INSERT",t[t.REMOVE=2]="REMOVE",t))(Je||{}),kc=(t=>(t[t.NO_WEBGL_CONTEXT=0]="NO_WEBGL_CONTEXT",t))(kc||{}),qe=(t=>(t[t.UNIFORM=1]="UNIFORM",t[t.INSTANCE_ATTRIBUTE=2]="INSTANCE_ATTRIBUTE",t[t.INSTANCE_ATTRIBUTE_PACKING=3]="INSTANCE_ATTRIBUTE_PACKING",t))(qe||{}),pa=(t=>(t[t.LINEAR=0]="LINEAR",t))(pa||{});function $n(t){return t!==void 0&&t.charCodeAt!==void 0}function fh(t){return t!==void 0&&t.toExponential!==void 0}function rm(t){return t!==void 0&&t.call!==void 0&&t.apply!==void 0}function ur(t){return t===!0||t===!1}var oe=(t=>(t[t.NONE=0]="NONE",t[t.BLANK=1]="BLANK",t[t.COLOR=2]="COLOR",t[t.DEPTH=3]="DEPTH",t[t.NORMAL=4]="NORMAL",t[t.PICKING=5]="PICKING",t[t.POSITION=6]="POSITION",t[t.POSITION_X=7]="POSITION_X",t[t.POSITION_Y=8]="POSITION_Y",t[t.POSITION_Z=9]="POSITION_Z",t[t.LIGHTS=10]="LIGHTS",t[t.LIGHTS2=11]="LIGHTS2",t[t.LIGHTS3=12]="LIGHTS3",t[t.ALPHA=13]="ALPHA",t[t.BETA=14]="BETA",t[t.GAMMA=15]="GAMMA",t[t.DELTA=16]="DELTA",t[t.ACCUMULATION1=17]="ACCUMULATION1",t[t.ACCUMULATION2=18]="ACCUMULATION2",t[t.ACCUMULATION3=19]="ACCUMULATION3",t[t.ACCUMULATION4=20]="ACCUMULATION4",t[t.COEFFICIENT1=21]="COEFFICIENT1",t[t.COEFFICIENT2=22]="COEFFICIENT2",t[t.COEFFICIENT3=23]="COEFFICIENT3",t[t.COEFFICIENT4=24]="COEFFICIENT4",t[t.ANGLE1=25]="ANGLE1",t[t.ANGLE2=26]="ANGLE2",t[t.ANGLE3=27]="ANGLE3",t[t.ANGLE4=28]="ANGLE4",t[t.COLOR2=29]="COLOR2",t[t.COLOR3=30]="COLOR3",t[t.COLOR4=31]="COLOR4",t[t.GLOW=32]="GLOW",t[t.BLUR=33]="BLUR",t))(oe||{});let im=1;function Y(){return++im}let sm=0;function am(){return++sm%16777215}class Re{constructor(e){this._uid=Y(),this._destroyed=!1,this._flipY=!1,this._format=d.GLSettings.Texture.TexelDataType.RGBA,this._generateMipmaps=!1,this._internalFormat=d.GLSettings.Texture.TexelDataType.RGBA,this._magFilter=d.GLSettings.Texture.TextureMagFilter.Linear,this._minFilter=d.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear,this.needsDataUpload=!1,this.needsPartialDataUpload=!1,this.needsSettingsUpdate=!1,this._packAlignment=d.GLSettings.Texture.PackAlignment.FOUR,this._premultiplyAlpha=!1,this._type=d.GLSettings.Texture.SourcePixelFormat.UnsignedByte,this._unpackAlignment=d.GLSettings.Texture.UnpackAlignment.FOUR,this._updateRegions=[],this._wrapHorizontal=d.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE,this._wrapVertical=d.GLSettings.Texture.Wrapping.CLAMP_TO_EDGE,this.anisotropy=e.anisotropy||this.anisotropy,this.data=e.data||this.data,this.flipY=e.flipY||this.flipY,this.format=e.format||this.format,this.internalFormat=e.internalFormat||this.format,this.generateMipMaps=e.generateMipMaps||this.generateMipMaps,this.magFilter=e.magFilter||this.magFilter,this.minFilter=e.minFilter||this.minFilter,this.packAlignment=e.packAlignment||this.packAlignment,this.premultiplyAlpha=e.premultiplyAlpha||this.premultiplyAlpha,this.type=e.type||this.type,this.unpackAlignment=e.unpackAlignment||this.unpackAlignment,this.wrapHorizontal=e.wrapHorizontal||this.wrapHorizontal,this.wrapVertical=e.wrapVertical||this.wrapVertical}static get emptyTexture(){return om}get uid(){return this._uid}get destroyed(){return this._destroyed}get anisotropy(){return this._anisotropy}set anisotropy(e){this.needsSettingsUpdate=!0,this._anisotropy=e}get data(){return this._data}set data(e){this.needsDataUpload=!0,this._data=e}get flipY(){return this._flipY}set flipY(e){this.needsDataUpload=!0,this._flipY=e}get format(){return this._format}set format(e){this.needsDataUpload=!0,this._format=e}get generateMipMaps(){return this._generateMipmaps}set generateMipMaps(e){this.needsSettingsUpdate=!0,this._generateMipmaps=e}get internalFormat(){return this._internalFormat}set internalFormat(e){this.needsDataUpload=!0,this._internalFormat=e}get magFilter(){return this._magFilter}set magFilter(e){this.needsSettingsUpdate=!0,this._magFilter=e}get minFilter(){return this._minFilter}set minFilter(e){this.needsSettingsUpdate=!0,this._minFilter=e}get packAlignment(){return this._packAlignment}set packAlignment(e){this.needsSettingsUpdate=!0,this._packAlignment=e}get premultiplyAlpha(){return this._premultiplyAlpha}set premultiplyAlpha(e){this.needsSettingsUpdate=!0,this._premultiplyAlpha=e}get type(){return this._type}set type(e){this.needsDataUpload=!0,this._type=e}get unpackAlignment(){return this._unpackAlignment}set unpackAlignment(e){this.needsSettingsUpdate=!0,this._unpackAlignment=e}get updateRegions(){return this._updateRegions}get wrapHorizontal(){return this._wrapHorizontal}set wrapHorizontal(e){this.needsSettingsUpdate=!0,this._wrapHorizontal=e}get wrapVertical(){return this._wrapVertical}set wrapVertical(e){this.needsSettingsUpdate=!0,this._wrapVertical=e}get isHalfFloatTexture(){switch(this._internalFormat){case d.GLSettings.Texture.TexelDataType.R16F:case d.GLSettings.Texture.TexelDataType.RG16F:case d.GLSettings.Texture.TexelDataType.RGB16F:return!0}switch(this._type){case d.GLSettings.Texture.SourcePixelFormat.HalfFloat:return!0}return!1}get isFloatTexture(){switch(this._internalFormat){case d.GLSettings.Texture.TexelDataType.R11F_G11F_B10F:case d.GLSettings.Texture.TexelDataType.R16F:case d.GLSettings.Texture.TexelDataType.RG16F:case d.GLSettings.Texture.TexelDataType.R32F:case d.GLSettings.Texture.TexelDataType.RG32F:case d.GLSettings.Texture.TexelDataType.RGB16F:case d.GLSettings.Texture.TexelDataType.RGB32F:return!0}switch(this._type){case d.GLSettings.Texture.SourcePixelFormat.Float:case d.GLSettings.Texture.SourcePixelFormat.HalfFloat:return!0}return!1}destroy(){this.gl&&this.gl.proxy.disposeTexture(this),this._destroyed=!0,delete this._data}resolve(){this.needsDataUpload=!1,this.needsPartialDataUpload=!1,this.needsSettingsUpdate=!1,this._updateRegions=[]}update(e,n){this.needsPartialDataUpload=!0,this._updateRegions.push([e,n])}}const om=new Re({data:{width:2,height:2,buffer:new Uint8Array(16)}}),Wn=Ye("performance");function ph(t){return t&&t.buffer&&t.buffer.byteOffset!==void 0&&t.buffer.byteLength||t.buffer===null}function wi(t){return(t&t-1)===0}function ga(t){return!!(t.gl&&t.gl.textureId&&t.gl.textureUnit>-1)}class is{constructor(e,n,r){this.debugContext="",this.fragmentShaders=new Map,this.vertexShaders=new Map,this.programs=new Map,this.gl=e,this.state=n,this.extensions=r}static addExtensions(e){const n=e.getExtension("ANGLE_instanced_arrays"),r=e.getExtension("WEBGL_draw_buffers"),i=e.getExtension("OES_texture_float"),s=e.getExtension("OES_texture_float_linear"),a=e.getExtension("OES_texture_half_float"),o=e.getExtension("OES_texture_half_float_linear"),c=e.getExtension("EXT_texture_filter_anisotropic"),l=e.getExtension("EXT_color_buffer_float"),u=e.getExtension("OES_vertex_array_object"),h={maxAnistropicFilter:0};return!n&&!(e instanceof WebGL2RenderingContext)&&Wn("This device does not have hardware instancing. All buffering strategies will be utilizing compatibility modes."),!r&&!(e instanceof WebGL2RenderingContext)&&Wn("This device does not have hardware multi-render target capabilities. The system will have to fallback to multiple render passes to multiple FBOs to achieve the same result."),c?h.maxAnistropicFilter=e.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):Wn("This device does not have hardware anisotropic filtering for textures. This property will be ignored when setting texture settings."),!u&&!(e instanceof WebGL2RenderingContext)&&Wn("This device does not support Vertex Array Objects. This could cause performance issues for high numbers of draw calls."),{instancing:(e instanceof WebGL2RenderingContext?e:n)||void 0,drawBuffers:(e instanceof WebGL2RenderingContext?e:r)||void 0,anisotropicFiltering:c?{ext:c,stat:h}:void 0,renderFloatTexture:l||void 0,floatTex:(e instanceof WebGL2RenderingContext?e:i)||void 0,floatTexFilterLinear:(e instanceof WebGL2RenderingContext?e:s)||void 0,halfFloatTex:(e instanceof WebGL2RenderingContext?e:a)||void 0,halfFloatTexFilterLinear:(e instanceof WebGL2RenderingContext?e:o)||void 0,vao:(e instanceof WebGL2RenderingContext?e:u)||void 0}}clear(e,n,r){let i=0;e&&(i=i|this.gl.COLOR_BUFFER_BIT),n&&(i=i|this.gl.DEPTH_BUFFER_BIT),r&&(i=i|this.gl.STENCIL_BUFFER_BIT),this.gl.clear(i)}compileAttribute(e){if(e.gl)return;const n=this.gl,r=n.createBuffer();if(!r){console.warn(this.debugContext,"Could bot create WebGLBuffer. Printing any existing gl errors:"),this.printError();return}return this.state.bindVBO(r),n.bufferData(n.ARRAY_BUFFER,e.data,e.isDynamic?n.DYNAMIC_DRAW:n.STATIC_DRAW),e.gl={bufferId:r,type:n.ARRAY_BUFFER,proxy:this},e.resolve(),!0}compileGeometry(e){if(e.gl)return;let n=!0;if(e.gl={proxy:this},this.extensions.vao){let r;this.extensions.vao instanceof WebGL2RenderingContext?r=this.extensions.vao.createVertexArray():r=this.extensions.vao.createVertexArrayOES(),r?(this.state.disableVertexAttributeArray(),this.state.bindVAO(r),e.attributes.forEach((i,s)=>{this.updateAttribute(i)&&this.useAttribute(s,i,e)}),e.gl.vao=r,this.state.bindVAO(null)):Wn("WARNING: Could not make VAO for Geometry. This is fine, but this could cause a hit on performance.")}return e.attributes.forEach(r=>{n=!!(this.compileAttribute(r)&&n)}),n}compileMaterial(e){if(e.gl)return;let n=this.vertexShaders.get(e.vertexShader)||null;if(!n){if(n=this.gl.createShader(this.gl.VERTEX_SHADER),!n){console.warn(this.debugContext,"Could not create a Vertex WebGLShader. Printing GL Errors:"),this.printError();return}if(this.gl.shaderSource(n,e.vertexShader),this.gl.compileShader(n),this.gl.isContextLost()&&console.warn("Context was lost during compilation"),!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)){console.error(this.debugContext,"VERTEX SHADER COMPILER ERROR",e.name),console.warn("Could not compile provided shader. Printing logs and errors:"),console.warn(this.lineFormatShader(e.vertexShader)),console.warn("LOGS:"),console.warn(this.gl.getShaderInfoLog(n)),this.printError(),this.gl.deleteShader(n);return}}let r=this.programs.get(n);r||(r=new Map,this.programs.set(n,r));const i={vsId:n,fsId:[],programId:[],proxy:this,programByTarget:new WeakMap,outputsByProgram:new WeakMap},s=new Set;if(!e.fragmentShader)return console.warn("A material appears to not have it's fragment shader configuration set."),!1;e.fragmentShader.forEach(o=>{var f,p;if(!r||!n)return;let c=this.fragmentShaders.get(o.source)||null;if(!c){if(c=this.gl.createShader(this.gl.FRAGMENT_SHADER),!c){console.warn(this.debugContext,"Could not create a Fragment WebGLShader. Printing GL Errors:"),this.printError();return}if(this.gl.shaderSource(c,o.source),this.gl.compileShader(c),this.gl.isContextLost()&&console.warn("Context was lost during compilation"),!this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS)){console.error(this.debugContext,"FRAGMENT SHADER COMPILER ERROR:",e.name),console.warn("Could not compile provided shader. Printing logs and errors:"),console.warn(this.lineFormatShader(o.source)),console.warn("LOGS:"),console.warn(this.gl.getShaderInfoLog(c)),this.printError(),this.gl.deleteShader(c);return}}let l=r.get(c)||null;if(l)l.useCount++;else{const m=this.gl.createProgram();if(!m){console.warn(this.debugContext,"Could not create a WebGLProgram. Printing GL Errors:"),this.printError();return}if(l={useCount:1,program:m},this.gl.attachShader(m,n),this.gl.attachShader(m,c),this.gl.linkProgram(m),this.gl.validateProgram(m),!this.gl.getProgramParameter(m,this.gl.LINK_STATUS)||!this.gl.getProgramParameter(m,this.gl.VALIDATE_STATUS)){const v=this.gl.getProgramInfoLog(m);console.warn(this.debugContext,`Could not compile WebGL program. 

`,v),this.printError(),this.gl.deleteProgram(m);return}r.set(c,l)}(f=i.fsId)==null||f.push({id:c,outputTypes:o.outputTypes}),(p=i.programId)==null||p.push({id:l.program,outputTypes:o.outputTypes}),i.outputsByProgram.set(l.program,o.outputTypes),this.state.useProgram(l.program);const u=this.state.currentProgram;if(!u)return!1;const h=this.gl.getProgramParameter(u,this.gl.ACTIVE_UNIFORMS);for(let m=0;m<h;m++){const v=this.gl.getActiveUniform(u,m);v&&s.add(v.name.replace("[0]",""))}}),e.gl=i;const a=new Set;return Object.keys(e.uniforms).forEach(o=>{s.has(o)||a.add(o)}),a.forEach(o=>{delete e.uniforms[o]}),Object.keys(e.uniforms).length!==s.size?(console.warn(this.debugContext,"A program is requesting a set of uniforms:",Array.from(s.values()),"but our material only provides",Object.keys(e.uniforms),"thus the expected rendering will be considered invalid."),!1):!0}compileRenderTarget(e){if(e.isInvalid)return!1;if(e.gl)return!0;const n=this.gl,r=n.createFramebuffer();if(!r)return console.warn(this.debugContext,"Could not generate a frame buffer object. Printing GL errors:"),this.printError(),!1;this.state.bindFBO(r);const i={fboId:r,proxy:this,fboByMaterial:new WeakMap};if(Array.isArray(e.buffers.color)){if(!this.extensions.drawBuffers)return console.warn("Attempted to manage a render target with MRT but the hardware does not support MRT. Use multiple render targets instead."),!1;const l=[];let u=!0;i.colorBufferId=l;const h=e.buffers.color.length<=1;if(e.buffers.color.forEach((f,p)=>{if(u)if(f.buffer instanceof Re){const m=Ji(n,this.extensions,p,h,!1);l.push({data:f.buffer,outputType:f.outputType,attachment:m}),ga(f.buffer)?n.framebufferTexture2D(n.FRAMEBUFFER,m,n.TEXTURE_2D,f.buffer.gl.textureId,0):(console.warn(this.debugContext,"Attempted to compile render target whose target texture was not ready for use."),u=!1)}else{const m=this.compileColorBuffer(f.buffer,e.width,e.height);if(m){const v=Ji(n,this.extensions,p,h,!1);l.push({data:m,outputType:f.outputType,attachment:v}),n.framebufferRenderbuffer(n.FRAMEBUFFER,v,n.RENDERBUFFER,m)}}}),!u)return!1}else if(e.buffers.color!==void 0){const l=e.buffers.color;if(l.buffer instanceof Re){const u=Ji(n,this.extensions,0,!0,!1);if(i.colorBufferId={data:l.buffer,outputType:l.outputType,attachment:u},ga(l.buffer))n.framebufferTexture2D(n.FRAMEBUFFER,u,n.TEXTURE_2D,l.buffer.gl.textureId,0);else return console.warn(this.debugContext,"Attempted to compile render target whose target texture was not ready for use."),!1}else{const u=this.compileColorBuffer(l.buffer,e.width,e.height);if(u){const h=Ji(n,this.extensions,0,!0,!1);i.colorBufferId={data:u,outputType:l.outputType,attachment:h},n.framebufferRenderbuffer(n.FRAMEBUFFER,h,n.RENDERBUFFER,u)}}}if(e.buffers.depth!==void 0){const l=e.buffers.depth;if(l instanceof Re)i.depthBufferId=l,ga(l)&&n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,l.gl.textureId,0);else if(l instanceof uh){const u=this.compileDepthBuffer(l.internalFormat,e.width,e.height);u&&(i.depthBufferId=u,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,u))}else{const u=this.compileDepthBuffer(l,e.width,e.height);u&&(i.depthBufferId=u,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,u))}}if(e.buffers.stencil!==void 0){const l=e.buffers.stencil;if(l instanceof Re)i.stencilBufferId=l,ga(l)&&n.framebufferTexture2D(n.FRAMEBUFFER,n.STENCIL_ATTACHMENT,n.TEXTURE_2D,l.gl.textureId,0);else{const u=this.compileStencilBuffer(l,e.width,e.height);u&&(i.stencilBufferId=u,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.STENCIL_ATTACHMENT,n.RENDERBUFFER,u))}}e.gl=i;const s=n.checkFramebufferStatus(n.FRAMEBUFFER);let a=!1,o=!1,c="";switch(s){case n.FRAMEBUFFER_COMPLETE:e.setAsValid();break;case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:c="FRAMEBUFFER_INCOMPLETE_ATTACHMENT";break;case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:c="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";break;case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:c="FRAMEBUFFER_INCOMPLETE_DIMENSIONS";break;case n.FRAMEBUFFER_UNSUPPORTED:c="FRAMEBUFFER_UNSUPPORTED";break;default:a=!0;break}if(n instanceof WebGL2RenderingContext)switch(s){case n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:c="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE";break;case n.RENDERBUFFER_SAMPLES:c="RENDERBUFFER_SAMPLES";break;default:o=!0;break}return a&&o&&(console.warn(this.debugContext,"A framebuffer check failed to return a known result. This FBO for render target will be assumed failed"),console.warn("Result:",s,"Render Target:",e),c="UNKNOWN"),c?(console.warn(this.debugContext,"When creating a new FrameBuffer Object, the check on the framebuffer failed. Printing Errors:"),console.warn(c),this.printError(),console.warn("FAILED RENDER TARGET:",e),delete e.gl,e.isInvalid=!0,!1):!0}compileDepthBuffer(e,n,r){const i=this.gl,s=i.createRenderbuffer();if(!s){console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),this.printError();return}return this.state.bindRBO(s),i.renderbufferStorage(i.RENDERBUFFER,ah(i,e),n,r),s}compileStencilBuffer(e,n,r){const i=this.gl,s=i.createRenderbuffer();if(!s){console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),this.printError();return}return this.state.bindRBO(s),i.renderbufferStorage(i.RENDERBUFFER,oh(i,e),n,r),s}compileColorBuffer(e,n,r){const i=this.gl,s=i.createRenderbuffer();if(!s){console.warn(this.debugContext,"Could not generate a WebGLRenderBuffer. Printing GL Errors:"),this.printError();return}return this.state.bindRBO(s),i.renderbufferStorage(i.RENDERBUFFER,sh(i,e.internalFormat),n,r),e.gl={bufferId:s,proxy:this},s}compileTexture(e){if(!e.gl||e.gl.textureId)return;if(e.gl.textureUnit<0){console.warn(this.debugContext,"A Texture object attempted to be compiled without an established Texture Unit.",e);return}this.state.setActiveTextureUnit(e.gl.textureUnit);const r=this.gl.createTexture();if(!r){console.warn(this.debugContext,"Could not generate a texture object on the GPU. Printing any gl errors:"),this.printError();return}return e.gl.textureId=r,e.needsDataUpload=!0,e.needsSettingsUpdate=!0,this.updateTextureData(e),this.updateTextureSettings(e),!0}draw(e){let n,r=[0,0];e.vertexDrawRange&&e.vertexDrawRange[0]>=0&&e.vertexDrawRange[1]>=0?r=[e.vertexDrawRange[0],e.vertexDrawRange[1]-e.vertexDrawRange[0]]:r=[0,e.vertexCount],e.drawInstances>=0&&e.geometry.isInstanced&&(n=this.extensions.instancing),!((U.MRT||U.MRT_EXTENSION)&&this.state.renderTarget&&!this.state.drawBuffers.find(i=>i!==this.gl.NONE))&&(n&&n instanceof WebGL2RenderingContext?n.drawArraysInstanced(ha(this.gl,e.drawMode),r[0],r[1],e.drawInstances):n?n.drawArraysInstancedANGLE(ha(this.gl,e.drawMode),r[0],r[1],e.drawInstances):this.gl.drawArrays(ha(this.gl,e.drawMode),r[0],r[1]),this.state.setDrawBuffers([],!0))}disposeAttribute(e){e.gl&&(this.gl.deleteBuffer(e.gl.bufferId),delete e.gl)}disposeColorBuffer(e){e.gl&&(e.gl.bufferId&&this.disposeRenderBuffer(e.gl.bufferId),delete e.gl)}disposeGeometry(e){e.gl&&this.extensions.vao&&e.gl.vao&&(this.extensions.vao instanceof WebGL2RenderingContext?this.extensions.vao.deleteVertexArray(e.gl.vao):this.extensions.vao.deleteVertexArrayOES(e.gl.vao))}disposeMaterial(e){if(e.gl){const{vsId:n,fsId:r,programId:i}=e.gl;let s=this.programs.get(n);s||(s=new Map,this.gl.deleteShader(n));for(let a=0,o=r.length;a<o;++a){const c=r[a];let l=s.get(c);l||(l={useCount:0,program:i}),l.useCount--,l.useCount<1&&(this.gl.deleteProgram(l.program),s.delete(c),s.size<=0&&this.gl.deleteShader(n));let u=!1;this.programs.forEach(h=>{h.has(c)&&(u=!0)}),u||this.gl.deleteShader(c)}}delete e.gl}disposeRenderBuffer(e){this.gl.deleteRenderbuffer(e)}disposeRenderTarget(e){e.gl&&(Array.isArray(e.gl.colorBufferId)?e.gl.colorBufferId.forEach(n=>{n.data instanceof Re&&!e.retainTextureTargets?this.disposeTexture(n.data):n.data instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(n.data)}):e.gl.colorBufferId&&e.gl.colorBufferId.data instanceof Re&&!e.retainTextureTargets?this.disposeTexture(e.gl.colorBufferId.data):e.gl.colorBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.colorBufferId.data),e.gl.depthBufferId instanceof Re&&!e.retainTextureTargets?this.disposeTexture(e.gl.depthBufferId):e.gl.depthBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.depthBufferId),e.gl.stencilBufferId instanceof Re&&!e.retainTextureTargets?this.disposeTexture(e.gl.stencilBufferId):e.gl.stencilBufferId instanceof WebGLRenderbuffer&&this.disposeRenderBuffer(e.gl.stencilBufferId),this.gl.deleteFramebuffer(e.gl.fboId),delete e.gl)}disposeTexture(e){e.gl&&!e.destroyed&&(this.gl.deleteTexture(e.gl.textureId),this.state.freeTextureUnit(e)),delete e.gl}static getContext(e,n){const r=[U.WEBGL_VERSION,"webgl","webgl2","experimental-webgl"];let i=null,s={};for(let a=0;a<r.length;++a){const o=r[a],c=e.getContext(o,n);if(c&&(c instanceof WebGLRenderingContext||c instanceof WebGL2RenderingContext)){Wn("Generated GL Context of version with attributes:",o,n),i=c,s=is.addExtensions(i);break}}return{context:i,extensions:s}}printError(){const e=this.gl.getError();switch(e){case this.gl.NO_ERROR:console.warn("GL Error: No Error");break;case this.gl.INVALID_ENUM:console.warn("GL Error: INVALID ENUM");break;case this.gl.INVALID_VALUE:console.warn("GL Error: INVALID_VALUE");break;case this.gl.INVALID_OPERATION:console.warn("GL Error: INVALID OPERATION");break;case this.gl.INVALID_FRAMEBUFFER_OPERATION:console.warn("GL Error: INVALID FRAMEBUFFER OPERATION");break;case this.gl.OUT_OF_MEMORY:console.warn("GL Error: OUT OF MEMORY");break;case this.gl.CONTEXT_LOST_WEBGL:console.warn("GL Error: CONTEXT LOST WEBGL");break;default:console.warn("GL Error: GL Context output an unrecognized error value:",e);break}}lineFormat(e){const n=e.split(`
`),r=String(n.length).length+1;return`
${n.map((i,s)=>`${Array(r-String(s+1).length).join(" ")}${s+1}: ${i}`).join(`
`)}`}lineFormatShader(e){return e?$n(e)?this.lineFormat(e):e.forEach(n=>`
SHADER FOR OUTPUT TYPES: ${n.outputTypes} ${this.lineFormat(n.source)}`):"NO SHADER FOUND"}updateTexture(e){if(!e.gl||e.gl.textureUnit<0){console.warn(this.debugContext,"Can not update or compile a texture that does not have an established texture unit.",e);return}this.compileTexture(e),this.updateTextureData(e),this.updateTexturePartialData(e),this.updateTextureSettings(e),e.resolve()}updateTextureData(e){if(!e.needsDataUpload||!e.gl||!e.gl.textureId)return;if(e.gl.textureUnit<0){console.warn(this.debugContext,"A Texture object attempted to update it's data without an established Texture Unit.",e);return}const n=this.gl;if(this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,d.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D),e.needsSettingsUpdate=!0,this.updateTextureSettings(e),n instanceof WebGLRenderingContext||n instanceof WebGL2RenderingContext){if(ph(e.data)){(!wi(e.data.width)||!wi(e.data.height))&&Wn("Created a texture that is not using power of 2 dimensions.");const r=Gr(n,e.internalFormat),i=Gr(n,e.format);n instanceof WebGLRenderingContext&&r!==i&&console.warn("WebGL 1 requires format and data format to be identical"),n.texImage2D(n.TEXTURE_2D,0,r,e.data.width,e.data.height,0,i,Zi(n,e.type),e.data.buffer)}else e.data&&((!wi(e.data.width)||!wi(e.data.height))&&Wn("Created a texture that is not using power of 2 dimensions. %o",e),n.texImage2D(n.TEXTURE_2D,0,Gr(n,e.internalFormat),Gr(n,e.format),Zi(n,e.type),e.data));e.generateMipMaps&&n.generateMipmap(n.TEXTURE_2D)}e.data&&(e.data={width:e.data.width,height:e.data.height,buffer:null}),e.needsDataUpload=!1}updateTexturePartialData(e){if(!e.needsPartialDataUpload||!e.gl||!e.gl.textureId)return;if(e.gl.textureUnit<0){console.warn(this.debugContext,"A Texture object attempted to update it's data without an established Texture Unit.",e);return}const n=this.gl;this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,d.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D),e.updateRegions.forEach(r=>{const i=r[0],s=r[1];(n instanceof WebGLRenderingContext||n instanceof WebGL2RenderingContext)&&(ph(i)?n.texSubImage2D(n.TEXTURE_2D,0,s.x,s.y,i.width,i.height,Gr(n,e.format),Zi(n,e.type),i.buffer):i&&n.texSubImage2D(n.TEXTURE_2D,0,s.x,s.y,Gr(n,e.format),Zi(n,e.type),i),e.generateMipMaps&&n.generateMipmap(n.TEXTURE_2D))}),e.needsPartialDataUpload=!1}updateTextureSettings(e){if(!e.needsSettingsUpdate||!e.gl||!e.data||!e.gl.textureId)return;if(e.gl.textureUnit<0){console.warn(this.debugContext,"A Texture object attempted to update it's settings without an established Texture Unit.",e);return}const n=wi(e.data.width)&&wi(e.data.height),r=this.gl;this.state.setActiveTextureUnit(e.gl.textureUnit),this.state.bindTexture(e,d.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D);let i,s;if(e.isHalfFloatTexture)if(U.FLOAT_TEXTURE_READ.halfLinearFilter)switch(i=zr(r,e.magFilter),e.minFilter){case d.GLSettings.Texture.TextureMinFilter.Nearest:case d.GLSettings.Texture.TextureMinFilter.NearestMipMapLinear:case d.GLSettings.Texture.TextureMinFilter.NearestMipMapNearest:s=Vn(r,d.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);break;case d.GLSettings.Texture.TextureMinFilter.Linear:case d.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear:case d.GLSettings.Texture.TextureMinFilter.LinearMipMapNearest:s=Vn(r,d.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);break}else i=zr(r,d.GLSettings.Texture.TextureMagFilter.Nearest),s=Vn(r,d.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);else if(e.isFloatTexture)if(U.FLOAT_TEXTURE_READ.fullLinearFilter)switch(i=zr(r,e.magFilter),e.minFilter){case d.GLSettings.Texture.TextureMinFilter.Nearest:case d.GLSettings.Texture.TextureMinFilter.NearestMipMapLinear:case d.GLSettings.Texture.TextureMinFilter.NearestMipMapNearest:s=Vn(r,d.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);break;case d.GLSettings.Texture.TextureMinFilter.Linear:case d.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear:case d.GLSettings.Texture.TextureMinFilter.LinearMipMapNearest:s=Vn(r,d.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);break}else i=zr(r,d.GLSettings.Texture.TextureMagFilter.Nearest),s=Vn(r,d.GLSettings.Texture.TextureMinFilter.Nearest,e.generateMipMaps);else!n&&r instanceof WebGLRenderingContext?(i=zr(r,d.GLSettings.Texture.TextureMagFilter.Linear),s=Vn(r,d.GLSettings.Texture.TextureMinFilter.Linear,e.generateMipMaps)):(i=zr(r,e.magFilter),s=Vn(r,e.minFilter,e.generateMipMaps));if(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,s),e.isFloatTexture||(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,Oc(r,e.wrapHorizontal)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,Oc(r,e.wrapVertical))),e.isFloatTexture||(r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e.flipY)),this.extensions.anisotropicFiltering){const{ext:a,stat:o}=this.extensions.anisotropicFiltering,c=Math.min(o.maxAnistropicFilter,Math.floor(e.anisotropy||0));!isNaN(c)&&!e.isFloatTexture&&r.texParameterf(r.TEXTURE_2D,a.TEXTURE_MAX_ANISOTROPY_EXT,c)}e.needsSettingsUpdate=!1}updateAttribute(e){if(!e.gl)return this.compileAttribute(e);if(!e.fullUpdate&&!e.needsUpdate)return!0;const n=this.gl;if(e.fullUpdate||e.updateRange.count<0||e.updateRange.offset<0)this.state.bindVBO(e.gl.bufferId),n.bufferData(n.ARRAY_BUFFER,e.data,e.isDynamic?n.DYNAMIC_DRAW:n.STATIC_DRAW);else if(e.updateRange.count>0){this.state.bindVBO(e.gl.bufferId);const r=e.updateRange.offset;n.bufferSubData(n.ARRAY_BUFFER,r*4,e.data.subarray(r,r+e.updateRange.count))}return e.resolve(),!0}useAttribute(e,n,r){if(!this.state.currentProgram||!n.gl)return!1;n.gl.locations=n.gl.locations||new Map;let i=n.gl.locations.get(this.state.currentProgram);if(i===void 0&&(i=this.gl.getAttribLocation(this.state.currentProgram,e),i===-1&&Wn("WARN: An attribute is not being used with the current material: %o",e,n),n.gl.locations.set(this.state.currentProgram,i)),i!==-1){switch(this.state.bindVBO(n.gl.bufferId),n.size){case 1:case 2:case 3:case 4:this.state.willUseVertexAttributeArray(i),this.gl.vertexAttribPointer(i,n.size,this.gl.FLOAT,n.normalize,0,0),r.isInstanced&&n.isInstanced&&this.extensions.instancing?this.state.setVertexAttributeArrayDivisor(i,1):this.state.setVertexAttributeArrayDivisor(i,0);break;default:{const s=Math.ceil(n.size/4);for(let a=0;a<s;++a)this.state.willUseVertexAttributeArray(i+a),this.gl.vertexAttribPointer(i+a,4,this.gl.FLOAT,n.normalize,s*4*4,a*16),r.isInstanced&&n.isInstanced&&this.extensions.instancing?this.state.setVertexAttributeArrayDivisor(i+a,1):this.state.setVertexAttributeArrayDivisor(i+a,0);break}}return!0}}}var He=(t=>(t[t.FLOAT=0]="FLOAT",t[t.VEC2=1]="VEC2",t[t.VEC3=2]="VEC3",t[t.VEC4=3]="VEC4",t[t.VEC4_ARRAY=4]="VEC4_ARRAY",t[t.FLOAT_ARRAY=5]="FLOAT_ARRAY",t[t.MATRIX3x3=6]="MATRIX3x3",t[t.MATRIX4x4=7]="MATRIX4x4",t[t.TEXTURE=8]="TEXTURE",t))(He||{});function cm(t){return t.type===1}function lm(t){return t.type===2}function um(t){return t.type===3}function gh(t){return t.type===4}function hm(t){return t.type===6}function dm(t){return t.type===7}function fm(t){return t.type===8}function pm(t){return t.type===0}const gm=window.OffscreenCanvas||fa;function $r(t){return t instanceof gm}var kt=(t=>(t[t.INVALID=0]="INVALID",t[t.VALID=1]="VALID",t[t.NO_RENDER_TARGET_MATCHES=2]="NO_RENDER_TARGET_MATCHES",t))(kt||{});class hr{constructor(e){this.isInvalid=!1,this._uid=Y(),this._validFramebuffer=!1,this._disabledTargets=new Set,this.retainTextureTargets=!1,this._buffers={color:Array.isArray(e.buffers.color)?e.buffers.color.slice(0):e.buffers.color,depth:e.buffers.depth,stencil:e.buffers.stencil},this._width=e.width||0,this._height=e.height||0,this.retainTextureTargets=e.retainTextureTargets||!1,this.calculateDimensions()}get uid(){return this._uid}get buffers(){return{color:Array.isArray(this._buffers.color)?this._buffers.color.slice(0):this._buffers.color,depth:this._buffers.depth,stencil:this._buffers.stencil}}get height(){return this._height}get width(){return this._width}get validFramebuffer(){return this._validFramebuffer}get disabledTargets(){return this._disabledTargets}set disabledTargets(e){this._disabledTargets=e}calculateDimensions(){const e=[];if(this._buffers.color instanceof Re)e.push(this._buffers.color);else if(Array.isArray(this._buffers.color))for(let n=0,r=this._buffers.color.length;n<r;++n){const i=this._buffers.color[n];i.buffer instanceof Re&&e.push(i.buffer)}else this._buffers.color&&this._buffers.color.buffer instanceof Re&&e.push(this._buffers.color.buffer);if(this._buffers.depth instanceof Re&&e.push(this._buffers.depth),this._buffers.stencil instanceof Re&&e.push(this._buffers.stencil),e.length>0&&e[0].data){const{width:n,height:r}=e[0].data;for(let i=0,s=e.length;i<s;++i){const a=e[i];if(!a.data){console.warn("A texture specified for thie RenderTarget did not have any data associated with it.");return}const{width:o,height:c}=a.data;(o!==n||c!==r)&&(console.warn("Texture applied to the render target is invalid as it does not match dimensions of all textures applied:",a,e,"The texture will be removed as a target for the render target"),this.removeTextureFromBuffer(a))}this._width=n,this._height=r}(!this._width||!this._height)&&console.warn("A RenderTarget was not able to establish valid dimensions. This target had no texture buffers and did not specify valid width and height values.",this)}dispose(){this.gl&&this.gl.proxy.disposeRenderTarget(this)}getBuffers(){return Array.isArray(this.buffers.color)?this.buffers.color:this.buffers.color?[this.buffers.color]:[]}getGLBuffers(){return this.gl?Array.isArray(this.gl.colorBufferId)?this.gl.colorBufferId:[this.gl.colorBufferId]:(this.isInvalid||console.warn("Attempted to retrieve gl buffers before the render target was compiled."),[])}getOutputTypes(){return this.getBuffers().map(e=>e.outputType)}getSize(){return[this._width,this._height]}getTextures(){const e=[];return Array.isArray(this.buffers.color)?this.buffers.color.forEach(n=>{n.buffer instanceof Re&&e.push(n.buffer)}):this.buffers.color&&this.buffers.color.buffer instanceof Re&&e.push(this.buffers.color.buffer),this.buffers.depth instanceof Re&&e.push(this.buffers.depth),this.buffers.stencil instanceof Re&&e.push(this.buffers.stencil),e}isColorTarget(){var e;if(Array.isArray(this.buffers.color)){if(this.buffers.color.length===1)return this.buffers.color[0].outputType===oe.COLOR}else return((e=this.buffers.color)==null?void 0:e.outputType)===oe.COLOR;return!1}removeTextureFromBuffer(e){var n;if(Array.isArray(this._buffers.color)){const r=this._buffers.color.find(s=>s.buffer===e);if(!r)return;const i=this._buffers.color.indexOf(r);i>-1&&this._buffers.color.splice(i,1)}else((n=this._buffers.color)==null?void 0:n.buffer)===e&&delete this._buffers.color;this._buffers.depth===e&&delete this._buffers.depth,this._buffers.stencil===e&&delete this._buffers.stencil}setSize(e,n){this.dispose(),this._width=e,this._height=n,this.getTextures().forEach(i=>{i.data={buffer:null,height:n,width:e}})}setAsValid(){this._validFramebuffer=!0}}const mh=Ye("performance");class vh{constructor(e,n){this.debugContext="",this._textureUnitToTexture=new Map,this._freeUnits=[],this._blendingEnabled=!0,this._blendDstFactor=d.GLSettings.Material.BlendingDstFactor.One,this._blendSrcFactor=d.GLSettings.Material.BlendingDstFactor.One,this._blendEquation=d.GLSettings.Material.BlendingEquations.Add,this._cullFace=d.GLSettings.Material.CullSide.NONE,this._colorMask=[!0,!0,!0,!0],this._clearColor=[0,0,0,1],this._depthFunc=d.GLSettings.Material.DepthFunctions.ALWAYS,this._depthTestEnabled=!0,this._depthMask=!0,this._ditheringEnabled=!0,this._boundFBO=null,this._renderTarget=null,this._boundRBO=null,this._boundVAO=null,this._boundVBO=null,this._boundTexture={id:null,unit:-1},this._currentProgram=null,this._scissorTestEnabled=!1,this._scissorBounds={x:0,y:0,width:1,height:1},this._currentUniforms={},this._activeTextureUnit=-1,this._drawBuffers=[],this._textureWillBeUsed=new Map,this._viewport={x:0,y:0,width:100,height:100},this._enabledVertexAttributeArray=[],this._willUseVertexAttributeArray=[],this._vertexAttributeArrayDivisor=new Map,this.gl=e,this.extensions=n;const r=this.gl.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);for(let i=0;i<r;++i)this._freeUnits.push(ch(e,i));this._activeTextureUnit=e.TEXTURE0}get blendingEnabled(){return this._blendingEnabled}get blendDstFactor(){return this._blendDstFactor}get blendSrcFactor(){return this._blendSrcFactor}get blendEquation(){return this._blendEquation}get cullFace(){return this._cullFace}get colorMask(){return this._colorMask}get clearColor(){return this._clearColor}get depthFunc(){return this._depthFunc}get depthTestEnabled(){return this._depthTestEnabled}get depthMask(){return this._depthMask}get ditheringEnabled(){return this._ditheringEnabled}get boundFBO(){return this._boundFBO}get renderTarget(){return this._renderTarget}get boundRBO(){return this._boundRBO}get boundVAO(){return this._boundVAO}get boundVBO(){return this._boundVBO}get boundTexture(){return this._boundTexture}get currentProgram(){return this._currentProgram}get scissorTestEnabled(){return this._scissorTestEnabled}get scissorBounds(){return this._scissorBounds}get currentUniforms(){return this._currentUniforms}get activeTextureUnit(){return this._activeTextureUnit}get drawBuffers(){return this._drawBuffers}get textureWillBeUsed(){return this._textureWillBeUsed}get viewport(){return this._viewport}get enabledVertexAttributeArray(){return this._enabledVertexAttributeArray.slice(0).filter(e=>e!==void 0)}bindVAO(e){this._boundVAO!==e&&(this._boundVAO=e,this.extensions.vao&&(this.extensions.vao instanceof WebGL2RenderingContext?this.extensions.vao.bindVertexArray(e):this.extensions.vao.bindVertexArrayOES(e)))}bindVBO(e){this._boundVBO!==e&&(this._boundVBO=e,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e))}bindRBO(e){this._boundRBO!==e&&(this._boundRBO=e,this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,e))}bindFBO(e){this._boundFBO!==e&&(this._boundFBO=e,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e))}bindTexture(e,n){if(!(!e.gl||!e.gl.textureId)&&(!e||this._boundTexture.id!==e.gl.textureId||this._boundTexture.unit!==this._activeTextureUnit)){switch(this._boundTexture={id:e.gl.textureId,unit:this._activeTextureUnit},n){case d.GLSettings.Texture.TextureBindingTarget.TEXTURE_2D:this.gl.bindTexture(this.gl.TEXTURE_2D,e.gl.textureId);break;case d.GLSettings.Texture.TextureBindingTarget.CUBE_MAP:this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,e.gl.textureId);break}const r=this._textureUnitToTexture.get(this._activeTextureUnit);r&&r.gl&&(r.gl.textureUnit=-1),this._textureUnitToTexture.set(this._activeTextureUnit,e),e.gl.textureUnit=this._activeTextureUnit}}disableVertexAttributeArray(){for(let e=0,n=this._enabledVertexAttributeArray.length;e<n;++e){const r=this._enabledVertexAttributeArray[e];this.gl.disableVertexAttribArray(r)}this._enabledVertexAttributeArray=[],this._willUseVertexAttributeArray=[],this._vertexAttributeArrayDivisor.clear()}willUseVertexAttributeArray(e){this._willUseVertexAttributeArray[e]=e,this._enabledVertexAttributeArray[e]===void 0&&(this._enabledVertexAttributeArray[e]=e,this.gl.enableVertexAttribArray(e))}applyVertexAttributeArrays(){for(let e=0,n=this._enabledVertexAttributeArray.length;e<n;++e){const r=this._enabledVertexAttributeArray[e];if(r!==void 0){if(this._willUseVertexAttributeArray[r]!==void 0)return;this.gl.disableVertexAttribArray(r),delete this._enabledVertexAttributeArray[r]}}this._willUseVertexAttributeArray=[]}setVertexAttributeArrayDivisor(e,n){this.extensions.instancing&&this._enabledVertexAttributeArray[e]!==void 0&&this._vertexAttributeArrayDivisor.get(e)!==n&&(this.extensions.instancing instanceof WebGL2RenderingContext?this.extensions.instancing.vertexAttribDivisor(e,n):this.extensions.instancing.vertexAttribDivisorANGLE(e,n),this._vertexAttributeArrayDivisor.set(e,n))}freeTextureUnit(e){e.gl&&e.gl.textureUnit>-1&&(this._freeUnits.unshift(e.gl.textureUnit),e.gl.textureUnit=-1)}setActiveTextureUnit(e){this._activeTextureUnit!==e&&(this._activeTextureUnit=e,this.gl.activeTexture(e))}setClearColor(e){ra(e,this._clearColor)||(this._clearColor=Kt(e),this.applyClearColor())}setDrawBuffers(e,n){let r=e.length!==this._drawBuffers.length;if(!r){for(let i=0,s=e.length;i<s;++i)if(this._drawBuffers[i]!==e[i]){r=!0;break}}if(r){if(this.glProxy.extensions.drawBuffers instanceof WebGL2RenderingContext)n||this.glProxy.extensions.drawBuffers.drawBuffers(e);else if(this.glProxy.extensions.drawBuffers)n||this.glProxy.extensions.drawBuffers.drawBuffersWEBGL(e);else{console.warn("Attempted to use drawBuffers for MRT, but MRT is NOT supported by this hardware. Use multiple render targets instead");return}this._drawBuffers=e}}setProxy(e){this.glProxy=e}setScissor(e){e?(this._scissorTestEnabled||(this._scissorTestEnabled=!0,this.gl.enable(this.gl.SCISSOR_TEST)),(e.x!==this._scissorBounds.x||e.y!==this._scissorBounds.y||e.width!==this._scissorBounds.width||e.height!==this._scissorBounds.height)&&(this._scissorBounds=e,this.applyScissorBounds())):this._scissorTestEnabled&&(this._scissorTestEnabled=!1,this.gl.disable(this.gl.SCISSOR_TEST))}setViewport(e,n,r,i){(e!==this._viewport.x||n!==this._viewport.y||r!==this._viewport.width||i!==this._viewport.height)&&(this._viewport={x:e,y:n,width:r,height:i},this.applyViewport())}useProgram(e){this._currentProgram!==e&&(this._currentProgram=e,this.gl.useProgram(this._currentProgram))}useMaterial(e){if(!e.gl&&(!this.glProxy.compileMaterial(e)||!e.gl)||!e.gl.programId||e.gl.programId.length===0)return kt.INVALID;const n=this.findMaterialProgram(e);if(n===void 0)return console.warn("Could NOT determine a program for the given material that would appropriately match with the current RenderTarget"),kt.NO_RENDER_TARGET_MATCHES;if(this._renderTarget&&(e.gl.programByTarget.set(this._renderTarget,n),this.glProxy.extensions.drawBuffers)){const r=e.gl.outputsByProgram.get(n),i=this._renderTarget.getGLBuffers();if(!r||!i)return console.warn("Could not establish the buffers to utilize for the render target"),kt.NO_RENDER_TARGET_MATCHES;const s=[];for(let a=0,o=i.length;a<o;++a){const c=i[a];r.find(u=>(c==null?void 0:c.outputType)===u)===void 0?s.push(this.gl.NONE):this._renderTarget.disabledTargets.has((c==null?void 0:c.outputType)||0)?s.push(this.gl.NONE):s.push((c==null?void 0:c.attachment)||this.gl.NONE)}this.setDrawBuffers(s)}return this.useProgram(n),this.syncMaterial(e),kt.VALID}findMaterialProgram(e){if(!e.gl)return;if(!this._renderTarget||this._renderTarget.isColorTarget()){let o;if(this._renderTarget&&(o=e.gl.programByTarget.get(this._renderTarget),o!==void 0))return o;let c=Number.MAX_SAFE_INTEGER;for(let l=0,u=e.gl.programId.length;l<u;++l){const h=e.gl.programId[l];h.outputTypes.length<c&&h.outputTypes.indexOf(oe.COLOR)>=0&&(o=h.id,c=h.outputTypes.length)}return o||(o=e.gl.programId[e.gl.programId.length-1]),o}let n=e.gl.programByTarget.get(this._renderTarget);if(n!==void 0)return n;const r=new Set,i=this._renderTarget.getBuffers();for(let o=0,c=i.length;o<c;++o){const l=i[o];l&&r.add(l.outputType)}let s=0,a=[];for(let o=0,c=e.gl.programId.length;o<c;++o){const l=e.gl.programId[o];let u=0;for(let h=0,f=l.outputTypes.length;h<f;++h){const p=l.outputTypes[h];r.has(p)&&u++}u>s?(s=u,a=[l]):u===s&&a.push(l)}if(a.length!==0)return a.length===1?n=a[0].id:a.length>1&&(n=a.reduce((o,c)=>c.outputTypes.length<o.outputTypes.length?c:o)),n}useRenderTarget(e){return e?e.gl?(this.bindFBO(e.gl.fboId),this._renderTarget=e,!0):!1:(this.bindFBO(null),this._renderTarget=null,!0)}syncMaterial(e){return this.setDepthMask(e.depthWrite),this.setDepthTest(e.depthTest),this.setDepthFunc(e.depthFunc),this.setBlending(e.blending),this.setCullFace(e.culling),this.setColorMask(e.colorWrite),this.setDithering(e.dithering),this._currentUniforms=e.uniforms,!(!this._currentProgram||(Object.entries(e.uniforms).forEach(([n,r])=>{if(!this._currentProgram)return;r.gl||(r.gl=new Map);let i=r.gl.get(this._currentProgram);if(!i){const s=this.gl.getUniformLocation(this._currentProgram,n);if(!s){i={location:void 0},mh(this.debugContext,`A Material specified a uniform ${n}, but none was found in the current program.`);return}i={location:s},r.gl.set(this._currentProgram,i)}i.location&&this.uploadUniform(i.location,r)}),this._textureWillBeUsed.size>0&&!this.applyUsedTextures()))}setDepthMask(e){this._depthMask!==e&&(this._depthMask=e,this.gl.depthMask(this._depthMask))}setDepthTest(e){this._depthTestEnabled!==e&&(this._depthTestEnabled=e,this._depthTestEnabled?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST))}setDepthFunc(e){this._depthFunc!==e&&(this._depthFunc=e,this.applyDepthFunc())}setBlending(e){e?(this._blendingEnabled||(this.gl.enable(this.gl.BLEND),this._blendingEnabled=!0),(this._blendDstFactor!==e.blendDst||this._blendSrcFactor!==e.blendSrc||this._blendEquation!==e.blendEquation)&&(this._blendDstFactor=e.blendDst||this._blendDstFactor,this._blendSrcFactor=e.blendSrc||this._blendSrcFactor,this._blendEquation=e.blendEquation||this._blendEquation,this.applyBlendFactors())):this._blendingEnabled&&(this.gl.disable(this.gl.BLEND),this._blendingEnabled=!1)}setDithering(e){this._ditheringEnabled!==e&&(this._ditheringEnabled=e,this._ditheringEnabled?this.gl.enable(this.gl.DITHER):this.gl.disable(this.gl.DITHER))}setColorMask(e){(this._colorMask[0]!==e[0]||this._colorMask[1]!==e[1]||this._colorMask[2]!==e[2]||this._colorMask[3]!==e[3])&&(this._colorMask=e,this.applyColorMask())}setCullFace(e){this._cullFace!==e&&(this._cullFace=e,this.applyCullFace())}uploadUniform(e,n){let r;switch(n.type){case He.FLOAT:r=n.value,this.gl.uniform1f(e,r);break;case He.VEC2:r=n.value,this.gl.uniform2f(e,r[0],r[1]);break;case He.VEC3:r=n.value,this.gl.uniform3f(e,r[0],r[1],r[2]);break;case He.VEC4:r=n.value,this.gl.uniform4f(e,r[0],r[1],r[2],r[3]);break;case He.VEC4_ARRAY:r=n.value,this.gl.uniform4fv(e,ia(r));break;case He.MATRIX3x3:r=n.value,this.gl.uniformMatrix3fv(e,!1,r);break;case He.MATRIX4x4:r=n.value,this.gl.uniformMatrix4fv(e,!1,r);break;case He.FLOAT_ARRAY:r=n.value,this.gl.uniform1fv(e,r);break;case He.TEXTURE:r=n.value,this.willUseTextureUnit(r,e);break;default:console.warn(this.debugContext,"A uniform specified an unrecognized type. It will not sync with the GPU:",n)}}applyUsedTextures(){const e=this.assignTextureUnits(Array.from(this._textureWillBeUsed.keys()));e.forEach(i=>{i.gl?i.gl.textureUnit=this.gl.TEXTURE0:i.gl={textureId:null,textureUnit:this.gl.TEXTURE0,proxy:this.glProxy}});const n=new Map,r=new Set;return this._textureWillBeUsed.forEach((i,s)=>{i instanceof hr?r.add(i):n.set(s,i)}),r.forEach(i=>{i.getTextures().some(o=>{if(e.indexOf(o)<0)this.glProxy.updateTexture(o);else return!0;return!1})?console.warn(this.debugContext,"A RenderTarget can not be used because all of it's textures could not be compiled."):this.glProxy.compileRenderTarget(i)}),n.forEach((i,s)=>{e.indexOf(s)<0?(this.glProxy.updateTexture(s),i.forEach(a=>{this.uploadTextureToUniform(a,s)})):i.forEach(a=>{this.gl.uniform1i(a,Nc(this.gl,0))})}),this._textureWillBeUsed.clear(),!0}assignTextureUnits(e){const n=[],r=[];for(e.forEach(a=>{!a.gl||a.gl.textureUnit<0?n.push(a):r.push(a)});this._freeUnits.length>0&&n.length>0;){const a=n.shift();if(!a)continue;const o=this._freeUnits.shift();if(o===void 0){n.unshift(a);continue}a.gl?a.gl.textureUnit=o:a.gl={textureId:null,textureUnit:o,proxy:this.glProxy},r.push(a)}if(n.length<=0)return n;mh("WARNING: Too many textures in use are causing texture units to be swapped. Doing this occasionally is fine, but handling this on a frame loop can have serious performance concerns.");const i=new Map;this._textureUnitToTexture.forEach(a=>{a&&i.set(a,!1)}),r.forEach(a=>{i.set(a,!0)});const s=[];if(i.forEach((a,o)=>{a||s.push(o)}),s.length===0)return console.warn(this.debugContext,"There are too many textures being used for a single draw call. These textures will not be utilized on the GPU",n),console.warn("Current GL State:",this),n;for(;s.length>0&&n.length>0;){const a=n.shift();if(!a)continue;const o=s.shift();if(o===void 0||!o.gl||o.gl.textureUnit<0){n.unshift(a);continue}a.gl?a.gl.textureUnit=o.gl.textureUnit:a.gl={textureId:null,textureUnit:o.gl.textureUnit,proxy:this.glProxy},r.push(a)}return n.length>0&&(console.error(this.debugContext,"There are too many textures being used for a single draw call. These textures will not be utilized on the GPU",n),console.warn("Current GL State:",this)),n}uploadTextureToUniform(e,n){n.gl&&n.gl.textureUnit>=0?this.gl.uniform1i(e,Nc(this.gl,n.gl.textureUnit)):console.warn(this.debugContext,"Attempted to set a Texture Object to a uniform, but the Texture object did not have a valid texture unit.",n)}willUseTextureUnit(e,n){const r=this._textureWillBeUsed.get(e);n instanceof hr?r?r instanceof hr&&r!==n&&console.warn(this.debugContext,"A Texture is attempting to be used by two different render targets in a single draw."):this._textureWillBeUsed.set(e,n):r?r instanceof hr?console.warn(this.debugContext,"A texture in a single draw is attempting to attach to a uniform AND a render target which is invalid."):r.add(n):this._textureWillBeUsed.set(e,new Set([n]))}syncState(){const e=this.gl;this._blendingEnabled?e.enable(e.BLEND):e.disable(e.BLEND),this._ditheringEnabled?e.enable(e.DITHER):e.disable(e.DITHER),this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.setActiveTextureUnit(this._activeTextureUnit),this.applyClearColor(),this.applyCullFace(),this.applyBlendFactors(),this.applyBlendEquation(),this.applyColorMask(),this.applyDepthFunc(),this.applyScissorBounds(),this.applyViewport(),e.depthMask(this._depthMask)}applyClearColor(){this.gl.clearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3])}applyDepthFunc(){const e=this.gl;switch(this._depthFunc){case d.GLSettings.Material.DepthFunctions.ALWAYS:e.depthFunc(e.ALWAYS);break;case d.GLSettings.Material.DepthFunctions.EQUAL:e.depthFunc(e.EQUAL);break;case d.GLSettings.Material.DepthFunctions.GREATER:e.depthFunc(e.GREATER);break;case d.GLSettings.Material.DepthFunctions.GREATER_OR_EQUAL:e.depthFunc(e.GEQUAL);break;case d.GLSettings.Material.DepthFunctions.LESS:e.depthFunc(e.LESS);break;case d.GLSettings.Material.DepthFunctions.LESS_OR_EQUAL:e.depthFunc(e.LEQUAL);break;case d.GLSettings.Material.DepthFunctions.NEVER:e.depthFunc(e.NEVER);break;case d.GLSettings.Material.DepthFunctions.NOTEQUAL:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.ALWAYS);break}}applyScissorBounds(){this.gl.scissor(this._scissorBounds.x,this._scissorBounds.y,this._scissorBounds.width,this._scissorBounds.height)}applyColorMask(){this.gl.colorMask(this.colorMask[0]||!1,this.colorMask[1]||!1,this.colorMask[2]||!1,this.colorMask[3]||!1)}applyBlendEquation(){const e=this.gl;switch(this._blendEquation){case d.GLSettings.Material.BlendingEquations.Add:e.blendEquation(e.FUNC_ADD);break;case d.GLSettings.Material.BlendingEquations.Subtract:e.blendEquation(e.FUNC_SUBTRACT);break;case d.GLSettings.Material.BlendingEquations.ReverseSubtract:e.blendEquation(e.FUNC_REVERSE_SUBTRACT);break}}applyBlendFactors(){const e=this.gl;let n,r;switch(this._blendDstFactor){case d.GLSettings.Material.BlendingDstFactor.DstAlpha:n=e.BLEND_DST_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.DstColor:n=e.BLEND_DST_RGB;break;case d.GLSettings.Material.BlendingDstFactor.One:n=e.ONE;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusDstAlpha:n=e.ONE_MINUS_DST_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusDstColor:n=e.ONE_MINUS_DST_COLOR;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha:n=e.ONE_MINUS_SRC_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusSrcColor:n=e.ONE_MINUS_SRC_COLOR;break;case d.GLSettings.Material.BlendingDstFactor.SrcAlpha:n=e.SRC_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.SrcColor:n=e.SRC_COLOR;break;case d.GLSettings.Material.BlendingDstFactor.Zero:n=e.ZERO;break;default:n=e.ONE;break}switch(this._blendSrcFactor){case d.GLSettings.Material.BlendingDstFactor.DstAlpha:r=e.BLEND_DST_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.DstColor:r=e.BLEND_DST_RGB;break;case d.GLSettings.Material.BlendingDstFactor.One:r=e.ONE;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusDstAlpha:r=e.ONE_MINUS_DST_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusDstColor:r=e.ONE_MINUS_DST_COLOR;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha:r=e.ONE_MINUS_SRC_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.OneMinusSrcColor:r=e.ONE_MINUS_SRC_COLOR;break;case d.GLSettings.Material.BlendingDstFactor.SrcAlpha:r=e.SRC_ALPHA;break;case d.GLSettings.Material.BlendingDstFactor.SrcColor:r=e.SRC_COLOR;break;case d.GLSettings.Material.BlendingDstFactor.Zero:r=e.ZERO;break;case d.GLSettings.Material.BlendingSrcFactor.SrcAlphaSaturate:r=e.SRC_ALPHA_SATURATE;break;default:r=e.ONE;break}e.blendFunc(r,n)}applyCullFace(){const e=this.gl;switch(this._cullFace!==d.GLSettings.Material.CullSide.NONE&&e.enable(e.CULL_FACE),this._cullFace){case d.GLSettings.Material.CullSide.CW:e.frontFace(e.CW),e.cullFace(e.FRONT);break;case d.GLSettings.Material.CullSide.CCW:e.frontFace(e.CCW),e.cullFace(e.FRONT);break;case d.GLSettings.Material.CullSide.BOTH:e.frontFace(e.CW),e.cullFace(e.FRONT_AND_BACK);break;default:e.disable(e.CULL_FACE)}}applyViewport(){this.gl.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)}}class ss{constructor(e){this.blending={blendDst:d.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:d.GLSettings.Material.BlendingEquations.Add,blendSrc:d.GLSettings.Material.BlendingSrcFactor.SrcAlpha},this.colorWrite=[!0,!0,!0,!0],this.culling=d.GLSettings.Material.CullSide.CCW,this.depthFunc=d.GLSettings.Material.DepthFunctions.LESS_OR_EQUAL,this.depthTest=!0,this.depthWrite=!0,this.dithering=!0,this.name="",this.uniforms={},this.vertexShader="",Object.assign(this,e),delete this.gl}clone(){const e=new ss(this);e.blending=Object.assign({},this.blending),e.polygonOffset=Object.assign({},this.polygonOffset),e.uniforms=Object.assign({},this.uniforms);for(const n in e.uniforms){const r=e.uniforms[n];if(r.gl){const i=new Map;r.gl.forEach((s,a)=>{i.set(a,Object.assign({},s))})}}return e}dispose(){this.gl&&this.gl.proxy.disposeMaterial(this)}}class Gc{constructor(e,n,r){this.drawMode=d.GLSettings.Model.DrawMode.TRIANGLES,this.vertexDrawRange=[-1,-1],this.drawInstances=-1,this.vertexCount=0,this.id=e,this.geometry=n,this.material=r}}class ma{constructor(){this.models=new Set}add(e){this.models.add(e)}remove(e){this.models.delete(e)}}const yh=Ye("performance");class wh{constructor(e){this.state={clearMask:[!1,!1,!1],currentRenderTarget:null,displaySize:[1,1],pixelRatio:1,renderSize:[1,1]},this.options=Object.assign({alpha:!1,antialias:!1,preserveDrawingBuffer:!1},e),this.options.canvas||console.warn("WebGLRenderer ERROR: A canvas is REQUIRED as a parameter."),this.getContext()}set debugContext(e){this.glProxy&&(this.glProxy.debugContext=e),this.glState&&(this.glState.debugContext=e)}get gl(){return this._gl}clear(e,n,r){const i=this.state.clearMask;this.state.clearMask=[i[0]||e||!1,i[1]||n||!1,i[2]||r||!1]}clearColor(e){e&&this.glState.setClearColor(e)}dispose(){}getContext(){if(this._gl)return this._gl;const e=is.getContext(this.options.canvas,{alpha:this.options.alpha||!1,antialias:this.options.antialias||!1,premultipliedAlpha:this.options.premultipliedAlpha||!1,preserveDrawingBuffer:this.options.preserveDrawingBuffer||!1});return e.context?(this._gl=e.context,this.glState=new vh(e.context,e.extensions),this.glProxy=new is(e.context,this.glState,e.extensions),this.glState.setProxy(this.glProxy),this.glState.syncState()):this.options.onNoContext?this.options.onNoContext():console.warn("No context was able to be produced, and the handler onNoContext was not implemented for such cases."),this._gl}getDisplaySize(){return this.state.displaySize}getPixelRatio(){return this.state.pixelRatio}getRenderSize(){return this.state.renderSize}getFullViewport(){const e=this.state.currentRenderTarget;if(Array.isArray(e))return{x:0,y:0,width:e[0].width,height:e[0].height};if(e)return{x:0,y:0,width:e.width,height:e.height};{const n=this.getRenderSize();return{x:0,y:0,width:n[0],height:n[1]}}}prepareAttribute(e,n,r){if(this.glProxy.updateAttribute(n))(!e.gl||!e.gl.vao)&&this.glProxy.useAttribute(r,n,e);else return console.warn("Could not update attribute",n),!1;return!0}render(e,n=null,r){if(!this.gl)return;this.setRenderTarget(n);const i=[];if(n&&!Array.isArray(n)&&(U.MRT||U.MRT_EXTENSION)){const a=n.getGLBuffers();this.glState.setDrawBuffers(a.map(o=>(o==null?void 0:o.attachment)||0))}const s=this.state.clearMask;if((s[0]||s[1]||s[2])&&(this.glProxy.clear(s[0],s[1],s[2]),this.state.clearMask=[!1,!1,!1]),Array.isArray(n))for(let a=0,o=n.length;a<o;++a){const c=n[a];if(this.glState.useRenderTarget(c),c&&!c.gl)return;e.models.forEach(l=>{this.renderModel(l,i,r)})}else{if(n&&!n.gl)return;e.models.forEach(a=>{this.renderModel(a,i,r)})}i.forEach(a=>{e.remove(a)})}renderModel(e,n,r){var o;const i=e.geometry,s=e.material;switch(this.glState.useMaterial(s)){case kt.VALID:{this.glProxy.compileGeometry(i);let c=!0;const l=(u,h)=>{c=this.prepareAttribute(i,u,h)&&c};i.attributes.forEach(l),(o=i.gl)!=null&&o.vao?this.glState.bindVAO(i.gl.vao):this.glState.applyVertexAttributeArrays(),r==null||r(this.glState,e.id),c?this.glProxy.draw(e):(console.warn("Geometry was unable to update correctly, thus we are skipping the drawing of",e),n.push(e)),this.glState.bindVAO(null);break}case kt.INVALID:{console.warn("Could not utilize material. Skipping draw call for:",s,i),n.push(e);break}case kt.NO_RENDER_TARGET_MATCHES:{yh("Skipped draw for material due to no output matches for the current render target");break}default:yh("Skipped draw for material due to unknown reasons");break}}readPixels(e,n,r,i,s,a=0){if(!this.gl)return;const o=this.state.currentRenderTarget;let c=!0,l;if(Array.isArray(o))l=o.find(u=>{var h;return Array.isArray(u.buffers.color)?u.buffers.color.find(f=>f.outputType===a):((h=u.buffers.color)==null?void 0:h.outputType)===a});else if(o&&Array.isArray(o==null?void 0:o.buffers.color)){if(o.buffers.color.length>1){console.warn("It is not yet implemented to read the pixels from a RenderTarget with multiple color buffers");return}l=o}else l=o;if(l&&(c=l.validFramebuffer),!c){console.warn("Framebuffer is incomplete. Can not read pixels at this time.");return}if(e=Math.max(0,e),n=Math.max(0,n),l){e+r>l.width&&(r=l.width-e),n+i>l.height&&(i=l.height-n);const u=l.height;this.gl.readPixels(e,u-n-i,r,i,this.gl.RGBA,this.gl.UNSIGNED_BYTE,s)}else{const u=this.getRenderSize(),h=u[1];e+r>u[0]&&(r=u[0]-e),n+i>u[1]&&(i=u[1]-n),this.gl.readPixels(e,h-n-i,r,i,this.gl.RGBA,this.gl.UNSIGNED_BYTE,s)}}setClearColor(e){this.glState.setClearColor(e)}setPixelRatio(e){const{canvas:n}=this.options,r=this.getDisplaySize();n.width=r[0]*e,n.height=r[1]*e,this.state.pixelRatio=e}setScissor(e,n){if(n=n||this.state.currentRenderTarget||null,Array.isArray(n)){const r=n[0].height;if(e){const{x:i,y:s,width:a,height:o}=e;this.glState.setScissor({x:i,y:r-s-o,width:a,height:o})}else this.glState.setScissor(null)}else if(n){const r=n.height;if(e){const{x:i,y:s,width:a,height:o}=e;this.glState.setScissor({x:i,y:r-s-o,width:a,height:o})}else this.glState.setScissor(null)}else{const{renderSize:r}=this.state,i=r[1];if(e){const{x:s,y:a,width:o,height:c}=e;this.glState.setScissor({x:s,y:i-a-c,width:o,height:c})}else this.glState.setScissor(null)}}setSize(e,n){const{canvas:r}=this.options,{pixelRatio:i}=this.state;r.width=Math.min(e*i,U.MAX_TEXTURE_SIZE),r.height=Math.min(n*i,U.MAX_TEXTURE_SIZE),r.style.width=`${e}px`,r.style.height=`${n}px`,this.state.renderSize=[r.width,r.height],this.state.displaySize=[e,n]}setRenderTarget(e){this.state.currentRenderTarget!==e&&(Array.isArray(e)?e.forEach(n=>{n.gl||this.glProxy.compileRenderTarget(n)}):!this.glState.useRenderTarget(e)&&e&&(e.getTextures().forEach(n=>{this.glState.willUseTextureUnit(n,e)}),this.glState.applyUsedTextures(),this.glProxy.compileRenderTarget(e)&&this.glState.useRenderTarget(e)),this.state.currentRenderTarget=e)}setViewport(e){const n=this.state.currentRenderTarget,{x:r,y:i,width:s,height:a}=e;if(Array.isArray(n)){const o=n[0].height;this.glState.setViewport(r,o-i-a,s,a)}else if(n){const o=n.height;this.glState.setViewport(r,o-i-a,s,a)}else{const{renderSize:o}=this.state,c=o[1];this.glState.setViewport(r,c-i-a,s,a)}}}var va=!!(typeof window<"u"&&window.document&&window.document.createElement),Th={canUseDOM:va,canUseWorkers:typeof Worker<"u",canUseEventListeners:va&&!!(window.addEventListener||window.attachEvent),canUseViewport:va&&!!window.screen,isInWorker:!va},bh;Th.canUseDOM&&(bh=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0);/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @param {?boolean} capture Check if the capture phase is supported.
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function mm(t,e){if(!Th.canUseDOM||e&&!("addEventListener"in document))return!1;var n="on"+t,r=n in document;if(!r){var i=document.createElement("div");i.setAttribute(n,"return;"),r=typeof i[n]=="function"}return!r&&bh&&t==="wheel"&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r}var Eh=!1,Wr,zc,Vc,ya,wa,_h,Ta,$c,Wc,jc,Rh,Hc,Qc,Ah,Sh;function Tt(){if(!Eh){Eh=!0;var t=navigator.userAgent,e=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(t),n=/(Mac OS X)|(Windows)|(Linux)/.exec(t);if(Hc=/\b(iPhone|iP[ao]d)/.exec(t),Qc=/\b(iP[ao]d)/.exec(t),jc=/Android/i.exec(t),Ah=/FBAN\/\w+;/i.exec(t),Sh=/Mobile/i.exec(t),Rh=!!/Win64/.exec(t),e){Wr=e[1]?parseFloat(e[1]):e[5]?parseFloat(e[5]):NaN,Wr&&document&&document.documentMode&&(Wr=document.documentMode);var r=/(?:Trident\/(\d+.\d+))/.exec(t);_h=r?parseFloat(r[1])+4:Wr,zc=e[2]?parseFloat(e[2]):NaN,Vc=e[3]?parseFloat(e[3]):NaN,ya=e[4]?parseFloat(e[4]):NaN,ya?(e=/(?:Chrome\/(\d+\.\d+))/.exec(t),wa=e&&e[1]?parseFloat(e[1]):NaN):wa=NaN}else Wr=zc=Vc=wa=ya=NaN;if(n){if(n[1]){var i=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(t);Ta=i?parseFloat(i[1].replace("_",".")):!0}else Ta=!1;$c=!!n[2],Wc=!!n[3]}else Ta=$c=Wc=!1}}var Xc={ie:function(){return Tt()||Wr},ieCompatibilityMode:function(){return Tt()||_h>Wr},ie64:function(){return Xc.ie()&&Rh},firefox:function(){return Tt()||zc},opera:function(){return Tt()||Vc},webkit:function(){return Tt()||ya},safari:function(){return Xc.webkit()},chrome:function(){return Tt()||wa},windows:function(){return Tt()||$c},osx:function(){return Tt()||Ta},linux:function(){return Tt()||Wc},iphone:function(){return Tt()||Hc},mobile:function(){return Tt()||Hc||Qc||jc||Sh},nativeApp:function(){return Tt()||Ah},android:function(){return Tt()||jc},ipad:function(){return Tt()||Qc}};const xh=10,Mh=40,Ih=800;function Yc(t){let e=0,n=0,r=0,i=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*xh,i=n*xh,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||i)&&t.deltaMode&&(t.deltaMode===1?(r*=Mh,i*=Mh):(r*=Ih,i*=Ih)),r&&!e&&(e=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:e,spinY:-n,pixelX:r,pixelY:-i}}Yc.getEventType=function(){return Xc.firefox()?"DOMMouseScroll":mm("wheel")?"wheel":"mousewheel"};function Jt(t,e){let n=0,r=0,i=0,s=0,a=e||t.nativeEvent&&t.nativeEvent.target||t.target;if(t||(t=window.event),t.pageX||t.pageY)n=t.pageX,r=t.pageY;else if(t.clientX||t.clientY){let o=0,c=0;document.documentElement&&(o=document.documentElement.scrollLeft,c=document.documentElement.scrollTop),n=t.clientX+document.body.scrollLeft+o,r=t.clientY+document.body.scrollTop+c}if(a.offsetParent)do i+=a.offsetLeft,s+=a.offsetTop,a=a.offsetParent;while(a);return[n-i,r-s]}function Ue(t){return t!=null}function Ch(t){return Array.isArray(t)?e=>t.indexOf(e.start.view.id)>=0:e=>e.start.view.id===t}function Lh(t){return Array.isArray(t)?e=>e.start.views.find(n=>t.indexOf(n.view.id)>=0):e=>e.start.views.find(n=>n.view.id===t)}class ba{constructor(){this._uid=Y(),this.id="",this.pixelRatio=1,this._screenScale=[1,1]}get uid(){return this._uid}get screenBounds(){return this._scaledScreenBounds||(this._scaledScreenBounds=new we({x:this._screenBounds.x*this._screenScale[0],y:this._screenBounds.y*this._screenScale[1],width:this._screenBounds.width*this._screenScale[0],height:this._screenBounds.height*this._screenScale[1]})),this._scaledScreenBounds}set screenBounds(e){delete this._scaledScreenBounds,this._screenBounds=e}get screenScale(){return this._screenScale}set screenScale(e){qs(e,this._screenScale)||(delete this._scaledScreenBounds,this._screenScale=e)}screenToRenderSpace(e,n){return n=this.screenToView(e,n),Ce(n,e[0]*this.pixelRatio,e[1]*this.pixelRatio)}renderSpaceToScreen(e,n){return n=n||[0,0],Ce(n,e[0]/this.pixelRatio-this.screenBounds.x,e[1]/this.pixelRatio-this.screenBounds.y)}screenToView(e,n){return n=n||[0,0],Ce(n,e[0]-this.screenBounds.x,e[1]-this.screenBounds.y)}viewToScreen(e,n){return n=n||[0,0],Ce(n,e[0]+this.screenBounds.x,e[1]+this.screenBounds.y)}}class Oh extends ba{screenToWorld(e,n){return e}screenRay(e){return[[0,0,-1],[0,0,-2]]}worldToScreen(e,n){return e}viewToWorld(e,n){return e}worldToView(e,n){return e}}const{cos:Dt,sin:Ft,tan:en}=Math,Bt=Math.PI/2,dr=0,fr=1,pr=2,gr=3,as=0,os=1,cs=2,ls=3,us=4,hs=5,ds=6,fs=7,ps=8,tn=0,nn=1,rn=2,sn=3,an=4,on=5,cn=6,ln=7,un=8,hn=9,dn=10,fn=11,pn=12,gn=13,mn=14,vn=15,jr=new Array(20).fill(0).map(t=>yn()),lt=new Array(20).fill(0).map(t=>Me());function Ut(t,e,n,r,i){return t=t||new Array(4),t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function bt(t,e,n,r,i,s,a,o,c,l){return t=t||new Array(9),t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=s,t[5]=a,t[6]=o,t[7]=c,t[8]=l,t}function ke(t,e,n,r,i,s,a,o,c,l,u,h,f,p,m,v,b){return t=t||new Array(16),t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=s,t[5]=a,t[6]=o,t[7]=c,t[8]=l,t[9]=u,t[10]=h,t[11]=f,t[12]=p,t[13]=m,t[14]=v,t[15]=b,t}const Nh=yn(),Ph=yn(),qc=yn(),vm=yn();function Pe(t){return t[3]*t[0]-t[1]*t[2]}function Hr(t){return t[0]*t[4]*t[8]-t[0]*t[5]*t[7]+t[1]*t[5]*t[6]-t[1]*t[3]*t[8]+t[2]*t[3]*t[7]-t[2]*t[4]*t[6]}function Kc(t){return bt(Nh,t[5],t[6],t[7],t[9],t[10],t[11],t[13],t[14],t[15]),bt(Ph,t[4],t[6],t[7],t[8],t[10],t[11],t[12],t[14],t[15]),bt(qc,t[4],t[5],t[7],t[8],t[9],t[11],t[12],t[13],t[15]),bt(qc,t[4],t[5],t[6],t[8],t[9],t[10],t[12],t[13],t[14]),t[0]*Hr(Nh)-t[1]*Hr(Ph)+t[2]*Hr(qc)-t[3]*Hr(vm)}function Dh(t,e){const n=Pe(t);return n===0?null:Ut(e,t[3]/n,-t[1]/n,-t[2]/n,t[0]/n)}function Fh(t,e){const n=Hr(t);if(n===0)return null;const r=Pe([t[4],t[5],t[7],t[8]]),i=Pe([t[3],t[5],t[6],t[8]]),s=Pe([t[3],t[4],t[6],t[7]]),a=Pe([t[1],t[2],t[7],t[8]]),o=Pe([t[0],t[2],t[6],t[8]]),c=Pe([t[0],t[1],t[6],t[7]]),l=Pe([t[1],t[2],t[4],t[5]]),u=Pe([t[0],t[2],t[3],t[5]]),h=Pe([t[0],t[1],t[3],t[4]]);return bt(e,r/n,-a/n,l/n,-i/n,o/n,u/n,s/n,-c/n,h/n)}function Bh(t,e){const n=Kc(t);if(n===0)return null;const r=Pe([t[0],t[1],t[4],t[5]]),i=Pe([t[0],t[2],t[4],t[6]]),s=Pe([t[0],t[3],t[4],t[7]]),a=Pe([t[1],t[2],t[5],t[6]]),o=Pe([t[1],t[3],t[5],t[7]]),c=Pe([t[2],t[3],t[6],t[7]]),l=Pe([t[10],t[11],t[14],t[15]]),u=Pe([t[9],t[11],t[13],t[15]]),h=Pe([t[9],t[10],t[13],t[14]]),f=Pe([t[8],t[11],t[12],t[15]]),p=Pe([t[8],t[10],t[12],t[14]]),m=Pe([t[8],t[9],t[12],t[13]]);return ke(e,(t[5]*l-t[6]*u+t[7]*h)/n,(-t[1]*l+t[2]*u-t[3]*h)/n,(t[12]*c-t[13]*o+t[14]*a)/n,(-t[9]*c+t[10]*o-t[11]*a)/n,(-t[4]*l+t[6]*f-t[7]*p)/n,(t[0]*l-t[2]*f+t[3]*p)/n,(-t[12]*c+t[14]*s-t[15]*i)/n,(t[8]*c-t[10]*s+t[11]*i)/n,(t[4]*u-t[5]*f+t[7]*m)/n,(-t[0]*u+t[1]*f-t[3]*m)/n,(t[12]*o-t[13]*s+t[15]*r)/n,(-t[8]*o+t[9]*s-t[11]*r)/n,(-t[4]*h+t[5]*p-t[6]*m)/n,(t[0]*h-t[1]*p+t[2]*m)/n,(-t[12]*a+t[13]*i-t[14]*r)/n,(t[8]*a-t[9]*i+t[10]*r)/n)}function Uh(t,e,n){return Ut(n,t[0]*e,t[1]*e,t[2]*e,t[3]*e)}function kh(t,e,n){return bt(n,t[0]*e,t[1]*e,t[2]*e,t[3]*e,t[4]*e,t[5]*e,t[6]*e,t[7]*e,t[8]*e)}function Gh(t,e,n){return ke(n,t[0]*e,t[1]*e,t[2]*e,t[3]*e,t[4]*e,t[5]*e,t[6]*e,t[7]*e,t[8]*e,t[9]*e,t[10]*e,t[11]*e,t[12]*e,t[13]*e,t[14]*e,t[15]*e)}function gs(t){return Ut(t,1,0,0,1)}function yn(t){return bt(t,1,0,0,0,1,0,0,0,1)}function Me(t){return ke(t,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}function zh(t,e,n){return Ut(n,e[dr]*t[dr]+e[fr]*t[pr],e[dr]*t[fr]+e[fr]*t[gr],e[pr]*t[dr]+e[gr]*t[pr],e[pr]*t[fr]+e[gr]*t[gr])}function Vh(t,e,n){return bt(n,e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8])}function It(t,e,n){return n=n||[],n[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],n[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],n[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],n[3]=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],n[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],n[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],n[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],n[7]=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],n[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],n[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],n[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],n[11]=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],n[12]=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],n[13]=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],n[14]=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],n[15]=e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15],n}function $h(t,...e){if(e.length<=0)return Me();if(t=t||Me(),e.length===1)return Ti(e[0],t);let n=e[0],r=lt[lt.length-1],i=lt[lt.length-2];t===r&&(r=lt[lt.length-3]),t===i&&(i=lt[lt.length-3]);let s=r;for(let a=1,o=e.length-1;a<o;++a){const c=e[a];n=It(n,c,s),s=s===r?i:r}return It(n,e[e.length-1],t)}function Wh(t,e,n){return Ut(n,t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3]+e[3])}function jh(t,e,n){return bt(n,t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3]+e[3],t[4]+e[4],t[5]+e[5],t[6]+e[6],t[7]+e[7],t[8]+e[8])}function Hh(t,e,n){return ke(n,t[0]+e[0],t[1]+e[1],t[2]+e[2],t[3]+e[3],t[4]+e[4],t[5]+e[5],t[6]+e[6],t[7]+e[7],t[8]+e[8],t[9]+e[9],t[10]+e[10],t[11]+e[11],t[12]+e[12],t[13]+e[13],t[14]+e[14],t[15]+e[15])}function Qh(t,e,n){return Ut(n,t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function Xh(t,e,n){return bt(n,t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3],t[4]-e[4],t[5]-e[5],t[6]-e[6],t[7]-e[7],t[8]-e[8])}function Yh(t,e,n){return ke(n,t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3],t[4]-e[4],t[5]-e[5],t[6]-e[6],t[7]-e[7],t[8]-e[8],t[9]-e[9],t[10]-e[10],t[11]-e[11],t[12]-e[12],t[13]-e[13],t[14]-e[14],t[15]-e[15])}function qh(t,e,n){return Ut(n,t[0]*e[0],t[1]*e[1],t[2]*e[2],t[3]*e[3])}function Kh(t,e,n){return bt(n,t[0]*e[0],t[1]*e[1],t[2]*e[2],t[3]*e[3],t[4]*e[4],t[5]*e[5],t[6]*e[6],t[7]*e[7],t[8]*e[8])}function Zh(t,e,n){return ke(n,t[0]*e[0],t[1]*e[1],t[2]*e[2],t[3]*e[3],t[4]*e[4],t[5]*e[5],t[6]*e[6],t[7]*e[7],t[8]*e[8],t[9]*e[9],t[10]*e[10],t[11]*e[11],t[12]*e[12],t[13]*e[13],t[14]*e[14],t[15]*e[15])}function Jh(t,e){return Ut(e,t[0],t[2],t[1],t[3])}function ms(t,e){return bt(e,t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}function ed(t,e){return ke(e,t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}function td(t,e){return(t>=Math.PI/2||t<=-Math.PI/2)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),e=e||gs(),Ut(e,1,0,en(t),1)}function nd(t,e){return(t>=Math.PI/2||t<=-Math.PI/2)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),e=e||gs(),Ut(e,1,en(t),0,1)}function rd(t,e,n){(e>=Bt||e<=-Bt||t>=Bt||t<=-Bt)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),n=n||Me();const r=en(e),i=en(t);return ke(n,1,0,0,0,i,1,0,0,r,0,1,0,0,0,0,1)}function id(t,e,n){(e>=Bt||e<=-Bt||t>=Bt||t<=-Bt)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),n=n||Me();const r=en(e),i=en(t);return ke(n,1,i,0,0,0,1,0,0,0,r,1,0,0,0,0,1)}function sd(t,e,n){(e>=Bt||e<=-Bt||t>=Bt||t<=-Bt)&&console.warn("A shear matrix can not have radians >= PI / 2 or <= -PI / 2"),n=n||Me();const r=en(e),i=en(t);return ke(n,1,0,i,0,0,1,r,0,0,0,1,0,0,0,0,1)}function ad(t,e,n){return Ce(n,t[dr]*e[0]+t[pr]*e[1],t[fr]*e[0]+t[gr]*e[1])}function od(t,e,n){return Ne(n,t[as]*e[0]+t[ls]*e[1]+t[ds]*e[2],t[os]*e[0]+t[us]*e[1]+t[fs]*e[2],t[cs]*e[0]+t[hs]*e[1]+t[ps]*e[2])}function cd(t,e,n){return Le(n,t[tn]*e[0]+t[an]*e[1]+t[un]*e[2]+t[pn]*1,t[nn]*e[0]+t[on]*e[1]+t[hn]*e[2]+t[gn]*1,t[rn]*e[0]+t[cn]*e[1]+t[dn]*e[2]+t[mn]*1,t[sn]*e[0]+t[ln]*e[1]+t[fn]*e[2]+t[vn]*1)}function vs(t,e,n){return Le(n,t[tn]*e[0]+t[an]*e[1]+t[un]*e[2]+t[pn]*e[3],t[nn]*e[0]+t[on]*e[1]+t[hn]*e[2]+t[gn]*e[3],t[rn]*e[0]+t[cn]*e[1]+t[dn]*e[2]+t[mn]*e[3],t[sn]*e[0]+t[ln]*e[1]+t[fn]*e[2]+t[vn]*e[3])}function ld(t){return`Matrix: [
  ${t[0]}, ${t[1]},
  ${t[2]}, ${t[3]},
]`}function ud(t){return`Matrix: [
  ${t[0]}, ${t[1]}, ${t[2]},
  ${t[3]}, ${t[4]}, ${t[5]},
  ${t[6]}, ${t[7]}, ${t[8]},
]`}function hd(t){return`Matrix: [
  ${t[0]}, ${t[1]}, ${t[2]}, ${t[3]},
  ${t[4]}, ${t[5]}, ${t[6]}, ${t[7]},
  ${t[8]}, ${t[9]}, ${t[10]}, ${t[11]},
  ${t[12]}, ${t[13]}, ${t[14]}, ${t[15]},
]`}function Zc(t,e){e=e||new Array(4);const n=Math.cos(t),r=Math.sin(t);return e[dr]=n,e[fr]=-r,e[pr]=r,e[gr]=n,e}function Jc(t,e,n,r){if(t)if(e)if(n){const i=Dt(t),s=Dt(e),a=Dt(n),o=Ft(t),c=Ft(e),l=Ft(n);return ke(r,s*a,s*l,-c,0,o*c*a-i*l,o*c*l+i*a,o*s,0,i*c*a+o*l,i*c*l-o*a,i*s,0,0,0,0,1)}else{const i=Dt(t),s=Dt(e),a=Ft(t),o=Ft(e);return ke(r,s,0,-o,0,a*o,i,a*s,0,i*o,-a,i*s,0,0,0,0,1)}else if(n){const i=Dt(t),s=Dt(n),a=Ft(t),o=Ft(n);return ke(r,s,o,0,0,-i*o,i*s,a,0,a*o,-a*s,i,0,0,0,0,1)}else{const i=Dt(t),s=Ft(t);return ke(r,1,0,0,0,0,i,s,0,0,-s,i,0,0,0,0,1)}else if(e)if(n){const i=Dt(e),s=Dt(n),a=Ft(e),o=Ft(n);return ke(r,i*s,i*o,-a,0,-o,s,0,0,a*s,a*o,i,0,0,0,0,1)}else{const i=Dt(e),s=Ft(e);return ke(r,i,0,-s,0,0,1,0,0,s,0,i,0,0,0,0,1)}else if(n){const i=Dt(n),s=Ft(n);return ke(r,i,s,0,0,-s,i,0,0,0,0,1,0,0,0,0,1)}else return Me(r)}function dd(t,e){return Jc(t[0],t[1],t[2],e)}function fd(t,e){return el(t[0],t[1],t[2],e)}function el(t,e,n,r){return ke(r,t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1)}function pd(t,e){return tl(t[0],t[1],t[2],e)}function tl(t,e,n,r){return ke(r,1,0,0,0,0,1,0,0,0,0,1,0,t,e,n,1)}function Ea(t,e,n,r,i,s,a){return a=a||Me(),ke(a,2*t/(r-n),0,0,0,0,2*t/(i-s),0,0,(r+n)/(r-n),(i+s)/(i-s),-(e+t)/(e-t),-1,0,0,-(2*e*t)/(e-t),0)}function nl(t,e,n,r,i,s){const a=n/e,o=en(t/2)*r,c=-o,l=a*o,u=-l;return Ea(r,i,c,o,l,u,s)}function gd(t,e,n,r,i,s){const a=e/n,o=en(t/2)*r,c=-o,l=a*o,u=-l;return Ea(r,i,u,l,o,c,s)}function rl(t,e,n,r,i,s,a){return ke(a,2/(e-t),0,0,0,0,2/(r-n),0,0,0,0,-1/(s-i),0,(e+t)/(t-e),(r+n)/(n-r),-i/(i-s),1)}function il(t,e,n,r,i){return i=i||[0,0,0,0],vs(t,e,i),Le(i,(i[0]/i[3]+1)*.5*n,(i[1]/i[3]+1)*.5*r,i[2]/i[3],1)}function _a(t,e,n,r,i){return il(t,[e[0],e[1],e[2],1],n,r,i)}function md(t,e){return Math.abs(t[0]-e[0])<=1e-7&&Math.abs(t[1]-e[1])<=1e-7&&Math.abs(t[2]-e[2])<=1e-7&&Math.abs(t[3]-e[3])<=1e-7}function vd(t,e){return Math.abs(t[0]-e[0])<=1e-7&&Math.abs(t[1]-e[1])<=1e-7&&Math.abs(t[2]-e[2])<=1e-7&&Math.abs(t[3]-e[3])<=1e-7&&Math.abs(t[4]-e[4])<=1e-7&&Math.abs(t[5]-e[5])<=1e-7&&Math.abs(t[6]-e[6])<=1e-7&&Math.abs(t[7]-e[7])<=1e-7&&Math.abs(t[8]-e[8])<=1e-7}function sl(t,e){return Math.abs(t[0]-e[0])<=1e-7&&Math.abs(t[1]-e[1])<=1e-7&&Math.abs(t[2]-e[2])<=1e-7&&Math.abs(t[3]-e[3])<=1e-7&&Math.abs(t[4]-e[4])<=1e-7&&Math.abs(t[5]-e[5])<=1e-7&&Math.abs(t[6]-e[6])<=1e-7&&Math.abs(t[7]-e[7])<=1e-7&&Math.abs(t[8]-e[8])<=1e-7&&Math.abs(t[9]-e[9])<=1e-7&&Math.abs(t[10]-e[10])<=1e-7&&Math.abs(t[11]-e[11])<=1e-7&&Math.abs(t[12]-e[12])<=1e-7&&Math.abs(t[13]-e[13])<=1e-7&&Math.abs(t[14]-e[14])<=1e-7&&Math.abs(t[15]-e[15])<=1e-7}function yd(t){return[t[0],t[1],t[2],t[3]]}function wd(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function Ti(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e):[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function ys(t,e,n,r){r=r||[];const[i,s,a]=t,[o,c,l]=n,[u,h,f,p,m,v,b,T,E]=e;r[tn]=u*i,r[nn]=h*s,r[rn]=f*a,r[sn]=0,r[an]=p*i,r[on]=m*s,r[cn]=v*a,r[ln]=0,r[un]=b*i,r[hn]=T*s,r[dn]=E*a,r[fn]=0,r[pn]=i*(u*o+p*c+b*l),r[gn]=s*(h*o+m*c+T*l),r[mn]=a*(f*o+v*c+E*l),r[vn]=1}function Ra(t,e,n,r){r=r||[];const[i,s,a]=t,[o,c,l]=n,[u,h,f,p,m,v,b,T,E]=e;r[tn]=u*i,r[nn]=h*i,r[rn]=f*i,r[sn]=0,r[an]=p*s,r[on]=m*s,r[cn]=v*s,r[ln]=0,r[un]=b*a,r[hn]=T*a,r[dn]=E*a,r[fn]=0,r[pn]=o,r[gn]=c,r[mn]=l,r[vn]=1}function Td(t,e,n,r){r=r||[];const[i,s]=t,[a,o]=n,[c,l,u,h]=e;r[tn]=c*i,r[nn]=l*s,r[rn]=0,r[sn]=0,r[an]=u*i,r[on]=h*s,r[cn]=0,r[ln]=0,r[un]=0,r[hn]=0,r[dn]=1,r[fn]=0,r[pn]=i*(c*a+u*o),r[gn]=s*(l*a+h*o),r[mn]=0,r[vn]=1}function al(t,e,n,r){r=r||[];const[i,s]=t,[a,o]=n,[c,l,u,h]=e;r[tn]=c*i,r[nn]=l*i,r[rn]=0,r[sn]=0,r[an]=u*s,r[on]=h*s,r[cn]=0,r[ln]=0,r[un]=0,r[hn]=0,r[dn]=1,r[fn]=0,r[pn]=a,r[gn]=o,r[mn]=0,r[vn]=1}const ym=Object.freeze(Object.defineProperty({__proto__:null,Hadamard2x2:qh,Hadamard3x3:Kh,Hadamard4x4:Zh,M200:dr,M201:fr,M210:pr,M211:gr,M300:as,M301:os,M302:cs,M310:ls,M311:us,M312:hs,M320:ds,M321:fs,M322:ps,M3R:jr,M400:tn,M401:nn,M402:rn,M403:sn,M410:an,M411:on,M412:cn,M413:ln,M420:un,M421:hn,M422:dn,M423:fn,M430:pn,M431:gn,M432:mn,M433:vn,M4R:lt,SRT4x4:Ra,SRT4x4_2D:al,TRS4x4:ys,TRS4x4_2D:Td,add2x2:Wh,add3x3:jh,add4x4:Hh,affineInverse2x2:Dh,affineInverse3x3:Fh,affineInverse4x4:Bh,apply2x2:Ut,apply3x3:bt,apply4x4:ke,compare2x2:md,compare3x3:vd,compare4x4:sl,concat4x4:$h,copy2x2:yd,copy3x3:wd,copy4x4:Ti,determinant2x2:Pe,determinant3x3:Hr,determinant4x4:Kc,identity2:gs,identity3:yn,identity4:Me,multiply2x2:zh,multiply3x3:Vh,multiply4x4:It,multiplyScalar2x2:Uh,multiplyScalar3x3:kh,multiplyScalar4x4:Gh,orthographic4x4:rl,perspective4x4:nl,perspectiveFOVY4x4:gd,perspectiveFrustum4x4:Ea,project3As4ToScreen:_a,projectToScreen:il,rotation2x2:Zc,rotation4x4:Jc,rotation4x4by3:dd,scale4x4:el,scale4x4by3:fd,shearX2x2:td,shearX4x4:rd,shearY2x2:nd,shearY4x4:id,shearZ4x4:sd,subtract2x2:Qh,subtract3x3:Xh,subtract4x4:Yh,toString2x2:ld,toString3x3:ud,toString4x4:hd,transform2:ad,transform3:od,transform3as4:cd,transform4:vs,translation4x4:tl,translation4x4by3:pd,transpose2x2:Jh,transpose3x3:ms,transpose4x4:ed},Symbol.toStringTag,{value:"Module"}));function ol(t,e){return!t||!e?t===e:!Object.keys(Object.assign({},t,e)).find(n=>t[n]!==e[n])}const{min:wm,max:Tm,pow:bd,round:bm,sin:ws,PI:bi}=Math,Ts=bm(bi*1e3)/1e3;function pe(t,e,n){return wm(Tm(t,e),n)}var wn=(t=>(t[t.NONE=1]="NONE",t[t.CONTINUOUS=4]="CONTINUOUS",t[t.REPEAT=2]="REPEAT",t[t.REFLECT=3]="REFLECT",t))(wn||{});const Em=`
\${easingMethod} {
  return end;
}
`,_m=`
\${easingMethod} {
  return (end - start) * t + start;
}
`,Rm=`
\${easingMethod} {
  float time = t * t;
  return (end - start) * time + start;
}
`,Am=`
\${easingMethod} {
  float time = t * (2.0 - t);
  return (end - start) * time + start;
}
`,Sm=`
\${easingMethod} {
  float time = t < 0.5 ? 2.0 * t * t : -1.0 + (4.0 - 2.0 * t) * t;
  return (end - start) * time + start;
}
`,xm=`
\${easingMethod} {
  float time = t * t * t;
  return (end - start) * time + start;
}
`,Mm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = t1 * t1 * t1 + 1.0;
  return (end - start) * time + start;
}
`,Im=`
\${easingMethod} {
  float time = t < 0.5 ? 4.0 * t * t * t : (t - 1.0) * (2.0 * t - 2.0) * (2.0 * t - 2.0) + 1.0;
  return (end - start) * time + start;
}
`,Cm=`
\${easingMethod} {
  float time = t * t * t * t;
  return (end - start) * time + start;
}
`,Lm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = 1.0 - t1 * t1 * t1 * t1;
  return (end - start) * time + start;
}
`,Om=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = t < 0.5 ? 8.0 * t * t * t * t : 1.0 - 8.0 * t1 * t1 * t1 * t1;
  return (end - start) * time + start;
}
`,Nm=`
\${easingMethod} {
  float time = t * t * t * t * t;
  return (end - start) * time + start;
}
`,Pm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = 1.0 + t1 * t1 * t1 * t1 * t1;
  return (end - start) * time + start;
}
`,Dm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = t < 0.5 ? 16.0 * t * t * t * t * t : 1.0 + 16.0 * t1 * t1 * t1 * t1 * t1;
  return (end - start) * time + start;
}
`,Fm=`
\${easingMethod} {
  float p = 0.3;
  float time = pow(2.0, -10.0 * t) * sin((t - p / 4.0) * (2.0 * ${Ts}) / p) + 1.0;
  return (end - start) * time + start;
}
`,Bm=`
\${easingMethod} {
  float time = t * t * t - t * 1.05 * sin(t * ${Ts});
  return (end - start) * time + start;
}
`,Um=`
\${easingMethod} {
  float t1 = t - 1.0;
  float a = 1.7;
  float time = (t1 * t1 * ((a + 1.0) * t1 + a) + 1.0);
  return (end - start) * time + start;
}
`,km=`
\${easingMethod} {
  float a = 1.4;
  float a1 = a * 1.525;
  float t1 = t / 0.5;
  float t2 = t1 - 2.0;
  float time =
    (t1 < 1.0) ? 0.5 * (t1 * t1 * (a1 + 1.0) * t1 - a1) :
    0.5 * (t2 * t2 * ((a1 + 1.0) * t2 + a1) + 2.0)
  ;

  return (end - start) * time + start;
}
`,Gm=`
\${easingMethod} {
  \${T} direction = end - start;
  return start + direction * 0.5 + direction * sin(t * ${Ts} * 2.0) * 0.5;
}
`,zm=`
\${easingMethod} {
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - t, t),
    vec2(sin((1.0 - t) * omega) / sinom, sin(t * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Vm=`
\${easingMethod} {
  float time = t * t;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,$m=`
\${easingMethod} {
  float time = t * (2.0 - t);
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Wm=`
\${easingMethod} {
  float time = t < 0.5 ? 2.0 * t * t : -1.0 + (4.0 - 2.0 * t) * t;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,jm=`
\${easingMethod} {
  float time = t * t * t;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Hm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = t1 * t1 * t1 + 1.0;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Qm=`
\${easingMethod} {
  float time = t < 0.5 ? 4.0 * t * t * t : (t - 1.0) * (2.0 * t - 2.0) * (2.0 * t - 2.0) + 1.0;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Xm=`
\${easingMethod} {
  float time = t * t * t * t;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Ym=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = 1.0 - t1 * t1 * t1 * t1;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,qm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = t < 0.5 ? 8.0 * t * t * t * t : 1.0 - 8.0 * t1 * t1 * t1 * t1;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Km=`
\${easingMethod} {
  float time = t * t * t * t * t;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Zm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = 1.0 + t1 * t1 * t1 * t1 * t1;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,Jm=`
\${easingMethod} {
  float t1 = t - 1.0;
  float time = t < 0.5 ? 16.0 * t * t * t * t * t : 1.0 + 16.0 * t1 * t1 * t1 * t1 * t1;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,e0=`
\${easingMethod} {
  float p = 0.3;
  float time = pow(2.0, -10.0 * t) * sin((t - p / 4.0) * (2.0 * ${Ts}) / p) + 1.0;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,t0=`
\${easingMethod} {
  float time = t * t * t - t * 1.05 * sin(t * ${Ts});
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,n0=`
\${easingMethod} {
  float t1 = t - 1.0;
  float a = 1.7;
  float time = (t1 * t1 * ((a + 1.0) * t1 + a) + 1.0);
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`,r0=`
\${easingMethod} {
  float a = 1.4;
  float a1 = a * 1.525;
  float t1 = t / 0.5;
  float t2 = t1 - 2.0;
  float time =
    (t1 < 1.0) ? 0.5 * (t1 * t1 * (a1 + 1.0) * t1 - a1) :
    0.5 * (t2 * t2 * ((a1 + 1.0) * t2 + a1) + 2.0)
  ;
  float cosom = dot(start, end);
  \${T} end1 = mix(end, -end, float(cosom < 0.0));
  cosom = mix(cosom, -cosom, float(cosom < 0.0));

  float omega = acos(cosom);
  float sinom = sin(omega);

  vec2 scale = mix(
    vec2(1.0 - time, time),
    vec2(sin((1.0 - time) * omega) / sinom, sin(time * omega) / sinom),
    float(1.0 - cosom > 0.0000001)
  );

  return scale.x * start + scale.y * end1;
}
`;class Aa{constructor(e,n,r,i){this.uid=Y(),this.delay=0,this.duration=500,this.loop=1,this.cpu=e,this.gpu=n,this.duration=r||500,this.methodName=i||"easingMethod"}static immediate(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{const{copy:c}=Q(i);return c(s,o)},delay:n,duration:e,gpu:Em,loop:r,methodName:"immediate"}}static linear(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{const{add:c,scale:l,subtract:u}=Q(i);return a=pe(a,0,1),c(l(u(s,i),a),i,o)},delay:n,duration:e,gpu:_m,loop:r,methodName:"linear"}}static easeInQuad(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=a*a,{add:l,scale:u,subtract:h}=Q(i);return l(u(h(s,i),c),i,o)},delay:n,duration:e,gpu:Rm,loop:r,methodName:"easeInQuad"}}static easeOutQuad(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=a*(2-a),{add:l,scale:u,subtract:h}=Q(i);return l(u(h(s,i),c),i,o)},delay:n,duration:e,gpu:Am,loop:r,methodName:"easeOutQuad"}}static easeInOutQuad(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=a<.5?2*a*a:-1+(4-2*a)*a,{add:l,scale:u,subtract:h}=Q(i);return l(u(h(s,i),c),i,o)},delay:n,duration:e,gpu:Sm,loop:r,methodName:"easeInOutQuad"}}static easeInCubic(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=a*a*a,{add:l,scale:u,subtract:h}=Q(i);return l(u(h(s,i),c),i,o)},delay:n,duration:e,gpu:xm,loop:r,methodName:"easeInCubic"}}static easeOutCubic(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=--a*a*a+1,{add:l,scale:u,subtract:h}=Q(i);return l(u(h(s,i),c),i,o)},delay:n,duration:e,gpu:Mm,loop:r,methodName:"easeOutCubic"}}static easeInOutCubic(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=a<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1,{add:l,scale:u,subtract:h}=Q(i);return l(u(h(s,i),c),i,o)},delay:n,duration:e,gpu:Im,loop:r,methodName:"easeInOutCubic"}}static easeInQuart(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=a*a*a*a,{add:l,scale:u,subtract:h}=Q(i);return l(u(h(s,i),c),i,o)},delay:n,duration:e,gpu:Cm,loop:r,methodName:"easeInQuart"}}static easeOutQuart(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=1- --a*a*a*a,{add:l,scale:u,subtract:h}=Q(i);return l(u(h(s,i),c),i,o)},delay:n,duration:e,gpu:Lm,loop:r,methodName:"easeOutQuart"}}static easeInOutQuart(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=a<.5?8*a*a*a*a:1-8*--a*a*a*a,{add:l,scale:u,subtract:h}=Q(i);return l(u(h(s,i),c),i,o)},delay:n,duration:e,gpu:Om,loop:r,methodName:"easeInOutQuart"}}static easeInQuint(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=a*a*a*a*a,{add:l,scale:u,subtract:h}=Q(i);return l(u(h(s,i),c),i,o)},delay:n,duration:e,gpu:Nm,loop:r,methodName:"easeInQuint"}}static easeOutQuint(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=1+--a*a*a*a*a,{add:l,scale:u,subtract:h}=Q(i);return l(u(h(s,i),c),i,o)},delay:n,duration:e,gpu:Pm,loop:r,methodName:"easeOutQuint"}}static easeInOutQuint(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=a<.5?16*a*a*a*a*a:1+16*--a*a*a*a*a,{add:l,scale:u,subtract:h}=Q(i);return l(u(h(s,i),c),i,o)},delay:n,duration:e,gpu:Dm,loop:r,methodName:"easeInOutQuint"}}static easeOutElastic(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=.3,l=bd(2,-10*a)*ws((a-c/4)*(2*bi)/c)+1,{add:u,scale:h,subtract:f}=Q(i);return u(h(f(s,i),l),i,o)},delay:n,duration:e,gpu:Fm,loop:r,methodName:"easeOutElastic"}}static easeBackIn(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=1.05,l=a*a*a-a*c*ws(a*bi),{add:u,scale:h,subtract:f}=Q(i);return u(h(f(s,i),l),i,o)},delay:n,duration:e,gpu:Bm,loop:r,methodName:"easeBackIn"}}static easeBackOut(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const c=1.7,l=a-1,u=l*l*((c+1)*l+c)+1,{add:h,scale:f,subtract:p}=Q(i);return h(f(p(s,i),u),i,o)},delay:n,duration:e,gpu:Um,loop:r,methodName:"easeBackOut"}}static easeBackInOut(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{a=pe(a,0,1);const l=1.7*1.525,u=a/.5,h=u-2,f=u<1?.5*(u*u*(l+1)*u-l):.5*(h*h*((l+1)*h+l)+2),{add:p,scale:m,subtract:v}=Q(i);return p(m(v(s,i),f),i,o)},delay:n,duration:e,gpu:km,loop:r,methodName:"easeBackInOut"}}static continuousSinusoidal(e,n=0,r=4){return{uid:Y(),cpu:(i,s,a,o)=>{const{add:c,scale:l,subtract:u}=Q(i);a=pe(a,0,1);const h=u(s,i),f=l(h,.5);return c(c(i,f),l(f,ws(a*bi*2)*1),o)},delay:n,duration:e,gpu:Gm,loop:r,methodName:"repeatingSinusoidal",validation:{ignoreEndValueCheck:!0,ignoreOverTimeCheck:!0}}}static slerpQuatLinear(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:u}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),u(1,0,0,0)}a=pe(a,0,1);const{slerpQuat:c,vec:l}=Q(i);return c?c(i,s,a,o):l(1,0,0,0)},delay:n,duration:e,gpu:zm,loop:r,methodName:"slerpQuatLinear"}}static slerpQuatInQuad(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:h}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=pe(a,0,1);const c=a*a,{slerpQuat:l,vec:u}=Q(i);return l?l(i,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Vm,loop:r,methodName:"slerpQuatInQuad"}}static slerpQuatOutQuad(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:h}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=pe(a,0,1);const c=a*(2-a),{slerpQuat:l,vec:u}=Q(i);return l?l(i,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:$m,loop:r,methodName:"slerpQuatOutQuad"}}static slerpQuatInOutQuad(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:h}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=pe(a,0,1);const c=a<.5?2*a*a:-1+(4-2*a)*a,{slerpQuat:l,vec:u}=Q(i);return l?l(i,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Wm,loop:r,methodName:"slerpQuatInOutQuad"}}static slerpQuatInCubic(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:h}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=pe(a,0,1);const c=a*a*a,{slerpQuat:l,vec:u}=Q(i);return l?l(i,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:jm,loop:r,methodName:"slerpQuatInCubic"}}static slerpQuatOutCubic(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:h}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=pe(a,0,1);const c=--a*a*a+1,{slerpQuat:l,vec:u}=Q(i);return l?l(i,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Hm,loop:r,methodName:"slerpQuatOutCubic"}}static slerpQuatInOutCubic(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:h}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=pe(a,0,1);const c=a<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1,{slerpQuat:l,vec:u}=Q(i);return l?l(i,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Qm,loop:r,methodName:"slerpQuatInOutCubic"}}static slerpQuatInQuart(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:h}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=pe(a,0,1);const c=a*a*a*a,{slerpQuat:l,vec:u}=Q(i);return l?l(i,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Xm,loop:r,methodName:"slerpQuatInQuart"}}static slerpQuatOutQuart(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:h}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=pe(a,0,1);const c=1- --a*a*a*a,{slerpQuat:l,vec:u}=Q(i);return l?l(i,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Ym,loop:r,methodName:"slerpQuatOutQuart"}}static slerpQuatInOutQuart(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:h}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=pe(a,0,1);const c=a<.5?8*a*a*a*a:1-8*--a*a*a*a,{slerpQuat:l,vec:u}=Q(i);return l?l(i,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:qm,loop:r,methodName:"slerpQuatInOutQuart"}}static slerpQuatInQuint(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:h}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=pe(a,0,1);const c=a*a*a*a*a,{slerpQuat:l,vec:u}=Q(i);return l?l(i,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Km,loop:r,methodName:"slerpQuatInQuint"}}static slerpQuatOutQuint(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:h}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=pe(a,0,1);const c=1+--a*a*a*a*a,{slerpQuat:l,vec:u}=Q(i);return l?l(i,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Zm,loop:r,methodName:"slerpQuatOutQuint"}}static slerpQuatInOutQuint(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:h}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),h(1,0,0,0)}a=pe(a,0,1);const c=a<.5?16*a*a*a*a*a:1+16*--a*a*a*a*a,{slerpQuat:l,vec:u}=Q(i);return l?l(i,s,c,o):u(1,0,0,0)},delay:n,duration:e,gpu:Jm,loop:r,methodName:"slerpQuatInOutQuint"}}static slerpQuatOutElastic(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:f}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),f(1,0,0,0)}a=pe(a,0,1);const c=.3,l=bd(2,-10*a)*ws((a-c/4)*(2*bi)/c)+1,{slerpQuat:u,vec:h}=Q(i);return u?u(i,s,l,o):h(1,0,0,0)},delay:n,duration:e,gpu:e0,loop:r,methodName:"slerpQuatOutElastic"}}static slerpQuatBackIn(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:f}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),f(1,0,0,0)}a=pe(a,0,1);const c=1.05,l=a*a*a-a*c*ws(a*bi),{slerpQuat:u,vec:h}=Q(i);return u?u(i,s,l,o):h(1,0,0,0)},delay:n,duration:e,gpu:t0,loop:r,methodName:"slerpQuatBackIn"}}static slerpQuatBackOut(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:p}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),p(1,0,0,0)}a=pe(a,0,1);const c=1.7,l=a-1,u=l*l*((c+1)*l+c)+1,{slerpQuat:h,vec:f}=Q(i);return h?h(i,s,u,o):f(1,0,0,0)},delay:n,duration:e,gpu:n0,loop:r,methodName:"slerpQuatBackOut"}}static slerpQuatBackInOut(e,n=0,r=1){return{uid:Y(),cpu:(i,s,a,o)=>{if(!X(i)||!X(s)||!X(o)){const{vec:v}=Q(s);return console.warn("SLERP QUAT AutoEasingMethod was specified on a non Vec4/Quaternion type which is invalid. This AutoEasingMethod will ONLY work on tuples that have 4 or more elements."),v(1,0,0,0)}a=pe(a,0,1);const l=1.7*1.525,u=a/.5,h=u-2,f=u<1?.5*(u*u*(l+1)*u-l):.5*(h*h*((l+1)*h+l)+2),{slerpQuat:p,vec:m}=Q(i);return p?p(i,s,f,o):m(1,0,0,0)},delay:n,duration:e,gpu:r0,loop:r,methodName:"slerpQuatBackInOut"}}}const{cos:bs,sin:mr,sqrt:Ct,exp:Ed,acos:cl,atan2:_d,PI:Rd}=Math;let Et,Tn,bn,En,tt,ut,Ei,_n,_t,Ke,_i,Sa,xa,vr,H,Gt,Ma,Ri;const Ad=Ge(),Sd=Ge(),xd=Ge(),Md=Ge(),Id=1,Cd=2,Ld=3,Od=0;function Rt(t,e,n){return t>n?n:t<e?e:t}function Ge(t){return t?(t[0]=0,t[1]=0,t[2]=0,t[3]=0,t):[0,0,0,0]}function Nd(t,e,n){return n=n||Ge(),n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n[3]=t[3]+e[3],n}function ll(t,e,n){n=n||Ge();const r=t[0],i=e[0],s=t[1],a=e[1],o=t[2],c=e[2],l=t[3],u=e[3];return n[0]=r*i-s*a-o*c-l*u,n[1]=r*a+s*i+o*u-l*c,n[2]=r*c-s*u+o*i+l*a,n[3]=r*u+s*c-o*a+l*i,n}function Pd(t,e,n){n=n||Ge();const r=t[0],i=t[1],s=t[2],a=t[3],o=e[0],c=e[1],l=e[2],u=e[3],h=o*o+c*c+l*l+u*u;if(h===0)n[0]=0,n[1]=0,n[2]=0,n[3]=0;else{const f=1/h;n[0]=(r*o+i*c+s*l+a*u)*f,n[1]=(i*o-r*c-s*u+a*l)*f,n[2]=(s*o-r*l-a*c+i*u)*f,n[3]=(a*o-r*u-i*l+s*c)*f}return n}function Dd(t,e){e=e||Ge();const n=t[0],r=t[1],i=t[2],s=t[3],a=Ct(r*r+i*i+s*s),o=Ed(n),c=o/a*mr(a);return a===0?(e[0]=Ed(n),e[1]=0,e[2]=0,e[3]=0):(e[0]=o*bs(a),e[1]=r*c,e[2]=i*c,e[3]=s*c),e}function ul(t,e,n){return n=n||Ge(),n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}function Fd(t,e,n){return n=n||Ge(),ll(e,hl(t),n)}function hl(t,e){return e=e||Ge(),e[0]=t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Bd(t,e){e=e||Ge();const n=t[0],r=t[1],i=t[2],s=t[3],a=n*n+r*r+i*i+s*s;if(a===0)e[0]=0,e[1]=0,e[2]=0,e[3]=0;else{const o=1/a;e[0]=n*o,e[1]=-r*o,e[2]=-i*o,e[3]=-s*o}return e}function dl(t){const e=t[0],n=t[1],r=t[2],i=t[3];return Ct(e*e+n*n+r*r+i*i)}function Ud(t,e){e=e||Ge();const n=dl(t);if(n===0)return[0,0,0,0];const r=1/n;return ul(t,r,e)}function kd(t){return t[0]}function Gd(t){return[t[1],t[2],t[3]]}function zd(t,e){return oa(t,e)}function Vd(t,e,n){n=n||Ge();const r=t[0],i=t[1],s=t[2],a=1/Ct(r*r+i*i+s*s),o=mr(e/2);return n[0]=bs(e/2),n[1]=o*r*a,n[2]=o*i*a,n[3]=o*s*a,n}function fl(t,e,n){n=n||Ge();const r=t[0],i=t[1],s=t[2],a=Math.cos,o=Math.sin,c=a(r/2),l=a(i/2),u=a(s/2),h=o(r/2),f=o(i/2),p=o(s/2);switch(e){case _e.xyz:n[1]=h*l*u+c*f*p,n[2]=c*f*u-h*l*p,n[3]=c*l*p+h*f*u,n[0]=c*l*u-h*f*p;break;case _e.yxz:n[0]=c*l*u+h*f*p,n[1]=h*l*u+c*f*p,n[2]=c*f*u-h*l*p,n[3]=c*l*p-h*f*u;break;case _e.zxy:n[0]=c*l*u-h*f*p,n[1]=h*l*u-c*f*p,n[2]=c*f*u+h*l*p,n[3]=c*l*p+h*f*u;break;case _e.zyx:n[0]=c*l*u+h*f*p,n[1]=h*l*u-c*f*p,n[2]=c*f*u+h*l*p,n[3]=c*l*p-h*f*u;break;case _e.yzx:n[0]=c*l*u-h*f*p,n[1]=h*l*u+c*f*p,n[2]=c*f*u+h*l*p,n[3]=c*l*p-h*f*u;break;case _e.xzy:n[0]=c*l*u+h*f*p,n[1]=h*l*u-c*f*p,n[2]=c*f*u-h*l*p,n[3]=c*l*p+h*f*u;break}return n}function $d(t,e,n){n=n||[0,0,0];const r=fl(t,e);return Ia(r,_e.xyz,n),n}function Ai(t,e,n,r,i,s){s[0]=_d(t,e),s[1]=cl(n),s[2]=_d(r,i)}function Wd(t,e){return Ia(t,_e.zyx,e)}function Ia(t,e,n){n=n||[0,0,0];const r=t[0],i=t[1],s=t[2],a=t[3],o=La(t),c=o[0],l=o[4],u=o[8],h=o[1],f=o[5],p=o[9],m=o[2],v=o[6],b=o[10];switch(e){case _e.zyx:n[1]=Math.asin(-Rt(m,-1,1)),Math.abs(m)<.99999?(n[0]=Math.atan2(v,b),n[2]=Math.atan2(h,c)):(n[0]=0,n[2]=Math.atan2(-l,f));break;case _e.zyz:Ai(2*s*a+2*r*i,2*r*s-2*i*a,a*a-s*s-i*i+r*r,2*s*a-2*r*i,2*i*a+2*r*s,n);break;case _e.zxy:n[0]=Math.asin(Rt(v,-1,1)),Math.abs(v)<.99999?(n[1]=Math.atan2(-m,b),n[2]=Math.atan2(-l,f)):(n[1]=0,n[2]=Math.atan2(h,c));break;case _e.zxz:Ai(2*i*a-2*r*s,2*s*a+2*r*i,a*a-s*s-i*i+r*r,2*i*a+2*r*s,2*r*i-2*s*a,n);break;case _e.yxz:n[0]=Math.asin(-Rt(p,-1,1)),Math.abs(p)<.9999?(n[1]=Math.atan2(u,b),n[2]=Math.atan2(h,f)):(n[1]=Math.atan2(-m,c),n[2]=0);break;case _e.yxy:Ai(2*i*s+2*r*a,2*r*i-2*s*a,s*s-a*a+r*r-i*i,2*i*s-2*r*a,2*s*a+2*r*i,n);break;case _e.yzx:n[2]=Math.asin(Rt(h,-1,1)),Math.abs(h)<.99999?(n[0]=Math.atan2(-p,f),n[1]=Math.atan2(-m,c)):(n[0]=0,n[1]=Math.atan2(u,b));break;case _e.yzy:Ai(2*s*a-2*r*i,2*i*s+2*r*a,s*s-a*a+r*r-i*i,2*s*a+2*r*i,2*r*a-2*i*s,n);break;case _e.xyz:n[1]=Math.asin(Rt(u,-1,1)),Math.abs(u)<.99999?(n[0]=Math.atan2(-p,b),n[2]=Math.atan2(-l,c)):(n[0]=Math.atan2(v,f),n[2]=0);break;case _e.xyx:Ai(2*i*s-2*r*a,2*i*a+2*r*s,i*i+r*r-a*a-s*s,2*i*s+2*r*a,2*r*s-2*i*a,n);break;case _e.xzy:n[2]=Math.asin(-Rt(l,-1,1)),Math.abs(l)<.99999?(n[0]=Math.atan2(v,f),n[1]=Math.atan2(u,c)):(n[0]=Math.atan2(-p,b),n[1]=0);break;case _e.xzx:Ai(2*i*a+2*r*s,2*r*a-2*i*s,i*i+r*r-a*a-s*s,2*i*a-2*r*s,2*i*s+2*r*a,n);break;default:console.warn("Invalid Euler rotation order.");break}return n}function jd(t,e,n){n=n||[0,0,0];const r=La(t),i=r[0],s=r[4],a=r[8],o=r[1],c=r[5],l=r[9],u=r[2],h=r[6],f=r[10];switch(e){case _e.xyz:n[1]=Math.asin(Rt(a,-1,1)),Math.abs(a)<.99999?(n[0]=Math.atan2(-l,f),n[2]=Math.atan2(-s,i)):(n[0]=Math.atan2(h,c),n[2]=0);break;case _e.yxz:n[0]=Math.asin(-Rt(l,-1,1)),Math.abs(l)<.9999?(n[1]=Math.atan2(a,f),n[2]=Math.atan2(o,c)):(n[1]=Math.atan2(-u,i),n[2]=0);break;case _e.zxy:n[0]=Math.asin(Rt(h,-1,1)),Math.abs(h)<.99999?(n[1]=Math.atan2(-u,f),n[2]=Math.atan2(-s,c)):(n[1]=0,n[2]=Math.atan2(o,i));break;case _e.zyx:n[1]=Math.asin(-Rt(u,-1,1)),Math.abs(u)<.99999?(n[0]=Math.atan2(h,f),n[2]=Math.atan2(o,i)):(n[0]=0,n[2]=Math.atan2(-s,c));break;case _e.yzx:n[2]=Math.asin(Rt(o,-1,1)),Math.abs(o)<.99999?(n[0]=Math.atan2(-l,c),n[1]=Math.atan2(-u,i)):(n[0]=0,n[1]=Math.atan2(a,f));break;case _e.xzy:n[2]=Math.asin(-Rt(s,-1,1)),Math.abs(s)<.99999?(n[0]=Math.atan2(h,c),n[1]=Math.atan2(a,i)):(n[0]=Math.atan2(-l,f),n[1]=0);break}}function Hd(t){const e=t[0];if(e<-1||e>1)return 0;const n=2*cl(e);return n>Rd?n-2*Rd:n}function Qd(t){const e=t[1],n=t[2],r=t[3];if(Ct(e*e+n*n+r*r)===0)return[0,0,0];const s=1/Ct(e*e+n*n+r*r);return[e*s,n*s,r*s]}function Ca(t,e){e=e||yn();const n=t[1]+t[1],r=t[2]+t[2],i=t[3]+t[3],s=t[1]*n,a=t[1]*r,o=t[1]*i,c=t[2]*r,l=t[2]*i,u=t[3]*i,h=t[0]*n,f=t[0]*r,p=t[0]*i;return e[as]=1-(c+u),e[os]=a-p,e[cs]=o+f,e[ls]=a+p,e[us]=1-(s+u),e[hs]=l-h,e[ds]=o-f,e[fs]=l+h,e[ps]=1-(s+c),e}function Xd(t,e){e=e||Me();const n=t[1]+t[1],r=t[2]+t[2],i=t[3]+t[3],s=t[1]*n,a=t[1]*r,o=t[1]*i,c=t[2]*r,l=t[2]*i,u=t[3]*i,h=t[0]*n,f=t[0]*r,p=t[0]*i;return e[tn]=1-(c+u),e[nn]=a-p,e[rn]=o+f,e[sn]=0,e[an]=a+p,e[on]=1-(s+u),e[cn]=l-h,e[ln]=0,e[un]=o-f,e[hn]=l+h,e[dn]=1-(s+c),e[fn]=0,e[pn]=0,e[gn]=0,e[mn]=0,e[vn]=1,e}function Yd(t,e){e=e||yn();const n=t[1]+t[1],r=t[2]+t[2],i=t[3]+t[3],s=t[1]*n,a=t[1]*r,o=t[1]*i,c=t[2]*r,l=t[2]*i,u=t[3]*i,h=t[0]*n,f=t[0]*r,p=t[0]*i;return e[as]=1-(c+u),e[ls]=a-p,e[ds]=o+f,e[os]=a+p,e[us]=1-(s+u),e[fs]=l-h,e[cs]=o-f,e[hs]=l+h,e[ps]=1-(s+c),e}function La(t,e){e=e||Me();const n=t[1]+t[1],r=t[2]+t[2],i=t[3]+t[3],s=t[1]*n,a=t[1]*r,o=t[1]*i,c=t[2]*r,l=t[2]*i,u=t[3]*i,h=t[0]*n,f=t[0]*r,p=t[0]*i;return e[tn]=1-(c+u),e[an]=a-p,e[un]=o+f,e[pn]=0,e[nn]=a+p,e[on]=1-(s+u),e[hn]=l-h,e[gn]=0,e[rn]=o-f,e[cn]=l+h,e[dn]=1-(s+c),e[mn]=0,e[sn]=0,e[ln]=0,e[fn]=0,e[vn]=1,e}function qd(t,e){e=e||Ge();const[n,r,i]=t,s=bs(n/2),a=bs(r/2),o=bs(i/2),c=mr(n/2),l=mr(r/2),u=mr(i/2),h=a*o,f=l*u,p=a*u,m=l*o;return e[0]=s*h+c*f,e[1]=c*h-s*f,e[2]=s*m+c*p,e[3]=s*p-c*m,e}function pl(t,e,n){return n=n||Ge(),Ri=Nt([-t[0],-t[1],-t[2]],gt[gt.length-1]),Gt=Nt(wt(e,Ri,gt[gt.length-2])),Ma=wt(Ri,Gt,gt[gt.length-3]),tt=Gt[0],ut=Ma[0],Ei=Ri[0],_t=Gt[1],Ke=Ma[1],_i=Ri[1],Sa=Gt[2],xa=Ma[2],vr=Ri[2],H=(1+tt+Ke+vr)*.25,H>0?(H=Math.sqrt(H),n[0]=H,H=1/(4*H),n[1]=(_i-xa)*H,n[2]=(Sa-Ei)*H,n[3]=(ut-_t)*H):(n[0]=0,H=-.5*(Ke+vr),H>0?(H=Math.sqrt(H),n[1]=H,H*=2,n[2]=ut/H,n[3]=Ei/H):(n[1]=0,H=.5*(1-vr),H>0?(H=Math.sqrt(H),n[2]=H,n[3]=_i/(2*H)):(n[2]=0,n[3]=1))),n}function Kd(t,e){if(e=e||Ge(),Et=t[0],Tn=t[3],bn=t[6],En=t[1],tt=t[4],ut=t[7],_n=t[2],_t=t[5],Ke=t[8],H=Et+tt+Ke,H>0){const r=Ct(H+1)*2;return e[0]=.25*r,e[1]=(_t-ut)/r,e[2]=(bn-_n)/r,e[3]=(En-Tn)/r,e}if(Et>tt&&Et>Ke){const r=Ct(1+Et-tt-Ke)*2;return e[0]=(_t-ut)/r,e[1]=.25*r,e[2]=(Tn+En)/r,e[3]=(bn+_n)/r,e}if(tt>Ke){const r=Ct(1+tt-Et-Ke)*2;return e[0]=(bn-_n)/r,e[1]=(En+Tn)/r,e[2]=.25*r,e[3]=(_t+ut)/r,e}const n=Ct(1+Ke-Et-tt)*2;return e[0]=(En-Tn)/n,e[1]=(_n+bn)/n,e[2]=(_t+ut)/n,e[3]=.25*n,e}function Zd(t,e){if(e=e||Ge(),Et=t[0],Tn=t[4],bn=t[8],En=t[1],tt=t[5],ut=t[9],_n=t[2],_t=t[6],Ke=t[10],H=Et+tt+Ke,H>0){const r=Ct(H+1)*2;return e[0]=.25*r,e[1]=(_t-ut)/r,e[2]=(bn-_n)/r,e[3]=(En-Tn)/r,e}if(Et>tt&&Et>Ke){const r=Ct(1+Et-tt-Ke)*2;return e[0]=(_t-ut)/r,e[1]=.25*r,e[2]=(Tn+En)/r,e[3]=(bn+_n)/r,e}if(tt>Ke){const r=Ct(1+tt-Et-Ke)*2;return e[0]=(bn-_n)/r,e[1]=(En+Tn)/r,e[2]=.25*r,e[3]=(_t+ut)/r,e}const n=Ct(1+Ke-Et-tt)*2;return e[0]=(En-Tn)/n,e[1]=(_n+bn)/n,e[2]=(_t+ut)/n,e[3]=.25*n,e}function Oa(t,e,n,r,i){return i=i||Ge(),tt=t[0]/e,ut=t[4]/n,Ei=t[8]/r,_t=t[1]/e,Ke=t[5]/n,_i=t[9]/r,Sa=t[2]/e,xa=t[6]/n,vr=t[10]/r,H=(1+tt+Ke+vr)*.25,H>0?(H=Math.sqrt(H),i[0]=H,H=1/(4*H),i[1]=(_i-xa)*H,i[2]=(Sa-Ei)*H,i[3]=(ut-_t)*H):(i[0]=0,H=-.5*(Ke+vr),H>0?(H=Math.sqrt(H),i[1]=H,H*=2,i[2]=ut/H,i[3]=Ei/H):(i[1]=0,H=.5*(1-vr),H>0?(H=Math.sqrt(H),i[2]=H,i[3]=_i/(2*H)):(i[2]=0,i[3]=1))),i}function Jd(t,e,n){n=n||Me();const r=Nt([-t[0],-t[1],-t[2]]),i=Nt(wt(e,r)),s=wt(r,i);return n[0]=i[0],n[1]=s[0],n[2]=r[0],n[3]=0,n[4]=i[1],n[5]=s[1],n[6]=r[1],n[7]=0,n[8]=i[2],n[9]=s[2],n[10]=r[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Na(t,e,n){return Gt=cr(e[1],e[2],e[3]),H=e[0],Yt(Yt(Mt(Gt,2*qi(Gt,t)),Mt(t,H*H-qi(Gt,Gt))),Mt(wt(Gt,t),2*H),n)}function ef(t,e,n,r){r=r||Ge();const i=[0,0,0,0];let s,a,o,c,l;return a=t[1]*e[1]+t[2]*e[2]+t[3]*e[3]+t[0]*e[0],a<0?(a=-a,i[0]=-e[1],i[1]=-e[2],i[2]=-e[3],i[3]=-e[0]):(i[0]=e[1],i[1]=e[2],i[2]=e[3],i[3]=e[0]),1-a>1e-7?(s=cl(a),o=mr(s),c=mr((1-n)*s)/o,l=mr(n*s)/o):(c=1-n,l=n),r[1]=c*t[1]+l*i[0],r[2]=c*t[2]+l*i[1],r[3]=c*t[3]+l*i[2],r[0]=c*t[0]+l*i[3],r}function Es(){return[1,0,0,0]}function tf(){return[0,1,0,0]}function nf(){return[0,0,1,0]}function rf(){return[0,0,0,1]}const i0=Object.freeze(Object.defineProperty({__proto__:null,QR1:Ad,QR2:Sd,QR3:xd,QR4:Md,QW:Od,QX:Id,QY:Cd,QZ:Ld,addQuat:Nd,angleQuat:Hd,axisQuat:Qd,clamp:Rt,conjugateQuat:hl,decomposeRotation:Oa,diffUnitQuat:Fd,divideQuat:Pd,dotQuat:zd,eulerToQuat:qd,exponentQuat:Dd,fromEulerAxisAngleToQuat:Vd,fromOrderedEulerToQuat:fl,iQuat:tf,imaginaryQuat:Gd,inverseQuat:Bd,jQuat:nf,kQuat:rf,lengthQuat:dl,lookAtMatrix:Jd,lookAtQuat:pl,matrix3x3FromUnitQuatModel:Ca,matrix3x3FromUnitQuatView:Yd,matrix3x3ToQuaternion:Kd,matrix4x4FromUnitQuatModel:Xd,matrix4x4FromUnitQuatView:La,matrix4x4ToQuaternion:Zd,multiplyQuat:ll,normalizeQuat:Ud,oneQuat:Es,realQuat:kd,rotateVectorByUnitQuat:Na,scaleQuat:ul,slerpUnitQuat:ef,toEulerFromQuat:Wd,toEulerXYZfromOrderedEuler:$d,toOrderedEulerFromQuat:Ia,toOrderedEulerFromQuat2:jd,zeroQuat:Ge},Symbol.toStringTag,{value:"Module"}));function gl(t,e){return[t,e]}function sf(t,e,n){return n=n||[0,0,0],Yt(t[0],Mt(t[1],e),n)}function ml(t,e,n){return n=n||[[0,0,0],[0,0,0]],xt(t,n[0]),Nt(qt(e,t),n[1]),n}const s0=Object.freeze(Object.defineProperty({__proto__:null,ray:gl,rayFromPoints:ml,rayToLocation:sf},Symbol.toStringTag,{value:"Module"})),a0=ym,o0=i0,c0=s0,l0=Vg;let ht=class{constructor(){this.promise=new Promise((e,n)=>(this.resolver=e,this.rejector=n))}resolve(e){this.resolver(e)}reject(e){this.rejector(e)}},zt=-1,Pa=0,Da=[],_s=[],Rs=[];const Si=new Map,xi=t=>{Pa=t;let e=!1;const n=[];Si.forEach((i,s)=>{e=!0;let[a,o,c,l,u]=i;if(l!==-1&&(u===-1&&(u=t,i[4]=t),t-u>=l)){n.push(s),a(t,u+l);return}if(o!==-1){if(c===-1&&(i[2]=t,c=t),t-c>=o)for(a(t);t-c>=o;)i[2]+=o,c+=o}else a(t)});for(let i=0,s=n.length;i<s;++i){const a=n[i];Si.delete(a)}const r=_s.slice();_s=[];for(let i=0,s=r.length;i<s;++i){const[a,o,c]=r[i];o<=0?a&&a(t):t-c>o?a(t):(e=!0,_s.push(r[i]))}for(let i=0,s=Rs.length;i<s;++i){const a=Rs[i];a&&(e=!0,a(t))}Rs=Da.slice(0),Da=[],Rs.length>0&&(e=!0),e?zt=requestAnimationFrame(xi):zt=-1};zt=requestAnimationFrame(xi);function As(t){const e=new ht;return Da.push(n=>{t&&t(n),e.resolve(n)}),zt===-1&&(zt=requestAnimationFrame(xi)),e.promise}function jn(t,e){const n=new ht,r=i=>{t&&t(i),n.resolve(i)};return _s.push([r,e||-1,Pa]),zt===-1&&(zt=requestAnimationFrame(xi)),n.promise}function vl(t,e,n){const r=new ht,i=(s,a)=>{t(s),n!==void 0&&n>0?a!==void 0&&r.resolve(a):r.resolve(s)};return Si.set(r.promise,[i,e||-1,-1,n||-1,-1]),zt===-1&&(zt=requestAnimationFrame(xi)),r.promise}function af(t){Si.delete(t),zt===-1&&(zt=requestAnimationFrame(xi))}function u0(){Si.forEach(t=>t[0](Pa,Pa)),Si.clear(),_s=[],Da=[],Rs=[]}const Qr=new Set,yl=Qr.add.bind(Qr),wl=Qr.delete.bind(Qr),of=async()=>{await vl(()=>{Qr.size!==0&&(Qr.forEach(t=>t.update()),Qr.clear())},void 0,Number.POSITIVE_INFINITY),of()};of();class Tl{constructor(){this._children=[],this._needsUpdate=!1,this._childUpdate=new Set}get parent(){return this._parent}set parent(e){this.setParent(e)}get children(){return this._children}get needsUpdate(){return this._needsUpdate}get childUpdate(){return this._childUpdate}addChild(e,n){e.parent!==this&&(n||e.setParent(this,!0),this._children.push(e),this._childUpdate.add(e),e.invalidate())}invalidate(){if(this._needsUpdate)return!1;this._needsUpdate=!0;for(let e=0,n=this._children.length;e<n;++e){const r=this._children[e];this._childUpdate.add(r),r.invalidate()}return!0}processParentUpdates(e){if(!this._parent||!this._parent._needsUpdate)return;const n=[];let r=this._parent;for(;r&&(n.push(r),r._parent&&r._parent.needsUpdate);)r=r._parent;for(let i=n.length-1;i>=0;--i){const s=n[i];e(s),s.resolve()}}removeChild(e,n){e._parent===this&&(e._parent!==void 0&&!n&&e.setParent(void 0,!0),this._children.splice(this._children.indexOf(e),1),this._childUpdate.delete(e))}resolve(){this._needsUpdate&&(this._needsUpdate=!1,this._parent&&this._parent._childUpdate.delete(this))}setParent(e,n){this._parent!==e&&(n||(e!==void 0&&e.addChild(this,!0),this._parent&&this._parent.removeChild(this,!0)),this._parent=e,this.invalidate())}}class Fa extends Tl{constructor(e){super(),this.isQueuedForUpdate=!1,this.needsWorldOrientation=!1,this.needsWorldDecomposition=!1,this.hasViewMatrix=!1,this._instance=null,this._matrix={value:Me()},this._localMatrix={value:this._matrix.value},this._rotation={value:Es()},this._localRotation={value:this._rotation.value},this.localRotationMatrix=yn(),this._scale={value:[1,1,1]},this._localScale={value:this._scale.value},this._position={value:[0,0,0]},this._localPosition={value:this._position.value},this._forward={value:kr()},this._localForward={value:this._forward.value},this.needsForwardUpdate=!1,e&&(e.localPosition&&(this.localPosition=e.localPosition),e.localRotation&&(this.localRotation=e.localRotation),e.localScale&&(this.localScale=e.localScale),e.parent&&(this.parent=e.parent))}set instance(e){this._instance!==e&&this._instance&&(this._instance.transform.instance=null,e&&(e.transform=this)),this._instance=e}get matrix(){return this.update(),this._matrix.value}get localMatrix(){return this.update(),this._localMatrix.value}get viewMatrix(){return this.hasViewMatrix=!0,this._viewMatrix===void 0&&this.invalidate(),this.update(),this._viewMatrix===void 0?Me():this._viewMatrix.value}get localViewMatrix(){return this.hasViewMatrix=!0,this._localViewMatrix===void 0&&this.invalidate(),this.update(),this._localViewMatrix===void 0?Me():this._localViewMatrix.value}get localTransform(){var e;return(e=this._localTransform)==null?void 0:e.value}set localTransform(e){e?(this._localTransform||(this._localTransform={value:Me()}),Ti(e,this._localTransform.value),this._localTransform.didUpdate=!0):delete this._localTransform,this.invalidate()}get localViewTransform(){var e;return(e=this._localViewTransform)==null?void 0:e.value}set localViewTransform(e){e?(this._localViewTransform||(this._localViewTransform={value:Me()}),Ti(e,this._localViewTransform.value),this._localViewTransform.didUpdate=!0):delete this._localViewTransform,this.invalidate()}get rotation(){return this.needsWorldOrientation=!0,this.update(),this._rotation.value}set rotation(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world rotation when a parent is present is not supported yet. Use localRotation for now."):this.localRotation=e}get localRotation(){return this._localRotation.value}set localRotation(e){Le(this._localRotation.value,e[0],e[1],e[2],e[3]),this._localRotation.didUpdate=!0,this.invalidate(),this.needsForwardUpdate=!0}get scale(){return this.needsWorldOrientation=!0,this.update(),this._scale.value}set scale(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world scale is not supported yet. Use localScale for now."):this.localScale=e}get localScale(){return this._localScale.value}set localScale(e){Ne(this._localScale.value,e[0],e[1],e[2]),this._localScale.didUpdate=!0,this.invalidate()}get position(){return this.needsWorldOrientation=!0,this.update(),this._position.value}set position(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world position is not supported yet. Use localPosition for now."):this.localPosition=e}get localPosition(){return this._localPosition.value}set localPosition(e){this._localPosition.value[0]=e[0],this._localPosition.value[1]=e[1],this._localPosition.value[2]=e[2],this._localPosition.didUpdate=!0,this.invalidate()}get forward(){var e;return(this.needsForwardUpdate||(e=this.parent)!=null&&e.childUpdate.has(this))&&(this.needsForwardUpdate=!1,Na(kr(),this._rotation.value,this._forward.value)),this._forward.value}get localForward(){return this.needsForwardUpdate&&(this.needsForwardUpdate=!1,Na(kr(),this._localRotation.value,this._localForward.value)),this._localForward.value}applyLocalSRT(e,n,r){this._localScale.value=e,this._localPosition.value=r,this._localRotation.value=n,this._localScale.didUpdate=!0,this._localPosition.didUpdate=!0,this._localRotation.didUpdate=!0,this.invalidate(),this._instance&&(this._instance.transform=this)}decomposeWorldMatrix(){if(!this.needsWorldDecomposition||!this.parent||!this._matrix.didUpdate||this._matrix.value===this._localMatrix.value)return;if(this._instance){if(!this._instance.needsWorldUpdate||!this.needsWorldOrientation)return}else if(!this.needsWorldOrientation)return;this.needsWorldDecomposition=!1;const e=this._matrix.value,n=this._position.value,r=this._scale.value;this._position.didUpdate=n[0]!==e[12]||n[1]!==e[13]||n[2]!==e[14],this._position.didUpdate&&Ne(n,e[12],e[13],e[14]);const i=Gn(e[0],e[1],e[2],e[3]),s=Gn(e[4],e[5],e[6],e[7]),a=Gn(e[8],e[9],e[10],e[11]);this._scale.didUpdate=r[0]!==i||r[1]!==s||r[2]!==a,Ne(r,i,s,a),this._scale.didUpdate=!0;const[o,c,l,u]=this._rotation.value;Oa(this._matrix.value,i,s,a,this._rotation.value);const h=this._rotation.value;this._rotation.didUpdate=h[0]!==o||h[1]!==c||h[2]!==l||h[3]!==u}lookAtLocal(e,n){pl(qt(e,this._localPosition.value,gt[0]),n||[0,1,0],this._localRotation.value),this._localRotation.didUpdate=!0,this.invalidate(),this.needsForwardUpdate=!0}divideMemory(){this._forward.value=kr(),this._matrix.value=Me(),this._rotation.value=Es(),this._scale.value=[1,1,1],this._position.value=[0,0,0],this.hasViewMatrix&&this._viewMatrix&&this._localViewMatrix&&(this._viewMatrix.value=Me())}mergeMemory(){this._forward.value=this._localForward.value,this._matrix.value=this._localMatrix.value,this._rotation.value=this._localRotation.value,this._scale.value=this._localScale.value,this._position.value=this._localPosition.value,this.hasViewMatrix&&this._viewMatrix&&this._localViewMatrix&&(this._viewMatrix.value=this._localViewMatrix.value)}setParent(e,n){e!==this.parent&&(e?this.parent||this.divideMemory():this.mergeMemory(),this.invalidate(),this.needsForwardUpdate=!0,this._localScale.didUpdate=!0,this._localRotation.didUpdate=!0,this._localPosition.didUpdate=!0,super.setParent(e,n))}invalidate(){return this.queueForUpdate(),super.invalidate()}optimize(){this.needsWorldOrientation=!1}queueForUpdate(){!this.isQueuedForUpdate&&this._instance&&this._instance.active&&(this.isQueuedForUpdate=!0,yl(this))}update(e){let n=!1;if(this.isQueuedForUpdate&&(wl(this),this.isQueuedForUpdate=!1),this.needsUpdate){const r=this.localRotationMatrix;this._localRotation.didUpdate&&Ca(this._localRotation.value,r),this._localTransform?(Ra(this._localScale.value,r,this._localPosition.value,lt[0]),It(this._localTransform.value,lt[0],this._localMatrix.value)):Ra(this._localScale.value,r,this._localPosition.value,this._localMatrix.value),this._localMatrix.didUpdate=!0,n=!0,this.hasViewMatrix&&(this._viewMatrix===void 0&&(this._viewMatrix={value:Me()}),this._localViewMatrix===void 0&&(this.parent?this._localViewMatrix={value:Me()}:this._localViewMatrix={value:this._viewMatrix.value}),this._localViewTransform?(ys(vi(this._localScale.value,gt[0]),ms(r,jr[1]),Mt(this._localPosition.value,-1,gt[1]),lt[0]),It(this._localViewTransform.value,lt[0],this._localViewMatrix.value)):ys(vi(this._localScale.value,gt[0]),ms(r,jr[1]),Mt(this._localPosition.value,-1,gt[1]),this._localViewMatrix.value),this._localViewMatrix.didUpdate=!0)}this.parent&&(this.parent.needsUpdate?(e||this.processParentUpdates(r=>{r.update(!0)}),n=!0):this.parent.childUpdate.has(this)&&(n=!0),n&&(It(this.parent._matrix.value,this._localMatrix.value,this._matrix.value),this._matrix.didUpdate=!0,this.needsWorldDecomposition=!0,this.hasViewMatrix&&this._viewMatrix&&this._localViewMatrix&&(this.parent.hasViewMatrix&&this.parent._viewMatrix&&this.parent._localViewMatrix?It(this.parent._viewMatrix.value,this._localViewMatrix.value,this._viewMatrix.value):(Ca(this.parent.rotation,jr[0]),ys(vi(this.parent._scale.value,gt[0]),ms(jr[0],jr[1]),Mt(this.parent._position.value,-1,gt[1]),lt[0]),It(this._localViewMatrix.value,lt[0],this._viewMatrix.value)),this._viewMatrix.didUpdate=!0))),this.decomposeWorldMatrix(),this._instance&&this._instance.active&&(this._localMatrix.didUpdate||this._matrix.didUpdate)&&(this._instance.needsLocalUpdate&&(this._localRotation.didUpdate&&(this._instance._localRotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._localPosition=this._localPosition.value),this._localScale.didUpdate&&(this._instance._localScale=this._localScale.value)),this._instance.needsWorldUpdate&&(this.parent?(this._rotation.didUpdate&&(this._instance._rotation=this._rotation.value),this._scale.didUpdate&&(this._instance._scale=this._scale.value),this._position.didUpdate&&(this._instance._position=this._position.value)):(this._localRotation.didUpdate&&(this._instance._rotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._position=this._localPosition.value),this._localScale.didUpdate&&(this._instance._scale=this._localScale.value))),this._matrix.didUpdate&&(this._instance._matrix=this._matrix.value),this._localMatrix.didUpdate&&(this._instance._localMatrix=this._localMatrix.value,this.parent||(this._instance._matrix=this._matrix.value))),this._localScale.didUpdate=!1,this._localRotation.didUpdate=!1,this._localPosition.didUpdate=!1,this._rotation.didUpdate=!1,this._scale.didUpdate=!1,this._position.didUpdate=!1,this._matrix.didUpdate=!1,this._localMatrix.didUpdate=!1,this.resolve()}}const cf=new Fa;var Hn=(t=>(t[t.PERSPECTIVE=0]="PERSPECTIVE",t[t.ORTHOGRAPHIC=1]="ORTHOGRAPHIC",t))(Hn||{});function lf(t){return t.projectionOptions.type===1&&"left"in t.projectionOptions}function bl(t){return t.projectionOptions.type===0&&"fov"in t.projectionOptions}class Qn{constructor(e){this._id=Y(),this.animationEndTime=0,this.needsViewDrawn=!0,this.needsBroadcast=!1,this.viewChangeViewId="",this.transform=new Fa,this._projection=Me(),this._needsUpdate=!0,this._viewProjection=Me(),this._projectionOptions=e,this._needsUpdate=!0,this.onChange=e.onViewChange,this.update()}get id(){return this._id}broadcast(e){this.onChange&&this.onChange(this,e)}static makeOrthographic(e){return new Qn(Object.assign({left:-100,right:100,top:-100,bottom:100,near:-100,far:1e5,type:1},e))}static makePerspective(e){return new Qn(Object.assign({type:0,far:1e4,near:1,fov:90*Math.PI/180,height:1e3,width:1e3},e))}get projectionType(){return this._projectionOptions.type}get projection(){return this.update(!0),this._projection}get view(){return this.transform.viewMatrix}get needsUpdate(){return this._needsUpdate}get position(){return this.transform.position}set position(e){this._needsUpdate=this._needsUpdate||!Xi(e,this.transform.position),this.transform.position=e}lookAt(e,n){const r=Ti(this.transform.matrix);this.transform.lookAtLocal(e,n||[0,1,0]),this._needsUpdate=this._needsUpdate||!sl(r,this.transform.matrix)}get scale(){return this.transform.scale}set scale(e){this._needsUpdate=this._needsUpdate||!Xi(e,this.transform.scale),this.transform.scale=e}get projectionOptions(){return this._projectionOptions}set projectionOptions(e){this._needsUpdate=this._needsUpdate||!ol(e,this._projectionOptions),this._projectionOptions=e}get viewProjection(){return this.update(!0),this._viewProjection}setOrthographic(e){this._projectionOptions=Object.assign({left:-100,right:100,top:-100,bottom:100,near:-100,far:1e5,type:1},e)}setPerspective(e){this._projectionOptions=Object.assign({type:0,far:1e4,near:1,fov:90*Math.PI/180,height:1e3,width:1e3},e)}resolve(){this._needsUpdate=!1,this.needsViewDrawn=!1,this.needsBroadcast=!1}update(e){(this._needsUpdate||e)&&(this.updateProjection(),this._needsUpdate=!1,this.needsViewDrawn=!0)}updateProjection(){lf(this)?rl(this.projectionOptions.left,this.projectionOptions.right,this.projectionOptions.bottom,this.projectionOptions.top,this.projectionOptions.near,this.projectionOptions.far,this._projection):bl(this)&&nl(this.projectionOptions.fov,this.projectionOptions.width,this.projectionOptions.height,this.projectionOptions.near,this.projectionOptions.far,this._projection),It(this._projection,this.transform.viewMatrix,this._viewProjection)}}class Xr{get id(){return this._key}get key(){return this._key}constructor(e){this._key=e.key}}function h0(t){return{key:"",type:xe.COLOR_BUFFER,...t}}function Ba(t){return t!==void 0&&t.key!==void 0&&t.type===xe.COLOR_BUFFER}class uf extends Xr{constructor(e,n){super(e),this.type=xe.COLOR_BUFFER,this.height=e.height,this.width=e.width,this.colorBufferSettings=e.colorBufferSettings,this.createColorBuffer(n)}destroy(){this.colorBuffer.destroy()}createColorBuffer(e){if(this.colorBuffer)return;this.colorBufferSettings={...this.colorBufferSettings};let n,r;const i=(e==null?void 0:e.getRenderSize())||[1,1];if(this.width<=Pt.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");n=i[0]/-this.width}else n=this.width;if(this.height<=Pt.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");r=i[1]/-this.width}else r=this.height;this.colorBuffer=new uh({internalFormat:d.GLSettings.RenderTarget.ColorBufferFormat.RGBA4,size:[n,r],...this.colorBufferSettings})}}class Mi{get webGLRenderer(){return this._webGLRenderer}set webGLRenderer(e){this._webGLRenderer=e}getIOExpansion(){return[]}resize(){}setAttributeContext(e){}}class hf extends Mi{constructor(){super(...arguments),this.resources=new Map}async dequeueRequests(){return!1}destroy(){}destroyResource(e){this.resources.delete(e.key)}getResource(e){return this.resources.get(e)||{key:"",type:-1}}async initResource(e){this.resources.set(e.key,e)}request(e,n,r){return[0,0,0,0]}updateResource(e){}}const df=new hf;class d0 extends Mi{constructor(){super(...arguments),this.resources=new Map}async dequeueRequests(){return!1}destroy(){this.resources.forEach(e=>e.destroy()),this.resources.clear()}getIOExpansion(){return[]}getResource(e){return this.resources.get(e)||null}destroyResource(e){const n=this.resources.get(e.key);n&&(n.destroy(),this.resources.delete(e.key))}async initResource(e){let n=this.resources.get(e.key);if(n){console.warn("Attempted to generate a RenderTexture that already exists for key",e.key);return}n=new uf(e,this.webGLRenderer),this.resources.set(e.key,n)}request(e,n,r,i){const s=this.resources.get(r.key);return s?(r.colorBuffer=s.colorBuffer,[0,0,1,1]):[0,0,0,0]}resize(){const e=new Map;this.resources.forEach((n,r)=>{n.width>Pt.SCREEN&&n.height>Pt.SCREEN||(n.colorBuffer.destroy(),n=new uf(n,this.webGLRenderer),e.set(r,n))}),e.forEach((n,r)=>this.resources.set(r,n))}updateResource(e){this.resources.get(e.key)&&console.warn("UPDATING AN EXISTING COLOR BUFFER IS NOT SUPPORTED YET")}}function El(t){return{type:xe.COLOR_BUFFER,...t}}const Ss=class{static setObservableMonitor(t){Ss.gatherIds=t,Ss.observableIds=[]}static getObservableMonitorIds(t){const e=Ss.observableIds.slice(0);return t&&(Ss.observableIds=[]),e}};let mt=Ss;mt.setCycle=!1,mt.gatherIds=!1,mt.observableIds=[],mt.observableNamesToUID=new Map;const Rn=mt,Ua=new Map;let f0=1;const p0={}.constructor;function g0(t,e){const n=Rn.observableNamesToUID.get(e)||0;if(n===0){console.warn("A property with name",e,"for",t,"has not been assigned a UID which is an error in this step of the process.");return}function r(){return Rn.gatherIds&&(Rn.setCycle||Rn.observableIds.push(n)),t.observableStorage[n]}function i(a){Rn.gatherIds&&(Rn.setCycle=!0),t.observableStorage[n]=a,t.changes[n]=n,t.observer&&t.observer.instanceUpdated(t),Rn.gatherIds&&(Rn.setCycle=!1)}const s=t[e];Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:r,set:i}),t[e]=s}function B(t,e,n){n||(n={configurable:!0,enumerable:!0});let r=Ua.get(t.constructor),i=Rn.observableNamesToUID.get(e)||0;i===0&&(i=++f0,Rn.observableNamesToUID.set(e,i)),r||(r=new Set,Ua.set(t.constructor,r)),r.add(e);let s=Object.getPrototypeOf(t),a=0;for(;s.constructor!==p0&&++a<100;){const o=Ua.get(s.constructor);o&&o.forEach(c=>r==null?void 0:r.add(c)),s=Object.getPrototypeOf(s)}a>=100&&console.warn("@observable decorator encountered a type that has 100+ levels of inheritance. This is most likely an error, and may be a result of a circular dependency and will not be supported by this decorator."),n.enumerable=!0,n.writable=!0,Object.defineProperty(t,e,n)}function vt(t,e){if(t.constructor!==e)return;const n=Ua.get(e);n&&n.forEach(r=>g0(t,r))}class Oe{constructor(e){if(this._uid=Y(),this.cleanObservation=new Map,this.instanceChanges=new Map,this.allowChanges=!0,this.resolveContext="",e)for(let n=0,r=e.length;n<r;++n){const i=e[n];this.add(i)}}get uid(){return this._uid}get changeList(){this.allowChanges=!1;const e=[];return this.instanceChanges.forEach(n=>e.push(n)),e}add(e){if(this.cleanObservation.get(e.uid))return e;if(this.allowChanges){e.observer=this;const n=e.observableDisposer;this.cleanObservation.set(e.uid,[e,n]),this.instanceChanges.set(e.uid,[e,Je.INSERT,e.changes])}return e}has(e){return this.cleanObservation.has(e.uid)}clear(){this.cleanObservation.forEach(e=>{this.remove(e[0])})}destroy(){this.cleanObservation.forEach(e=>{e[1]()}),this.cleanObservation.clear(),this.instanceChanges.clear()}instanceUpdated(e){this.allowChanges&&this.instanceChanges.set(e.uid,[e,Je.CHANGE,e.changes])}remove(e){if(this.allowChanges){const n=this.cleanObservation.get(e.uid);n&&(n[1](),this.cleanObservation.delete(e.uid),this.instanceChanges.set(e.uid,[n[0],Je.REMOVE,{}]))}return!1}resolve(e){if(this.allowChanges=!0,this.instanceChanges.clear(),this.resolveContext&&this.resolveContext!==e)throw new Error("An instance provider has been issued to two layers. This is not a suppported feature yet and can cause issues.");this.resolveContext=e}sync(){const e=[];this.cleanObservation.forEach(n=>{const[r]=n;this.instanceChanges.set(r.uid,[r,Je.INSERT,e])})}}class ff{constructor(e){this.delay=0,this.isManualStart=!1,this.isTimeSet=!1,this.startTime=-1,Object.assign(this,e)}setAutomatic(){this.isManualStart=!1,this.isTimeSet=!1}setStart(e){e&&(this.start.length!==e.length?console.warn("A manual easing adjustment provided an incompatible value for the easing type."):(this.start=e,this.isManualStart=!0))}setTiming(e,n){this.delay=e===void 0?this.delay:e,this.duration=n===void 0?this.duration:n,this.isTimeSet=!0}}var m0=Object.defineProperty,v0=Object.getOwnPropertyDescriptor,pf=(t,e,n,r)=>{for(var i=r>1?void 0:r?v0(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(r?a(e,n,i):a(i))||i);return r&&i&&m0(e,n,i),i};let gf=0;const _l=class{constructor(t){this._active=!1,this.changes={},this._observer=null,this.observableStorage=[],this._uid=_l.newUID,this.reactivate=!1,vt(this,_l),t&&(this.active=t.active||this.active)}static get newUID(){return gf=++gf%16777215}get active(){return this._active}set active(t){this._active=t,this.reactivate=!0}get observableDisposer(){return()=>this._observer=null}get observer(){return this._observer||null}set observer(t){const e=this._observer;e&&e!==t&&(this.easing&&this.easing.clear(),e.remove(this)),this._observer=t}getEasing(t){if(this.easingId){const e=this.easingId[`_${t}_end`];if(e&&this.easing){const n=this.easing.get(e);if(n instanceof ff)return n}}}get uid(){return this._uid}resourceTrigger(){console.warn("resourceTrigger called on an instance that did not override resourceTrigger. resourceTrigger MUST be overridden for instances","that utilize a resource. The observable that is tied to committing the resource should be 'triggered' in this method.")}};let dt=_l;pf([B],dt.prototype,"_active",2),pf([B],dt.prototype,"_uid",2);class y0 extends dt{resourceTrigger(){}}function Rl(t){return{key:"",type:xe.TEXTURE,...t}}function Yr(t){return t&&t.key!==void 0&&t.type===xe.TEXTURE}class Al extends Xr{constructor(e,n){super(e),this.type=xe.TEXTURE,this.height=e.height,this.width=e.width,this.textureSettings=e.textureSettings,this.createTexture(n)}destroy(){this.texture.destroy()}createTexture(e){var s;if(this.texture)return;this.textureSettings={generateMipMaps:!0,premultiplyAlpha:!1,...this.textureSettings};let n,r;const i=(e==null?void 0:e.getRenderSize())||[1,1];if(this.width<=Pt.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");n=i[0]/-this.width}else n=this.width;if(this.height<=Pt.SCREEN){if(!e)throw new Error("Can not generate Render Texture with a dynamic width or height when the WebGLRenderer is not available");r=i[1]/-this.width}else r=this.height;this.texture=new Re({data:((s=this.textureSettings)==null?void 0:s.data)||{width:n,height:r,buffer:null},...this.textureSettings})}}const w0=`varying highp vec4 _picking_color_pass_;
void main() {
\${out: _picking_fragment_} = _picking_color_pass_;
}`;function mf(t){return t}class yt{constructor(e,n,r,i){this.child=[null,null],this.isLeaf=!0,this.data=null,this.bounds=new we({height:i,width:r,x:e,y:n})}destroy(){const e=this.child[0],n=this.child[1];this.data=null,e&&e.destroy(),n&&n.destroy(),this.child[0]=null,this.child[1]=null}hasChild(){const e=this.child[0],n=this.child[1];return e&&!e.data?!e.isLeaf:n&&!n.data?!n.isLeaf:!1}insert(e){let n=this.child[0],r=this.child[1];if(!this.isLeaf&&n&&r){const i=n.insert(e);return i!==null?i:r.insert(e)}else{if(this.data)return null;const i=this.bounds.fits(e.bounds);if(i===0)return null;if(i===1)return this.data=e.data,this;this.isLeaf=!1;const s=e.bounds.width,a=e.bounds.height,o=this.bounds.width-s,c=this.bounds.height-e.bounds.height;o>c?(n=this.child[0]=new yt(this.bounds.x,this.bounds.y,s,this.bounds.height),r=this.child[1]=new yt(this.bounds.x+s,this.bounds.y,o,this.bounds.height)):(n=this.child[0]=new yt(this.bounds.x,this.bounds.y,this.bounds.width,a),r=this.child[1]=new yt(this.bounds.x,this.bounds.y+a,this.bounds.width,c))}return n.insert(e)}remove(e){const n=this.child[0],r=this.child[1];if(r&&n&&!this.isLeaf){let i=n.remove(e);return i?!0:(i=r.remove(e),n.hasChild()||r.hasChild()||(this.child[0]=null,this.child[1]=null),i)}else return this.data===e?(this.data=null,!0):!1}static applyToSubTexture(e,n,r,i,s){if(!r)return;i=i||{top:0,left:0,bottom:0,right:0};const a=n instanceof yt?n.bounds:n,o=(a.x+i.left)/e.bounds.width,c=(a.y+i.top)/e.bounds.height,l=(a.width-i.left-i.right)/e.bounds.width,u=(a.height-i.top-i.bottom)/e.bounds.height;let h;s?h=new we({bottom:1-c,left:o,right:o+l,top:1-(c+u)}):h=new we({top:1-c,left:o,right:o+l,bottom:1-(c+u)});const f=h.bottom,p=h.y,m=h.x,v=h.x+h.width;r.atlasTL=[m,p],r.atlasBR=[v,f],r.atlasBL=[m,f],r.atlasTR=[v,p],r.widthOnAtlas=Math.abs(r.atlasTR[0]-r.atlasTL[0]),r.heightOnAtlas=Math.abs(r.atlasTR[1]-r.atlasBR[1]),r.pixelWidth=l*e.bounds.width,r.pixelHeight=u*e.bounds.height}}function vf(t){return t&&t.call!==void 0&&t.apply!==void 0}function yr(t,e,n){let r=t.get(e);return r===void 0&&(vf(n)?r=n():r=n,t.set(e,r)),r}function ka(t,e,n){let r=t.get(e);return r===void 0&&(vf(n)?r=n():r=n),r}class At{}At.transparentShapeBlending={blending:{blendDst:d.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:d.GLSettings.Material.BlendingEquations.Add,blendSrc:d.GLSettings.Material.BlendingSrcFactor.SrcAlpha},culling:d.GLSettings.Material.CullSide.NONE,modify(t){return Object.assign({},this,t)}},At.transparentImageBlending={blending:{blendSrc:d.GLSettings.Material.BlendingSrcFactor.One,blendDst:d.GLSettings.Material.BlendingDstFactor.OneMinusSrcAlpha,blendEquation:d.GLSettings.Material.BlendingEquations.Add},culling:d.GLSettings.Material.CullSide.NONE,modify(t){return Object.assign({},this,t)}};class T0{static async modify(e,n,r){for(let i=0,s=n.length;i<s;++i){const a=n[i];for(let o=0,c=e.length;o<c;++o){const l=e[o],u=l.getEasing(a);u&&r(u,l,o,i)}}}static async all(e,n,r,i){let s=fa;const a=new Promise(l=>s=l);let o=0;for(let l=0,u=r.length;l<u;++l){const h=r[l];for(let f=0,p=n.length;f<p;++f){const m=n[f],v=m.getEasing(h);v&&(i&&i(v,m,f,l),o=Math.max((v.delay||0)+v.duration,o))}}const c=l=>{l<o?jn(c):s()};return e?jn(l=>{o+=l,c(l)}):s(),a}}const b0=5,E0=10;function _0(t,e){const n=[];return e.forEach(r=>{t.find(i=>r instanceof i)&&n.push(r)}),n}class yf{destroy(){this.TL.destroy(),this.TR.destroy(),this.BL.destroy(),this.BR.destroy()}constructor(e,n){const r=e.mid;this.TL=new Ii(e.x,r[0],e.y,r[1],n),this.TR=new Ii(r[0],e.right,e.y,r[1],n),this.BL=new Ii(e.x,r[0],r[1],e.bottom,n),this.BR=new Ii(r[0],e.right,r[1],e.bottom,n)}}class Ii{constructor(e,n,r,i,s){this.children=[],this.depth=0,arguments.length>=4?this.bounds=new we({left:e,right:n,top:r,bottom:i}):this.bounds=new we({left:0,right:1,top:0,bottom:1}),this.depth=s||0}destroy(){this.children=[],this.nodes&&(this.nodes.destroy(),delete this.nodes)}add(e,n){return e.isInside(this.bounds)?this.doAdd(e):(this.cover(e),this.add(e,n))}addAll(e){let n=Number.MAX_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;const{min:a,max:o}=Math;for(let c=0,l=e.length;c<l;++c){const u=e[c];n=a(n,u.x),i=o(u.right,i),r=a(r,u.y),s=o(s,u.bottom)}this.cover(new we({left:n,right:i,top:r,bottom:s})),e.forEach(c=>this.doAdd(c))}cover(e){if(e.isInside(this.bounds))return;this.bounds.encapsulate(e),this.bounds.x-=1,this.bounds.y-=1,this.bounds.width+=2,this.bounds.height+=2;const n=this.gatherChildren([]);this.nodes&&(this.nodes.destroy(),delete this.nodes),n.forEach(r=>this.doAdd(r))}doAdd(e){return this.nodes?e.isInside(this.nodes.TL.bounds)?this.nodes.TL.doAdd(e):e.isInside(this.nodes.TR.bounds)?this.nodes.TR.doAdd(e):e.isInside(this.nodes.BL.bounds)?this.nodes.BL.doAdd(e):e.isInside(this.nodes.BR.bounds)?this.nodes.BR.doAdd(e):(this.children.push(e),!0):e.isInside(this.bounds)?(this.children.push(e),this.children.length>b0&&this.depth<E0&&this.split(),!0):(isNaN(e.width+e.height+e.x+e.y)?console.error("Child did not fit into bounds because a dimension is NaN",e):e.area===0&&console.error("Child did not fit into bounds because the area is zero",e),!0)}gatherChildren(e,n){n&&n(this);for(let r=0,i=this.children.length;r<i;++r)e.push(this.children[r]);return this.nodes&&(this.nodes.TL.gatherChildren(e,n),this.nodes.TR.gatherChildren(e,n),this.nodes.BL.gatherChildren(e,n),this.nodes.BR.gatherChildren(e,n)),e}query(e,n){return e instanceof we?e.hitBounds(this.bounds)?this.queryBounds(e,[],n):[]:Co(e)&&this.bounds.containsPoint(e)?this.queryPoint(e,[],n):[]}queryBounds(e,n,r){return this.bounds.isInside(e)?(this.gatherChildren(n,r),n):(this.children.forEach(i=>{i.hitBounds(e)&&n.push(i)}),r&&r(this),this.nodes&&(e.hitBounds(this.nodes.TL.bounds)&&this.nodes.TL.queryBounds(e,n,r),e.hitBounds(this.nodes.TR.bounds)&&this.nodes.TR.queryBounds(e,n,r),e.hitBounds(this.nodes.BL.bounds)&&this.nodes.BL.queryBounds(e,n,r),e.hitBounds(this.nodes.BR.bounds)&&this.nodes.BR.queryBounds(e,n,r)),n)}queryPoint(e,n,r){return this.children.forEach(i=>{i.containsPoint(e)&&n.push(i)}),r&&r(this),this.nodes&&(this.nodes.TL.bounds.containsPoint(e)&&this.nodes.TL.queryPoint(e,n,r),this.nodes.TR.bounds.containsPoint(e)&&this.nodes.TR.queryPoint(e,n,r),this.nodes.BL.bounds.containsPoint(e)&&this.nodes.BL.queryPoint(e,n,r),this.nodes.BR.bounds.containsPoint(e)&&this.nodes.BR.queryPoint(e,n,r)),n}split(){const e=[];this.gatherChildren(e),this.nodes=new yf(this.bounds,this.depth+1),this.children=[];for(let n=0,r=e.length;n<r;++n){const i=e[n];i&&this.doAdd(i)}}visit(e){const n=!!e(this);this.nodes&&!n&&(this.nodes.TL.visit(e),this.nodes.TR.visit(e),this.nodes.BL.visit(e),this.nodes.BR.visit(e))}}class wf extends Ii{}class xs{constructor(e){this.willDispose=new Set,this.keyToItem=new Map,this.keyToInitializer=new Map,this.currentInitalizerIndex=0,this.currentInitializers=[],this._items=[],this.inlineDeferred=n=>{this.deferredInlining=n},this.inlineImmediate=n=>{if(n.length>0&&this.currentInitializers&&this.currentItem){this.currentInitializers.splice(this.currentInitalizerIndex+1,0,...n);for(let r=0,i=n.length;r<i;++r){const s=n[r];s.parent=this.currentItem}}},this.inline=this.inlineImmediate,this.options=e}get items(){return this._items.slice(0)}async destroy(){const e=[];for(let n=0,r=this.currentInitializers.length;n<r;++n){const i=this.currentInitializers[n],s=this.keyToItem.get(i.key);s&&e.push(this.options.destroyItem(i,s))}await Promise.all(e)}async diff(e){const n=e.slice(0);this.currentInitializers=n,this._items=[];let r=0;for(;r<n.length;){const i=n[r];if(this.currentInitalizerIndex=r,this.currentInitializer=i,this.willDispose.has(i.key)){let s=this.keyToItem.get(i.key)||null;s?(this.currentItem=s,await this.options.updateItem(i,s)):s=await this.options.buildItem(i),s&&(this.keyToInitializer.set(i.key,i),this.willDispose.delete(i.key),this._items.push(s))}else{this.inline=this.inlineDeferred;const s=await this.options.buildItem(i);this.inline=this.inlineImmediate,s&&(this.currentItem=s,this.deferredInlining&&(this.inline(this.deferredInlining),delete this.deferredInlining),this.keyToItem.set(i.key,s),this.keyToInitializer.set(i.key,i),this._items.push(s))}delete this.currentItem,r++}this.willDispose.forEach(async i=>{const s=this.keyToItem.get(i),a=this.keyToInitializer.get(i);if(!s||!a)return;await this.options.destroyItem(a,s)&&(this.keyToItem.delete(i),this.keyToInitializer.delete(i))}),this.willDispose.clear(),this.keyToInitializer.forEach(i=>{this.willDispose.add(i.key)}),this.currentInitializers=[],delete this.currentItem,delete this.currentInitializer}getByKey(e){return this.keyToItem.get(e)}async rebuild(){if(!this.currentItem||!this.currentInitializer)return;this.keyToItem.delete(this.currentItem.id),this.keyToInitializer.delete(this.currentItem.id),this.options.destroyItem(this.currentInitializer,this.currentItem);const e=await this.options.buildItem(this.currentInitializer);e&&(this.keyToItem.set(this.currentItem.id,e),this.keyToInitializer.set(this.currentItem.id,this.currentInitializer))}}function wr(t){const{shader:e,options:n={},required:r,onError:i,onToken:s,onMain:a}=t,o=new Map,c=new Map,l=new Map,u=new Map,h=e.replace(/\$\{([^\}]*)\}/g,(p,m)=>{let v="";return u.set(m,(u.get(m)||0)+1),m in n?(o.set(m,(o.get(m)||0)+1),v=n[m]):c.set(m,(c.get(m)||0)+1),s&&(v=s(m,v)),v});Object.keys(n).forEach(p=>{o.get(p)||l.set(p,(l.get(p)||0)+1)});const f={resolvedShaderOptions:o,shader:h,shaderProvidedOptions:u,unresolvedProvidedOptions:l,unresolvedShaderOptions:c};if(r&&r.values.forEach(p=>{if(f.unresolvedProvidedOptions.get(p)){const m=`${r.name}: Could not resolve all the required inputs. Input: ${p}`;i?i(m):console.error(m)}else if(f.unresolvedShaderOptions.get(p)){const m=`${r.name}: A required option was not provided in the options parameter. Option: ${p}`;i?i(m):console.error(m)}else if(!f.resolvedShaderOptions.get(p)){const m=`${r.name}: A required option was not provided in the options parameter. Option: ${p}`;i?i(m):console.error(m)}}),a){const p=f.shader,m=p.match(/void((.+)|\s)(main(\s+)\(\)|main\(\))(((.+)(\s*)\{)|(\s*)\{)/gm);if(m&&m.length>0){const v=p.indexOf(m[0]);if(v<0)a(null);else{const b=p.substr(0,v),T=p.substr(v+m[0].length);let E=!1,S=!1,I=1,x=0,D=-1;for(let N=0,O=T.length;N<O;++N){const te=T[N],ne=T[N+1];switch(te){case"/":switch(ne){case"*":!E&&!S&&(E=!0,N++);break;case"/":!E&&!S&&(S=!0,N++);break}break;case"*":ne==="/"&&(S||(E=!1,N++));break;case`
`:case"\r":E||(S=!1);break;case"{":!E&&!S&&I++;break;case"}":!E&&!S&&x++,I===x&&(D=N);break}if(D!==-1)break}if(D!==-1){const N=T.substr(0,D),O=T.substr(D+1),te=a(N,`${b}
${O}`);typeof te=="string"?f.shader=p.substr(0,v+m[0].length)+te+p.substr(v+m[0].length+D):f.shader=p.substr(0,v)+te.header+p.substr(v,m[0].length)+te.main+p.substr(v+m[0].length+D)}else a(null)}}}return f}function R0(t){return new Promise(e=>setTimeout(e,t))}function A0(t){let e=0,n=[];return Object.assign(async i=>{if(i!==void 0&&i!==t&&(n.forEach(u=>u.resolve(!1)),t=i),!t)return!1;const s=++e,a=new ht;let o=t.getBoundingClientRect(),c;if(n.push(a),o.width===0||o.height===0){let u=!0;const h={attributes:!0};c=new MutationObserver(f=>{if(u){for(const p of f)if(p.type==="attributes"){if(!t)return;o=t.getBoundingClientRect(),o.width!==0&&o.height!==0&&(c&&(c.disconnect(),c=void 0),u=!1,a.resolve(s===e))}}}),c.observe(t,h),await As(),o=t.getBoundingClientRect(),u&&o.width!==0&&o.height!==0&&(c.disconnect(),u=!1,a.resolve(s===e))}else await As(),a.resolve(s===e);const l=await a.promise;return c&&(c.disconnect(),c=void 0),l&&(n.forEach(u=>u.resolve(!1)),n=[]),l},{cancel:()=>{n.forEach(i=>i.resolve(!1)),n=[]}})}function qr(t,e){const n=Object.assign(e,{key:e.key||t.defaultProps.key,data:e.data||t.defaultProps.data});return{get key(){return e.key||""},init:[t,n]}}function Kr(t,e){const n=Object.assign(e,{key:e.key||t.defaultProps.key,data:e.data||t.defaultProps.data});return{get key(){return e.key||""},init:[t,n]}}function Tf(t){return t}function bf(t){return t}const S0={layer:qr,view:Bl,vertex:bf,uniform:Tf,attribute:mf};class x0{constructor(e){this.index=-1,this.marker=new Map,this.pool=new Array(e.firstAlloc);for(let n=0,r=e.firstAlloc;n<r;++n)this.pool[n]=e.create();this.options=e}destroy(){for(let e=0,n=this.pool.length;e<n;++e)this.options.destroy(this.pool[e]);this.pool=[],this.marker.clear()}retrieve(){const e=this.pool[this.index+1];return this.index++,this.marker.set(e,this.index),e}replace(e){const n=this.marker.get(e);n!==void 0&&(this.pool[n]=this.pool[this.index],this.pool[this.index]=e,this.marker.delete(e),this.index--)}}function M0(t,e,n,r){return e<0&&(e=t.length+e,e<0&&(e=0)),t.slice(0,e)+(r||"")+t.slice(e+n)}function Ms(t){let e=!1,n=!1;const r=[];let i={start:-1,stop:-1},s={start:-1,stop:-1};for(let a=0,o=t.length;a<o;++a){const c=t[a],l=t[a+1];switch(c){case"/":switch(l){case"*":!n&&!e&&(i.start=a,e=!0,a++);break;case"/":!e&&!n&&(s.start=a,n=!0,a++);break}break;case"*":l==="/"&&e&&(i.stop=a+2,r.push(i),i={start:-1,stop:-1},e=!1,a++);break;case`
`:case"\r":n&&(s.stop=a,r.push(s),s={start:-1,stop:-1},n=!1);break}}return r.reverse(),r.forEach(a=>{t=M0(t,a.start,a.stop-a.start)}),t}function Tr(t){return t?[t.atlasTL[0],t.atlasTL[1],t.atlasBR[0],t.atlasBR[1]]:[0,0,0,0]}class Xn{constructor(e){this._uid=Y(),this.aspectRatio=1,this.atlasTL=[0,0],this.atlasTR=[0,0],this.atlasBL=[0,0],this.atlasBR=[0,0],this.heightOnAtlas=0,this.isValid=!1,this.pixelWidth=0,this.pixelHeight=0,this.texture=null,this.widthOnAtlas=0,Object.assign(this,e)}get uid(){return this._uid}static fromRegion(e,n){if(!e.data)return null;const r=n.x/e.data.width,i=n.y/e.data.height,s=n.width/e.data.width,a=n.height/e.data.height,o=new we({bottom:i+a,left:r,right:r+s,top:i}),c=o.bottom,l=o.y,u=o.x,h=o.x+o.width,f=new Xn;return f.atlasTL=[u,l],f.atlasBR=[h,c],f.atlasBL=[u,c],f.atlasTR=[h,l],f}update(){!this.texture||!this.source||!this.atlasRegion||this.texture.update(this.source,this.atlasRegion)}toString(){return JSON.stringify({atlas:{TL:this.atlasTL,TR:this.atlasTR,BL:this.atlasBL,BR:this.atlasBR},width:this.pixelWidth,height:this.pixelHeight},null,2)}}const I0=Ye("performance");function Ef(t){return{key:"",type:xe.ATLAS,...t}}function Sl(t){return t&&t.type===xe.ATLAS}class _f extends Xr{constructor(e){super(e),this.resourceReferences=new Map,this.type=xe.ATLAS;const n=document.createElement("canvas");if(this.width=n.width=e.width,this.height=n.height=e.height,this.textureSettings=e.textureSettings,e.width<0||e.height<0)throw new Error("TextureSize Error: An atlas does NOT support Screen Texture sizing.");this.packing=new yt(0,0,e.width,e.height),this.createTexture(n)}createTexture(e){if(this.texture)return;let n;this.textureSettings?n={generateMipMaps:!0,premultiplyAlpha:!0,...this.textureSettings}:n={generateMipMaps:!0,premultiplyAlpha:!0},this.texture=new Re({data:e,...n})}destroy(){var e;(e=this.texture)==null||e.destroy(),this.resourceReferences.forEach(n=>{this.invalidateTexture(n.subtexture)})}invalidateTexture(e){const n=[0,0];e.aspectRatio=1,e.atlasBL=n,e.atlasBR=n,e.atlasTL=n,e.atlasTR=n,e.isValid=!1,e.texture=null,e.pixelHeight=0,e.pixelWidth=0,delete e.source,e.video&&(e.video.monitor.destroy(),delete e.video)}resolveResources(){const e=[];this.resourceReferences.forEach((n,r)=>{n.count<=0&&n.subtexture&&(I0("A subtexture on an atlas has been invalidated as it is deemed no longer used: %o",n.subtexture),this.invalidateTexture(n.subtexture),e.push(r))});for(let n=0,r=e.length;n<r;++n)this.resourceReferences.delete(e[n])}stopUsingResource(e){const n=this.resourceReferences.get(e.source)||{subtexture:e.texture||new Xn,count:0};n.count--}useResource(e){const n=this.resourceReferences.get(e.source)||{subtexture:e.texture,count:0};n.count++}}let it;class Zr{static async awaitContext(){for(;!it;)this.getContext(),await new Promise(e=>setTimeout(e,10))}static getContext(){it||(it=document.createElement("canvas").getContext("2d"))}static async calculateImageSize(e){if(await this.awaitContext(),!it){console.warn("The Image rasterizer was unable to establish a valid canvas context. Please ensure the system supports contexts and ensure the document is ready first.");return}if(e.width===0||e.height===0){console.warn("Images provided shoud have valid dimensions! Please ensure the image is loaded first.");return}return it.canvas.width=100,it.canvas.height=100,it.drawImage(e,0,0,1,1),[e.width,e.height]}static async resizeImage(e,n){if(await this.awaitContext(),!it)return console.warn("The Image rasterizer was unable to establish a valid canvas context. Please ensure the system supports contexts and ensure the document is ready first."),e;if(e.width===0||e.height===0)return console.warn("Images provided shoud have valid dimensions! Please ensure the image is loaded first."),e;it.canvas.width=Math.floor(e.width*n),it.canvas.height=Math.floor(e.height*n),e instanceof ImageData?it.putImageData(e,0,0,0,0,it.canvas.width,it.canvas.height):it.drawImage(e,0,0,it.canvas.width,it.canvas.height);const r=new Image;return r.src=it.canvas.toDataURL("image/png"),await Zr.calculateImageSize(r),r}}class C0{constructor(e,n){this.video=e,this.subTexture=n,this.isDestroyed=!1,this.renderedTime=-1,this.previousTime=-1,this.playedFrames=0,this.caughtFrames=0,this.timeFrame=0,this.doUpdate=()=>{Math.abs(this.video.currentTime-this.renderedTime)<.015||(this.renderedTime=this.video.currentTime,this.subTexture.update())},this.loop=r=>{this.doUpdate(),this.isDestroyed||jn(this.loop)},this.addEventListeners()}async addEventListeners(){this.isDestroyed||this.loop(await jn())}destroy(){this.video.pause(),this.isDestroyed=!0,this.removeEventListeners()}removeEventListeners(){}}const Rf=Ye("performance"),L0=new Xn({aspectRatio:0,atlasBL:[0,0],atlasBR:[0,0],texture:null,atlasTL:[0,0],atlasTR:[0,0],heightOnAtlas:0,isValid:!1,pixelHeight:0,pixelWidth:0,widthOnAtlas:0});function O0(t){return!!(t&&t.isValid&&t.pixelWidth&&t.pixelHeight)}class Af{constructor(){this.allAtlas=new Map}async createAtlas(e){const n=new _f(e);return this.allAtlas.set(n.id,n),Rf("Atlas Created-> %o",n),n}destroy(){this.allAtlas.forEach(e=>e.destroy())}destroyAtlas(e){const n=this.allAtlas.get(e);n&&n.destroy()}setDefaultImage(e,n){return e=Object.assign(e,L0,{atlasReferenceID:n}),e}async draw(e,n){var o;const r=e.id;if(n.disposeResource)return!0;const i=e.resourceReferences.get(n.source);if(i)return n.texture=i.subtexture,!0;n.texture=new Xn,n.texture.isValid=!0,e.resourceReferences.set(n.source,{subtexture:n.texture,count:0});const s=await this.loadImage(n),a=n.texture;if(s&&O0(a)){const c=new we({bottom:a.pixelHeight,left:0,right:a.pixelWidth,top:0}),l={data:a,bounds:c};l.bounds.width+=0,l.bounds.height+=0;let u=e.packing,h=u.insert(l);if(!h){if(!this.repackResources(e))return console.error("Repacking the atlas failed. Some resources may be in an undefined state. Consider making another atlas."),!1;u=e.packing,h=u.insert(l)}return h?(h.data=a,yt.applyToSubTexture(u,h,a,{top:.5,left:.5,right:.5,bottom:.5}),a.texture=e.texture||null,a.source=s,a.atlasRegion={...h.bounds,y:e.height-h.bounds.y-h.bounds.height},(o=e.texture)==null||o.update(s,a.atlasRegion),s instanceof HTMLVideoElement&&(a.video={monitor:new C0(s,a)}),!0):(console.error("Could not fit resource into atlas",n),n.texture=this.setDefaultImage(a,r),!1)}else return a&&!a.isValid?Rf("Resource was invalidated during load:",n):console.error("Could not load resource:",n),n.texture&&(n.texture=this.setDefaultImage(n.texture,r)),!1}getAtlasTexture(e){return this.allAtlas.get(e)}async loadImage(e){const n=e.texture||new Xn,r=e.source;if(e.texture=n,e.texture.isValid===!1)return null;if(r instanceof HTMLImageElement){let i=await new Promise(s=>{if(!(r instanceof HTMLImageElement))return;const a=r;if(a.width&&a.height){Zr.calculateImageSize(a),n.pixelWidth=a.width,n.pixelHeight=a.height,n.aspectRatio=a.width/a.height,s(a);return}a?(a.onload=function(){n.pixelWidth=a.width,n.pixelHeight=a.height,n.aspectRatio=a.width/a.height,a.onload=null,s(a)},a.onerror=function(){console.error("Error generating Image element for source:",r),a.onload=null,s(null)}):s(null)});return i&&e.rasterizationScale!==void 0&&e.rasterizationScale!==1&&(i=await Zr.resizeImage(i,e.rasterizationScale||1)),i}else{if(r instanceof HTMLVideoElement)return r.videoHeight===0||r.videoWidth===0?(console.warn("Video requests to the atlas manager MUST have the video completely loaded and ready for loading","There are too many caveats to automate video loading at this low of a level to have it prepped properly for","use in the texture for all browsers. Consider handling video resources at the layer level to have them","prepped for use."),null):(n.pixelWidth=r.videoWidth,n.pixelHeight=r.videoHeight,n.aspectRatio=r.videoWidth/r.videoHeight,r);if($n(r)){const i=r;let s=await new Promise(a=>{const o=new Image;o.onload=function(){n.pixelWidth=o.width,n.pixelHeight=o.height,n.aspectRatio=o.width/o.height,o.onload=null,a(o)},o.onerror=function(){console.error("Error generating Image element for source:",r),a(null)},o.crossOrigin="anonymous",o.src=i});return s&&e.rasterizationScale!==void 0&&e.rasterizationScale!==1&&(s=await Zr.resizeImage(s,e.rasterizationScale||1)),s}else{let i=r;return i&&e.rasterizationScale!==void 0&&e.rasterizationScale!==1&&(i=await Zr.resizeImage(i,e.rasterizationScale||1)),i}}}repackResources(e){if(!this.renderer)return console.warn("Attempted to repack resources for an atlas, but no renderer has been specified for this manager yet."),!1;const n=[e.packing],r=[];let i=0;const s=new Map;for(;i<n.length;){const S=n[i];i++,S.data&&S.data.texture&&(r.push(S),s.set(S.bounds,new we(S.bounds))),S.child[0]&&n.push(S.child[0]),S.child[1]&&n.push(S.child[1])}if(r.sort((S,I)=>Math.max(I.bounds.width,I.bounds.height)-Math.max(S.bounds.width,S.bounds.height)),r.length<=0)return e.packing=new yt(0,0,e.width,e.height),!0;if(!e.texture)return console.warn("Attempted to repack resources for an atlas with no texture."),!1;const a=new Re(e.texture);a.data={buffer:new Uint8Array(e.width*e.height*4),width:e.width,height:e.height};const o=new yt(0,0,e.width,e.height);let c=!1;for(let S=0,I=r.length;S<I;++S){const x=r[S];if(!x.data){console.warn("Attempted to repack a node with no valid data.");continue}x.bounds.x=0,x.bounds.y=0;const D=o.insert({bounds:x.bounds,data:x.data});if(!D){console.warn("When repacking the atlas, an existing node was unable to be repacked",x),c=!0;continue}yt.applyToSubTexture(o,D,x.data)}if(c)return!1;const l=new Float32Array(r.length*2*6),u=new Float32Array(r.length*2*6),h=new Xn;for(let S=0,I=r.length;S<I;++S){const x=r[S],D=s.get(x.bounds),N=x.data;if(!D||!N){console.warn("While repacking there was an issue finding the previous bounds and the next texture to use",D,N);continue}yt.applyToSubTexture(o,D,h);const O=S*2*6;l[O]=N.atlasTL[0]*2-1,l[O+1]=N.atlasTL[1]*2-1,l[O+2]=N.atlasTR[0]*2-1,l[O+3]=N.atlasTR[1]*2-1,l[O+4]=N.atlasBL[0]*2-1,l[O+5]=N.atlasBL[1]*2-1,l[O+6]=N.atlasTR[0]*2-1,l[O+7]=N.atlasTR[1]*2-1,l[O+8]=N.atlasBR[0]*2-1,l[O+9]=N.atlasBR[1]*2-1,l[O+10]=N.atlasBL[0]*2-1,l[O+11]=N.atlasBL[1]*2-1,u[O]=h.atlasTL[0],u[O+1]=h.atlasTL[1],u[O+2]=h.atlasTR[0],u[O+3]=h.atlasTR[1],u[O+4]=h.atlasBL[0],u[O+5]=h.atlasBL[1],u[O+6]=h.atlasTR[0],u[O+7]=h.atlasTR[1],u[O+8]=h.atlasBR[0],u[O+9]=h.atlasBR[1],u[O+10]=h.atlasBL[0],u[O+11]=h.atlasBL[1],N.texture=a}const f=new lr,p=new zn(l,2),m=new zn(u,2);f.addAttribute("position",p),f.addAttribute("texCoord",m);const v=new hr({buffers:{color:{buffer:a,outputType:0}},retainTextureTargets:!0}),b=new ss({culling:d.GLSettings.Material.CullSide.NONE,uniforms:{texture:{type:He.TEXTURE,value:e.texture}},fragmentShader:new Map([[v,{outputNames:[],outputTypes:[0],source:`
          precision highp float;

          uniform sampler2D texture;
          varying vec2 _texCoord;

          void main() {
            gl_FragColor = texture2D(texture, _texCoord);
          }
        `}]]),vertexShader:`
        precision highp float;

        attribute vec2 position;
        attribute vec2 texCoord;
        varying vec2 _texCoord;

        void main() {
          _texCoord = texCoord;
          gl_Position = vec4(position, 0.0, 1.0);
        }
      `}),T=new Gc("__atlas_manager__",f,b);T.vertexCount=r.length*6,T.drawMode=d.GLSettings.Model.DrawMode.TRIANGLES;const E=new ma;return E.add(T),this.renderer.setRenderTarget(v),this.renderer.setViewport(this.renderer.getFullViewport()),this.renderer.setScissor(this.renderer.getFullViewport()),this.renderer.render(E,v),b.dispose(),f.destroy(),v.dispose(),e.texture.destroy(),e.texture=a,e.packing=o,!0}async updateAtlas(e,n){const r=this.allAtlas.get(e);if(r){for(const i of n)i.disposeResource||await this.draw(r,i);for(let i=0,s=n.length;i<s;++i){const a=n[i];a.disposeResource?r.stopUsingResource(a):r.useResource(a)}r.resolveResources()}else console.warn("Can not update non-existing atlas:",e,"These resources will not be loaded:",n);return r}}const N0=Ye("performance");class Sf{setDeclaration(e,n,r,i){e.has(n)&&N0(`%s: Overriding declaration %s
Setting new value: %s`,i||"Expand IO Declarations",n,r),e.set(n,r)}}class Is extends Sf{expand(e,n,r,i){return{instanceAttributes:[],uniforms:[],vertexAttributes:[]}}validate(e,n,r,i){return!0}processHeaderInjection(e,n,r,i,s,a,o){return{injection:""}}processAttributeDestructuring(e,n,r,i,s,a){return""}}const P0="TextureIOExpansion";function D0(t,e,n){return t&&t.resource&&e.getResourceType(t.resource.key())===n&&t.resource.name!==void 0&&t.resource.key!==void 0}class Ga extends Is{constructor(e,n){super(),this.manager=n,this.resourceType=e}expand(e,n,r,i){const s=this.manager,a=[],o=new Map;n.forEach(u=>{if(D0(u,this.manager.router,this.resourceType)){u.size===void 0&&(u.size=k.FOUR);const h=u.resource.shaderInjection||P.FRAGMENT,f=o.get(u.resource.name);f?o.set(u.resource.name,[f[0]||h===P.VERTEX||h===P.ALL,f[1]||h===P.FRAGMENT||h===P.ALL]):(a.push(u),o.set(u.resource.name,[h===P.VERTEX||h===P.ALL,h===P.FRAGMENT||h===P.ALL]))}});const c=a.map(u=>{let h=P.FRAGMENT;if(u.resource){const f=o.get(u.resource.name);f&&(h=f[0]&&f[1]&&P.ALL||f[0]&&!f[1]&&P.VERTEX||!f[0]&&f[1]&&P.FRAGMENT||h)}return[{name:u.resource.name,shaderInjection:h,size:L.TEXTURE,update:()=>{const f=s.getResource(u.resource.key());return f&&f.texture||Re.emptyTexture}},{name:`${u.resource.name}_size`,shaderInjection:h,size:L.TWO,update:()=>{const f=s.getResource(u.resource.key());if(f){const p=f.texture;if(p&&p.data){const{width:m,height:v}=p.data;return[m||1,v||1]}}return[1,1]}}]}),l=[];return c.forEach(u=>u.forEach(h=>l.push(h))),{instanceAttributes:[],vertexAttributes:[],uniforms:l}}validate(e,n,r,i){let s=!1;return n.forEach(a=>{a.easing&&a.resource&&(console.warn("An instance attribute can not have both easing and resource properties. Undefined behavior will occur."),console.warn(a),s=!0)}),!s}processHeaderInjection(e,n,r,i,s,a,o){const c={injection:""};for(let l=0,u=o.length;l<u;++l){const h=o[l],f=h.shaderInjection||P.VERTEX;h.size===L.TEXTURE&&f===e&&this.setDeclaration(n,h.name,`uniform sampler2D ${h.name};
`,P0)}return c}}class xf extends Mi{constructor(e){super(),this.resources=new Map,this.requestQueue=new Map,this.requestLookup=new Map,this.atlasManager=e&&e.atlasManager||new Af}get webGLRenderer(){return this._webGLRenderer}set webGLRenderer(e){this._webGLRenderer=e,this.atlasManager.renderer=e}async dequeueRequests(){let e=!1;const n=[];this.requestQueue.forEach((r,i)=>{n.push([i,r])}),this.requestQueue.clear();for(const[r,i]of n)if(i.length>0){e=!0;const s=i.slice(0);i.length=0,await this.atlasManager.updateAtlas(r,s);const a=this.requestLookup.get(r);if(a){const o=new Set;s.forEach(c=>{const l=a.get(c);if(a.delete(c),l&&!c.disposeResource)for(let u=0,h=l.length;u<h;++u){const[f,p]=l[u];f.managesInstance(p)&&(p.active=!0),o.add(p)}}),As(()=>{o.forEach(c=>{c.active=!0,c.resourceTrigger()})})}}return e}destroy(){this.atlasManager.destroy()}destroyResource(e){this.resources.get(e.key)&&(this.atlasManager.destroyAtlas(e.key),this.resources.delete(e.key))}getAtlasTexture(e){const n=this.atlasManager.getAtlasTexture(e);return n&&n.texture||null}getResource(e){return this.resources.get(e)||null}getIOExpansion(){return[new Ga(xe.ATLAS,this)]}async initResource(e){if(Sl(e)){const n=await this.atlasManager.createAtlas(e);this.resources.set(e.key,n)}}request(e,n,r,i){const s=r.key||"",a=r.texture;if(a)return Tr(a);let o=this.requestLookup.get(s);if(o){const l=o.get(r);if(l)return l.push([e,n]),n.active=!1,Tr(r.texture)}else o=new Map,this.requestLookup.set(s,o);r.disposeResource||(n.active=!1);let c=this.requestQueue.get(s);return c||(c=[],this.requestQueue.set(s,c)),c.push(r),o.set(r,[[e,n]]),Tr(a)}updateResource(e){Sl(e)}}const F0=new Image;function Ci(t){return{type:xe.ATLAS,source:F0,...t}}class Mf extends Mi{constructor(){super(...arguments),this.resources=new Map}async dequeueRequests(){return!1}destroy(){this.resources.forEach(e=>e.destroy()),this.resources.clear()}getIOExpansion(){return[new Ga(xe.TEXTURE,this)]}getResource(e){return this.resources.get(e)||null}destroyResource(e){const n=this.resources.get(e.key);n&&(n.destroy(),this.resources.delete(e.key))}async initResource(e){let n=this.resources.get(e.key);if(n){console.warn("Attempted to generate a RenderTexture that already exists for key",e.key);return}n=new Al(e,this.webGLRenderer),this.resources.set(e.key,n)}request(e,n,r,i){const s=this.resources.get(r.key);return s?(r.texture=s.texture,[0,0,1,1]):[0,0,0,0]}resize(){const e=new Map;this.resources.forEach((n,r)=>{n.width>Pt.SCREEN&&n.height>Pt.SCREEN||(n.texture.destroy(),n=new Al(n,this.webGLRenderer),e.set(r,n))}),e.forEach((n,r)=>this.resources.set(r,n))}updateResource(e){this.resources.get(e.key)&&console.warn("UPDATING AN EXISTING RENDER TEXTURE IS NOT SUPPORTED YET")}}function Cs(t){return{type:xe.TEXTURE,...t}}const{ceil:B0,max:If,log2:U0,pow:k0,sqrt:G0}=Math,Lt=[-1,-1];function z0(t,e){const{width:n,height:r}=t;let i;const s=[],a=[];for(let o=0;o<n;++o){s[o]=[],a[o]=[];for(let c=0;c<r;++c){const l=c*(n*4)+o*4;i=e[l+3],i?(s[o][c]=[o,c],a[o][c]=Lt):(s[o][c]=Lt,a[o][c]=[o,c])}}return{seed:s,inverse:a}}function V0(t){const e=[];for(let n=0,r=t.length;n<r;++n)e[n]=[];return e}function Cf(t,e,n=!1){const r=n?-1:1;let i,s,a,o;const c=[];let l=-1;for(let u=0,h=t.length;u<h;++u){const f=t[u];c[u]=[];for(let p=0,m=f.length;p<m;++p)i=f[p],i===e?o=256:(s=[u,p],a=je(i,s),o=G0(mi(a,a))),c[u][p]=o,l=If(o,l)}for(let u=0,h=t.length;u<h;++u){const f=t[u];for(let p=0,m=f.length;p<m;++p)o=c[u][p],c[u][p]=o/l*255*r}return c}function $0(t,e,n,r){let i;const s=Cf(t,n,!0),a=Cf(e,n,!1),o=s.length,c=s;for(let l=0,u=s.length;l<u;++l){const h=s[l],f=a[l];for(let p=0,m=h.length;p<m;++p){const v=h[p],b=f[p];h[p]=v+b}}for(let l=0,u=c.length;l<u;++l){const h=c[l];for(let f=0,p=h.length;f<p;++f){i=h[f];const m=f*(o*4)+l*4;r[m]=i,r[m+1]=i,r[m+2]=i,r[m+3]=255}}}function Lf(t,e){const n=t.length,r=t[0].length;let i=V0(t),s=t,a,o,c,l,u,h,f,p,m;for(let v=0;v<e;++v){const b=i;i=s,s=b;const T=k0(2,e-v-1);for(f=0;f<n;++f)for(p=0;p<r;++p){for(a=[f,p],c=[(i[f-T]||[])[p-T]||Lt,(i[f]||[])[p-T]||Lt,(i[f+T]||[])[p-T]||Lt,(i[f-T]||[])[p]||Lt,(i[f]||[])[p]||Lt,(i[f+T]||[])[p]||Lt,(i[f-T]||[])[p+T]||Lt,(i[f]||[])[p+T]||Lt,(i[f+T]||[])[p+T]||Lt],u=0,l=Number.MAX_VALUE,m=0;m<9;++m){const E=c[m];E!==Lt&&(o=je(E,a),h=mi(o,o),h<l&&(l=h,u=m))}s[f][p]=c[u]}}return s}function W0(t,e=$0){const{width:n,height:r}=t,i=t.getContext("2d");if(!i)return;const s=i.getImageData(0,0,n,r).data,a=If(n,r),o=B0(U0(a)),c=z0(t,s),l=Lf(c.seed,o),u=Lf(c.inverse,o),h=new ImageData(n,r);e(l,u,Lt,h.data),i.putImageData(h,0,0)}function j0(t){}const za=Ye("performance");var Va=(t=>(t[t.BITMAP=0]="BITMAP",t[t.SDF=1]="SDF",t[t.MSDF=2]="MSDF",t))(Va||{});class Of extends Xr{constructor(e){super(e),this.dynamic=!1,this.glyphCount=0,this.glyphMap={},this.kerning={},this.spaceWidth=0,this.type=xe.FONT,this.dynamic=e.dynamic||!1,this.fontSource=e.fontSource,e.characters&&e.characters.forEach(r=>{this.doRegisterGlyph(r[0],r[1])});const n=e.fontMapSize?e.fontMapSize:[Pt._1024,Pt._1024];this.makeGlyphTypeTextureSettings(e.glyphType),this.createTexture(n),this.packing=new yt(0,0,n[0],n[1]),this.addCachedKerning()}get fontString(){return`${this.fontSource.size}px ${this.fontSource.family}`}getKerningCacheName(){return`__deltav_kerning_cache_${this.fontSource.family}__`}addCachedKerning(){if(this.fontSource.localKerningCache){const e=localStorage.getItem(this.getKerningCacheName());if(e){za("Loading cached kerning items:",this.getKerningCacheName());try{const n=JSON.parse(e);let r=0;for(const i in n){let s=typeof i=="string"&&i.length===1;if(!s)continue;const a=n[i],o=this.kerning[i]||{};this.kerning[i]=o;for(const c in a)s=typeof i=="string"&&i.length===1,s&&(o[c]=a[c],r++)}za("Found kerning items in the cache!","Count:",r)}catch{}}}}addKerning(e){let n=!1;for(const r in e){const i=e[r],s=this.kerning[r]||{};this.kerning[r]||(n=!0),this.kerning[r]=s;for(const a in i)s[a]||(n=!0),s[a]=i[a]}if(n&&this.fontSource.localKerningCache)try{za("Storing kerning info in cache...");const r=JSON.stringify(this.kerning);localStorage.setItem(this.getKerningCacheName(),r)}catch{za("Could not cache kerning info")}}createTexture(e){if(this.texture)return;let n;this.textureSettings?n={generateMipMaps:!0,premultiplyAlpha:!0,...this.textureSettings}:n={generateMipMaps:!0,premultiplyAlpha:!0},this.texture=new Re({data:{width:e[0],height:e[1],buffer:null},...n})}destroy(){var e;(e=this.texture)==null||e.destroy()}doRegisterGlyph(e,n){const r=e[0];this.glyphMap[r]?console.warn("A Glyph is already registered with a rendering"):this.glyphMap[r]=n}findMissingCharacters(e){const n=new Set;let r="";for(let i=0,s=e.length;i<s;++i){const a=e[i];!this.glyphMap[a]&&!n.has(a)&&(n.add(a),r+=a)}return r}getGlyphTexture(e){return this.glyphMap[e[0]]||null}getGlyphKerning(e,n){const r=this.kerning[e];return r?r[n]||[0,0]:[0,0]}getGlyphWidth(e,n,r){const i=e.positions[n],s=e.positions[r];if(!n||!r)return 0;const a=this.glyphMap[e.glyphs[r]];return a?s[0]+a.pixelWidth-i[0]:0}async getTruncatedLayout(e,n,r,i,s,a){if(e.size[0]>r){let o="",c=0;for(let m=0,v=n.length;m<v;++m)c+=this.glyphMap[n[m]].pixelWidth;if(c>r)return{fontScale:1,glyphs:"",positions:[],size:[0,0],text:""};let l=0,u=e.positions.length,h=0,f=0,p="";for(;l!==u;){if(h=Math.floor((u-l)/2)+l,p=e.glyphs[h],f=e.positions[h][0]+this.glyphMap[p].pixelWidth+c,f>r)u=h;else if(f<r)l=h;else break;if(Math.abs(l-u)<=1){if(f<r)break;for(;f>r&&h>=0;)h--,f=e.positions[h][0]+this.glyphMap[p].pixelWidth+c;break}}if(f=e.positions[h][0]+this.glyphMap[p].pixelWidth+c,f<r){let m=0,v=0;for(let E=0,S=e.text.length;E<S&&m<=h;++E){const I=e.text[E];v++,Vr(I)||m++}const b=e.text[v-1];let T;for(let E=0,S=n.length;E<S;++E)if(!Vr(n[E])){T=n[E];break}if(b&&T&&!this.kerning[b][T]){const E=await a.estimateKerning([b+T],this.fontString,this.fontSource.size,this.kerning,!1,this.fontSource.embed);this.addKerning(E.pairs)}o=`${e.text.substr(0,v)}${n}`}else o=n;return this.getStringLayout(o,i,s)}return e}getStringWidth(e,n,r){const i=e.text;let s=0,a=i.length;if(typeof n=="string"){const h=i.indexOf(n);if(h<0)return 0;s=h,a=s+n.length}else s=n;r!==void 0&&(a=r);let o=0;const c=Math.min(i.length,s),l=Math.min(i.length,a);for(;o<c;++o)Vr(i[o])&&(s--,a--);for(;o<l;++o)Vr(i[o])&&a--;const u=this.glyphMap[e.text[a]||""];return u?(e.positions[a]||[0,0])[0]-(e.positions[s]||[0,0])[0]+u.pixelWidth:0}getStringLayout(e,n,r){const i=[];let s="";const a=n/this.fontSource.size;let o=Number.MAX_SAFE_INTEGER,c=0,l=0,u=[0,0];const h=this.spaceWidth;let f=0,p="",m,v;for(let E=0,S=e.length;E<S;++E){const I=e[E];if(Vr(I)){f++;continue}m=[0,0],p&&(m=this.kerning[p][I]||[0,0]),u=kn(kn(u,Xe(m,a)),[f*h*a+(E===0?0:r),0]),i.push([u[0],u[1]]),s+=I,v=this.glyphMap[I],o=Math.min(u[1],o),c=Math.max(u[1]+v.pixelHeight*a,c),p=I,l=u[0]+v.pixelWidth*a,f=0}const b=c-o,T=[l,b];for(let E=0,S=i.length;E<S;++E)u=i[E],u[1]-=o;return{fontScale:a,glyphs:s,positions:i,size:T,text:e}}makeGlyphTypeTextureSettings(e){switch(e){case 0:this.textureSettings={magFilter:d.GLSettings.Texture.TextureMagFilter.Linear,minFilter:d.GLSettings.Texture.TextureMinFilter.LinearMipMapLinear,internalFormat:d.GLSettings.Texture.TexelDataType.LuminanceAlpha,format:d.GLSettings.Texture.TexelDataType.LuminanceAlpha};break;case 1:this.textureSettings={magFilter:d.GLSettings.Texture.TextureMagFilter.Linear,minFilter:d.GLSettings.Texture.TextureMinFilter.Linear,internalFormat:d.GLSettings.Texture.TexelDataType.Luminance,format:d.GLSettings.Texture.TexelDataType.Luminance};break;case 2:this.textureSettings={magFilter:d.GLSettings.Texture.TextureMagFilter.Linear,minFilter:d.GLSettings.Texture.TextureMinFilter.Linear,internalFormat:d.GLSettings.Texture.TexelDataType.RGB,format:d.GLSettings.Texture.TexelDataType.RGB};break}}registerGlyph(e,n){this.dynamic?this.doRegisterGlyph(e,n):console.warn("Attempted to register a new glyph with a non-dynamic FontMap")}supportsKerning(e){for(let n=1,r=e.length;n<r;++n){const i=e[n],s=e[n-1];if(this.kerning[s]){if(!this.kerning[s][i])return!1}else return!1}return!0}}const{min:Nf,max:$a}=Math,Jr=document.createElement("canvas");let Yn;function H0(t){const{width:e,height:n}=t.canvas,r=t.getImageData(0,0,e,n).data;let i,s=!1,a=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER;for(let u=0;u<e;++u)for(let h=0;h<n;++h){const f=h*(e*4)+u*4;i=r[f],i>0&&(s=!0,a=Nf(a,h),o=Nf(o,u),c=$a(c,u),l=$a(l,h))}return s?(a-=1,l+=2,c+=2,o-=1,a=$a(a,0),o=$a(o,0),{minX:o,minY:a,maxX:c,maxY:l}):null}function xl(t,e,n,r){if(t=t[0],(Jr.width<e||Jr.height<n)&&(Jr.width=e,Jr.height=n),!Yn){const c=Jr.getContext("2d",{willReadFrequently:!0});if(c)Yn=c;else return null}Yn.clearRect(0,0,Jr.width,Jr.height),Yn.font=r,Yn.fillStyle="white",Yn.fillText(t,e/2,n/2);const i=H0(Yn);if(!i)return{data:Yn.getImageData(0,0,1,1),size:[0,0]};const s=i.maxX-i.minX,a=i.maxY-i.minY;return{data:Yn.getImageData(i.minX,i.minY,s,a),size:[s,a]}}const An=document.createElement("img"),Ot=document.createElement("canvas");function Q0(t,e,n=400,r="normal",i="woff2"){return`
    @font-face {
      font-family: '${t}';
      src: url('${e}') ${i?`format('${i}')`:""};
      font-weight: ${n};
      font-style: ${r};
    }
  `}async function Pf(t,e,n){const r=new ht;if(!An||!Ot)return null;if(n&&e){const h=document.createElementNS(e,"style");h.textContent=n.map(f=>Q0(f.familyName,f.source,f.weight,f.style,f.fontType)).join(`
`),t.prepend(h)}const i=new XMLSerializer().serializeToString(t),o="data:image/svg+xml;base64,"+btoa(i);let c=!1;const l=async()=>{if(c)return;c=!0,Ot.width=An.width*window.devicePixelRatio,Ot.height=An.height*window.devicePixelRatio;const h=Ot.getContext("2d",{willReadFrequently:!0});if(!h){r.resolve(null);return}h.clearRect(0,0,Ot.width,Ot.height),h.mozImageSmoothingEnabled=!1,h.webkitImageSmoothingEnabled=!1,h.msImageSmoothingEnabled=!1,h.imageSmoothingEnabled=!1,h.drawImage(An,0,0,An.width*window.devicePixelRatio,An.height*window.devicePixelRatio),r.resolve(h.getImageData(0,0,Ot.width,Ot.height)),Ot.style.position="absolute",Ot.style.top="100px",Ot.style.left="0px",Ot.style.zIndex="9999",Ot.id="svg-to-data"};return An.onload=l,An.src=o,An.width>0&&An.height>0&&l(),await r.promise}const Wa=Ye("performance"),{floor:Ml}=Math;async function X0(t,e,n,r,i){const s="http://www.w3.org/2000/svg",a=U.MAX_TEXTURE_SIZE/window.devicePixelRatio,o=e*2,c=e*1.3,l=Ml(a/o),u=document.createElementNS(s,"svg");u.setAttribute("width",`${a}px`),u.style.font=t,u.style.fontFamily="RedHatDisplay",u.style.position="relative",u.style.left="0px",u.style.top="0px";const h=[],f=Math.floor(a/c);let p=0,m=0,v=0,b,T,E=0;for(;m<n.all.length;){const V=document.createElementNS(s,"g");b=V,p=Math.floor(h.length/f),V.setAttribute("transform",`translate(0, ${(h.length-p*f)*c})`),h.push(V);let re=a;for(v=0;v<l&&m<n.all.length;v++){const K=document.createElementNS(s,"text");K.setAttribute("x",`${v*o}`),K.setAttribute("dy","1em");const Z=n.all[m];m++;const ce=Z[0],q=Z[1],G=document.createElementNS(s,"tspan"),ie=document.createElementNS(s,"tspan");G.setAttribute("fill","#ff0000"),ie.setAttribute("fill","#0000ff"),G.textContent=ce,ie.textContent=q,K.appendChild(G),K.appendChild(ie),V.appendChild(K),re-=o}if(re>=0){const K=document.createElementNS(s,"text");K.setAttribute("width",`${re}px`),V.appendChild(K),T=K}else T=null;E=re}const S=[];for(let V=0;V<n.all.length;V++)S.push([Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER]);let I=0,x=!1;if(r){const V="M",re=document.createElementNS(s,"text");re.setAttribute("dy","1em"),re.style.width=`${o}`,re.style.height=`${c}`,re.setAttribute("x",`${o*v}`),re.style.font=t;const K=await xl(V,128,128,t);if(K){I=K.size[0];const Z=document.createElementNS(s,"tspan"),ce=document.createElementNS(s,"tspan"),q=document.createElementNS(s,"tspan");if(Z.setAttribute("fill","#ff0000"),q.setAttribute("fill","#0000ff"),Z.textContent=V,q.textContent=V,ce.textContent=" ",re.appendChild(Z),re.appendChild(ce),re.appendChild(q),v<l&&b)b.appendChild(re),E-=o,T&&(T.remove(),E>0&&(b.style.width=`${E}px`,b.appendChild(T)));else{const G=document.createElement("g");p=Math.floor(h.length/f),G.setAttribute("transform",`translate(0, ${(h.length-p*f)*c})`),b=G,b.appendChild(re),h.push(G),T=document.createElementNS(s,"text"),G.appendChild(T)}S.push([Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER]),x=!0}}const D=h.length*c,N=Math.ceil(D/a);let O=null;Wa("Rendering table canvas batches for font kerning analysis",n,h);for(let V=0;V<N;++V){const re=h.splice(0,f),K=re.length*c;for(u.setAttribute("height",`${K}px`);u.lastElementChild;)u.lastElementChild.remove();for(let Z=0,ce=re.length;Z<ce;++Z){const q=re[Z];u.appendChild(q)}if(!O)O=await Pf(u,s,i);else{const Z=await Pf(u,s,i);if(!Z){console.warn("Font Renderer: Could not generate image data for analyzing font kerning");continue}const ce=new Uint8ClampedArray(O.data.length+Z.data.length);ce.set(O.data),ce.set(Z.data,O.data.length),O=new ImageData(ce,a*window.devicePixelRatio,O.height+Z.height)}}Wa("Analyzing rendered data",O);const te=o*window.devicePixelRatio,ne=c*window.devicePixelRatio;if(O){const V=O.data;let re,K,Z,ce,q,G;for(let ie=0,De=O.height;ie<De;ie++)for(let _=0,M=O.width;_<M;_++)re=(M*ie+_)*4,K=V[re+0],Z=V[re+1],ce=V[re+2],G=Ml(ie/ne)*l+Ml(_/te),G<S.length&&(q=S[G],K>0&&Z===0&&ce===0&&(_<q[0]&&(q[0]=_),ie<q[1]&&(q[1]=ie)),K===0&&Z===0&&ce>0&&(_<q[2]&&(q[2]=_),ie<q[3]&&(q[3]=ie)));if(x){const ie=S.pop();if(ie){const De=[ie[2]-ie[0],0],_=Xe(De,1/window.devicePixelRatio);n.spaceWidth=Math.ceil(_[0])-I}}for(let ie=0,De=S.length;ie<De;ie++){const _=n.all[ie],M=_[0],J=_[1],le=S[ie],se=[le[2]-le[0],le[3]-le[1]],ge=n.pairs[M];if(ge){const Te=Xe(se,1/window.devicePixelRatio);ge[J]=[Math.ceil(Te[0]),Te[1]]}}}else console.warn("html2canvas did not produce a valid canvas context to analyze");Wa("Kerning rendering analysis complete",n.pairs)}function Y0(t,e,n){t=t.replace(/\s/g,"");const r=n&&n.all||[],i=n&&n.pairs||{};for(let s=0;s<t.length-1;s++){const a=t[s],o=t[s+1];let c=i[a];c||(c=i[a]={}),(!e[a]||!e[a][o])&&!c[o]&&(c[o]=[0,0],r.push(`${a}${o}`))}return{all:r,pairs:i,spaceWidth:0}}class Df{makeBitmapGlyphs(e,n,r){const i={},s=new Set;for(let o=0,c=e.length;o<c;++o)s.add(e[o]);const a=Array.from(s.values());for(let o=0,c=a.length;o<c;++o){const l=a[o],u=xl(l,r*2,r*2,n);u?i[l]={glyph:u.data,glyphIndex:o}:console.warn("Unable to render character",l,"to font map for rendering.")}return i}async estimateKerning(e,n,r,i,s,a){const o={all:[],pairs:{},spaceWidth:0};Wa("Estimating Kerning for",e);for(let c=0,l=e.length;c<l;++c){const u=e[c];Y0(u,i,o)}return(o.all.length>0||s)&&await X0(n,r,o,s,a),o}}var ei=(t=>(t[t.TEXCOORDS=0]="TEXCOORDS",t[t.IMAGE_SIZE=1]="IMAGE_SIZE",t))(ei||{});function ti(t){return{type:xe.FONT,...t}}function q0(){return".101112131415161718191.202122232425262728292.303132333435363738393.404142434445464748494.505152535455565758595.606162636465666768696.707172737475767778797.808182838485868788898.909192939495969798999.000102030405060708090.$0$1$2$3$4$5$6$7$8$9$%0%1%2%3%4%5%6%7%8%9%-0-1-2-3-4-5-6-7-8-9-+0+1+2+3+4+5+6+7+8+9+)0)1)2)3)4)5)6)7)8)9)(0(1(2(3(4(5(6(7(8(9("}async function K0(t,e){let n=0,r,i;try{if(!e)return;for(const s of e)r=s,n=0,!document.fonts.check(t)&&(n++,i=new FontFace(s.familyName,`url(${s.source})`,{weight:`${s.weight}`,style:s.style}),n++,await i.load(),n++,document.fonts.add(i));await document.fonts.ready}catch(s){switch(console.error("Font embedding Error:"),n){case 0:console.error("Font embedding failed check:",t);break;case 1:console.error("Font embedding failed to create the font face:",r);break;case 2:console.error("Font embedding failed to load the font face:",{fontFace:i,embedding:r});break;case 3:console.error("Font embedding failed to add the font face",{fontFace:i,embedding:r});break}s instanceof Error&&console.error(s.stack||s.message)}}const Ff=Ye("performance");var Bf=(t=>(t[t._16=16]="_16",t[t._32=32]="_32",t[t._64=64]="_64",t[t._128=128]="_128",t))(Bf||{});function Il(t){return t&&t.type===xe.FONT}function Z0(t){return t&&t.type===void 0}function Cl(t){return{key:"",type:xe.FONT,...t}}class Uf{constructor(){this.fontMaps=new Map,this.fontRenderer=new Df}async calculateMetrics(e,n){Ff("Calculating metrics for requests");const r=this.fontMaps.get(e);if(r)for(let i=0,s=n.length;i<s;++i){const o=n[i].metrics;o&&(o.layout=r.getStringLayout(o.text,o.fontSize,o.letterSpacing),o.maxWidth&&(Ff("Calculating truncation for",o.text,o.maxWidth),o.layout=await r.getTruncatedLayout(o.layout,o.truncation||"",o.maxWidth,o.fontSize,o.letterSpacing,this.fontRenderer),o.truncatedText=o.layout.text))}}characterFilterToCharacters(e){const n=new Set;let r="";for(let i=0,s=e.length;i<s;++i){const a=e[i];n.has(a)||(n.add(a),r+=a)}return r}async createFontMap(e){const n=this.characterFilterToCharacters(e.characterFilter||""),r=e.fontSource;let i=Va.SDF;r&&(Z0(r)?i=Va.BITMAP:i=r.type||i);const s=new Of({...e,glyphType:i});return await this.updateFontMapCharacters(n,s),this.fontMaps.set(e.key,s),e.fontSource.preload&&this.updateFontMap(e.key,[ti({key:e.key,character:"",kerningPairs:[e.fontSource.preload],metrics:{fontSize:12,text:e.fontSource.preload,letterSpacing:0}})]),s}destroy(){this.fontMaps.forEach(e=>e.destroy())}destroyFontMap(e){const n=this.fontMaps.get(e);n&&n.destroy()}async updateFontMap(e,n){const r=this.fontMaps.get(e);if(!r)return;let i=[];const s=new Set;for(let o=0,c=n.length;o<c;++o){const l=n[o];if(l.character&&s.add(l.character),l.kerningPairs&&(i=i.concat(l.kerningPairs)),l.metrics&&l.metrics.truncation){const u=l.metrics.truncation.replace(/\s/g,"");i.push(u);for(let h=0,f=l.metrics.truncation.length;h<f;++h)s.add(u)}}for(let o=0,c=i.length;o<c;++o)s.add(i[o]);let a="";s.forEach(o=>a+=o),await K0(r.fontString,r.fontSource.embed),await this.updateFontMapCharacters(a,r),await this.updateKerningPairs(i,r);for(let o=0,c=n.length;o<c;++o)n[o].fontMap=r}async updateKerningPairs(e,n){if(!n)return;const r=await this.fontRenderer.estimateKerning(e,n.fontString,n.fontSource.size,n.kerning,!n.spaceWidth,n.fontSource.embed);n.addKerning(r.pairs),n.spaceWidth=n.spaceWidth||r.spaceWidth}async updateFontMapCharacters(e,n){if(!n)return;const r=n.texture,i=n.findMissingCharacters(e);if(i.length<=0)return;const s=this.fontRenderer.makeBitmapGlyphs(i,n.fontString,n.fontSource.size);for(const a in s){const o=s[a];if(r!=null&&r.data){const c=new we({x:0,y:0,width:o.glyph.width,height:o.glyph.height}),l=new Xn,u=n.packing.insert({data:l,bounds:c});if(!u){console.warn("Font map is full and could not pack in any more glyphs");return}yt.applyToSubTexture(n.packing,u,l,void 0,!0),r.update(o.glyph,{...u.bounds,y:n.packing.bounds.height-u.bounds.y-u.bounds.height}),l?n.registerGlyph(a,l):console.warn("Could not generate a subtexture for the font map registration.")}else console.warn("Can not update font map as the maps texture data is not defined.")}}async getPrerenderedImageData(e,n,r){const i=[];return r.forEach(s=>{let a=e.glyphs[s];if(a||(a=e.errorGlyph),!e.errorGlyph)return console.warn("The prerendered source provided did NOT provide a proper glyph for rendering when a glyph could not be located."),[];const o=new Image;let c;const l=new Promise(u=>c=u);return o.onload=function(){const u=document.createElement("canvas"),h=u.getContext("2d");if(!h)return;u.width=n,u.height=n,h.drawImage(o,0,0,n,n);const f=h.getImageData(0,0,n,n);c(f)},o.onerror=function(){console.warn("There was an issue with loading the glyph data for character:",s),c(null)},o.src=e.glyphs[s],i.push(l),[]}),await Promise.all(i)}}const Ls=Ye("performance");class kf extends Mi{constructor(){super(...arguments),this.requestLookup=new Map,this.requestQueue=new Map,this.resourceLookup=new Map,this.fontManager=new Uf}async dequeueRequests(){let e=!1;const n=[];this.requestQueue.forEach((r,i)=>{n.push([i,r])}),this.requestQueue.clear();for(let r=0,i=n.length;r<i;++r){const[s,a]=n[r];if(a.length>0){e=!0;const o=a.slice(0);a.length=0,Ls("Processing requests for resource '%s'",s),await this.fontManager.updateFontMap(s,o),await this.fontManager.calculateMetrics(s,o);const c=this.requestLookup.get(s);c?(o.forEach(l=>{const u=c.get(l);if(c.delete(l),u){for(let h=0,f=u.length;h<f;++h){const[p,m]=u[h];p.managesInstance(m)&&(m.active=!0)}As(()=>{const h=new Set;for(let f=0,p=u.length;f<p;++f){const m=u[f][1];h.has(m)||(h.add(m),m.resourceTrigger())}})}}),Ls("All requests for resource '%s' are processed",s)):Ls("There were no Font requests waiting for completion for resource",s)}}return e}destroy(){this.fontManager.destroy()}destroyResource(e){const n=this.resourceLookup.get(e.key);n&&(this.fontManager.destroyFontMap(n.id),this.resourceLookup.delete(e.key))}getResource(e){return this.resourceLookup.get(e)||null}getIOExpansion(){return[new Ga(xe.FONT,this)]}async initResource(e){if(Il(e)){const n=await this.fontManager.createFontMap(e);n&&this.resourceLookup.set(e.key,n),Ls("Font map created->",n)}}request(e,n,r,i){const s=r,a=s.fontMap;let o=null;if(a)return s.character&&(o=a.getGlyphTexture(s.character)),o?s.fetch===ei.IMAGE_SIZE?[o.pixelWidth,o.pixelHeight]:Tr(o):s.fetch===ei.IMAGE_SIZE?[0,0]:Tr(null);const c=r.key;let l=this.requestLookup.get(c);if(l){const h=l.get(s);if(h)return h.push([e,n]),n.active=!1,s.fetch===ei.IMAGE_SIZE?[0,0]:Tr(o)}else l=new Map,this.requestLookup.set(c,l);n.active=!1;let u=this.requestQueue.get(c);return u||(u=[],this.requestQueue.set(c,u)),u.push(s),l.set(s,[[e,n]]),s.fetch?[0,0]:Tr(o)}updateResource(e){if(!Il(e))return;const n=this.resourceLookup.get(e.key);n&&(ol(e.fontSource,n.fontSource)||Ls("Font resources currently do not update. To update their properties simply destroy and recreate for now."))}}const J0=Ye("performance");class Ll{constructor(){this.managers=new Map,this.resourceKeyToType=new Map}async dequeueRequests(){let e=!1;const n=Array.from(this.managers.values());for(let r=0,i=n.length;r<i;++r){const a=await n[r].dequeueRequests();e=e||a}return e}destroy(){this.managers.forEach(e=>e.destroy()),this.resourceKeyToType.clear(),this.managers.clear(),delete this.webGLRenderer}async destroyResource(e){const n=this.managers.get(e.type);if(!n){console.warn(`A Resource is trying to be destroyed but has no manager to facilitate the operation: ${e.type}`);return}return this.resourceKeyToType.delete(e.key),await n.destroyResource(e)}getIOExpansion(){let e=[];return this.managers.forEach(n=>{e=e.concat(n.getIOExpansion())}),e}getManager(e){const n=this.managers.get(e);return n||(console.warn(`A manager was requested that does not exist for type ${e}`),df)}getResourceType(e){return this.resourceKeyToType.get(e)}async initResource(e){const n=this.managers.get(e.type);if(!n){console.warn(`A Resource is trying to be created but has no manager to facilitate the operation: ${e.type}`);return}if(this.resourceKeyToType.has(e.key)){console.warn("Detected two resources with identical keys. The duplicate resource will not be generated:",e.key);return}return this.resourceKeyToType.set(e.key,e.type),await n.initResource(e)}request(e,n,r,i){const s=this.managers.get(r.type);return s?s.request(e,n,r,i):(console.warn(`A Layer is requesting a resource for which there is no manager set. Please make sure a Resource Manager is set for resource of type: ${r.type}`),[-1,-1,-1,-1])}resize(){this.managers.forEach(e=>e.resize())}setManager(e,n){this.managers.get(e)&&J0(`A manager was assigned to a resource type: ${e} that overrides another manager already set to that type.`),n.router=this,this.managers.set(e,n),n.webGLRenderer=this.webGLRenderer}setWebGLRenderer(e){this.webGLRenderer=e,this.managers.forEach(n=>n.webGLRenderer=e)}async updateResource(e){const n=this.managers.get(e.type);if(!n){console.warn(`A Resource is trying to be updated but has no manager to facilitate the operation: ${e.type}`);return}return await n.updateResource(e)}}const Gf=new Ll,ev={createFont:Cl,createAtlas:Ef,createTexture:Rl,createColorBuffer:h0},tv={textureRequest:Cs,atlasRequest:Ci,fontRequest:ti,colorBufferRequest:El};function zf(t){const e=t.canvas.height,n=t.canvas.width,i={aspectRatio:n/e,bottom:-e/2,far:1e7,left:-n/2,near:-100,right:n/2,top:e/2,viewSize:e},s=new Qn({type:Hn.ORTHOGRAPHIC,left:i.left,right:i.right,top:i.top,bottom:i.bottom,near:i.near,far:i.far});return s.scale=[1,-1,1],s.position=[0,0,-300],s.update(),{camera:s,viewport:{bottom:0,left:0,right:0,top:0}}}const nv={[L.ONE]:He.FLOAT,[L.TWO]:He.VEC2,[L.THREE]:He.VEC3,[L.FOUR]:He.VEC4,[L.MATRIX3]:He.MATRIX3x3,[L.MATRIX4]:He.MATRIX4x4,[L.FLOAT_ARRAY]:He.FLOAT_ARRAY,[L.TEXTURE]:He.TEXTURE},rv={[L.ONE]:[0],[L.TWO]:[0,0],[L.THREE]:[0,0,0],[L.FOUR]:[0,0,0,0],[L.MATRIX3]:[0,0,0,0,0,0,0,0,0],[L.MATRIX4]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};function iv(t){return{type:nv[t.size],value:rv[t.size]}}function Vf(t,e,n,r,i){const s=t.getMaterialOptions(),a=new Map;n.forEach((c,l)=>{a.set(l.renderTarget||null,c)}),Object.assign(s,t.props.materialOptions||{}),s.vertexShader=e,s.fragmentShader=a,s.name=t.id,s.uniforms={};for(let c=0,l=r.length;c<l;++c){const u=r[c],h=iv(u);s.uniforms[u.name]=h}for(let c=0,l=i.length;c<l;++c){const u=i[c];s.uniforms[u.name]={type:u.type,value:u.value}}return new ss(s)}function sv(t){return!Array.isArray(t[0])}function $f(t,e,n,r){const i=[];(t.bufferType===qe.INSTANCE_ATTRIBUTE||t.bufferType===qe.INSTANCE_ATTRIBUTE_PACKING)&&(e=1);for(let h=0,f=n.length;h<f;++h){const p=n[h];i.push(new Float32Array(p.size*r*e))}const s=n.length;let a,o,c,l=!1;for(let h=0,f=r;h<f;++h)for(let p=0;p<s;++p)if(o=n[p],a=i[p],c=o.update(h),sv(c))for(let m=h*o.size,v=m+o.size,b=0;m<v;++m,++b)a[m]=c[b];else l=!0;l&&console.warn("A vertex buffer updating method should not use arrays of arrays of numbers.");for(let h=0,f=n.length;h<f;++h){const m=n[h].size*r;for(let v=1,b=e;v<b;++v)i[h].copyWithin(m*v,0,m)}if(t.bufferType===qe.UNIFORM){const h=i[0];for(let f=0,p=e;f<p;++f){const m=f*r;for(let v=0;v<r;++v)h[v+m]=f}}const u=new lr;for(let h=0,f=n.length;h<f;++h){const p=n[h],m=new zn(i[h],p.size);p.materialAttribute=m,u.addAttribute(p.name,m)}return u}function ja(t,e,n,r){const i=new Gc(t,e,n);return i.drawMode=r||d.GLSettings.Model.DrawMode.TRIANGLE_STRIP,i}const br="EasingIOExpansion",{abs:av,max:ov}=Math,cv={duration:0,start:[0],end:[0],startTime:0},Wf={1:"float",2:"vec2",3:"vec3",4:"vec4",9:"mat3",16:"mat4",99:"vec4"},Ol={easingMethod:"easingMethod",T:"T"};function lv(t){return!!t&&t.easing&&t.size!==void 0&&t.size<=4}function uv(t){return t}class jf extends Is{constructor(){super(...arguments),this.baseAttributeName=new Map}expand(e,n,r,i){const s=new Set,a=[],o=[];for(const l of n)lv(l)&&a.push(l);const c={};e.easingId=c;for(let l=0,u=a.length;l<u;++l){const h=a[l],{cpu:f,loop:p,uid:m}=h.easing,{name:v,size:b,update:T}=h,E=m;this.baseAttributeName.set(h,h.name),h.name=`_${h.name}_end`,c[h.name]=E,s.has(E)&&console.error("Undefined behavior occurs if you reuse an IAutoEasingMethod. Please ensure you are using uid() from the util to give the IAutoEasingMethod its uid, or just use the default provided methods"),s.add(E);const S={values:cv};let I,x,D,N,O,te,ne,V,re,K,Z,ce,q;h.update=_=>{if(re=e.surface.frameMetrics,x=h.easing.delay,D=h.easing.duration,ne=T(_),V=re.currentTime,_.easing=ce=_.easing||new Map,K=ce.get(E),!Z||!K?(Z=Q(ne),K=new ff({duration:D,end:Z.copy(ne),start:Z.copy(ne),startTime:V}),ce.set(E,K)):_.reactivate&&(Z.copy(ne,K.end),Z.copy(ne,K.end),K.startTime=V),O=K,N=D,I=x,O.isTimeSet&&(N=O.duration||D,I=O.delay||0),!O.isManualStart){switch(te=1,p){case wn.CONTINUOUS:te=(V-O.startTime)/N,q=!0;break;case wn.REPEAT:te=(V-O.startTime)/N%1,q=!0;break;case wn.REFLECT:{const M=(V-O.startTime)/N;te=av(M/2%1-.5)*2,q=!0;break}case wn.NONE:default:te=(V-O.startTime)/N,q=!1;break}O.start=f(O.start,O.end,te,O.start)}return O.startTime=V+I,Z.copy(ne,O.end),S.values=O,e.animationEndTime=ov(e.animationEndTime,O.startTime+N+re.frameDuration),e.alwaysDraw=q,ne},h.childAttributes=h.childAttributes||[];const G={name:`_${v}_start`,parentAttribute:h,size:b,update:_=>S.values.start};h.childAttributes.push(G),o.push(G);const ie={name:`_${v}_start_time`,parentAttribute:h,size:k.ONE,update:_=>[S.values.startTime]};h.childAttributes.push(ie),o.push(ie);const De={name:`_${v}_duration`,parentAttribute:h,size:k.ONE,update:_=>[S.values.duration]};h.childAttributes.push(De),o.push(De)}return{instanceAttributes:o,vertexAttributes:[],uniforms:[]}}validate(e,n,r,i){let s=!1;return n.forEach(a=>{a.easing&&a.resource&&(console.warn("An instance attribute can not have both easing and resource properties. Undefined behavior will occur."),console.warn(a),s=!0),a.easing&&a.size===void 0&&console.warn("An Instance Attribute with easing MUST have a size declared")}),!s}processAttributeDestructuring(e,n,r,i,s,a){const o="";for(let c=0,l=s.length;c<l;++c){const u=s[c];if(!u.easing||!u.size)continue;const h=this.baseAttributeName.get(u);if(!h){console.warn("Could not determine a base name for an easing attribute.");continue}this.baseAttributeName.delete(u);const f=`_${h}_time`,p=`_${h}_duration`,m=`_${h}_start_time`;switch(u.easing.loop){case wn.CONTINUOUS:{this.setDeclaration(n,f,`  float ${f} = (currentTime - ${m}) / ${p};
`,br);break}case wn.REPEAT:{this.setDeclaration(n,f,`  float ${f} = clamp(fract((currentTime - ${m}) / ${p}), 0.0, 1.0);
`,br);break}case wn.REFLECT:{const v=`_${h}_timePassed`,b=`_${h}_pingPong`;this.setDeclaration(n,v,`  float ${v} = (currentTime - ${m}) / ${p};
`,br),this.setDeclaration(n,b,`  float ${b} = abs((fract(${v} / 2.0)) - 0.5) * 2.0;
`,br),this.setDeclaration(n,f,`  float ${f} = clamp(${b}, 0.0, 1.0);
`,br);break}case wn.NONE:default:{this.setDeclaration(n,f,`  float ${f} = clamp((currentTime - ${m}) / ${p}, 0.0, 1.0);
`,br);break}}this.setDeclaration(n,h,`  ${Wf[u.size]} ${h} = ${u.easing.methodName}(_${h}_start, _${h}_end, _${h}_time);
`,br)}return o}processHeaderInjection(e,n,r,i,s,a,o){const c={injection:""};if(e!==P.VERTEX)return c;const l=new Map;if(c.injection=`// Auto Easing Methods specified by the layer
`,a.forEach(h=>{if(h.easing&&h.size){let f=l.get(h.easing.methodName);f||(f=new Map,l.set(h.easing.methodName,f)),f.set(h.size,h.easing.gpu)}}),l.size===0)return c.injection="",c;const u={name:"Easing Method Generation",values:[Ol.easingMethod]};return l.forEach((h,f)=>{h.forEach((p,m)=>{const v=Wf[m],b={[Ol.easingMethod]:`${v} ${f}(${v} start, ${v} end, float t)`,[Ol.T]:`${v}`},T=wr({options:b,required:u,shader:p});this.setDeclaration(n,`${v} ${f}`,`${T.shader}
`,br)})}),c}}const ni="BasicIOExpansion",hv=["x","y","z","w"],ri={[L.ONE]:"float",[L.TWO]:"vec2",[L.THREE]:"vec3",[L.FOUR]:"vec4",[L.MATRIX3]:"mat3",[L.MATRIX4]:"mat4",[L.FLOAT_ARRAY]:"float",[L.VEC4_ARRAY]:"vec4",[L.TEXTURE]:"vec4"};function Hf(t){return t&&t.length}function dv(t){const e=t.size;if(e===L.FLOAT_ARRAY||e===L.VEC4_ARRAY){const n=t.update(t);if(Hf(n))return`#define ${t.name}_length ${n.length}
`}return""}function fv(t){const e=t.size;if(e===L.FLOAT_ARRAY||e===L.VEC4_ARRAY){const n=t.update(t);if(Hf(n))return`[${t.name}_length]`}return""}function pv(t,e){return hv.slice(t,t+e).join("")}class Qf extends Is{processAttributeDestructuring(e,n,r,i,s,a){let o="";const c=s.slice(0);switch(e.bufferType){case qe.INSTANCE_ATTRIBUTE:o=this.processDestructuringInstanceAttribute(n,c);break;case qe.INSTANCE_ATTRIBUTE_PACKING:o=this.processDestructuringInstanceAttributePacking(n,c);break}return e.picking.type===ue.SINGLE&&(o+=`
// This portion is where the shader assigns the picking color that gets passed to the fragment shader
_picking_color_pass_ = _pickingColor;
`),o}processDestructuringInstanceAttribute(e,n){return""}processDestructuringInstanceAttributePacking(e,n){let r="";return r+=this.processDestructureBlocks(e,n),r}processDestructureBlocks(e,n){const r="";return n.forEach(i=>{const s=i.block||0;i.size===k.MAT4X4?this.setDeclaration(e,i.name,`  ${ri[i.size]} ${i.name} = mat4(block${s}, block${s+1}, block${s+2}, block${s+3});
`,ni):i.size===k.FOUR?this.setDeclaration(e,i.name,`  ${ri[i.size]} ${i.name} = block${s};
`,ni):this.setDeclaration(e,i.name,`  ${ri[i.size||1]} ${i.name} = block${s}.${pv(i.blockIndex||0,i.size||1)};
`,ni)}),r}processHeaderInjection(e,n,r,i,s,a,o){let c={injection:""};e===P.VERTEX&&(c=this.processAttributeHeader(n,r,i,s,a));const l=this.processUniformHeader(n,o,e);return{...c,injection:c.injection+l}}processAttributeHeader(e,n,r,i,s){let o=`// Shader input
`;return o+=this.processVertexAttributes(e,i),n.bufferType===qe.INSTANCE_ATTRIBUTE&&s.length>0&&(o+=this.processInstanceAttributeBufferStrategy(e,s)),n.bufferType===qe.INSTANCE_ATTRIBUTE_PACKING&&s.length>0&&(o+=this.processInstanceAttributePackingBufferStrategy(e,r.instanceMaxBlock)),{injection:o,material:void 0}}processUniformHeader(e,n,r){const i="",s=r||P.VERTEX;return n.forEach(a=>{a.shaderInjection=a.shaderInjection||P.VERTEX,(a.shaderInjection===s||a.shaderInjection===P.ALL)&&this.setDeclaration(e,a.name,`${dv(a)}uniform ${a.qualifier||""}${a.qualifier?" ":""}${ri[a.size]} ${a.name}${fv(a)};
`,ni)}),i}processInstanceAttributeBufferStrategy(e,n){let r="attribute";return U.SHADERS_3_0&&(r="in"),n.forEach(i=>{this.setDeclaration(e,i.name,`${r} ${ri[i.size||1]} ${i.qualifier||""}${i.qualifier&&" "||""} ${i.name};
`,ni)}),""}processInstanceAttributePackingBufferStrategy(e,n){let r="attribute";U.SHADERS_3_0&&(r="in");for(let i=0,s=n+1;i<s;++i)this.setDeclaration(e,`block${i}`,`${r} ${ri[k.FOUR]} block${i};
`,ni);return""}processVertexAttributes(e,n){let r="attribute";return U.SHADERS_3_0&&(r="in"),n.forEach(i=>{this.setDeclaration(e,i.name,`${r} ${ri[i.size]} ${i.qualifier||""}${i.qualifier&&" "||""}${i.name};
`,ni)}),""}}const gv=`if (_active < 0.5) {
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
return;
}`,mv="instanceData",vv="_active",yv="ActiveIOExpansion";class Xf extends Is{processAttributeDestructuring(e,n,r,i,s,a){const o="";return s.find(c=>c.name===vv)&&this.setDeclaration(n,"__active_attribute_handler__",gv,yv),o}}function wv(t){return t&&t.buffer&&t.buffer.value}function Yf(t){return t&&t.propertyToBufferLocation}class Ha{constructor(e,n){this.add=()=>{},this.remove=r=>r,this.layer=e,this.scene=n}changesProcessed(){delete this.changeListContext}incomingChangeList(e){this.changeListContext=e}makeLayerMaterial(){const e=this.layer.shaderIOInfo;return Vf(this.layer,e.vs,e.fs,e.uniforms,e.materialUniforms)}}let Li={};function Er(t,e){const n=Li[t]||[e,-1,0];Li[t]=n,n[2]++,clearTimeout(n[1]),n[1]=window.setTimeout(()=>{e(n[2],t),delete Li[t]},1)}function qf(){for(const t in Li){const e=Li[t];clearTimeout(e[1]),e[0](e[2],t)}Li={}}const Oi=Ye("performance"),{max:Tv}=Math;function bv(t){return!!(t&&t.buffer&&t.buffer.value)}function Kf(t){return Yf(t)}class Zf extends Ha{constructor(e,n){super(e,n),this.allBufferLocations={},this.availableLocations=[],this.currentInstancedCount=0,this.instanceToBufferLocation={},this.maxInstancedCount=0,this.attributeToPropertyIds=new Map,this.updateAllPropertyIdList=[],this.activePropertyId=-1,this.currentAvailableLocation=-1,this.remove=r=>{const i=this.instanceToBufferLocation[r.uid];return i&&(delete this.instanceToBufferLocation[r.uid],this.availableLocations.push(i)),r},this.add=this.doAddWithRegistration}changesProcessed(){super.changesProcessed(),this.availableLocations.splice(0,this.currentAvailableLocation+1),this.currentAvailableLocation=-1}doAddWithRegistration(e){mt.setObservableMonitor(!0),this.layer.shaderIOInfo.instanceAttributes.forEach(r=>{if(r.parentAttribute)return;r.update(e);const i=mt.getObservableMonitorIds(!0);this.attributeToPropertyIds.set(r,[i[i.length-1]]),i.length>1&&Oi("Property has multiple observables. Only the last trigger will be retained as the feature is not complete yet"),r===this.layer.shaderIOInfo.activeAttribute&&(this.activePropertyId=i[0])}),mt.setObservableMonitor(!1),this.makeUpdateAllPropertyIdList();const n=this.resizeBuffer();return this.gatherLocationsIntoGroups(n.newLocations,n.growth),this.add=this.doAdd,this.doAdd(e)}doAdd(e){if(this.availableLocations.length<=0||this.currentAvailableLocation>=this.availableLocations.length-1){const r=this.resizeBuffer();this.gatherLocationsIntoGroups(r.newLocations,r.growth)}const n=this.availableLocations[++this.currentAvailableLocation];return n&&this.geometry?(this.instanceToBufferLocation[e.uid]=n,this.currentInstancedCount=this.geometry.maxInstancedCount=Tv(this.currentInstancedCount,n.instanceIndex+1),this.model&&(this.model.vertexDrawRange=[0,this.layer.shaderIOInfo.instanceVertexCount],this.model.drawInstances=this.currentInstancedCount,this.layer.shaderIOInfo.instanceVertexCount===0&&(this.model.vertexDrawRange[1]=this.model.drawInstances))):console.error("Add Error: Instance Attribute Buffer Manager failed to pair an instance with a buffer location"),n}destroy(){this.geometry&&this.geometry.destroy(),this.material&&this.material.dispose(),this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model)}getBufferLocations(e){return this.instanceToBufferLocation[e.uid]}getActiveAttributePropertyId(){return this.activePropertyId}getUpdateAllPropertyIdList(){return this.updateAllPropertyIdList}managesInstance(e){return this.instanceToBufferLocation[e.uid]!==void 0}makeUpdateAllPropertyIdList(){const e={};this.attributeToPropertyIds.forEach(n=>{e[n[0]]=n[0]}),this.updateAllPropertyIdList=Object.values(e).filter(Boolean)}removeFromScene(){this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model),delete this.scene}resizeBuffer(){var i;Oi("Gathering resize growth amount...");const e=this.layer.shaderIOInfo;let n=0;const r=new Map;if(this.changeListContext){n=1e3;for(let s=0,a=this.changeListContext.length;s<a;++s){const o=this.changeListContext[s];switch(o[1]){case Je.CHANGE:case Je.INSERT:this.instanceToBufferLocation[o[0].uid]||n++;break}}}if(Oi("BEGIN: Resizing unpacked attribute buffer by %d instances",n),this.geometry){this.geometry.destroy(),this.geometry=new lr;const s=this.maxInstancedCount;for(const a of e.vertexAttributes)a.materialAttribute&&this.geometry.addAttribute(a.name,a.materialAttribute);this.maxInstancedCount+=n,this.attributes=this.attributes||[];for(const a of this.attributes){const o=a.bufferAttribute,c=a.size||0;if(o.data instanceof Float32Array){let l=o.data;l.length<this.maxInstancedCount*c&&(l=new Float32Array(this.maxInstancedCount*c*2),l.set(o.data,0));const u=new zn(l,c,!0,!0);u.setDynamic(!0),a.bufferAttribute=u,this.geometry.addAttribute(a.name,u);let h=r.get(a.name);const f=this.allBufferLocations[a.name]||[];this.allBufferLocations[a.name]=f;for(let b=0,T=f.length;b<T;++b)f[b].buffer.value=l;h||(h=[],r.set(a.name,h));let p,m=h.length;const v=this.maxInstancedCount-s;h.length+=v,f.length+=v;for(let b=s,T=this.maxInstancedCount;b<T;++b,++m)p={attribute:a,buffer:{value:l},instanceIndex:b,range:[b*c,b*c+c]},h[m]=p,f[b]=p}}(i=this.scene)!=null&&i.container&&this.model&&this.scene.container.remove(this.model)}else{this.maxInstancedCount+=n,this.geometry=new lr;for(const s of e.vertexAttributes)s.materialAttribute&&this.geometry.addAttribute(s.name,s.materialAttribute);this.attributes=[];for(const s of e.instanceAttributes){const a=s.size||0,o=new Float32Array(a*this.maxInstancedCount),c=new zn(o,a,!0,!0);c.setDynamic(!0),this.geometry.addAttribute(s.name,c);let l=r.get(s.name);l||(l=[],r.set(s.name,l));const u=this.allBufferLocations[s.name]||[];this.allBufferLocations[s.name]=u;const h=Object.assign({},s,{uid:Y(),bufferAttribute:c});for(let f=0;f<this.maxInstancedCount;++f){const p={attribute:h,buffer:{value:o},instanceIndex:f,range:[f*a,f*a+a]};l.push(p),u.push(p)}this.attributes.push(h)}this.geometry.maxInstancedCount=0,this.material=this.makeLayerMaterial();for(let s=0,a=e.uniforms.length;s<a;++s){const o=e.uniforms[s];o.materialUniforms.push(this.material.uniforms[o.name])}}return this.scene&&this.model&&this.scene.container&&this.scene.container.remove(this.model),this.material=this.material||this.makeLayerMaterial(),this.model=ja(this.layer.id,this.geometry,this.material,e.drawMode),this.scene&&this.scene.container&&this.model&&this.scene.container.add(this.model),Oi("COMPLETE: Resizing unpacked attribute buffer"),{growth:n,newLocations:r}}gatherLocationsIntoGroups(e,n){if(this.attributeToPropertyIds.size===0)return;Oi("BEGIN: Unpacked attribute manager grouping new buffer locations");const r=[];this.attributeToPropertyIds.forEach((u,h)=>{r.push({attribute:h,bufferLocationsForAttribute:e.get(h.name)||[],childBufferLocations:(h.childAttributes||[]).map(f=>({location:e.get(f.name)||[],bufferIndex:-1})),ids:u,bufferIndex:-1})});let i,s,a,o,c,l;for(let u=0;u<n;++u){const h={instanceIndex:-1,propertyToBufferLocation:{}};for(let f=0,p=r.length;f<p;++f){if(i=r[f],s=i.attribute,a=i.ids,o=i.bufferLocationsForAttribute,!o){Er("Instance Attribute Buffer Error",(m,v)=>{console.warn(`${v}: There is an error in forming buffer location groups in InstanceAttributeBufferManager. Error count: ${m}`)});continue}if(c=o[++i.bufferIndex],!c){Er("Instance Attribute Buffer Error",(m,v)=>{console.warn(`${v}: There is an error in forming buffer location groups in InstanceAttributeBufferManager. Error count: ${m}`)});continue}if(h.instanceIndex===-1)h.instanceIndex=c.instanceIndex;else if(c.instanceIndex!==h.instanceIndex){Er("Instance Attribute Parallelism Error",(m,v)=>{console.warn(`${v}: A buffer location does not have a matching instance index which means the buffer locations are not in parallel with each other somehow. Error count: ${m}`),console.warn(s.name,c)});continue}if(s.childAttributes){c.childLocations=[];for(let m=0,v=s.childAttributes.length;m<v;++m){const b=i.childBufferLocations[m];if(b){const T=b.location[++b.bufferIndex];T?c.childLocations.push(T):(l=s.childAttributes[m],Er("Instance Attribute Child Attribute Error",(E,S)=>{console.warn(`${S}: A child attribute does not have a buffer location available. Error count: ${E}`),console.warn(`Parent Attribute: ${s.name} Child Attribute: ${l.name}`)}))}}}for(let m=0,v=a.length;m<v;++m)h.propertyToBufferLocation[a[m]]=c}this.availableLocations.push(h)}Oi("COMPLETE: Unpacked attribute buffer manager buffer location grouping"),qf()}getInstanceCount(){return this.maxInstancedCount}}const{max:Ev}=Math,Ni=Ye("performance");class Jf extends Ha{constructor(e,n){super(e,n),this.allBufferLocations={},this.availableLocations=[],this.currentInstancedCount=0,this.instanceToBufferLocation={},this.maxInstancedCount=1e3,this.blockSubAttributesLookup=new Map,this.attributeToPropertyIds=new Map,this.updateAllPropertyIdList=[],this.activePropertyId=-1,this.currentAvailableLocation=-1,this.remove=r=>{const i=this.instanceToBufferLocation[r.uid];return i&&(delete this.instanceToBufferLocation[r.uid],this.availableLocations.push(i)),r},this.add=this.doAddWithRegistration}changesProcessed(){super.changesProcessed(),this.availableLocations.splice(0,this.currentAvailableLocation+1),this.currentAvailableLocation=-1}doAddWithRegistration(e){this.layer.shaderIOInfo.instanceAttributes.forEach(r=>{if(r.parentAttribute)return;mt.setObservableMonitor(!0),r.update(e);const i=mt.getObservableMonitorIds(!0);this.attributeToPropertyIds.set(r,[i[i.length-1]]),i.length>1&&Ni("Property has multiple observables. Only the last trigger will be retained as the feature is not complete yet"),r===this.layer.shaderIOInfo.activeAttribute&&(this.activePropertyId=i[0])}),mt.setObservableMonitor(!1),this.makeUpdateAllPropertyIdList();const n=this.resizeBuffer();return this.gatherLocationsIntoGroups(n.newLocations,n.growth),this.add=this.doAdd,this.doAdd(e)}doAdd(e){if(this.availableLocations.length<=0||this.currentAvailableLocation>=this.availableLocations.length-1){const r=this.resizeBuffer();this.gatherLocationsIntoGroups(r.newLocations,r.growth)}const n=this.availableLocations[++this.currentAvailableLocation];return n&&this.geometry?(this.instanceToBufferLocation[e.uid]=n,this.currentInstancedCount=this.geometry.maxInstancedCount=Ev(this.currentInstancedCount,n.instanceIndex+1),this.model&&(this.model.vertexDrawRange=[0,this.layer.shaderIOInfo.instanceVertexCount],this.model.drawInstances=this.currentInstancedCount,this.layer.shaderIOInfo.instanceVertexCount===0&&(this.model.vertexDrawRange[1]=this.model.drawInstances))):console.error("Add Error: Instance Attribute Buffer Manager failed to pair an instance with a buffer location"),n}destroy(){this.geometry&&this.geometry.destroy(),this.material&&this.material.dispose(),this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model)}getBufferLocations(e){return this.instanceToBufferLocation[e.uid]}getActiveAttributePropertyId(){return this.activePropertyId}getUpdateAllPropertyIdList(){return this.updateAllPropertyIdList}managesInstance(e){return this.instanceToBufferLocation[e.uid]!==void 0}makeUpdateAllPropertyIdList(){const e={};this.attributeToPropertyIds.forEach(n=>{e[n[0]]=n[0]}),this.updateAllPropertyIdList=Object.values(e).filter(Boolean)}removeFromScene(){this.scene&&this.scene.container&&this.model&&this.scene.container.remove(this.model),delete this.scene}resizeBuffer(){const e=this.layer.shaderIOInfo;let n=0;const r=new Map;if(this.changeListContext){n=1e3;for(let i=0,s=this.changeListContext.length;i<s;++i){const a=this.changeListContext[i];switch(a[1]){case Je.CHANGE:case Je.INSERT:this.instanceToBufferLocation[a[0].uid]||n++;break}}}if(Ni("BEGIN: Resizing packed attribute buffer by %d instances",n),this.geometry){Ni(`Info: Vertex packing buffer is being resized for layer ${this.layer.id}`),this.geometry.destroy(),this.geometry=new lr;const i=this.maxInstancedCount;for(const s of e.vertexAttributes)s.materialAttribute&&this.geometry.addAttribute(s.name,s.materialAttribute);this.maxInstancedCount+=n,this.attributes=this.attributes||[],this.blockAttributes=this.blockAttributes||[];for(let s=0,a=this.blockAttributes.length;s<a;++s){const o=this.blockAttributes[s];let c=o.bufferAttribute;const l=o.size||0;if(c.data instanceof Float32Array){let u=c.data;u.length<this.maxInstancedCount*l&&(u=new Float32Array(this.maxInstancedCount*l*2),u.set(c.data,0)),u.set(c.data,0);const h=new zn(u,l,!0,!0);o.bufferAttribute=c=h,this.geometry.addAttribute(o.name,h);const f=this.blockSubAttributesLookup.get(s),p=o.size||0;if(f)for(let m=0,v=f.length;m<v;++m){const b=f[m];let T=r.get(b.name);T||(T=[],r.set(b.name,T));const E=this.allBufferLocations[b.name]||[];this.allBufferLocations[b.name]=E;const S=Object.assign({},b,{uid:Y(),packUID:o.packUID,bufferAttribute:c}),I=b.blockIndex||0,x=b.size||1;let D;for(let ne=0,V=E.length;ne<V;++ne)D=E[ne],D.attribute=S,D.buffer.value=u;let N,O=T.length;const te=this.maxInstancedCount-i;T.length+=te,E.length+=te;for(let ne=i;ne<this.maxInstancedCount;++ne,++O)N={attribute:S,block:s,buffer:{value:u},instanceIndex:ne,range:[ne*p+I,ne*p+I+x]},T[O]=N,E[ne]=N}}}}else{this.maxInstancedCount+=n,this.geometry=new lr;for(const a of e.vertexAttributes)a.materialAttribute&&this.geometry.addAttribute(a.name,a.materialAttribute);this.attributes=[],this.blockAttributes=[];const i=new Map,s=new Map;this.blockSubAttributesLookup=s;for(let a=0,o=e.instanceAttributes.length;a<o;++a){const c=e.instanceAttributes[a],l=c.block||0;let u=i.get(l)||0;u=Math.max(u,(c.blockIndex||0)+(c.size||0)),i.set(l,u);let h=s.get(l);h||(h=[],s.set(l,h)),h.push(c)}s.forEach(a=>a.sort((o,c)=>(o.blockIndex||0)-(c.blockIndex||0)));for(let a=0,o=i.size;a<o;++a){const c=i.get(a)||0,l=Y();c||console.warn("Instance Attribute Packing Error: The system tried to build an attribute with a size of zero.","These are the attributes used:",e.instanceAttributes,"These are the block sizes calculated",i,"This is the block to attribute lookup generated",s);const u=new Float32Array(c*this.maxInstancedCount),h=new zn(u,c,!0,!0);this.geometry.addAttribute(`block${a}`,h);const f=s.get(a);if(f){for(let p=0,m=f.length;p<m;++p){const v=f[p];let b=r.get(v.name);b||(b=[],r.set(v.name,b));const T=this.allBufferLocations[v.name]||[];this.allBufferLocations[v.name]=T;const E=Object.assign({},v,{uid:a,packUID:l,bufferAttribute:h,size:c}),S=v.blockIndex||0,I=v.size||1;for(let x=0;x<this.maxInstancedCount;++x){const D={attribute:E,block:a,buffer:{value:u},instanceIndex:x,range:[x*c+S,x*c+S+I]};b.push(D),T.push(D)}this.attributes.push(E)}this.blockAttributes.push({uid:Y(),packUID:l,bufferAttribute:h,name:`block${a}`,size:c,update:()=>[0]})}else console.warn("Instance Attribute Packing Buffer Error: Somehow there are no attributes associated with a block.","These are the attributes used:",e.instanceAttributes,"These are the block sizes calculated",i,"This is the block to attribute lookup generated",s)}this.geometry.maxInstancedCount=0,this.material=this.makeLayerMaterial();for(let a=0,o=e.uniforms.length;a<o;++a){const c=e.uniforms[a];c.materialUniforms.push(this.material.uniforms[c.name])}}return this.scene&&this.model&&this.scene.container&&this.scene.container.remove(this.model),this.material=this.material||this.makeLayerMaterial(),this.model=ja(this.layer.id,this.geometry,this.material,this.layer.shaderIOInfo.drawMode),this.scene&&this.scene.container&&this.model&&this.scene.container.add(this.model),Ni("COMPLETE: Resizing unpacked attribute buffer"),{growth:n,newLocations:r}}gatherLocationsIntoGroups(e,n){if(this.attributeToPropertyIds.size===0)return;Ni("BEGIN: Packed attribute manager grouping new buffer locations");const r=[];this.attributeToPropertyIds.forEach((i,s)=>{r.push({attribute:s,bufferLocationsForAttribute:e.get(s.name)||[],childBufferLocations:(s.childAttributes||[]).map(a=>({location:e.get(a.name)||[],bufferIndex:-1})),ids:i,bufferIndex:-1})});for(let i=0;i<n;++i){const s={instanceIndex:-1,propertyToBufferLocation:{}};for(let a=0,o=r.length;a<o;++a){const c=r[a],l=c.attribute,u=c.ids,h=c.bufferLocationsForAttribute;if(!h){Er("Instance Attribute Buffer Error",(p,m)=>{console.warn(`${m}: There is an error in forming buffer location groups in InstanceAttributePackingBufferManager. Error count: ${p}`)});continue}const f=h[++c.bufferIndex];if(!f){Er("Instance Attribute Buffer Error",(p,m)=>{console.warn(`${m}: There is an error in forming buffer location groups in InstanceAttributePackingBufferManager. Error count: ${p}`)});continue}if(s.instanceIndex===-1)s.instanceIndex=f.instanceIndex;else if(f.instanceIndex!==s.instanceIndex){Er("Instance Attribute Parallelism Error",(p,m)=>{console.warn(`${m}: A buffer location does not have a matching instance index which means the buffer locations are not in parallel with each other somehow. Error count: ${p}`),console.warn(l.name,f)});continue}if(l.childAttributes){const p=[];for(let m=0,v=l.childAttributes.length;m<v;++m){const b=l.childAttributes[m],T=c.childBufferLocations[m];if(T){const E=T.location[++T.bufferIndex];E?p.push(E):Er("Instance Attribute Child Attribute Error",(S,I)=>{console.warn(`${I}: A child attribute does not have a buffer location available. Error count: ${S}`),console.warn(`Parent Attribute: ${l.name} Child Attribute: ${b.name}`)})}}f.childLocations=p}for(let p=0,m=u.length;p<m;++p){const v=u[p];s.propertyToBufferLocation[v]=f}}this.availableLocations.push(s)}Ni("COMPLETE: Packed attribute buffer manager buffer location grouping"),qf()}getInstanceCount(){return this.maxInstancedCount}}function ep(t){return t&&t.buffer&&t.buffer.value&&t.type===He.VEC4_ARRAY}class tp extends Ha{constructor(e,n){super(e,n),this.buffers=[],this.availableClusters=[],this.instanceToCluster={},this.clusterToBuffer=new Map,this.add=i=>{this.availableClusters.length<=0&&this.makeNewBuffer();const s=this.availableClusters.pop();return s?this.instanceToCluster[i.uid]=s:console.warn("No valid cluster available for instance added to uniform manager."),s},this.remove=i=>{const s=this.instanceToCluster[i.uid];return s&&(delete this.instanceToCluster[i.uid],this.availableClusters.push(s)),i};let r=0;e.shaderIOInfo.instanceAttributes.forEach(i=>{r=Math.max(i.block||0,r)}),this.uniformBlocksPerInstance=r+1}destroy(){this.buffers.forEach(e=>{e.geometry.destroy(),e.material.dispose()})}getBufferLocations(e){return this.instanceToCluster[e.uid]}getActiveAttributePropertyId(){return-1}getInstanceCount(){return-1}getUpdateAllPropertyIdList(){return[]}managesInstance(e){return this.instanceToCluster[e.uid]===void 0}removeFromScene(){const e=this.scene;if(e!=null&&e.container){for(let n=0,r=this.buffers.length;n<r;++n){const i=this.buffers[n];e.container.remove(i.model)}delete this.scene}}setScene(e){if(e.container){for(let n=0,r=this.buffers.length;n<r;++n){const i=this.buffers[n];e.container.add(i.model)}this.scene=e}else console.warn("Can not set a scene that has an undefined container.")}makeNewBuffer(){const e=this.layer.shaderIOInfo,n=new lr;e.vertexAttributes.forEach(u=>{u.materialAttribute&&n.addAttribute(u.name,u.materialAttribute)});const r=this.makeLayerMaterial(),i=ja(this.layer.id,n,r,e.drawMode);i.vertexDrawRange=[0,e.maxInstancesPerBuffer*e.instanceVertexCount];const s={activeInstances:[],clusters:[],firstInstance:0,geometry:n,lastInstance:0,material:r,model:i};this.buffers.push(s);let a=0;const o=mv,c=r.uniforms[o];if(gh(c))c.value=c.value.map(()=>[0,0,0,0]);else{console.warn("Material is utilizing an invalid uniform type for Uniform Buffer Management. Buffering will not be possible.");return}const l=Object.assign({},e.instanceAttributes[0],{bufferAttribute:new zn(new Float32Array(1),1),uid:Y()});for(let u=0,h=e.maxInstancesPerBuffer;u<h;++u){const f={attribute:l,buffer:c,instanceIndex:u,range:[a,0]};a+=this.uniformBlocksPerInstance,f.range[1]=a,s.clusters.push(f),this.availableClusters.push(f),this.clusterToBuffer.set(f,s)}for(let u=0,h=e.uniforms.length;u<h;++u){const f=e.uniforms[u];f.materialUniforms.push(r.uniforms[f.name])}this.scene&&this.scene.container&&this.scene.container.add(s.model)}}class np{constructor(e,n){this.layer=e,this.bufferManager=n}}const Qa=[],{min:Nl,max:Pl}=Math;class _v extends np{constructor(){super(...arguments),this.diffMode=0,this.bufferAttributeUpdateRange={},this.bufferAttributeWillUpdate={},this.updateInstance=this.updateInstancePartial}addInstance(e,n,r,i){if(i)e.changeInstance(e,n,Qa,i);else{const s=e.layer.bufferManager.add(n);Kf(s)&&(n.active=!0,e.layer.onDiffAdd&&e.layer.onDiffAdd(n),e.updateInstance(e.layer,n,Qa,s))}}changeInstance(e,n,r,i){i?e.updateInstance(e.layer,n,r,i):e.addInstance(e,n,Qa,i)}removeInstance(e,n,r,i){i&&(n.active=!1,e.layer.onDiffRemove&&e.layer.onDiffRemove(n),e.updateInstance(e.layer,n,Qa,i),e.layer.bufferManager.remove(n))}updateInstancePartial(e,n,r,i){const s=i.propertyToBufferLocation,a=this.bufferAttributeUpdateRange;let o,c,l,u,h,f;if(n.active){(r.length===0||n.reactivate)&&(r=this.bufferManager.getUpdateAllPropertyIdList());for(let p=0,m=r.length;p<m;++p)if(o=s[r[p]],!!o&&(h=o.attribute,f=h.packUID||h.uid,c=h.update(n),o.buffer.value.set(c,o.range[0]),l=a[f]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER],l[0]=h,l[1]=Nl(o.range[0],l[1]),l[2]=Pl(o.range[1],l[2]),a[f]=l,o.childLocations)){u=o.childLocations;for(let v=0,b=u.length;v<b;++v)o=u[v],o&&(f=o.attribute.packUID||o.attribute.uid,c=o.attribute.update(n),o.buffer.value.set(c,o.range[0]),l=a[f]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER],l[0]=o.attribute,l[1]=Nl(o.range[0],l[1]),l[2]=Pl(o.range[1],l[2]),a[f]=l)}}else o=s[this.bufferManager.getActiveAttributePropertyId()],h=o.attribute,f=h.packUID||h.uid,c=h.update(n),o.buffer.value.set(c,o.range[0]),l=a[f]||[null,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER],l[0]=h,l[1]=Nl(o.range[0],l[1]),l[2]=Pl(o.range[1],l[2]),a[f]=l;n.reactivate=!1}updateInstanceFull(e,n,r,i){const s=i.propertyToBufferLocation,a=this.bufferAttributeWillUpdate;let o,c,l,u;if(n.active){(r.length===0||n.reactivate)&&(r=this.bufferManager.getUpdateAllPropertyIdList());for(let h=0,f=r.length;h<f;++h)if(o=s[r[h]],!!o&&(u=o.attribute,c=u.update(n),o.buffer.value.set(c,o.range[0]),a[u.packUID||u.uid]=u,o.childLocations)){l=o.childLocations;for(let p=0,m=l.length;p<m;++p)o=l[p],o&&(u=o.attribute,c=u.update(n),o.buffer.value.set(c,o.range[0]),a[u.packUID||u.uid]=u)}}else o=s[this.bufferManager.getActiveAttributePropertyId()],u=o.attribute,c=u.update(n),o.buffer.value.set(c,o.range[0]),a[u.packUID||u.uid]=u;n.reactivate=!1}commit(){if(this.diffMode===0){const e=Object.values(this.bufferAttributeUpdateRange);for(let n=0,r=e.length;n<r;++n){const i=e[n],s=i[0].bufferAttribute;s.updateRange={count:i[2]-i[1],offset:i[1]}}}else{const e=Object.values(this.bufferAttributeWillUpdate);for(let n=0,r=e.length;n<r;++n){const i=e[n].bufferAttribute;i.updateRange={count:-1,offset:0}}}this.bufferAttributeUpdateRange={}}incomingChangeList(e){e.length===0?this.diffMode=0:e.length>this.bufferManager.getInstanceCount()*.7?this.diffMode=1:this.diffMode=0,this.diffMode===0?this.updateInstance=this.updateInstancePartial:this.updateInstance=this.updateInstanceFull}}const rp=[];class Rv extends np{addInstance(e,n,r,i){if(i)e.changeInstance(e,n,rp,i);else{const s=e.layer.bufferManager.add(n);ep(s)&&(n.active=!0,e.layer.onDiffAdd&&e.layer.onDiffAdd(n),e.updateInstance(e.layer,n,s))}}changeInstance(e,n,r,i){i?e.updateInstance(e.layer,n,i):e.addInstance(e,n,rp,i)}removeInstance(e,n,r,i){i&&(n.active=!1,e.layer.onDiffRemove&&e.layer.onDiffRemove(n),e.updateInstance(e.layer,n,i),e.layer.bufferManager.remove(n))}updateInstance(e,n,r){if(n.active){const i=r.buffer,s=r.range[0],a=i.value;let o,c,l,u,h,f;for(let p=0,m=e.shaderIOInfo.instanceAttributes.length;p<m;++p)if(o=e.shaderIOInfo.instanceAttributes[p],c=o.update(n),l=a[s+(o.block||0)],u=o.blockIndex,u!==void 0)for(h=u,f=c.length+u;h<f;++h)l[h]=c[h-u];i.value=a}else{const i=r.buffer,s=r.range[0],a=i.value,o=e.shaderIOInfo.activeAttribute,c=o.update(n),l=a[s+(o.block||0)],u=o.blockIndex;if(u!==void 0)for(let h=u,f=c.length+u;h<f;++h)l[h]=c[h-u];i.value=a}}commit(){}incomingChangeList(e){}}class Av{makeProcessor(e,n){if(this.processing)return this.processing;if(e.bufferType===qe.INSTANCE_ATTRIBUTE||e.bufferType===qe.INSTANCE_ATTRIBUTE_PACKING?this.processor=new _v(e,n):this.processor=new Rv(e,n),!this.processor)throw new Error("Failed to create a diff processor");return this.processing=[this.processor.changeInstance,this.processor.addInstance,this.processor.removeInstance],this.processing}}class ip{constructor(e){this.index=0,this.available=4,this.index=e}setAttribute(e){return(e.size||0)<=this.available?(e.block=this.index,e.blockIndex=4-this.available,this.available-=e.size||0,!0):!1}}function Sv(t){t.forEach(e=>{if(e.resource&&e.size===void 0&&(e.size=k.FOUR),!e.size)try{const n=e.update(new dt({}));n.length>0&&n.length<=k.FOUR&&(e.size=n.length)}catch{console.warn("The system could not determine the size of the provided attribute. Please provide the size of the attribute:",e)}})}function sp(t){Sv(t);const e=[];t.forEach(n=>{if(n.size&&n.size===k.MAT4X4){n.block=e.length,n.blockIndex=Fc.INVALID;for(let i=0;i<4;++i){const s=new ip(e.length);s.available=0,s.index=0,e.push(s)}return}if(!e.find(i=>i.setAttribute(n)?!!i:!1)){const i=new ip(e.length);e.push(i),i.setAttribute(n)||console.warn("There was a problem packing an attribute into a block. No block would accommodate it:",n)}})}function ap(t){return!!t}function op(t){return!!t}function cp(t){return!!t}function xv(t){return Object.assign({},t,{materialAttribute:null})}function Mv(t){return Object.assign({},t,{materialUniforms:[]})}function Iv(t,e,n,r){e.forEach(i=>{i.name===void 0&&console.warn("All instance attributes MUST have a name on Layer:",t.id),e.find(s=>s!==i&&s.name===i.name)&&console.warn("An instance attribute can not have the same name used more than once:",i.name),n.find(s=>s.name===i.name)&&console.warn("An instance attribute and a vertex attribute in a layer can not share the same name:",i.name),i.resource||i.size===void 0&&(console.warn("An instance attribute requires the size to be defined."),console.warn(i))})}function Cv(t,e,n){if(!n)return;let r=e.instanceAttributes||[],i=e.uniforms||[],s=e.vertexAttributes||[];n.shaderModuleUnits.forEach(l=>{l.instanceAttributes&&(r=r.concat(l.instanceAttributes(t))),l.uniforms&&(i=i.concat(l.uniforms(t))),l.vertexAttributes&&(s=s.concat(l.vertexAttributes(t)))});const a=new Set,o=new Set,c=new Set;i.filter(l=>l?a.has(l.name)?(console.warn("Included shader modules has introduced duplicate uniform names:",l.name,"One will be overridden thus causing a potential crash of the shader."),!1):(a.add(l.name),!0):!1),r.filter(l=>l?o.has(l.name)?(console.warn("Included shader modules has introduced duplicate Instance Attribute names:",l.name,"One will be overridden thus causing a potential crash of the shader."),!1):(o.add(l.name),!0):!1),s.filter(l=>l?c.has(l.name)?(console.warn("Included shader modules has introduced duplicate Vertex Attribute names:",l.name,"One will be overridden thus causing a potential crash of the shader."),!1):(c.add(l.name),!0):!1),e.instanceAttributes=r,e.uniforms=i,e.vertexAttributes=s}function lp(t,e,n,r,i,s){Cv(e,n,s);const a=(n.instanceAttributes||[]).filter(ap),o=(n.vertexAttributes||[]).filter(op),c=(n.uniforms||[]).filter(cp);for(let f=0,p=r.length;f<p;++f){const m=r[f];if(m.validate(e,a,o,c)){const v=m.expand(e,a,o,c);v.instanceAttributes.filter(ap).forEach(b=>a.push(b)),v.vertexAttributes.filter(op).forEach(b=>o.push(b)),v.uniforms.filter(cp).forEach(b=>c.push(b))}}Iv(e,a,o);const l=a.slice(0),u=(o||[]).map(xv),h=c.map(Mv);return l.sort(i.sortInstanceAttributes),h.sort(i.sortUniforms),u.sort(i.sortVertexAttributes),sp(l),e.getLayerBufferType(t,o,l),{instanceAttributes:l,uniforms:h,vertexAttributes:u}}class Dl{static calculateUniformBlockUseage(e){let n=0;for(let r=0,i=e.length;r<i;++r)n+=Math.ceil(e[r].size/4);return n}process(e,n){this.instanceMaxBlock=0,e.forEach(r=>{this.instanceMaxBlock=Math.max(this.instanceMaxBlock,r.block||0)}),this.blocksPerInstance=this.instanceMaxBlock+1,this.maxUniforms=U.MAX_VERTEX_UNIFORMS,this.maxUniformsForInstancing=this.maxUniforms-Dl.calculateUniformBlockUseage(n),this.maxInstancesPerUniformBuffer=Math.floor(this.maxUniformsForInstancing/this.blocksPerInstance),this.totalInstanceUniformBlocks=this.maxInstancesPerUniformBuffer*this.blocksPerInstance}}const Os="Once a ShaderModuleUnit has been registered, you CAN NOT modify it! Module ID:";class Xa{constructor(e){this._dependents=null,Object.assign(this,e)}get content(){return this._content}set content(e){if(this._isLocked){console.warn(Os,this._moduleId);return}this._content=e}get compatibility(){return this._compatibility}set compatibility(e){if(this._isLocked){console.warn(Os,this._moduleId);return}this._compatibility=e}get dependents(){return this._dependents}set dependents(e){if(this._isLocked&&this._dependents!==null){console.warn(Os,this._moduleId);return}this._dependents=e}isLocked(){return this._isLocked}get moduleId(){return this._moduleId}set moduleId(e){if(this._isLocked){console.warn(Os,this._moduleId);return}this._moduleId=e}applyAnalyzedContent(e){if(this._isLocked&&this.dependents!==null){console.warn(Os,this._moduleId);return}this._content=e}lock(){this._isLocked=!0}}const up=Ye("performance"),Lv=Ye("shader-module-vs"),Ov=Ye("shader-module-fs"),hp="import",dp=":";function fp(t,e){return!!t&&(t.compatibility===e||t.compatibility===P.ALL)}const _r=class{static register(t){if(!(t instanceof Xa)){if(Array.isArray(t)){let a="";return t.forEach(o=>{const c=_r.register(o);c&&(a+=`${c}
`)}),a||null}return _r.register(new Xa(t))}let e=_r.modules.get(t.moduleId);e||(e={},_r.modules.set(t.moduleId,e));const n=e.fs,r=e.vs,i=fp(t,P.FRAGMENT),s=fp(t,P.VERTEX);if(n&&i){if(n.isFinal)return`Module ID: ${t.moduleId} Can not override the module's existing Fragment registration as the exisitng module is marked as final`;up("A Shader Module Unit has overridden an existing module for the Fragment Shader Module ID: %o",t.moduleId)}if(r&&s){if(r.isFinal)return`Module ID: ${t.moduleId} Can not override the module's existing Vertex registration as the exisitng module is marked as final`;up("A Shader Module Unit has overridden an existing module for the Vertex Shader Module ID: %o",t.moduleId)}return i&&(e.fs=t),s&&(e.vs=t),t.lock(),null}static analyzeDependents(t){if(t.dependents&&t.isLocked())return[];const e=[],n=[],r=new Set,i=t.compatibility,s=t.moduleId,a=wr({options:{},shader:t.content,onToken:o=>{const c=o.trim();if(c.indexOf(hp)===0){const l=c.substr(hp.length).trim();if(l[0]===dp){let u=!1;const h=l.substr(dp.length).trim().split(",");return h[h.length-1].trim().length===0&&h.pop(),h.forEach(f=>{f=f.trim();const p=_r.modules.get(f);p?((i===P.FRAGMENT||i===P.ALL)&&(p.fs?(u=!0,r.has(f)||n.push(f)):e.push(`Could not find requested target fragment module for Module ID: ${f} requested by module: ${s}`)),(i===P.VERTEX||i===P.ALL)&&(p.vs?(u=!0,r.has(f)||n.push(f)):e.push(`Could not find requested target vertex module for Module ID: ${f} requested by module: ${s}`)),!p.vs&&!p.fs&&e.push("Could not find a vertex or fragment shader within exisitng module"),u||e.push(`Error Processing module Module ID: ${f} requested by module: ${s}`)):e.push(`Could not find requested module: ${f} requested by module: ${s}`)}),""}}return`\${${o}}`}});return t.applyAnalyzedContent(a.shader),t.dependents=n,e}static process(t,e,n,r){const i=new Set,s=new Set,a=[],o=[],c=n===P.VERTEX?Lv:Ov;c("Processing Shader for context %o:",t);function l(m){const v=m.moduleId;c("%o: %o",v,a.slice(0).reverse().join(" -> "));const b=a.indexOf(v);if(a.unshift(v),b>-1){const T=a.slice(0,b+2).reverse();return o.push(`A Shader has detected a Circular dependency in import requests: ${T.join(" -> ")}`),a.shift(),!1}return!0}function u(m){const v=m.moduleId;if(!l(m))return null;if(v&&s.has(v))return a.shift(),"";let b="";_r.analyzeDependents(m).forEach(S=>o.push(S));const E=m.dependents;if(c("Module dependencies detected %o",E),E&&E.length>0)for(let S=0,I=E.length;S<I;++S){const x=E[S],D=_r.modules.get(x);if(D){let N;(n===P.FRAGMENT||n===P.ALL)&&(D.fs?(i.add(D.fs),N=u(D.fs)):o.push(`Could not find requested target fragment module for Module ID: ${x} requested by module: ${v}`)),(n===P.VERTEX||n===P.ALL)&&(D.vs?(i.add(D.vs),N=u(D.vs)):o.push(`Could not find requested target vertex module for Module ID: ${x} requested by module: ${v}`)),!D.vs&&!D.fs&&o.push("Could not find a vertex or fragment shader within exisitng module"),N===null&&o.push(`Error Processing module Module ID: ${x} requested by module: ${v}`),b+=N||""}else o.push(`Could not find requested module: ${x} requested by module: ${v}`)}return a.shift(),s.add(v||""),`${b.trim()}

${m.content.trim()}`}let h=e;if(r){let m="";r.forEach(v=>{m+=`\${import: ${v}}
`}),h=m+e}const f=new Xa({content:h,compatibility:n,moduleId:`Layer "${t}" ${n===P.ALL?"fs vs":n===P.VERTEX?"vs":"fs"}`});return{errors:o,shader:u(f),shaderModuleUnits:i}}};let Qe=_r;Qe.modules=new Map;const pp={attributes:"attributes",easingMethod:"easingMethod",extend:"extend",extendHeader:"extendHeader",T:"T"},Ya="out",qa=":";class gp{constructor(){this.metricsProcessing=new Dl}static mergeFragmentOutputsForMRT(e,n,r,i,s,a){let o="",c="",l="";const u=new Set,h=[],f=new Set;return U.MRT||(l=" = gl_FragColor"),r.forEach((p,m)=>{let v=!0,b=!1;if(s&&s.indexOf(p.outputType)<0&&(v=!1),a&&m<r.length-1&&(v=!1),!a&&i.indexOf(p.outputType)<0&&(v=!1),f.has(p.outputType))throw new Error("Can not use the same Output Fragment type multiple times");f.add(p.outputType);const T=i.indexOf(p.outputType);wr({shader:Ms(p.source),onToken(E){const S=E.trim();if(S.indexOf(Ya)===0){if(b)throw console.error("Found multiple ${out} tokens in a single fragment shader. This is not supported nor logical","If you need to use the declared output multiple times, use the assigned name","and don't wrap it repeatedly in the shader.","eg-","void main() {","  ${out: myOutput} = value;","  vec4 somethingElse = myOutput;","}"),new Error("Invalid Shader Format");b=!0;const I=S.substr(Ya.length).trim();if(I[0]===qa){const x=I.substr(qa.length).trim();if(!x)throw new Error("Output in a shader requires an identifier ${out: <name required>}");if(u.has(x))throw new Error("You can not declare the same output name in subsequent fragment shader outputs");if(x==="gl_FragColor")throw new Error("DO not use gl_FragColor as an identifier for an out. Choose something not used by the WebGL spec.");let D="";if(v)if(u.add(x),h.push(p.outputType),U.MRT_EXTENSION)l=` = gl_FragData[${T}]`,D="vec4 ";else if(U.MRT&&U.SHADERS_3_0)n.set(x,`layout(location = ${T}) out vec4 ${x};
`);else throw new Error(`Could not generate a proper output declaration for the fragment shader output: ${x}`);else D="vec4 ";return`${D}${x}${l}`}else throw new Error("Output in a shader requires an identifier ${out: <name required>}")}return`\${${E}}`},onMain(E,S){return!b&&E&&(E.match("gl_FragColor")?(h.push(p.outputType),U.MRT&&(U.SHADERS_3_0?(n.set("_FragColor",`layout(location = ${T}) out vec4 _FragColor;
`),E=E.replace(/gl_FragColor/g,"_FragColor")):(E=E.replace(/gl_FragColor\s+=/,`vec4 _FragColor = gl_FragData[${T}] =`),E=E.replace(/gl_FragColor\s+=/g,`_FragColor = gl_FragData[${T}] =`),E=E.replace(/gl_FragColor/g,"_FragColor"))),u.add("_FragColor")):h.push(oe.NONE)),o+=`
${(S||"").trim()}`,c+=`
  ${(E||"").trim()}`,(E||"").trim()}})}),{output:`${o}
void main() {
${c}
}`,outputNames:Array.from(u.values()),outputTypes:h}}static mergeOutputFragmentShaderForColor(e,n){if(n.length>1||n[0]!==oe.COLOR)throw new Error("Merging fragment shaders for only COLOR output is only valid when the view has a single COLOR output target.");$n(e)&&(e=[{outputType:oe.COLOR,source:e}]);let r="",i="";const s=new Set,a=[];return e.some(o=>{const c=o.outputType===oe.COLOR;let l=!1;return c&&a.push(oe.COLOR),wr({shader:Ms(o.source),onToken(u){const h=u.trim();if(h.indexOf(Ya)===0){if(l)throw console.error("Found multiple ${out} tokens in a single fragment shader. This is not supported nor logical","If you need to use the declared output multiple times, use the assigned name","and don't wrap it repeatedly in the shader.","eg-","void main() {","  ${out: myOutput} = value;","  vec4 somethingElse = myOutput;","}"),new Error("Invalid Shader Format");l=!0;const f=h.substr(Ya.length).trim();if(f[0]===qa){const p=f.substr(qa.length).trim();if(!p)throw new Error("Output in a shader requires an identifier ${out: <name required>}");if(s.has(p))throw new Error("You can not declare the same output name in subsequent fragment shader outputs");if(p==="gl_FragColor")throw new Error("DO not use gl_FragColor as an identifier for an out. Choose something not used by the WebGL spec.");return c?(s.add("gl_FragColor"),p!=="gl_FragColor"?`vec4 ${p} = gl_FragColor`:"gl_FragColor"):`vec4 ${p}`}}return`\${${u}}`},onMain(u,h){return i+=`
${(h||"").trim()}`,r+=`
  ${(u||"").trim()}`,(u||"").trim()}}),!!c}),{output:`${i}
void main() {
${r}
}`,outputNames:Array.from(s.values()),outputTypes:a}}static makeOutputFragmentShader(e,n,r,i){if(!r||$n(r))if($n(i)){const s=this.mergeOutputFragmentShaderForColor([{source:i,outputType:oe.COLOR}],[oe.COLOR]);return{source:s.output,outputTypes:[oe.COLOR],outputNames:s.outputNames}}else if(Array.isArray(i)){const s=i.find(c=>c.outputType===oe.COLOR);let a=-1;s?a=i.indexOf(s):a=i.length-1;const o=this.mergeOutputFragmentShaderForColor(i.slice(0,a+1),[oe.COLOR]);return{source:o.output,outputNames:o.outputNames,outputTypes:[oe.COLOR]}}else return null;else if(Array.isArray(r)){if(!U.MRT)throw new Error("Multiple Render Targets were specified, but are not natively supported by user's hardware! MRT also does not have a fallback in deltav yet!");const s=r.map(a=>a.outputType);if(Array.isArray(i)){const a=new Map;for(let o=0,c=r.length;o<c;++o){const l=r[o];for(let u=0,h=i.length;u<h;++u)if(i[u].outputType===l.outputType){a.set(l.outputType,u);break}}if(U.MRT){let o=-1;const c=[];if(a.forEach((u,h)=>{c.push(h),o=Math.max(u,o)}),o===-1)return null;const l=this.mergeFragmentOutputsForMRT(e,n,i.slice(0,o+1),s,c);return{source:l.output,outputNames:l.outputNames,outputTypes:l.outputTypes}}else throw new Error("Fragment shader generation not supported for MRT systems on non MRT hardware...yet")}else if(r.find(o=>o.outputType===oe.COLOR)&&i){const o=this.mergeFragmentOutputsForMRT(e,n,[{source:i,outputType:oe.COLOR}],s);return{source:o.output,outputNames:o.outputNames,outputTypes:o.outputTypes}}}return null}process(e,n,r,i,s,a,o){try{if(!e.surface.gl)return console.warn("No WebGL context available for layer!"),null;const c=this.processImports(e,n,r);if(!c)return null;const{vertexAttributes:l,instanceAttributes:u,uniforms:h}=lp(e.surface.gl,e,n,s,o,c);e.getLayerBufferType(e.surface.gl,l,u),this.metricsProcessing.process(u,h);let f="",p="",m="";const v={uniforms:[]},b=i.vs||new Map,T=i.fs||new Map,E=i.destructure||new Map;for(let V=0,re=s.length;V<re;++V){const K=s[V],Z=K.processHeaderInjection(P.VERTEX,b,e,this.metricsProcessing,l,u,h);f+=Z.injection,Z.material&&(v.uniforms=v.uniforms.concat(Z.material.uniforms||[])),m+=K.processAttributeDestructuring(e,E,this.metricsProcessing,l,u,h)}let S="";b.forEach(V=>{S+=V}),f=S+f,S="",E.forEach(V=>{S+=V}),m=S+m;const I=this.processExtensions(),x=`precision highp float;

`,D=I+x+f+c.vs;let N={[pp.attributes]:m},O=!1;const te=wr({options:N,required:void 0,shader:D,onToken(V,re){return V===pp.attributes&&(O=!0),re},onMain(V){return O?V||"":V===null?(console.warn("The body of void main() could not be determined."),""):`${m}
${V}`}});return c.fs.forEach((V,re)=>{N={},p="",S="";const K=T.get(re)||new Map;for(let q=0,G=s.length;q<G;++q){const De=s[q].processHeaderInjection(P.FRAGMENT,K,e,this.metricsProcessing,l,u,h);if(p+=De.injection,De.material){const _=new Set;v.uniforms.forEach(M=>_.add(M.name)),v.uniforms.forEach(M=>{_.has(M.name)||v.uniforms.push(M)})}}K.forEach(q=>{S+=q}),p=S+p;const Z=I+x+p+V.source,ce=wr({options:N,required:void 0,shader:Z});V.source=ce.shader.trim();for(let q=0,G=a.length;q<G;++q){const ie=a[q];te.shader=ie.vertex(te.shader),V.source=ie.fragment(V.source)}}),{fs:c.fs,materialUniforms:v.uniforms,maxInstancesPerBuffer:this.metricsProcessing.maxInstancesPerUniformBuffer,modules:Array.from(c.shaderModuleUnits),vs:te.shader.trim(),vertexAttributes:l,instanceAttributes:u,uniforms:h}}catch(c){return c instanceof Error&&(console.warn("An unknown error occurred while processing the shaders for layer:",e.id),console.warn("Error:"),console.warn(c&&(c.stack||c.message))),null}}processExtensions(){let e="";return U.SHADERS_3_0&&(e+="#version 300 es"),U.MRT_EXTENSION&&(e+="#extension GL_EXT_draw_buffers : require"),e&&(e+=`

`),e}processImports(e,n,r){const i=new Set;let s=e.baseShaderModules(n);e.props.baseShaderModules&&(s=e.props.baseShaderModules(n,s));const a=Qe.process(e.id,n.vs,P.VERTEX,s.vs);if(a.errors.length>0)return console.warn("Error processing imports for the vertex shader of layer:",e.id,"Errors",...a.errors.reverse()),null;const o=new Map;return r.forEach((c,l)=>{const u=Qe.process(e.id,c.source,P.FRAGMENT,s.fs);if(u.errors.length>0){console.warn("Error processing imports for the fragment shader of layer:",e.id,"Errors",...u.errors.reverse());return}u.shaderModuleUnits.forEach(f=>i.add(f));const h={source:u.shader||"",outputTypes:c.outputTypes,outputNames:c.outputNames};o.set(l,h)}),a.shaderModuleUnits.forEach(c=>i.add(c)),{fs:o,vs:a.shader||"",shaderModuleUnits:i}}}class mp{constructor(e){this.isMouseOver=new Set,this.isMouseDown=new Set,this.isTouchOver=new Map,this.isTouchDown=new Map,this.layer=e}getColorPickInstance(e){return this.colorPicking&&this.layer.picking.type===ue.SINGLE&&this.colorPicking.view===e?this.layer.uidToInstance.get(16777215-this.colorPicking.nearestColor):null}handleMouseOver(e,n){}handleTouchOver(e,n,r){}handleMouseDown(e,n){if(this.layer.picking&&this.layer.picking.type!==ue.NONE){const{onMouseDown:r}=this.layer.props;if(r){const i=e.projection.screenToWorld(n.screen.position),s=[];if(this.layer.picking.type===ue.SINGLE){const o=this.getColorPickInstance(e);o&&s.push(o)}const a={interaction:n,instances:s,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:i};r(a),this.isMouseDown.clear(),s.forEach(o=>this.isMouseDown.add(o))}}}handleTouchDown(e,n,r){const{onTouchDown:i,onTouchOver:s}=this.layer.props;if(!this.layer.picking||this.layer.picking.type===ue.NONE||!i&&!s)return;const a=e.projection.screenToWorld(r.screen.position),o=[];if(this.layer.picking.type===ue.SINGLE){const h=this.getColorPickInstance(e);h&&o.push(h)}const c={interaction:n,touch:r,instances:o,layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:a},l=yr(this.isTouchDown,r.touch.touch.identifier,()=>new Set),u=yr(this.isTouchOver,r.touch.touch.identifier,()=>new Set);o.forEach(h=>{l.add(h),u.add(h)}),s&&s(c),i&&i(c)}handleMouseOut(e,n){if(this.layer.picking&&this.layer.picking.type!==ue.NONE){const{onMouseOut:r}=this.layer.props;if(r){const i=e.projection.screenToWorld(n.screen.position),s={interaction:n,instances:Array.from(this.isMouseOver.keys()),layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:i};r(s)}}this.isMouseOver.clear()}handleTouchOut(e,n,r){const{onTouchOut:i}=this.layer.props;if(!this.layer.picking||this.layer.picking.type===ue.NONE||!i)return;const s=e.projection.screenToWorld(r.screen.position),a={interaction:n,touch:r,instances:Array.from(this.isMouseOver.keys()),layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:s};i(a),this.isTouchOver.delete(r.touch.touch.identifier)}handleMouseUp(e,n){const{onMouseUp:r,onMouseUpOutside:i}=this.layer.props;if(!this.layer.picking||this.layer.picking.type===ue.NONE||!r)return;const s=e.projection.screenToWorld(n.screen.position),a=[];if(this.layer.picking.type===ue.SINGLE){const c=this.getColorPickInstance(e);c&&a.push(c)}let o={interaction:n,instances:a,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:s};r(o),a.forEach(c=>this.isMouseDown.delete(c)),!(this.isMouseDown.size<=0||!i)&&(o={interaction:n,instances:Array.from(this.isMouseDown.values()),layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:s},i(o))}handleTouchUp(e,n,r){const{onTouchUp:i,onTouchUpOutside:s,onTouchOut:a,onTouchAllEnd:o}=this.layer.props;if(!this.layer.picking||this.layer.picking.type===ue.NONE||!i&&!s&&!a&&!o)return;const c=e.projection.screenToWorld(r.screen.position),l=[];if(this.layer.picking.type===ue.SINGLE){const f=this.getColorPickInstance(e);f&&l.push(f)}let u={interaction:n,touch:r,instances:l,layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:c};a&&a(u),i&&i(u);const h=ka(this.isTouchDown,r.touch.touch.identifier,new Set);l.forEach(f=>h.delete(f)),h.size>0&&s&&(u={interaction:n,touch:r,instances:Array.from(h.values()),layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:c},s(u)),this.isTouchDown.delete(r.touch.touch.identifier),this.isTouchDown.size<=0&&o&&(u={interaction:n,touch:r,instances:[],layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:c},o(u))}handleMouseMove(e,n){const{onMouseOver:r,onMouseMove:i,onMouseOut:s}=this.layer.props;if(this.layer.picking&&this.layer.picking.type!==ue.NONE&&(r||i||s)){let a;const o=e.projection.screenToWorld(n.screen.position),c=[];if(this.layer.picking.type===ue.SINGLE){const u=this.getColorPickInstance(e);u&&c.push(u)}const l=new Set;if(c.forEach(u=>l.add(u)),s){const u=[];this.isMouseOver.forEach(h=>{l.has(h)||u.push(h)}),a={interaction:n,instances:u,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:o},u.length>0&&s(a)}if(r){const u=c.filter(h=>!this.isMouseOver.has(h));a={interaction:n,instances:u,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:o},u.length>0&&r(a)}i&&(a={interaction:n,instances:c,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:o},i(a)),this.isMouseOver=l}}handleTouchMove(e,n,r){const{onTouchOver:i,onTouchMove:s,onTouchOut:a}=this.layer.props;if(this.layer.picking&&this.layer.picking.type!==ue.NONE&&(i||s||a)){let o;const c=e.projection.screenToWorld(r.screen.position),l=[];if(this.layer.picking.type===ue.SINGLE){const f=this.getColorPickInstance(e);f&&l.push(f)}const u=ka(this.isTouchOver,r.touch.touch.identifier,new Set),h=new Set;if(l.forEach(f=>h.add(f)),a){const f=[];u.forEach(p=>{h.has(p)||f.push(p)}),o={interaction:n,touch:r,instances:f,layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:c},f.length>0&&a(o)}if(i){const f=l.filter(p=>!u.has(p));o={interaction:n,touch:r,instances:f,layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:c},f.length>0&&i(o)}s&&(o={interaction:n,touch:r,instances:l,layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:c},s(o)),this.isMouseOver=h}}handleMouseClick(e,n){if(this.layer.picking&&this.layer.picking.type!==ue.NONE){const{onMouseClick:r}=this.layer.props;if(r){const i=e.projection.screenToWorld(n.screen.position),s=[];if(this.layer.picking.type===ue.SINGLE){const o=this.getColorPickInstance(e);o&&s.push(o)}const a={interaction:n,instances:s,layer:this.layer.id,projection:e.projection,screen:n.screen.position,world:i};r(a)}}}handleTap(e,n,r){if(this.layer.picking&&this.layer.picking.type!==ue.NONE){const{onTap:i}=this.layer.props;if(i){const s=e.projection.screenToWorld(r.screen.position),a=[];if(this.layer.picking.type===ue.SINGLE){const c=this.getColorPickInstance(e);c&&a.push(c)}const o={interaction:n,touch:r,instances:a,layer:this.layer.id,projection:e.projection,screen:r.screen.position,world:s};i(o)}}}handleMouseDrag(e,n){}}const Fl=Ye("performance"),vp=class extends Xr{constructor(t,e,n){super(n),this.animationEndTime=0,this.alwaysDraw=!1,this.depth=0,this._easingManager={easingComplete:new ht,complete:()=>this._easingManager.easingComplete.promise},this.lastFrameTime=0,this.needsViewDrawn=!1,this.picking={currentPickMode:ue.NONE,type:ue.SINGLE,uidToInstance:new Map},this.resource=Gf,this.shaderIOInfo={},this.streamChanges={locked:!1,streamIndex:0},this._uid=Y(),this.uidToInstance=new Map,this.willRebuildLayer=!1,this.surface=t,this.scene=e,this.props=Object.assign({},vp.defaultProps||{},n)}get bufferManager(){return this._bufferManager}get bufferType(){return this._bufferType||qe.INSTANCE_ATTRIBUTE}get easingManager(){return this._easingManager}get uid(){return this._uid}static createRef(){return{easing:null}}validateShaderIO(t){if(!t)return this.picking&&(this.picking.type=ue.NONE),Fl("Shell layer initialized. Nothing will be rendered for this layer",this.id),!0;if(!t.fs||!t.vs)return console.warn("Layer needs to specify the fragment and vertex shaders:",this.id),!1}cleanShaderIOElements(t){t.instanceAttributes=(t.instanceAttributes||[]).filter(Ue),t.vertexAttributes=(t.vertexAttributes||[]).filter(Ue),t.uniforms=(t.uniforms||[]).filter(Ue)}checkForDuplicateOutputTypes(t){let{mapOutput:e}=this.props;$n(t.fs)&&(t.fs=[{outputType:oe.COLOR,source:t.fs}]),e=e||{};const n=new Set;let r=!1,i=Number.MIN_SAFE_INTEGER;for(let s=0,a=t.fs.length;s<a;++s){const o=t.fs[s],c=e[o.outputType];if(c===void 0){n.has(o.outputType)&&(r=!0),n.add(o.outputType);continue}c===oe.NONE?o.outputType=i++:o.outputType=c,n.has(o.outputType)&&(r=!0),n.add(o.outputType)}if(r)return console.warn("Layer has duplicate fragment shader output types"),!1}processFragmentShadersForEachView(t,e){$n(t.fs)&&(t.fs=[{outputType:oe.COLOR,source:t.fs}]);const n=this.picking.type===ue.SINGLE&&!t.fs.find(a=>a.outputType===oe.PICKING);if(this.picking.type===ue.SINGLE&&!n)throw new Error("Do NOT specify picking prop on a layer when you have your own Picking output declared.");const r={outputType:oe.PICKING,source:w0},i=new Map,s={fs:new Map,vs:new Map,destructure:new Map};for(let a=0,o=e.length;a<o;++a){const c=e[a];if(n){const p=t.fs.findIndex(m=>m.outputType===oe.PICKING);p>-1&&t.fs.splice(p,1)}const l=c.getOutputTargets();let u=0;t.fs.forEach((p,m)=>{l!=null&&l.find(v=>v.outputType===p.outputType)&&(u=m)}),n&&t.fs.splice(u+1,0,r);let h=yr(s.fs,c,new Map);h||(h=new Map,s.fs.set(c,h));const f=gp.makeOutputFragmentShader(s.vs,h,l,t.fs);if(!f)return console.warn("Could not generate output fragment shaders for the view specified."),!1;i.set(c,f)}return{outputFragmentShaders:i,declarations:s}}processLayerShaders(t,e,n){let r=null;if(r=new gp().process(this,t,e,n,this.surface.getIOExpanders(),this.surface.getShaderTransforms(),this.surface.getIOSorting()),!r)return console.warn("The shader processor did not produce metrics for the layer."),!1;this.shaderIOInfo=Object.assign({activeAttribute:{name:"active",size:k.ONE,update:i=>[i.active?1:0]},instanceAttributes:r.instanceAttributes,instanceVertexCount:t.vertexCount,vs:r.vs,fs:r.fs,materialUniforms:r.materialUniforms,maxInstancesPerBuffer:r.maxInstancesPerBuffer,drawMode:t.drawMode||d.GLSettings.Model.DrawMode.TRIANGLE_STRIP,uniforms:r.uniforms,vertexAttributes:r.vertexAttributes},this.shaderIOInfo)}processVertexAttributes(t){$f(this,this.shaderIOInfo.maxInstancesPerBuffer,this.shaderIOInfo.vertexAttributes,t.vertexCount)}init(t){if(!this.surface.gl)return console.warn("The layer's surface does not have a valid WebGL context."),!1;const{picking:e=ue.NONE}=this.props;e===ue.SINGLE?this.picking={currentPickMode:ue.NONE,type:ue.SINGLE,uidToInstance:new Map}:this.picking={currentPickMode:ue.NONE,type:ue.NONE},this.resource=this.surface.resourceManager;const n=this.initShader();this.interactions=new mp(this);const r=this.validateShaderIO(n);if(r!==void 0)return r;if(!n)return!1;let i;return this.surface.getShaderTransforms().forEach(a=>{n.vs=a.rawVertex(n.vs),n.fs=a.rawFragment(n.fs)}),i=this.cleanShaderIOElements(n),ur(i)||(i=this.checkForDuplicateOutputTypes(n),ur(i))||(i=this.processFragmentShadersForEachView(n,t),ur(i))||(i=this.processLayerShaders(n,i.outputFragmentShaders,i.declarations),ur(i))||(i=this.processVertexAttributes(n),ur(i))||(i=this.makeLayerBufferManager(this.surface.gl,this.scene),ur(i))||(i=this.updateDiffHandlers(),ur(i))?i:(this.layerShaderDebugging(),this.props.ref&&(this.props.ref.easing=this.easingManager),!0)}layerShaderDebugging(){this.props.printShader&&(console.warn(`Layer: ${this.props.key}`,`
Shader Configuration:`,this.shaderIOInfo),console.warn(`VERTEX SHADER
`),console.warn(`
${this.shaderIOInfo.vs}`),this.shaderIOInfo.fs.forEach((t,e)=>{console.warn(`FRAGMENT SHADER:
`,`view: ${e.id}):
Output Targets${JSON.stringify(t.outputNames)}
${JSON.stringify(t.outputTypes)}
`),console.warn(`
${t.source}`)}))}baseShaderModules(t){const e=[],n=[];return e.push("instancing"),this.picking.type===ue.SINGLE&&e.push("picking"),(t.instanceAttributes||[]).find(i=>!!(i&&i.easing))&&e.push("frame"),{fs:n,vs:e}}childLayers(){return[]}destroy(){this.bufferManager&&(this.bufferManager.scene&&this.bufferManager.scene.removeLayer(this),this.bufferManager.removeFromScene(),this.bufferManager.destroy())}didUpdateProps(){}draw(){this.updateStreamLock();const t=this.getChangeList();t.length>0&&(this.needsViewDrawn=!0);let e,n,r;const i=this.diffManager;if(!i||!this.bufferManager)return;const s=i.processing,a=i.processor;if(!a){console.warn("A layer is atttempting to draw without a diff processor for analyzing changes.");return}a.incomingChangeList(t),this.bufferManager.incomingChangeList(t);for(let o=0,c=t.length;o<c;++o)e=t[o],n=e[0],r=this.bufferManager.getBufferLocations(n),s==null||s[e[1]](a,n,Object.values(e[2]),r),n.changes={};a.commit(),this.bufferManager.changesProcessed(),this.updateEasingManager(),this.updateUniforms()}updateEasingManager(){if(this.props.streamChanges){if(!this.streamChanges.stream||this.streamChanges.stream.length<=0){const t=this._easingManager.easingComplete;this._easingManager.easingComplete=new ht,jn(()=>{t.resolve()},this.animationEndTime-this.surface.frameMetrics.currentTime)}}else{const t=this._easingManager.easingComplete;this._easingManager.easingComplete=new ht,jn(()=>{t.resolve()},this.animationEndTime-this.surface.frameMetrics.currentTime)}}getNextStreamChanges(){let t;const{streamChanges:e={count:1e4,strategy:pa.LINEAR}}=this.props,{stream:n=[],streamIndex:r}=this.streamChanges;switch(e.count===void 0&&(e.count=1e4),e.count<=0&&(e.count=Number.MAX_SAFE_INTEGER),e.strategy){case pa.LINEAR:default:{t=n.slice(r,r+e.count),this.streamChanges.streamIndex+=e.count;break}}return this.streamChanges.stream&&this.streamChanges.streamIndex>=this.streamChanges.stream.length&&delete this.streamChanges.stream,t}updateStreamLock(){this.streamChanges.locked=!!(this.streamChanges.stream&&this.streamChanges.streamIndex<this.streamChanges.stream.length)}getChangeList(){let t;return this.streamChanges.locked?t=this.getNextStreamChanges():this.props.streamChanges?(this.streamChanges.streamIndex=0,this.streamChanges.locked=!0,this.streamChanges.stream=this.props.data.changeList,t=[],this.props.data.resolve(this.id)):(t=this.props.data.changeList,this.props.data.resolve(this.id)),this.updateStreamLock(),t}getInstanceObservableIds(t,e){const n={};for(let r=0,i=e.length;r<i;++r){mt.setObservableMonitor(!0),t[e[r]];const s=mt.getObservableMonitorIds(!0);s[0]!==void 0&&(n[e[r]]=s[0])}return mt.setObservableMonitor(!1),n}getMaterialOptions(){return{}}initShader(){return{fs:"${import: no-op}",instanceAttributes:[],uniforms:[],vertexAttributes:[],vertexCount:0,vs:"${import: no-op}"}}managesInstance(t){return Ue(this.bufferManager)&&this.bufferManager.managesInstance(t)}getLayerBufferType(t,e,n){let r=qe.UNIFORM,i=0;if(this._bufferType!==void 0)return this._bufferType;if(U.HARDWARE_INSTANCING){for(let s=0,a=e.length;s<a;++s){const o=e[s];i+=Math.ceil(o.size/4)}for(let s=0,a=n.length;s<a;++s){const o=n[s];i+=Math.ceil(hh[o.size||1]/4)}if(i>U.MAX_VERTEX_ATTRIBUTES){i=0;for(let s=0,a=n.length;s<a;++s){const o=n[s];i=Math.max(i,o.block||0)}for(let s=0,a=e.length;s<a;++s){const o=e[s];i+=Math.ceil(o.size/4)}i<U.MAX_VERTEX_ATTRIBUTES&&(r=qe.INSTANCE_ATTRIBUTE_PACKING,Fl(`Performance Issue (Moderate):
            Layer %o is utilizing too many vertex attributes and is now using vertex packing.
            Max Vertex units %o
            Used Vertex units %o
            Instance Attributes %o
            Vertex Attributes %o`,this.id,U.MAX_VERTEX_ATTRIBUTES,i,n,e))}else r=qe.INSTANCE_ATTRIBUTE}return r===qe.UNIFORM&&(Fl(`Performance Issue (High):
        Layer %o is utilizing too many vertex attributes and is now using a uniform buffer.
        Max Vertex units %o
        Used Vertex units %o
        Instance Attributes %o
        Vertex Attributes %o`,this.id,U.MAX_VERTEX_ATTRIBUTES,i,n,e),r=qe.UNIFORM),this.setBufferType(r),r}makeLayerBufferManager(t,e){switch(this.getLayerBufferType(t,this.shaderIOInfo.vertexAttributes,this.shaderIOInfo.instanceAttributes)){case qe.INSTANCE_ATTRIBUTE:{this.setBufferManager(new Zf(this,e));break}case qe.INSTANCE_ATTRIBUTE_PACKING:{this.setBufferManager(new Jf(this,e));break}default:{this.setBufferManager(new tp(this,e));break}}}updateDiffHandlers(){(this.shaderIOInfo.instanceAttributes||[]).find(e=>!!(e&&e.easing))?this.picking.type===ue.SINGLE?(this.onDiffAdd=this.handleDiffAddWithPickingAndEasing,this.onDiffRemove=this.handleDiffRemoveWithPickingAndEasing):(this.onDiffAdd=this.handleDiffAddWithEasing,this.onDiffRemove=this.handleDiffRemoveWithEasing):this.picking.type===ue.SINGLE&&(this.onDiffAdd=this.handleDiffAddWithPicking,this.onDiffRemove=this.handleDiffRemoveWithPicking)}handleDiffAddWithEasing(t){t.easingId=this.easingId}handleDiffAddWithPicking(t){this.uidToInstance.set(t.uid,t)}handleDiffAddWithPickingAndEasing(t){this.uidToInstance.set(t.uid,t),t.easingId=this.easingId}handleDiffRemoveWithEasing(t){t.easing&&delete t.easing,delete t.easingId}handleDiffRemoveWithPicking(t){this.uidToInstance.delete(t.uid)}handleDiffRemoveWithPickingAndEasing(t){this.uidToInstance.delete(t.uid),t.easing&&delete t.easing,delete t.easingId}rebuildLayer(){if(this.willRebuildLayer=!0,this.children)for(let t=0,e=this.children.length;t<e;++t)this.children[t].rebuildLayer()}resolveChanges(t){const e=this.props.data.changeList;e.length>0&&(this.needsViewDrawn=!0),t||this.props.data.resolve(this.id);for(let n=0,r=e.length;n<r;++n)e[n][0].changes={};return e}setBufferManager(t){this._bufferManager?console.warn("You can not change a layer's buffer strategy once it has been instantiated."):(this._bufferManager=t,this.diffManager=new Av,this.diffManager.makeProcessor(this,t))}setBufferType(t){this._bufferType===void 0?this._bufferType=t:console.warn("You can not change a layers buffer strategy once it has been instantiated.")}shouldDrawView(t,e){for(const n in e)if(e[n]!==t[n])return!0;return!1}updateUniforms(){let t,e;for(let n=0,r=this.shaderIOInfo.uniforms.length;n<r;++n)t=this.shaderIOInfo.uniforms[n],e=t.update(t),t.materialUniforms.forEach(i=>i.value=e)}willUpdateProps(t){t.picking!==this.props.picking&&this.rebuildLayer(),t.ref!==this.props.ref&&this.props.ref&&(this.props.ref.easing=this.easingManager)}};let Sn=vp;Sn.defaultProps={};const yp=Ye("performance");class Ka extends Xr{constructor(e,n){super(n),this.container=new ma,this.surface=e,this.init(n)}get layers(){return this.layerDiffs.items}get views(){return this.viewDiffs.items}init(e){if(!this.surface||!this.surface.gl)return;this.container=new ma;const n=zf(this.surface.gl);this.layerDiffs=new xs({buildItem:async r=>{if(yp("Building layer",r.key),!this.surface)return null;const i=r.init[0],s=r.init[1],a=new i(this.surface,this,Object.assign({},i.defaultProps,s));if(a.initializer=r,a.props.data.sync(),a.parent=s.parent,s.parent&&(s.parent.children?s.parent.children.push(a):s.parent.children=[a]),!a.init(this.views))return console.warn("Error initializing layer:",s.key,"A layer was unable to be added to the surface. See previous warnings (if any) to determine why they could not be instantiated"),null;const o=a.childLayers();return this.layerDiffs.inline(o),a},destroyItem:async(r,i)=>(yp("Destroying layer",r.key),i.destroy(),!0),updateItem:async(r,i)=>{const s=r.init[1];if(i.willUpdateProps(s),s.data!==i.props.data&&s.data.sync(),i.shouldDrawView(i.props,s)&&(i.needsViewDrawn=!0),Object.assign(i.props,s),i.initializer.init[1]=i.props,i.didUpdateProps(),s.parent&&i.parent&&i.parent!==s.parent){const a=i.parent.children||[],o=a.indexOf(i)||-1;o>-1&&a.splice(o,1)}i.parent=s.parent,i.willRebuildLayer?(this.layerDiffs.rebuild(),i.willRebuildLayer=!1):this.layerDiffs.inline(i.childLayers())}}),this.viewDiffs=new xs({buildItem:async r=>{if(!this.surface)return null;const i=new r.init[0](this,r.init[1]);return i.props.camera=i.props.camera||n.camera,i.pixelRatio=this.surface.pixelRatio,i.resource=this.surface.resourceManager,this.surface.userInputManager.waitingForRender=!0,i},destroyItem:async(r,i)=>!0,updateItem:async(r,i)=>{const s=r.init[1];i.willUpdateProps(s),i.shouldDrawView(i.props,s)&&(i.needsDraw=!0),Object.assign(i.props,s),i.didUpdateProps(),this.surface&&(this.surface.userInputManager.waitingForRender=!0)}}),this.update(e)}destroy(){delete this.container,this.layerDiffs.destroy(),this.viewDiffs.destroy()}removeLayer(e){if(this.layers){const n=this.layers.indexOf(e);if(n>=0){this.layers.splice(n,1);return}}}async update(e){this.order=e.order,await this.viewDiffs.diff(e.views),await this.layerDiffs.diff(e.layers),this.views.forEach(n=>n.createRenderTarget())}}Ka.DEFAULT_SCENE_ID="__default__";var Pi=(t=>(t[t.COLOR=1]="COLOR",t[t.DEPTH=2]="DEPTH",t[t.STENCIL=4]="STENCIL",t))(Pi||{});function Bl(t,e){const n=Object.assign(e,{key:e.key||"",viewport:e.viewport||{left:0,right:0,top:0,bottom:0}});return{get key(){return e.key||""},init:[t,n]}}const wp=class extends Xr{constructor(t,e){super(e),this.animationEndTime=0,this.depth=0,this.lastFrameTime=0,this.needsDraw=!1,this.optimizeRendering=!1,this._pixelRatio=1,this.scene=t,this.props=Object.assign({},wp.defaultProps||{},e)}get pixelRatio(){return this.props.pixelRatio??this._pixelRatio}set pixelRatio(t){this._pixelRatio=t}get screenBounds(){return this.projection.screenBounds}set screenBounds(t){this.projection.screenBounds=t}get viewBounds(){return this.projection.viewBounds}set viewBounds(t){this.projection.viewBounds=t}get clearFlags(){return this.props.clearFlags||[]}get order(){return this.props.order||0}getOutputTargets(){const{output:t}=this.props;let e=[];return t?(Yr(t.buffers)||Ba(t.buffers)?e=[{outputType:oe.COLOR,resource:t.buffers}]:Object.keys(t.buffers).forEach(n=>{const r=Number.parseFloat(n),i=t.buffers[r];i&&e.push({outputType:r,resource:i})}),e):null}getRenderTargets(){return this.renderTarget?[this.renderTarget]:[]}createRenderTarget(){this.renderTarget&&(Array.isArray(this.renderTarget)?this.renderTarget.forEach(u=>u.dispose()):this.renderTarget.dispose());const{output:t}=this.props,e=this.scene.surface;if(!t||!e)return;const n=new Set;for(let u=0,h=this.scene.layers.length;u<h;++u){const p=this.scene.layers[u].shaderIOInfo.fs.get(this);p&&p.outputTypes.forEach(m=>n.add(m))}const r=new Map,i=new Sn(e,this.scene,{key:"",data:new Oe}),s=new dt({}),a=this.getOutputTargets()||[];for(let u=0,h=a.length;u<h;++u){const f=a[u],p=f.resource;if(n.has(f.outputType))if(Yr(p)){const m=Cs({key:f.resource.key});if(this.resource.request(i,s,m),!m.texture)throw console.warn("A view has a RenderTexture output target with key:",f.resource.key,"however, no RenderTexture was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createTexture()"),new Error(`Output target unable to be constructed for view ${this.id}`);r.set(f.outputType,m.texture)}else{const m=El({key:f.resource.key});if(this.resource.request(i,s,m),!m.colorBuffer)throw console.warn("A view has a ColorBuffer output target with key:",f.resource.key,"however, no ColorBuffer was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createColorBuffer()"),new Error(`Output target unable to be constructed for view ${this.id}`);r.set(f.outputType,m.colorBuffer)}}let o,c;r.forEach(u=>{var h,f,p;if(u instanceof Re){if((o===void 0||c===void 0)&&(o=((h=u.data)==null?void 0:h.width)||0,c=((f=u.data)==null?void 0:f.height)||0),o===0||c===0)throw new Error("RenderTexture for View can NOT have a width or height of zero.");if(((p=u.data)==null?void 0:p.width)!==o||u.data.height!==c)throw new Error("When a view has multiple output targets: ALL RenderTextures and ColorBuffers that a view references MUST have the same dimensions")}else{if((o===void 0||c===void 0)&&(o=u.size[0]||0,c=u.size[1]||0),o===0||c===0)throw new Error("RenderTexture for View can NOT have a width or height of zero.");if(u.size[0]!==o||u.size[1]!==c)throw new Error("When a view has multiple output targets: ALL RenderTextures and ColorBuffers that a view references MUST have the same dimensions")}});let l;if(t.depth)if(Yr(t.depth)){const u=Cs({key:t.depth.key});if(this.resource.request(i,s,u),!u.texture)throw console.warn("A view has a depth buffer output target with key:",t.depth,"however, no RenderTexture was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createTexture()"),new Error(`Output target unable to be constructed for view ${this.id}`);l=u.texture}else if(Ba(t.depth)){const u=El({key:t.depth.key});if(this.resource.request(i,s,u),!u.colorBuffer)throw console.warn("A view has a depth buffer output target with key:",t.depth.key,"however, no ColorBuffer was found for the key.","Please ensure you have a 'resource' specified for the Surface with the proper key","Also ensure the resource is made via createColorBuffer()"),new Error(`Output target unable to be constructed for view ${this.id}`);l=u.colorBuffer}else l=d.GLSettings.RenderTarget.DepthBufferFormat.DEPTH_COMPONENT16;if(U.MRT){const u=[];r.forEach((h,f)=>u.push({buffer:h,outputType:f})),this.renderTarget=new hr({buffers:{color:u,depth:l},retainTextureTargets:!0})}else throw new Error("MRT for non-MRT systems not supported yet.")}willUseView(){const t=this.getRenderTargets();this.props.screenScale&&(this.projection.screenScale=this.props.screenScale),t.some(n=>n.getBuffers().some(r=>!!r.buffer.destroyed))&&this.createRenderTarget()}shouldDrawView(t,e){for(const n in e)if(e[n]!==t[n])return!0;return!1}willUpdateProps(t){}didUpdateProps(){}};let Ns=wp;Ns.defaultProps={key:"",camera:Qn.makeOrthographic(),viewport:{left:0,right:0,top:0,bottom:0}};class Tp extends Ns{constructor(){super(new Ka(void 0,{key:"error",layers:[],views:[]}),{key:"error",viewport:{},camera:Qn.makeOrthographic()}),this.projection=new Oh,this.screenBounds=new we({x:0,y:0,width:100,height:100})}screenToWorld(e,n){return[0,0]}worldToScreen(e,n){return[0,0]}viewToWorld(e,n){return[0,0]}worldToView(e,n){return[0,0]}fitViewtoViewport(e,n){this.screenBounds=e}}const Nv=1e3,Pv=200,qn=new Tp;qn.fitViewtoViewport(new we({x:0,y:0,width:100,height:100}),new we({x:0,y:0,width:100,height:100}));function Dv(t,e){return e.d&&t.d?e.d.depth-t.d.depth:0}function Ul(t,e){return t.touch.identifier-e.touch.identifier}class bp{constructor(e,n,r,i){this.eventManagers=[],this.eventCleanup=[],this._waitingForRender=!0,this.getViewsUnderPosition=s=>{if(!this.quadTree)return[];const a=this.quadTree.query(s);return a.sort(Dv),a},this.resize=()=>{this._waitingForRender=!0},this.context=e,this.surface=n,this.setControllers(r),this.addContextListeners(i)}get waitingForRender(){return this._waitingForRender}set waitingForRender(e){if(this._waitingForRender=e,!e){this.quadTree=new wf(0,0,0,0);const n=this.scenes,r=[];for(let i=0,s=n.length;i<s;++i){const a=n[i];for(let o=0,c=a.views.length;o<c;++o){const l=a.views[o];r.push(l.screenBounds)}}this.quadTree.addAll(r)}}get scenes(){return!this.surface||!this.surface.sceneDiffs?[]:this.surface.sceneDiffs.items}addContextListeners(e){this.addMouseContextListeners(e),this.addTouchContextListeners()}addMouseContextListeners(e){const n=this.context;if($r(n))return;let r,i=!1;if(e){const s=a=>{const o=Jt(a,n),c=this.getViewsUnderPosition(o);if(c.length<=0)return;r={canClick:!1,currentPosition:o,deltaPosition:[0,0],previousPosition:o,start:o,startTime:Date.now(),startView:c[0].d,event:a,wheel:this.makeWheel(a),button:-1};const l=this.makeMouseInteraction(r);this.eventManagers.forEach(u=>{u.handleWheel(l)}),a.stopPropagation(),a.preventDefault()};"onwheel"in n&&(n.onwheel=s),"addEventListener"in n&&(n.addEventListener("DOMMouseScroll",s),this.eventCleanup.push(["DOMMouseScroll",s]))}n.onmouseleave=s=>{if(this.waitingForRender||!r)return;const a=Jt(s,n);r.deltaPosition=je(a,r.currentPosition),r.previousPosition=r.currentPosition,r.currentPosition=a;const o=this.makeMouseInteraction(r);this.eventManagers.forEach(c=>{c.handleMouseOut(o)})},n.onmousemove=s=>{if(this.waitingForRender)return;const a=Jt(s,n);if(!r){const c=this.getViewsUnderPosition(a);r={canClick:!1,currentPosition:a,deltaPosition:[0,0],previousPosition:a,start:a,startTime:Date.now(),startView:c[0].d,event:s,wheel:this.makeWheel(),button:-1}}r.deltaPosition=je(a,r.currentPosition),r.previousPosition=r.currentPosition,r.currentPosition=a,r.canClick=!1;const o=this.makeMouseInteraction(r);this.eventManagers.forEach(c=>{c.handleMouseMove(o)}),i=!0},n.onmousedown=s=>{if(this.waitingForRender)return;const a=Jt(s,n),o=this.getViewsUnderPosition(a);if(o.length<=0)return;r={canClick:!0,currentPosition:a,deltaPosition:[0,0],previousPosition:a,start:a,startTime:Date.now(),startView:o[0].d,event:s,wheel:this.makeWheel(),button:s.button};const c=this.makeMouseInteraction(r);this.eventManagers.forEach(u=>{u.handleMouseDown(c)}),s.stopPropagation(),document.onmousemove=u=>{if(!r)return;if(!i){const f=Jt(u,n);r.deltaPosition=je(f,r.currentPosition),r.previousPosition=r.currentPosition,r.currentPosition=f,r.canClick=!1}const h=this.makeMouseInteraction(r);this.eventManagers.forEach(f=>{f.handleDrag(h)}),u.preventDefault(),u.stopPropagation(),i=!1},document.onmouseup=u=>{document.onmousemove=null,document.onmouseup=null,document.onmouseover=null,r=void 0},document.onmouseover=u=>{if(!r)return;const h=Jt(u,n);r.deltaPosition=je(h,r.currentPosition),r.previousPosition=r.currentPosition,r.currentPosition=h;const f=this.makeMouseInteraction(r);this.eventManagers.forEach(p=>{p.handleMouseOver(f)}),u.stopPropagation()},n.onmouseup=u=>{if(!r)return;const h=Jt(u,n);r.deltaPosition=je(h,r.currentPosition),r.previousPosition=r.currentPosition,r.currentPosition=h,r.button=u.button;const f=this.makeMouseInteraction(r);this.eventManagers.forEach(p=>{p.handleMouseUp(f)}),r.canClick&&Date.now()-r.startTime<Nv&&this.eventManagers.forEach(p=>{p.handleClick(f)}),r=void 0};const l=n;l.onselectstart!==void 0?l.onselectstart=function(){return!1}:n.addEventListener("selectstart",function(){s.preventDefault()})}}addTouchContextListeners(){const e=this.context;if($r(e))return;const n=new Map,r=new Map;function i(u){return u.map(h=>h.touch)}function s(u){return u.reduce((h,f)=>f.touch.startTime>h.touch.startTime?f:h,u[0])}const a={center:u=>u.length<=0?[0,0]:this.getTouchCenter(i(u)),centerDelta:u=>{if(u.length<=0)return[0,0];const h=i(u),f=this.getTouchCenter(h,m=>m.previousPosition),p=this.getTouchCenter(h);return je(p,f)},centerStart:u=>{if(u.length<=0)return[0,0];const h=s(u).touch;return this.getTouchCenter(i(u),f=>f===h?f.start:f.startRelative.get(h)||[0,0])},id:u=>i(u).sort(Ul).map(f=>f.touch.identifier).join("_"),rotation:u=>{if(u.length<=0)return 0;const h=i(u),f=this.getTouchCenter(h);return this.getAverageAngle(h,f)},rotationDelta:u=>{if(u.length<=0)return 0;const h=i(u),f=this.getTouchCenter(h,b=>b.previousPosition),p=this.getAverageAngle(h,f,b=>b.previousPosition),m=this.getTouchCenter(h);return this.getAverageAngle(h,m)-p},rotationStart:u=>{if(u.length<=0)return 0;const h=s(u).touch,f=i(u),p=this.getTouchCenter(f,m=>m===h?m.start:m.startRelative.get(h)||[0,0]);return this.getAverageAngle(f,p,m=>m===h?m.start:m.startRelative.get(h)||[0,0])},spread:u=>{if(u.length<=0)return 0;const h=i(u),f=this.getTouchCenter(h);return this.getAverageDistance(h,f)},spreadDelta:u=>{if(u.length<=0)return 0;const h=i(u),f=this.getTouchCenter(h,b=>b.previousPosition),p=this.getAverageDistance(h,f,b=>b.previousPosition),m=this.getTouchCenter(h);return this.getAverageDistance(h,m)-p},spreadStart:u=>{if(u.length<=0)return 0;const h=s(u).touch,f=i(u),p=this.getTouchCenter(f,m=>m===h?m.start:m.startRelative.get(h)||[0,0]);return this.getAverageDistance(f,p,m=>m===h?m.start:m.startRelative.get(h)||[0,0])}};e.ontouchstart=u=>{u.preventDefault(),u.stopPropagation();const h=this.getTouches(u),f=[],p=[];for(let m=0,v=h.length;m<v;++m){const b=h[m],T=n.get(b.identifier);if(T)f.push(T);else{const E=Jt(b),S=this.getViewsUnderPosition(E);if(S.length<=0)continue;const I=S[0].d,x={canTap:!0,currentPosition:E,deltaPosition:[0,0],startTime:Date.now(),start:E,startView:I,previousPosition:E,startRelative:new Map,touch:b};n.set(b.identifier,x),p.push(x)}}if(p.length>0){const m=p.concat(f),v=[];for(let T=0,E=p.length;T<E;++T){const S=p[T];for(let x=0,D=m.length;x<D;++x){const N=m[x];S!==N&&N.startRelative.set(S,N.currentPosition)}const I=this.makeSingleTouchInteraction(S);v.push(I),r.set(S.touch.identifier,I)}const b={touches:v,allTouches:m.map(T=>r.get(T.touch.identifier)).filter(Ue),multitouch:a};this.eventManagers.forEach(T=>{T.handleTouchDown(b)})}document.ontouchend=m=>{o.call(document,m),document.ontouchend=null,document.ontouchcancel=null,document.ontouchmove=null},document.ontouchcancel=m=>{l.call(document,m),document.ontouchend=null,document.ontouchcancel=null,document.ontouchmove=null},document.ontouchmove=c};const o=e.ontouchend=u=>{u.stopPropagation(),u.preventDefault();const h=this.getTouches(u,"changed"),f=Array.from(r.values()),p=[];for(let m=0,v=h.length;m<v;++m){const b=h[m],T=n.get(b.identifier);if(T){if(T.canTap&&Date.now()-T.startTime<Pv){const S={touches:[this.makeSingleTouchInteraction(T)],allTouches:f,multitouch:a};this.eventManagers.forEach(I=>{I.handleTap(S)})}p.push(T),n.delete(b.identifier),r.delete(b.identifier)}}if(p.length>0){const v={touches:p.map(b=>this.makeSingleTouchInteraction(b)),allTouches:f,multitouch:a};this.eventManagers.forEach(b=>{b.handleTouchUp(v)})}},c=e.ontouchmove=u=>{u.stopPropagation(),u.preventDefault();const h=this.getTouches(u),f=[],p=[];for(let m=0,v=h.length;m<v;++m){const b=h[m],T=n.get(b.identifier);if(T){const E=Jt(b),S=je(E,T.currentPosition);if(or(S)<=0){p.push(T),Object.assign(T,{currentPosition:E,deltaPosition:S,previousPosition:T.currentPosition,touch:b});continue}f.push(T),Object.assign(T,{canTap:!1,currentPosition:E,deltaPosition:S,previousPosition:T.currentPosition,touch:b})}}if(f.length>0){const m=f.concat(p),b={touches:f.map(T=>this.makeSingleTouchInteraction(T)),allTouches:m.map(T=>r.get(T.touch.identifier)).filter(Ue),multitouch:a};this.eventManagers.forEach(T=>{T.handleTouchDrag(b)})}},l=e.ontouchcancel=u=>{u.stopPropagation(),u.preventDefault();const h=this.getTouches(u,"changed"),f=Array.from(r.values()),p=[];for(let m=0,v=h.length;m<v;++m){const b=h[m],T=n.get(b.identifier);T&&(p.push(T),n.delete(b.identifier),r.delete(b.identifier))}if(p.length>0){const v={touches:p.map(b=>this.makeSingleTouchInteraction(b)),allTouches:f,multitouch:a};this.eventManagers.forEach(b=>{b.handleTouchCancelled(v)})}}}getAverageDistance(e,n,r){let i=0;if(e.length<=0)return i;r||(r=s=>s.currentPosition);for(let s=0,a=e.length;s<a;++s){const o=e[s];i+=or(je(r(o),n))}return i/e.length}getAverageAngle(e,n,r){let i=0;if(e.length<=0)return i;r||(r=s=>s.currentPosition);for(let s=0,a=e.length;s<a;++s){const o=e[s],c=je(r(o),n);let l=Math.atan2(c[1],c[0]);l<0&&(l+=Math.PI*2),i+=l}return i/e.length}getTouchCenter(e,n){let r=[0,0];if(e.length<=0)return r;n||(n=i=>i.currentPosition);for(let i=0,s=e.length;i<s;++i){const a=e[i],o=n(a);r=kn(r,o)}return Xe(r,1/e.length)}getTouches(e,n){const r=new Map;if(e.touches&&e.touches.length>0&&(!n||n==="touches"))for(let i=0,s=e.touches.length;i<s;++i){const a=e.touches.item(i);a&&r.set(a.identifier,a)}if(e.changedTouches&&e.changedTouches.length>0&&(!n||n==="changed"))for(let i=0,s=e.changedTouches.length;i<s;++i){const a=e.changedTouches.item(i);a&&r.set(a.identifier,a)}if(e.targetTouches&&e.targetTouches.length>0&&(!n||n==="target"))for(let i=0,s=e.targetTouches.length;i<s;++i){const a=e.targetTouches.item(i);a&&r.set(a.identifier,a)}return Array.from(r.values())}getView(e){const n=this.scenes;for(let r=0,i=n.length;r<i;++r){const a=n[r].viewDiffs.getByKey(e);if(a)return a}return null}makeMouseInteraction(e){const n=this.getViewsUnderPosition(e.currentPosition);let r=n[0]&&n[0].d;r||(r=qn);const i=this.getViewsUnderPosition(e.start);let s=e.startView;s||(s=qn);const a={canvas:$r(this.context)?void 0:this.context,mouse:e,screen:{position:e.currentPosition},start:{position:s.projection.screenToView(e.start),view:s,views:i.map(o=>(o.d||(o.d=qn),{position:o.d.projection.screenToView(e.start),view:o.d}))},target:{position:r.projection.screenToView(e.currentPosition),view:r,views:n.map(o=>(o.d||(o.d=qn),{position:o.d.projection.screenToView(e.currentPosition),view:o.d}))}};return this.currentInteraction=a,a}makeSingleTouchInteraction(e){const n=e.currentPosition,r=this.getViewsUnderPosition(n);let i=r[0]&&r[0].d;i||(i=qn);let s=e.startView;s||(s=qn);const a={canvas:$r(this.context)?void 0:this.context,touch:e,screen:{position:n},start:{position:s.projection.screenToView(e.start),view:s,views:this.getViewsUnderPosition(e.start).map(o=>(o.d||(o.d=qn),{position:o.d.projection.screenToView(e.start),view:o.d}))},target:{position:i.projection.screenToView(n),view:i,views:r.map(o=>(o.d||(o.d=qn),{position:o.d.projection.screenToView(n),view:o.d}))}};return this.currentInteraction=a,a}makeMultiTouchInteractions(e,n){e.sort(Ul);const r=this.allTouchCombinations(e);for(let i=0,s=r.length;i<s;++i){const a=r[i],o=a.map(l=>l.touch.identifier).join("_");let c=n.get(o);if(!c){const l=this.getTouchCenter(a);c={touches:a,averageSpreadDelta:0,startCenter:l,currentCenter:l,currentRotation:this.getAverageAngle(a,l),centerDelta:[0,0],rotationDelta:0},n.set(o,c)}}}updateMultiTouchInteractions(e,n){e.sort(Ul);const r=this.allTouchCombinations(e);for(let i=0,s=r.length;i<s;++i){const a=r[i],o=a.map(l=>l.touch.identifier).join("_"),c=n.get(o);if(c){const l=this.getTouchCenter(a),u=this.getAverageAngle(a,l);c.centerDelta=je(l,c.currentCenter),c.currentCenter=l,c.rotationDelta=u-c.currentRotation,c.currentRotation=u}}}allTouchCombinations(e){const n=[],r=e.length,i=1<<r;for(let s=1;s<i;s++){const a=[];for(let o=0;o<r;o++)s&1<<o&&a.push(e[o]);n.push(a)}return n}makeWheel(e){if(!e)return{delta:[0,0]};const n=Yc(e);return{delta:[n.pixelX,n.pixelY]}}setControllers(e){this.eventManagers=e;for(const n of this.eventManagers)n.setUserInputManager(this)}destroy(){delete this.quadTree,$r(this.context)||(this.context.onmousedown=null,this.context.onmousemove=null,this.context.onmouseleave=null);const e=this.context;e.onmousewheel&&(e.onmousewheel=null),this.eventCleanup.forEach(n=>{this.context.removeEventListener(n[0],n[1])})}}class kl extends Br{constructor(e,n=!1){super(),this.preserveQueueMouse=[],this.singleQueueMouse=new Map,this.preserveQueueTouch=[],this.singleQueueTouch=new Map,this.preserveEvents=!1,this.handlers=new Ur(e),this.preserveEvents=n}dequeue(){try{this.preserveEvents?(this.preserveQueueMouse.forEach(e=>{e[0](e[1])}),this.preserveQueueTouch.forEach(e=>{e[0](e[1])})):(this.singleQueueMouse.forEach((e,n)=>{n(e)}),this.singleQueueTouch.forEach((e,n)=>{n(e)}))}catch(e){console.error("Queued events had errors. Further events aborted"),e instanceof Error&&console.error(e.stack||e.message)}this.preserveQueueMouse=[],this.singleQueueMouse.clear(),this.preserveQueueTouch=[],this.singleQueueTouch.clear()}handleMouseDown(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseDown,e]):this.singleQueueMouse.set(this.handlers.handleMouseDown,e)}handleMouseUp(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseUp,e]):this.singleQueueMouse.set(this.handlers.handleMouseUp,e)}handleMouseOver(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseOver,e]):this.singleQueueMouse.set(this.handlers.handleMouseOver,e)}handleMouseOut(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseOut,e]):this.singleQueueMouse.set(this.handlers.handleMouseOut,e)}handleMouseMove(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleMouseMove,e]):this.singleQueueMouse.set(this.handlers.handleMouseMove,e)}handleClick(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleClick,e]):this.singleQueueMouse.set(this.handlers.handleClick,e)}handleDrag(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleDrag,e]):this.singleQueueMouse.set(this.handlers.handleDrag,e)}handleWheel(e){this.preserveEvents?this.preserveQueueMouse.push([this.handlers.handleWheel,e]):this.singleQueueMouse.set(this.handlers.handleWheel,e)}handleTouchCancelled(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchCancelled,e]):this.singleQueueTouch.set(this.handlers.handleTouchCancelled,e)}handleTouchDown(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchDown,e]):this.singleQueueTouch.set(this.handlers.handleTouchDown,e)}handleTouchUp(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchUp,e]):this.singleQueueTouch.set(this.handlers.handleTouchUp,e)}handleTouchOut(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchOut,e]):this.singleQueueTouch.set(this.handlers.handleTouchOut,e)}handleTouchDrag(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchDrag,e]):this.singleQueueTouch.set(this.handlers.handleTouchDrag,e)}handleTap(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTap,e]):this.singleQueueTouch.set(this.handlers.handleTap,e)}handleDoubleTap(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleDoubleTap,e]):this.singleQueueTouch.set(this.handlers.handleDoubleTap,e)}handleLongTouch(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleLongTouch,e]):this.singleQueueTouch.set(this.handlers.handleLongTouch,e)}handleLongTap(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleLongTap,e]):this.singleQueueTouch.set(this.handlers.handleLongTap,e)}handlePinch(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handlePinch,e]):this.singleQueueTouch.set(this.handlers.handlePinch,e)}handleSpread(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleSpread,e]):this.singleQueueTouch.set(this.handlers.handleSpread,e)}handleTouchRotate(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleTouchRotate,e]):this.singleQueueTouch.set(this.handlers.handleTouchRotate,e)}handleSwipe(e){this.preserveEvents?this.preserveQueueTouch.push([this.handlers.handleSwipe,e]):this.singleQueueTouch.set(this.handlers.handleSwipe,e)}}const Ep=`vec3 cameraSpace(vec3 world) {
return (world + cameraOffset) * cameraScale2D;
}
vec3 cameraSpaceSize(vec3 worldSize) {
return worldSize * cameraScale2D;
}
vec4 clipSpace(vec3 world) {
return (viewProjection) * vec4(cameraSpace(world), 1.0);
}
vec4 clipSpaceSize(vec3 worldSize) {
return (viewProjection) * vec4(cameraSpaceSize(worldSize), 0.0);
}`,Fv=Aa.immediate(0);class Kn{constructor(e,n){this._id=Y(),this.animation=Aa.immediate(0),this.animationEndTime=0,this.offsetBroadcastTime=0,this.scaleBroadcastTime=0,this._offset=[0,0,0],this.startOffset=[0,0,0],this.startOffsetTime=0,this.offsetEndTime=0,this._scale=[1,1,1],this.startScale=[1,1,1],this.startScaleTime=0,this.scaleEndTime=0,this.needsBroadcast=!1,this.camera=e,n&&(this._offset=xt(n.offset||this._offset),this._scale=xt(n.scale||this._scale))}get id(){return this._id}broadcast(e){this.offset,this.scale,this.needsBroadcast&&(this.needsBroadcast=!1,this.onViewChange&&this.onViewChange(this.camera,e))}centerOn(e,n){var o;const r=(o=this.surface)==null?void 0:o.getViewSize(e);if(!r)return;const i=[r.width/2,r.height/2,0],s=qt(n,Yi(i,this._scale)),a=this.animation;this.setOffset(xt(this.offset)),this.animation=Fv,this.setOffset(Mt(s,-1)),this.animation=a}getCurrentTime(){return this.surface?this.surface.frameMetrics.currentTime:0}getOffset(){return this._offset}getScale(){return this._scale}get offset(){const e=this.getCurrentTime();return this.onViewChange&&this.offsetBroadcastTime<this.offsetEndTime&&(this.offsetBroadcastTime=e,this.needsBroadcast=!0),this.animation.cpu(this.startOffset,this._offset,(e-this.startOffsetTime)/this.animation.duration)}setId(e){this._id=e,this.camera.needsViewDrawn=!0}setOffset(e){this.startOffset=xt(this.offset),this._offset=xt(e),this.startOffsetTime=this.getCurrentTime(),this.offsetEndTime=this.startOffsetTime+this.animation.duration,this.updateEndTime(),this.camera.needsViewDrawn=!0,this.onViewChange&&(this.offsetBroadcastTime=this.startOffsetTime,this.needsBroadcast=!0)}get scale(){const e=this.getCurrentTime();return this.onViewChange&&this.scaleBroadcastTime<this.scaleEndTime&&(this.scaleBroadcastTime=e,this.needsBroadcast=!0),this.animation.cpu(this.startScale,this._scale,(e-this.startScaleTime)/this.animation.duration)}setViewChangeHandler(e){this.onViewChange=e}setScale(e){this.startScale=xt(this.scale),this._scale=xt(e),this.startScaleTime=this.getCurrentTime(),this.scaleEndTime=this.startScaleTime+this.animation.duration,this.updateEndTime(),this.camera.needsViewDrawn=!0,this.onViewChange&&(this.scaleBroadcastTime=this.startScaleTime,this.needsBroadcast=!0)}resolve(){this.camera.needsViewDrawn=!1,this.needsBroadcast=!1}update(){this.camera.needsViewDrawn=!0}updateEndTime(){this.animationEndTime=Math.max(this.scaleEndTime,this.offsetEndTime)}}class Zn extends Qn{constructor(e){super({left:-100,right:100,top:-100,bottom:100,near:-100,far:1e5,type:Hn.ORTHOGRAPHIC}),this.control2D=new Kn(this,e)}get control2D(){return this._control2D}set control2D(e){this._control2D=e}get scale2D(){return this.control2D.scale}get offset(){return this.control2D.offset}}class _p{sortInstanceAttributes(e,n){return e.resource&&!n.resource||e.easing&&!n.easing?-1:1}sortVertexAttributes(e,n){return 1}sortUniforms(e,n){return 1}}class Rp extends kl{constructor(){super({handleClick:async e=>{var n,r;this.enablePicking(),await((n=this.willRenderResolver)==null?void 0:n.promise),this.enablePicking(),await((r=this.didRenderResolver)==null?void 0:r.promise),this.handleInteraction(e,(i,s)=>{var a;(a=i.interactions)==null||a.handleMouseClick(s,e)})},handleTap:async e=>{var n,r;this.enablePicking(),await((n=this.willRenderResolver)==null?void 0:n.promise),this.enablePicking(),await((r=this.didRenderResolver)==null?void 0:r.promise),e.touches.forEach(i=>{this.handleInteraction(i,(s,a)=>{var o;(o=s.interactions)==null||o.handleTap(a,e,i)})})},handleDrag:async e=>{var n;await((n=this.willRenderResolver)==null?void 0:n.promise),this.handleInteraction(e,(r,i)=>{var s;(s=r.interactions)==null||s.handleMouseDrag(i,e)})},handleMouseDown:async e=>{var n;this.enablePicking(),await((n=this.willRenderResolver)==null?void 0:n.promise),this.handleInteraction(e,(r,i)=>{var s;return(s=r.interactions)==null?void 0:s.handleMouseDown(i,e)})},handleTouchDown:async e=>{var n;this.enablePicking(),await((n=this.willRenderResolver)==null?void 0:n.promise),e.touches.forEach(r=>{this.handleInteraction(r,(i,s)=>{var a;return(a=i.interactions)==null?void 0:a.handleTouchDown(s,e,r)})})},handleMouseUp:async e=>{var n;await((n=this.willRenderResolver)==null?void 0:n.promise),this.handleInteraction(e,(r,i)=>{var s;return(s=r.interactions)==null?void 0:s.handleMouseUp(i,e)})},handleTouchUp:async e=>{var n;await((n=this.willRenderResolver)==null?void 0:n.promise),e.touches.forEach(r=>{this.handleInteraction(r,(i,s)=>{var a;return(a=i.interactions)==null?void 0:a.handleTouchUp(s,e,r)})})},handleMouseOut:async e=>{var n;await((n=this.willRenderResolver)==null?void 0:n.promise),this.isOver.forEach(r=>{this.handleView(r,(i,s)=>{var a;return(a=i.interactions)==null?void 0:a.handleMouseOut(s,e)})}),this.isOver.clear()},handleTouchOut:async e=>{var n;await((n=this.willRenderResolver)==null?void 0:n.promise),e.touches.forEach(r=>{ka(this.isTouchOver,r.touch.touch.identifier,new Set).forEach(s=>{this.handleView(s,(a,o)=>{var c;return(c=a.interactions)==null?void 0:c.handleTouchOut(o,e,r)})}),this.isOver.clear()})},handleMouseMove:async e=>{var i;this.enablePicking(),await((i=this.willRenderResolver)==null?void 0:i.promise);const n=this.handleInteraction(e,(s,a)=>{var o;return(o=s.interactions)==null?void 0:o.handleMouseMove(a,e)}),r=new Set;n.forEach(s=>r.add(s)),this.isOver.forEach(s=>{r.has(s)||this.handleView(s,(a,o)=>{var c;return(c=a.interactions)==null?void 0:c.handleMouseOut(o,e)})}),r.forEach(s=>{this.isOver.has(s)||this.handleView(s,(a,o)=>{var c;return(c=a.interactions)==null?void 0:c.handleMouseOver(o,e)})}),this.isOver=r},handleTouchDrag:async e=>{var n;this.enablePicking(),await((n=this.willRenderResolver)==null?void 0:n.promise),e.touches.forEach(r=>{const i=this.handleInteraction(r,(o,c)=>{var l;return(l=o.interactions)==null?void 0:l.handleTouchMove(c,e,r)}),s=new Set;i.forEach(o=>s.add(o));const a=yr(this.isTouchOver,r.touch.touch.identifier,new Set);a.forEach(o=>{s.has(o)||this.handleView(o,(c,l)=>{var u;return(u=c.interactions)==null?void 0:u.handleTouchOut(l,e,r)})}),s.forEach(o=>{a.has(o)||this.handleView(o,(c,l)=>{var u;return(u=c.interactions)==null?void 0:u.handleTouchOver(l,e,r)})}),this.isTouchOver.set(r.touch.touch.identifier,s)})}}),this.isOver=new Set,this.isTouchOver=new Map}get scenes(){return!this.surface||!this.surface.sceneDiffs?[]:this.surface.sceneDiffs.items}enablePicking(){this.surface&&this.surface.enableOptimizedOutput(oe.PICKING)}willRender(){var e;for(let n=0,r=this.scenes.length;n<r;++n){const i=this.scenes[n];for(let s=0,a=i.layers.length;s<a;++s)(e=i.layers[s].interactions)==null||delete e.colorPicking}this.willRenderResolver&&this.willRenderResolver.resolve(),this.willRenderResolver=new ht,this.dequeue()}async didRender(){this.didRenderResolver&&this.didRenderResolver.resolve(),this.didRenderResolver=new ht}getSceneViewsUnderMouse(e){const n=new Map;for(let r=0,i=this.scenes.length;r<i;++r){const s=this.scenes[r];for(let a=0,o=s.views.length;a<o;++a){const c=s.views[a];n.set(c.id,c)}}return e.target.views.map(r=>n.get(r.view.id)).filter(Ue)}handleInteraction(e,n){const r=this.getSceneViewsUnderMouse(e);for(let i=0,s=r.length;i<s;++i){const a=r[i];this.handleView(a,n)}return r}handleView(e,n){for(let r=0,i=e.scene.layers.length;r<i;++r){const s=e.scene.layers[r];s.picking&&s.picking.type!==ue.NONE&&n(s,e)}}}class Bv{rawVertex(e){return e}rawFragment(e){return e}}class Uv extends Bv{vertex(e){let n=Ms(e);return U.SHADERS_3_0?(n=n.replace(/\s+varying\s+/g,`
out `),n=n.replace(/(texture2D(\s+)\(|texture2D\()/g,"texture(")):(n=n.replace(/^#version 300 es/g,""),n=n.replace(/\s+out\s+/g,`
varying `)),n}fragment(e){let n=Ms(e);if(U.SHADERS_3_0){if(n=n.replace(/\s+varying\s+/g,`
in `),n=n.replace(/(texture2D(\s+)\(|texture2D\()/g,"texture("),n.match(/gl_FragColor/g)&&(n=n.replace(/gl_FragColor/g,"_FragColor"),!n.match("out vec4 _FragColor"))){const r=n.split(`
`);r.splice(3,0,"layout(location = 0) out vec4 _FragColor;"),n=r.join(`
`)}}else n=n.replace(/^#version 300 es/g,""),n=n.replace(/\s+in\s+/g,`
varying `);return n}}function kv(t,e,n,r,i){const s={view:t,allColors:[],colorData:n,dataHeight:i,dataWidth:r,mouse:e,nearestColor:0,nearestColorBytes:[0,0,0,0]},a=new Map;let o=0;const c=r/2,l=i/2;let u=0,h=[0,0,0,0],f=Number.MAX_SAFE_INTEGER;for(let p=0;p<i;++p)for(let m=0;m<r;++m){const v=n[o],b=n[o+1],T=n[o+2];o+=4;const E=v<<16|b<<8|T;if(a.set(E,!0),E!==0){const S=m-c,I=p-l,x=S*S+I*I;x<f&&(f=x,u=E,h=[v,b,T,255])}}return s.allColors=Array.from(a.keys()),s.nearestColor=u,s.nearestColorBytes=h,s}class Gv{constructor(e){this.pickingRenderTargets=new Map,this.surface=e.surface}analyzePickedPixels(e,n){if(n.optimizeRendering)return;const r=Qi(Xe(e,this.surface.pixelRatio),n.projection.screenScale),i=5,s=5,a=4,o=new Uint8Array(i*s*a);this.surface.renderer.readPixels(Math.floor(r[0]-i/2),Math.floor(r[1]-s/2),i,s,o);const c=kv(n,[r[0]-n.screenBounds.x,r[1]-n.screenBounds.y],o,i,s);for(let l=0,u=n.scene.layers.length;l<u;++l){const h=n.scene.layers[l];h.picking.type===ue.SINGLE&&(h.interactions.colorPicking=c)}}decodePicking(){const e=this.surface.getCurrentInteraction();if(!e)return;const n=e.screen.position,r=e.target.views.map(s=>s.view),i=new Set;this.pickingRenderTargets.forEach((s,a)=>{const o=s.getBuffers()[0].buffer;o instanceof Re&&(!o.gl||o.destroyed)&&(s.dispose(),i.add(a))}),i.forEach(s=>this.pickingRenderTargets.delete(s)),r.forEach(s=>{let a=this.pickingRenderTargets.get(s);if(a||s.getRenderTargets().forEach(l=>{l.gl&&l.getBuffers().forEach(u=>{if(u.outputType===oe.PICKING){if(a=new hr({buffers:{color:u}}),a.width===0||a.height===0){a=void 0;return}this.pickingRenderTargets.set(s,a)}})}),!a)return;const o=this.surface.renderer.state.currentRenderTarget;let c=!1;o?(Array.isArray(o)||o.getBuffers()[0].buffer!==a.getBuffers()[0].buffer)&&(c=!0):c=!0,c&&this.surface.renderer.setRenderTarget(a),this.analyzePickedPixels(n,s)})}}const Ap=()=>[new Qf,new Xf,new jf],Sp=()=>[{type:xe.COLOR_BUFFER,manager:new d0},{type:xe.TEXTURE,manager:new Mf},{type:xe.ATLAS,manager:new xf({})},{type:xe.FONT,manager:new kf}],xp=()=>[new Uv],zv=[0,0,0,0];function Gl(t,e){return(t.order||Number.MAX_SAFE_INTEGER)-(e.order||Number.MAX_SAFE_INTEGER)}class Mp{constructor(e){this.commands=new Gv({surface:this}),this.frameMetrics={currentFrame:0,currentTime:Date.now()|0,frameDuration:1e3/60,previousTime:Date.now()|0},this.isBufferingResources=!1,this.ioExpanders=[],this.shaderTransforms=[],this.optimizedOutputs=new Set([oe.PICKING]),this.ioSorting=new _p,this.pixelRatio=window.devicePixelRatio,this.enabledOptimizedOutputs=new Set,this.viewDrawDependencies=new Map,this.resourceDiffs=new xs({buildItem:async n=>(await this.resourceManager.initResource(n),{id:n.key}),destroyItem:async(n,r)=>(await this.resourceManager.destroyResource(n),!0),updateItem:async(n,r)=>{await this.resourceManager.updateResource(n)}}),this.sceneDiffs=new xs({buildItem:async n=>new Ka(this,{key:n.key,views:n.views,layers:n.layers}),destroyItem:async(n,r)=>(r.destroy(),!0),updateItem:async(n,r)=>{await r.update(n)}}),this.readyResolver=new ht,this.ready=this.readyResolver.promise,e&&this.init(e)}get gl(){return this.context}get scenes(){return this.sceneDiffs.items}broadcastEventManagerCycle(e){for(let n=0,r=this.userInputManager.eventManagers.length;n<r;++n){const i=this.userInputManager.eventManagers[n];switch(e){case 1:i.didRender();break;case 0:i.willRender();break}}}async commit(e,n,r){if(!this.gl)return;let i=!1;n&&this.frameMetrics.currentFrame++,this.frameMetrics.frameDuration=this.frameMetrics.currentTime-this.frameMetrics.previousTime,this.frameMetrics.previousTime=this.frameMetrics.currentTime,e===void 0?this.frameMetrics.currentTime=Date.now()|0:(this.frameMetrics.previousTime===this.frameMetrics.currentTime&&(this.frameMetrics.previousTime=e),this.frameMetrics.currentTime=e),e=this.frameMetrics.currentTime;const s=this.sceneDiffs.items;s.sort(Gl);const a={};for(let c=0,l=s.length;c<l;++c){const u=s[c],h=u.views,f=u.layers;h.sort(Gl),f.sort(Gl);for(let p=0,m=h.length;p<m;++p){const v=h[p],b={};f.length>0&&v.willUseView();const T=this.renderer.getRenderSize();let E=new we({width:T[0],height:T[1],x:0,y:0});if(v.renderTarget){const D=(Array.isArray(v.renderTarget)?v.renderTarget[0]:v.renderTarget).getSize();E=new we({width:D[0],height:D[1],x:0,y:0})}const S=Lc(v.props.viewport,E,this.pixelRatio);v.fitViewtoViewport(E,S);for(let x=0,D=f.length;x<D;++x){const N=f[x];N.view=v;try{N.draw(),(N.needsViewDrawn||N.alwaysDraw)&&(v.needsDraw=!0),b[N.id]=N,v.animationEndTime=Math.max(v.animationEndTime,N.animationEndTime,v.props.camera.animationEndTime),N.lastFrameTime=e}catch(O){O instanceof Error&&(a[N.id]||(a[N.id]=[N,O]))}}if(v.needsDraw||e&&e<v.lastFrameTime||e&&e<v.animationEndTime||v.props.camera.needsViewDrawn){v.needsDraw=!0,i=!0;const x=this.viewDrawDependencies.get(v);x&&x.forEach(D=>{D.needsDraw=!0})}const I=Object.values(b);f.length!==I.length&&u.layerDiffs.diff(I.map(x=>x.initializer)),u.container&&r&&r(i,u,v)}}const o=Object.values(a);this.printLayerErrors(o)}destroy(){this.resourceManager.destroy(),this.userInputManager.destroy(),this.sceneDiffs.destroy(),this.renderer.dispose(),delete this.context}async draw(e){if(this.gl){this.broadcastEventManagerCycle(0);for(let n=0,r=this.sceneDiffs.items.length;n<r;++n){const i=this.sceneDiffs.items[n];for(let s=0,a=i.views.length;s<a;++s){const o=i.views[s];o.props.camera.broadcast(o.id)}}if(await this.commit(e,!0,(n,r,i)=>{r.container&&n&&this.drawSceneView(r.container,i)}),this.userInputManager.waitingForRender&&(this.userInputManager.waitingForRender=!1),!this.isBufferingResources){this.isBufferingResources=!0;const n=await this.resourceManager.dequeueRequests();this.isBufferingResources=!1,n&&this.draw(await jn())}for(let n=0,r=this.sceneDiffs.items.length;n<r;++n){const i=this.sceneDiffs.items[n];for(let s=0,a=i.views.length;s<a;++s){const o=i.views[s];o.needsDraw=!1,o.props.camera.resolve()}for(let s=0,a=i.layers.length;s<a;++s){const o=i.layers[s];o.needsViewDrawn=!1}}this.broadcastEventManagerCycle(1),this.enabledOptimizedOutputs.clear()}}drawSceneView(e,n,r,i){r=r||this.renderer;const s={x:n.viewBounds.left,y:n.viewBounds.top},a=n.viewBounds,o=n.props.background||zv,c=n.clearFlags.indexOf(Pi.COLOR)>-1,l=i||n.renderTarget||null;n.renderTarget&&(n.getRenderTargets().forEach(h=>this.optimizedOutputs.forEach(f=>h.disabledTargets.add(f))),this.enabledOptimizedOutputs.size>0&&n.getRenderTargets().forEach(f=>this.enabledOptimizedOutputs.forEach(p=>f.disabledTargets.delete(p)))),r.setRenderTarget(l),r.setScissor({x:s.x,y:s.y,width:a.width,height:a.height},l),c&&r.clearColor([o[0],o[1],o[2],o[3]]),r.setViewport({x:s.x,y:s.y,width:a.width,height:a.height}),n.clearFlags&&n.clearFlags.length>0?r.clear(c,n.clearFlags.indexOf(Pi.DEPTH)>-1,n.clearFlags.indexOf(Pi.STENCIL)>-1):r.clear(!1),r.render(e,l,n.props.glState),n.lastFrameTime=this.frameMetrics.currentTime}fitContainer(e){if(!this.context||$r(this.context.canvas))return;const n=this.context.canvas.parentElement;if(n){const r=this.context.canvas;r.className="",r.setAttribute("style",""),n.style.position="relative",r.style.position="absolute",r.style.left="0xp",r.style.top="0xp",r.style.width="100%",r.style.height="100%",r.setAttribute("width",""),r.setAttribute("height","");const i=n.getBoundingClientRect(),s=r.getBoundingClientRect();this.resize(s.width||100,i.height||100)}}gatherViewDrawDependencies(){if(!this.sceneDiffs)return;this.viewDrawDependencies.clear();const e=this.sceneDiffs.items,n=this.renderer.getRenderSize();for(let r=0,i=e.length;r<i;r++){const s=e[r];for(let a=0,o=s.views.length;a<o;++a){const c=s.views[a];c.willUseView();let l=new we({width:n[0],height:n[1],x:0,y:0});if(c.renderTarget){const f=(Array.isArray(c.renderTarget)?c.renderTarget[0]:c.renderTarget).getSize();l=new we({width:f[0],height:f[1],x:0,y:0})}const u=Lc(c.props.viewport,l,this.pixelRatio);c.fitViewtoViewport(l,u),c.props.camera.update(!0)}}for(let r=0,i=e.length;r<i;r++){const s=e[r];for(let a=0,o=s.views.length;a<o;++a){const c=s.views[a],l=[];for(let u=0,h=e.length;u<h;u++)if(u!==r){const f=e[u];for(let p=0,m=f.views.length;p<m;++p){const v=f.views[p];c.viewBounds.hitBounds(v.viewBounds)&&l.push(v)}}this.viewDrawDependencies.set(c,l)}}}getCurrentInteraction(){return this.userInputManager.currentInteraction}getIOExpanders(){return this.ioExpanders}getIOSorting(){return this.ioSorting}getShaderTransforms(){return this.shaderTransforms}getOptimizedOutputs(){return this.enabledOptimizedOutputs}getViewSize(e){for(let n=0,r=this.sceneDiffs.items.length;n<r;++n){const s=this.sceneDiffs.items[n].viewDiffs.getByKey(e);if(s)return s.renderTarget?s.viewBounds:s.screenBounds}return null}getViewWorldBounds(e){for(let n=0,r=this.sceneDiffs.items.length;n<r;++n){const s=this.sceneDiffs.items[n].viewDiffs.getByKey(e);if(s)if(s.screenBounds){const a=s.projection.viewToWorld([0,0]),o=s.projection.screenToWorld([s.screenBounds.right,s.screenBounds.bottom]);return new we({bottom:o[1],left:a[0],right:o[0],top:a[1]})}else return null}return null}getProjections(e){for(let n=0,r=this.sceneDiffs.items.length;n<r;++n){const s=this.sceneDiffs.items[n].viewDiffs.getByKey(e);if(s)return s.projection}return null}async init(e){var r;if(this.context)return this;this.pixelRatio=e.pixelRatio||this.pixelRatio,this.pixelRatio<1&&(this.pixelRatio=1);const n=this.initGL(e);return n?(this.context=n,this.gl?((r=e.optimizedOutputTargets)==null||r.forEach(i=>this.optimizedOutputs.add(i)),this.initUserInputManager(e),await this.initResources(e),await this.initIOExpanders(e),await this.initShaderTransforms(e)):console.warn("Could not establish a GL context. Layer Surface will be unable to render"),this.readyResolver.resolve(this),this):(this.readyResolver.reject({error:kc.NO_WEBGL_CONTEXT,message:"Could not establish a webgl context. Surface is being destroyed to free resources."}),this.destroy(),this)}initGL(e){const n=e.context;if(!n)return null;const r=n.width,i=n.height;let s=!0;const a=Object.assign({alpha:!1,antialias:!1,preserveDrawingBuffer:!1,premultiplyAlpha:!1},e.rendererOptions);return this.renderer=new wh({alpha:a.alpha,antialias:a.antialias,canvas:n,preserveDrawingBuffer:a.preserveDrawingBuffer,premultipliedAlpha:a.premultipliedAlpha,onNoContext:()=>{s=!1}}),!s||!this.renderer.gl?null:(this.context=this.renderer.gl,this.resourceManager&&this.resourceManager.setWebGLRenderer(this.renderer),this.setRendererSize(r,i),this.renderer.setPixelRatio(this.pixelRatio),this.renderer.gl)}initIOExpanders(e){const n=Ap();Array.isArray(e.ioExpansion)||e.ioExpansion===void 0?this.ioExpanders=e.ioExpansion&&e.ioExpansion.slice(0)||n.slice(0)||[]:e.ioExpansion instanceof Function&&(this.ioExpanders=e.ioExpansion(n));const r=this.resourceManager.getIOExpansion();this.ioExpanders=this.ioExpanders.concat(r)}initShaderTransforms(e){const n=xp();Array.isArray(e.shaderTransforms)||e.shaderTransforms===void 0?this.shaderTransforms=e.shaderTransforms&&e.shaderTransforms.slice(0)||n.slice(0)||[]:e.shaderTransforms instanceof Function&&(this.shaderTransforms=e.shaderTransforms(n))}initUserInputManager(e){if(!this.context)return;const n=[new Rp].concat(e.eventManagers||[]);this.userInputManager=new bp(this.context.canvas,this,n,e.handlesWheelEvents)}async initResources(e){const n=Sp();this.resourceManager=new Ll,this.resourceManager.setWebGLRenderer(this.renderer),(e.resourceManagers&&e.resourceManagers.slice(0)||n.slice(0)||[]).forEach(i=>{this.resourceManager.setManager(i.type,i.manager)})}async pipeline(e){e.resources&&await this.resourceDiffs.diff(e.resources),e.scenes&&await this.sceneDiffs.diff(e.scenes),this.gatherViewDrawDependencies()}printLayerErrors(e){e.length>0&&(console.warn("Some layers errored during their draw update. These layers will be removed. They can be re-added if render() is called again:",e.map(n=>n[0].id)),e.forEach(n=>{if(console.warn(`Layer ${n[0].id} removed for the following error:`),n[1]){const r=n[1].stack||n[1].message;if(console.error(r),r.indexOf("RangeError")>-1||r.indexOf("Source is too large")>-1){const i=n[0],s=i.bufferManager.changeListContext||[];let a,o=0;for(let c=0,l=s.length;c<l;++c){const[u]=s[c];i.shaderIOInfo.instanceAttributes.forEach(h=>{h.update(u).length!==h.size&&(a||(a=["Example instance returned the wrong sized value for an attribute:",u,h]),o++)})}a&&(console.error("The following output shows discovered issues related to the specified error"),console.error(`Instances are returning too large IO for an attribute
`,a[0],a[1],a[2],"Total errors for too large IO values",o))}}}))}resize(e,n,r){if(this.pixelRatio=r||this.pixelRatio,this.pixelRatio<1&&(this.pixelRatio=1),this.setRendererSize(e,n),this.renderer.setPixelRatio(this.pixelRatio),this.userInputManager.resize(),this.resourceManager.resize(),this.sceneDiffs){const i=this.sceneDiffs.items;for(let s=0,a=i.length;s<a;++s){const o=i[s];for(let c=0,l=o.views.length;c<l;++c){const u=o.views[c];u.pixelRatio=this.pixelRatio,u.props.camera.update(!0)}}}this.gatherViewDrawDependencies()}redraw(){for(let e=0,n=this.sceneDiffs.items.length;e<n;++e){const r=this.sceneDiffs.items[e];for(let i=0,s=r.views.length;i<s;++i){const a=r.views[i];a.needsDraw=!0}}}setRendererSize(e,n){e=e||100,n=n||100,this.renderer.setSize(e,n)}enableOptimizedOutput(e){this.enabledOptimizedOutputs.add(e)}}class zl extends Sn{draw(){this.props.commands(this.surface)}initShader(){return null}}zl.defaultProps={data:new Oe,key:"",commands:()=>{}};class nt extends Sn{constructor(e,n,r){super(e,n,r)}baseShaderModules(e){const n=super.baseShaderModules(e);return n.vs.push("world2D"),n}}const Vv=`
These are projection methods and camera
related constants associated with a
View2D.

Methods:
vec3 cameraSpace(vec3 world);
vec3 cameraSpaceSize(vec3 worldSize);
vec4 clipSpace(vec3 world);
vec4 clipSpaceSize(vec3 worldSize);

Constants:
mat4 projection;
mat4 view;
mat4 viewProjection;
vec3 cameraOffset;
vec3 cameraPosition;
vec3 cameraScale;
vec3 cameraScale2D;
vec3 cameraRotation;
vec2 viewSize;
float pixelRatio;
`;Qe.register([{moduleId:"world2D",description:Vv,content:Ep,compatibility:P.ALL,uniforms:t=>t instanceof nt?[{name:"projection",size:L.MATRIX4,update:()=>t.view.props.camera.projection},{name:"view",size:L.MATRIX4,update:()=>t.view.props.camera.view},{name:"viewProjection",size:L.MATRIX4,update:()=>t.view.props.camera.viewProjection},{name:"cameraOffset",size:L.THREE,update:()=>t.view.props.camera instanceof Zn?t.view.props.camera.control2D.offset:[0,0,0]},{name:"cameraPosition",size:L.THREE,update:()=>t.view.props.camera.position},{name:"cameraScale",size:L.THREE,update:()=>t.view.props.camera.scale},{name:"cameraScale2D",size:L.THREE,update:()=>t.view.props.camera instanceof Zn?t.view.props.camera.scale2D:[1,1,1]},{name:"cameraRotation",size:L.THREE,update:()=>t.view.props.camera.scale},{name:"viewSize",size:L.TWO,update:()=>[t.view.viewBounds.width,t.view.viewBounds.height]},{name:"pixelRatio",size:L.ONE,update:()=>[t.view.pixelRatio]}]:(console.warn("A shader requested the module world2D; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}]);var $=(t=>(t[t.BottomLeft=0]="BottomLeft",t[t.BottomMiddle=1]="BottomMiddle",t[t.BottomRight=2]="BottomRight",t[t.Custom=3]="Custom",t[t.Middle=4]="Middle",t[t.MiddleLeft=5]="MiddleLeft",t[t.MiddleRight=6]="MiddleRight",t[t.TopLeft=7]="TopLeft",t[t.TopMiddle=8]="TopMiddle",t[t.TopRight=9]="TopRight",t))($||{}),xn=(t=>(t[t.ALWAYS=1]="ALWAYS",t[t.BOUND_MAX=2]="BOUND_MAX",t[t.NEVER=3]="NEVER",t))(xn||{}),Ip=(t=>(t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_MIDDLE=1]="TOP_MIDDLE",t[t.TOP_RIGHT=2]="TOP_RIGHT",t[t.MIDDLE_LEFT=3]="MIDDLE_LEFT",t[t.MIDDLE=4]="MIDDLE",t[t.MIDDLE_RIGHT=5]="MIDDLE_RIGHT",t[t.BOTTOM_LEFT=6]="BOTTOM_LEFT",t[t.BOTTOM_MIDDLE=7]="BOTTOM_MIDDLE",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT",t))(Ip||{});class Cp extends Ur{constructor(e){super({}),this._uid=Y(),this.isPanning=!1,this.isScaling=!1,this.panFilter=(n,r,i)=>n,this.scaleFilter=(n,r,i)=>n,this.startViews=[],this.optimizedViews=new Set,this.cameraImmediateAnimation=Aa.immediate(0),this.targetTouches=new Set,this.onRangeChanged=(n,r)=>{},this.startViewDidStart=!1,this.applyBounds=()=>{if(this.bounds&&this.camera){const n=this.getView(this.bounds.view);this.applyScaleBounds(),n&&(this.camera.control2D.getOffset()[0]=this.boundsHorizontalOffset(n,this.bounds),this.camera.control2D.getOffset()[1]=this.boundsVerticalOffset(n,this.bounds))}},this.applyScaleBounds=()=>{this.camera&&this.bounds&&(this.bounds.scaleMin&&this.camera.control2D.setScale(ea(this.camera.control2D.getScale(),this.bounds.scaleMin)),this.bounds.scaleMax&&this.camera.control2D.setScale(ta(this.camera.control2D.getScale(),this.bounds.scaleMax)))},this.handleCameraViewChange=(n,r)=>{if(r!==this.startViews[0])return;const i=this.surface.getProjections(r);i&&this.onRangeChanged(n,i)},e.bounds&&this.setBounds(e.bounds),this._camera=e.camera,this.scaleFactor=e.scaleFactor||1e3,this.ignoreCoverViews=e.ignoreCoverViews||!1,this.twoFingerPan=e.twoFingerPan||!1,e.startView&&(Array.isArray(e.startView)?(this.startViews=e.startView,this._camera.control2D.setViewChangeHandler(this.handleCameraViewChange)):(this.startViews=[e.startView],this._camera.control2D.setViewChangeHandler(this.handleCameraViewChange))),this.panFilter=e.panFilter||this.panFilter,this.scaleFilter=e.scaleFilter||this.scaleFilter,this.onRangeChanged=e.onRangeChanged||this.onRangeChanged,e.wheelShouldScroll&&(this.wheelShouldScroll=e.wheelShouldScroll)}get uid(){return this._uid}get camera(){return this._camera}anchoredByBoundsHorizontal(e,n){switch(n.anchor){case 0:case 3:case 6:return-(n.worldBounds.left-n.screenPadding.left/this.camera.control2D.getScale()[0]);case 1:case 4:case 7:return-(n.worldBounds.right-n.worldBounds.width/2-.5*((e.screenBounds.width+n.screenPadding.right)/this.camera.control2D.getScale()[0]));case 2:case 5:case 8:return-(n.worldBounds.right-(e.screenBounds.width-n.screenPadding.right)/this.camera.control2D.getScale()[0])}}anchoredByBoundsVertical(e,n){switch(n.anchor){case 0:case 1:case 2:return-(n.worldBounds.top-n.screenPadding.top/this.camera.control2D.getScale()[1]);case 3:case 4:case 5:return-(n.worldBounds.bottom-n.worldBounds.height/2-.5*((e.screenBounds.height+n.screenPadding.bottom)/this.camera.control2D.getScale()[1]));case 6:case 7:case 8:return-(n.worldBounds.bottom-(e.screenBounds.height-n.screenPadding.bottom)/this.camera.control2D.getScale()[1])}}boundsHorizontalOffset(e,n){const r=e.projection.worldToScreen([n.worldBounds.left,n.worldBounds.top]),i=e.projection.worldToScreen([n.worldBounds.right,n.worldBounds.bottom]);return i[0]-r[0]+n.screenPadding.left+n.screenPadding.right-e.screenBounds.width<0?this.anchoredByBoundsHorizontal(e,n):i[0]<e.screenBounds.right-n.screenPadding.right?-n.worldBounds.right+(e.screenBounds.width-n.screenPadding.right)/this.camera.control2D.getScale()[0]:r[0]>e.screenBounds.left+n.screenPadding.left?-n.worldBounds.left+n.screenPadding.left/this.camera.control2D.getScale()[0]:this.camera.control2D.getOffset()[0]}boundsVerticalOffset(e,n){const r=e.projection.worldToScreen([n.worldBounds.left,n.worldBounds.top]),i=e.projection.worldToScreen([n.worldBounds.right,n.worldBounds.bottom]);return i[1]-r[1]+n.screenPadding.top+n.screenPadding.bottom-e.screenBounds.height<0?this.anchoredByBoundsVertical(e,n):i[1]<e.screenBounds.bottom-n.screenPadding.bottom?-n.worldBounds.bottom+(e.screenBounds.height-n.screenPadding.bottom)/this.camera.control2D.getScale()[1]:r[1]>e.screenBounds.top+n.screenPadding.top?-n.worldBounds.top+n.screenPadding.top/this.camera.control2D.getScale()[0]:this.camera.control2D.getOffset()[1]}canStart(e){return this.startViews.length===0||this.startViews&&this.startViews.indexOf(e)>-1||this.startViewDidStart&&this.ignoreCoverViews}centerOn(e,n){if(!this.camera.control2D.surface)return;const r=this.camera.control2D.surface.getViewSize(e);if(!r)return;const i=[r.width/2,r.height/2,0],s=qt(n,Yi(i,this.camera.control2D.getScale())),a=Mt(s,-1);this.setOffset(e,a)}doPan(e,n,r){let i=cr(Qi(r,this.camera.control2D.getScale()),0);this.panFilter&&(i=this.panFilter(i,n,e)),this.camera.control2D.getOffset()[0]+=i[0],this.camera.control2D.getOffset()[1]+=i[1],this.applyBounds(),this.onRangeChanged(this.camera,n.projection),this.applyBounds(),this.camera.control2D.update()}doScale(e,n,r,i){const s=n.projection.screenToWorld(e),a=this.camera.control2D.getScale()[0]||1,o=this.camera.control2D.getScale()[1]||1;this.scaleFilter&&(i=this.scaleFilter(i,n,r)),this.camera.control2D.getScale()[0]=a+i[0],this.camera.control2D.getScale()[1]=o+i[1],this.applyScaleBounds();const c=n.projection.screenToWorld(e),l=je(s,c);this.camera.control2D.getOffset()[0]-=l[0],this.camera.control2D.getOffset()[1]-=l[1],this.applyBounds(),this.onRangeChanged(this.camera,n.projection),this.applyBounds(),this.camera.control2D.update(),this.camera.control2D.animation=this.cameraImmediateAnimation}filterTouchesByValidStart(e){return this.ignoreCoverViews?e.filter(Lh(this.startViews)):e.filter(Ch(this.startViews))}findCoveredStartView(e){const n=e.target.views.find(r=>this.startViews.indexOf(r.view.id)>-1);this.startViewDidStart=!!n,n&&(this.coveredStartView=n.view)}getRange(e){const n=this.getProjection(e),r=this.getViewScreenBounds(e);if(n&&r){const i=n.screenToWorld([r.x,r.y]),s=n.screenToWorld([r.right,r.bottom]);return new we({height:s[1]-i[1],width:s[0]-i[0],x:i[0],y:i[1]})}return new we({x:0,y:0,width:1,height:1})}getTargetView(e){return this.startViews&&!this.ignoreCoverViews?e.target.view:this.coveredStartView}handleMouseDown(e){this.startViews&&(this.findCoveredStartView(e),e.start&&(this.isPanning=this.canStart(e.start.view.id)||this.isPanning))}handleTouchDown(e){if(this.startViews){const n=this.filterTouchesByValidStart(e.allTouches);this.twoFingerPan?n.length>1&&(this.isPanning=!0):n.length>0&&(this.isPanning=!0),n.length>1&&(this.isScaling=!0);for(let r=0,i=n.length;r<i;++r){const s=n[r];this.targetTouches.add(s.touch.touch.identifier)}}}handleMouseUp(e){this.startViewDidStart=!1,this.isPanning=!1,this.optimizedViews.forEach(n=>n.optimizeRendering=!1),this.optimizedViews.clear()}handleTouchUp(e){e.touches.forEach(n=>{this.targetTouches.delete(n.touch.touch.identifier),this.targetTouches.size<=0&&(this.startViewDidStart=!1,this.isPanning=!1,this.optimizedViews.forEach(r=>r.optimizeRendering=!1),this.optimizedViews.clear())}),this.isPanning=!1,this.isScaling=!1,this.targetTouches.size>0&&(this.isPanning=!0),this.targetTouches.size>1&&(this.isScaling=!0)}handleTouchCancelled(e){e.touches.forEach(n=>{this.targetTouches.delete(n.touch.touch.identifier),this.targetTouches.size<=0&&(this.startViewDidStart=!1,this.isPanning=!1,this.optimizedViews.forEach(r=>r.optimizeRendering=!1),this.optimizedViews.clear())}),this.isPanning=!1,this.isScaling=!1,this.targetTouches.size>0&&(this.isPanning=!0),this.targetTouches.size>1&&(this.isScaling=!0)}handleDrag(e){e.start&&this.canStart(e.start.view.id)&&(e.target.views.forEach(n=>{n.view.optimizeRendering=!0,this.optimizedViews.add(n.view)}),this.doPan(e.target.views.map(n=>n.view),e.start.view,e.mouse.deltaPosition),this.camera.control2D.animation=this.cameraImmediateAnimation)}handleTouchDrag(e){const n=this.filterTouchesByValidStart(e.allTouches);if(n.length>0&&this.isPanning){for(let a=0,o=n.length;a<o;++a)n[a].target.views.forEach(l=>{l.view.optimizeRendering=!0,this.optimizedViews.add(l.view)});const r=new Set,s=n.reduce((a,o)=>{for(let c=0,l=o.target.views.length;c<l;++c){const u=o.target.views[c];r.add(u.view)}return o.touch.startTime<a.touch.startTime?o:a},n[0]).start.view;if(this.isPanning&&(this.doPan(Array.from(r.values()),s,e.multitouch.centerDelta(n)),this.camera.control2D.animation=this.cameraImmediateAnimation),this.isScaling){const a=e.multitouch.center(n),o=je(n[0].touch.currentPosition,a),c=je(a,e.multitouch.centerDelta(n)),l=je(n[0].touch.previousPosition,c),u=or(o)/or(l),h=[u*this.camera.scale2D[0]-this.camera.scale2D[0],u*this.camera.scale2D[1]-this.camera.scale2D[1],0];u!==1&&this.doScale(a,s,Array.from(r.values()),h)}}}handleWheel(e){if(this.findCoveredStartView(e),this.canStart(e.target.view.id))if(this.wheelShouldScroll){const n=[-e.mouse.wheel.delta[0],e.mouse.wheel.delta[1]];e.start&&this.doPan(e.target.views.map(r=>r.view),e.start.view,n)}else{const n=this.camera.control2D.getScale()[0]||1,r=this.camera.control2D.getScale()[1]||1,i=this.getTargetView(e),s=[e.mouse.wheel.delta[1]/this.scaleFactor*n,e.mouse.wheel.delta[1]/this.scaleFactor*r,1];if(!i){console.warn("Could not find target view for wheel event");return}this.doScale(e.screen.position,i,e.target.views.map(a=>a.view),s)}}get pan(){return this.camera.control2D.offset}get scale(){return this.camera.control2D.getScale()}setBounds(e){this.bounds=e,this.applyBounds()}setOffset(e,n){const r=xt(this.camera.control2D.offset);if(this.camera.control2D.getOffset()[0]=n[0],this.camera.control2D.getOffset()[1]=n[1],this.camera.control2D.getOffset()[2]=n[2],this.applyBounds(),this.camera.control2D.surface){const a=this.camera.control2D.surface.getProjections(e);a&&this.onRangeChanged(this.camera,a)}this.applyBounds();const i=xt(this.camera.control2D.getOffset()),s=this.camera.control2D.animation;this.camera.control2D.setOffset(r),this.camera.control2D.animation=this.cameraImmediateAnimation,this.camera.control2D.setOffset(i),this.camera.control2D.animation=s}setRange(e,n){const r=this.getProjection(n),i=this.getViewScreenBounds(n),s=this.getView(n);if(r&&i&&s){const a=qt([i.width/e.width,i.height/e.height,1],this.camera.control2D.getScale());this.camera.control2D.setScale(Yt(this.camera.control2D.getScale(),this.scaleFilter(a,s,[s])));const o=qt([-e.x,-e.y,0],this.camera.control2D.offset);this.camera.control2D.setOffset(Yt(this.camera.control2D.offset,this.scaleFilter(o,s,[s]))),this.applyBounds(),this.onRangeChanged(this.camera,s.projection),this.applyBounds()}}setRangeChangeHandler(e){this.onRangeChanged=e}}class $v extends Kn{constructor(e,n){super(e),this.offsetFilter=r=>r,this.scaleFilter=r=>r,this.base=n.base,this.offsetFilter=n.offsetFilter||this.offsetFilter,this.scaleFilter=n.scaleFilter||this.scaleFilter}set offset(e){}get offset(){return this.offsetFilter(this.base.offset)}set scale(e){}get scale(){return this.scaleFilter(this.base.scale)}}class Wv extends Zn{constructor(e){super(),this.base=e.base,this._control2D=new $v(this.base,{base:this.base.control2D,offsetFilter:e.offsetFilter,scaleFilter:e.scaleFilter})}set control2D(e){}get control2D(){return this._control2D}}const jv=new Zn;class Hv extends ba{constructor(){super(...arguments),this.camera=jv}screenToWorld(e,n){const r=this.screenToView(e),i=n||[0,0];return i[0]=(r[0]-this.camera.control2D.offset[0]*this.camera.scale2D[0])/this.camera.scale2D[0],i[1]=(r[1]-this.camera.control2D.offset[1]*this.camera.scale2D[1])/this.camera.scale2D[1],i}screenRay(e){const n=this.screenToWorld(e);return[[n[0],n[1],0],[n[0],n[1],-1]]}worldToScreen(e,n){const r=[0,0];return r[0]=(e[0]*this.camera.scale2D[0]+this.camera.control2D.offset[0]*this.camera.scale2D[0])*this.pixelRatio,r[1]=(e[1]*this.camera.scale2D[1]+this.camera.control2D.offset[1]*this.camera.scale2D[1])*this.pixelRatio,this.viewToScreen(r,n)}viewToWorld(e,n){const r=n||[0,0],i=e;return r[0]=(i[0]-this.camera.control2D.offset[0]*this.camera.scale2D[0])/this.camera.scale2D[0],r[1]=(i[1]-this.camera.control2D.offset[1]*this.camera.scale2D[1])/this.camera.scale2D[1],r}worldToView(e,n){const r=n||[0,0];return r[0]=e[0]*this.camera.scale2D[0]+this.camera.control2D.offset[0]*this.camera.scale2D[0],r[1]=e[1]*this.camera.scale2D[1]+this.camera.control2D.offset[1]*this.camera.scale2D[1],r}}function Lp(t){return t.projectionType===Hn.ORTHOGRAPHIC}class Za extends Ns{constructor(e,n){super(e,n),this.projection=new Hv,this.projection.camera=n.camera||new Zn}fitViewtoViewport(e,n){if(Lp(this.props.camera)){const r=n.width,i=n.height,s={bottom:-i/2,far:1e7,left:-r/2,near:-100,right:r/2,top:i/2},a=1/this.pixelRatio,o=1/this.pixelRatio,c=this.props.camera;c.projectionOptions=Object.assign(c.projectionOptions,s),c.position=[n.width/(2*this.pixelRatio),n.height/(2*this.pixelRatio),c.position[2]],c.scale=[a,-o,1],c.lookAt(Yt(c.position,[0,0,-1]),[0,1,0]),c.update(),this.projection.viewBounds=n,n.d=this,this.projection.screenBounds=new we({height:this.viewBounds.height/this.pixelRatio,width:this.viewBounds.width/this.pixelRatio,x:this.viewBounds.x/this.pixelRatio,y:this.viewBounds.y/this.pixelRatio}),this.screenBounds.d=this}else Lp(this.props.camera)||console.warn("View2D does not support non-orthographic cameras.")}willUpdateProps(e){this.projection.camera=e.camera}}Za.defaultProps={key:"",camera:new Zn,viewport:{left:0,right:0,bottom:0,top:0}};const Qv=`precision highp float;
varying vec4 vertexColor;
void main() {
gl_FragColor = vertexColor;
}`,Xv=`precision highp float;
varying vec4 vertexColor;
vec2 interpolation(float t, vec2 center, float radius, float start, float end) {
float angle = (end - start) * t + start;
return center + vec2(cos(angle) * radius, sin(angle) * radius);
}
void main() {
float startAngle = angle.x;
float endAngle = angle.y;
float widthStart = thickness.x;
float widthEnd = thickness.y;
vec4 centerClip = clipSpace(vec3(center, depth));
vec2 centerScreen = (centerClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;
float normal = position.x;
float interpolationTime = position.y;
float interpolationIncrement = 1.0 / position.z;
vec2 currentPosition = interpolation(interpolationTime, centerScreen, radius, startAngle, endAngle);
vec2 currentNormal = normalize(currentPosition - centerScreen);
float lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;
vec2 vertex = currentPosition + currentNormal * (normal * lineThickness);
vertexColor = mix(colorStart, colorEnd, interpolationTime);
vertexColor *= vertexColor.a;
gl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), centerClip.zw);
gl_PointSize = 5.0;
}`,Yv=`\${import: arc}
precision highp float;
varying vec4 vertexColor;
void main() {
float startAngle = angle.x + angleOffset;
float endAngle = angle.y + angleOffset;
float widthStart = thickness.x;
float widthEnd = thickness.y;
float normal = vertex.x;
float interpolationTime = vertex.y;
float interpolationIncrement = 1.0 / vertex.z;
vec2 currentPosition = arc(interpolationTime, center, radius, startAngle, endAngle);
vec2 currentNormal = normalize(currentPosition - center);
float lineThickness = mix(widthStart, widthEnd, interpolationTime) / 2.0;
vec2 vertex = currentPosition + currentNormal * (normal * lineThickness);
vertexColor = mix(colorStart, colorEnd, interpolationTime);
gl_Position = clipSpace(vec3(vertex, depth));
}`;var Op=(t=>(t[t.NONE=0]="NONE",t[t.SCREEN_CURVE=1]="SCREEN_CURVE",t))(Op||{});const Jn=class extends nt{initShader(){const{scaleType:t}=this.props,e=this.props.animate||{},{angle:n,angleOffset:r,center:i,radius:s,thickness:a,colorStart:o,colorEnd:c}=e,l=150,u={0:1,[l*2+2]:-1},h={0:0,[l*2+2]:1};let f=1;for(let m=0;m<l*2;++m)u[m+1]=f,h[m+1]=Math.floor(m/2)/(l-1),f*=-1;const p=t===0?Yv:Xv;return{fs:Qv,instanceAttributes:[{easing:i,name:Jn.attributeNames.center,size:k.TWO,update:m=>m.center},{easing:s,name:Jn.attributeNames.radius,size:k.ONE,update:m=>[m.radius]},{name:Jn.attributeNames.depth,size:k.ONE,update:m=>[m.depth]},{easing:a,name:Jn.attributeNames.thickness,size:k.TWO,update:m=>m.thickness},{easing:n,name:Jn.attributeNames.angle,size:k.TWO,update:m=>m.angle},{easing:r,name:Jn.attributeNames.angleOffset,size:k.ONE,update:m=>[m.angleOffset]},{easing:o,name:Jn.attributeNames.colorStart,size:k.FOUR,update:m=>m.colorStart},{easing:c,name:Jn.attributeNames.colorEnd,size:k.FOUR,update:m=>m.colorEnd}],uniforms:[{name:"scaleFactor",size:L.ONE,update:m=>[1]}],vertexAttributes:[{name:"vertex",size:ct.THREE,update:m=>[u[m],h[m],l*2]}],vertexCount:l*2+2,vs:p}}getMaterialOptions(){return Object.assign({},At.transparentShapeBlending,{culling:d.GLSettings.Material.CullSide.NONE})}};let Vl=Jn;Vl.defaultProps={data:new Oe,key:"",scaleType:0},Vl.attributeNames={angle:"angle",angleOffset:"angleOffset",center:"center",colorEnd:"colorEnd",colorStart:"colorStart",depth:"depth",radius:"radius",thickness:"thickness"};var qv=Object.defineProperty,Kv=Object.getOwnPropertyDescriptor,Rr=(t,e,n,r)=>{for(var i=r>1?void 0:r?Kv(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(r?a(e,n,i):a(i))||i);return r&&i&&qv(e,n,i),i};const Np=class extends dt{constructor(t){super(t),this.angle=[0,Math.PI],this.colorEnd=[1,1,1,1],this.colorStart=[1,1,1,1],this.center=[0,0],this.depth=0,this.angleOffset=0,this.radius=1,this.thickness=[5,5],vt(this,Np),this.angle=t.angle||this.angle,this.colorEnd=t.colorEnd||this.colorEnd,this.colorStart=t.colorStart||this.colorStart,this.center=t.center||this.center,this.depth=t.depth||this.depth,this.radius=t.radius||this.radius,this.thickness=t.thickness||this.thickness}};let er=Np;Rr([B],er.prototype,"angle",2),Rr([B],er.prototype,"colorEnd",2),Rr([B],er.prototype,"colorStart",2),Rr([B],er.prototype,"center",2),Rr([B],er.prototype,"depth",2),Rr([B],er.prototype,"angleOffset",2),Rr([B],er.prototype,"radius",2),Rr([B],er.prototype,"thickness",2);const Zv=`precision highp float;
varying vec4 vertexColor;
varying float edgeSharpness;
varying float edgeSharpnessBase;
varying vec2 pointCoord;
float circle(vec2 coord, float radius){
vec2 dist = coord - vec2(0.5);
return 1.0 - smoothstep(
radius - (radius * edgeSharpness),
radius + (radius * edgeSharpnessBase),
dot(dist, dist) * 4.0
);
}
void main() {
float step_factor = circle(pointCoord, 1.0);
\${out: color} = mix(
vec4(0.0, 0.0, 0.0, 0.0),
vertexColor,
step_factor
);
if (color.a == 0.0) discard;
}`,Jv=`precision highp float;
varying vec4 vertexColor;
varying float edgeSharpness;
varying float edgeSharpnessBase;
float circle(vec2 coord, float radius){
vec2 dist = coord - vec2(0.5);
return 1.0 - smoothstep(
radius - (radius * edgeSharpness),
radius + (radius * edgeSharpnessBase),
dot(dist, dist) * 4.0
);
}
void main() {
float step_factor = circle(gl_PointCoord, 1.0);
\${out: color} = mix(
vec4(0.0, 0.0, 0.0, 0.0),
vertexColor,
step_factor
);
if (color.a == 0.0) discard;
}`,ey=`precision highp float;
varying vec4 vertexColor;
varying float edgeSharpness;
varying float edgeSharpnessBase;
void main() {
vertexColor = color;
vertexColor.a *= layerOpacity;
float size = radius * cameraScale2D.x;
edgeSharpness = mix(0.8, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));
edgeSharpnessBase = mix(0.1, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));
gl_Position = clipSpace(vec3(center, depth));
gl_PointSize = size * 2.0 * pixelRatio;
}`,ty=`precision highp float;
varying vec4 vertexColor;
varying float edgeSharpness;
varying float edgeSharpnessBase;
varying vec2 pointCoord;
void main() {
vertexColor = color;
vertexColor.a *= layerOpacity;
float size = radius * cameraScale2D.x * pixelRatio;
edgeSharpness = mix(0.8, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));
edgeSharpnessBase = mix(0.1, 0.0, min((size * 6.0 * pixelRatio) / (45.0 * pixelRatio), 1.0));
pointCoord = (normals.xy + vec2(1.0, 1.0)) / 2.0;
vec4 clipCenter = clipSpace(vec3(center, depth));
vec2 screenCenter = (clipCenter.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;
vec2 vertex = (normals.xy * size) + screenCenter;
gl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), clipCenter.zw);
}`,Ps=class extends nt{initShader(){const{animate:t={},usePoints:e=!1,opacity:n=()=>1}=this.props,{center:r,radius:i,color:s}=t,a={0:1,1:1,2:-1,3:1,4:-1,5:-1},o={0:-1,1:-1,2:-1,3:1,4:1,5:1},c=[{name:"normals",size:ct.TWO,update:u=>[a[u],o[u]]}],l=6;return{drawMode:e?d.GLSettings.Model.DrawMode.POINTS:d.GLSettings.Model.DrawMode.TRIANGLE_STRIP,fs:e?[{outputType:oe.COLOR,source:Jv},{outputType:oe.GLOW,source:`
              void main() {
                \${out: glow} = color;
              }
              `}]:[{outputType:oe.COLOR,source:Zv},{outputType:oe.GLOW,source:`
              void main() {
                \${out: glow} = color;
              }
              `}],instanceAttributes:[{easing:r,name:Ps.attributeNames.center,size:k.TWO,update:u=>u.center},{easing:i,name:Ps.attributeNames.radius,size:k.ONE,update:u=>[u.radius]},{name:Ps.attributeNames.depth,size:k.ONE,update:u=>[u.depth]},{easing:s,name:Ps.attributeNames.color,size:k.FOUR,update:u=>u.color}],uniforms:[{name:"layerOpacity",size:L.ONE,update:u=>[n()]}],vertexAttributes:e?void 0:c,vertexCount:e?0:l,vs:e?ey:ty}}getMaterialOptions(){return At.transparentShapeBlending}};let $l=Ps;$l.defaultProps={data:new Oe,key:""},$l.attributeNames={center:"center",color:"color",depth:"depth",radius:"radius"};var ny=Object.defineProperty,ry=Object.getOwnPropertyDescriptor,Ja=(t,e,n,r)=>{for(var i=r>1?void 0:r?ry(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(r?a(e,n,i):a(i))||i);return r&&i&&ny(e,n,i),i};const Pp=class extends dt{constructor(t){super(t),this.color=[1,1,1,1],this.depth=0,this.radius=0,this.center=[0,0],vt(this,Pp),this.color=t.color||this.color,this.radius=t.radius||this.radius,this.center=t.center||this.center,this.depth=t.depth||this.depth}get width(){return this.radius*2}get height(){return this.radius*2}};let Ds=Pp;Ja([B],Ds.prototype,"color",2),Ja([B],Ds.prototype,"depth",2),Ja([B],Ds.prototype,"radius",2),Ja([B],Ds.prototype,"center",2);var Fs=(t=>(t[t.NONE=0]="NONE",t[t.SCREEN_CURVE=1]="SCREEN_CURVE",t))(Fs||{}),Mn=(t=>(t[t.LINE=0]="LINE",t[t.BEZIER=1]="BEZIER",t[t.BEZIER2=2]="BEZIER2",t))(Mn||{}),Wl=(t=>(t[t.ALL=0]="ALL",t[t.PASS_Y=1]="PASS_Y",t[t.PASS_X=2]="PASS_X",t))(Wl||{});const iy=`precision highp float;
varying vec4 vertexColor;
\${interpolation}
void main() {
float normal = vertex.x;
float interpolationTime = vertex.y;
float interpolationIncrement = 1.0 / vertex.z;
vec2 currentPosition = interpolation(interpolationTime, start, end, control.xy, control.zw);
vec2 prePosition = interpolation(interpolationTime - interpolationIncrement, start, end, control.xy, control.zw);
vec2 nextPosition = interpolation(interpolationTime + interpolationIncrement, start, end, control.xy, control.zw);
vec2 preLine = prePosition - currentPosition;
vec2 nextLine = nextPosition - currentPosition;
vec2 currentNormal = mix(
normalize(vec2(preLine.y, -preLine.x)),
mix(
normalize(vec2(preLine.y, -preLine.x) + vec2(-nextLine.y, nextLine.x)),
normalize(vec2(-nextLine.y, nextLine.x)),
float(vertex.x >= 1.0)
),
float(vertex.x > 0.0)
);
float lineThickness = mix(thickness.x, thickness.y, interpolationTime) / 2.0;
vec2 vertexPos = currentPosition + currentNormal * (normal * lineThickness);
vertexColor = mix(startColor, endColor, interpolationTime);
gl_Position = clipSpace(vec3(vertexPos, depth));
gl_PointSize = 5.0;
}`,sy=`vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {
float t1 = 1.0 - t;
return pow(t1, 3.0) * p1 + 3.0 * t * pow(t1, 2.0) * c1 + 3.0 * pow(t, 2.0) * t1 * c2 + pow(t, 3.0) * p2;
}`,ay=`vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {
return (1.0 - t) * (1.0 - t) * p1 + 2.0 * t * (1.0 - t) * c1 + t * t * p2;
}`,oy=`precision highp float;
varying vec4 vertexColor;
void main() {
gl_FragColor = vertexColor;
}`,cy=`vec2 interpolation(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {
return p1 + (p2 - p1) * t;
}`,ly=`precision highp float;
varying vec4 vertexColor;
\${interpolation}
void main() {
float normal = vertex.x;
float interpolationTime = vertex.y;
float interpolationIncrement = 1.0 / vertex.z;
vec4 startClip = clipSpace(vec3(start, depth));
vec4 endClip = clipSpace(vec3(end, depth));
vec2 startScreen = (startClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;
vec2 endScreen = (endClip.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;
vec2 control1 = startScreen + vec2(control.x, -control.y) * scaleFactor;
vec2 control2 = endScreen + vec2(control.z, -control.w) * scaleFactor;
vec2 currentPosition = interpolation(interpolationTime, startScreen, endScreen, control1, control2);
vec2 prePosition = interpolation(interpolationTime - interpolationIncrement, startScreen, endScreen, control1, control2);
vec2 nextPosition = interpolation(interpolationTime + interpolationIncrement, startScreen, endScreen, control1, control2);
vec2 preLine = prePosition - currentPosition;
vec2 nextLine = nextPosition - currentPosition;
vec2 currentNormal = mix(
normalize(vec2(preLine.y, -preLine.x)),
mix(
normalize(vec2(preLine.y, -preLine.x) + vec2(-nextLine.y, nextLine.x)),
normalize(vec2(-nextLine.y, nextLine.x)),
float(vertex.x >= 1.0)
),
float(vertex.x > 0.0)
);
float lineThickness = mix(thickness.x, thickness.y, interpolationTime) / 2.0;
vec2 vertexPos = currentPosition + currentNormal * (-normal * lineThickness * scaleFactor);
vertexColor = mix(startColor, endColor, interpolationTime);
gl_Position = vec4((vertexPos / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), startClip.zw);
gl_PointSize = 5.0;
}`;function uy(t){return[t[0][0],t[0][1],t[1][0],t[1][1]]}const hy={[Mn.LINE]:cy,[Mn.BEZIER]:ay,[Mn.BEZIER2]:sy},In=class extends nt{initShader(){const{animate:t={},scaleFactor:e=()=>1,type:n,scaleType:r=Fs.NONE,smoothness:i=50}=this.props,{end:s,start:a,startColor:o,endColor:c,control:l,thickness:u}=t,h=n===Mn.LINE?2:i,f={0:1,[h*2+2]:-1},p={0:0,[h*2+2]:1};let m=1;for(let T=0;T<h*2;++T)f[T+1]=m,p[T+1]=Math.floor(T/2)/(h-1),m*=-1;const v={interpolation:hy[n]},b=wr({options:v,required:{name:"Edge Layer",values:["interpolation"]},shader:r===Fs.NONE?iy:ly,onToken:(T,E)=>T in v?E:`\${${T}}`});return{fs:oy,instanceAttributes:[{easing:o,name:In.attributeNames.startColor,size:k.FOUR,update:T=>T.startColor},{easing:c,name:In.attributeNames.endColor,size:k.FOUR,update:T=>T.endColor},{easing:a,name:In.attributeNames.start,size:k.TWO,update:T=>T.start},{easing:s,name:In.attributeNames.end,size:k.TWO,update:T=>T.end},{easing:u,name:In.attributeNames.thickness,size:k.TWO,update:T=>T.thickness},{name:In.attributeNames.depth,size:k.ONE,update:T=>[T.depth]},n===Mn.LINE?{easing:l,name:In.attributeNames.control,size:k.FOUR,update:T=>[0,0,0,0]}:null,n===Mn.BEZIER?{easing:l,name:In.attributeNames.control,size:k.FOUR,update:T=>[T.control[0][0],T.control[0][1],0,0]}:null,n===Mn.BEZIER2?{easing:l,name:In.attributeNames.control,size:k.FOUR,update:T=>uy(T.control)}:null],uniforms:[{name:"scaleFactor",size:L.ONE,update:T=>[e()]},{name:"layerOpacity",size:L.ONE,update:T=>[this.props.opacity===void 0?1:this.props.opacity]}],vertexAttributes:[{name:"vertex",size:ct.THREE,update:T=>[f[T],p[T],h*2]}],vertexCount:h*2+2,vs:b.shader}}getMaterialOptions(){return At.transparentShapeBlending}};let jl=In;jl.defaultProps={broadphase:Wl.ALL,data:new Oe,key:"none",scaleType:Fs.NONE,type:Mn.LINE},jl.attributeNames={control:"control",depth:"depth",end:"end",endColor:"endColor",start:"start",startColor:"startColor",thickness:"thickness"};var dy=Object.defineProperty,fy=Object.getOwnPropertyDescriptor,ii=(t,e,n,r)=>{for(var i=r>1?void 0:r?fy(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(r?a(e,n,i):a(i))||i);return r&&i&&dy(e,n,i),i};const Dp=class extends dt{constructor(t){super(t),this.control=[[0,0],[0,0]],this.depth=0,this.end=[0,0],this.endColor=[1,1,1,1],this.start=[0,0],this.startColor=[1,1,1,1],this.thickness=[1,1],vt(this,Dp),this.startColor=t.startColor||this.startColor,this.endColor=t.endColor||this.endColor,this.control=t.control||this.control,this.depth=t.depth||this.depth,this.end=t.end||this.end,this.thickness=t.thickness||this.thickness,this.start=t.start||this.start}get length(){const t=[this.end[0]-this.start[0],this.end[1]-this.start[1]];return Math.sqrt(t[0]*t[0]+t[1]*t[1])}get midpoint(){return 0}get perpendicular(){const t=this.length;return[(this.end[1]-this.start[1])/t,-(this.end[0]-this.start[0])/t]}setEdgeThickness(t){this.thickness=[t,t]}setColor(t){this.startColor=Kt(t),this.endColor=Kt(t)}};let Ar=Dp;ii([B],Ar.prototype,"control",2),ii([B],Ar.prototype,"depth",2),ii([B],Ar.prototype,"end",2),ii([B],Ar.prototype,"endColor",2),ii([B],Ar.prototype,"start",2),ii([B],Ar.prototype,"startColor",2),ii([B],Ar.prototype,"thickness",2);const ze=Ye("video");function py(t){ze.enabled&&(t.addEventListener("abort",()=>ze("abort")),t.addEventListener("canplay",()=>ze("canplay")),t.addEventListener("canplaythrough",()=>ze("canplaythrough")),t.addEventListener("durationchange",()=>ze("durationchange")),t.addEventListener("emptied",()=>ze("emptied")),t.addEventListener("ended",()=>ze("ended")),t.addEventListener("error",()=>ze("error")),t.addEventListener("loadeddata",()=>ze("loadeddata")),t.addEventListener("loadedmetadata",()=>ze("loadedmetadata")),t.addEventListener("loadstart",()=>ze("loadstart")),t.addEventListener("pause",()=>ze("pause")),t.addEventListener("play",()=>ze("play")),t.addEventListener("playing",()=>ze("playing")),t.addEventListener("progress",()=>ze("progress")),t.addEventListener("ratechange",()=>ze("ratechange")),t.addEventListener("seeked",()=>ze("seeked")),t.addEventListener("seeking",()=>ze("seeking")),t.addEventListener("stalled",()=>ze("stalled")),t.addEventListener("suspend",()=>ze("suspend")),t.addEventListener("timeupdate",()=>ze("timeupdate")),t.addEventListener("volumechange",()=>ze("volumechange")),t.addEventListener("waiting",()=>ze("waiting")))}const gy=`precision highp float;
varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
gl_FragColor = texture2D(imageAtlas, texCoord) * vertexColor;
gl_FragColor = gl_FragColor * gl_FragColor.a;
}`,my=`precision highp float;
varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
float normal = normals.x;
float side = normals.y;
vec2 vertex = vec2(side, float(normal == 1.0f)) * size - anchor;
float crotation = cos(rotation);
float srotation = sin(rotation);
vertex = vec2(crotation * vertex.x - srotation * vertex.y, srotation * vertex.x + crotation * vertex.y);
vertex += location;
gl_Position = clipSpace(vec3(vertex, depth));
texCoord = texture.xy + ((texture.zw - texture.xy) * vec2(side, float(normal == -1.0f)));
vertexColor = tint;
}`,vy=`precision highp float;
varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec3 screenSize = cameraSpaceSize(vec3(size, 1.0));
bool largerOnScreen = screenSize.y > size.y;
float useScaleMode = float(
(
scaling == 3.0 ||
(largerOnScreen && scaling == 2.0)
) &&
scaling != 1.0
);
float unequalZooms = float(cameraScale2D.x != cameraScale2D.y);
float normal = normals.x;
float side = normals.y;
vec2 worldAnchor = location + anchor;
texCoord = texture.xy + ((texture.zw - texture.xy) * vec2(side, float(normal == -1.0)));
vertexColor = tint;
vec2 adjustedSize = mix(
size,
(size * cameraScale2D.yx),
unequalZooms
);
vec2 adjustedAnchor = mix(
anchor,
(anchor * cameraScale2D.yx),
unequalZooms
);
vec2 vertex = vec2(side, float(normal == 1.0)) * adjustedSize + location - adjustedAnchor;
float imageScreenScale = mix(
screenSize.y / adjustedSize.y,
screenSize.x / adjustedSize.x,
float((cameraScale2D.x < 1.0) || (cameraScale2D.x > 1.0))
);
vec2 anchorToVertex = vertex - location;
vertex = mix(
vertex,
(anchorToVertex / imageScreenScale) + location,
useScaleMode
);
gl_Position = clipSpace(vec3(vertex, depth));
}`,tr=class extends nt{constructor(t,e,n){super(t,e,n)}initShader(){const t=this.props.animate||{},{tint:e,location:n,size:r,rotation:i}=t,s={0:1,1:1,2:-1,3:1,4:-1,5:-1},a={0:0,1:0,2:0,3:1,4:1,5:1};return{fs:gy,instanceAttributes:[this.props.enableRotation?{easing:i,name:tr.attributeNames.rotation,size:k.ONE,update:o=>[o.rotation]}:null,{easing:n,name:tr.attributeNames.location,size:k.TWO,update:o=>o.origin},{name:tr.attributeNames.anchor,size:k.TWO,update:o=>[o.anchor.x||0,o.anchor.y||0]},{easing:r,name:tr.attributeNames.size,size:k.TWO,update:o=>[o.width,o.height]},{name:tr.attributeNames.depth,size:k.ONE,update:o=>[o.depth]},{name:tr.attributeNames.scaling,size:k.ONE,update:o=>[o.scaling]},{name:tr.attributeNames.texture,resource:{key:()=>this.props.atlas||"",name:"imageAtlas"},update:o=>(o.source,o.request?this.resource.request(this,o,o.request):(console.warn("An image utilizing the image-render-layer does not have its request specified yet.","The image-render-layer does NOT manage requests and should be handled before this layer deals with the instance"),[0,0,0,0]))},{easing:e,name:tr.attributeNames.tint,size:k.FOUR,update:o=>o.tint}],uniforms:[{name:"scaleFactor",size:L.ONE,update:o=>[1]}],vertexAttributes:[{name:"normals",size:ct.TWO,update:o=>[s[o],a[o]]}],vertexCount:6,vs:this.props.enableRotation?my:vy}}getMaterialOptions(){return At.transparentImageBlending}};let Hl=tr;Hl.defaultProps={key:"",data:new Oe},Hl.attributeNames={location:"location",anchor:"anchor",size:"size",depth:"depth",scaling:"scaling",texture:"texture",tint:"tint",rotation:"rotation"};function Bs(t){return t&&t.videoSrc}const eo=new Image;eo.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";class Fp extends nt{constructor(){super(...arguments),this.childProvider=new Oe,this.imageToResource=new Map,this.sourceToRequest=new Map,this.sourceToVideo=new Map,this.usingVideo=new Map,this.waitingForVideo=new Map,this.waitForVideoSource=new Map,this.originalOnReadyCallbacks=new Map}childLayers(){return[Kr(Hl,{...this.props,key:`${this.props.key}.image-render-layer`})]}destroy(){super.destroy(),this.sourceToVideo.forEach(e=>{e.pause(),this.sourceToVideo.clear(),this.waitingForVideo.clear(),this.waitForVideoSource.clear()})}draw(){const e=this.resolveChanges(!0);if(this.updateAnimationState(),e.length<=0)return;this.propertyIds||(this.propertyIds=this.getInstanceObservableIds(e[0][0],["source"]));const{source:n}=this.propertyIds;for(let i=0,s=e.length;i<s;++i){const[a,o,c]=e[i];switch(o){case Je.CHANGE:if(c[n]!==void 0){const l=this.imageToResource.get(a);let u=this.getAtlasSource(a);if(u===l)break;if(l instanceof HTMLVideoElement){const h=this.waitForVideoSource.get(a);if(h){this.waitForVideoSource.delete(a);const p=this.waitingForVideo.get(h);p&&p.delete(a)}let f=this.usingVideo.get(l.getAttribute("data-source")||"");f||(f=new Set),f.delete(a),f.size<=0&&this.sourceToVideo.delete(l.getAttribute("data-source")||""),a.onReady=this.originalOnReadyCallbacks.get(a)}if(Bs(a.source)&&(this.prepareVideo(a,a.source),u=this.getAtlasSource(a),yr(this.usingVideo,a.source.videoSrc,new Set).add(a)),this.imageToResource.set(a,u),this.resource.request(this,a,Ci({key:this.props.atlas||"",disposeResource:!0,source:l})),u){let h=this.sourceToRequest.get(u);(!h||h.texture&&!h.texture.isValid)&&(h=Ci({key:this.props.atlas||"",source:u,rasterizationScale:this.props.rasterizationScale}),this.sourceToRequest.set(u,h)),a.request=h,this.resource.request(this,a,h)}}break;case Je.INSERT:if(a.source){let l=this.getAtlasSource(a);Bs(a.source)&&(this.prepareVideo(a,a.source),l=this.getAtlasSource(a),yr(this.usingVideo,a.source.videoSrc,new Set).add(a));let u=this.sourceToRequest.get(l);(!u||u.texture&&!u.texture.isValid)&&(u=Ci({key:this.props.atlas||"",source:l,rasterizationScale:this.props.rasterizationScale}),this.sourceToRequest.set(l,u)),a.request=u}break;case Je.REMOVE:{const l=this.getAtlasSource(a);if(this.imageToResource.delete(a),Bs(a.source)){const u=this.waitForVideoSource.get(a);if(u){this.waitForVideoSource.delete(a);const f=this.waitingForVideo.get(u);f&&f.delete(a)}let h=this.usingVideo.get(a.source.videoSrc);h||(h=new Set),h.delete(a),h.size<=0&&this.sourceToVideo.delete(a.source.videoSrc),this.originalOnReadyCallbacks.delete(a)}this.resource.request(this,a,Ci({key:this.props.atlas||"",disposeResource:!0,source:l}));break}}}const r=[];this.usingVideo.forEach((i,s)=>{i.size<=0&&r.push(s)});for(let i=0,s=r.length;i<s;++i){const a=r[i];this.usingVideo.delete(a),this.sourceToVideo.delete(a)}}getAtlasSource(e){return Bs(e.source)?this.sourceToVideo.get(e.source.videoSrc)||eo:e.source}prepareVideo(e,n){const r=this.sourceToVideo.get(n.videoSrc);if(this.originalOnReadyCallbacks.get(e)||this.originalOnReadyCallbacks.set(e,e.onReady),r){const p=this.waitingForVideo.get(n.videoSrc);if(p)p.add(e),this.waitForVideoSource.set(e,n.videoSrc),e.onReady=void 0,e.source=eo,e.videoLoad=()=>{r.load(),n.autoPlay&&r.play()};else{const m=this.originalOnReadyCallbacks.get(e)||e.onReady;if(!m)return;e.onReady=v=>{m(v,r)}}return}const s=document.createElement("video");this.sourceToVideo.set(n.videoSrc,s),s.setAttribute("data-source",n.videoSrc),py(s);const a=new ht,o=new ht,c=()=>{s.removeEventListener("loadedmetadata",u),s.removeEventListener("loadeddata",l),s.removeEventListener("error",h),this.waitingForVideo.delete(n.videoSrc),this.waitForVideoSource.delete(e)},l=()=>{o.resolve()},u=()=>{a.resolve()},h=p=>{let m;p.path&&p.path[0]&&(m=p.path[0].error),p.originalTarget&&(m=p.originalTarget.error),console.warn("There was an error loading the video resource to the atlas texture context"),console.warn(m),a.reject({}),o.reject({})};s.addEventListener("loadedmetadata",u),s.addEventListener("loadeddata",l),s.addEventListener("error",h),e.onReady=void 0,yr(this.waitingForVideo,n.videoSrc,new Set).add(e),this.waitForVideoSource.set(e,n.videoSrc),e.source=eo,e.videoLoad=()=>{s.load(),n.autoPlay&&s.play()},s.muted=!0,s.src=n.videoSrc,Promise.all([a.promise,o.promise]).then(()=>{s.currentTime=0,n.autoPlay&&s.play();const p=this.waitingForVideo.get(n.videoSrc);p&&p.forEach(m=>{m.source=n,m.onReady=this.originalOnReadyCallbacks.get(m)}),c()}).catch(()=>{c()})}updateAnimationState(){let e=!1;this.sourceToVideo.forEach(n=>{n.paused||(e=!0)}),this.alwaysDraw=this.usingVideo.size>0&&e}initShader(){return null}}Fp.defaultProps={atlas:"default",key:"",data:new Oe};var yy=Object.defineProperty,wy=Object.getOwnPropertyDescriptor,nr=(t,e,n,r)=>{for(var i=r>1?void 0:r?wy(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(r?a(e,n,i):a(i))||i);return r&&i&&yy(e,n,i),i};const{max:Ty}=Math,by={[$.TopLeft]:(t,e)=>{t.x=-t.padding,t.y=-t.padding},[$.TopMiddle]:(t,e)=>{t.x=e.width/2,t.y=-t.padding},[$.TopRight]:(t,e)=>{t.x=e.width+t.padding,t.y=-t.padding},[$.MiddleLeft]:(t,e)=>{t.x=-t.padding,t.y=e.height/2},[$.Middle]:(t,e)=>{t.x=e.width/2,t.y=e.height/2},[$.MiddleRight]:(t,e)=>{t.x=e.width+t.padding,t.y=e.height/2},[$.BottomLeft]:(t,e)=>{t.x=-t.padding,t.y=e.height+t.padding},[$.BottomMiddle]:(t,e)=>{t.x=e.width/2,t.y=e.height+t.padding},[$.BottomRight]:(t,e)=>{t.x=e.width+t.padding,t.y=e.height+t.padding},[$.Custom]:(t,e)=>{t.x=t.x||0,t.y=t.y||0}},Bp=class extends dt{constructor(t){super(t),this.tint=[0,0,0,1],this.depth=0,this.height=1,this.origin=[0,0],this.scaling=xn.BOUND_MAX,this.width=1,this.rotation=0,this.sourceWidth=0,this.sourceHeight=0,this._anchor={padding:0,type:$.TopLeft,x:0,y:0},this.videoLoad=fa,vt(this,Bp),this.depth=t.depth||this.depth,this.tint=t.tint||this.tint,this.scaling=t.scaling||this.scaling,this.origin=t.origin||this.origin,this.width=t.width||1,this.height=t.height||1,this.source=t.source,this.rotation=t.rotation||0,this.onReady=t.onReady,t.anchor&&this.setAnchor(t.anchor)}get maxSize(){return Ty(this.width,this.height)}set maxSize(t){const e=this.width/this.height;this.width=t*e,this.height=t}get anchor(){return this._anchor}resourceTrigger(){this.source=this.source,this.request&&this.request.texture&&(this.sourceWidth=this.request.texture.pixelWidth,this.sourceHeight=this.request.texture.pixelHeight),this.onReady&&this.onReady(this)}setAnchor(t){const e={padding:t.padding||0,type:t.type,x:t.x||0,y:t.y||0};by[e.type](e,this),this._anchor=e}};let Cn=Bp;nr([B],Cn.prototype,"tint",2),nr([B],Cn.prototype,"depth",2),nr([B],Cn.prototype,"height",2),nr([B],Cn.prototype,"origin",2),nr([B],Cn.prototype,"scaling",2),nr([B],Cn.prototype,"source",2),nr([B],Cn.prototype,"width",2),nr([B],Cn.prototype,"rotation",2),nr([B],Cn.prototype,"_anchor",2);var Ey=Object.defineProperty,_y=Object.getOwnPropertyDescriptor,rr=(t,e,n,r)=>{for(var i=r>1?void 0:r?_y(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(r?a(e,n,i):a(i))||i);return r&&i&&Ey(e,n,i),i};const Ql=class extends dt{constructor(t){super(t),this.anchor=[0,0],this.character="a",this.color=[1,1,1,1],this.depth=0,this.fontScale=1,this.maxScale=1,this.offset=[0,0],this.origin=[0,0],this.padding=[0,0],vt(this,Ql),this.origin=t.origin||this.origin,this.offset=t.offset||this.offset,this.character=t.character||this.character,this.color=t.color||this.color,this.maxScale=t.maxScale||this.maxScale,this.padding=t.padding||this.padding,this.anchor=t.anchor||this.anchor,this.onReady=t.onReady}clone(){const t=new Ql(this);t.onReady=this.onReady,t.request=this.request}resourceTrigger(){this.offset=this.offset,this.origin=this.origin,this.character=this.character,this.color=this.color,this.onReady&&this.onReady(this)}};let Vt=Ql;rr([B],Vt.prototype,"anchor",2),rr([B],Vt.prototype,"character",2),rr([B],Vt.prototype,"color",2),rr([B],Vt.prototype,"depth",2),rr([B],Vt.prototype,"fontScale",2),rr([B],Vt.prototype,"maxScale",2),rr([B],Vt.prototype,"offset",2),rr([B],Vt.prototype,"origin",2),rr([B],Vt.prototype,"padding",2);const Up=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec4 texColor = texture2D(fontMap, texCoord);
if (texColor.r <= 0.0) discard;
texColor.a = texColor.r;
gl_FragColor = texColor * vertexColor;
}`,kp=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec2 pushOut = normals * glyphSize * fontScale;
vec3 position = vec3(origin + padding - anchor + offset + pushOut, depth);
gl_Position = clipSpace(position);
texCoord = texture.xy + (texture.zw - texture.xy) * normals;
vertexColor = color * color.a;
}`,Ry=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec4 texColor = texture2D(fontMap, texCoord);
if (texColor.r <= 0.0) discard;
texColor.a = texColor.r;
gl_FragColor = texColor * vertexColor;
}`,Ay=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec2 scale = fontScale * cameraScale2D.xy;
float scaleBy = max(scale.x, scale.y) / maxScale;
vec2 pushOut = normals * glyphSize * fontScale;
float vx = mix(
(-anchor.x + offset.x + pushOut.x),
(-anchor.x + offset.x + pushOut.x) / scaleBy,
float(scale.x >= maxScale)
);
float vy = mix(
(-anchor.y + offset.y + pushOut.y),
(-anchor.y + offset.y + pushOut.y) / scaleBy,
float(scale.y >= maxScale)
);
vec3 position = vec3(origin + padding + vec2(vx, vy), depth);
gl_Position = clipSpace(position);
texCoord = texture.xy + (texture.zw - texture.xy) * normals;
vertexColor = color * color.a;
}`,Sy=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec4 texColor = texture2D(fontMap, texCoord);
if (texColor.r <= 0.0) discard;
texColor.a = texColor.r;
gl_FragColor = texColor * vertexColor;
}`,xy=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec2 pushOut = normals * glyphSize * fontScale;
vec3 position = vec3(origin + padding + (-anchor + offset + pushOut) / cameraScale2D.xy, depth);
gl_Position = clipSpace(position);
texCoord = texture.xy + (texture.zw - texture.xy) * normals;
vertexColor = color * color.a;
}`,My=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec4 texColor = texture2D(fontMap, texCoord);
if (texColor.r <= 0.0) discard;
texColor.a = texColor.r;
gl_FragColor = texColor * vertexColor;
}`,Iy=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec2 pushOut = normals * glyphSize * fontScale;
vec3 position = vec3(origin + padding + offset + pushOut, depth);
gl_Position = clipSpace(position);
texCoord = texture.xy + (texture.zw - texture.xy) * normals;
vertexColor = color * color.a;
}`,Cy=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec4 texColor = texture2D(fontMap, texCoord);
if (texColor.r <= 0.0) discard;
texColor.a = texColor.r;
gl_FragColor = texColor * vertexColor;
}`,Ly=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec2 scale = fontScale * cameraScale2D.xy;
float scaleBy = max(scale.x, scale.y) / maxScale;
vec2 pushOut = normals * glyphSize * fontScale;
float vx = mix(
(origin.x + padding.x + offset.x + pushOut.x),
origin.x + anchor.x + (padding.x - anchor.x + offset.x + pushOut.x) / scaleBy,
float(scale.x >= maxScale)
);
float vy = mix(
(origin.y + padding.y + offset.y + pushOut.y),
origin.y + anchor.y + (padding.y - anchor.y + offset.y + pushOut.y) / scaleBy,
float(scale.y >= maxScale)
);
vec3 position = vec3(vec2(vx, vy), depth);
gl_Position = clipSpace(position);
texCoord = texture.xy + (texture.zw - texture.xy) * normals;
vertexColor = color * color.a;
}`,Oy=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec4 texColor = texture2D(fontMap, texCoord);
if (texColor.r <= 0.0) discard;
texColor.a = texColor.r;
gl_FragColor = texColor * vertexColor;
}`,Ny=`varying vec4 vertexColor;
varying vec2 texCoord;
void main() {
vec2 pushOut = normals * glyphSize * fontScale;
vec3 position = vec3(origin + anchor + (padding - anchor + offset + pushOut) / cameraScale2D.xy , depth);
gl_Position = clipSpace(position);
texCoord = texture.xy + (texture.zw - texture.xy) * normals;
vertexColor = color * color.a;
}`,Di=class extends nt{constructor(){super(...arguments),this.glyphRequests={}}initShader(){const t=this.props.animate||{},{anchor:e,color:n,offset:r,origin:i}=t,s={0:[0,0],1:[0,0],2:[1,0],3:[0,1],4:[1,1],5:[1,1]},a={name:"texture",resource:{key:()=>this.props.resourceKey||"",name:"fontMap"},update:h=>{const f=h.character;return(!h.request||h.character!==h.request.character)&&(this.glyphRequests[h.character]?h.request=this.glyphRequests[h.character]:(h.request=ti({key:this.props.resourceKey||"",character:f}),this.glyphRequests[h.character]=h.request),h.request.fontMap&&h.onReady&&h.onReady(h)),h.request.fetch=ei.TEXCOORDS,this.resource.request(this,h,h.request)}},o={name:"glyphSize",parentAttribute:a,resource:{key:()=>this.props.resourceKey||"",name:"fontMap"},size:k.TWO,update:h=>{const f=h.character;return(!h.request||h.character!==h.request.character)&&(this.glyphRequests[h.character]?h.request=this.glyphRequests[h.character]:(h.request=ti({key:this.props.resourceKey||"",character:f}),this.glyphRequests[h.character]=h.request),h.request.fontMap&&h.onReady&&h.onReady(h)),h.request.fetch=ei.IMAGE_SIZE,this.resource.request(this,h,h.request)}};a.childAttributes=[o];let c,l;switch(this.props.scaleMode||xn.ALWAYS){case xn.BOUND_MAX:{c=this.props.inTextArea?Cy:Ry,l=this.props.inTextArea?Ly:Ay;break}case xn.NEVER:{c=this.props.inTextArea?Sy:Oy,l=this.props.inTextArea?Ny:xy;break}case xn.ALWAYS:{c=this.props.inTextArea?My:Up,l=this.props.inTextArea?Iy:kp;break}default:{c=Up,l=kp;break}}return{fs:c,instanceAttributes:[{easing:n,name:Di.attributeNames.color,size:k.FOUR,update:h=>h.color},{name:Di.attributeNames.depth,size:k.ONE,update:h=>[h.depth]},{name:"fontScale",size:k.ONE,update:h=>[h.fontScale]},{easing:e,name:Di.attributeNames.anchor,size:k.TWO,update:h=>h.anchor},{easing:i,name:Di.attributeNames.origin,size:k.TWO,update:h=>h.origin},{easing:r,name:Di.attributeNames.offset,size:k.TWO,update:h=>h.offset},{name:"padding",size:k.TWO,update:h=>h.padding},{name:"maxScale",size:k.ONE,update:h=>[h.maxScale]},o,a],uniforms:[],vertexAttributes:[{name:"normals",size:ct.TWO,update:h=>s[h]}],vertexCount:6,vs:l}}draw(){super.draw()}getMaterialOptions(){return Object.assign({},At.transparentImageBlending,{depthTest:!1})}willUpdateProps(t){t.resourceKey!==this.props.resourceKey&&(Object.values(this.glyphRequests).forEach(e=>{delete e.fontMap,e.key=t.resourceKey||""}),this.rebuildLayer())}};let to=Di;to.defaultProps={key:"",data:new Oe,resourceKey:"No resource specified"},to.attributeNames={color:"color",depth:"depth",anchor:"anchor",origin:"origin",offset:"offset"};const Py="...",Gp={[$.TopLeft]:(t,e)=>{t.x=0,t.y=0},[$.TopMiddle]:(t,e)=>{t.x=e.size[0]/2,t.y=0},[$.TopRight]:(t,e)=>{t.x=e.size[0],t.y=0},[$.MiddleLeft]:(t,e)=>{t.x=0,t.y=e.size[1]/2},[$.Middle]:(t,e)=>{t.x=e.size[0]/2,t.y=e.size[1]/2},[$.MiddleRight]:(t,e)=>{t.x=e.size[0],t.y=e.size[1]/2},[$.BottomLeft]:(t,e)=>{t.x=0,t.y=e.size[1]},[$.BottomMiddle]:(t,e)=>{t.x=e.size[0]/2,t.y=e.size[1]},[$.BottomRight]:(t,e)=>{t.x=e.size[0],t.y=e.size[1]},[$.Custom]:(t,e)=>{t.x=t.x||0,t.y=t.y||0}},Sr=[[-1,-1],[0,-1],[1,-1],[-1,0],[0,0],[1,0],[-1,1],[0,1],[1,1]].map(t=>{const e=Math.sqrt(mi(t,t));return Xe(t,1/-e)}),zp={[$.TopLeft]:t=>{t.paddingDirection=Xe(Sr[0],t.padding)},[$.TopMiddle]:t=>{t.paddingDirection=Xe(Sr[1],t.padding)},[$.TopRight]:t=>{t.paddingDirection=Xe(Sr[2],t.padding)},[$.MiddleLeft]:t=>{t.paddingDirection=Xe(Sr[3],t.padding)},[$.Middle]:t=>{t.paddingDirection=[0,0]},[$.MiddleRight]:t=>{t.paddingDirection=Xe(Sr[5],t.padding)},[$.BottomLeft]:t=>{t.paddingDirection=Xe(Sr[6],t.padding)},[$.BottomMiddle]:t=>{t.paddingDirection=Xe(Sr[7],t.padding)},[$.BottomRight]:t=>{t.paddingDirection=Xe(Sr[8],t.padding)},[$.Custom]:t=>{t.paddingDirection=t.paddingDirection}};function ft(t){if(t)return e=>{t({...e,instances:e.instances.map(n=>n.parentLabel).filter(Ue)})}}class Xl extends nt{constructor(){super(...arguments),this.fullUpdate=!1,this.glyphProvider=new Oe,this.labelToGlyphs=new Map,this.labelToKerningRequest=new Map,this.labelWaitingOnGlyph=new Map,this.truncationWidth=-1,this.handleGlyphReady=e=>{if(!e.parentLabel){delete e.onReady;return}const n=e.parentLabel,r=this.labelWaitingOnGlyph.get(e.parentLabel);if(r&&r.has(e)&&(r.delete(e),r.size<=0)){const i=n.onReady;i&&i(n)}}}childLayers(){return[Kr(this.props.customGlyphLayer||to,{animate:this.props.animate,data:this.glyphProvider,key:`${this.id}.glyphs`,resourceKey:this.props.resourceKey,scaleMode:this.props.scaleMode||xn.BOUND_MAX,inTextArea:this.props.inTextArea,picking:this.props.picking,onMouseClick:ft(this.props.onMouseClick),onMouseUp:ft(this.props.onMouseUp),onMouseDown:ft(this.props.onMouseDown),onMouseOut:ft(this.props.onMouseOut),onMouseOver:ft(this.props.onMouseOver),onMouseMove:ft(this.props.onMouseMove),onMouseUpOutside:ft(this.props.onMouseUpOutside),onTap:ft(this.props.onTap),onTouchDown:ft(this.props.onTouchDown),onTouchUp:ft(this.props.onTouchUp),onTouchUpOutside:ft(this.props.onTouchUpOutside),onTouchMove:ft(this.props.onTouchMove),onTouchOut:ft(this.props.onTouchOut),onTouchOver:ft(this.props.onTouchOver),onTouchAllEnd:ft(this.props.onTouchAllEnd),onTouchAllOut:ft(this.props.onTouchAllOut)})]}draw(){const e=this.resolveChanges();if(e.length<=0)return;if(!this.propertyIds){const h=e[0][0];this.propertyIds=this.getInstanceObservableIds(h,["text","active","anchor","color","origin","fontSize","maxWidth","maxScale","letterSpacing"])}const{text:n,active:r,anchor:i,color:s,origin:a,fontSize:o,maxWidth:c,maxScale:l,letterSpacing:u}=this.propertyIds;for(let h=0,f=e.length;h<f;++h){const[p,m,v]=e[h];switch(m){case Je.CHANGE:if(!this.labelToGlyphs.get(p)){this.insert(p);continue}v[n]!==void 0?(this.invalidateRequest(p),this.layoutGlyphs(p)):v[r]!==void 0&&(p.active?(this.layoutGlyphs(p),this.showGlyphs(p)):this.hideGlyphs(p)),v[i]&&this.updateAnchor(p),v[s]!==void 0&&this.updateGlyphColors(p),v[a]!==void 0&&this.updateGlyphOrigins(p),v[l]!==void 0&&this.updateGlyphMaxScales(p),v[o]!==void 0&&(this.invalidateRequest(p),this.layoutGlyphs(p)),v[c]!==void 0&&(this.invalidateRequest(p),this.layoutGlyphs(p)),v[u]!==void 0&&(this.invalidateRequest(p),this.layoutGlyphs(p));break;case Je.INSERT:this.insert(p);break;case Je.REMOVE:{const b=this.labelToGlyphs.get(p);if(b){for(let T=0,E=b.length;T<E;++T)this.glyphProvider.remove(b[T]);this.labelToGlyphs.delete(p),this.labelToKerningRequest.delete(p),this.labelWaitingOnGlyph.delete(p)}break}}}}insert(e){e.preload?this.props.data.remove(e):this.labelToGlyphs.get(e)||this.labelToGlyphs.set(e,[]),this.layoutGlyphs(e)}hideGlyphs(e){const n=this.labelToGlyphs.get(e);if(n)for(let r=0,i=n.length;r<i;++r)this.glyphProvider.remove(n[r])}initShader(){return null}invalidateRequest(e){this.labelToKerningRequest.delete(e)}layoutGlyphs(e){if(!this.updateKerning(e)||!e.active)return;const n=this.labelToKerningRequest.get(e);if(!n||!n.fontMap)return;const r=n.metrics;if(!r||!r.layout)return;const i=r.layout;this.updateGlyphs(e,i);const s=e.glyphs;e.size=i.size,Gp[e.anchor.type](e.anchor,e),zp[e.anchor.type](e.anchor);const a=e.anchor,o=e.anchor.paddingDirection;for(let c=0,l=Math.min(i.positions.length,s.length);c<l;++c){const u=i.positions[c],h=s[c];h.offset=u,h.fontScale=i.fontScale,h.anchor=[a.x||0,a.y||0],h.origin=Ys(e.origin),h.padding=o||[0,0],h.maxScale=e.maxScale}}managesInstance(e){return!!this.labelToGlyphs.get(e)}showGlyphs(e){const n=this.labelToGlyphs.get(e);if(n)for(let r=0,i=n.length;r<i;++r)this.glyphProvider.add(n[r])}updateAnchor(e){const n=e.glyphs;if(!n)return;Gp[e.anchor.type](e.anchor,e),zp[e.anchor.type](e.anchor);const r=e.anchor,i=e.anchor.paddingDirection;for(let s=0,a=n.length;s<a;++s)n[s].anchor=[r.x||0,r.y||0],n[s].padding=i||[0,0]}updateGlyphs(e,n){let r=this.labelToGlyphs.get(e);r||(r=[],this.labelToGlyphs.set(e,r));let i=this.labelWaitingOnGlyph.get(e);i||(i=new Set,this.labelWaitingOnGlyph.set(e,i));for(let s=0,a=Math.min(r.length,n.glyphs.length);s<a;++s){const o=r[s];o.character!==n.glyphs[s]&&(o.character=n.glyphs[s],(!o.request||!o.request.fontMap||!o.request.fontMap.glyphMap[o.character])&&i.add(o))}if(r.length<n.glyphs.length){let s=0;for(let a=r.length,o=n.glyphs.length;a<o;++a,++s){const c=n.glyphs[a],l=new Vt({character:c,color:e.color,origin:e.origin,maxScale:e.maxScale,onReady:this.handleGlyphReady});l.parentLabel=e,r.push(l),e.active&&this.glyphProvider.add(l),i.add(l)}}else if(r.length>n.glyphs.length){for(let s=n.glyphs.length,a=r.length;s<a;++s){const o=r[s];this.glyphProvider.remove(o)}for(;r.length>n.glyphs.length;)r.pop()}e.glyphs=r}updateGlyphColors(e){const n=e.glyphs;if(n)for(let r=0,i=n.length;r<i;++r)n[r].color=Kt(e.color)}updateGlyphOrigins(e){const n=e.glyphs;if(!n)return;const r=e.origin;for(let i=0,s=n.length;i<s;++i)n[i].origin=[r[0],r[1]]}updateGlyphMaxScales(e){const n=e.glyphs;if(!n)return;const r=e.maxScale;for(let i=0,s=n.length;i<s;++i)n[i].maxScale=r}updateKerning(e){let n=this.labelToKerningRequest.get(e);const r=e.text;if(n){if(n.kerningPairs&&n.kerningPairs.indexOf(r)>-1)return!!n.fontMap;if(n.fontMap&&!n.fontMap.supportsKerning(r.replace(/\s/g,"")))this.labelToKerningRequest.delete(e),n=void 0;else return!0}if(!n){const i={fontSize:e.fontSize,text:e.text,letterSpacing:e.letterSpacing};return e.maxWidth>0&&(i.maxWidth=e.maxWidth,i.truncation=this.props.truncation||Py),n=ti({key:this.props.resourceKey||"",character:"",kerningPairs:[r],metrics:i}),e.preload?(e.resourceTrigger=()=>{e.onReady&&e.onReady(e)},this.resource.request(this,e,n)):(this.resource.request(this,e,n,{resource:{type:xe.FONT,key:this.props.resourceKey||""}}),this.labelToKerningRequest.set(e,n)),!1}return!0}willUpdateProps(e){e.data!==this.props.data&&delete this.propertyIds,e.scaleMode!==this.props.scaleMode&&this.rebuildLayer(),e.resourceKey!==this.props.resourceKey&&(this.fullUpdate=!0)}}Xl.defaultProps={key:"",data:new Oe};var Dy=Object.defineProperty,Fy=Object.getOwnPropertyDescriptor,Ln=(t,e,n,r)=>{for(var i=r>1?void 0:r?Fy(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(r?a(e,n,i):a(i))||i);return r&&i&&Dy(e,n,i),i};const Vp=class extends dt{constructor(t){super(t),this.color=[0,0,0,1],this.depth=0,this.fontSize=12,this.maxScale=1,this.maxWidth=0,this.origin=[0,0],this.scale=1,this.text="",this.letterSpacing=0,this.preload=!1,this.glyphs=[],this.size=[0,0],this.truncatedText="",this.anchor={padding:0,paddingDirection:[0,0],type:$.TopLeft,x:0,y:0},vt(this,Vp),this.anchor=t.anchor||this.anchor,this.color=t.color||this.color,this.depth=t.depth||this.depth,this.fontSize=t.fontSize||this.fontSize,this.maxScale=t.maxScale||this.maxScale,this.maxWidth=t.maxWidth||0,this.onReady=t.onReady,this.origin=t.origin,this.preload=t.preload||!1,this.scale=t.scale||this.scale,this.text=t.text||this.text,this.letterSpacing=t.letterSpacing||this.letterSpacing,t.anchor&&this.setAnchor(t.anchor)}getWidth(){return this.size[0]}setAnchor(t){const e={padding:t.padding||0,paddingDirection:t.paddingDirection,type:t.type,x:t.x||0,y:t.y||0};this.anchor=e}subTextGlyphs(t){const e=[],n=this.text.indexOf(t);if(n<0)return e;let r=0;for(let i=0,s=Math.min(this.text.length,n+t.length);i<s;++i)Vr(this.text[i])||(r++,i>=n&&e.push(this.glyphs[r]));return e}resourceTrigger(){}};let Ae=Vp;Ln([B],Ae.prototype,"color",2),Ln([B],Ae.prototype,"depth",2),Ln([B],Ae.prototype,"fontSize",2),Ln([B],Ae.prototype,"maxScale",2),Ln([B],Ae.prototype,"maxWidth",2),Ln([B],Ae.prototype,"origin",2),Ln([B],Ae.prototype,"scale",2),Ln([B],Ae.prototype,"text",2),Ln([B],Ae.prototype,"letterSpacing",2),Ln([B],Ae.prototype,"anchor",2);var By=Object.defineProperty,Uy=Object.getOwnPropertyDescriptor,si=(t,e,n,r)=>{for(var i=r>1?void 0:r?Uy(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(r?a(e,n,i):a(i))||i);return r&&i&&By(e,n,i),i},no=(t=>(t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.CENTERED=2]="CENTERED",t))(no||{}),On=(t=>(t[t.NONE=0]="NONE",t[t.CHARACTER=1]="CHARACTER",t[t.WORD=2]="WORD",t))(On||{}),Fi=(t=>(t[t.NEWLINE=0]="NEWLINE",t))(Fi||{});const $p=class extends Ae{constructor(t){super(t),this.maxHeight=0,this.lineHeight=0,this.wordWrap=0,this.alignment=0,this.labels=[],this.newLabels=[],this.borders=[],this.padding=[0,0,0,0],this.borderWidth=6,this.hasBorder=!0,this.spaceWidth=0,vt(this,$p),this.color=t.color,this.origin=t.origin,this.oldOrigin=t.origin,this.text=t.text,this.fontSize=t.fontSize||this.fontSize,this.maxWidth=t.maxWidth||this.maxWidth,this.maxHeight=t.maxHeight||this.maxHeight,this.lineHeight=t.lineHeight||this.lineHeight,this.wordWrap=t.wordWrap||this.wordWrap,this.alignment=t.alignment||this.alignment,this.padding=t.padding||this.padding,this.borderWidth=t.borderWidth||this.borderWidth,this.hasBorder=t.hasBorder!==void 0?t.hasBorder:this.hasBorder,this.letterSpacing=t.letterSpacing||this.letterSpacing}};let xr=$p;si([B],xr.prototype,"maxHeight",2),si([B],xr.prototype,"lineHeight",2),si([B],xr.prototype,"wordWrap",2),si([B],xr.prototype,"alignment",2),si([B],xr.prototype,"padding",2),si([B],xr.prototype,"borderWidth",2),si([B],xr.prototype,"hasBorder",2);var ky=Object.defineProperty,Gy=Object.getOwnPropertyDescriptor,Mr=(t,e,n,r)=>{for(var i=r>1?void 0:r?Gy(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(r?a(e,n,i):a(i))||i);return r&&i&&ky(e,n,i),i};const zy={[$.TopLeft]:(t,e)=>{t.x=-t.padding,t.y=-t.padding},[$.TopMiddle]:(t,e)=>{t.x=e.size[0]/2,t.y=-t.padding},[$.TopRight]:(t,e)=>{t.x=e.size[0]+t.padding,t.y=-t.padding},[$.MiddleLeft]:(t,e)=>{t.x=-t.padding,t.y=e.size[1]/2},[$.Middle]:(t,e)=>{t.x=e.size[0]/2,t.y=e.size[1]/2},[$.MiddleRight]:(t,e)=>{t.x=e.size[0]+t.padding,t.y=e.size[1]/2},[$.BottomLeft]:(t,e)=>{t.x=-t.padding,t.y=e.size[1]+t.padding},[$.BottomMiddle]:(t,e)=>{t.x=e.size[0]/2,t.y=e.size[1]+t.padding},[$.BottomRight]:(t,e)=>{t.x=e.size[0]+t.padding,t.y=e.size[1]+t.padding},[$.Custom]:(t,e)=>{t.x=t.x||0,t.y=t.y||0}},Wp=class extends dt{constructor(t){super(t),this.color=[0,0,0,1],this.depth=0,this.maxScale=1,this.scale=1,this.scaling=xn.BOUND_MAX,this.size=[1,1],this.position=[0,0],this._anchor={padding:0,type:$.TopLeft,x:0,y:0},vt(this,Wp),this.depth=t.depth||this.depth,this.color=t.color||this.color,this.scaling=t.scaling||this.scaling,this.position=t.position||this.position,this.size=t.size||this.size,t.anchor&&this.setAnchor(t.anchor)}get anchor(){return this._anchor}setAnchor(t){const e={padding:t.padding||0,type:t.type,x:t.x||0,y:t.y||0};zy[e.type](e,this),this._anchor=e}};let Nn=Wp;Mr([B],Nn.prototype,"color",2),Mr([B],Nn.prototype,"depth",2),Mr([B],Nn.prototype,"maxScale",2),Mr([B],Nn.prototype,"scale",2),Mr([B],Nn.prototype,"scaling",2),Mr([B],Nn.prototype,"size",2),Mr([B],Nn.prototype,"position",2),Mr([B],Nn.prototype,"_anchor",2);var Vy=Object.defineProperty,$y=Object.getOwnPropertyDescriptor,Yl=(t,e,n,r)=>{for(var i=r>1?void 0:r?$y(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(r?a(e,n,i):a(i))||i);return r&&i&&Vy(e,n,i),i};const jp=class extends Nn{constructor(t){super(t),this.fontScale=1,this.textAreaOrigin=[0,0],this.textAreaAnchor=[0,0],vt(this,jp),this.fontScale=t.fontScale||this.fontScale,this.textAreaOrigin=t.textAreaOrigin||this.textAreaOrigin,this.textAreaAnchor=t.textAreaAnchor||this.textAreaAnchor}};let ai=jp;Yl([B],ai.prototype,"fontScale",2),Yl([B],ai.prototype,"textAreaOrigin",2),Yl([B],ai.prototype,"textAreaAnchor",2);const Wy=`precision highp float;
varying vec4 vertexColor;
void main() {
gl_FragColor = vertexColor;
}`,jy=`precision highp float;
varying vec4 vertexColor;
void main() {
float borderScale = mix(fontScale, 1.0, float(scaling == 3.0));
vec3 screenSize = cameraSpaceSize(vec3(size * scale * borderScale / scaleFactor / maxScale, 1.0));
bool largerOnScreen = screenSize.y > size.y || screenSize.x > size.x;
float useScaleMode = float(
(
scaling == 3.0 ||
(largerOnScreen && scaling == 2.0)
) &&
scaling != 1.0
);
float unequalZooms = float(cameraScale2D.x != cameraScale2D.y);
vec2 adjustedSize = mix(
size,
(size * cameraScale2D.yx),
unequalZooms
);
float normal = normals.x;
float side = normals.y;
vec2 scaledAnchor = anchor * scale;
vec2 worldAnchor = location + scaledAnchor;
vec2 adjustedAnchor = mix(
scaledAnchor,
(scaledAnchor * cameraScale2D.yx),
unequalZooms
);
vec2 vertex = vec2(side, float(normal == 1.0)) * scale * adjustedSize + location - adjustedAnchor;
float labelScreenScale = mix(
screenSize.y / adjustedSize.y,
screenSize.x / adjustedSize.x,
float((cameraScale2D.x != 1.0))
);
float currentScale = labelScreenScale * scale;
vec2 anchorToVertex = vertex - location;
vertex = mix(
vertex + textAreaOrigin,
(anchorToVertex + location - textAreaAnchor) / labelScreenScale + textAreaOrigin + textAreaAnchor,
useScaleMode
);
vertexColor = color;
gl_Position = clipSpace(vec3(vertex, depth));
}`,Pn=class extends nt{initShader(){const t=this.props.animate||{},e={0:1,1:1,2:-1,3:1,4:-1,5:-1},n={0:0,1:0,2:0,3:1,4:1,5:1},{scaleFactor:r=()=>1}=this.props;return{fs:Wy,instanceAttributes:[{easing:t.location,name:Pn.attributeNames.location,size:k.TWO,update:i=>i.position},{name:Pn.attributeNames.anchor,size:k.TWO,update:i=>[i.anchor.x||0,i.anchor.y||0]},{name:Pn.attributeNames.size,size:k.TWO,update:i=>i.size},{name:Pn.attributeNames.depth,size:k.ONE,update:i=>[i.depth]},{name:Pn.attributeNames.scaling,size:k.ONE,update:i=>[i.scaling]},{easing:t.color,name:Pn.attributeNames.color,size:k.FOUR,update:i=>i.color},{name:Pn.attributeNames.scale,size:k.ONE,update:i=>[i.scale]},{name:Pn.attributeNames.maxScale,size:k.ONE,update:i=>[i.maxScale]},{name:Pn.attributeNames.fontScale,size:k.ONE,update:i=>[i.fontScale]},{name:"textAreaOrigin",size:k.TWO,update:i=>i.textAreaOrigin},{name:"textAreaAnchor",size:k.TWO,update:i=>i.textAreaAnchor}],uniforms:[{name:"scaleFactor",size:L.ONE,update:i=>[r()]}],vertexAttributes:[{name:"normals",size:ct.TWO,update:i=>[e[i],n[i]]}],vertexCount:6,vs:jy}}getMaterialOptions(){return At.transparentShapeBlending}};let ql=Pn;ql.defaultProps={key:"",data:new Oe},ql.attributeNames={anchor:"anchor",color:"color",depth:"depth",fontScale:"fontScale",location:"location",maxScale:"maxScale",scale:"scale",scaling:"scaling",size:"size"};const Ir={[$.TopLeft]:t=>[0,0],[$.TopMiddle]:t=>[t.maxWidth/2,0],[$.TopRight]:t=>[t.maxWidth,0],[$.MiddleLeft]:t=>[0,t.maxHeight/2],[$.Middle]:t=>[t.maxWidth/2,t.maxHeight/2],[$.MiddleRight]:t=>[t.maxWidth,t.maxHeight/2],[$.BottomLeft]:t=>[0,t.maxHeight],[$.BottomMiddle]:t=>[t.maxWidth/2,t.maxHeight],[$.BottomRight]:t=>[t.maxWidth,t.maxHeight],[$.Custom]:t=>[t.anchor.x||0,t.anchor.y||0]};function ro(t,e){let n=Number.MAX_SAFE_INTEGER;for(let r=0,i=t.length;r<i;r++){const s=t[r],a=e.get(s);a===0?n=0:a&&a<n&&(n=a)}return n===Number.MAX_SAFE_INTEGER?0:n}function Hy(t){const e=[],n=t.split(dh);for(let s=0,a=n.length-1;s<a;s++)n[s].split(" ").forEach(l=>{l!==""&&e.push(l)}),e.push(`
`);return n[n.length-1].split(" ").forEach(s=>{s!==""&&e.push(s)}),e}function Qy(t,e){const n=new Map;if(e.fontMap){const r=e.fontMap.fontSource.size,i=t.fontSize/r,s=e.fontMap,a=t.text.replace(/\s/g,"");let o=Number.MAX_SAFE_INTEGER,c=0,l,u="";for(let h=0,f=a.length;h<f;++h){const p=a[h];l=0,u&&(l=s.kerning[u][p][1]||0),c=c+l*i,n.set(p,c),o=Math.min(c,o),u=p}n.forEach((h,f)=>{n.set(f,h-o)})}return n}function Xy(t,e,n){const r=[],i=n.fontMap?n.fontMap.fontSource.size:e.fontSize,s=e.fontSize/i;let a="",o=0,c=[0,0];for(let l=0,u=t.text.length;l<u;l++){const h=t.text[l];if(n.fontMap){let f=[0,0];a&&(f=n.fontMap.kerning[a][h]||[0,0]),c=kn(c,Xe(f,s)),l!==0&&(c=kn(c,[e.letterSpacing,0]));const p=n.fontMap.glyphMap[h];o=c[0]+p.pixelWidth*s,r.push(o),a=h}}return r}class Hp extends nt{constructor(){super(...arguments),this.providers={labels:new Oe,borders:new Oe},this.fullUpdate=!1,this.areaToLabels=new Map,this.areaToLines=new Map,this.areaWaitingOnLabel=new Map,this.areaTokerningRequest=new Map,this.areaToWords=new Map,this.labelsInLine=[],this.handleLabelReady=e=>{if(!e.parentTextArea){delete e.onReady;return}const n=e.parentTextArea,r=this.areaWaitingOnLabel.get(n);if(r&&r.has(e)&&(r.delete(e),r.size<=0)){n.active=!0;const i=n.onReady;i&&i(n)}}}childLayers(){const e=this.props.animateLabel||{},n=this.props.animateBorder||{},r=this.props.scaling;return[Kr(Xl,{animate:e,customGlyphLayer:this.props.customGlyphLayer,data:this.providers.labels,key:`${this.id}.labels`,resourceKey:this.props.resourceKey,scaleMode:r,inTextArea:!0}),Kr(ql,{animate:{color:n.color,location:n.location},data:this.providers.borders,key:`${this.id}.border`})]}draw(){const e=this.resolveChanges();if(e.length<=0)return;if(!this.propertyIds){const b=e[0][0];this.propertyIds=this.getInstanceObservableIds(b,["active","alignment","borderWidth","color","fontSize","hasBorder","letterSpacing","lineHeight","maxHeight","maxWidth","origin","padding","text","wordWrap"])}const{active:n,alignment:r,borderWidth:i,color:s,fontSize:a,hasBorder:o,letterSpacing:c,lineHeight:l,maxHeight:u,maxWidth:h,origin:f,padding:p,text:m,wordWrap:v}=this.propertyIds;for(let b=0,T=e.length;b<T;++b){const[E,S,I]=e[b];switch(S){case Je.CHANGE:if(!this.areaToLabels.get(E)){this.insert(E);continue}I[m]!==void 0?(this.clear(E),this.updateLabels(E),this.layout(E)):I[n]!==void 0&&(E.active?(this.layout(E),this.showLabels(E)):this.hideLabels(E)),I[r]!==void 0&&(this.clear(E),this.updateLabels(E),this.layoutLabels(E)),I[s]!==void 0&&this.updateLabelColors(E),I[f]!==void 0&&this.updateLabelOrigins(E),I[a]!==void 0&&this.updateLabelFontSizes(E),I[v]!==void 0&&this.updateLabelLineWrap(E),I[l]!==void 0&&this.updateLabelLineHeight(E),I[h]!==void 0&&this.updateTextAreaSize(E),I[u]!==void 0&&this.updateTextAreaSize(E),I[p]!==void 0&&this.updateTextAreaSize(E),I[i]!==void 0&&this.updateBorderWidth(E),I[o]!==void 0&&this.updateBorder(E),I[c]!==void 0&&this.updateLetterSpacing(E);break;case Je.INSERT:this.insert(E);break;case Je.REMOVE:{const x=this.areaToLabels.get(E);if(x){for(let D=0,N=x.length;D<N;++D){const O=x[D];O instanceof Ae&&this.providers.labels.remove(O)}this.areaToLabels.delete(E),this.areaWaitingOnLabel.delete(E)}break}}}}insert(e){this.layout(e),this.updateLabels(e)}hideLabels(e){const n=this.areaToLabels.get(e);if(n)for(let r=0,i=n.length;r<i;++r){const s=n[r];s instanceof Ae&&this.providers.labels.remove(s)}}initShader(){return null}clear(e){const n=e.labels;for(let i=0,s=n.length;i<s;i++){const a=n[i];a instanceof Ae&&this.providers.labels.remove(a)}e.labels=[];const r=e.newLabels;for(let i=0,s=r.length;i<s;i++){const a=r[i];a instanceof Ae&&this.providers.labels.remove(a)}e.newLabels=[],this.areaToLabels.delete(e),this.areaWaitingOnLabel.delete(e),this.areaToWords.delete(e)}seperateLabel(e,n,r,i,s,a,o,c,l){const u=e.padding[0],h=e.padding[1]||0,f=e.padding[2]||0,p=e.padding[3]||0,m=e.maxWidth-p-h,v=e.maxHeight-u-f,b=e.origin[0],T=e.origin[1];n.active=!1;const E=i.substring(0,s+1),S=ro(E,r),I=Ir[e.anchor.type](e),x=new Ae({anchor:{padding:0,type:$.Custom,paddingDirection:[a+p,o+u+S],x:I[0],y:I[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[b,T],text:E});if(x.size=[l[s],n.size[1]],this.providers.labels.add(x),e.newLabels.push(x),this.labelsInLine.push(x),a+=x.getWidth()+c,e.wordWrap===On.CHARACTER||e.wordWrap===On.WORD){if(this.setTextAlignment(a,o,c,m,e.alignment),a=0,o+=e.lineHeight,o+e.lineHeight<=v){let D=l[l.length-1]-l[s];for(;D>m&&o+e.lineHeight<=v;){let N=l.length-1;for(;l[N]-l[s]>m;)N--;const O=i.substring(s+1,N+1),te=ro(O,r),ne=new Ae({anchor:{padding:0,type:$.Custom,paddingDirection:[a+p,o+u+te],x:I[0],y:I[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[b,T],text:O});ne.size=[l[N]-l[s],n.size[1]],a+=ne.getWidth()+c,this.labelsInLine.push(ne),this.providers.labels.add(ne),e.newLabels.push(ne),this.setTextAlignment(a,o,c,m,e.alignment),a=0,o+=e.lineHeight,s=N,D=l[l.length-1]-l[s]}if(o+e.lineHeight<=v){const N=i.substring(s+1),O=ro(N,r),te=new Ae({anchor:{padding:0,type:$.Custom,paddingDirection:[a+p,o+u+O],x:I[0],y:I[1]},color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,origin:[b,T],text:N});te.size=[l[l.length-1]-l[s],n.size[1]],this.labelsInLine.push(te);const ne=[];for(let V=s+1;V<l.length;V++)ne.push(l[V]-l[s]);this.providers.labels.add(te),e.newLabels.push(te),a+=te.getWidth()+c}}}else e.wordWrap===On.NONE&&(a+=x.getWidth()+c);return[a,o]}updateLabelLineWrap(e){const n=this.areaToLabels.get(e);if(n){for(let r=0,i=n.length;r<i;++r){const s=n[r];s instanceof Ae&&(s.active=!0)}for(let r=0,i=e.newLabels.length;r<i;++r){const s=e.newLabels[r];this.providers.labels.remove(s)}e.newLabels=[],this.layoutLabels(e)}}updateLabelLineHeight(e){const n=this.areaToLabels.get(e);if(n){for(let r=0,i=n.length;r<i;++r){const s=n[r];s instanceof Ae&&(s.active=!0)}for(let r=0,i=e.newLabels.length;r<i;++r){const s=e.newLabels[r];this.providers.labels.remove(s)}e.newLabels=[],this.layoutLabels(e)}}updateTextAreaSize(e){const n=this.areaToLabels.get(e);if(n){for(let r=0,i=n.length;r<i;++r){const s=n[r];s instanceof Ae&&(s.active=!0)}for(let r=0,i=e.newLabels.length;r<i;++r){const s=e.newLabels[r];this.providers.labels.remove(s)}e.newLabels=[];for(let r=0,i=e.borders.length;r<i;++r){const s=e.borders[r];this.providers.borders.remove(s)}e.borders=[],this.layoutBorder(e),this.layoutLabels(e)}}updateBorderWidth(e){for(let n=0,r=e.borders.length;n<r;++n){const i=e.borders[n];this.providers.borders.remove(i)}e.borders=[],this.layoutBorder(e)}updateBorder(e){if(e.hasBorder)this.layoutBorder(e);else{for(let n=0,r=e.borders.length;n<r;++n){const i=e.borders[n];this.providers.borders.remove(i)}e.borders=[]}}updateLetterSpacing(e){this.clear(e),this.updateLabels(e),this.layout(e)}setTextAlignment(e,n,r,i,s){if(e-r<i&&s!==no.LEFT){const a=i-e+r,o=s===no.RIGHT?a:a/2;this.labelsInLine.forEach(c=>{const l=c.anchor;c.anchor={padding:l.padding,type:$.Custom,paddingDirection:[(l.paddingDirection?l.paddingDirection[0]:0)+o,l.paddingDirection?l.paddingDirection[1]:n],x:l.x,y:l.y}})}this.labelsInLine=[]}layoutBorder(e){if(e.hasBorder){const n=this.areaTokerningRequest.get(e);if(!n)return;const r=n.fontMap?n.fontMap.fontSource.size:e.fontSize,i=e.fontSize/r,s=this.props.scaling,a=e.borderWidth,o=new ai({color:e.color,fontScale:i,scaling:s,size:[e.maxWidth+2*a,a],textAreaOrigin:e.origin,textAreaAnchor:Ir[e.anchor.type](e),position:[-a,-a]}),c=new ai({color:e.color,fontScale:i,scaling:s,size:[a,e.maxHeight+2*a],textAreaOrigin:e.origin,textAreaAnchor:Ir[e.anchor.type](e),position:[-a,-a]}),l=new ai({color:e.color,fontScale:i,scaling:s,size:[a,e.maxHeight+2*a],textAreaOrigin:e.origin,textAreaAnchor:Ir[e.anchor.type](e),position:[e.maxWidth,-a]}),u=new ai({color:e.color,fontScale:i,scaling:s,size:[e.maxWidth+2*a,a],textAreaOrigin:e.origin,textAreaAnchor:Ir[e.anchor.type](e),position:[-a,e.maxHeight]});this.providers.borders.add(o),this.providers.borders.add(c),this.providers.borders.add(l),this.providers.borders.add(u),e.borders.push(o),e.borders.push(c),e.borders.push(l),e.borders.push(u)}}layoutLabels(e){const n=this.areaTokerningRequest.get(e);if(!n)return;const r=e.padding[0],i=e.padding[1]||0,s=e.padding[2]||0,a=e.padding[3]||0,o=e.maxWidth-a-i,c=e.maxHeight-r-s,l=e.origin[0],u=e.origin[1];let h=0;if(e.spaceWidth)h=e.spaceWidth;else{if(n.fontMap){const v=n.fontMap.fontSource.size,b=e.fontSize/v;h=n.fontMap.spaceWidth*b}else h=this.props.whiteSpaceKerning||e.fontSize/2;e.spaceWidth=h}const f=Qy(e,n);let p=0,m=0;this.labelsInLine=[];for(let v=0,b=e.labels.length;v<b;++v){const T=e.labels[v];if(T instanceof Ae){const E=T.getWidth(),S=ro(T.text,f),I=Xy(T,e,n);if(m+e.lineHeight<=c&&I[0]<=o)if(p+E<=o){T.origin=[l,u];const x=Ir[e.anchor.type](e);T.anchor={padding:0,paddingDirection:[p+a,m+r+S],type:$.Custom,x:x[0],y:x[1]},p+=E+h,this.labelsInLine.push(T),p>=o&&e.wordWrap===On.CHARACTER&&v+1<b&&e.labels[v+1]!==Fi.NEWLINE&&(this.setTextAlignment(p,m,h,o,e.alignment),p=0,m+=e.lineHeight)}else if(e.wordWrap===On.WORD&&T.getWidth()<=e.maxWidth)if(this.setTextAlignment(p,m,h,o,e.alignment),p=0,m+=e.lineHeight,m+e.lineHeight<=c){T.origin=[l,u];const x=Ir[e.anchor.type](e);T.anchor={padding:0,paddingDirection:[p+a,m+r+S],type:$.Custom,x:x[0],y:x[1]},this.labelsInLine.push(T),p+=T.getWidth()+h}else T.active=!1;else{const x=o-p;let D=I.length-1;const N=T.text;for(;I[D]>x;)D--;if(D>=0){const O=this.seperateLabel(e,T,f,N,D,p,m,h,I);p=O[0],m=O[1]}else if(e.wordWrap===On.CHARACTER||e.wordWrap===On.WORD)if(this.setTextAlignment(p,m,h,o,e.alignment),m+=e.lineHeight,p=0,m+e.lineHeight<c)if(p+T.getWidth()<=o){T.origin=[l,u];const O=Ir[e.anchor.type](e);T.anchor={padding:0,paddingDirection:[p+a,m+r+S],type:$.Custom,x:O[0],y:O[1]},this.labelsInLine.push(T),p+=T.getWidth()+h,p>=o&&v+1<b&&e.labels[v+1]!==Fi.NEWLINE&&(this.setTextAlignment(p,m,h,o,e.alignment),p=0,m+=e.lineHeight)}else{const O=o-p;let te=I.length-1;const ne=T.text;for(;I[te]>O;)te--;if(te>=0){const V=this.seperateLabel(e,T,f,ne,te,p,m,h,I);p=V[0],m=V[1]}}else T.active=!1;else e.wordWrap===On.NONE&&(T.active=!1)}else T.active=!1}else T===Fi.NEWLINE&&(this.setTextAlignment(p,m,h,o,e.alignment),p=0,m+=e.lineHeight)}this.setTextAlignment(p,m,h,o,e.alignment)}layout(e){this.updateKerning(e);const n=this.areaTokerningRequest.get(e);if(!n||!n.fontMap)return;const r=this.areaWaitingOnLabel.get(e);if(r&&r.size>0||!e.active)return;const i=this.areaToLabels.get(e);!i||i.length===0||(this.updateLabels(e),this.layoutBorder(e),this.layoutLabels(e))}updateKerning(e){let n=this.areaTokerningRequest.get(e);const r=e.text;if(n){if(n.kerningPairs&&n.kerningPairs.indexOf(r)>-1)return!!n.fontMap;if(n.fontMap&&!n.fontMap.supportsKerning(r))this.areaTokerningRequest.delete(e),n=void 0;else return!1}else{const i={fontSize:e.fontSize,text:e.text,letterSpacing:e.letterSpacing};return n=ti({character:"",key:this.props.resourceKey||"",kerningPairs:[r],metrics:i}),e.preload?(e.resourceTrigger=()=>{e.onReady&&e.onReady(e)},this.resource.request(this,e,n)):(this.resource.request(this,e,n),this.areaTokerningRequest.set(e,n)),!1}return!0}managesInstance(e){return!!this.areaToLabels.get(e)}showLabels(e){const n=this.areaToLabels.get(e);if(n)for(let r=0,i=n.length;r<i;++r){const s=n[r];s instanceof Ae&&this.providers.labels.add(s)}}updateLabels(e){let n=this.areaToLabels.get(e);const r=e.padding[0],i=e.padding[3]||0,s=e.origin[0]+i,a=e.origin[1]+r;n||(n=[],this.areaToLabels.set(e,n));let o=this.areaWaitingOnLabel.get(e);o||(o=new Set,this.areaWaitingOnLabel.set(e,o));let c=this.areaToWords.get(e);if(c||(c=Hy(e.text)),n.length<c.length)for(let l=n.length,u=c.length;l<u;++l){const h=c[l];if(h===`
`)n.push(Fi.NEWLINE);else{const f=new Ae({active:!1,color:e.color,fontSize:e.fontSize,letterSpacing:e.letterSpacing,text:h,origin:[s,a],onReady:this.handleLabelReady});f.parentTextArea=e,n.push(f),this.providers.labels.add(f),o.add(f)}}e.labels=n}updateLabelColors(e){const n=this.areaToLabels.get(e);if(n){for(let r=0,i=n.length;r<i;++r){const s=n[r];s instanceof Ae&&(s.color=Kt(e.color))}for(let r=0,i=e.newLabels.length;r<i;++r)e.newLabels[r].color=Kt(e.color);for(let r=0,i=e.borders.length;r<i;++r)e.borders[r].color=Kt(e.color)}}updateLabelFontSizes(e){this.clear(e),this.updateLabels(e),this.areaTokerningRequest.delete(e),this.layout(e)}updateLabelOrigins(e){const n=this.areaToLabels.get(e);if(!n)return;const r=e.origin,i=e.oldOrigin;for(let s=0,a=n.length;s<a;++s){const o=n[s];if(o instanceof Ae){const c=o.origin;o.origin=[c[0]+r[0]-i[0],c[1]+r[1]-i[1]]}}for(let s=0,a=e.newLabels.length;s<a;++s){const o=e.newLabels[s];if(o instanceof Ae){const c=o.origin;o.origin=[c[0]+r[0]-i[0],c[1]+r[1]-i[1]]}}for(let s=0,a=e.borders.length;s<a;++s){const o=e.borders[s];o.position=[o.position[0]+r[0]-i[0],o.position[1]+r[1]-i[1]]}e.oldOrigin=e.origin}willUpdateProps(e){e.data!==this.props.data&&delete this.propertyIds,e.resourceKey!==this.props.resourceKey&&(this.fullUpdate=!0)}}Hp.defaultProps={key:"",data:new Oe,scaling:xn.ALWAYS};const Yy=`precision highp float;
varying vec4 vertexColor;
void main() {
gl_FragColor = vertexColor;
}`,qy=`precision highp float;
varying vec4 vertexColor;
void main() {
vec3 screenSize = cameraSpaceSize(vec3(size * scale / scaleFactor / maxScale, 1.0));
bool largerOnScreen = screenSize.y > size.y || screenSize.x > size.x;
float useScaleMode = float(
(
scaling == 3.0 ||
(largerOnScreen && scaling == 2.0)
) &&
scaling != 1.0
);
float unequalZooms = float(cameraScale2D.x != cameraScale2D.y);
vec2 adjustedSize = mix(
size,
(size * cameraScale2D.yx),
unequalZooms
);
float normal = normals.x;
float side = normals.y;
vec2 scaledAnchor = anchor * scale;
vec2 worldAnchor = location + scaledAnchor;
vec2 adjustedAnchor = mix(
scaledAnchor,
(scaledAnchor * cameraScale2D.yx),
unequalZooms
);
vec2 vertex = vec2(side, float(normal == 1.0)) * scale * adjustedSize + location - adjustedAnchor;
float labelScreenScale = mix(
screenSize.y / adjustedSize.y,
screenSize.x / adjustedSize.x,
float((cameraScale2D.x != 1.0))
);
float currentScale = labelScreenScale * scale;
vec2 anchorToVertex = vertex - location;
vertex = mix(
vertex,
(anchorToVertex / labelScreenScale) + location,
useScaleMode
);
vertexColor = color;
gl_Position = clipSpace(vec3(vertex, depth));
}`,ir=class extends nt{initShader(){const t=this.props.animate||{},e={0:1,1:1,2:-1,3:1,4:-1,5:-1},n={0:0,1:0,2:0,3:1,4:1,5:1},{scaleFactor:r=()=>1}=this.props;return{fs:Yy,instanceAttributes:[{easing:t.location,name:ir.attributeNames.location,size:k.TWO,update:i=>i.position},{name:ir.attributeNames.anchor,size:k.TWO,update:i=>[i.anchor.x||0,i.anchor.y||0]},{name:ir.attributeNames.size,size:k.TWO,update:i=>i.size},{name:ir.attributeNames.depth,size:k.ONE,update:i=>[i.depth]},{name:ir.attributeNames.scaling,size:k.ONE,update:i=>[i.scaling]},{easing:t.color,name:ir.attributeNames.color,size:k.FOUR,update:i=>i.color},{name:ir.attributeNames.scale,size:k.ONE,update:i=>[i.scale]},{name:ir.attributeNames.maxScale,size:k.ONE,update:i=>[i.maxScale]}],uniforms:[{name:"scaleFactor",size:L.ONE,update:i=>[r()]}],vertexAttributes:[{name:"normals",size:ct.TWO,update:i=>[e[i],n[i]]}],vertexCount:6,vs:qy}}getMaterialOptions(){return At.transparentShapeBlending}};let Kl=ir;Kl.defaultProps={key:"",data:new Oe},Kl.attributeNames={anchor:"anchor",color:"color",depth:"depth",location:"location",maxScale:"maxScale",scale:"scale",scaling:"scaling",size:"size"};var Ky=Object.defineProperty,Zy=Object.getOwnPropertyDescriptor,Us=(t,e,n,r)=>{for(var i=r>1?void 0:r?Zy(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(r?a(e,n,i):a(i))||i);return r&&i&&Ky(e,n,i),i};const Qp=class extends dt{constructor(t){super(t),this.color=[1,1,1,1],this.depth=0,this.radius=0,this.thickness=1,this.center=[0,0],vt(this,Qp),this.color=t.color||this.color,this.depth=t.depth||this.depth,this.radius=t.radius||this.radius,this.thickness=t.thickness||this.thickness,this.center=t.center||this.center}get width(){return this.radius*2}get height(){return this.radius*2}get innerRadius(){return this.radius-this.thickness}};let Bi=Qp;Us([B],Bi.prototype,"color",2),Us([B],Bi.prototype,"depth",2),Us([B],Bi.prototype,"radius",2),Us([B],Bi.prototype,"thickness",2),Us([B],Bi.prototype,"center",2);const Jy=`precision highp float;
varying vec4 vertexColor;
varying float edgeSharpness;
varying float borderSize;
varying vec2 pointCoord;
varying float scale;
float circle(vec2 coord, float radius){
vec2 dist = coord - vec2(0.5);
return 1.0 - smoothstep(
radius - (radius * edgeSharpness),
radius,
dot(dist, dist) * 4.0
);
}
void main() {
float outer_step_factor = circle(pointCoord, 1.0);
float inner_step_factor = circle(pointCoord, 1.0 - borderSize * scale);
gl_FragColor = mix(
mix(
vec4(0.0, 0.0, 0.0, 0.0),
vertexColor,
outer_step_factor
),
vec4(0.0, 0.0, 0.0, 0.0),
inner_step_factor
);
}`,ew=`precision highp float;
varying vec4 vertexColor;
varying float edgeSharpness;
varying float borderSize;
varying vec2 pointCoord;
varying float scale;
void main() {
scale = scaleFactor;
vertexColor = color;
float size = radius * scaleFactor * pixelRatio;
float ringWidth = mix(2.0 , thickness, float(thickness > 2.0));
borderSize = mix(
(ringWidth) / size,
((ringWidth * pixelRatio) / size),
float(pixelRatio > 1.0)
);
edgeSharpness = min(0.2 / (ringWidth * scale), 0.1);
pointCoord = (normals.xy + vec2(1.0, 1.0)) / 2.0;
vec4 clipCenter = clipSpace(vec3(center, depth));
vec2 screenCenter = (clipCenter.xy + vec2(1.0, 1.0)) * vec2(0.5, 0.5) * viewSize;
vec2 vertex = (normals.xy * size) + screenCenter;
gl_Position = vec4((vertex / viewSize) * vec2(2.0, 2.0) - vec2(1.0, 1.0), clipCenter.zw);
}`,Ui=class extends nt{initShader(){const t=this.props.scaleFactor||(()=>1),e=this.props.animate||{},{color:n,center:r,radius:i}=e,s={0:1,1:1,2:-1,3:1,4:-1,5:-1},a={0:-1,1:-1,2:-1,3:1,4:1,5:1};return{fs:Jy,instanceAttributes:[{easing:r,name:Ui.attributeNames.center,size:k.TWO,update:o=>o.center},{easing:i,name:Ui.attributeNames.radius,size:k.ONE,update:o=>[o.radius]},{name:Ui.attributeNames.depth,size:k.ONE,update:o=>[o.depth]},{easing:n,name:Ui.attributeNames.color,size:k.FOUR,update:o=>o.color},{name:Ui.attributeNames.thickness,size:k.ONE,update:o=>[o.thickness]}],uniforms:[{name:"scaleFactor",size:L.ONE,update:o=>[t()]}],vertexAttributes:[{name:"normals",size:ct.TWO,update:o=>[s[o],a[o]]}],vertexCount:6,vs:ew}}getMaterialOptions(){return At.transparentShapeBlending}};let Zl=Ui;Zl.defaultProps={key:"",data:new Oe},Zl.attributeNames={center:"center",radius:"radius",depth:"depth",color:"color",thickness:"thickness"};const tw=`\${import: camera}
vec3 cameraSpace(vec3 world) {
return (view * vec4(world, 1.0)).xyz;
}
vec3 cameraSpace(vec4 world) {
return (view * world).xyz;
}
vec3 cameraSpaceDirection(vec3 world) {
return (view * vec4(world, 0.0)).xyz;
}
vec3 cameraSpaceDirection(vec4 world) {
return (view * world).xyz;
}
vec3 cameraSpaceSize(vec3 worldSize) {
return (view * vec4(worldSize, 0.0)).xyz;
}
vec4 clipSpace(vec3 world) {
return (viewProjection) * vec4(world, 1.0);
}
vec4 clipSpace(vec4 world) {
return (viewProjection) * world;
}
vec4 clipSpaceDirection(vec3 worldSize) {
return (viewProjection) * vec4(worldSize, 0.0);
}
vec4 clipSpaceDirection(vec4 worldSize) {
return (viewProjection) * worldSize;
}
vec4 clipSpaceSize(vec3 worldSize) {
return (viewProjection) * vec4(worldSize, 0.0);
}`,nw=`
These are properties injected from the
current camera applied to the view.

Constants:
mat4 projection;
mat4 view;
mat4 viewProjection;
vec3 cameraOffset;
vec3 cameraPosition;
vec3 cameraScale;
vec3 cameraRotation;
vec2 viewSize;
float pixelRatio;
`;Qe.register([{moduleId:"camera",description:nw,content:"",compatibility:P.ALL,uniforms:t=>[{name:"projection",size:L.MATRIX4,update:()=>t.view.props.camera.projection},{name:"viewProjection",size:L.MATRIX4,update:()=>t.view.props.camera.viewProjection},{name:"view",size:L.MATRIX4,update:()=>t.view.props.camera.view},{name:"cameraPosition",size:L.THREE,update:()=>t.view.props.camera.position},{name:"cameraScale",size:L.THREE,update:()=>t.view.props.camera.scale},{name:"cameraRotation",size:L.THREE,update:()=>t.view.props.camera.scale},{shaderInjection:P.ALL,name:"viewSize",size:L.TWO,update:()=>[t.view.viewBounds.width,t.view.viewBounds.height]},{shaderInjection:P.ALL,name:"pixelRatio",size:L.ONE,update:()=>[t.view.pixelRatio]}]},{moduleId:"projection",content:tw,compatibility:P.ALL}]);const Xp=`
This provides frame timing information
or how many frames have been rendered.

Constants:
float currentTime;
float currentFrame;
`;Qe.register({moduleId:"frame",description:Xp,content:"",compatibility:P.ALL,uniforms:t=>[{name:"currentTime",size:L.ONE,shaderInjection:P.ALL,update:()=>[t.surface.frameMetrics.currentTime]},{name:"currentFrame",size:L.ONE,shaderInjection:P.ALL,update:()=>[t.surface.frameMetrics.currentFrame]}]}),Qe.register({moduleId:"time",description:Xp,content:"",compatibility:P.ALL,uniforms:t=>[{name:"time",size:L.ONE,shaderInjection:P.ALL,update:()=>[t.surface.frameMetrics.currentTime]}]});const rw=`vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}`,iw=`
Provides methods that converts colors to
HSV values and back. This makes it
easier to deal with hue saturation and
lightness levels.

Methods:
vec3 rgb2hsv(vec3 c);
vec3 hsv2rgb(vec3 c);
`;Qe.register({moduleId:"hsv",description:iw,content:rw,compatibility:P.ALL});const sw=`
This is an internal shader module that
helps establish the instancing system.
Not recommended for use unless you
really know how to utilize it properly.

Attributes:
float _active;
float instance;
`;Qe.register({moduleId:"instancing",description:sw,content:"",compatibility:P.ALL,instanceAttributes:t=>{const e={name:"_active",size:k.ONE,update:n=>[n.active?1:0]};return t.shaderIOInfo.activeAttribute=e,[e]},vertexAttributes:t=>t.bufferType===qe.UNIFORM?[{name:"instance",size:ct.ONE,update:()=>[0]}]:[]});const aw=`\${import: PI, PI2, fsin, fcos, wrap}
vec2 arc(float t, vec2 center, float radius, float start, float end) {
float angle = wrap((end - start) * t + start, 0.0, PI2);
return center + vec2(fcos(angle), fsin(angle)) * radius;
}`,ow=`vec2 bezier1(float t, vec2 p1, vec2 p2, vec2 c1) {
return (1.0 - t) * (1.0 - t) * p1 + 2.0 * t * (1.0 - t) * c1 + t * t * p2;
}`,cw=`vec2 bezier2(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2) {
float t1 = 1.0 - t;
return pow(t1, 3.0) * p1 + 3.0 * t * pow(t1, 2.0) * c1 + 3.0 * pow(t, 2.0) * t1 * c2 + pow(t, 3.0) * p2;
}`,lw=`\${import: PI, PI2, PI_2}
float fcos(float x) {
float sine;
x += PI_2;
x += mix(
mix(
0.0,
-PI2, float(x > PI)
),
PI2, float(x < -PI)
);
sine = 1.27323954 * x;
sine += mix(-1.0, 1.0, float(x < 0.0)) * 0.405284735 * x * x;
sine = 0.225 * (sine * (mix(1.0, -1.0, float(sine < 0.0)) * sine) - sine) + sine;
return sine;
}`,uw=`float fmod(float x, float m, float m_inv) {
return x - m * floor(x * m_inv);
}`,hw=`\${import: PI, PI2}
float fsin(float x) {
float sine;
x += mix(
mix(
0.0,
-PI2, float(x > PI)
),
PI2, float(x < -PI)
);
sine = 1.27323954 * x;
sine += mix(-1.0, 1.0, float(x < 0.0)) * 0.405284735 * x * x;
sine = 0.225 * (sine * (mix(1.0, -1.0, float(sine < 0.0)) * sine) - sine) + sine;
return sine;
}`,dw="float PI = 3.14159265;",fw="float PI2 = 6.2831853;",pw="float PI2_INV = 0.1591549431;",gw="float PI_2 = 1.5707963268;",mw="float PI_4 = 0.7853981634;",vw="float PI_INV = 0.3183098862;",yw="float toDegrees = 57.2957795131;",ww="float toRadians = 0.01745329252;",Tw=`float wrap(float value, float start, float end) {
float width = end - start;
float offsetValue = value - start;
return (offsetValue - (floor(offsetValue / width) * width)) + start;
}`,Jl=[{moduleId:"PI_INV",description:"Provides: float PI_INV = 1.0 / pi",content:vw,compatibility:P.ALL},{moduleId:"PI2_INV",description:`Provides:
float PI2_INV = 1.0 / (pi * 2.0)`,content:pw,compatibility:P.ALL},{moduleId:"PI_2",description:"Provides: float PI_2 = pi / 2.0",content:gw,compatibility:P.ALL},{moduleId:"PI_4",description:"Provides: float PI_4 = pi / 4.0",content:mw,compatibility:P.ALL},{moduleId:"PI",description:"Provides: float PI = pi",content:dw,compatibility:P.ALL},{moduleId:"PI2",description:"Provides: float PI2 = pi * 2.0",content:fw,compatibility:P.ALL},{moduleId:"toDegrees",description:`Provides: float toDegrees;
Can be used to convert radians to degrees:
radians * toDegrees`,content:yw,compatibility:P.ALL},{moduleId:"toRadians",description:`Provides: float toRadians;
Can be used to convert degrees to radians:
degress * toRadians`,content:ww,compatibility:P.ALL}],bw={moduleId:"constants",description:`
Provides all the math constants you may
need as convenience. It's probably
better to include them individually, but
convenience sometimes beats practicality

Constants:
${Jl.map(t=>t.moduleId).join(`
`)}
`,content:`\${import: ${Jl.map(t=>t.moduleId).join(", ")}}`,compatibility:P.ALL},Ew=[{moduleId:"bezier1",description:`Provides the 2D single control
point bezier method:
vec2 bezier1(float t, vec2 p1, vec2 p2, vec2 c1)`,content:ow,compatibility:P.ALL},{moduleId:"bezier2",description:`Provides the 2D single control
point bezier method:
vec2 bezier2(float t, vec2 p1, vec2 p2, vec2 c1, vec2 c2)`,content:cw,compatibility:P.ALL},{moduleId:"arc",description:`Provides the 2D
arc interpolation method:
vec2 arc(float t,
	vec2 center,
	float radius,
	float start,
	float end
)`,content:aw,compatibility:P.ALL},{moduleId:"fmod",description:`Provides the floating point
modulus method:
float fmod(float x, float m, float m_inv)`,content:uw,compatibility:P.ALL},{moduleId:"wrap",description:`Provides a method that wraps
value overflows:
float wrap(float value, float start, float end)`,content:Tw,compatibility:P.ALL},{moduleId:"fcos",description:`Provides a fcos method that also
has a higher precision than
some hardware cos implementations:
float fcos(float x)`,content:lw,compatibility:P.ALL},{moduleId:"fsin",description:`Provides a fsin method that also
has a higher precision than
some hardware sin implementations:
float fsin(float x)`,content:hw,compatibility:P.ALL}];Qe.register([...Ew,...Jl,bw]);const _w=`mat4 rotationFromQuaternion(vec4 q) {
float x2 = q.y + q.y;
float y2 = q.z + q.z;
float z2 = q.w + q.w;
float xx = q.y * x2;
float xy = q.y * y2;
float xz = q.y * z2;
float yy = q.z * y2;
float yz = q.z * z2;
float zz = q.w * z2;
float wx = q.x * x2;
float wy = q.x * y2;
float wz = q.x * z2;
return mat4(
1.0 - (yy + zz), xy - wz, xz + wy, 0.0,
xy + wz, 1.0 - (xx + zz), yz - wx, 0.0,
xz - wy, yz + wx, 1.0 - (xx + yy), 0.0,
0, 0, 0, 1
);
}`,Rw=`mat4 scale(vec3 s) {
return mat4(
s.x, 0, 0, 0,
0, s.y, 0, 0,
0, 0, s.z, 0,
0, 0, 0, 1
);
}`,Aw=`\${import: translation, rotation, scale}
mat4 transform(vec3 s, vec4 r, vec3 t) {
return translation(t) * rotationFromQuaternion(r) * scale(s);
}`,Sw=`mat4 translation(vec3 t) {
return mat4(
1, 0, 0, 0,
0, 1, 0, 0,
0, 0, 1, 0,
t.x, t.y, t.z, 1
);
}`;Qe.register([{moduleId:"translation",description:`Generates a translation matrix
from a vec3:
mat4 transform(vec3 s, vec4 r, vec3 t)`,compatibility:P.ALL,content:Sw},{moduleId:"rotation",description:`Generates a rotation matrix
from a quaternion:
mat4 rotationFromQuaternion(vec4 q)`,compatibility:P.ALL,content:_w},{moduleId:"scale",description:`Generates a scale matrix
from a vec3:
mat4 scale(vec3 s)`,compatibility:P.ALL,content:Rw},{moduleId:"transform",description:`Generates a full transform matrix
from a scale, quaternion, translation:
mat4 transform(vec3 s, vec4 r, vec3 t)`,compatibility:P.ALL,content:Aw}]);const xw=`vec3 mod289(vec3 x) {
return x - floor(x * (1.0f / 289.0f)) * 289.0f;
}
vec2 mod289(vec2 x) {
return x - floor(x * (1.0f / 289.0f)) * 289.0f;
}
vec3 permute(vec3 x) {
return mod289(((x * 34.0f) + 10.0f) * x);
}
float simplexNoise2D(vec2 v) {
const vec4 C = vec4(0.211324865405187f,
0.366025403784439f,
-0.577350269189626f,
0.024390243902439f);
vec2 i = floor(v + dot(v, C.yy));
vec2 x0 = v - i + dot(i, C.xx);
vec2 i1;
i1 = (x0.x > x0.y) ? vec2(1.0f, 0.0f) : vec2(0.0f, 1.0f);
vec4 x12 = x0.xyxy + C.xxzz;
x12.xy -= i1;
i = mod289(i);
vec3 p = permute(permute(i.y + vec3(0.0f, i1.y, 1.0f)) + i.x + vec3(0.0f, i1.x, 1.0f));
vec3 m = max(0.5f - vec3(dot(x0, x0), dot(x12.xy, x12.xy), dot(x12.zw, x12.zw)), 0.0f);
m = m * m;
m = m * m;
vec3 x = 2.0f * fract(p * C.www) - 1.0f;
vec3 h = abs(x) - 0.5f;
vec3 ox = floor(x + 0.5f);
vec3 a0 = x - ox;
m *= 1.79284291400159f - 0.85373472095314f * (a0 * a0 + h * h);
vec3 g;
g.x = a0.x * x0.x + h.x * x0.y;
g.yz = a0.yz * x12.xz + h.yz * x12.yw;
return 130.0f * dot(m, g);
}`,Mw=`vec3 mod289(vec3 x) {
return x - floor(x * (1.0f / 289.0f)) * 289.0f;
}
vec4 mod289(vec4 x) {
return x - floor(x * (1.0f / 289.0f)) * 289.0f;
}
vec4 permute(vec4 x) {
return mod289(((x * 34.0f) + 10.0f) * x);
}
vec4 taylorInvSqrt(vec4 r) {
return 1.79284291400159f - 0.85373472095314f * r;
}
float simplexNoise3D(vec3 v) {
const vec2 C = vec2(1.0f / 6.0f, 1.0f / 3.0f);
const vec4 D = vec4(0.0f, 0.5f, 1.0f, 2.0f);
vec3 i = floor(v + dot(v, C.yyy));
vec3 x0 = v - i + dot(i, C.xxx);
vec3 g = step(x0.yzx, x0.xyz);
vec3 l = 1.0f - g;
vec3 i1 = min(g.xyz, l.zxy);
vec3 i2 = max(g.xyz, l.zxy);
vec3 x1 = x0 - i1 + C.xxx;
vec3 x2 = x0 - i2 + C.yyy;
vec3 x3 = x0 - D.yyy;
i = mod289(i);
vec4 p = permute(permute(permute(i.z + vec4(0.0f, i1.z, i2.z, 1.0f)) + i.y + vec4(0.0f, i1.y, i2.y, 1.0f)) + i.x + vec4(0.0f, i1.x, i2.x, 1.0f));
float n_ = 0.142857142857f;
vec3 ns = n_ * D.wyz - D.xzx;
vec4 j = p - 49.0f * floor(p * ns.z * ns.z);
vec4 x_ = floor(j * ns.z);
vec4 y_ = floor(j - 7.0f * x_);
vec4 x = x_ * ns.x + ns.yyyy;
vec4 y = y_ * ns.x + ns.yyyy;
vec4 h = 1.0f - abs(x) - abs(y);
vec4 b0 = vec4(x.xy, y.xy);
vec4 b1 = vec4(x.zw, y.zw);
vec4 s0 = floor(b0) * 2.0f + 1.0f;
vec4 s1 = floor(b1) * 2.0f + 1.0f;
vec4 sh = -step(h, vec4(0.0f));
vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy;
vec4 a1 = b1.xzyw + s1.xzyw * sh.zzww;
vec3 p0 = vec3(a0.xy, h.x);
vec3 p1 = vec3(a0.zw, h.y);
vec3 p2 = vec3(a1.xy, h.z);
vec3 p3 = vec3(a1.zw, h.w);
vec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));
p0 *= norm.x;
p1 *= norm.y;
p2 *= norm.z;
p3 *= norm.w;
vec4 m = max(0.5f - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0f);
m = m * m;
return 105.0f * dot(m * m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3)));
}`;Qe.register({moduleId:"simplexNoise3D",content:Mw,compatibility:P.ALL,description:"Provides the simplex noise function for 3D coordinates."}),Qe.register({moduleId:"simplexNoise2D",content:xw,compatibility:P.ALL,description:"Provides the simplex noise function for 2D coordinates."});const Iw=`vec4 bitSh = vec4(16777216., 65536., 256., 1.);
vec4 bitMsk = vec4(0., vec3(1. / 256.0));
vec4 bitShifts = vec4(1.) / vec4(16777216., 65536., 256., 1.);
vec4 packFloat(float value, float range) {
value = (value + range) / (range * 2.);
vec4 comp = fract(value * bitSh);
comp -= comp.xxyz * bitMsk;
return comp;
}
float unpackFloat(vec4 color, float range) {
return dot(color , bitShifts) * (range * 2.) - range;
}`,Cw=`
This provides the ability to pack
a float value into a color RGBA
value. This is used to bypass the
lack of support for float textures.

Constants:
float currentTime;
float currentFrame;
`;Qe.register({moduleId:"packFloat",description:Cw,content:Iw,compatibility:P.ALL});const Lw="varying highp vec4 _picking_color_pass_;";Qe.register([{moduleId:"picking",description:`Internal use only. Provides methods
and constants to make the picking processes work.`,content:Lw,compatibility:P.VERTEX,instanceAttributes:t=>[{name:"_pickingColor",size:k.FOUR,shaderInjection:P.VERTEX,update:e=>{const n=16777215-e.uid;return[((n&16711680)>>16)/255,((n&65280)>>8)/255,(n&255)/255,1]}}]}]);const Ow=`void main() {
gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
}`,Nw=`void main() {
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
}`,Yp=`
Makes a no-op shader where gl_Position
is [0, 0, 0, 0] and gl_FragColor is
[0, 0, 0, 0].

You can not import this if you specify
your own main() method.
`;Qe.register([{moduleId:"no-op",description:Yp,content:Nw,compatibility:P.VERTEX},{moduleId:"no-op",description:Yp,content:Ow,compatibility:P.FRAGMENT}]);const Pw=`
This is a special helper module used by
the system to map View2D content into
a 3D world space. The system utilizes
this module automatically for you when
you utilize createLayer2Din3D.
`;Qe.register([{moduleId:"world2DXY",description:Pw,content:Ep,compatibility:P.ALL,uniforms:t=>t instanceof nt?t.props.control2D?[{name:"projection",size:L.MATRIX4,update:()=>t.view.props.camera.projection},{name:"view",size:L.MATRIX4,update:()=>t.view.props.camera.view},{name:"cameraOffset",size:L.THREE,update:()=>t.props.control2D instanceof Kn?t.props.control2D.offset:[0,0,0]},{name:"cameraPosition",size:L.THREE,update:()=>t.view.props.camera.position},{name:"cameraScale",size:L.THREE,update:()=>t.view.props.camera.scale},{name:"cameraScale2D",size:L.THREE,update:()=>t.props.control2D instanceof Kn?t.props.control2D.scale:[1,1,1]},{name:"cameraRotation",size:L.FOUR,update:()=>t.view.props.camera.transform.rotation},{name:"viewSize",size:L.TWO,update:()=>[t.view.viewBounds.width,t.view.viewBounds.height]},{name:"pixelRatio",size:L.ONE,update:()=>[t.view.pixelRatio]}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requested the module world2DXZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}]);const Dw=`vec3 cameraSpace(vec3 world) {
return (world + cameraOffset) * cameraScale2D;
}
vec3 cameraSpaceSize(vec3 worldSize) {
return worldSize * cameraScale2D;
}
vec4 clipSpace(vec3 world) {
return ((projection * view) * vec4(cameraSpace(world.xzy), 1.0));
}
vec4 clipSpaceSize(vec3 worldSize) {
return ((projection * view) * vec4(cameraSpaceSize(worldSize.xzy), 0.0));
}`,Fw=`
This is a special helper module used by
the system to map View2D content into
a 3D world space. The system utilizes
this module automatically for you when
you utilize createLayer2Din3D.
`;Qe.register([{moduleId:"world2DXZ",description:Fw,content:Dw,compatibility:P.ALL,uniforms:t=>t instanceof nt?t.props.control2D?[{name:"projection",size:L.MATRIX4,update:()=>t.view.props.camera.projection},{name:"view",size:L.MATRIX4,update:()=>t.view.props.camera.view},{name:"cameraOffset",size:L.THREE,update:()=>t.props.control2D instanceof Kn?t.props.control2D.offset:[0,0,0]},{name:"cameraPosition",size:L.THREE,update:()=>t.view.props.camera.position},{name:"cameraScale",size:L.THREE,update:()=>t.view.props.camera.scale},{name:"cameraScale2D",size:L.THREE,update:()=>t.props.control2D instanceof Kn?t.props.control2D.scale:[1,1,1]},{name:"cameraRotation",size:L.THREE,update:()=>t.view.props.camera.scale},{name:"viewSize",size:L.TWO,update:()=>[t.view.viewBounds.width,t.view.viewBounds.height]},{name:"pixelRatio",size:L.ONE,update:()=>[t.view.pixelRatio]}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requesed the module world2DXZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}]);const Bw=`vec3 cameraSpace(vec3 world) {
return (world + cameraOffset) * cameraScale2D;
}
vec3 cameraSpaceSize(vec3 worldSize) {
return worldSize * cameraScale2D;
}
vec4 clipSpace(vec3 world) {
return ((projection * view) * vec4(cameraSpace(world.zyx), 1.0));
}
vec4 clipSpaceSize(vec3 worldSize) {
return ((projection * view) * vec4(cameraSpaceSize(worldSize.zyx), 0.0));
}`,Uw=`
This is a special helper module used by
the system to map View2D content into
a 3D world space. The system utilizes
this module automatically for you when
you utilize createLayer2Din3D.
`;Qe.register([{moduleId:"world2DYZ",description:Uw,content:Bw,compatibility:P.ALL,uniforms:t=>t instanceof nt?t.props.control2D?[{name:"projection",size:L.MATRIX4,update:()=>t.view.props.camera.projection},{name:"view",size:L.MATRIX4,update:()=>t.view.props.camera.view},{name:"cameraOffset",size:L.THREE,update:()=>t.props.control2D instanceof Kn?t.props.control2D.offset:[0,0,0]},{name:"cameraPosition",size:L.THREE,update:()=>t.view.props.camera.position},{name:"cameraScale",size:L.THREE,update:()=>t.view.props.camera.scale},{name:"cameraScale2D",size:L.THREE,update:()=>t.props.control2D instanceof Kn?t.props.control2D.scale:[1,1,1]},{name:"cameraRotation",size:L.THREE,update:()=>t.view.props.camera.scale},{name:"viewSize",size:L.TWO,update:()=>[t.view.viewBounds.width,t.view.viewBounds.height]},{name:"pixelRatio",size:L.ONE,update:()=>[t.view.pixelRatio]}]:(console.warn("For a layer 2D to be compatible with a 3D View, the layer requires an additional prop of control2D"),[]):(console.warn("A shader requesed the module world2DYZ; however, the layer the shader comes from is NOT a Layer2D which is","required for the module to work."),[])}]);class qp extends ba{screenToWorld(e,n){return n=n||[0,0,0],this.viewToWorld(this.screenToView(e),n),n}screenRay(e){if(this.camera.projectionType===Hn.ORTHOGRAPHIC){const n=cr(this.screenToWorld(e));return gl(n,this.camera.transform.forward)}else{const n=cr(this.screenToWorld(e));return ml(cr(this.camera.transform.position),n)}}worldToScreen(e,n){n=n||[0,0];const r=It(this.camera.projection,this.camera.view),i=_a(r,e,this.viewBounds.width,this.viewBounds.height);return Ce(n,i[0]/this.pixelRatio,i[1]/this.pixelRatio)}viewToWorld(e,n){n=n||[0,0,0];const{width:r,height:i}=this.viewBounds,{projectionOptions:s}=this.camera,a=Xe(e,this.pixelRatio),{tan:o}=Math;if(s.type===Hn.PERSPECTIVE){const{fov:c,near:l}=s,u=i/r,h=o(c/2)*l,f=(2*((a[0]+.5)/r)-1)*h,p=(1-2*((a[1]+.5)/i))*h*u,m=[f,p,-1],v=vs(this.camera.transform.matrix,Ki(m,1));Ne(n,v[0],v[1],v[2])}else{const c=je(a,[r/2,i/2]),l=vs(this.camera.transform.viewMatrix,Ki(c,-s.near));Ne(n,l[0],-l[1],l[2])}return n}worldToView(e,n){n=n||[0,0];const r=It(this.camera.projection,this.camera.view),i=_a(r,e,this.viewBounds.width,this.viewBounds.height);return Ce(n,i[0]/this.pixelRatio,i[1]/this.pixelRatio)}}function kw(t){return t.projectionType===Hn.ORTHOGRAPHIC}class Kp extends Ns{constructor(e,n){super(e,n),this.projection=new qp,this.projection.camera=n.camera,this.projection.pixelRatio=this.pixelRatio}fitViewtoViewport(e,n){if(bl(this.props.camera)){const r=n.width,i=n.height,s=this.props.camera,a={near:s.projectionOptions.near,far:s.projectionOptions.far,width:r,height:i};this.props.preventCameraAdjustment||(s.projectionOptions=Object.assign(s.projectionOptions,a),s.update()),this.projection.pixelRatio=this.pixelRatio,this.projection.viewBounds=n,this.projection.viewBounds.d=this,this.projection.screenBounds=new we({height:this.projection.viewBounds.height/this.pixelRatio,width:this.projection.viewBounds.width/this.pixelRatio,x:this.projection.viewBounds.x/this.pixelRatio,y:this.projection.viewBounds.y/this.pixelRatio}),this.projection.screenBounds.d=this}else if(kw(this.props.camera)){const r=n.width,i=n.height,s=this.props.camera,a={near:s.projectionOptions.near,far:s.projectionOptions.far,left:-r/2,right:r/2,top:i/2,bottom:-i/2};this.props.preventCameraAdjustment||(s.projectionOptions=Object.assign(s.projectionOptions,a),s.update()),this.projection.pixelRatio=this.pixelRatio,this.projection.viewBounds=n,this.projection.viewBounds.d=this,this.projection.screenBounds=new we({height:this.projection.viewBounds.height/this.pixelRatio,width:this.projection.viewBounds.width/this.pixelRatio,x:this.projection.viewBounds.x/this.pixelRatio,y:this.projection.viewBounds.y/this.pixelRatio}),this.projection.screenBounds.d=this}}willUpdateProps(e){this.projection.camera=e.camera}}Kp.defaultProps={key:"",camera:new Qn({type:Hn.PERSPECTIVE,width:100,height:100,fov:Math.PI/2,far:1e5,near:1}),viewport:{left:0,right:0,bottom:0,top:0}};var Zp=(t=>(t[t.XY=0]="XY",t[t.XZ=1]="XZ",t[t.YZ=2]="YZ",t))(Zp||{});function Gw(t,e,n){if(!(e===nt||e.prototype instanceof nt))return console.warn("A Layer type was specified for createLayer2din3D that is NOT a Layer2D type, which is invalid.","The layer will be used without being modified."),qr(e,n);let i;switch(t){case 0:i="world2DXY";break;case 1:i="world2DXZ";break;case 2:i="world2DYZ";break;default:return qr(e,n)}const s=Object.assign({},n,{baseShaderModules:(a,o)=>{let c=o.vs.indexOf("world2D");return c>=0&&o.vs.splice(c,1,i),c=o.fs.indexOf("world2D"),c>=0&&o.fs.splice(c,1,i),o}});return qr(e,s)}class Jp extends Sn{baseShaderModules(e){const n=super.baseShaderModules(e);return n.vs.push("parent-transform"),n}}const zw=`
When working with SceneGraphLayers, the
layer can have a transform applied to
the layer. This makes that transform
available in the parentTransform
constant.

mat4 parentTransform;
`;Qe.register({moduleId:"parent-transform",description:zw,compatibility:P.VERTEX,content:"",uniforms:t=>{const e=t;if(!(e instanceof Jp))return console.warn("A shader requested the module parent-transform; however, the layer the","shader is generated from is NOT a SceneGraphLayer which is","required for the module to work."),[];const n=Me();return[{name:"parentTransform",size:L.MATRIX4,update:()=>{var r;return((r=e.props.parent)==null?void 0:r.matrix)||n}}]}});var Vw=Object.defineProperty,$w=Object.getOwnPropertyDescriptor,Cr=(t,e,n,r)=>{for(var i=r>1?void 0:r?$w(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(r?a(e,n,i):a(i))||i);return r&&i&&Vw(e,n,i),i};const eu=class extends dt{constructor(t){super(t),this.needsLocalUpdate=!1,this.needsWorldUpdate=!1,vt(this,eu);const e=t.transform||new Fa;this.transform=e,t.parent&&(t.parent instanceof eu?this.parent=t.parent:this.transform.parent=t.parent)}get transform(){return this._transform}set transform(t){this._transform||(this._position=t.position,this._rotation=t.rotation,this._scale=t.scale,this._localPosition=t.localPosition,this._localRotation=t.localRotation,this._localScale=t.localScale,this._matrix=t.matrix,this._localMatrix=t.localMatrix),t.instance=this,this._transform=t}get matrix(){return this._transform.update(),this._matrix}get localMatrix(){return this._transform.update(),this._localMatrix}get localPosition(){return this.needsLocalUpdate=!0,this._localPosition}set localPosition(t){this.transform.localPosition=t}get localRotation(){return this.needsLocalUpdate=!0,this._localRotation}set localRotation(t){this.transform.localRotation=t}get localScale(){return this.needsLocalUpdate=!0,this._localScale}set localScale(t){this.transform.localScale=t}get position(){return this.needsWorldUpdate=!0,this.transform.update(),this._position}set position(t){this.transform.position=t}get rotation(){return this.needsWorldUpdate=!0,this.transform.update(),this._rotation}set rotation(t){this.transform.rotation=t}get scale(){return this.needsWorldUpdate=!0,this.transform.update(),this._scale}set scale(t){this.transform.scale=t}set parent(t){this.transform.parent=t.transform}optimize(){this.needsWorldUpdate=!1,this.needsLocalUpdate=!1,this.transform.optimize()}};let Dn=eu;Cr([B],Dn.prototype,"_matrix",2),Cr([B],Dn.prototype,"_localMatrix",2),Cr([B],Dn.prototype,"_localPosition",2),Cr([B],Dn.prototype,"_localRotation",2),Cr([B],Dn.prototype,"_localScale",2),Cr([B],Dn.prototype,"_position",2),Cr([B],Dn.prototype,"_rotation",2),Cr([B],Dn.prototype,"_scale",2);class Ww extends Tl{constructor(){super(...arguments),this.isQueuedForUpdate=!1,this.needsWorldOrientation=!1,this.needsWorldDecomposition=!1,this._instance=null,this._matrix={value:Me()},this._localMatrix={value:this._matrix.value},this._position={value:[0,0,0]},this._localPosition={value:this._position.value},this._rotation={value:Es()},this._localRotation={value:0},this.localRotationMatrix=gs(),this._scale={value:[1,1,1]},this._localScale={value:this._scale.value}}set instance(e){this._instance!==e&&this._instance&&(this._instance.transform.instance=null,e&&(e.transform=this)),this._instance=e}get matrix(){return this.update(),this._matrix.value}get position(){return this.needsWorldOrientation=!0,this.update(),this._position.value}set position(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world position is not supported yet. Use localPosition for now."):this.localPosition=e}get localPosition(){return this._localPosition.value}set localPosition(e){this._localPosition.value[0]=e[0],this._localPosition.value[1]=e[1],this._localPosition.didUpdate=!0,this.invalidate()}get rotation(){return this.needsWorldOrientation=!0,this.update(),this._rotation.value}set rotation(e){console.warn("NOT IMPLEMENTED: Setting world rotation for a 2D transform is not supported yet.")}get localRotation(){return this._localRotation.value}set localRotation(e){this._localRotation.value=e,this._localRotation.didUpdate=!0,this.invalidate()}get scale(){return this.needsWorldOrientation=!0,this.update(),this._scale.value}set scale(e){this.parent?console.warn("NOT IMPLEMENTED: Setting world scale is not supported yet. Use localScale for now."):this.localScale=e}get localScale(){return this._localScale.value}set localScale(e){Ce(this._localScale.value,e[0],e[1]),this._localScale.didUpdate=!0,this.invalidate()}decomposeWorldMatrix(){if(!this.parent||!this.needsWorldDecomposition||!this.needsWorldOrientation)return;this.needsWorldDecomposition=!1;const e=this._matrix.value,n=this._position.value,r=this._scale.value;this._position.didUpdate=n[0]!==e[12]||n[1]!==e[13]||n[2]!==e[14],this._position.didUpdate&&Ne(n,e[12],e[13],e[14]);const i=Gn(e[0],e[1],e[2],e[3]),s=Gn(e[4],e[5],e[6],e[7]),a=Gn(e[8],e[9],e[10],e[11]);this._scale.didUpdate=r[0]!==i||r[1]!==s||r[2]!==a,Ne(r,i,s,a),this._scale.didUpdate=!0;const[o,c,l,u]=this._rotation.value;Oa(this._matrix.value,i,s,a,this._rotation.value);const h=this._rotation.value;this._rotation.didUpdate=h[0]!==o||h[1]!==c||h[2]!==l||h[3]!==u}queueForUpdate(){!this.isQueuedForUpdate&&this._instance&&this._instance.active&&(this.isQueuedForUpdate=!0,yl(this))}update(e){let n=!1;if(this.isQueuedForUpdate&&(wl(this),this.isQueuedForUpdate=!1),this.needsUpdate){const r=this.localRotationMatrix;this._localRotation.didUpdate&&Zc(this._localRotation.value,r),al(this._localScale.value,r,this._localPosition.value,this._localMatrix.value),this._localMatrix.didUpdate=!0,n=!0}this.parent&&(this.parent.needsUpdate?(e||this.processParentUpdates(r=>{r.update(!0)}),n=!0):this.parent.childUpdate.has(this)&&(n=!0),n&&(It(this.parent._matrix.value,this._localMatrix.value,this._matrix.value),this._matrix.didUpdate=!0,this.needsWorldDecomposition=!0)),this.decomposeWorldMatrix(),this._instance&&this._instance.active&&(this._localRotation.didUpdate&&(this._instance._localRotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._localPosition=this._localPosition.value),this._localScale.didUpdate&&(this._instance._localScale=this._localScale.value),this.parent?(this._rotation.didUpdate&&(this._instance._rotation=this._rotation.value),this._scale.didUpdate&&(this._instance._scale=this._scale.value),this._position.didUpdate&&(this._instance._position=this._position.value)):(this._localRotation.didUpdate&&(this._instance._rotation=this._localRotation.value),this._localPosition.didUpdate&&(this._instance._position=this._localPosition.value),this._localScale.didUpdate&&(this._instance._scale=this._localScale.value)),(this._matrix.didUpdate||this._localMatrix.didUpdate)&&(this._instance.transform=this)),this._localScale.didUpdate=!1,this._localRotation.didUpdate=!1,this._localPosition.didUpdate=!1,this._rotation.didUpdate=!1,this._scale.didUpdate=!1,this._position.didUpdate=!1,this._matrix.didUpdate=!1,this._localMatrix.didUpdate=!1,this.resolve()}}const jw=`varying vec2 _texCoord;
void main() {
gl_FragColor = mix(
vec4(1.0, 0.0, 0.0, 1.0),
vec4(0.0, 0.0, 0.0, 1.0),
float(_texCoord.x <= 0.01 || _texCoord.x > 0.99 || _texCoord.y < 0.01 || _texCoord.y > 0.99)
);
}`,Hw=`\${import: projection}
varying vec2 _texCoord;
void main() {
vec4 pos = vec4(position * size, 1.0);
vec4 world = transform * pos;
_texCoord = texCoord;
gl_Position = clipSpace(world.xyz);
}`;class eg extends Sn{initShader(){const e=[1,1,1],n=[1,1,-1],r=[1,-1,-1],i=[1,-1,1],s=[-1,1,1],a=[-1,1,-1],o=[-1,-1,-1],c=[-1,-1,1],l=[e,n,r,e,r,i,s,e,i,s,i,c,s,o,a,s,c,o,a,r,n,a,o,r,s,n,e,s,a,n,c,i,r,c,r,o],u=[1,0,0],h=[0,0,1],f=[-1,0,0],p=[0,0,-1],m=[0,1,0],v=[0,-1,0],b=[u,u,u,u,u,u,h,h,h,h,h,h,f,f,f,f,f,f,p,p,p,p,p,p,m,m,m,m,m,m,v,v,v,v,v,v],T=[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1],[0,0],[1,0],[1,1],[0,0],[1,1],[0,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,1],[1,0],[0,0],[0,1],[1,1],[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]];return{drawMode:d.GLSettings.Model.DrawMode.TRIANGLES,fs:[{outputType:oe.COLOR,source:jw}],instanceAttributes:[{name:"transform",size:k.MAT4X4,update:E=>(E.transform||cf).matrix},{name:"size",size:k.THREE,update:E=>E.size}],uniforms:[],vertexAttributes:[{name:"position",size:ct.THREE,update:E=>l[E]},{name:"normal",size:ct.THREE,update:E=>b[E]},{name:"texCoord",size:ct.TWO,update:E=>T[E]}],vertexCount:36,vs:Hw}}getMaterialOptions(){return Object.assign({},At.transparentShapeBlending,{cullSide:d.GLSettings.Material.CullSide.CCW})}}eg.defaultProps={data:new Oe,key:"",materialOptions:At.transparentShapeBlending};var Qw=Object.defineProperty,Xw=Object.getOwnPropertyDescriptor,tg=(t,e,n,r)=>{for(var i=r>1?void 0:r?Xw(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(r?a(e,n,i):a(i))||i);return r&&i&&Qw(e,n,i),i};const ng=class extends Dn{constructor(t){super(t),this.size=[1,1,1],this.color=[1,1,1,1],vt(this,ng),this.size=t.size||this.size,this.color=t.color||this.color}};let tu=ng;tg([B],tu.prototype,"size",2),tg([B],tu.prototype,"color",2);var nu={exports:{}},ks={},ru={exports:{}},de={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rg;function Yw(){if(rg)return de;rg=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function f(_){return _===null||typeof _!="object"?null:(_=h&&_[h]||_["@@iterator"],typeof _=="function"?_:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,v={};function b(_,M,J){this.props=_,this.context=M,this.refs=v,this.updater=J||p}b.prototype.isReactComponent={},b.prototype.setState=function(_,M){if(typeof _!="object"&&typeof _!="function"&&_!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,_,M,"setState")},b.prototype.forceUpdate=function(_){this.updater.enqueueForceUpdate(this,_,"forceUpdate")};function T(){}T.prototype=b.prototype;function E(_,M,J){this.props=_,this.context=M,this.refs=v,this.updater=J||p}var S=E.prototype=new T;S.constructor=E,m(S,b.prototype),S.isPureReactComponent=!0;var I=Array.isArray,x=Object.prototype.hasOwnProperty,D={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function O(_,M,J){var le,se={},ge=null,Te=null;if(M!=null)for(le in M.ref!==void 0&&(Te=M.ref),M.key!==void 0&&(ge=""+M.key),M)x.call(M,le)&&!N.hasOwnProperty(le)&&(se[le]=M[le]);var be=arguments.length-2;if(be===1)se.children=J;else if(1<be){for(var ye=Array(be),et=0;et<be;et++)ye[et]=arguments[et+2];se.children=ye}if(_&&_.defaultProps)for(le in be=_.defaultProps,be)se[le]===void 0&&(se[le]=be[le]);return{$$typeof:t,type:_,key:ge,ref:Te,props:se,_owner:D.current}}function te(_,M){return{$$typeof:t,type:_.type,key:M,ref:_.ref,props:_.props,_owner:_._owner}}function ne(_){return typeof _=="object"&&_!==null&&_.$$typeof===t}function V(_){var M={"=":"=0",":":"=2"};return"$"+_.replace(/[=:]/g,function(J){return M[J]})}var re=/\/+/g;function K(_,M){return typeof _=="object"&&_!==null&&_.key!=null?V(""+_.key):M.toString(36)}function Z(_,M,J,le,se){var ge=typeof _;(ge==="undefined"||ge==="boolean")&&(_=null);var Te=!1;if(_===null)Te=!0;else switch(ge){case"string":case"number":Te=!0;break;case"object":switch(_.$$typeof){case t:case e:Te=!0}}if(Te)return Te=_,se=se(Te),_=le===""?"."+K(Te,0):le,I(se)?(J="",_!=null&&(J=_.replace(re,"$&/")+"/"),Z(se,M,J,"",function(et){return et})):se!=null&&(ne(se)&&(se=te(se,J+(!se.key||Te&&Te.key===se.key?"":(""+se.key).replace(re,"$&/")+"/")+_)),M.push(se)),1;if(Te=0,le=le===""?".":le+":",I(_))for(var be=0;be<_.length;be++){ge=_[be];var ye=le+K(ge,be);Te+=Z(ge,M,J,ye,se)}else if(ye=f(_),typeof ye=="function")for(_=ye.call(_),be=0;!(ge=_.next()).done;)ge=ge.value,ye=le+K(ge,be++),Te+=Z(ge,M,J,ye,se);else if(ge==="object")throw M=String(_),Error("Objects are not valid as a React child (found: "+(M==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":M)+"). If you meant to render a collection of children, use an array instead.");return Te}function ce(_,M,J){if(_==null)return _;var le=[],se=0;return Z(_,le,"","",function(ge){return M.call(J,ge,se++)}),le}function q(_){if(_._status===-1){var M=_._result;M=M(),M.then(function(J){(_._status===0||_._status===-1)&&(_._status=1,_._result=J)},function(J){(_._status===0||_._status===-1)&&(_._status=2,_._result=J)}),_._status===-1&&(_._status=0,_._result=M)}if(_._status===1)return _._result.default;throw _._result}var G={current:null},ie={transition:null},De={ReactCurrentDispatcher:G,ReactCurrentBatchConfig:ie,ReactCurrentOwner:D};return de.Children={map:ce,forEach:function(_,M,J){ce(_,function(){M.apply(this,arguments)},J)},count:function(_){var M=0;return ce(_,function(){M++}),M},toArray:function(_){return ce(_,function(M){return M})||[]},only:function(_){if(!ne(_))throw Error("React.Children.only expected to receive a single React element child.");return _}},de.Component=b,de.Fragment=n,de.Profiler=i,de.PureComponent=E,de.StrictMode=r,de.Suspense=c,de.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=De,de.cloneElement=function(_,M,J){if(_==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+_+".");var le=m({},_.props),se=_.key,ge=_.ref,Te=_._owner;if(M!=null){if(M.ref!==void 0&&(ge=M.ref,Te=D.current),M.key!==void 0&&(se=""+M.key),_.type&&_.type.defaultProps)var be=_.type.defaultProps;for(ye in M)x.call(M,ye)&&!N.hasOwnProperty(ye)&&(le[ye]=M[ye]===void 0&&be!==void 0?be[ye]:M[ye])}var ye=arguments.length-2;if(ye===1)le.children=J;else if(1<ye){be=Array(ye);for(var et=0;et<ye;et++)be[et]=arguments[et+2];le.children=be}return{$$typeof:t,type:_.type,key:se,ref:ge,props:le,_owner:Te}},de.createContext=function(_){return _={$$typeof:a,_currentValue:_,_currentValue2:_,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},_.Provider={$$typeof:s,_context:_},_.Consumer=_},de.createElement=O,de.createFactory=function(_){var M=O.bind(null,_);return M.type=_,M},de.createRef=function(){return{current:null}},de.forwardRef=function(_){return{$$typeof:o,render:_}},de.isValidElement=ne,de.lazy=function(_){return{$$typeof:u,_payload:{_status:-1,_result:_},_init:q}},de.memo=function(_,M){return{$$typeof:l,type:_,compare:M===void 0?null:M}},de.startTransition=function(_){var M=ie.transition;ie.transition={};try{_()}finally{ie.transition=M}},de.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},de.useCallback=function(_,M){return G.current.useCallback(_,M)},de.useContext=function(_){return G.current.useContext(_)},de.useDebugValue=function(){},de.useDeferredValue=function(_){return G.current.useDeferredValue(_)},de.useEffect=function(_,M){return G.current.useEffect(_,M)},de.useId=function(){return G.current.useId()},de.useImperativeHandle=function(_,M,J){return G.current.useImperativeHandle(_,M,J)},de.useInsertionEffect=function(_,M){return G.current.useInsertionEffect(_,M)},de.useLayoutEffect=function(_,M){return G.current.useLayoutEffect(_,M)},de.useMemo=function(_,M){return G.current.useMemo(_,M)},de.useReducer=function(_,M,J){return G.current.useReducer(_,M,J)},de.useRef=function(_){return G.current.useRef(_)},de.useState=function(_){return G.current.useState(_)},de.useSyncExternalStore=function(_,M,J){return G.current.useSyncExternalStore(_,M,J)},de.useTransition=function(){return G.current.useTransition()},de.version="18.2.0",de}var Gs={exports:{}};/**
 * @license React
 * react.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */Gs.exports;var ig;function qw(){return ig||(ig=1,function(t,e){process.env.NODE_ENV!=="production"&&function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var n="18.2.0",r=Symbol.for("react.element"),i=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),v=Symbol.for("react.offscreen"),b=Symbol.iterator,T="@@iterator";function E(g){if(g===null||typeof g!="object")return null;var y=b&&g[b]||g[T];return typeof y=="function"?y:null}var S={current:null},I={transition:null},x={current:null,isBatchingLegacy:!1,didScheduleLegacyUpdate:!1},D={current:null},N={},O=null;function te(g){O=g}N.setExtraStackFrame=function(g){O=g},N.getCurrentStack=null,N.getStackAddendum=function(){var g="";O&&(g+=O);var y=N.getCurrentStack;return y&&(g+=y()||""),g};var ne=!1,V=!1,re=!1,K=!1,Z=!1,ce={ReactCurrentDispatcher:S,ReactCurrentBatchConfig:I,ReactCurrentOwner:D};ce.ReactDebugCurrentFrame=N,ce.ReactCurrentActQueue=x;function q(g){{for(var y=arguments.length,R=new Array(y>1?y-1:0),A=1;A<y;A++)R[A-1]=arguments[A];ie("warn",g,R)}}function G(g){{for(var y=arguments.length,R=new Array(y>1?y-1:0),A=1;A<y;A++)R[A-1]=arguments[A];ie("error",g,R)}}function ie(g,y,R){{var A=ce.ReactDebugCurrentFrame,F=A.getStackAddendum();F!==""&&(y+="%s",R=R.concat([F]));var ee=R.map(function(j){return String(j)});ee.unshift("Warning: "+y),Function.prototype.apply.call(console[g],console,ee)}}var De={};function _(g,y){{var R=g.constructor,A=R&&(R.displayName||R.name)||"ReactClass",F=A+"."+y;if(De[F])return;G("Can't call %s on a component that is not yet mounted. This is a no-op, but it might indicate a bug in your application. Instead, assign to `this.state` directly or define a `state = {};` class property with the desired state in the %s component.",y,A),De[F]=!0}}var M={isMounted:function(g){return!1},enqueueForceUpdate:function(g,y,R){_(g,"forceUpdate")},enqueueReplaceState:function(g,y,R,A){_(g,"replaceState")},enqueueSetState:function(g,y,R,A){_(g,"setState")}},J=Object.assign,le={};Object.freeze(le);function se(g,y,R){this.props=g,this.context=y,this.refs=le,this.updater=R||M}se.prototype.isReactComponent={},se.prototype.setState=function(g,y){if(typeof g!="object"&&typeof g!="function"&&g!=null)throw new Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,g,y,"setState")},se.prototype.forceUpdate=function(g){this.updater.enqueueForceUpdate(this,g,"forceUpdate")};{var ge={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see https://github.com/facebook/react/issues/3236)."]},Te=function(g,y){Object.defineProperty(se.prototype,g,{get:function(){q("%s(...) is deprecated in plain JavaScript React classes. %s",y[0],y[1])}})};for(var be in ge)ge.hasOwnProperty(be)&&Te(be,ge[be])}function ye(){}ye.prototype=se.prototype;function et(g,y,R){this.props=g,this.context=y,this.refs=le,this.updater=R||M}var Or=et.prototype=new ye;Or.constructor=et,J(Or,se.prototype),Or.isPureReactComponent=!0;function cu(){var g={current:null};return Object.seal(g),g}var co=Array.isArray;function Gi(g){return co(g)}function lu(g){{var y=typeof Symbol=="function"&&Symbol.toStringTag,R=y&&g[Symbol.toStringTag]||g.constructor.name||"Object";return R}}function zi(g){try{return ci(g),!1}catch{return!0}}function ci(g){return""+g}function li(g){if(zi(g))return G("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",lu(g)),ci(g)}function lo(g,y,R){var A=g.displayName;if(A)return A;var F=y.displayName||y.name||"";return F!==""?R+"("+F+")":R}function ui(g){return g.displayName||"Context"}function Un(g){if(g==null)return null;if(typeof g.tag=="number"&&G("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g;switch(g){case s:return"Fragment";case i:return"Portal";case o:return"Profiler";case a:return"StrictMode";case h:return"Suspense";case f:return"SuspenseList"}if(typeof g=="object")switch(g.$$typeof){case l:var y=g;return ui(y)+".Consumer";case c:var R=g;return ui(R._context)+".Provider";case u:return lo(g,g.render,"ForwardRef");case p:var A=g.displayName||null;return A!==null?A:Un(g.type)||"Memo";case m:{var F=g,ee=F._payload,j=F._init;try{return Un(j(ee))}catch{return null}}}return null}var hi=Object.prototype.hasOwnProperty,Vi={key:!0,ref:!0,__self:!0,__source:!0},uo,ho,$i;$i={};function Vs(g){if(hi.call(g,"ref")){var y=Object.getOwnPropertyDescriptor(g,"ref").get;if(y&&y.isReactWarning)return!1}return g.ref!==void 0}function Nr(g){if(hi.call(g,"key")){var y=Object.getOwnPropertyDescriptor(g,"key").get;if(y&&y.isReactWarning)return!1}return g.key!==void 0}function uu(g,y){var R=function(){uo||(uo=!0,G("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",y))};R.isReactWarning=!0,Object.defineProperty(g,"key",{get:R,configurable:!0})}function fo(g,y){var R=function(){ho||(ho=!0,G("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",y))};R.isReactWarning=!0,Object.defineProperty(g,"ref",{get:R,configurable:!0})}function po(g){if(typeof g.ref=="string"&&D.current&&g.__self&&D.current.stateNode!==g.__self){var y=Un(D.current.type);$i[y]||(G('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',y,g.ref),$i[y]=!0)}}var di=function(g,y,R,A,F,ee,j){var ae={$$typeof:r,type:g,key:y,ref:R,props:j,_owner:ee};return ae._store={},Object.defineProperty(ae._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(ae,"_self",{configurable:!1,enumerable:!1,writable:!1,value:A}),Object.defineProperty(ae,"_source",{configurable:!1,enumerable:!1,writable:!1,value:F}),Object.freeze&&(Object.freeze(ae.props),Object.freeze(ae)),ae};function hu(g,y,R){var A,F={},ee=null,j=null,ae=null,me=null;if(y!=null){Vs(y)&&(j=y.ref,po(y)),Nr(y)&&(li(y.key),ee=""+y.key),ae=y.__self===void 0?null:y.__self,me=y.__source===void 0?null:y.__source;for(A in y)hi.call(y,A)&&!Vi.hasOwnProperty(A)&&(F[A]=y[A])}var Se=arguments.length-2;if(Se===1)F.children=R;else if(Se>1){for(var Fe=Array(Se),Be=0;Be<Se;Be++)Fe[Be]=arguments[Be+2];Object.freeze&&Object.freeze(Fe),F.children=Fe}if(g&&g.defaultProps){var $e=g.defaultProps;for(A in $e)F[A]===void 0&&(F[A]=$e[A])}if(ee||j){var Ze=typeof g=="function"?g.displayName||g.name||"Unknown":g;ee&&uu(F,Ze),j&&fo(F,Ze)}return di(g,ee,j,ae,me,D.current,F)}function du(g,y){var R=di(g.type,y,g.ref,g._self,g._source,g._owner,g.props);return R}function fu(g,y,R){if(g==null)throw new Error("React.cloneElement(...): The argument must be a React element, but you passed "+g+".");var A,F=J({},g.props),ee=g.key,j=g.ref,ae=g._self,me=g._source,Se=g._owner;if(y!=null){Vs(y)&&(j=y.ref,Se=D.current),Nr(y)&&(li(y.key),ee=""+y.key);var Fe;g.type&&g.type.defaultProps&&(Fe=g.type.defaultProps);for(A in y)hi.call(y,A)&&!Vi.hasOwnProperty(A)&&(y[A]===void 0&&Fe!==void 0?F[A]=Fe[A]:F[A]=y[A])}var Be=arguments.length-2;if(Be===1)F.children=R;else if(Be>1){for(var $e=Array(Be),Ze=0;Ze<Be;Ze++)$e[Ze]=arguments[Ze+2];F.children=$e}return di(g.type,ee,j,ae,me,Se,F)}function Pr(g){return typeof g=="object"&&g!==null&&g.$$typeof===r}var go=".",pu=":";function gu(g){var y=/[=:]/g,R={"=":"=0",":":"=2"},A=g.replace(y,function(F){return R[F]});return"$"+A}var Wi=!1,mo=/\/+/g;function ar(g){return g.replace(mo,"$&/")}function fi(g,y){return typeof g=="object"&&g!==null&&g.key!=null?(li(g.key),gu(""+g.key)):y.toString(36)}function Dr(g,y,R,A,F){var ee=typeof g;(ee==="undefined"||ee==="boolean")&&(g=null);var j=!1;if(g===null)j=!0;else switch(ee){case"string":case"number":j=!0;break;case"object":switch(g.$$typeof){case r:case i:j=!0}}if(j){var ae=g,me=F(ae),Se=A===""?go+fi(ae,0):A;if(Gi(me)){var Fe="";Se!=null&&(Fe=ar(Se)+"/"),Dr(me,y,Fe,"",function(V1){return V1})}else me!=null&&(Pr(me)&&(me.key&&(!ae||ae.key!==me.key)&&li(me.key),me=du(me,R+(me.key&&(!ae||ae.key!==me.key)?ar(""+me.key)+"/":"")+Se)),y.push(me));return 1}var Be,$e,Ze=0,at=A===""?go:A+pu;if(Gi(g))for(var xo=0;xo<g.length;xo++)Be=g[xo],$e=at+fi(Be,xo),Ze+=Dr(Be,y,R,$e,F);else{var Iu=E(g);if(typeof Iu=="function"){var Ug=g;Iu===Ug.entries&&(Wi||q("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),Wi=!0);for(var G1=Iu.call(Ug),kg,z1=0;!(kg=G1.next()).done;)Be=kg.value,$e=at+fi(Be,z1++),Ze+=Dr(Be,y,R,$e,F)}else if(ee==="object"){var Gg=String(g);throw new Error("Objects are not valid as a React child (found: "+(Gg==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":Gg)+"). If you meant to render a collection of children, use an array instead.")}}return Ze}function pi(g,y,R){if(g==null)return g;var A=[],F=0;return Dr(g,A,"","",function(ee){return y.call(R,ee,F++)}),A}function mu(g){var y=0;return pi(g,function(){y++}),y}function vo(g,y,R){pi(g,function(){y.apply(this,arguments)},R)}function vu(g){return pi(g,function(y){return y})||[]}function yo(g){if(!Pr(g))throw new Error("React.Children.only expected to receive a single React element child.");return g}function wo(g){var y={$$typeof:l,_currentValue:g,_currentValue2:g,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null};y.Provider={$$typeof:c,_context:y};var R=!1,A=!1,F=!1;{var ee={$$typeof:l,_context:y};Object.defineProperties(ee,{Provider:{get:function(){return A||(A=!0,G("Rendering <Context.Consumer.Provider> is not supported and will be removed in a future major release. Did you mean to render <Context.Provider> instead?")),y.Provider},set:function(j){y.Provider=j}},_currentValue:{get:function(){return y._currentValue},set:function(j){y._currentValue=j}},_currentValue2:{get:function(){return y._currentValue2},set:function(j){y._currentValue2=j}},_threadCount:{get:function(){return y._threadCount},set:function(j){y._threadCount=j}},Consumer:{get:function(){return R||(R=!0,G("Rendering <Context.Consumer.Consumer> is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?")),y.Consumer}},displayName:{get:function(){return y.displayName},set:function(j){F||(q("Setting `displayName` on Context.Consumer has no effect. You should set it directly on the context with Context.displayName = '%s'.",j),F=!0)}}}),y.Consumer=ee}return y._currentRenderer=null,y._currentRenderer2=null,y}var gi=-1,$s=0,Ws=1,yu=2;function wu(g){if(g._status===gi){var y=g._result,R=y();if(R.then(function(ee){if(g._status===$s||g._status===gi){var j=g;j._status=Ws,j._result=ee}},function(ee){if(g._status===$s||g._status===gi){var j=g;j._status=yu,j._result=ee}}),g._status===gi){var A=g;A._status=$s,A._result=R}}if(g._status===Ws){var F=g._result;return F===void 0&&G(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))

Did you accidentally put curly braces around the import?`,F),"default"in F||G(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))`,F),F.default}else throw g._result}function Tu(g){var y={_status:gi,_result:g},R={$$typeof:m,_payload:y,_init:wu};{var A,F;Object.defineProperties(R,{defaultProps:{configurable:!0,get:function(){return A},set:function(ee){G("React.lazy(...): It is not supported to assign `defaultProps` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),A=ee,Object.defineProperty(R,"defaultProps",{enumerable:!0})}},propTypes:{configurable:!0,get:function(){return F},set:function(ee){G("React.lazy(...): It is not supported to assign `propTypes` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),F=ee,Object.defineProperty(R,"propTypes",{enumerable:!0})}}})}return R}function bu(g){g!=null&&g.$$typeof===p?G("forwardRef requires a render function but received a `memo` component. Instead of forwardRef(memo(...)), use memo(forwardRef(...))."):typeof g!="function"?G("forwardRef requires a render function but was given %s.",g===null?"null":typeof g):g.length!==0&&g.length!==2&&G("forwardRef render functions accept exactly two parameters: props and ref. %s",g.length===1?"Did you forget to use the ref parameter?":"Any additional parameter will be undefined."),g!=null&&(g.defaultProps!=null||g.propTypes!=null)&&G("forwardRef render functions do not support propTypes or defaultProps. Did you accidentally pass a React component?");var y={$$typeof:u,render:g};{var R;Object.defineProperty(y,"displayName",{enumerable:!1,configurable:!0,get:function(){return R},set:function(A){R=A,!g.name&&!g.displayName&&(g.displayName=A)}})}return y}var w;w=Symbol.for("react.module.reference");function C(g){return!!(typeof g=="string"||typeof g=="function"||g===s||g===o||Z||g===a||g===h||g===f||K||g===v||ne||V||re||typeof g=="object"&&g!==null&&(g.$$typeof===m||g.$$typeof===p||g.$$typeof===c||g.$$typeof===l||g.$$typeof===u||g.$$typeof===w||g.getModuleId!==void 0))}function z(g,y){C(g)||G("memo: The first argument must be a component. Instead received: %s",g===null?"null":typeof g);var R={$$typeof:p,type:g,compare:y===void 0?null:y};{var A;Object.defineProperty(R,"displayName",{enumerable:!1,configurable:!0,get:function(){return A},set:function(F){A=F,!g.name&&!g.displayName&&(g.displayName=F)}})}return R}function W(){var g=S.current;return g===null&&G(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.`),g}function ve(g){var y=W();if(g._context!==void 0){var R=g._context;R.Consumer===g?G("Calling useContext(Context.Consumer) is not supported, may cause bugs, and will be removed in a future major release. Did you mean to call useContext(Context) instead?"):R.Provider===g&&G("Calling useContext(Context.Provider) is not supported. Did you mean to call useContext(Context) instead?")}return y.useContext(g)}function Ee(g){var y=W();return y.useState(g)}function fe(g,y,R){var A=W();return A.useReducer(g,y,R)}function he(g){var y=W();return y.useRef(g)}function st(g,y){var R=W();return R.useEffect(g,y)}function Ve(g,y){var R=W();return R.useInsertionEffect(g,y)}function We(g,y){var R=W();return R.useLayoutEffect(g,y)}function St(g,y){var R=W();return R.useCallback(g,y)}function Fr(g,y){var R=W();return R.useMemo(g,y)}function To(g,y,R){var A=W();return A.useImperativeHandle(g,y,R)}function $t(g,y){{var R=W();return R.useDebugValue(g,y)}}function v1(){var g=W();return g.useTransition()}function y1(g){var y=W();return y.useDeferredValue(g)}function w1(){var g=W();return g.useId()}function T1(g,y,R){var A=W();return A.useSyncExternalStore(g,y,R)}var js=0,yg,wg,Tg,bg,Eg,_g,Rg;function Ag(){}Ag.__reactDisabledLog=!0;function b1(){{if(js===0){yg=console.log,wg=console.info,Tg=console.warn,bg=console.error,Eg=console.group,_g=console.groupCollapsed,Rg=console.groupEnd;var g={configurable:!0,enumerable:!0,value:Ag,writable:!0};Object.defineProperties(console,{info:g,log:g,warn:g,error:g,group:g,groupCollapsed:g,groupEnd:g})}js++}}function E1(){{if(js--,js===0){var g={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:J({},g,{value:yg}),info:J({},g,{value:wg}),warn:J({},g,{value:Tg}),error:J({},g,{value:bg}),group:J({},g,{value:Eg}),groupCollapsed:J({},g,{value:_g}),groupEnd:J({},g,{value:Rg})})}js<0&&G("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Eu=ce.ReactCurrentDispatcher,_u;function bo(g,y,R){{if(_u===void 0)try{throw Error()}catch(F){var A=F.stack.trim().match(/\n( *(at )?)/);_u=A&&A[1]||""}return`
`+_u+g}}var Ru=!1,Eo;{var _1=typeof WeakMap=="function"?WeakMap:Map;Eo=new _1}function Sg(g,y){if(!g||Ru)return"";{var R=Eo.get(g);if(R!==void 0)return R}var A;Ru=!0;var F=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var ee;ee=Eu.current,Eu.current=null,b1();try{if(y){var j=function(){throw Error()};if(Object.defineProperty(j.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(j,[])}catch(at){A=at}Reflect.construct(g,[],j)}else{try{j.call()}catch(at){A=at}g.call(j.prototype)}}else{try{throw Error()}catch(at){A=at}g()}}catch(at){if(at&&A&&typeof at.stack=="string"){for(var ae=at.stack.split(`
`),me=A.stack.split(`
`),Se=ae.length-1,Fe=me.length-1;Se>=1&&Fe>=0&&ae[Se]!==me[Fe];)Fe--;for(;Se>=1&&Fe>=0;Se--,Fe--)if(ae[Se]!==me[Fe]){if(Se!==1||Fe!==1)do if(Se--,Fe--,Fe<0||ae[Se]!==me[Fe]){var Be=`
`+ae[Se].replace(" at new "," at ");return g.displayName&&Be.includes("<anonymous>")&&(Be=Be.replace("<anonymous>",g.displayName)),typeof g=="function"&&Eo.set(g,Be),Be}while(Se>=1&&Fe>=0);break}}}finally{Ru=!1,Eu.current=ee,E1(),Error.prepareStackTrace=F}var $e=g?g.displayName||g.name:"",Ze=$e?bo($e):"";return typeof g=="function"&&Eo.set(g,Ze),Ze}function R1(g,y,R){return Sg(g,!1)}function A1(g){var y=g.prototype;return!!(y&&y.isReactComponent)}function _o(g,y,R){if(g==null)return"";if(typeof g=="function")return Sg(g,A1(g));if(typeof g=="string")return bo(g);switch(g){case h:return bo("Suspense");case f:return bo("SuspenseList")}if(typeof g=="object")switch(g.$$typeof){case u:return R1(g.render);case p:return _o(g.type,y,R);case m:{var A=g,F=A._payload,ee=A._init;try{return _o(ee(F),y,R)}catch{}}}return""}var xg={},Mg=ce.ReactDebugCurrentFrame;function Ro(g){if(g){var y=g._owner,R=_o(g.type,g._source,y?y.type:null);Mg.setExtraStackFrame(R)}else Mg.setExtraStackFrame(null)}function S1(g,y,R,A,F){{var ee=Function.call.bind(hi);for(var j in g)if(ee(g,j)){var ae=void 0;try{if(typeof g[j]!="function"){var me=Error((A||"React class")+": "+R+" type `"+j+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof g[j]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw me.name="Invariant Violation",me}ae=g[j](y,j,A,R,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(Se){ae=Se}ae&&!(ae instanceof Error)&&(Ro(F),G("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",A||"React class",R,j,typeof ae),Ro(null)),ae instanceof Error&&!(ae.message in xg)&&(xg[ae.message]=!0,Ro(F),G("Failed %s type: %s",R,ae.message),Ro(null))}}}function ji(g){if(g){var y=g._owner,R=_o(g.type,g._source,y?y.type:null);te(R)}else te(null)}var Au;Au=!1;function Ig(){if(D.current){var g=Un(D.current.type);if(g)return`

Check the render method of \``+g+"`."}return""}function x1(g){if(g!==void 0){var y=g.fileName.replace(/^.*[\\\/]/,""),R=g.lineNumber;return`

Check your code at `+y+":"+R+"."}return""}function M1(g){return g!=null?x1(g.__source):""}var Cg={};function I1(g){var y=Ig();if(!y){var R=typeof g=="string"?g:g.displayName||g.name;R&&(y=`

Check the top-level render call using <`+R+">.")}return y}function Lg(g,y){if(!(!g._store||g._store.validated||g.key!=null)){g._store.validated=!0;var R=I1(y);if(!Cg[R]){Cg[R]=!0;var A="";g&&g._owner&&g._owner!==D.current&&(A=" It was passed a child from "+Un(g._owner.type)+"."),ji(g),G('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',R,A),ji(null)}}}function Og(g,y){if(typeof g=="object"){if(Gi(g))for(var R=0;R<g.length;R++){var A=g[R];Pr(A)&&Lg(A,y)}else if(Pr(g))g._store&&(g._store.validated=!0);else if(g){var F=E(g);if(typeof F=="function"&&F!==g.entries)for(var ee=F.call(g),j;!(j=ee.next()).done;)Pr(j.value)&&Lg(j.value,y)}}}function Ng(g){{var y=g.type;if(y==null||typeof y=="string")return;var R;if(typeof y=="function")R=y.propTypes;else if(typeof y=="object"&&(y.$$typeof===u||y.$$typeof===p))R=y.propTypes;else return;if(R){var A=Un(y);S1(R,g.props,"prop",A,g)}else if(y.PropTypes!==void 0&&!Au){Au=!0;var F=Un(y);G("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",F||"Unknown")}typeof y.getDefaultProps=="function"&&!y.getDefaultProps.isReactClassApproved&&G("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function C1(g){{for(var y=Object.keys(g.props),R=0;R<y.length;R++){var A=y[R];if(A!=="children"&&A!=="key"){ji(g),G("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",A),ji(null);break}}g.ref!==null&&(ji(g),G("Invalid attribute `ref` supplied to `React.Fragment`."),ji(null))}}function Pg(g,y,R){var A=C(g);if(!A){var F="";(g===void 0||typeof g=="object"&&g!==null&&Object.keys(g).length===0)&&(F+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var ee=M1(y);ee?F+=ee:F+=Ig();var j;g===null?j="null":Gi(g)?j="array":g!==void 0&&g.$$typeof===r?(j="<"+(Un(g.type)||"Unknown")+" />",F=" Did you accidentally export a JSX literal instead of a component?"):j=typeof g,G("React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",j,F)}var ae=hu.apply(this,arguments);if(ae==null)return ae;if(A)for(var me=2;me<arguments.length;me++)Og(arguments[me],g);return g===s?C1(ae):Ng(ae),ae}var Dg=!1;function L1(g){var y=Pg.bind(null,g);return y.type=g,Dg||(Dg=!0,q("React.createFactory() is deprecated and will be removed in a future major release. Consider using JSX or use React.createElement() directly instead.")),Object.defineProperty(y,"type",{enumerable:!1,get:function(){return q("Factory.type is deprecated. Access the class directly before passing it to createFactory."),Object.defineProperty(this,"type",{value:g}),g}}),y}function O1(g,y,R){for(var A=fu.apply(this,arguments),F=2;F<arguments.length;F++)Og(arguments[F],A.type);return Ng(A),A}function N1(g,y){var R=I.transition;I.transition={};var A=I.transition;I.transition._updatedFibers=new Set;try{g()}finally{if(I.transition=R,R===null&&A._updatedFibers){var F=A._updatedFibers.size;F>10&&q("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),A._updatedFibers.clear()}}}var Fg=!1,Ao=null;function P1(g){if(Ao===null)try{var y=("require"+Math.random()).slice(0,7),R=t&&t[y];Ao=R.call(t,"timers").setImmediate}catch{Ao=function(F){Fg===!1&&(Fg=!0,typeof MessageChannel>"u"&&G("This browser does not have a MessageChannel implementation, so enqueuing tasks via await act(async () => ...) will fail. Please file an issue at https://github.com/facebook/react/issues if you encounter this warning."));var ee=new MessageChannel;ee.port1.onmessage=F,ee.port2.postMessage(void 0)}}return Ao(g)}var Hi=0,Bg=!1;function D1(g){{var y=Hi;Hi++,x.current===null&&(x.current=[]);var R=x.isBatchingLegacy,A;try{if(x.isBatchingLegacy=!0,A=g(),!R&&x.didScheduleLegacyUpdate){var F=x.current;F!==null&&(x.didScheduleLegacyUpdate=!1,Mu(F))}}catch($e){throw So(y),$e}finally{x.isBatchingLegacy=R}if(A!==null&&typeof A=="object"&&typeof A.then=="function"){var ee=A,j=!1,ae={then:function($e,Ze){j=!0,ee.then(function(at){So(y),Hi===0?Su(at,$e,Ze):$e(at)},function(at){So(y),Ze(at)})}};return!Bg&&typeof Promise<"u"&&Promise.resolve().then(function(){}).then(function(){j||(Bg=!0,G("You called act(async () => ...) without await. This could lead to unexpected testing behaviour, interleaving multiple act calls and mixing their scopes. You should - await act(async () => ...);"))}),ae}else{var me=A;if(So(y),Hi===0){var Se=x.current;Se!==null&&(Mu(Se),x.current=null);var Fe={then:function($e,Ze){x.current===null?(x.current=[],Su(me,$e,Ze)):$e(me)}};return Fe}else{var Be={then:function($e,Ze){$e(me)}};return Be}}}}function So(g){g!==Hi-1&&G("You seem to have overlapping act() calls, this is not supported. Be sure to await previous act() calls before making a new one. "),Hi=g}function Su(g,y,R){{var A=x.current;if(A!==null)try{Mu(A),P1(function(){A.length===0?(x.current=null,y(g)):Su(g,y,R)})}catch(F){R(F)}else y(g)}}var xu=!1;function Mu(g){if(!xu){xu=!0;var y=0;try{for(;y<g.length;y++){var R=g[y];do R=R(!0);while(R!==null)}g.length=0}catch(A){throw g=g.slice(y+1),A}finally{xu=!1}}}var F1=Pg,B1=O1,U1=L1,k1={map:pi,forEach:vo,count:mu,toArray:vu,only:yo};e.Children=k1,e.Component=se,e.Fragment=s,e.Profiler=o,e.PureComponent=et,e.StrictMode=a,e.Suspense=h,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ce,e.cloneElement=B1,e.createContext=wo,e.createElement=F1,e.createFactory=U1,e.createRef=cu,e.forwardRef=bu,e.isValidElement=Pr,e.lazy=Tu,e.memo=z,e.startTransition=N1,e.unstable_act=D1,e.useCallback=St,e.useContext=ve,e.useDebugValue=$t,e.useDeferredValue=y1,e.useEffect=st,e.useId=w1,e.useImperativeHandle=To,e.useInsertionEffect=Ve,e.useLayoutEffect=We,e.useMemo=Fr,e.useReducer=fe,e.useRef=he,e.useState=Ee,e.useSyncExternalStore=T1,e.useTransition=v1,e.version=n,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()}(Gs,Gs.exports)),Gs.exports}process.env.NODE_ENV==="production"?ru.exports=Yw():ru.exports=qw();var oi=ru.exports;const Ie=lh(oi);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sg;function Kw(){if(sg)return ks;sg=1;var t=oi,e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(o,c,l){var u,h={},f=null,p=null;l!==void 0&&(f=""+l),c.key!==void 0&&(f=""+c.key),c.ref!==void 0&&(p=c.ref);for(u in c)r.call(c,u)&&!s.hasOwnProperty(u)&&(h[u]=c[u]);if(o&&o.defaultProps)for(u in c=o.defaultProps,c)h[u]===void 0&&(h[u]=c[u]);return{$$typeof:e,type:o,key:f,ref:p,props:h,_owner:i.current}}return ks.Fragment=n,ks.jsx=a,ks.jsxs=a,ks}var zs={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ag;function Zw(){return ag||(ag=1,process.env.NODE_ENV!=="production"&&function(){var t=oi,e=Symbol.for("react.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),o=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.suspense_list"),h=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.for("react.offscreen"),m=Symbol.iterator,v="@@iterator";function b(w){if(w===null||typeof w!="object")return null;var C=m&&w[m]||w[v];return typeof C=="function"?C:null}var T=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function E(w){{for(var C=arguments.length,z=new Array(C>1?C-1:0),W=1;W<C;W++)z[W-1]=arguments[W];S("error",w,z)}}function S(w,C,z){{var W=T.ReactDebugCurrentFrame,ve=W.getStackAddendum();ve!==""&&(C+="%s",z=z.concat([ve]));var Ee=z.map(function(fe){return String(fe)});Ee.unshift("Warning: "+C),Function.prototype.apply.call(console[w],console,Ee)}}var I=!1,x=!1,D=!1,N=!1,O=!1,te;te=Symbol.for("react.module.reference");function ne(w){return!!(typeof w=="string"||typeof w=="function"||w===r||w===s||O||w===i||w===l||w===u||N||w===p||I||x||D||typeof w=="object"&&w!==null&&(w.$$typeof===f||w.$$typeof===h||w.$$typeof===a||w.$$typeof===o||w.$$typeof===c||w.$$typeof===te||w.getModuleId!==void 0))}function V(w,C,z){var W=w.displayName;if(W)return W;var ve=C.displayName||C.name||"";return ve!==""?z+"("+ve+")":z}function re(w){return w.displayName||"Context"}function K(w){if(w==null)return null;if(typeof w.tag=="number"&&E("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof w=="function")return w.displayName||w.name||null;if(typeof w=="string")return w;switch(w){case r:return"Fragment";case n:return"Portal";case s:return"Profiler";case i:return"StrictMode";case l:return"Suspense";case u:return"SuspenseList"}if(typeof w=="object")switch(w.$$typeof){case o:var C=w;return re(C)+".Consumer";case a:var z=w;return re(z._context)+".Provider";case c:return V(w,w.render,"ForwardRef");case h:var W=w.displayName||null;return W!==null?W:K(w.type)||"Memo";case f:{var ve=w,Ee=ve._payload,fe=ve._init;try{return K(fe(Ee))}catch{return null}}}return null}var Z=Object.assign,ce=0,q,G,ie,De,_,M,J;function le(){}le.__reactDisabledLog=!0;function se(){{if(ce===0){q=console.log,G=console.info,ie=console.warn,De=console.error,_=console.group,M=console.groupCollapsed,J=console.groupEnd;var w={configurable:!0,enumerable:!0,value:le,writable:!0};Object.defineProperties(console,{info:w,log:w,warn:w,error:w,group:w,groupCollapsed:w,groupEnd:w})}ce++}}function ge(){{if(ce--,ce===0){var w={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Z({},w,{value:q}),info:Z({},w,{value:G}),warn:Z({},w,{value:ie}),error:Z({},w,{value:De}),group:Z({},w,{value:_}),groupCollapsed:Z({},w,{value:M}),groupEnd:Z({},w,{value:J})})}ce<0&&E("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Te=T.ReactCurrentDispatcher,be;function ye(w,C,z){{if(be===void 0)try{throw Error()}catch(ve){var W=ve.stack.trim().match(/\n( *(at )?)/);be=W&&W[1]||""}return`
`+be+w}}var et=!1,Or;{var cu=typeof WeakMap=="function"?WeakMap:Map;Or=new cu}function co(w,C){if(!w||et)return"";{var z=Or.get(w);if(z!==void 0)return z}var W;et=!0;var ve=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var Ee;Ee=Te.current,Te.current=null,se();try{if(C){var fe=function(){throw Error()};if(Object.defineProperty(fe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(fe,[])}catch($t){W=$t}Reflect.construct(w,[],fe)}else{try{fe.call()}catch($t){W=$t}w.call(fe.prototype)}}else{try{throw Error()}catch($t){W=$t}w()}}catch($t){if($t&&W&&typeof $t.stack=="string"){for(var he=$t.stack.split(`
`),st=W.stack.split(`
`),Ve=he.length-1,We=st.length-1;Ve>=1&&We>=0&&he[Ve]!==st[We];)We--;for(;Ve>=1&&We>=0;Ve--,We--)if(he[Ve]!==st[We]){if(Ve!==1||We!==1)do if(Ve--,We--,We<0||he[Ve]!==st[We]){var St=`
`+he[Ve].replace(" at new "," at ");return w.displayName&&St.includes("<anonymous>")&&(St=St.replace("<anonymous>",w.displayName)),typeof w=="function"&&Or.set(w,St),St}while(Ve>=1&&We>=0);break}}}finally{et=!1,Te.current=Ee,ge(),Error.prepareStackTrace=ve}var Fr=w?w.displayName||w.name:"",To=Fr?ye(Fr):"";return typeof w=="function"&&Or.set(w,To),To}function Gi(w,C,z){return co(w,!1)}function lu(w){var C=w.prototype;return!!(C&&C.isReactComponent)}function zi(w,C,z){if(w==null)return"";if(typeof w=="function")return co(w,lu(w));if(typeof w=="string")return ye(w);switch(w){case l:return ye("Suspense");case u:return ye("SuspenseList")}if(typeof w=="object")switch(w.$$typeof){case c:return Gi(w.render);case h:return zi(w.type,C,z);case f:{var W=w,ve=W._payload,Ee=W._init;try{return zi(Ee(ve),C,z)}catch{}}}return""}var ci=Object.prototype.hasOwnProperty,li={},lo=T.ReactDebugCurrentFrame;function ui(w){if(w){var C=w._owner,z=zi(w.type,w._source,C?C.type:null);lo.setExtraStackFrame(z)}else lo.setExtraStackFrame(null)}function Un(w,C,z,W,ve){{var Ee=Function.call.bind(ci);for(var fe in w)if(Ee(w,fe)){var he=void 0;try{if(typeof w[fe]!="function"){var st=Error((W||"React class")+": "+z+" type `"+fe+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof w[fe]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw st.name="Invariant Violation",st}he=w[fe](C,fe,W,z,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(Ve){he=Ve}he&&!(he instanceof Error)&&(ui(ve),E("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",W||"React class",z,fe,typeof he),ui(null)),he instanceof Error&&!(he.message in li)&&(li[he.message]=!0,ui(ve),E("Failed %s type: %s",z,he.message),ui(null))}}}var hi=Array.isArray;function Vi(w){return hi(w)}function uo(w){{var C=typeof Symbol=="function"&&Symbol.toStringTag,z=C&&w[Symbol.toStringTag]||w.constructor.name||"Object";return z}}function ho(w){try{return $i(w),!1}catch{return!0}}function $i(w){return""+w}function Vs(w){if(ho(w))return E("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",uo(w)),$i(w)}var Nr=T.ReactCurrentOwner,uu={key:!0,ref:!0,__self:!0,__source:!0},fo,po,di;di={};function hu(w){if(ci.call(w,"ref")){var C=Object.getOwnPropertyDescriptor(w,"ref").get;if(C&&C.isReactWarning)return!1}return w.ref!==void 0}function du(w){if(ci.call(w,"key")){var C=Object.getOwnPropertyDescriptor(w,"key").get;if(C&&C.isReactWarning)return!1}return w.key!==void 0}function fu(w,C){if(typeof w.ref=="string"&&Nr.current&&C&&Nr.current.stateNode!==C){var z=K(Nr.current.type);di[z]||(E('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',K(Nr.current.type),w.ref),di[z]=!0)}}function Pr(w,C){{var z=function(){fo||(fo=!0,E("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",C))};z.isReactWarning=!0,Object.defineProperty(w,"key",{get:z,configurable:!0})}}function go(w,C){{var z=function(){po||(po=!0,E("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",C))};z.isReactWarning=!0,Object.defineProperty(w,"ref",{get:z,configurable:!0})}}var pu=function(w,C,z,W,ve,Ee,fe){var he={$$typeof:e,type:w,key:C,ref:z,props:fe,_owner:Ee};return he._store={},Object.defineProperty(he._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(he,"_self",{configurable:!1,enumerable:!1,writable:!1,value:W}),Object.defineProperty(he,"_source",{configurable:!1,enumerable:!1,writable:!1,value:ve}),Object.freeze&&(Object.freeze(he.props),Object.freeze(he)),he};function gu(w,C,z,W,ve){{var Ee,fe={},he=null,st=null;z!==void 0&&(Vs(z),he=""+z),du(C)&&(Vs(C.key),he=""+C.key),hu(C)&&(st=C.ref,fu(C,ve));for(Ee in C)ci.call(C,Ee)&&!uu.hasOwnProperty(Ee)&&(fe[Ee]=C[Ee]);if(w&&w.defaultProps){var Ve=w.defaultProps;for(Ee in Ve)fe[Ee]===void 0&&(fe[Ee]=Ve[Ee])}if(he||st){var We=typeof w=="function"?w.displayName||w.name||"Unknown":w;he&&Pr(fe,We),st&&go(fe,We)}return pu(w,he,st,ve,W,Nr.current,fe)}}var Wi=T.ReactCurrentOwner,mo=T.ReactDebugCurrentFrame;function ar(w){if(w){var C=w._owner,z=zi(w.type,w._source,C?C.type:null);mo.setExtraStackFrame(z)}else mo.setExtraStackFrame(null)}var fi;fi=!1;function Dr(w){return typeof w=="object"&&w!==null&&w.$$typeof===e}function pi(){{if(Wi.current){var w=K(Wi.current.type);if(w)return`

Check the render method of \``+w+"`."}return""}}function mu(w){{if(w!==void 0){var C=w.fileName.replace(/^.*[\\\/]/,""),z=w.lineNumber;return`

Check your code at `+C+":"+z+"."}return""}}var vo={};function vu(w){{var C=pi();if(!C){var z=typeof w=="string"?w:w.displayName||w.name;z&&(C=`

Check the top-level render call using <`+z+">.")}return C}}function yo(w,C){{if(!w._store||w._store.validated||w.key!=null)return;w._store.validated=!0;var z=vu(C);if(vo[z])return;vo[z]=!0;var W="";w&&w._owner&&w._owner!==Wi.current&&(W=" It was passed a child from "+K(w._owner.type)+"."),ar(w),E('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',z,W),ar(null)}}function wo(w,C){{if(typeof w!="object")return;if(Vi(w))for(var z=0;z<w.length;z++){var W=w[z];Dr(W)&&yo(W,C)}else if(Dr(w))w._store&&(w._store.validated=!0);else if(w){var ve=b(w);if(typeof ve=="function"&&ve!==w.entries)for(var Ee=ve.call(w),fe;!(fe=Ee.next()).done;)Dr(fe.value)&&yo(fe.value,C)}}}function gi(w){{var C=w.type;if(C==null||typeof C=="string")return;var z;if(typeof C=="function")z=C.propTypes;else if(typeof C=="object"&&(C.$$typeof===c||C.$$typeof===h))z=C.propTypes;else return;if(z){var W=K(C);Un(z,w.props,"prop",W,w)}else if(C.PropTypes!==void 0&&!fi){fi=!0;var ve=K(C);E("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",ve||"Unknown")}typeof C.getDefaultProps=="function"&&!C.getDefaultProps.isReactClassApproved&&E("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function $s(w){{for(var C=Object.keys(w.props),z=0;z<C.length;z++){var W=C[z];if(W!=="children"&&W!=="key"){ar(w),E("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",W),ar(null);break}}w.ref!==null&&(ar(w),E("Invalid attribute `ref` supplied to `React.Fragment`."),ar(null))}}function Ws(w,C,z,W,ve,Ee){{var fe=ne(w);if(!fe){var he="";(w===void 0||typeof w=="object"&&w!==null&&Object.keys(w).length===0)&&(he+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var st=mu(ve);st?he+=st:he+=pi();var Ve;w===null?Ve="null":Vi(w)?Ve="array":w!==void 0&&w.$$typeof===e?(Ve="<"+(K(w.type)||"Unknown")+" />",he=" Did you accidentally export a JSX literal instead of a component?"):Ve=typeof w,E("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",Ve,he)}var We=gu(w,C,z,ve,Ee);if(We==null)return We;if(fe){var St=C.children;if(St!==void 0)if(W)if(Vi(St)){for(var Fr=0;Fr<St.length;Fr++)wo(St[Fr],w);Object.freeze&&Object.freeze(St)}else E("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else wo(St,w)}return w===r?$s(We):gi(We),We}}function yu(w,C,z){return Ws(w,C,z,!0)}function wu(w,C,z){return Ws(w,C,z,!1)}var Tu=wu,bu=yu;zs.Fragment=r,zs.jsx=Tu,zs.jsxs=bu}()),zs}process.env.NODE_ENV==="production"?nu.exports=Kw():nu.exports=Zw();var rt=nu.exports;function Lr(t,e,n,r={current:0},i=""){const s=e.get(n),a=new Set,o=Ie.useRef([]),c=new Set;o.current=[],i=i?`${i}.`:"";let l=[];return s&&(l=Ie.Children.map(s,u=>{if(Ie.isValidElement(u)){const h=u.key||r.current++,f=`${i}${u.props.name||`${h}`}`,p=t.get(f)||new ht;t.set(f,p),o.current.push(p),u.props.share&&(u.props.share.current=p);const m={key:h,name:f,resolver:p};return a.has(m.name)?c.add(m.name):a.add(m.name),Ie.cloneElement(u,m)}})),[l,Promise.all(o.current.map(u=>u==null?void 0:u.promise)),{resolvers:o,nameConflict:c}]}function iu(...t){return t.filter(Ue).reduce((e,n)=>e.concat(n),[])}function Jw(t){const{children:e,tagName:n,...r}=t,i=Object.keys(r).reduce((s,a)=>{try{$n(a)&&(s[a.toLowerCase()]=JSON.stringify(r[a]))}catch{}return s},{});return{tagName:n,attributes:i,children:e}}const Fn=t=>{const{tagName:e="",attributes:n,children:r}=Jw(t),{writeToDom:i}=Ie.useContext(ki)||{};return i?Ie.createElement(e,n,r):t.children};var pt=(t=>(t[t.EVENT_MANAGER=1]="EVENT_MANAGER",t[t.LAYER=2]="LAYER",t[t.CAMERA=3]="CAMERA",t[t.PROVIDER=4]="PROVIDER",t[t.RESOURCE=5]="RESOURCE",t[t.VIEW=6]="VIEW",t[t.SCENE=7]="SCENE",t))(pt||{});function og(t,e,n){var s,a;const r=new Map,i=[];for(e&&e.forEach(o=>{r.set(o,[])}),Ie.Children.forEach(t,(o,c)=>{i.push(o)}),i.reverse();i.length>0;){const o=i.pop();if(Ie.isValidElement(o)){if(o!==void 0&&((o==null?void 0:o.type)===Ie.Fragment||o.props.surfaceJSXType===void 0)){if(!((s=o==null?void 0:o.props)!=null&&s.children)){n&&n.push(o);continue}const c=[];Ie.Children.forEach(((a=o==null?void 0:o.props)==null?void 0:a.children)||[],l=>{c.push(l)});for(let l=c.length-1;l>=0;--l)i.push(c[l]);continue}else if(o!==void 0){if(o.props.surfaceJSXType===void 0){n&&n.push(o);continue}if(e){const c=r.get(o.props.surfaceJSXType);if(!c){n&&n.push(o);continue}c.push(o)}else{let c=r.get(o.props.surfaceJSXType);c||(c=[],r.set(o.props.surfaceJSXType,c)),c.push(o)}}}}return r}function e1(t){return t&&t.charCodeAt!==void 0}function t1(t){return t!=null}const cg=()=>{};class n1{constructor(e){this.resolver=cg,this.rejector=cg,this.promise=new Promise((n,r)=>(this.resolver=n,this.rejector=r))}resolve(e){this.resolver(e)}reject(e){this.rejector(e)}hijack(e){this.children=this.children||[],this.children.push(e),this.childResolvers=this.childResolvers||new Map,this.childResolvers.set(e,e.resolver),e.resolver=async n=>{this.childResolutions=this.childResolutions||new Map,this.childResolutions.set(e,n)}}}function sr(t,e){var o,c;const[n,r]=oi.useState(!0),[i,s]=oi.useState(!1),a={store:t,shouldMount:n};if(!i&&t1(t.willMount)&&(a.shouldMount=!!((o=t.willMount)!=null&&o.call(t))),i){const l=(c=t.willUpdate)==null?void 0:c.call(t);l&&(async()=>await l())()}return oi.useEffect(()=>{const l=new n1;s(!0),r(a.shouldMount);let u;return(async()=>{var h;u=await((h=t.didMount)==null?void 0:h.call(t)),l.resolve(!0)})(),()=>{(async()=>(await l.promise,u==null||u()))()}},[]),oi.useEffect(()=>{var l;i&&(a.shouldMount=!!((l=t.willMount)!=null&&l.call(t)))},e||[0]),a}const W1="",ki=Ie.createContext(void 0),r1=t=>{const e=Ie.useRef(null),n=Ie.useRef(null),r=Ie.useRef(0),i=Ie.useRef(null),s=Ie.useRef(null),a=Ie.useRef(-1),o=Ie.useRef(new Map),c=Ie.useRef(new Map),l=Ie.useRef(new Map),u=Ie.useRef(new Map),h=Ie.useRef(new Map),f=Ie.useRef(new ht),p={current:0},m=[],v=og(t.children,void 0,m);m.length&&console.warn("Surface found unsupported children",m);const[b,T]=Lr(o.current,v,pt.EVENT_MANAGER,p),[E,S]=Lr(c.current,v,pt.RESOURCE,p),[I,x,{nameConflict:D}]=Lr(h.current,v,pt.SCENE,p),[N,O,{nameConflict:te}]=Lr(u.current,v,pt.LAYER,p),[ne,V,{nameConflict:re}]=Lr(l.current,v,pt.VIEW,p);if(D.size>0){console.warn("Root Scene name conflict:",D);return}if(te.size>0){console.warn("Root Scene Layer name conflict:",te);return}if(re.size>0){console.warn("Root Scene View name conflict:",re);return}const K=async q=>{i.current&&(r.current=q,i.current.draw(q))},Z=q=>{var G,ie,De,_,M,J;(G=n.current)==null||G.remove(),(_=i.current)==null||_.resize(((ie=e.current)==null?void 0:ie.offsetWidth)||0,((De=e.current)==null?void 0:De.offsetHeight)||0),n.current&&((M=e.current)==null||M.appendChild(n.current)),q||(J=i.current)==null||J.draw(r.current)},ce=()=>{window.clearTimeout(a.current),a.current=window.setTimeout(()=>{Z(!0)})};return sr({async didMount(){var be;if(!n.current||!e.current)return;const[q,G,ie,De,_]=await Promise.all([T,S,x,O,V]),M=ie.filter(Ue),J=q.filter(Ue),le=G.filter(Ue),se=De.filter(Ue),ge=_.filter(Ue);if(ie.length<=0&&(!(se!=null&&se.length)||!(ge!=null&&ge.length))){console.error("No scenes or root level Layers+Views provided to surface");return}ge.length&&se.length&&M.unshift({key:"root",layers:se,views:ge});const Te=await new Mp({context:n.current,handlesWheelEvents:t.handlesWheelEvents!==void 0?t.handlesWheelEvents:!0,pixelRatio:t.pixelRatio||window.devicePixelRatio,eventManagers:J,ioExpansion:t.ioExpansion,shaderTransforms:t.shaderTransforms,resourceManagers:t.resourceManagers,rendererOptions:Object.assign({alpha:!0,antialias:!1},t.options)}).ready;return s.current=vl(K),Te.pipeline({resources:le,scenes:M}),i.current=Te,await jn(),Z(!0),(be=t.ready)==null||be.resolve(i.current),window.addEventListener("resize",ce),()=>{var ye;window.removeEventListener("resize",ce),af(s.current),(ye=i.current)==null||ye.destroy()}}}),rt.jsx("div",{ref:e,className:`SurfaceJSX ${t.className||""}`,...t.containerProps,children:rt.jsx("canvas",{ref:n,children:rt.jsx(ki.Provider,{value:{writeToDom:t.writeToDom,eventResolvers:o.current,resourceResolvers:c.current,viewResolvers:l.current,layerResolvers:u.current,sceneResolvers:h.current,resolversReady:f.current},children:rt.jsx(Fn,{tagName:"Surface",...t,children:iu(b,E,ne,N,I)})})})})},lg=t=>(sr({didMount(){var e;(e=t.resolver)==null||e.resolve(new kl(t.handlers,t.preserveEvents))}}),rt.jsx(Fn,{tagName:"QueuedEventHandler",...t}));lg.defaultProps={surfaceJSXType:pt.EVENT_MANAGER};const ug=t=>(sr({didMount(){var e;(e=t.resolver)==null||e.resolve(new Ur(t.handlers))}}),rt.jsx(Fn,{tagName:"SimpleEventHandler",...t}));ug.defaultProps={surfaceJSXType:pt.EVENT_MANAGER};const hg=t=>(sr({didMount(){var e;(e=t.resolver)==null||e.resolve(new Cp(t.config))}}),rt.jsx(Fn,{tagName:"BasicCamera2DController",...t}));hg.defaultProps={surfaceJSXType:pt.EVENT_MANAGER};const dg=t=>(sr({didMount(){var e;(e=t.resolver)==null||e.resolve(Rl({key:t.name,height:t.height,width:t.width,textureSettings:t.textureSettings}))}}),rt.jsx(Fn,{tagName:"Texture",...t}));dg.defaultProps={surfaceJSXType:pt.RESOURCE};const fg=t=>(sr({didMount(){var e;(e=t.resolver)==null||e.resolve(Cl({key:t.name,fontSource:t.fontSource,characterFilter:t.characterFilter,dynamic:t.dynamic,fontMap:t.fontMap,fontMapSize:t.fontMapSize}))}}),rt.jsx(Fn,{tagName:"Font",...t}));fg.defaultProps={surfaceJSXType:pt.RESOURCE};const io=t=>{const e=Ie.useContext(ki);return sr({async didMount(){var a;let n=t.config;const r=t.uses;if(r){await(e==null?void 0:e.resolversReady);const o={},c=r.names.map(async l=>{var f,p;const u=(f=e==null?void 0:e.resourceResolvers)==null?void 0:f.get(l);if(!u)return console.error(`A layer requested a resource: ${l} but the name identifier was not found in the available resources`),console.warn("Available resources:",Array.from(((p=e==null?void 0:e.resourceResolvers)==null?void 0:p.keys())||[])),null;const h=await u.promise;if(!h)return console.error(`The Layer requested a resource "${l}", but the resource did not resolve a value`),null;if(!Yr(h))return console.error(`The Layer requested a resource "${l}", but the resource resolved to a value that is not a render texture resource`),null;o[l]=h}).filter(Ue);await Promise.all(c),n=r.apply(o,{...t.config})}const i=qr(t.type,{key:t.name,...n});let s=i.init[1].data;s===i.init[0].defaultProps.data&&(s=new Oe,i.init[1].data=s),t.providerRef&&s instanceof Oe&&(t.providerRef.current=s),(a=t.resolver)==null||a.resolve(i)}}),rt.jsx(Fn,{tagName:"Layer",...t})};io.defaultProps={surfaceJSXType:pt.LAYER};function pg(t,e,n){var i,s;const r=(i=e==null?void 0:e.resourceResolvers)==null?void 0:i.get(n);return r||(console.error(`A View "${t}" requested a resource: ${n} but the name identifier was not found in the available resources`),console.warn("Available resources:",Array.from(((s=e==null?void 0:e.resourceResolvers)==null?void 0:s.keys())||[])),null)}const so=t=>{const e=Ie.useContext(ki);return sr({async didMount(){var c,l,u;t.config.output&&!t.output&&console.warn("Do NOT use the output property in the config. Use the output property on the props of the JSX element"),await(e==null?void 0:e.resolversReady);const n=((c=t.output)==null?void 0:c.buffers)||{},r=Object.entries(n).map(([h,f])=>{const p=pg(t.name,e,f);return p?[Number.parseInt(h),p,f]:(console.warn("View props",t),null)}).filter(Ue),i={};await Promise.all(r.map(async h=>{const f=await h[1].promise;Yr(f)||Ba(f)?i[h[0]]=f:(console.error(`A View "${t.name}" requested an output buffer for the resource with name: ${h[2]} but the resource indicated is not a valid output target type.`,"Ensure the resource is a RenderTextureResource or ColorBufferResource"),console.warn("View props",t))}));let s=!0;const a=(l=t.output)==null?void 0:l.depth;if(e1(a)){const h=pg(t.name,e,a);if(!h)console.warn("View props",t),s=!1;else{const f=await h.promise;Yr(f)||Ba(f)?s=f:(console.error(`A View "${t.name}" requested a depth buffer for the resource with name: ${a} but the resource indicated is not a valid output target type.`,"Ensure the resource is a RenderTextureResource or ColorBufferResource"),console.warn("View props",t))}}else Ue(a)&&(s=a);const o=Bl(t.type,{key:t.name,...t.config,output:t.output?{buffers:i,depth:s}:void 0});(u=t.resolver)==null||u.resolve(o)}}),rt.jsx(Fn,{tagName:"View",...t})};so.defaultProps={surfaceJSXType:pt.VIEW};const ao=t=>{var u,h,f,p;const e=Ie.useContext(ki),n={current:0},r=og(t.children),[i,s,{nameConflict:a}]=Lr((e==null?void 0:e.layerResolvers)||new Map,r,pt.LAYER,n,t.name),[o,c,{nameConflict:l}]=Lr((e==null?void 0:e.viewResolvers)||new Map,r,pt.VIEW,n,t.name);if(a.size>0){console.warn(`Scene ${t.name} Layer name conflict:`,a),(u=t.resolver)==null||u.resolve(null);return}if(l.size>0){console.warn(`Scene ${t.name} View name conflict:`,l),(h=t.resolver)==null||h.resolve(null);return}if(!i){console.warn("A Scene had no Layers:",t.name),(f=t.resolver)==null||f.resolve(null);return}if(!o){console.warn("A Scene had no Views:",t.name),(p=t.resolver)==null||p.resolve(null);return}return sr({async didMount(){var b;const[m,v]=await Promise.all([s,c]);(b=t.resolver)==null||b.resolve({key:t.name,layers:m.filter(Ue),views:v.filter(Ue)})}}),rt.jsx(Fn,{tagName:"Scene",...t,children:iu(o,i)})};ao.defaultProps={surfaceJSXType:pt.SCENE};function i1(t){const e=[];for(let n=0,r=t.length;n<r;++n){const i=t[n];for(let s=0,a=i.length;s<a;++s)e.push(i[s])}return e}var s1=Object.defineProperty,a1=Object.getOwnPropertyDescriptor,o1=(t,e,n,r)=>{for(var i=r>1?void 0:r?a1(e,n):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(i=(r?a(e,n,i):a(i))||i);return r&&i&&s1(e,n,i),i};const gg=class extends dt{constructor(){super(),this.tint=[1,1,1,1],vt(this,gg)}};let su=gg;o1([B],su.prototype,"tint",2);const mg=new Re({data:{width:2,height:2,buffer:new Uint8Array(16)}});class au extends Sn{initShader(){const{buffers:e,fs:n,data:r}=this.props,i=new su;r instanceof Oe&&r.add(i),this.alwaysDraw=!0;const s=[[-1,-1],[1,-1],[-1,1],[1,1]],a=s.map(l=>[l[0]===1?1:0,l[1]===1?1:0]),o=i1(Object.keys(e).map(l=>{const u=e[l];if(!u)return;const h=u.key,f=Cs({key:h});return[{name:l,shaderInjection:P.FRAGMENT,size:L.TEXTURE,update:()=>(this.resource.request(this,i,f),f.texture||mg)},{name:`${l}_size`,shaderInjection:P.FRAGMENT,size:L.TWO,update:()=>{this.props,this.resource.request(this,i,f);const p=(f.texture||mg).data;return[(p==null?void 0:p.width)||1,(p==null?void 0:p.height)||1]}}]}).filter(Ue));let c=this.props.uniforms||[];return Array.isArray(c)||(c=c(this)),{drawMode:d.GLSettings.Model.DrawMode.TRIANGLE_STRIP,vs:`
        varying vec2 texCoord;

        void main() {
          gl_Position = vec4(vertex, 0.0, 1.0);
          texCoord = tex;
        }
      `,fs:n,instanceAttributes:[{name:"dummy",size:k.ONE,update:l=>[0]}],uniforms:o.concat(c),vertexAttributes:[{name:"vertex",size:ct.TWO,update:l=>s[l]},{name:"tex",size:ct.TWO,update:l=>a[l]}],vertexCount:4}}shouldDrawView(){return!0}getMaterialOptions(){return At.transparentImageBlending.modify({depthTest:!1})}}au.defaultProps={key:"",data:new Oe,buffers:{},baseShaderModules:()=>({fs:[],vs:[]}),fs:"void main() { gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);"};const Bn=t=>{var e;return rt.jsxs(ao,{name:t.name,children:[rt.jsx(so,{name:"fullscreen",type:Za,...t.view,config:{camera:new Zn,viewport:{left:0,top:0,width:"100%",height:"100%"},...(e=t.view)==null?void 0:e.config}}),rt.jsx(io,{name:"postprocess",type:au,uses:{names:Object.values(t.buffers),apply:(n,r)=>{var i;return r.buffers={},Object.keys(t.buffers).map(s=>{r.buffers[s]=n[t.buffers[s]]}),(i=t.onResources)==null||i.call(t,n),r}},config:{printShader:t.printShader,buffers:{},fs:t.shader,uniforms:t.uniforms,materialOptions:t.material}})]},t.name)},c1=t=>rt.jsxs(ao,{name:t.name,children:[rt.jsx(so,{type:Za,config:{camera:new Zn}}),rt.jsx(io,{type:zl,config:{commands:t.callback}})]}),l1=`\${import: camera}
varying vec2 texCoord;
void main() {
vec2 texelSize = 1.0 / viewSize;
vec4 o = texelSize.xyxy * vec2(-delta, delta).xxyy;
vec4 s =
texture2D(color, texCoord + o.xy) + texture2D(color, texCoord + o.zy) +
texture2D(color, texCoord + o.xw) + texture2D(color, texCoord + o.zw);
gl_FragColor = s * 0.25;
}`;var oo=(t=>(t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t))(oo||{});function ou(t){const{output:e,input:n}=t;return Bn({name:t.name,printShader:t.printShader,view:Object.assign(e?{output:{buffers:{[oe.COLOR]:e},depth:!1}}:{},t.view),buffers:{color:n},shader:l1,material:t.material,uniforms:[{name:"delta",size:L.ONE,shaderInjection:P.FRAGMENT,update:()=>t.direction===0?1:.5}]})}function u1(t){const{compose:e,output:n,resources:r,view:i}=t,s={blending:{blendDst:d.GLSettings.Material.BlendingDstFactor.One,blendSrc:d.GLSettings.Material.BlendingSrcFactor.One,blendEquation:d.GLSettings.Material.BlendingEquations.Add}},a=[];for(let o=0,c=t.samples;o<c;++o){const l=ou({name:`${t.name}.box-down${o}`,printShader:t.printShader,input:r[o],output:r[o+1],direction:oo.DOWN,material:{blending:void 0}});a.push(l)}for(let o=t.samples-1;o>0;--o){const c=ou({name:`${t.name}.box-up${o}`,printShader:t.printShader,input:r[o+1],output:r[o],direction:oo.UP,material:s});a.push(c)}return e&&a.push(Bn({name:`${t.name}.compose`,printShader:t.printShader,buffers:{color:e,glow:r[1]},material:s,view:{...n?{output:{buffers:{[oe.COLOR]:n},depth:!1}}:void 0,...i},uniforms:[{name:"gamma",size:L.ONE,shaderInjection:P.ALL,update:()=>[t.gammaCorrection||1]}],shader:`
          varying vec2 texCoord;

          void main() {
            vec3 base = texture2D(color, texCoord).rgb;
            vec3 glow = texture2D(glow, texCoord).rgb;

            ${t.gammaCorrection!==void 0?`
              vec3 result = mix(
                base,
                glow + base,
                ((glow.r + glow.g + glow.b) * gamma)
              );
            `:`
              vec3 result = base + glow;
            `}

            gl_FragColor = vec4(result, 1.0);
          }
        `})),a}function h1(t){return Array.isArray(t[0])}const d1=t=>{const e=t.scale||Zs(1,1),r=(h1(e)?e:[t.scale]).map(s=>Ks(s)),i=1/r.length;if(Ue(t.drift)){const s=t.drift;return Bn({name:t.name,buffers:{},view:{output:{buffers:{[oe.COLOR]:t.output},depth:!1}},uniforms:[{name:"drift",size:L.THREE,shaderInjection:P.FRAGMENT,update:()=>s}],shader:`
        \${import: time, simplexNoise3D}

        void main() {
          float value = 0.;
          ${r.map(a=>`value += simplexNoise3D(vec3(gl_FragCoord.xy * vec2(${a[0]}f, ${a[1]}f), 0.) + (drift * time));`).join(`
`)}
          value *= ${i.toFixed(1)}f;
          \${out: color} = vec4(value, value, value, 1.);
        }
      `})}else if(Ue(t.zOffset)){const s=t.zOffset;return Bn({name:t.name,buffers:{},view:{output:{buffers:{[oe.COLOR]:t.output},depth:!1}},uniforms:[{name:"zOffset",size:L.ONE,update:fh(s)?()=>[s]:()=>[s()]}],shader:`
        \${import: simplexNoise3D}

        void main() {
          float value = 0.;
          ${r.map(a=>`
            value += simplexNoise3D(vec3(gl_FragCoord.xy * vec2(${a[0]}f, ${a[1]}f), zOffset));
          `)}
          value *= ${i.toFixed(1)}f;
          \${out: color} = vec4(value, value, value, 1.);
        }
      `})}else return Bn({name:t.name,buffers:{},view:{output:{buffers:{[oe.COLOR]:t.output},depth:!1}},shader:`
        \${import: simplexNoise2D}

        void main() {
          float value = 0.;
          ${r.map(s=>`
            value += simplexNoise2D(gl_FragCoord.xy * vec2(${s[0]}f, ${s[1]}f));
          `)}
          value *= ${i.toFixed(1)}f;
          \${out: color} = vec4(value, value, value, 1.);
        }
      `})},f1=Ye("performance");function p1(t){const{output:e,input:n,channel:r,grayScale:i}=t;return Bn({name:t.name,printShader:t.printShader,view:{output:e?{buffers:{[oe.COLOR]:e||""},depth:!1}:void 0,...t.view},buffers:{color:n},shader:i&&r?`
      varying vec2 texCoord;

      void main() {
        gl_FragColor = vec4(texture2D(color, texCoord).${r}${r}${r}, 1.);
      }
    `:r?`
      varying vec2 texCoord;

      void main() {
        gl_FragColor = vec4(texture2D(color, texCoord).${r}, 0., 0., 1.);
      }
    `:`
      varying vec2 texCoord;

      void main() {
        gl_FragColor = texture2D(color, texCoord);
      }
    `,material:t.material,onResources:s=>{Object.values(s).forEach(a=>{(!a.textureSettings||a.textureSettings.generateMipMaps)&&f1("POSSIBLE ERROR: for the draw post effect,","it is a common mistale to leave mipmaps enabled on the input texture.","Often the mipmaps are not available in the target resource and thus","you will get a blank output when rendering in certain scenarios.")})}})}function g1(t){const{output:e,input:n,view:r}=t,i=[];return i.push(Bn({name:t.name,printShader:t.printShader,buffers:{trailTex:n.trail,addTex:n.add},material:{blending:null},view:{config:{clearFlags:[Pi.COLOR]},output:{buffers:{[oe.COLOR]:e},depth:!1},...r},shader:`
          varying vec2 texCoord;

          void main() {
            // Add the trailTex and addTex but fade out the trailTex slightly
            vec4 addT = texture2D(addTex, texCoord);
            vec4 trailT = texture2D(trailTex, texCoord);

            // Blend the textures
            float alpha = addT.a + trailT.a * (1.0 - addT.a); // Compute final alpha
            vec3 color;
            if (alpha > 0.0) { // Avoid division by zero
              color = (addT.rgb * addT.a + trailT.rgb * trailT.a * (1.0 - addT.a)) / alpha;
            } else {
              color = vec3(0.0); // Fallback to black (or any other fallback color)
            }

            gl_FragColor = vec4(color, alpha);
          }
        `})),t.drift?t.drift&&i.push(Bn({name:t.name,printShader:t.printShader,buffers:{tex:e},material:{blending:null},view:{output:{buffers:{[oe.COLOR]:n.trail},depth:!1},...r},uniforms:[{name:"drift",size:L.TWO,shaderInjection:P.FRAGMENT,update:()=>{var s;return((s=t.drift)==null?void 0:s.direction)||[0,0]}}],shader:`
          varying vec2 texCoord;

          void main() {
            vec4 fade = texture2D(tex, texCoord + (drift / tex_size));
            fade.rgba *= ${t.intensity||.7};
            \${out: color} = fade;
          }
        `})):i.push(Bn({name:t.name,printShader:t.printShader,buffers:{tex:e},material:{blending:null},view:{output:{buffers:{[oe.COLOR]:n.trail},depth:!1},...r},shader:`
          varying vec2 texCoord;

          void main() {
            vec4 fade = texture2D(tex, texCoord);
            fade.rgba *= ${t.intensity||.7};
            \${out: color} = fade;
          }
        `})),i}class vg extends Sn{constructor(e,n,r){super(e,n,r),console.warn("Please ensure all debugLayer calls are removed for production:",r.key)}childLayers(){return this.props.wrap?(this.props.wrap.init[1].key=`debug-wrapper.${this.props.key}`,[this.props.wrap]):[]}draw(){if(!this.props.wrap)return;const e=this.resolveChanges(!0);if(e.length===0)return;const{messageHeader:n=()=>""}=this.props;console.warn(`${n()}
`,{totalChanges:e.length,changes:e})}initShader(){if(!this.props.wrap)return null;const e=new this.props.wrap.init[0](this.surface,this.scene,this.props.wrap.init[1]),n=e.childLayers(),r={};for(;n.length>0;){const i=n.pop();if(!i)continue;const s=new i.init[0](this.surface,this.scene,i.init[1]);r[s.id]={shaderIO:s.initShader()},s.childLayers().forEach(a=>n.push(a))}return console.warn(`Shader IO: ${this.id}
`,{shaderIO:e.initShader(),childLayers:r}),null}}vg.defaultProps={data:new Oe,key:"default",messageHeader:()=>"",wrap:qr(Sn,{data:new Oe})};function m1(t,e){const n=Kr(vg,{messageHeader:()=>`CHANGES FOR: ${n.init[1].key}`,wrap:Kr(t,e),data:e.data});return n}d.ActiveIOExpansion=Xf,d.AnchorType=$,d.ArcInstance=er,d.ArcLayer=Vl,d.ArcScaleType=Op,d.Atlas=_f,d.AtlasManager=Af,d.AtlasResourceManager=xf,d.Attribute=zn,d.AutoEasingLoopStyle=wn,d.AutoEasingMethod=Aa,d.Axis2D=Zp,d.BaseIOExpansion=Is,d.BaseIOSorting=_p,d.BaseProjection=ba,d.BaseResourceManager=Mi,d.BaseShaderIOInjection=Sf,d.BasicCamera2DController=Cp,d.BasicCamera2DControllerJSX=hg,d.BasicIOExpansion=Qf,d.BasicInstance=y0,d.BloomJSX=u1,d.Bounds=we,d.BoxSampleJSX=ou,d.BoxSampleJSXDirection=oo,d.BufferManagerBase=Ha,d.Camera=Qn,d.Camera2D=Zn,d.CameraBoundsAnchor=Ip,d.CameraProjectionType=Hn,d.CircleInstance=Ds,d.CircleLayer=$l,d.ClearFlags=Pi,d.CommandLayer=zl,d.CommandsJSX=c1,d.CommonMaterialOptions=At,d.Control2D=Kn,d.CubeInstance=tu,d.CubeLayer=eg,d.CustomTag=Fn,d.DEFAULT_IO_EXPANSION=Ap,d.DEFAULT_RESOURCE_MANAGEMENT=Sp,d.DEFAULT_RESOURCE_ROUTER=Gf,d.DEFAULT_SHADER_TRANSFORM=xp,d.DrawJSX=p1,d.EasingIOExpansion=jf,d.EasingUtil=T0,d.EdgeBroadphase=Wl,d.EdgeInstance=Ar,d.EdgeLayer=jl,d.EdgeScaleType=Fs,d.EdgeType=Mn,d.EulerOrder=_e,d.EventManager=Br,d.FontGlyphRenderSize=Bf,d.FontJSX=fg,d.FontManager=Uf,d.FontMap=Of,d.FontMapGlyphType=Va,d.FontRenderer=Df,d.FontResourceManager=kf,d.FontResourceRequestFetch=ei,d.FragmentOutputType=oe,d.GLProxy=is,d.GLState=vh,d.Geometry=lr,d.GlyphInstance=Vt,d.GlyphLayer=to,d.Hadamard2x2=qh,d.Hadamard3x3=Kh,d.Hadamard4x4=Zh,d.INVALID_RESOURCE_MANAGER=df,d.IdentityTransform=cf,d.ImageInstance=Cn,d.ImageLayer=Fp,d.ImageRasterizer=Zr,d.Instance=dt,d.Instance3D=Dn,d.InstanceAttributeBufferManager=Zf,d.InstanceAttributePackingBufferManager=Jf,d.InstanceAttributeSize=k,d.InstanceBlockIndex=Fc,d.InstanceDiffType=Je,d.InstanceProvider=Oe,d.InvalidResourceManager=hf,d.LabelInstance=Ae,d.LabelLayer=Xl,d.Layer=Sn,d.Layer2D=nt,d.LayerBufferType=qe,d.LayerInteractionHandler=mp,d.LayerJSX=io,d.LayerMouseEvents=Rp,d.LayerScene=Ka,d.M200=dr,d.M201=fr,d.M210=pr,d.M211=gr,d.M300=as,d.M301=os,d.M302=cs,d.M310=ls,d.M311=us,d.M312=hs,d.M320=ds,d.M321=fs,d.M322=ps,d.M3R=jr,d.M400=tn,d.M401=nn,d.M402=rn,d.M403=sn,d.M410=an,d.M411=on,d.M412=cn,d.M413=ln,d.M420=un,d.M421=hn,d.M422=dn,d.M423=fn,d.M430=pn,d.M431=gn,d.M432=mn,d.M433=vn,d.M4R=lt,d.Material=ss,d.MaterialUniformType=He,d.MatrixMath=a0,d.Model=Gc,d.MouseButton=Cu,d.NOOP=fa,d.NewLineCharacterMode=Fi,d.NoView=Tp,d.ObservableMonitoring=mt,d.PackNode=yt,d.PickType=ue,d.PostProcessInstance=su,d.PostProcessJSX=Bn,d.PostProcessLayer=au,d.Projection3D=qp,d.PromiseResolver=ht,d.QR1=Ad,d.QR2=Sd,d.QR3=xd,d.QR4=Md,d.QW=Od,d.QX=Id,d.QY=Cd,d.QZ=Ld,d.QuadTree=wf,d.QuadTreeNode=Ii,d.QuadTreeQuadrants=yf,d.QuaternionMath=o0,d.QueuedEventHandler=kl,d.QueuedEventHandlerJSX=lg,d.REQUEST=tv,d.RESOURCE=ev,d.RayMath=c0,d.ReactiveDiff=xs,d.RectangleInstance=Nn,d.RectangleLayer=Kl,d.ReferenceCamera2D=Wv,d.RenderTarget=hr,d.RenderTexture=Al,d.RenderTextureResourceManager=Mf,d.ResourcePool=x0,d.ResourceRouter=Ll,d.ResourceType=xe,d.RingInstance=Bi,d.RingLayer=Zl,d.SRT4x4=Ra,d.SRT4x4_2D=al,d.ScaleMode=xn,d.Scene=ma,d.SceneGraphLayer=Jp,d.SceneJSX=ao,d.ShaderInjectionTarget=P,d.ShaderModule=Qe,d.ShaderModuleUnit=Xa,d.SimpleEventHandler=Ur,d.SimpleEventHandlerJSX=ug,d.SimpleProjection=Oh,d.SimplexNoiseJSX=d1,d.StreamChangeStrategy=pa,d.SubTexture=Xn,d.Surface=Mp,d.SurfaceContext=ki,d.SurfaceErrorType=kc,d.SurfaceJSX=r1,d.TRS4x4=ys,d.TRS4x4_2D=Td,d.TextAlignment=no,d.TextAreaInstance=xr,d.TextAreaLayer=Hp,d.Texture=Re,d.TextureIOExpansion=Ga,d.TextureJSX=dg,d.TextureSize=Pt,d.TrailJSX=g1,d.Transform=Fa,d.Transform2D=Ww,d.TreeNode=Tl,d.UniformBufferManager=tp,d.UniformSize=L,d.UseMaterialStatus=kt,d.UserInputEventManager=bp,d.V3R=gt,d.V4R=Lu,d.VecMath=Q,d.VectorMath=l0,d.VertexAttributeSize=ct,d.View=Ns,d.View2D=Za,d.View3D=Kp,d.ViewJSX=so,d.WebGLRenderer=wh,d.WebGLStat=U,d.WordWrap=On,d.add1=Hs,d.add2=kn,d.add2x2=Wh,d.add3=Yt,d.add3x3=jh,d.add4=na,d.add4by3=Xu,d.add4x4=Hh,d.addQuat=Nd,d.affineInverse2x2=Dh,d.affineInverse3x3=Fh,d.affineInverse4x4=Bh,d.angleQuat=Hd,d.apply1=ot,d.apply2=Ce,d.apply2x2=Ut,d.apply3=Ne,d.apply3x3=bt,d.apply4=Le,d.apply4x4=ke,d.atlasRequest=Ci,d.axisQuat=Qd,d.ceil1=Lo,d.ceil2=Yo,d.ceil3=oc,d.ceil4=pc,d.clamp=Rt,d.color4FromHex3=Zu,d.color4FromHex4=Ju,d.colorBufferFormat=sh,d.colorUID=am,d.compare1=Oo,d.compare2=qs,d.compare2x2=md,d.compare3=Xi,d.compare3x3=vd,d.compare4=ra,d.compare4x4=sl,d.concat4x4=$h,d.concatChildren=iu,d.conjugateQuat=hl,d.convertToSDF=W0,d.copy1=No,d.copy2=Ys,d.copy2x2=yd,d.copy3=xt,d.copy3x3=wd,d.copy4=Kt,d.copy4x4=Ti,d.create=S0,d.createAtlas=Ef,d.createAttribute=mf,d.createChildLayer=Kr,d.createEasingAttribute=uv,d.createFont=Cl,d.createLayer=qr,d.createLayer2Din3D=Gw,d.createMaterialOptions=nm,d.createTexture=Rl,d.createUniform=Tf,d.createVertex=bf,d.createView=Bl,d.cross1=Do,d.cross2=Ko,d.cross3=wt,d.cross4=mc,d.debugLayer=m1,d.decomposeRotation=Oa,d.depthBufferFormat=ah,d.determinant2x2=Pe,d.determinant3x3=Hr,d.determinant4x4=Kc,d.diffUnitQuat=Fd,d.divide1=Fo,d.divide2=Qi,d.divide3=Yi,d.divide4=vc,d.divideQuat=Pd,d.dot1=jo,d.dot2=mi,d.dot3=qi,d.dot4=oa,d.dotQuat=zd,d.down3=Qu,d.drawMode=ha,d.empty1=Bo,d.empty2=Zo,d.empty3=cc,d.empty4=yc,d.eulerToQuat=qd,d.eventElementPosition=Jt,d.exponentQuat=Dd,d.filterQuery=_0,d.flatten1=Uo,d.flatten2=Jo,d.flatten3=lc,d.flatten4=ia,d.floor1=ko,d.floor2=ec,d.floor3=uc,d.floor4=wc,d.fontRequest=ti,d.forward1=Po,d.forward2=qo,d.forward3=kr,d.forward4=gc,d.fromEulerAxisAngleToQuat=Vd,d.fromOrderedEulerToQuat=fl,d.fuzzyCompare1=Pu,d.fuzzyCompare2=Bu,d.fuzzyCompare3=zu,d.fuzzyCompare4=Yu,d.generateDefaultScene=zf,d.generateLayerGeometry=$f,d.generateLayerMaterial=Vf,d.generateLayerModel=ja,d.getAbsolutePositionBounds=Lc,d.getProgramInfo=$g,d.iQuat=tf,d.identity2=gs,d.identity3=yn,d.identity4=Me,d.imaginaryQuat=Gd,d.indexToColorAttachment=Ji,d.indexToTextureUnit=ch,d.injectShaderIO=lp,d.inputImageFormat=Zi,d.instanceAttributeSizeFloatCount=hh,d.inverse1=Go,d.inverse2=Ks,d.inverse3=vi,d.inverse4=Tc,d.inverseQuat=Bd,d.isAtlasResource=Sl,d.isBoolean=ur,d.isBufferLocation=wv,d.isBufferLocationGroup=Yf,d.isDefined=Ue,d.isFontResource=Il,d.isFunction=rm,d.isInstanceAttributeBufferLocation=bv,d.isInstanceAttributeBufferLocationGroup=Kf,d.isInstanceAttributeVector=Zg,d.isNewline=tm,d.isNumber=fh,d.isOffscreenCanvas=$r,d.isOrthographic=lf,d.isPerspective=bl,d.isRenderTextureResource=Yr,d.isResourceAttribute=Jg,d.isString=$n,d.isUniformBufferLocation=ep,d.isUniformFloat=pm,d.isUniformMat3=hm,d.isUniformMat4=dm,d.isUniformTexture=fm,d.isUniformVec2=cm,d.isUniformVec3=lm,d.isUniformVec4=um,d.isUniformVec4Array=gh,d.isVec1=Ou,d.isVec2=Co,d.isVec3=Nu,d.isVec4=X,d.isVideoResource=Bs,d.isWhiteSpace=Vr,d.jQuat=nf,d.kQuat=rf,d.left3=Hu,d.length1=Qo,d.length1Components=Fu,d.length2=or,d.length2Components=ac,d.length3=Js,d.length3Components=fc,d.length4=ca,d.length4Components=Gn,d.lengthQuat=dl,d.linear1=Ho,d.linear2=sc,d.linear3=dc,d.linear4=Ec,d.lookAtMatrix=Jd,d.lookAtQuat=pl,d.magFilter=zr,d.makeFontSDF=j0,d.makeObservable=vt,d.mapGetWithDefault=ka,d.mapInjectDefault=yr,d.matrix3x3FromUnitQuatModel=Ca,d.matrix3x3FromUnitQuatView=Yd,d.matrix3x3ToQuaternion=Kd,d.matrix4x4FromUnitQuatModel=Xd,d.matrix4x4FromUnitQuatView=La,d.matrix4x4ToQuaternion=Zd,d.max1=zo,d.max2=tc,d.max3=ea,d.max4=_c,d.min1=Vo,d.min2=nc,d.min3=ta,d.min4=Rc,d.minFilter=Vn,d.multiply1=$o,d.multiply2=rc,d.multiply2x2=zh,d.multiply3=hc,d.multiply3x3=Vh,d.multiply4=bc,d.multiply4x4=It,d.multiplyQuat=ll,d.multiplyScalar2x2=Uh,d.multiplyScalar3x3=kh,d.multiplyScalar4x4=Gh,d.newLineCharRegEx=Uc,d.newLineRegEx=dh,d.nextFrame=As,d.normalize1=Wo,d.normalize2=ic,d.normalize3=Nt,d.normalize4=Ac,d.normalizeQuat=Ud,d.normalizeWheel=Yc,d.observable=B,d.onAnimationLoop=vl,d.onFrame=jn,d.oneQuat=Es,d.orthographic4x4=rl,d.packAttributes=sp,d.perspective4x4=nl,d.perspectiveFOVY4x4=gd,d.perspectiveFrustum4x4=Ea,d.preloadNumber=q0,d.project3As4ToScreen=_a,d.projectToScreen=il,d.ray=gl,d.rayFromPoints=ml,d.rayToLocation=sf,d.realQuat=kd,d.removeComments=Ms,d.renderGlyph=xl,d.resolveUpdate=wl,d.reverse2=Gu,d.reverse3=$u,d.reverse4=Ku,d.right3=ju,d.rotateVectorByUnitQuat=Na,d.rotation2x2=Zc,d.rotation4x4=Jc,d.rotation4x4by3=dd,d.scale1=Qs,d.scale2=Xe,d.scale3=Mt,d.scale4=sa,d.scale4x4=el,d.scale4x4by3=fd,d.scaleQuat=ul,d.scheduleUpdate=yl,d.shaderTemplate=wr,d.shallowCompare=ol,d.shearX2x2=td,d.shearX4x4=rd,d.shearY2x2=nd,d.shearY4x4=id,d.shearZ4x4=sd,d.slerpQuat=Sc,d.slerpUnitQuat=ef,d.stencilBufferFormat=oh,d.stopAllFrameCommands=u0,d.stopAnimationLoop=af,d.subTextureIOValue=Tr,d.subtract1=Xs,d.subtract2=je,d.subtract2x2=Qh,d.subtract3=qt,d.subtract3x3=Xh,d.subtract4=aa,d.subtract4x4=Yh,d.texelFormat=Gr,d.textureRequest=Cs,d.textureUnitToIndex=Nc,d.toEulerFromQuat=Wd,d.toEulerXYZfromOrderedEuler=$d,d.toOrderedEulerFromQuat=Ia,d.toOrderedEulerFromQuat2=jd,d.toString1=eh,d.toString2=th,d.toString2x2=ld,d.toString3=nh,d.toString3x3=ud,d.toString4=rh,d.toString4x4=hd,d.tod1=Du,d.tod2=Uu,d.tod3=Vu,d.tod4=qu,d.tod_flip2=ku,d.touchesContainsStartView=Lh,d.touchesHasStartView=Ch,d.transform2=ad,d.transform3=od,d.transform3as4=cd,d.transform4=vs,d.translation4x4=tl,d.translation4x4by3=pd,d.transpose2x2=Jh,d.transpose3x3=ms,d.transpose4x4=ed,d.uid=Y,d.up3=Wu,d.useChildResolvers=Lr,d.vec1=Xo,d.vec1Methods=xc,d.vec2=Zs,d.vec2Methods=Mc,d.vec3=cr,d.vec3Methods=Ic,d.vec4=Ki,d.vec4Methods=Cc,d.wait=R0,d.waitForValidDimensions=A0,d.whiteSpaceCharRegEx=Bc,d.whiteSpaceRegEx=em,d.wrapMode=Oc,d.zeroQuat=Ge,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.js.map
